!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=97)}([function(e,t,r){(function(t){var r;e.exports=function e(t,n,i){function a(s,l){if(!n[s]){if(!t[s]){var c="function"==typeof r&&r;if(!l&&c)return r(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var r=t[s][1][e];return a(r||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,a,o,s,l,c="",u=0;u<e.length;)t=e.charCodeAt(u++),r=e.charCodeAt(u++),i=e.charCodeAt(u++),a=t>>2,o=(3&t)<<4|r>>4,s=(15&r)<<2|i>>6,l=63&i,isNaN(r)?s=l=64:isNaN(i)&&(l=64),c=c+n.charAt(a)+n.charAt(o)+n.charAt(s)+n.charAt(l);return c},r.decode=function(e){var t,r,i,a,o,s,l,c="",u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)a=n.indexOf(e.charAt(u++)),o=n.indexOf(e.charAt(u++)),s=n.indexOf(e.charAt(u++)),l=n.indexOf(e.charAt(u++)),t=a<<2|o>>4,r=(15&o)<<4|s>>2,i=(3&s)<<6|l,c+=String.fromCharCode(t),64!=s&&(c+=String.fromCharCode(r)),64!=l&&(c+=String.fromCharCode(i));return c}},{}],2:[function(e,t){"use strict";function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=r},{}],3:[function(e,t,r){"use strict";r.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},r.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t){"use strict";var r=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if(void 0===e||!e.length)return 0;var i="string"!==r.getTypeOf(e);void 0===t&&(t=0);var a=0;t^=-1;for(var o=0,s=e.length;s>o;o++)a=i?e[o]:e.charCodeAt(o),t=t>>>8^n[255&(t^a)];return-1^t}},{"./utils":21}],5:[function(e,t){"use strict";function r(){this.data=null,this.length=0,this.index=0}var n=e("./utils");r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=r},{"./utils":21}],6:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!1,r.date=null,r.compression=null,r.comment=null},{}],7:[function(e,t,r){"use strict";var n=e("./utils");r.string2binary=function(e){return n.string2binary(e)},r.string2Uint8Array=function(e){return n.transformTo("uint8array",e)},r.uint8Array2String=function(e){return n.transformTo("string",e)},r.string2Blob=function(e){var t=n.transformTo("arraybuffer",e);return n.arrayBuffer2Blob(t)},r.arrayBuffer2Blob=function(e){return n.arrayBuffer2Blob(e)},r.transformTo=function(e,t){return n.transformTo(e,t)},r.getTypeOf=function(e){return n.getTypeOf(e)},r.checkSupport=function(e){return n.checkSupport(e)},r.MAX_VALUE_16BITS=n.MAX_VALUE_16BITS,r.MAX_VALUE_32BITS=n.MAX_VALUE_32BITS,r.pretty=function(e){return n.pretty(e)},r.findCompression=function(e){return n.findCompression(e)},r.isRegExp=function(e){return n.isRegExp(e)}},{"./utils":21}],8:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako");r.uncompressInputType=n?"uint8array":"array",r.compressInputType=n?"uint8array":"array",r.magic="\b\0",r.compress=function(e){return i.deflateRaw(e)},r.uncompress=function(e){return i.inflateRaw(e)}},{pako:24}],9:[function(e,t){"use strict";function r(e,t){return this instanceof r?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new r(e,t)}var n=e("./base64");r.prototype=e("./object"),r.prototype.load=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.utils=e("./deprecatedPublicUtils"),r.base64={encode:function(e){return n.encode(e)},decode:function(e){return n.decode(e)}},r.compressions=e("./compressions"),t.exports=r},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t){"use strict";var r=e("./base64"),n=e("./zipEntries");t.exports=function(e,t){var i,a,o,s;for((t=t||{}).base64&&(e=r.decode(e)),a=new n(e,t),i=a.files,o=0;o<i.length;o++)s=i[o],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,createFolders:t.createFolders});return a.zipComment.length&&(this.comment=a.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,r){(function(e){"use strict";r.exports=function(t,r){return new e(t,r)},r.exports.test=function(t){return e.isBuffer(t)}}).call(this,void 0!==t?t:void 0)},{}],12:[function(e,t){"use strict";function r(e){this.data=e,this.length=this.data.length,this.index=0}var n=e("./uint8ArrayReader");r.prototype=new n,r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./uint8ArrayReader":18}],13:[function(e,t){"use strict";var r=e("./support"),n=e("./utils"),i=e("./crc32"),a=e("./signature"),o=e("./defaults"),s=e("./base64"),l=e("./compressions"),c=e("./compressedObject"),u=e("./nodeBuffer"),h=e("./utf8"),d=e("./stringWriter"),f=e("./uint8ArrayWriter"),p=function(e){if(e._data instanceof c&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===n.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},m=function(e){var t=p(e),i=n.getTypeOf(t);return"string"===i?!e.options.binary&&r.nodebuffer?u(t,"utf-8"):e.asBinary():t},v=function(e){var t=p(this);return null==t?"":(this.options.base64&&(t=s.decode(t)),t=e&&this.options.binary?M.utf8decode(t):n.transformTo("string",t),e||this.options.binary||(t=n.transformTo("string",M.utf8encode(t))),t)},g=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this._data=t,this.options=r,this._initialMetadata={dir:r.dir,date:r.date}};g.prototype={asText:function(){return v.call(this,!0)},asBinary:function(){return v.call(this,!1)},asNodeBuffer:function(){var e=m(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=m(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var y=function(e,t){var r,n="";for(r=0;t>r;r++)n+=String.fromCharCode(255&e),e>>>=8;return n},E=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},x=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=E(e,o)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},T=function(e,t,r){var i,a=n.getTypeOf(t);if((r=x(r)).createFolders&&(i=b(e))&&w.call(this,i,!0),r.dir||null==t)r.base64=!1,r.binary=!1,t=null;else if("string"===a)r.binary&&!r.base64&&!0!==r.optimizedBinaryString&&(t=n.string2binary(t));else{if(r.base64=!1,r.binary=!0,!(a||t instanceof c))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===a&&(t=n.transformTo("uint8array",t))}var o=new g(e,t,r);return this.files[e]=o,o},b=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},w=function(e,t){return"/"!=e.slice(-1)&&(e+="/"),t=void 0!==t&&t,this.files[e]||T.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},_=function(e,t){var r,a=new c;return e._data instanceof c?(a.uncompressedSize=e._data.uncompressedSize,a.crc32=e._data.crc32,0===a.uncompressedSize||e.dir?(t=l.STORE,a.compressedContent="",a.crc32=0):e._data.compressionMethod===t.magic?a.compressedContent=e._data.getCompressedContent():(r=e._data.getContent(),a.compressedContent=t.compress(n.transformTo(t.compressInputType,r)))):((!(r=m(e))||0===r.length||e.dir)&&(t=l.STORE,r=""),a.uncompressedSize=r.length,a.crc32=i(r),a.compressedContent=t.compress(n.transformTo(t.compressInputType,r))),a.compressedSize=a.compressedContent.length,a.compressionMethod=t.magic,a},R=function(e,t,r,o){var s,l,c,u,d=(r.compressedContent,n.transformTo("string",h.utf8encode(t.name))),f=t.comment||"",p=n.transformTo("string",h.utf8encode(f)),m=d.length!==t.name.length,v=p.length!==f.length,g=t.options,E="",x="",T="";c=t._initialMetadata.dir!==t.dir?t.dir:g.dir,u=t._initialMetadata.date!==t.date?t.date:g.date,s=u.getHours(),s<<=6,s|=u.getMinutes(),s<<=5,s|=u.getSeconds()/2,l=u.getFullYear()-1980,l<<=4,l|=u.getMonth()+1,l<<=5,l|=u.getDate(),m&&(x=y(1,1)+y(i(d),4)+d,E+="up"+y(x.length,2)+x),v&&(T=y(1,1)+y(this.crc32(p),4)+p,E+="uc"+y(T.length,2)+T);var b="";b+="\n\0",b+=m||v?"\0\b":"\0\0",b+=r.compressionMethod,b+=y(s,2),b+=y(l,2),b+=y(r.crc32,4),b+=y(r.compressedSize,4),b+=y(r.uncompressedSize,4),b+=y(d.length,2),b+=y(E.length,2);var w=a.LOCAL_FILE_HEADER+b+d+E,_=a.CENTRAL_FILE_HEADER+"\0"+b+y(p.length,2)+"\0\0\0\0"+(!0===c?"\0\0\0":"\0\0\0\0")+y(o,4)+d+E+p;return{fileRecord:w,dirRecord:_,compressedObject:r}},M={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,r,n,i,a=[];for(t in this.files)this.files.hasOwnProperty(t)&&(n=this.files[t],i=new g(n.name,n._data,E(n.options)),r=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(r,i)&&a.push(i));return a},file:function(e,t,r){if(1===arguments.length){if(n.isRegExp(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}return this.filter(function(t,r){return!r.dir&&t===e})[0]||null}return e=this.root+e,T.call(this,e,t,r),this},folder:function(e){if(!e)return this;if(n.isRegExp(e))return this.filter(function(t,r){return r.dir&&e.test(t)});var t=this.root+e,r=w.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter(function(t,r){return r.name.slice(0,e.length)===e}),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(e){e=E(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),n.checkSupport(e.type);var t,r,i=[],o=0,c=0,u=n.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var h in this.files)if(this.files.hasOwnProperty(h)){var p=this.files[h],m=p.options.compression||e.compression.toUpperCase(),v=l[m];if(!v)throw new Error(m+" is not a valid compression method !");var g=_.call(this,p,v),x=R.call(this,h,p,g,o);o+=x.fileRecord.length+g.compressedSize,c+=x.dirRecord.length,i.push(x)}var T="";T=a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+y(i.length,2)+y(i.length,2)+y(c,4)+y(o,4)+y(u.length,2)+u;var b=e.type.toLowerCase();for(t="uint8array"===b||"arraybuffer"===b||"blob"===b||"nodebuffer"===b?new f(o+c+T.length):new d(o+c+T.length),r=0;r<i.length;r++)t.append(i[r].fileRecord),t.append(i[r].compressedObject.compressedContent);for(r=0;r<i.length;r++)t.append(i[r].dirRecord);t.append(T);var w=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),w);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",w));case"base64":return e.base64?s.encode(w):w;default:return w}},crc32:function(e,t){return i(e,t)},utf8encode:function(e){return n.transformTo("string",h.utf8encode(e))},utf8decode:function(e){return h.utf8decode(e)}};t.exports=M},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,t){"use strict";function r(e,t){this.data=e,t||(this.data=i.string2binary(this.data)),this.length=this.data.length,this.index=0}var n=e("./dataReader"),i=e("./utils");r.prototype=new n,r.prototype.byteAt=function(e){return this.data.charCodeAt(e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5,"./utils":21}],16:[function(e,t){"use strict";var r=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=r.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=n},{"./utils":21}],17:[function(e,r,n){(function(e){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==e,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var t=new ArrayBuffer(0);try{n.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=new r;i.append(t),n.blob=0===i.getBlob("application/zip").size}catch(e){n.blob=!1}}}}).call(this,void 0!==t?t:void 0)},{}],18:[function(e,t){"use strict";function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var n=e("./dataReader");r.prototype=new n,r.prototype.byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===r&&this.data[a+2]===n&&this.data[a+3]===i)return a;return-1},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5}],19:[function(e,t){"use strict";var r=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=r.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=n},{"./utils":21}],20:[function(e,t,r){"use strict";for(var n=e("./utils"),i=e("./support"),a=e("./nodeBuffer"),o=new Array(256),s=0;256>s;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;o[254]=o[254]=1;var l=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r?t:0===r?t:r+o[e[r]]>t?r:t},c=function(e){var t,r,i,a,s=e.length,l=new Array(2*s);for(r=0,t=0;s>t;)if(128>(i=e[t++]))l[r++]=i;else if((a=o[i])>4)l[r++]=65533,t+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&s>t;)i=i<<6|63&e[t++],a--;a>1?l[r++]=65533:65536>i?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),n.applyFromCharCode(l)};r.utf8encode=function(e){return i.nodebuffer?a(e,"utf-8"):function(e){var t,r,n,a,o,s=e.length,l=0;for(a=0;s>a;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=i.uint8array?new Uint8Array(l):new Array(l),o=0,a=0;l>o;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t}(e)},r.utf8decode=function(e){if(i.nodebuffer)return n.transformTo("nodebuffer",e).toString("utf-8");e=n.transformTo(i.uint8array?"uint8array":"array",e);for(var t=[],r=0,a=e.length;a>r;){var o=l(e,Math.min(r+65536,a));t.push(i.uint8array?c(e.subarray(r,o)):c(e.slice(r,o))),r=o}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,r){"use strict";function n(e){return e}function i(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}function a(e){var t=65536,n=[],i=e.length,a=r.getTypeOf(e),o=0,s=!0;try{switch(a){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,c(0))}}catch(e){s=!1}if(!s){for(var l="",u=0;u<e.length;u++)l+=String.fromCharCode(e[u]);return l}for(;i>o&&t>1;)try{n.push("array"===a||"nodebuffer"===a?String.fromCharCode.apply(null,e.slice(o,Math.min(o+t,i))):String.fromCharCode.apply(null,e.subarray(o,Math.min(o+t,i)))),o+=t}catch(e){t=Math.floor(t/2)}return n.join("")}function o(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var s=e("./support"),l=e("./compressions"),c=e("./nodeBuffer");r.string2binary=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(255&e.charCodeAt(r));return t},r.arrayBuffer2Blob=function(e){r.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(r){try{var t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=new t;return n.append(e),n.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},r.applyFromCharCode=a;var u={};u.string={string:n,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return u.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,c(e.length))}},u.array={string:a,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c(e)}},u.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return o(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c(new Uint8Array(e))}},u.uint8array={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return c(e)}},u.nodebuffer={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return u.nodebuffer.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:n},r.transformTo=function(e,t){if(t||(t=""),!e)return t;r.checkSupport(e);var n=r.getTypeOf(t),i=u[n][e](t);return i},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":s.nodebuffer&&c.test(e)?"nodebuffer":s.uint8array&&e instanceof Uint8Array?"uint8array":s.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){var t=s[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this browser")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)t=e.charCodeAt(r),n+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return n},r.findCompression=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null},r.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t){"use strict";function r(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var n=e("./stringReader"),i=e("./nodeBufferReader"),a=e("./uint8ArrayReader"),o=e("./utils"),s=e("./signature"),l=e("./zipEntry"),c=e("./support"),u=e("./object");r.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=u.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;n>0;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===s.CENTRAL_FILE_HEADER;)(e=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=o.getTypeOf(e);this.reader="string"!==t||c.uint8array?"nodebuffer"===t?new i(e):new a(o.transformTo("uint8array",e)):new n(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=r},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t){"use strict";function r(e,t){this.options=e,this.loadOptions=t}var n=e("./stringReader"),i=e("./utils"),a=e("./compressedObject"),o=e("./object");r.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,r){return function(){var n=e.index;e.setIndex(t);var i=e.readData(r);return e.setIndex(n),i}},prepareContent:function(e,t,r,n,a){return function(){var e=i.transformTo(n.uncompressInputType,this.getCompressedContent()),t=n.uncompress(e);if(t.length!==a)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(r),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=i.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new a,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=i.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=new n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index;for(this.extraFields=this.extraFields||{};e.index<i+this.extraFieldsLength;)t=e.readInt(2),r=e.readInt(2),n=e.readString(r),this.extraFields[t]={id:t,length:r,value:n}},handleUTF8:function(){if(this.useUTF8())this.fileName=o.utf8decode(this.fileName),this.fileComment=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=r},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t){"use strict";var r=e("./lib/utils/common").assign,n=e("./lib/deflate"),i=e("./lib/inflate"),a=e("./lib/zlib/constants"),o={};r(o,n,i,a),t.exports=o},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,r){"use strict";function n(e,t){var r=new c(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/deflate.js"),a=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/messages"),l=e("./zlib/zstream"),c=function(e){this.options=a.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(s[r]);t.header&&i.deflateSetHeader(this.strm,t.header)};c.prototype.push=function(e,t){var r,n,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,s.input="string"==typeof e?o.string2buf(e):e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new a.Buf8(l),s.next_out=0,s.avail_out=l),1!==(r=i.deflate(s,n))&&0!==r)return this.onEnd(r),this.ended=!0,!1;(0===s.avail_out||0===s.avail_in&&4===n)&&this.onData("string"===this.options.to?o.buf2binstring(a.shrinkBuf(s.output,s.next_out)):a.shrinkBuf(s.output,s.next_out))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4!==n||(r=i.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r)},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){0===e&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=c,r.deflate=n,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,r){"use strict";function n(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/inflate.js"),a=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/constants"),l=e("./zlib/messages"),c=e("./zlib/zstream"),u=e("./zlib/gzheader"),h=function(e){this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var r=i.inflateInit2(this.strm,t.windowBits);if(r!==s.Z_OK)throw new Error(l[r]);this.header=new u,i.inflateGetHeader(this.strm,this.header)};h.prototype.push=function(e,t){var r,n,l,c,u,h=this.strm,d=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,h.input="string"==typeof e?o.binstring2buf(e):e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(d),h.next_out=0,h.avail_out=d),(r=i.inflate(h,s.Z_NO_FLUSH))!==s.Z_STREAM_END&&r!==s.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0===h.avail_out||r===s.Z_STREAM_END||0===h.avail_in&&n===s.Z_FINISH)&&("string"===this.options.to?(l=o.utf8border(h.output,h.next_out),c=h.next_out-l,u=o.buf2string(h.output,l),h.next_out=c,h.avail_out=d-c,c&&a.arraySet(h.output,h.output,l,c,0),this.onData(u)):this.onData(a.shrinkBuf(h.output,h.next_out)))}while(h.avail_in>0&&r!==s.Z_STREAM_END);return r===s.Z_STREAM_END&&(n=s.Z_FINISH),n!==s.Z_FINISH||(r=i.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===s.Z_OK)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===s.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=h,r.inflate=n,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.ungzip=n},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;n>a;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;r>t;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;r>t;t++)a=e[t],o.set(a,i),i+=a.length;return o}},a={arraySet:function(e,t,r,n,i){for(var a=0;n>a;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(n)},{}],28:[function(e,t,r){"use strict";function n(e,t){if(65537>t&&(e.subarray&&o||!e.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var r="",n=0;t>n;n++)r+=String.fromCharCode(e[n]);return r}var i=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new i.Buf8(256),l=0;256>l;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,r.string2buf=function(e){var t,r,n,a,o,s=e.length,l=0;for(a=0;s>a;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=new i.Buf8(l),o=0,a=0;l>o;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},r.buf2binstring=function(e){return n(e,e.length)},r.binstring2buf=function(e){for(var t=new i.Buf8(e.length),r=0,n=t.length;n>r;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,i,a,o,l=t||e.length,c=new Array(2*l);for(i=0,r=0;l>r;)if(128>(a=e[r++]))c[i++]=a;else if((o=s[a])>4)c[i++]=65533,r+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&l>r;)a=a<<6|63&e[r++],o--;o>1?c[i++]=65533:65536>a?c[i++]=a:(a-=65536,c[i++]=55296|a>>10&1023,c[i++]=56320|1023&a)}return n(c,i)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r?t:0===r?t:r+s[e[r]]>t?r:t}},{"./common":27}],29:[function(e,t){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{i=i+t[n++]|0,a=a+i|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},{}],30:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t){"use strict";var r=function(){for(var e,t=[],r=0;256>r;r++){e=r;for(var n=0;8>n;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;o>s;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},{}],32:[function(e,t,r){"use strict";function n(e,t){return e.msg=M[t],t}function i(e){return(e<<1)-(e>4?9:0)}function a(e){for(var t=e.length;--t>=0;)e[t]=0}function o(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(b.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function s(e,t){w._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,o(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function c(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function u(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,b.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=_(e.adler,t,i,r):2===e.state.wrap&&(e.adler=R(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function h(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-te?e.strstart-(e.w_size-te):0,c=e.window,u=e.w_mask,h=e.prev,d=e.strstart+ee,f=c[a+o-1],p=c[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+o]===p&&c[r+o-1]===f&&c[r]===c[a]&&c[++r]===c[a+1]){a+=2,r++;do{}while(c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&d>a);if(n=ee-(d-a),a=d-ee,n>o){if(e.match_start=t,o=n,n>=s)break;f=c[a+o-1],p=c[a+o]}}}while((t=h[t&u])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function d(e){var t,r,n,i,a,o=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-te)){b.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,r=e.hash_size,t=r;do{n=e.head[--t],e.head[t]=n>=o?n-o:0}while(--r);t=r=o;do{n=e.prev[--t],e.prev[t]=n>=o?n-o:0}while(--r);i+=o}if(0===e.strm.avail_in)break;if(r=u(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=$)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+$-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<$)););}while(e.lookahead<te&&0!==e.strm.avail_in)}function f(e,t){for(var r,n;;){if(e.lookahead<te){if(d(e),e.lookahead<te&&t===S)return ue;if(0===e.lookahead)break}if(r=0,e.lookahead>=$&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-te&&(e.match_length=h(e,r)),e.match_length>=$)if(n=w._tr_tally(e,e.strstart-e.match_start,e.match_length-$),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=$){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=w._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(s(e,!1),0===e.strm.avail_out))return ue}return e.insert=e.strstart<$-1?e.strstart:$-1,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ue:he}function p(e,t){for(var r,n,i;;){if(e.lookahead<te){if(d(e),e.lookahead<te&&t===S)return ue;if(0===e.lookahead)break}if(r=0,e.lookahead>=$&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=$-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-te&&(e.match_length=h(e,r),e.match_length<=5&&(e.strategy===D||e.match_length===$&&e.strstart-e.match_start>4096)&&(e.match_length=$-1)),e.prev_length>=$&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-$,n=w._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-$),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=$-1,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return ue}else if(e.match_available){if((n=w._tr_tally(e,0,e.window[e.strstart-1]))&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return ue}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=w._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<$-1?e.strstart:$-1,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ue:he}function m(e,t){for(var r,n,i,a,o=e.window;;){if(e.lookahead<=ee){if(d(e),e.lookahead<=ee&&t===S)return ue;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=$&&e.strstart>0&&(i=e.strstart-1,(n=o[i])===o[++i]&&n===o[++i]&&n===o[++i])){a=e.strstart+ee;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&a>i);e.match_length=ee-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=$?(r=w._tr_tally(e,1,e.match_length-$),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=w._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(s(e,!1),0===e.strm.avail_out))return ue}return e.insert=0,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ue:he}function v(e,t){for(var r;;){if(0===e.lookahead&&(d(e),0===e.lookahead)){if(t===S)return ue;break}if(e.match_length=0,r=w._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(s(e,!1),0===e.strm.avail_out))return ue}return e.insert=0,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ue:he}function g(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=j,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new b.Buf16(2*K),this.dyn_dtree=new b.Buf16(2*(2*Z+1)),this.bl_tree=new b.Buf16(2*(2*Q+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new b.Buf16(J+1),this.heap=new b.Buf16(2*q+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new b.Buf16(2*q+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function y(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=V,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ne:le,e.adler=2===t.wrap?0:1,t.last_flush=S,w._tr_init(t),H):n(e,k)}function E(e){var t=y(e);return t===H&&function(e){e.window_size=2*e.w_size,a(e.head),e.max_lazy_match=T[e.level].max_lazy,e.good_match=T[e.level].good_length,e.nice_match=T[e.level].nice_length,e.max_chain_length=T[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=$-1,e.match_available=0,e.ins_h=0}(e.state),t}function x(e,t,r,i,a,o){if(!e)return k;var s=1;if(t===F&&(t=6),0>i?(s=0,i=-i):i>15&&(s=2,i-=16),1>a||a>W||r!==j||8>i||i>15||0>t||t>9||0>o||o>B)return n(e,k);8===i&&(i=9);var l=new g;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+$-1)/$),l.window=new b.Buf8(2*l.w_size),l.head=new b.Buf16(l.hash_size),l.prev=new b.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new b.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,E(e)}var T,b=e("../utils/common"),w=e("./trees"),_=e("./adler32"),R=e("./crc32"),M=e("./messages"),S=0,A=1,L=3,P=4,C=5,H=0,I=1,k=-2,N=-3,O=-5,F=-1,D=1,U=2,z=3,B=4,G=0,V=2,j=8,W=9,X=15,Y=8,q=286,Z=30,Q=19,K=2*q+1,J=15,$=3,ee=258,te=ee+$+1,re=32,ne=42,ie=69,ae=73,oe=91,se=103,le=113,ce=666,ue=1,he=2,de=3,fe=4,pe=3,me=function(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i};T=[new me(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(d(e),0===e.lookahead&&t===S)return ue;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,s(e,!1),0===e.strm.avail_out))return ue;if(e.strstart-e.block_start>=e.w_size-te&&(s(e,!1),0===e.strm.avail_out))return ue}return e.insert=0,t===P?(s(e,!0),0===e.strm.avail_out?de:fe):(e.strstart>e.block_start&&(s(e,!1),e.strm.avail_out),ue)}),new me(4,4,8,4,f),new me(4,5,16,8,f),new me(4,6,32,32,f),new me(4,4,16,16,p),new me(8,16,32,32,p),new me(8,16,128,128,p),new me(8,32,128,256,p),new me(32,128,258,1024,p),new me(32,258,258,4096,p)],r.deflateInit=function(e,t){return x(e,t,j,X,Y,G)},r.deflateInit2=x,r.deflateReset=E,r.deflateResetKeep=y,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?k:(e.state.gzhead=t,H):k},r.deflate=function(e,t){var r,s,u,h;if(!e||!e.state||t>C||0>t)return e?n(e,k):k;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===ce&&t!==P)return n(e,0===e.avail_out?O:k);if(s.strm=e,r=s.last_flush,s.last_flush=t,s.status===ne)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=U||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=R(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=ie):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=U||s.level<2?4:0),l(s,pe),s.status=le);else{var d=j+(s.w_bits-8<<4)<<8,f=-1;f=s.strategy>=U||s.level<2?0:s.level<6?1:6===s.level?2:3,d|=f<<6,0!==s.strstart&&(d|=re),d+=31-d%31,s.status=le,c(s,d),0!==s.strstart&&(c(s,e.adler>>>16),c(s,65535&e.adler)),e.adler=1}if(s.status===ie)if(s.gzhead.extra){for(u=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),o(e),u=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=ae)}else s.status=ae;if(s.status===ae)if(s.gzhead.name){u=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),o(e),u=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),0===h&&(s.gzindex=0,s.status=oe)}else s.status=oe;if(s.status===oe)if(s.gzhead.comment){u=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),o(e),u=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),0===h&&(s.status=se)}else s.status=se;if(s.status===se&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&o(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=le)):s.status=le),0!==s.pending){if(o(e),0===e.avail_out)return s.last_flush=-1,H}else if(0===e.avail_in&&i(t)<=i(r)&&t!==P)return n(e,O);if(s.status===ce&&0!==e.avail_in)return n(e,O);if(0!==e.avail_in||0!==s.lookahead||t!==S&&s.status!==ce){var p=s.strategy===U?v(s,t):s.strategy===z?m(s,t):T[s.level].func(s,t);if((p===de||p===fe)&&(s.status=ce),p===ue||p===de)return 0===e.avail_out&&(s.last_flush=-1),H;if(p===he&&(t===A?w._tr_align(s):t!==C&&(w._tr_stored_block(s,0,0,!1),t===L&&(a(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),o(e),0===e.avail_out))return s.last_flush=-1,H}return t!==P?H:s.wrap<=0?I:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(c(s,e.adler>>>16),c(s,65535&e.adler)),o(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?H:I)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==ne&&t!==ie&&t!==ae&&t!==oe&&t!==se&&t!==le&&t!==ce?n(e,k):(e.state=null,t===le?n(e,N):H):k},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],34:[function(e,t){"use strict";t.exports=function(e,t){var r,n,i,a,o,s,l,c,u,h,d,f,p,m,v,g,y,E,x,T,b,w,_,R,M;r=e.state,n=e.next_in,R=e.input,i=n+(e.avail_in-5),a=e.next_out,M=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,c=r.wsize,u=r.whave,h=r.wnext,d=r.window,f=r.hold,p=r.bits,m=r.lencode,v=r.distcode,g=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{15>p&&(f+=R[n++]<<p,p+=8,f+=R[n++]<<p,p+=8),E=m[f&g];t:for(;;){if(f>>>=x=E>>>24,p-=x,0==(x=E>>>16&255))M[a++]=65535&E;else{if(!(16&x)){if(0==(64&x)){E=m[(65535&E)+(f&(1<<x)-1)];continue t}if(32&x){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}T=65535&E,(x&=15)&&(x>p&&(f+=R[n++]<<p,p+=8),T+=f&(1<<x)-1,f>>>=x,p-=x),15>p&&(f+=R[n++]<<p,p+=8,f+=R[n++]<<p,p+=8),E=v[f&y];r:for(;;){if(f>>>=x=E>>>24,p-=x,!(16&(x=E>>>16&255))){if(0==(64&x)){E=v[(65535&E)+(f&(1<<x)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(b=65535&E,(x&=15)>p&&(f+=R[n++]<<p,x>(p+=8)&&(f+=R[n++]<<p,p+=8)),(b+=f&(1<<x)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=x,p-=x,b>(x=a-o)){if((x=b-x)>u&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(w=0,_=d,0===h){if(w+=c-x,T>x){T-=x;do{M[a++]=d[w++]}while(--x);w=a-b,_=M}}else if(x>h){if(w+=c+h-x,T>(x-=h)){T-=x;do{M[a++]=d[w++]}while(--x);if(w=0,T>h){T-=x=h;do{M[a++]=d[w++]}while(--x);w=a-b,_=M}}}else if(w+=h-x,T>x){T-=x;do{M[a++]=d[w++]}while(--x);w=a-b,_=M}for(;T>2;)M[a++]=_[w++],M[a++]=_[w++],M[a++]=_[w++],T-=3;T&&(M[a++]=_[w++],T>1&&(M[a++]=_[w++]))}else{w=a-b;do{M[a++]=M[w++],M[a++]=M[w++],M[a++]=M[w++],T-=3}while(T>2);T&&(M[a++]=M[w++],T>1&&(M[a++]=M[w++]))}break}}break}}while(i>n&&s>a);n-=T=p>>3,f&=(1<<(p-=T<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=i>n?i-n+5:5-(n-i),e.avail_out=s>a?s-a+257:257-(a-s),r.hold=f,r.bits=p}},{}],35:[function(e,t,r){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=C,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new d.Buf32(ce),t.distcode=t.distdyn=new d.Buf32(ue),t.sane=1,t.back=-1,w):M}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):M}function s(e,t){var r,n;return e&&e.state?(n=e.state,0>t?(r=0,t=-t):(r=1+(t>>4),48>t&&(t&=15)),t&&(8>t||t>15)?M:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):M}function l(e,t){var r,n;return e?(n=new i,e.state=n,n.window=null,(r=s(e,t))!==w&&(e.state=null),r):M}function c(e){if(de){var t;for(u=new d.Buf32(512),h=new d.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(v(y,e.lens,0,288,u,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;v(E,e.lens,0,32,h,0,e.work,{bits:5}),de=!1}e.lencode=u,e.lenbits=9,e.distcode=h,e.distbits=5}var u,h,d=e("../utils/common"),f=e("./adler32"),p=e("./crc32"),m=e("./inffast"),v=e("./inftrees"),g=0,y=1,E=2,x=4,T=5,b=6,w=0,_=1,R=2,M=-2,S=-3,A=-4,L=-5,P=8,C=1,H=2,I=3,k=4,N=5,O=6,F=7,D=8,U=9,z=10,B=11,G=12,V=13,j=14,W=15,X=16,Y=17,q=18,Z=19,Q=20,K=21,J=22,$=23,ee=24,te=25,re=26,ne=27,ie=28,ae=29,oe=30,se=31,le=32,ce=852,ue=592,he=15,de=!0;r.inflateReset=o,r.inflateReset2=s,r.inflateResetKeep=a,r.inflateInit=function(e){return l(e,he)},r.inflateInit2=l,r.inflate=function(e,t){var r,i,a,o,s,l,u,h,ce,ue,he,de,fe,pe,me,ve,ge,ye,Ee,xe,Te,be,we,_e,Re=0,Me=new d.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return M;(r=e.state).mode===G&&(r.mode=V),s=e.next_out,a=e.output,u=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=r.hold,ce=r.bits,ue=l,he=u,be=w;e:for(;;)switch(r.mode){case C:if(0===r.wrap){r.mode=V;break}for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(2&r.wrap&&35615===h){r.check=0,Me[0]=255&h,Me[1]=h>>>8&255,r.check=p(r.check,Me,2,0),h=0,ce=0,r.mode=H;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",r.mode=oe;break}if((15&h)!==P){e.msg="unknown compression method",r.mode=oe;break}if(ce-=4,Te=8+(15&(h>>>=4)),0===r.wbits)r.wbits=Te;else if(Te>r.wbits){e.msg="invalid window size",r.mode=oe;break}r.dmax=1<<Te,e.adler=r.check=1,r.mode=512&h?z:G,h=0,ce=0;break;case H:for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(r.flags=h,(255&r.flags)!==P){e.msg="unknown compression method",r.mode=oe;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=oe;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,r.check=p(r.check,Me,2,0)),h=0,ce=0,r.mode=I;case I:for(;32>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.head&&(r.head.time=h),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,Me[2]=h>>>16&255,Me[3]=h>>>24&255,r.check=p(r.check,Me,4,0)),h=0,ce=0,r.mode=k;case k:for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,r.check=p(r.check,Me,2,0)),h=0,ce=0,r.mode=N;case N:if(1024&r.flags){for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,r.check=p(r.check,Me,2,0)),h=0,ce=0}else r.head&&(r.head.extra=null);r.mode=O;case O:if(1024&r.flags&&((de=r.length)>l&&(de=l),de&&(r.head&&(Te=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),d.arraySet(r.head.extra,i,o,de,Te)),512&r.flags&&(r.check=p(r.check,i,de,o)),l-=de,o+=de,r.length-=de),r.length))break e;r.length=0,r.mode=F;case F:if(2048&r.flags){if(0===l)break e;de=0;do{Te=i[o+de++],r.head&&Te&&r.length<65536&&(r.head.name+=String.fromCharCode(Te))}while(Te&&l>de);if(512&r.flags&&(r.check=p(r.check,i,de,o)),l-=de,o+=de,Te)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=D;case D:if(4096&r.flags){if(0===l)break e;de=0;do{Te=i[o+de++],r.head&&Te&&r.length<65536&&(r.head.comment+=String.fromCharCode(Te))}while(Te&&l>de);if(512&r.flags&&(r.check=p(r.check,i,de,o)),l-=de,o+=de,Te)break e}else r.head&&(r.head.comment=null);r.mode=U;case U:if(512&r.flags){for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(h!==(65535&r.check)){e.msg="header crc mismatch",r.mode=oe;break}h=0,ce=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=G;break;case z:for(;32>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}e.adler=r.check=n(h),h=0,ce=0,r.mode=B;case B:if(0===r.havedict)return e.next_out=s,e.avail_out=u,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ce,R;e.adler=r.check=1,r.mode=G;case G:if(t===T||t===b)break e;case V:if(r.last){h>>>=7&ce,ce-=7&ce,r.mode=ne;break}for(;3>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}switch(r.last=1&h,ce-=1,3&(h>>>=1)){case 0:r.mode=j;break;case 1:if(c(r),r.mode=Q,t===b){h>>>=2,ce-=2;break e}break;case 2:r.mode=Y;break;case 3:e.msg="invalid block type",r.mode=oe}h>>>=2,ce-=2;break;case j:for(h>>>=7&ce,ce-=7&ce;32>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",r.mode=oe;break}if(r.length=65535&h,h=0,ce=0,r.mode=W,t===b)break e;case W:r.mode=X;case X:if(de=r.length){if(de>l&&(de=l),de>u&&(de=u),0===de)break e;d.arraySet(a,i,o,de,s),l-=de,o+=de,u-=de,s+=de,r.length-=de;break}r.mode=G;break;case Y:for(;14>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(r.nlen=257+(31&h),h>>>=5,ce-=5,r.ndist=1+(31&h),h>>>=5,ce-=5,r.ncode=4+(15&h),h>>>=4,ce-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=oe;break}r.have=0,r.mode=q;case q:for(;r.have<r.ncode;){for(;3>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.lens[Se[r.have++]]=7&h,h>>>=3,ce-=3}for(;r.have<19;)r.lens[Se[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,we={bits:r.lenbits},be=v(g,r.lens,0,19,r.lencode,0,r.work,we),r.lenbits=we.bits,be){e.msg="invalid code lengths set",r.mode=oe;break}r.have=0,r.mode=Z;case Z:for(;r.have<r.nlen+r.ndist;){for(;Re=r.lencode[h&(1<<r.lenbits)-1],ve=Re>>>16&255,ge=65535&Re,!(ce>=(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(16>ge)h>>>=me,ce-=me,r.lens[r.have++]=ge;else{if(16===ge){for(_e=me+2;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(h>>>=me,ce-=me,0===r.have){e.msg="invalid bit length repeat",r.mode=oe;break}Te=r.lens[r.have-1],de=3+(3&h),h>>>=2,ce-=2}else if(17===ge){for(_e=me+3;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}ce-=me,Te=0,de=3+(7&(h>>>=me)),h>>>=3,ce-=3}else{for(_e=me+7;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}ce-=me,Te=0,de=11+(127&(h>>>=me)),h>>>=7,ce-=7}if(r.have+de>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=oe;break}for(;de--;)r.lens[r.have++]=Te}}if(r.mode===oe)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=oe;break}if(r.lenbits=9,we={bits:r.lenbits},be=v(y,r.lens,0,r.nlen,r.lencode,0,r.work,we),r.lenbits=we.bits,be){e.msg="invalid literal/lengths set",r.mode=oe;break}if(r.distbits=6,r.distcode=r.distdyn,we={bits:r.distbits},be=v(E,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,we),r.distbits=we.bits,be){e.msg="invalid distances set",r.mode=oe;break}if(r.mode=Q,t===b)break e;case Q:r.mode=K;case K:if(l>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ce,m(e,he),s=e.next_out,a=e.output,u=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=r.hold,ce=r.bits,r.mode===G&&(r.back=-1);break}for(r.back=0;Re=r.lencode[h&(1<<r.lenbits)-1],ve=Re>>>16&255,ge=65535&Re,!(ce>=(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(ve&&0==(240&ve)){for(ye=me,Ee=ve,xe=ge;Re=r.lencode[xe+((h&(1<<ye+Ee)-1)>>ye)],ve=Re>>>16&255,ge=65535&Re,!(ce>=ye+(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}h>>>=ye,ce-=ye,r.back+=ye}if(h>>>=me,ce-=me,r.back+=me,r.length=ge,0===ve){r.mode=re;break}if(32&ve){r.back=-1,r.mode=G;break}if(64&ve){e.msg="invalid literal/length code",r.mode=oe;break}r.extra=15&ve,r.mode=J;case J:if(r.extra){for(_e=r.extra;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,ce-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=$;case $:for(;Re=r.distcode[h&(1<<r.distbits)-1],ve=Re>>>16&255,ge=65535&Re,!(ce>=(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(0==(240&ve)){for(ye=me,Ee=ve,xe=ge;Re=r.distcode[xe+((h&(1<<ye+Ee)-1)>>ye)],ve=Re>>>16&255,ge=65535&Re,!(ce>=ye+(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}h>>>=ye,ce-=ye,r.back+=ye}if(h>>>=me,ce-=me,r.back+=me,64&ve){e.msg="invalid distance code",r.mode=oe;break}r.offset=ge,r.extra=15&ve,r.mode=ee;case ee:if(r.extra){for(_e=r.extra;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,ce-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=oe;break}r.mode=te;case te:if(0===u)break e;if(de=he-u,r.offset>de){if((de=r.offset-de)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=oe;break}de>r.wnext?(de-=r.wnext,fe=r.wsize-de):fe=r.wnext-de,de>r.length&&(de=r.length),pe=r.window}else pe=a,fe=s-r.offset,de=r.length;de>u&&(de=u),u-=de,r.length-=de;do{a[s++]=pe[fe++]}while(--de);0===r.length&&(r.mode=K);break;case re:if(0===u)break e;a[s++]=r.length,u--,r.mode=K;break;case ne:if(r.wrap){for(;32>ce;){if(0===l)break e;l--,h|=i[o++]<<ce,ce+=8}if(he-=u,e.total_out+=he,r.total+=he,he&&(e.adler=r.check=r.flags?p(r.check,a,he,s-he):f(r.check,a,he,s-he)),he=u,(r.flags?h:n(h))!==r.check){e.msg="incorrect data check",r.mode=oe;break}h=0,ce=0}r.mode=ie;case ie:if(r.wrap&&r.flags){for(;32>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(h!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=oe;break}h=0,ce=0}r.mode=ae;case ae:be=_;break e;case oe:be=S;break e;case se:return A;case le:default:return M}return e.next_out=s,e.avail_out=u,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ce,(r.wsize||he!==e.avail_out&&r.mode<oe&&(r.mode<ne||t!==x))&&function(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new d.Buf8(a.wsize)),n>=a.wsize?(d.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),d.arraySet(a.window,t,r-n,i,a.wnext),(n-=i)?(d.arraySet(a.window,t,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}(e,e.output,e.next_out,he-e.avail_out)?(r.mode=se,A):(ue-=e.avail_in,he-=e.avail_out,e.total_in+=ue,e.total_out+=he,r.total+=he,r.wrap&&he&&(e.adler=r.check=r.flags?p(r.check,a,he,e.next_out-he):f(r.check,a,he,e.next_out-he)),e.data_type=r.bits+(r.last?64:0)+(r.mode===G?128:0)+(r.mode===Q||r.mode===W?256:0),(0===ue&&0===he||t===x)&&be===w&&(be=L),be)},r.inflateEnd=function(e){if(!e||!e.state)return M;var t=e.state;return t.window&&(t.window=null),e.state=null,w},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?M:(r.head=t,t.done=!1,w):M},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t){"use strict";var r=e("../utils/common"),n=15,i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,l,c,u,h,d,f){var p,m,v,g,y,E,x,T,b,w=f.bits,_=0,R=0,M=0,S=0,A=0,L=0,P=0,C=0,H=0,I=0,k=null,N=0,O=new r.Buf16(16),F=new r.Buf16(16),D=null,U=0;for(_=0;n>=_;_++)O[_]=0;for(R=0;c>R;R++)O[t[l+R]]++;for(A=w,S=n;S>=1&&0===O[S];S--);if(A>S&&(A=S),0===S)return u[h++]=20971520,u[h++]=20971520,f.bits=1,0;for(M=1;S>M&&0===O[M];M++);for(M>A&&(A=M),C=1,_=1;n>=_;_++)if(C<<=1,0>(C-=O[_]))return-1;if(C>0&&(0===e||1!==S))return-1;for(F[1]=0,_=1;n>_;_++)F[_+1]=F[_]+O[_];for(R=0;c>R;R++)0!==t[l+R]&&(d[F[t[l+R]]++]=R);if(0===e?(k=D=d,E=19):1===e?(k=i,N-=257,D=a,U-=257,E=256):(k=o,D=s,E=-1),I=0,R=0,_=M,y=h,L=A,P=0,v=-1,g=(H=1<<A)-1,1===e&&H>852||2===e&&H>592)return 1;for(;;){x=_-P,d[R]<E?(T=0,b=d[R]):d[R]>E?(T=D[U+d[R]],b=k[N+d[R]]):(T=96,b=0),p=1<<_-P,M=m=1<<L;do{u[y+(I>>P)+(m-=p)]=x<<24|T<<16|b|0}while(0!==m);for(p=1<<_-1;I&p;)p>>=1;if(0!==p?(I&=p-1,I+=p):I=0,R++,0==--O[_]){if(_===S)break;_=t[l+d[R]]}if(_>A&&(I&g)!==v){for(0===P&&(P=A),y+=M,C=1<<(L=_-P);S>L+P&&!(0>=(C-=O[L+P]));)L++,C<<=1;if(H+=1<<L,1===e&&H>852||2===e&&H>592)return 1;u[v=I&g]=A<<24|L<<16|y-h|0}}return 0!==I&&(u[y+I]=_-P<<24|64<<16|0),f.bits=A,0}},{"../utils/common":27}],37:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,r){"use strict";function n(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e){return 256>e?X[e]:X[256+(e>>>7)]}function a(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function o(e,t,r){e.bi_valid>k-r?(e.bi_buf|=t<<e.bi_valid&65535,a(e,e.bi_buf),e.bi_buf=t>>k-e.bi_valid,e.bi_valid+=r-k):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function s(e,t,r){o(e,r[2*t],r[2*t+1])}function l(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function c(e,t,r){var n,i,a=new Array(I+1),o=0;for(n=1;I>=n;n++)a[n]=o=o+r[n-1]<<1;for(i=0;t>=i;i++){var s=e[2*i+1];0!==s&&(e[2*i]=l(a[s]++,s))}}function u(e){var t;for(t=0;L>t;t++)e.dyn_ltree[2*t]=0;for(t=0;P>t;t++)e.dyn_dtree[2*t]=0;for(t=0;C>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*O]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function h(e){e.bi_valid>8?a(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function d(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function f(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&d(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!d(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function p(e,t,r){var n,a,l,c,u=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],a=e.pending_buf[e.l_buf+u],u++,0===n?s(e,a,t):(l=Y[a],s(e,l+A+1,t),0!==(c=z[l])&&(a-=q[l],o(e,a,c)),l=i(--n),s(e,l,r),0!==(c=B[l])&&(n-=Z[l],o(e,n,c)))}while(u<e.last_lit);s(e,O,t)}function m(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=H,r=0;l>r;r++)0!==a[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=2>u?++u:0,a[2*i]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)f(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],f(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,f(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;I>=a;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;H>r;r++)n=e.heap[r],(a=l[2*l[2*n+1]+1]+1)>p&&(a=p,m++),l[2*n+1]=a,n>c||(e.bl_count[a]++,o=0,n>=f&&(o=d[n-f]),s=l[2*n],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(u[2*n+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>c||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),c(a,u,e.bl_count)}function v(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(r+1)+1]=65535,n=0;r>=n;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(c>s?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*F]++):10>=s?e.bl_tree[2*D]++:e.bl_tree[2*U]++,s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4))}function g(e,t,r){var n,i,a=-1,l=t[1],c=0,u=7,h=4;for(0===l&&(u=138,h=3),n=0;r>=n;n++)if(i=l,l=t[2*(n+1)+1],!(++c<u&&i===l)){if(h>c)do{s(e,i,e.bl_tree)}while(0!=--c);else 0!==i?(i!==a&&(s(e,i,e.bl_tree),c--),s(e,F,e.bl_tree),o(e,c-3,2)):10>=c?(s(e,D,e.bl_tree),o(e,c-3,3)):(s(e,U,e.bl_tree),o(e,c-11,7));c=0,a=i,0===l?(u=138,h=3):i===l?(u=6,h=3):(u=7,h=4)}}function y(e,t,r,n){o(e,(_<<1)+(n?1:0),3),function(e,t,r,n){h(e),n&&(a(e,r),a(e,~r)),E.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}var E=e("../utils/common"),x=4,T=0,b=1,w=2,_=0,R=1,M=2,S=29,A=256,L=A+1+S,P=30,C=19,H=2*L+1,I=15,k=16,N=7,O=256,F=16,D=17,U=18,z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],G=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=new Array(2*(L+2));n(j);var W=new Array(2*P);n(W);var X=new Array(512);n(X);var Y=new Array(256);n(Y);var q=new Array(S);n(q);var Z=new Array(P);n(Z);var Q,K,J,$=function(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length},ee=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},te=!1;r._tr_init=function(e){te||(function(){var e,t,r,n,i,a=new Array(I+1);for(r=0,n=0;S-1>n;n++)for(q[n]=r,e=0;e<1<<z[n];e++)Y[r++]=n;for(Y[r-1]=n,i=0,n=0;16>n;n++)for(Z[n]=i,e=0;e<1<<B[n];e++)X[i++]=n;for(i>>=7;P>n;n++)for(Z[n]=i<<7,e=0;e<1<<B[n]-7;e++)X[256+i++]=n;for(t=0;I>=t;t++)a[t]=0;for(e=0;143>=e;)j[2*e+1]=8,e++,a[8]++;for(;255>=e;)j[2*e+1]=9,e++,a[9]++;for(;279>=e;)j[2*e+1]=7,e++,a[7]++;for(;287>=e;)j[2*e+1]=8,e++,a[8]++;for(c(j,L+1,a),e=0;P>e;e++)W[2*e+1]=5,W[2*e]=l(e,5);Q=new $(j,z,A+1,L,I),K=new $(W,B,0,P,I),J=new $(new Array(0),G,0,C,N)}(),te=!0),e.l_desc=new ee(e.dyn_ltree,Q),e.d_desc=new ee(e.dyn_dtree,K),e.bl_desc=new ee(e.bl_tree,J),e.bi_buf=0,e.bi_valid=0,u(e)},r._tr_stored_block=y,r._tr_flush_block=function(e,t,r,n){var i,a,s=0;e.level>0?(e.strm.data_type===w&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;31>=t;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return T;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return b;for(t=32;A>t;t++)if(0!==e.dyn_ltree[2*t])return b;return T}(e)),m(e,e.l_desc),m(e,e.d_desc),s=function(e){var t;for(v(e,e.dyn_ltree,e.l_desc.max_code),v(e,e.dyn_dtree,e.d_desc.max_code),m(e,e.bl_desc),t=C-1;t>=3&&0===e.bl_tree[2*V[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,i>=a&&(i=a)):i=a=r+5,i>=r+4&&-1!==t?y(e,t,r,n):e.strategy===x||a===i?(o(e,(R<<1)+(n?1:0),3),p(e,j,W)):(o(e,(M<<1)+(n?1:0),3),function(e,t,r,n){var i;for(o(e,t-257,5),o(e,r-1,5),o(e,n-4,4),i=0;n>i;i++)o(e,e.bl_tree[2*V[i]+1],3);g(e,e.dyn_ltree,t-1),g(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),p(e,e.dyn_ltree,e.dyn_dtree)),u(e),n&&h(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Y[r]+A+1)]++,e.dyn_dtree[2*i(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){o(e,R<<1,3),s(e,O,j),function(e){16===e.bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":27}],39:[function(e,t){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[9])(9)}).call(this,r(37).Buffer)},function(e,t,r){
/*! chevrotain - v4.6.0 */
"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=18)}([function(e,t,r){"use strict";function n(e){return e&&0===e.length}function i(e){return null==e?[]:Object.keys(e)}function a(e){for(var t=[],r=Object.keys(e),n=0;n<r.length;n++)t.push(e[r[n]]);return t}function o(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t.call(null,e[r],r);else{if(!v(e))throw Error("non exhaustive match");var n=i(e);for(r=0;r<n.length;r++){var a=n[r],o=e[a];t.call(null,o,a)}}}function s(e){return void 0===e}function l(e,t){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r}function c(e,t){return l(e,function(e){return!t(e)})}function u(e,t){return!!v(e)&&e.hasOwnProperty(t)}function h(e,t){return void 0!==p(e,function(e){return e===t})}function d(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}function f(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}function p(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(t.call(null,n))return n}}function m(e,t,r){for(var n=Array.isArray(e),o=n?e:a(e),s=n?[]:i(e),l=r,c=0;c<o.length;c++)l=t.call(null,l,o[c],n?c:s[c]);return l}function v(e){return e instanceof Object}function g(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++){var a=t[n];if(!s(a))for(var o=i(a),l=0;l<o.length;l++){var c=o[l];u(e,c)||(e[c]=a[c])}}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.isEmpty=n,t.keys=i,t.values=a,t.mapValues=function(e,t){for(var r=[],n=i(e),a=0;a<n.length;a++){var o=n[a];r.push(t.call(null,e[o],o))}return r},t.map=function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(t.call(null,e[n],n));return r},t.flatten=function e(t){for(var r=[],n=0;n<t.length;n++){var i=t[n];Array.isArray(i)?r=r.concat(e(i)):r.push(i)}return r},t.first=function(e){return n(e)?void 0:e[0]},t.last=function(e){var t=e&&e.length;return t?e[t-1]:void 0},t.forEach=o,t.isString=function(e){return"string"==typeof e},t.isUndefined=s,t.isFunction=function(e){return e instanceof Function},t.drop=function(e,t){return void 0===t&&(t=1),e.slice(t,e.length)},t.dropRight=function(e,t){return void 0===t&&(t=1),e.slice(0,e.length-t)},t.filter=l,t.reject=c,t.pick=function(e,t){for(var r=Object.keys(e),n={},i=0;i<r.length;i++){var a=r[i],o=e[a];t(o)&&(n[a]=o)}return n},t.has=u,t.contains=h,t.cloneArr=d,t.cloneObj=f,t.find=p,t.findAll=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r},t.reduce=m,t.compact=function(e){return c(e,function(e){return null==e})},t.uniq=function(e,t){void 0===t&&(t=function(e){return e});var r=[];return m(e,function(e,n){var i=t(n);return h(r,i)?e:(r.push(i),e.concat(n))},[])},t.partial=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=[null].concat(t);return Function.bind.apply(e,n)},t.isArray=function(e){return Array.isArray(e)},t.isRegExp=function(e){return e instanceof RegExp},t.isObject=v,t.every=function(e,t){for(var r=0;r<e.length;r++)if(!t(e[r],r))return!1;return!0},t.difference=function(e,t){return c(e,function(e){return h(t,e)})},t.some=function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return!0;return!1},t.indexOf=function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1},t.sortBy=function(e,t){var r=d(e);return r.sort(function(e,r){return t(e)-t(r)}),r},t.zipObject=function(e,t){if(e.length!==t.length)throw Error("can't zipObject with different number of keys and values!");for(var r={},n=0;n<e.length;n++)r[e[n]]=t[n];return r},t.assign=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++)for(var a=t[n],o=i(a),s=0;s<o.length;s++){var l=o[s];e[l]=a[l]}return e},t.assignNoOverwrite=g,t.defaults=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return g.apply(null,[{}].concat(e))},t.groupBy=function(e,t){var r={};return o(e,function(e){var n=t(e),i=r[n];i?i.push(e):r[n]=[e]}),r},t.merge=function(e,t){for(var r=f(e),n=i(t),a=0;a<n.length;a++){var o=n[a],s=t[o];r[o]=s}return r},t.NOOP=function(){},t.IDENTITY=function(e){return e},t.packArray=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push(void 0!==n?n:void 0)}return t},t.PRINT_ERROR=function(e){console&&console.error&&console.error("Error: "+e)},t.PRINT_WARNING=function(e){console&&console.warn&&console.warn("Warning: "+e)},t.isES2015MapSupported=function(){return"function"==typeof Map},t.applyMixins=function(e,t){t.forEach(function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach(function(n){if("constructor"!==n){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(e.prototype,n,i):e.prototype[n]=t.prototype[n]}})})},t.toFastProperties=function(e){function t(){}t.prototype=e;var r=new t;function n(){return typeof r.bar}return n(),n(),e}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(2),s=function(){function e(e){this.definition=e}return e.prototype.accept=function(e){e.visit(this),a.forEach(this.definition,function(t){t.accept(e)})},e}();t.AbstractProduction=s;var l=function(e){function t(t){var r=e.call(this,[])||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.accept=function(e){e.visit(this)},t}(s);t.NonTerminal=l;var c=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.orgText="",a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Rule=c;var u=function(e){function t(t){var r=e.call(this,t.definition)||this;return a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Flat=u;var h=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Option=h;var d=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.RepetitionMandatory=d;var f=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.RepetitionMandatoryWithSeparator=f;var p=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Repetition=p;var m=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.RepetitionWithSeparator=m;var v=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Alternation=v;var g=function(){function e(e){this.idx=1,a.assign(this,a.pick(e,function(e){return void 0!==e}))}return e.prototype.accept=function(e){e.visit(this)},e}();function y(e){function t(e){return a.map(e,y)}if(e instanceof l)return{type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};if(e instanceof u)return{type:"Flat",definition:t(e.definition)};if(e instanceof h)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof d)return{type:"RepetitionMandatory",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof f)return{type:"RepetitionMandatoryWithSeparator",name:e.name,idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof m)return{type:"RepetitionWithSeparator",name:e.name,idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof p)return{type:"Repetition",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof v)return{type:"Alternation",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof g){var r={type:"Terminal",name:o.tokenName(e.terminalType),label:o.tokenLabel(e.terminalType),idx:e.idx},n=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(r.pattern=a.isRegExp(n)?n.source:n),r}if(e instanceof c)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}t.Terminal=g,t.serializeGrammar=function(e){return a.map(e,y)},t.serializeProduction=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(15),o=r(7);function s(e){return n.isString(e.LABEL)&&""!==e.LABEL}function l(e){return n.isObject(e)&&e.hasOwnProperty("tokenName")&&n.isString(e.tokenName)?e.tokenName:i.functionName(e)}t.tokenLabel=function(e){return s(e)?e.LABEL:l(e)},t.hasTokenLabel=s,t.tokenName=l;var c="parent",u="categories",h="label",d="group",f="push_mode",p="pop_mode",m="longer_alt",v="line_breaks",g="start_chars_hint";function y(e){return function(e){var t=e.name,r=e.pattern,a={};if(i.defineNameProp(a,t)||(a.tokenName=t),n.isUndefined(r)||(a.PATTERN=r),n.has(e,c))throw"The parent property is no longer supported.\nSee: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.";return n.has(e,u)&&(a.CATEGORIES=e[u]),o.augmentTokenTypes([a]),n.has(e,h)&&(a.LABEL=e[h]),n.has(e,d)&&(a.GROUP=e[d]),n.has(e,p)&&(a.POP_MODE=e[p]),n.has(e,f)&&(a.PUSH_MODE=e[f]),n.has(e,m)&&(a.LONGER_ALT=e[m]),n.has(e,v)&&(a.LINE_BREAKS=e[v]),n.has(e,g)&&(a.START_CHARS_HINT=e[g]),a}(e)}t.createToken=y,t.EOF=y({name:"EOF",pattern:a.Lexer.NA}),o.augmentTokenTypes([t.EOF]),t.createTokenInstance=function(e,t,r,n,i,a,o,s){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:a,startColumn:o,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},t.tokenMatcher=function(e,t){return o.tokenStructuredMatcher(e,t)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),o=r(0),s=r(26),l=r(2),c=r(23),u=r(16),h=r(10),d=r(24),f=r(25),p=r(31),m=r(32),v=r(34),g=r(35),y=r(36),E=r(37),x=r(38);t.END_OF_FILE=l.createTokenInstance(l.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(t.END_OF_FILE),t.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:h.defaultParserErrorProvider,serializedGrammar:null}),t.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",e[e.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"}(t.ParserDefinitionErrorType||(t.ParserDefinitionErrorType={})),t.EMPTY_ALT=function(e){return void 0===e&&(e=void 0),function(){return e}};var T=function(){function e(e,r){void 0===r&&(r=t.DEFAULT_PARSER_CONFIG),this.ignoredIssues=t.DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1,this.initErrorHandler(r),this.initLexerAdapter(),this.initLooksAhead(r),this.initRecognizerEngine(e,r),this.initRecoverable(r),this.initTreeBuilder(r),this.initContentAssist(),this.ignoredIssues=o.has(r,"ignoredIssues")?r.ignoredIssues:t.DEFAULT_PARSER_CONFIG.ignoredIssues,o.toFastProperties(this)}return e.performSelfAnalysis=function(e){e.performSelfAnalysis()},e.prototype.performSelfAnalysis=function(){var t,r=this;this.selfAnalysisDone=!0;var n=a.classNameFromInstance(this),i=this.gastProductionsCache;if(this.serializedGrammar){var l=c.deserializeGrammar(this.serializedGrammar,this.tokensMap);o.forEach(l,function(e){r.gastProductionsCache.put(e.name,e)})}var f=d.resolveGrammar({rules:i.values()});if(this.definitionErrors.push.apply(this.definitionErrors,f),o.isEmpty(f)){var p=d.validateGrammar({rules:i.values(),maxLookahead:this.maxLookahead,tokenTypes:o.values(this.tokensMap),ignoredIssues:this.ignoredIssues,errMsgProvider:h.defaultGrammarValidatorErrorProvider,grammarName:n});this.definitionErrors.push.apply(this.definitionErrors,p)}if(o.isEmpty(this.definitionErrors)){var m=s.computeAllProdsFollows(i.values());this.resyncFollows=m}var v=u.analyzeCst(i.values(),this.fullRuleNameToShort);if(this.allRuleNames=v.allRuleNames,!e.DEFER_DEFINITION_ERRORS_HANDLING&&!o.isEmpty(this.definitionErrors))throw t=o.map(this.definitionErrors,function(e){return e.message}),new Error("Parser Definition Errors detected:\n "+t.join("\n-------------------------------\n"))},e.DEFER_DEFINITION_ERRORS_HANDLING=!1,e}();t.Parser=T,o.applyMixins(T,[f.Recoverable,p.LooksAhead,m.TreeBuilder,v.LexerAdapter,y.RecognizerEngine,g.RecognizerApi,E.ErrorHandler,x.ContentAssist]);var b=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!0,e.call(this,r,i)||this}return i(r,e),r}(T);t.CstParser=b;var w=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!1,e.call(this,r,i)||this}return i(r,e),r}(T);t.EmbeddedActionsParser=w},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.classNameFromInstance=function(e){return o(e.constructor)};var i=/^\s*function\s*(\S*)\s*\(/,a="name";function o(e){var t=e.name;return t||e.toString().match(i)[1]}t.functionName=o,t.defineNameProp=function(e,t){var r=Object.getOwnPropertyDescriptor(e,a);return!(!n.isUndefined(r)&&!r.configurable||(Object.defineProperty(e,a,{enumerable:!1,configurable:!0,writable:!1,value:t}),0))};var s=function(){function e(){this._state={}}return e.prototype.keys=function(){return n.keys(this._state)},e.prototype.values=function(){return n.values(this._state)},e.prototype.put=function(e,t){this._state[e]=t},e.prototype.putAll=function(e){this._state=n.assign(this._state,e._state)},e.prototype.get=function(e){return this._state[e]},e.prototype.containsKey=function(e){return n.has(this._state,e)},e.prototype.clear=function(){this._state={}},e}();t.HashTable=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){function e(){}return e.prototype.visit=function(e){if(e instanceof n.NonTerminal)return this.visitNonTerminal(e);if(e instanceof n.Flat)return this.visitFlat(e);if(e instanceof n.Option)return this.visitOption(e);if(e instanceof n.RepetitionMandatory)return this.visitRepetitionMandatory(e);if(e instanceof n.RepetitionMandatoryWithSeparator)return this.visitRepetitionMandatoryWithSeparator(e);if(e instanceof n.RepetitionWithSeparator)return this.visitRepetitionWithSeparator(e);if(e instanceof n.Repetition)return this.visitRepetition(e);if(e instanceof n.Alternation)return this.visitAlternation(e);if(e instanceof n.Terminal)return this.visitTerminal(e);if(e instanceof n.Rule)return this.visitRule(e);throw Error("non exhaustive match")},e.prototype.visitNonTerminal=function(e){},e.prototype.visitFlat=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}();t.GAstVisitor=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i="MismatchedTokenException",a="NoViableAltException",o="EarlyExitException",s="NotAllInputParsedException",l=[i,a,o,s];function c(e,t,r){this.name=i,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function u(e,t,r){this.name=a,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function h(e,t){this.name=s,this.message=e,this.token=t,this.resyncedTokens=[]}function d(e,t,r){this.name=o,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}Object.freeze(l),t.isRecognitionException=function(e){return n.contains(l,e.name)},t.MismatchedTokenException=c,c.prototype=Error.prototype,t.NoViableAltException=u,u.prototype=Error.prototype,t.NotAllInputParsedException=h,h.prototype=Error.prototype,t.EarlyExitException=d,d.prototype=Error.prototype},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(2);function o(e){for(var t=n.cloneArr(e),r=e,i=!0;i;){r=n.compact(n.flatten(n.map(r,function(e){return e.CATEGORIES})));var a=n.difference(r,t);t=t.concat(a),n.isEmpty(a)?i=!1:r=a}return t}function s(e){n.forEach(e,function(e){h(e)||(t.tokenIdxToClass.put(t.tokenShortNameIdx,e),e.tokenTypeIdx=t.tokenShortNameIdx++),d(e)&&!n.isArray(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),d(e)||(e.CATEGORIES=[]),f(e)||(e.categoryMatches=[]),p(e)||(e.categoryMatchesMap={}),m(e)||(e.tokenName=a.tokenName(e))})}function l(e){n.forEach(e,function(e){e.categoryMatches=[],n.forEach(e.categoryMatchesMap,function(r,n){e.categoryMatches.push(t.tokenIdxToClass.get(n).tokenTypeIdx)})})}function c(e){n.forEach(e,function(e){u([],e)})}function u(e,t){n.forEach(e,function(e){t.categoryMatchesMap[e.tokenTypeIdx]=!0}),n.forEach(t.CATEGORIES,function(r){var i=e.concat(t);n.contains(i,r)||u(i,r)})}function h(e){return n.has(e,"tokenTypeIdx")}function d(e){return n.has(e,"CATEGORIES")}function f(e){return n.has(e,"categoryMatches")}function p(e){return n.has(e,"categoryMatchesMap")}function m(e){return n.has(e,"tokenName")}t.tokenStructuredMatcher=function(e,t){var r=e.tokenTypeIdx;return r===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[r]},t.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},t.tokenShortNameIdx=1,t.tokenIdxToClass=new i.HashTable,t.augmentTokenTypes=function(e){var t=o(e);s(t),c(t),l(t),n.forEach(t,function(e){e.isParent=e.categoryMatches.length>0})},t.expandCategories=o,t.assignTokenDefaultProps=s,t.assignCategoriesTokensProp=l,t.assignCategoriesMapProp=c,t.singleAssignCategoriesToksMap=u,t.hasShortKeyProperty=h,t.hasCategoriesProperty=d,t.hasExtendingTokensTypesProperty=f,t.hasExtendingTokensTypesMapProperty=p,t.hasTokenNameProperty=m,t.isTokenType=function(e){return n.has(e,"tokenTypeIdx")}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(1),s=r(5),l=r(2);t.isSequenceProd=function(e){return e instanceof o.Flat||e instanceof o.Option||e instanceof o.Repetition||e instanceof o.RepetitionMandatory||e instanceof o.RepetitionMandatoryWithSeparator||e instanceof o.RepetitionWithSeparator||e instanceof o.Terminal||e instanceof o.Rule},t.isOptionalProd=function e(t,r){return void 0===r&&(r=[]),!!(t instanceof o.Option||t instanceof o.Repetition||t instanceof o.RepetitionWithSeparator)||(t instanceof o.Alternation?a.some(t.definition,function(t){return e(t,r)}):!(t instanceof o.NonTerminal&&a.contains(r,t))&&t instanceof o.AbstractProduction&&(t instanceof o.NonTerminal&&r.push(t),a.every(t.definition,function(t){return e(t,r)})))},t.isBranchingProd=function(e){return e instanceof o.Alternation},t.getProductionDslName=function(e){if(e instanceof o.NonTerminal)return"SUBRULE";if(e instanceof o.Option)return"OPTION";if(e instanceof o.Alternation)return"OR";if(e instanceof o.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof o.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof o.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof o.Repetition)return"MANY";if(e instanceof o.Terminal)return"CONSUME";throw Error("non exhaustive match")};var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return i(t,e),t.prototype.visitTerminal=function(e){var t=l.tokenName(e.terminalType)+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitOption=function(e){this.dslMethods.option.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},t.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},t.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},t}(s.GAstVisitor);t.DslMethodsCollectorVisitor=c},function(e,t,r){"use strict";function n(e,t,r){return r|t|e}Object.defineProperty(t,"__esModule",{value:!0}),t.BITS_FOR_METHOD_IDX=4,t.BITS_FOR_OCCURRENCE_IDX=4,t.BITS_FOR_RULE_IDX=24,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_METHOD_IDX,t.OPTION_IDX=2<<t.BITS_FOR_METHOD_IDX,t.MANY_IDX=3<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_METHOD_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_METHOD_IDX,t.getKeyForAutomaticLookahead=n;var i=32-t.BITS_FOR_ALT_IDX;t.getKeyForAltIndex=function(e,t,r,a){var o=a+1<<i;return n(e,t,r)|o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(0),o=r(1),s=r(8),l=r(11),c=r(17),u=r(3);t.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,r=e.actual;return e.previous,e.ruleName,"Expecting "+(n.hasTokenLabel(t)?"--\x3e "+n.tokenLabel(t)+" <--":"token of type --\x3e "+n.tokenName(t)+" <--")+" but found --\x3e '"+r.image+"' <--"},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;return e.ruleName,"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,r=e.actual,i=(e.previous,e.customUserDescription),o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");if(i)return"Expecting: "+i+o;var s=a.reduce(t,function(e,t){return e.concat(t)},[]),l=a.map(s,function(e){return"["+a.map(e,function(e){return n.tokenLabel(e)}).join(", ")+"]"});return"Expecting: one of these possible Token sequences:\n"+a.map(l,function(e,t){return"  "+(t+1)+". "+e}).join("\n")+o},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,r=e.actual,i=e.customUserDescription,o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");return i?"Expecting: "+i+o:"Expecting: expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+a.map(t,function(e){return"["+a.map(e,function(e){return n.tokenLabel(e)}).join(",")+"]"}).join(" ,")+">"+o}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var r,i=e.name,l=a.first(t),c=l.idx,u=s.getProductionDslName(l),h=(r=l)instanceof o.Terminal?n.tokenName(r.terminalType):r instanceof o.NonTerminal?r.nonTerminalName:"",d="->"+u+"<- with numerical suffix: ->"+c+"<-\n                  "+(h?"and argument: ->"+h+"<-":"")+"\n                  appears more than once ("+t.length+" times) in the top level rule: ->"+i+"<-.\n                  "+(0===c?"Also note that numerical suffix 0 means "+u+" without any suffix.":"")+"\n                  To fix this make sure each usage of "+u+" "+(h?"with the argument: ->"+h+"<-":"")+"\n                  in the rule ->"+i+"<- has a different occurrence index (0-5), as that combination acts as a unique\n                  position key in the grammar, which is needed by the parsing engine.\n                  \n                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ";return d=(d=d.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildInvalidNestedRuleNameError:function(e,t){return"Invalid nested rule name: ->"+t.name+"<- inside rule: ->"+e.name+"<-\nit must match the pattern: ->"+l.validNestedRuleName.toString()+"<-.\nNote that this means a nested rule name must start with the '$'(dollar) sign."},buildDuplicateNestedRuleNameError:function(e,t){return"Duplicate nested rule name: ->"+a.first(t).name+"<- inside rule: ->"+e.name+"<-\nA nested name must be unique in the scope of a top level grammar rule."},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+e.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=a.map(e.prefixPath,function(e){return n.tokenLabel(e)}).join(", "),r=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\nhttps://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=a.map(e.prefixPath,function(e){return n.tokenLabel(e)}).join(", "),r=0===e.alternation.idx?"":e.alternation.idx,i="Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> in <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\n",o=c.VERSION.replace(/\./g,"_");return i=i+"To Resolve this, try one of of the following: \n1. Refactor your grammar to be LL(K) for the current value of k (by default k="+u.DEFAULT_PARSER_CONFIG.maxLookahead+"})\n2. Increase the value of K for your grammar by providing a larger 'maxLookahead' value in the parser's config\n3. This issue can be ignored (if you know what you are doing...), see https://sap.github.io/chevrotain/documentation/"+o+"/interfaces/iparserconfig.html#ignoredissues for more details\n"},buildEmptyRepetitionError:function(e){var t=s.getProductionDslName(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <"+t+"> within Rule <"+e.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(e){return"Invalid Grammar Token name: ->"+n.tokenName(e.tokenType)+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <"+(e.emptyChoiceIdx+1)+"> in <OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n<OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\n has "+(e.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(e){var t=e.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+t+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n "+t+" --\x3e "+i.map(e.leftRecursionPath,function(e){return e.name}).concat([t]).join(" --\x3e ")+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(e){return"Invalid grammar rule name: ->"+e.topLevelRule.name+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildDuplicateRuleNameError:function(e){return"Duplicate definition, rule: ->"+(e.topLevelRule instanceof o.Rule?e.topLevelRule.name:e.topLevelRule)+"<- is already defined in the grammar: ->"+e.grammarName+"<-"}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(0),s=r(3),l=r(8),c=r(2),u=r(12),h=r(16),d=r(13),f=r(1),p=r(5);function m(e){return l.getProductionDslName(e)+"_#_"+e.idx+"_#_"+v(e)}function v(e){return e instanceof f.Terminal?c.tokenName(e.terminalType):e instanceof f.NonTerminal?e.nonTerminalName:""}t.validateGrammar=function(e,t,r,n,i,u){var d=a.map(e,function(e){return function(e,t){var r=new g;e.accept(r);var n=r.allProductions,i=a.groupBy(n,m),o=a.pick(i,function(e){return e.length>1});return a.map(a.values(o),function(r){var n=a.first(r),i=t.buildDuplicateFoundError(e,r),o=l.getProductionDslName(n),c={message:i,type:s.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:o,occurrence:n.idx},u=v(n);return u&&(c.parameter=u),c})}(e,i)}),f=a.map(e,function(e){return b(e,e,i)}),p=[],w=[],_=[];o.every(f,o.isEmpty)&&(p=o.map(e,function(e){return R(e,i)}),w=o.map(e,function(e){return M(e,t,n,i)}),_=L(e,t,i));var S=function(e,t,r){var n=[],i=o.map(t,function(e){return c.tokenName(e)});return o.forEach(e,function(e){var t=e.name;if(o.contains(i,t)){var a=r.buildNamespaceConflictError(e);n.push({message:a,type:s.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}}),n}(e,r,i),P=a.map(r,function(e){return x(e,i)}),C=function(e,t){var r=[];return o.forEach(e,function(e){var n=new h.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.map(n.result,function(e){return e.orgProd});r.push(o.map(i,function(r){return E(e,r,t)}))}),o.flatten(r)}(e,i),H=function(e,t){var r=[];return o.forEach(e,function(e){var n=new h.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.groupBy(n.result,function(e){return e.name}),a=o.pick(i,function(e){return e.length>1});o.forEach(o.values(a),function(n){var i=o.map(n,function(e){return e.orgProd}),a=t.buildDuplicateNestedRuleNameError(e,i);r.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:e.name})})}),r}(e,i),I=o.map(e,function(e){return A(e,i)}),k=o.map(e,function(e){return y(e,i)}),N=o.map(e,function(t){return T(t,e,u,i)});return a.flatten(d.concat(P,C,H,_,f,p,w,S,I,k,N))},t.identifyProductionForDuplicates=m;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},t.prototype.visitOption=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t.prototype.visitAlternation=function(e){this.allProductions.push(e)},t.prototype.visitTerminal=function(e){this.allProductions.push(e)},t}(p.GAstVisitor);function y(e,r){var n=[],i=e.name;return i.match(t.validTermsPattern)||n.push({message:r.buildInvalidRuleNameError({topLevelRule:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:i}),n}function E(e,r,n){var i,a=[];return r.name.match(t.validNestedRuleName)||(i=n.buildInvalidNestedRuleNameError(e,r),a.push({message:i,type:s.ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:e.name})),a}function x(e,r){var n=[];return c.tokenName(e).match(t.validTermsPattern)||n.push({message:r.buildTokenNameError({tokenType:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_TOKEN_NAME}),n}function T(e,t,r,n){var i=[];if(o.reduce(t,function(t,r){return r.name===e.name?t+1:t},0)>1){var a=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function b(e,t,r,n){void 0===n&&(n=[]);var i=[],o=w(t.definition);if(a.isEmpty(o))return[];var l=e.name;a.contains(o,e)&&i.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:s.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:l});var c=a.difference(o,n.concat([e])),u=a.map(c,function(t){var i=a.cloneArr(n);return i.push(t),b(e,t,r,i)});return i.concat(a.flatten(u))}function w(e){var t=[];if(a.isEmpty(e))return t;var r=a.first(e);if(r instanceof f.NonTerminal)t.push(r.referencedRule);else if(r instanceof f.Flat||r instanceof f.Option||r instanceof f.RepetitionMandatory||r instanceof f.RepetitionMandatoryWithSeparator||r instanceof f.RepetitionWithSeparator||r instanceof f.Repetition)t=t.concat(w(r.definition));else if(r instanceof f.Alternation)t=a.flatten(a.map(r.definition,function(e){return w(e.definition)}));else if(!(r instanceof f.Terminal))throw Error("non exhaustive match");var n=l.isOptionalProd(r),i=e.length>1;if(n&&i){var o=a.drop(e);return t.concat(w(o))}return t}t.OccurrenceValidationCollector=g,t.validTermsPattern=/^[a-zA-Z_]\w*$/,t.validNestedRuleName=new RegExp(t.validTermsPattern.source.replace("^","^\\$")),t.validateRuleName=y,t.validateNestedRuleName=E,t.validateTokenName=x,t.validateRuleDoesNotAlreadyExist=T,t.validateRuleIsOverridden=function(e,t,r){var n,i=[];return a.contains(t,e)||(n="Invalid rule override, rule: ->"+e+"<- cannot be overridden in the grammar: ->"+r+"<-as it is not defined in any of the super grammars ",i.push({message:n,type:s.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),i},t.validateNoLeftRecursion=b,t.getFirstNoneTerminal=w;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alternations=[],t}return i(t,e),t.prototype.visitAlternation=function(e){this.alternations.push(e)},t}(p.GAstVisitor);function R(e,t){var r=new _;e.accept(r);var n=r.alternations;return a.reduce(n,function(r,n){var i=a.dropRight(n.definition),o=a.map(i,function(r,i){var o=d.nextPossibleTokensAfter([r],[],null,1);return a.isEmpty(o)?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:n,emptyChoiceIdx:i}),type:s.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:n.idx,alternative:i+1}:null});return r.concat(a.compact(o))},[])}function M(e,t,r,n){var i=new _;e.accept(i);var c=i.alternations,h=r[e.name];return h&&(c=o.reject(c,function(e){return h[l.getProductionDslName(e)+(0===e.idx?"":e.idx)]})),a.reduce(c,function(r,i){var l=i.idx,c=u.getLookaheadPathsForOr(l,e,t),h=function(e,t,r,n){var i=[],l=o.reduce(e,function(t,r,n){return o.forEach(r,function(r){var a=[n];o.forEach(e,function(e,t){n!==t&&u.containsPath(e,r)&&a.push(t)}),a.length>1&&!u.containsPath(i,r)&&(i.push(r),t.push({alts:a,path:r}))}),t},[]);return a.map(l,function(e){var i=o.map(e.alts,function(e){return e+1}),a=n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path});return{message:a,type:s.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:[e.alts]}})}(c,i,e,n),d=P(c,i,e,n);return r.concat(h,d)},[])}t.validateEmptyOrAlternative=R,t.validateAmbiguousAlternationAlternatives=M;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t}(p.GAstVisitor);function A(e,t){var r=new _;e.accept(r);var n=r.alternations;return a.reduce(n,function(r,n){return n.definition.length>255&&r.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:n}),type:s.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:n.idx}),r},[])}function L(e,t,r){var n=[];return o.forEach(e,function(e){var i=new S;e.accept(i);var a=i.allProductions;o.forEach(a,function(i){var a=u.getProdType(i),l=i.idx,c=u.getLookaheadPathsForOptionalProd(l,e,a,t)[0];if(o.isEmpty(o.flatten(c))){var h=r.buildEmptyRepetitionError({topLevelRule:e,repetition:i});n.push({message:h,type:s.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}})}),n}function P(e,t,r,n){var i=[],a=o.reduce(e,function(e,t,r){var n=o.map(t,function(e){return{idx:r,path:e}});return e.concat(n)},[]);return o.forEach(a,function(e){var l=e.idx,c=e.path,h=o.findAll(a,function(e){return e.idx<l&&u.isStrictPrefixOfPath(e.path,c)}),d=o.map(h,function(e){var i=[e.idx+1,l+1],a=0===t.idx?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:s.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:a,alternatives:i}});i=i.concat(d)}),i}t.RepetionCollector=S,t.validateTooManyAlts=A,t.validateSomeNonEmptyLookaheadPath=L,t.checkPrefixAlternativesAmbiguities=P},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=r(0),s=r(13),l=r(14),c=r(7),u=r(1),h=r(5);!function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"}(a=t.PROD_TYPE||(t.PROD_TYPE={})),t.getProdType=function(e){if(e instanceof u.Option)return a.OPTION;if(e instanceof u.Repetition)return a.REPETITION;if(e instanceof u.RepetitionMandatory)return a.REPETITION_MANDATORY;if(e instanceof u.RepetitionMandatoryWithSeparator)return a.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof u.RepetitionWithSeparator)return a.REPETITION_WITH_SEPARATOR;if(e instanceof u.Alternation)return a.ALTERNATION;throw Error("non exhaustive match")},t.buildLookaheadFuncForOr=function(e,t,r,n,i,a){var o=m(e,t,r);return a(o,n,y(o)?c.tokenStructuredMatcherNoCategories:c.tokenStructuredMatcher,i)},t.buildLookaheadFuncForOptionalProd=function(e,t,r,n,i,a){var o=v(e,t,i,r),s=y(o)?c.tokenStructuredMatcherNoCategories:c.tokenStructuredMatcher;return a(o[0],s,n)},t.buildAlternativesLookAheadFunc=function(e,t,r,n){var i=e.length,a=o.every(e,function(e){return o.every(e,function(e){return 1===e.length})});if(t)return function(t){for(var n=o.map(t,function(e){return e.GATE}),a=0;a<i;a++){var s=e[a],l=s.length,c=n[a];if(void 0===c||!1!==c.call(this))e:for(var u=0;u<l;u++){for(var h=s[u],d=h.length,f=0;f<d;f++){var p=this.LA(f+1);if(!1===r(p,h[f]))continue e}return a}}};if(a&&!n){var s=o.map(e,function(e){return o.flatten(e)}),l=o.reduce(s,function(e,t,r){return o.forEach(t,function(t){o.has(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=r),o.forEach(t.categoryMatches,function(t){o.has(e,t)||(e[t]=r)})}),e},[]);return function(){var e=this.LA(1);return l[e.tokenTypeIdx]}}return function(){for(var t=0;t<i;t++){var n=e[t],a=n.length;e:for(var o=0;o<a;o++){for(var s=n[o],l=s.length,c=0;c<l;c++){var u=this.LA(c+1);if(!1===r(u,s[c]))continue e}return t}}}},t.buildSingleAlternativeLookaheadFunction=function(e,t,r){var n=o.every(e,function(e){return 1===e.length}),i=e.length;if(n&&!r){var a=o.flatten(e);if(1===a.length&&o.isEmpty(a[0].categoryMatches)){var s=a[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}var l=o.reduce(a,function(e,t,r){return e[t.tokenTypeIdx]=!0,o.forEach(t.categoryMatches,function(t){e[t]=!0}),e},[]);return function(){var e=this.LA(1);return!0===l[e.tokenTypeIdx]}}return function(){e:for(var r=0;r<i;r++){for(var n=e[r],a=n.length,o=0;o<a;o++){var s=this.LA(o+1);if(!1===t(s,n[o]))continue e}return!0}return!1}};var d=function(e){function t(t,r,n){var i=e.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},t.prototype.checkIsTarget=function(e,t,r,n){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=r.concat(n),!0)},t.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,a.OPTION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,a.REPETITION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t}(l.RestWalker),f=function(e){function t(t,r){var n=e.call(this)||this;return n.targetOccurrence=t,n.targetProdType=r,n.result=[],n}return i(t,e),t.prototype.checkIsTarget=function(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.result=e.definition)},t.prototype.visitOption=function(e){this.checkIsTarget(e,a.OPTION)},t.prototype.visitRepetition=function(e){this.checkIsTarget(e,a.REPETITION)},t.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY_WITH_SEPARATOR)},t.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_WITH_SEPARATOR)},t.prototype.visitAlternation=function(e){this.checkIsTarget(e,a.ALTERNATION)},t}(h.GAstVisitor);function p(e,t){function r(e,t){return o.reduce(e,function(e,r,n){if(n!==t){var i=o.map(r,function(e){return e.partialPath});return e.concat(i)}return e},[])}function n(e,t){return void 0===o.find(e,function(e){return o.every(t,function(t,r){return n=t,i=e[r],n===i||n&&i&&(n.categoryMatchesMap[i.tokenTypeIdx]||i.categoryMatchesMap[n.tokenTypeIdx]);var n,i})})}function i(e){for(var t=[],r=0;r<e;r++)t.push([]);return t}for(var a=o.map(e,function(e){return s.possiblePathsFrom([e],1)}),l=i(a.length),c=a,u=1;u<=t;u++){var h=c;c=i(h.length);for(var d=0;d<h.length;d++)for(var f=h[d],p=r(h,d),m=0;m<f.length;m++){var v=f[m].partialPath,y=f[m].suffixDef;if(n(p,v)||o.isEmpty(y)||v.length===t){var E=l[d];g(E,v)||E.push(v)}else{var x=s.possiblePathsFrom(y,u+1,v);c[d]=c[d].concat(x)}}}return l}function m(e,t,r){var n=new f(e,a.ALTERNATION);return t.accept(n),p(n.result,r)}function v(e,t,r,n){var i=new f(e,r);t.accept(i);var a=i.result,o=new d(t,e,r).startWalking();return p([new u.Flat({definition:a}),new u.Flat({definition:o})],n)}function g(e,t){return void 0!==o.find(e,function(e){return t.length===e.length&&o.every(t,function(t,r){return t===e[r]||e[r].categoryMatchesMap[t.tokenTypeIdx]})})}function y(e){return o.every(e,function(e){return o.every(e,function(e){return o.every(e,function(e){return o.isEmpty(e.categoryMatches)})})})}t.lookAheadSequenceFromAlternatives=p,t.getLookaheadPathsForOr=m,t.getLookaheadPathsForOptionalProd=v,t.containsPath=g,t.isStrictPrefixOfPath=function(e,t){return e.length<t.length&&o.every(e,function(e,r){var n=t[r];return e===n||n.categoryMatchesMap[e.tokenTypeIdx]})},t.areTokenCategoriesNotUsed=y},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(0),s=r(2),l=r(21),c=r(1),u=function(e){function t(t,r){var n=e.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return i(t,e),t.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=o.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=o.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},t.prototype.walk=function(t,r){void 0===r&&(r=[]),this.found||e.prototype.walk.call(this,t,r)},t.prototype.walkProdRef=function(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var n=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,n)}},t.prototype.updateExpectedNext=function(){o.isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},t}(a.RestWalker);t.AbstractNextPossibleTokensWalker=u;var h=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=s.tokenName(n.path.lastTok),n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return i(t,e),t.prototype.walkTerminal=function(e,t,r){if(this.isAtEndOfPath&&s.tokenName(e.terminalType)===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var n=t.concat(r),i=new c.Flat({definition:n});this.possibleTokTypes=l.first(i),this.found=!0}},t}(u);t.NextAfterTokenWalker=h;var d=function(e){function t(t,r){var n=e.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topRule),this.result},t}(a.RestWalker);t.AbstractNextTerminalAfterProductionWalker=d;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkMany.call(this,t,r,n)},t}(d);t.NextTerminalAfterManyWalker=f;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkManySep.call(this,t,r,n)},t}(d);t.NextTerminalAfterManySepWalker=p;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOne.call(this,t,r,n)},t}(d);t.NextTerminalAfterAtLeastOneWalker=m;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,r,n)},t}(d);function g(e,t,r,n){var i=o.cloneArr(r);i.push(e.name);var a=o.cloneArr(n);return a.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:a}}t.NextTerminalAfterAtLeastOneSepWalker=v,t.possiblePathsFrom=function e(t,r,n){void 0===n&&(n=[]),n=o.cloneArr(n);var i=[],a=0;function s(s){var l=e(s.concat(o.drop(t,a+1)),r,n);return i.concat(l)}for(;n.length<r&&a<t.length;){var l=t[a];if(l instanceof c.Flat)return s(l.definition);if(l instanceof c.NonTerminal)return s(l.definition);if(l instanceof c.Option)i=s(l.definition);else{if(l instanceof c.RepetitionMandatory)return s(u=l.definition.concat([new c.Repetition({definition:l.definition})]));if(l instanceof c.RepetitionMandatoryWithSeparator)return s(u=[new c.Flat({definition:l.definition}),new c.Repetition({definition:[new c.Terminal({terminalType:l.separator})].concat(l.definition)})]);if(l instanceof c.RepetitionWithSeparator){var u=l.definition.concat([new c.Repetition({definition:[new c.Terminal({terminalType:l.separator})].concat(l.definition)})]);i=s(u)}else if(l instanceof c.Repetition)u=l.definition.concat([new c.Repetition({definition:l.definition})]),i=s(u);else{if(l instanceof c.Alternation)return o.forEach(l.definition,function(e){i=s(e.definition)}),i;if(!(l instanceof c.Terminal))throw Error("non exhaustive match");n.push(l.terminalType)}}a++}return i.push({partialPath:n,suffixDef:o.drop(t,a)}),i},t.nextPossibleTokensAfter=function(e,t,r,n){var i=["EXIT_NONE_TERMINAL"],a=!1,s=t.length,l=s-n-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!o.isEmpty(h);){var d=h.pop();if("EXIT_ALTERNATIVE"!==d){var f=d.def,p=d.idx,m=d.ruleStack,v=d.occurrenceStack;if(!o.isEmpty(f)){var y=f[0];if("EXIT_NONE_TERMINAL"===y){var E={idx:p,def:o.drop(f),ruleStack:o.dropRight(m),occurrenceStack:o.dropRight(v)};h.push(E)}else if(y instanceof c.Terminal)if(p<s-1){var x=p+1;r(t[x],y.terminalType)&&(E={idx:x,def:o.drop(f),ruleStack:m,occurrenceStack:v},h.push(E))}else{if(p!==s-1)throw Error("non exhaustive match");u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:m,occurrenceStack:v}),a=!0}else if(y instanceof c.NonTerminal){var T=o.cloneArr(m);T.push(y.nonTerminalName);var b=o.cloneArr(v);b.push(y.idx),E={idx:p,def:y.definition.concat(i,o.drop(f)),ruleStack:T,occurrenceStack:b},h.push(E)}else if(y instanceof c.Option){var w={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:v};h.push(w),h.push("EXIT_ALTERNATIVE");var _={idx:p,def:y.definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:v};h.push(_)}else if(y instanceof c.RepetitionMandatory){var R=new c.Repetition({definition:y.definition,idx:y.idx});E={idx:p,def:y.definition.concat([R],o.drop(f)),ruleStack:m,occurrenceStack:v},h.push(E)}else if(y instanceof c.RepetitionMandatoryWithSeparator){var M=new c.Terminal({terminalType:y.separator});R=new c.Repetition({definition:[M].concat(y.definition),idx:y.idx}),E={idx:p,def:y.definition.concat([R],o.drop(f)),ruleStack:m,occurrenceStack:v},h.push(E)}else if(y instanceof c.RepetitionWithSeparator){w={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:v},h.push(w),h.push("EXIT_ALTERNATIVE"),M=new c.Terminal({terminalType:y.separator});var S=new c.Repetition({definition:[M].concat(y.definition),idx:y.idx});_={idx:p,def:y.definition.concat([S],o.drop(f)),ruleStack:m,occurrenceStack:v},h.push(_)}else if(y instanceof c.Repetition)w={idx:p,def:o.drop(f),ruleStack:m,occurrenceStack:v},h.push(w),h.push("EXIT_ALTERNATIVE"),S=new c.Repetition({definition:y.definition,idx:y.idx}),_={idx:p,def:y.definition.concat([S],o.drop(f)),ruleStack:m,occurrenceStack:v},h.push(_);else if(y instanceof c.Alternation)for(var A=y.definition.length-1;A>=0;A--){var L={idx:p,def:y.definition[A].definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:v};h.push(L),h.push("EXIT_ALTERNATIVE")}else if(y instanceof c.Flat)h.push({idx:p,def:y.definition.concat(o.drop(f)),ruleStack:m,occurrenceStack:v});else{if(!(y instanceof c.Rule))throw Error("non exhaustive match");h.push(g(y,p,m,v))}}}else a&&o.last(h).idx<=l&&h.pop()}return u}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=function(){function e(){}return e.prototype.walk=function(e,t){var r=this;void 0===t&&(t=[]),n.forEach(e.definition,function(a,o){var s=n.drop(e.definition,o+1);if(a instanceof i.NonTerminal)r.walkProdRef(a,s,t);else if(a instanceof i.Terminal)r.walkTerminal(a,s,t);else if(a instanceof i.Flat)r.walkFlat(a,s,t);else if(a instanceof i.Option)r.walkOption(a,s,t);else if(a instanceof i.RepetitionMandatory)r.walkAtLeastOne(a,s,t);else if(a instanceof i.RepetitionMandatoryWithSeparator)r.walkAtLeastOneSep(a,s,t);else if(a instanceof i.RepetitionWithSeparator)r.walkManySep(a,s,t);else if(a instanceof i.Repetition)r.walkMany(a,s,t);else{if(!(a instanceof i.Alternation))throw Error("non exhaustive match");r.walkOr(a,s,t)}})},e.prototype.walkTerminal=function(e,t,r){},e.prototype.walkProdRef=function(e,t,r){},e.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkAtLeastOne=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkAtLeastOneSep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkMany=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkManySep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkOr=function(e,t,r){var a=this,o=t.concat(r);n.forEach(e.definition,function(e){var t=new i.Flat({definition:[e]});a.walk(t,o)})},e}();function o(e,t,r){return[new i.Option({definition:[new i.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}t.RestWalker=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(27),i=r(0),a=r(7),o=r(20);!function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"}(t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}));var s={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:o.defaultLexerErrorProvider};Object.freeze(s);var l=function(){function e(e,t){var r=this;if(void 0===t&&(t=s),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"==typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");if(this.config=i.merge(s,t),this.config.lineTerminatorsPattern===s.lineTerminatorsPattern)this.config.lineTerminatorsPattern=n.LineTerminatorOptimizedTester;else if(this.config.lineTerminatorCharacters===s.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking);var o,l=!0;i.isArray(e)?((o={modes:{}}).modes[n.DEFAULT_MODE]=i.cloneArr(e),o[n.DEFAULT_MODE]=n.DEFAULT_MODE):(l=!1,o=i.cloneObj(e)),this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(n.performRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(n.performWarningRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),o.modes=o.modes?o.modes:{},i.forEach(o.modes,function(e,t){o.modes[t]=i.reject(e,function(e){return i.isUndefined(e)})});var c=i.keys(o.modes);if(i.forEach(o.modes,function(e,o){if(r.modes.push(o),r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(n.validatePatterns(e,c)),i.isEmpty(r.lexerDefinitionErrors)){a.augmentTokenTypes(e);var s=n.analyzeTokenTypes(e,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode});r.patternIdxToConfig[o]=s.patternIdxToConfig,r.charCodeToPatternIdxToConfig[o]=s.charCodeToPatternIdxToConfig,r.emptyGroups=i.merge(r.emptyGroups,s.emptyGroups),r.hasCustom=s.hasCustom||r.hasCustom,r.canModeBeOptimized[o]=s.canBeOptimized}}),this.defaultMode=o.defaultMode,!i.isEmpty(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){var u=i.map(this.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+u)}if(i.forEach(this.lexerDefinitionWarning,function(e){i.PRINT_WARNING(e.message)}),n.SUPPORT_STICKY?(this.chopInput=i.IDENTITY,this.match=this.matchWithTest):(this.updateLastIndex=i.NOOP,this.match=this.matchWithExec),l&&(this.handleModes=i.NOOP),!1===this.trackStartLines&&(this.computeNewColumn=i.IDENTITY),!1===this.trackEndLines&&(this.updateTokenEndLineColumnLocation=i.NOOP),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else{if(!/onlyOffset/i.test(this.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+this.config.positionTracking+'"');this.createTokenInstance=this.createOffsetOnlyToken}this.hasCustom?this.addToken=this.addTokenUsingPush:this.addToken=this.addTokenUsingMemberAccess;var h=i.reduce(this.canModeBeOptimized,function(e,t,r){return!1===t&&e.push(r),e},[]);if(t.ensureOptimizations&&!i.isEmpty(h))throw Error("Lexer Modes: < "+h.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')}return e.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),!i.isEmpty(this.lexerDefinitionErrors)){var r=i.map(this.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+r)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,t){var r,a,o,s,l,c,u,h,d,f,p,m,v=this,g=e,y=g.length,E=0,x=0,T=this.hasCustom?0:Math.floor(e.length/10),b=new Array(T),w=[],_=this.trackStartLines?1:void 0,R=this.trackStartLines?1:void 0,M=n.cloneEmptyGroups(this.emptyGroups),S=this.trackStartLines,A=this.config.lineTerminatorsPattern,L=0,P=[],C=[],H=[],I=[];Object.freeze(I);var k,N=void 0,O=function(e){if(1===H.length&&void 0===e.tokenType.PUSH_MODE){var t=v.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);w.push({offset:e.startOffset,line:void 0!==e.startLine?e.startLine:void 0,column:void 0!==e.startColumn?e.startColumn:void 0,length:e.image.length,message:t})}else{H.pop();var r=i.last(H);P=v.patternIdxToConfig[r],C=v.charCodeToPatternIdxToConfig[r],L=P.length;var n=v.canModeBeOptimized[r]&&!1===v.config.safeMode;N=C&&n?function(e){var t=C[e];return void 0===t?I:t}:function(){return P}}};function F(e){H.push(e),C=this.charCodeToPatternIdxToConfig[e],P=this.patternIdxToConfig[e],L=P.length,L=P.length;var t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;N=C&&t?function(e){var t=C[e];return void 0===t?I:t}:function(){return P}}for(F.call(this,t);E<y;){l=null;var D=g.charCodeAt(E),U=N(D),z=U.length;for(r=0;r<z;r++){var B=(k=U[r]).pattern;if(!1!==(K=k.short)?D===K&&(l=B):!0===k.isCustom?l=null!==(m=B.exec(g,E,b,M))?m[0]:m:(this.updateLastIndex(B,E),l=this.match(B,e,E)),null!==l){if(void 0!==(s=k.longerAlt)){var G=P[s],V=G.pattern;!0===G.isCustom?o=null!==(m=V.exec(g,E,b,M))?m[0]:m:(this.updateLastIndex(V,E),o=this.match(V,e,E)),o&&o.length>l.length&&(l=o,k=G)}break}}if(null!==l){if(c=l.length,void 0!==(u=k.group)&&(h=k.tokenTypeIdx,d=this.createTokenInstance(l,E,h,k.tokenType,_,R,c),!1===u?x=this.addToken(b,x,d):M[u].push(d)),e=this.chopInput(e,c),E+=c,R=this.computeNewColumn(R,c),!0===S&&!0===k.canLineTerminator){var j=0,W=void 0,X=void 0;A.lastIndex=0;do{!0===(W=A.test(l))&&(X=A.lastIndex-1,j++)}while(W);0!==j&&(_+=j,R=c-X,this.updateTokenEndLineColumnLocation(d,u,X,j,_,R,c))}this.handleModes(k,O,F,d)}else{for(var Y=E,q=_,Z=R,Q=!1;!Q&&E<y;)for(g.charCodeAt(E),e=this.chopInput(e,1),E++,a=0;a<L;a++){var K,J=P[a];if(B=J.pattern,!1!==(K=J.short)?g.charCodeAt(E)===K&&(Q=!0):!0===J.isCustom?Q=null!==B.exec(g,E,b,M):(this.updateLastIndex(B,E),Q=null!==B.exec(e)),!0===Q)break}f=E-Y,p=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(g,Y,f,q,Z),w.push({offset:Y,line:q,column:Z,length:f,message:p})}}return this.hasCustom||(b.length=x),{tokens:b,groups:M,errors:w}},e.prototype.handleModes=function(e,t,r,n){if(!0===e.pop){var i=e.push;t(n),void 0!==i&&r.call(this,i)}else void 0!==e.push&&r.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,a,o){var s,l;void 0!==t&&(l=(s=r===o-1)?-1:0,1===n&&!0===s||(e.endLine=i+l,e.endColumn=a-1-l))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},e.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},e.prototype.createStartOnlyToken=function(e,t,r,n,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:r,tokenType:n}},e.prototype.createFullToken=function(e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:n}},e.prototype.addToken=function(e,t,r){return 666},e.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},e.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,++t},e.prototype.match=function(e,t,r){return null},e.prototype.matchWithTest=function(e,t,r){return!0===e.test(t)?t.substring(r,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var r=e.exec(t);return null!==r?r[0]:r},e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",e.NA=/NOT_APPLICABLE/,e}();t.Lexer=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(4),s=r(9),l=r(1),c=r(5);t.addTerminalToCst=function(e,t,r){void 0===e.children[r]?e.children[r]=[t]:e.children[r].push(t)},t.addNoneTerminalToCst=function(e,t,r){void 0===e.children[t]?e.children[t]=[r]:e.children[t].push(r)};var u=function(e){function t(t){var r=e.call(this)||this;return r.result=[],r.ruleIdx=t,r}return i(t,e),t.prototype.collectNamedDSLMethod=function(e,t,r){if(!a.isUndefined(e.name)){var n=void 0;if(e instanceof l.Option||e instanceof l.Repetition||e instanceof l.RepetitionMandatory||e instanceof l.Alternation)n=new t({definition:e.definition,idx:e.idx});else{if(!(e instanceof l.RepetitionMandatoryWithSeparator||e instanceof l.RepetitionWithSeparator))throw Error("non exhaustive match");n=new t({definition:e.definition,idx:e.idx,separator:e.separator})}var i=[n],o=s.getKeyForAutomaticLookahead(this.ruleIdx,r,e.idx);this.result.push({def:i,key:o,name:e.name,orgProd:e})}},t.prototype.visitOption=function(e){this.collectNamedDSLMethod(e,l.Option,s.OPTION_IDX)},t.prototype.visitRepetition=function(e){this.collectNamedDSLMethod(e,l.Repetition,s.MANY_IDX)},t.prototype.visitRepetitionMandatory=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatory,s.AT_LEAST_ONE_IDX)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatoryWithSeparator,s.AT_LEAST_ONE_SEP_IDX)},t.prototype.visitRepetitionWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionWithSeparator,s.MANY_SEP_IDX)},t.prototype.visitAlternation=function(e){var t=this;this.collectNamedDSLMethod(e,l.Alternation,s.OR_IDX);var r=e.definition.length>1;a.forEach(e.definition,function(n,i){if(!a.isUndefined(n.name)){var o=n.definition;o=r?[new l.Option({definition:n.definition})]:n.definition;var c=s.getKeyForAltIndex(t.ruleIdx,s.OR_IDX,e.idx,i);t.result.push({def:o,key:c,name:n.name,orgProd:n})}})},t}(c.GAstVisitor);t.NamedDSLMethodsCollectorVisitor=u,t.analyzeCst=function(e,t){var r={dictDef:new o.HashTable,allRuleNames:[]};return a.forEach(e,function(e){var n=t.get(e.name);r.allRuleNames.push(e.name);var i=new u(n);e.accept(i),a.forEach(i.result,function(t){t.def,t.key;var n=t.name;r.allRuleNames.push(e.name+n)})}),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION="4.6.0"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(15),a=r(2),o=r(6),s=r(17),l=r(10),c=r(39),u=r(5),h=r(1),d=r(24),f=r(40),p=r(20),m={};m.VERSION=s.VERSION,m.Parser=n.Parser,m.CstParser=n.CstParser,m.EmbeddedActionsParser=n.EmbeddedActionsParser,m.ParserDefinitionErrorType=n.ParserDefinitionErrorType,m.Lexer=i.Lexer,m.LexerDefinitionErrorType=i.LexerDefinitionErrorType,m.EOF=a.EOF,m.tokenName=a.tokenName,m.tokenLabel=a.tokenLabel,m.tokenMatcher=a.tokenMatcher,m.createToken=a.createToken,m.createTokenInstance=a.createTokenInstance,m.EMPTY_ALT=n.EMPTY_ALT,m.defaultParserErrorProvider=l.defaultParserErrorProvider,m.isRecognitionException=o.isRecognitionException,m.EarlyExitException=o.EarlyExitException,m.MismatchedTokenException=o.MismatchedTokenException,m.NotAllInputParsedException=o.NotAllInputParsedException,m.NoViableAltException=o.NoViableAltException,m.defaultLexerErrorProvider=p.defaultLexerErrorProvider,m.Flat=h.Flat,m.Repetition=h.Repetition,m.RepetitionWithSeparator=h.RepetitionWithSeparator,m.RepetitionMandatory=h.RepetitionMandatory,m.RepetitionMandatoryWithSeparator=h.RepetitionMandatoryWithSeparator,m.Option=h.Option,m.Alternation=h.Alternation,m.NonTerminal=h.NonTerminal,m.Terminal=h.Terminal,m.Rule=h.Rule,m.GAstVisitor=u.GAstVisitor,m.serializeGrammar=h.serializeGrammar,m.serializeProduction=h.serializeProduction,m.resolveGrammar=d.resolveGrammar,m.defaultGrammarResolverErrorProvider=l.defaultGrammarResolverErrorProvider,m.validateGrammar=d.validateGrammar,m.defaultGrammarValidatorErrorProvider=l.defaultGrammarValidatorErrorProvider,m.assignOccurrenceIndices=d.assignOccurrenceIndices,m.clearCache=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")},m.createSyntaxDiagramsCode=c.createSyntaxDiagramsCode,m.generateParserFactory=f.generateParserFactory,m.generateParserModule=f.generateParserModule,e.exports=m},function(e,t,r){var n,i,a;"undefined"!=typeof self&&self,i=[],void 0===(a="function"==typeof(n=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");for(var r={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":s(r,"global");break;case"i":s(r,"ignoreCase");break;case"m":s(r,"multiLine");break;case"u":s(r,"unicode");break;case"y":s(r,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t}},e.prototype.disjunction=function(){var e=[];for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e}},e.prototype.alternative=function(){for(var e=[];this.isTerm();)e.push(this.term());return{type:"Alternative",value:e}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":var e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}l(e);var t=this.disjunction();return this.consumeChar(")"),{type:e,value:t}}!function(){throw Error("Internal Error - Should never get here!")}()},e.prototype.quantifier=function(e){var t;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":var r=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:r,atMost:r};break;case",":var n;this.isDigit()?(n=this.integerIncludingZero(),t={atLeast:r,atMost:n}):t={atLeast:r,atMost:1/0},this.consumeChar("}")}if(!0===e&&void 0===t)return;l(t)}if(!0!==e||void 0!==t)return l(t),"?"===this.peekChar(0)?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t},e.prototype.atom=function(){var e;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}return void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),l(e),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[a("\n"),a("\r"),a("\u2028"),a("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var e=this.positiveInteger();return{type:"GroupBackReference",value:e}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case"d":e=c;break;case"D":e=c,t=!0;break;case"s":e=h;break;case"S":e=h,t=!0;break;case"w":e=u;break;case"W":e=u,t=!0}return l(e),{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=a("\f");break;case"n":e=a("\n");break;case"r":e=a("\r");break;case"t":e=a("\t");break;case"v":e=a("\v")}return l(e),{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");var t=e.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:t}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:a("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var e=this.popChar();return{type:"Character",value:a(e)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var e=this.popChar();return{type:"Character",value:a(e)}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){var r=this.classAtom(),n="Character"===r.type;if(n&&this.isRangeDash()){this.consumeChar("-");var i=this.classAtom(),s="Character"===i.type;if(s){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else o(r.value,e),e.push(a("-")),o(i.value,e)}else o(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:a("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++}var t=this.disjunction();this.consumeChar(")");var r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r},e.prototype.positiveInteger=function(){var e=this.popChar();if(!1===i.test(e))throw Error("Expecting a positive integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(!1===n.test(e))throw Error("Expecting an integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:a(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},e.prototype.isDigit=function(){return n.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(void 0===e&&(e=0),this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(e){return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var t="",n=0;n<e;n++){var i=this.popChar();if(!1===r.test(i))throw Error("Expecting a HexDecimal digits");t+=i}var a=parseInt(t,16);return{type:"Character",value:a}},e.prototype.peekChar=function(e){return void 0===e&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t,r=/[0-9a-fA-F]/,n=/[0-9]/,i=/[1-9]/;function a(e){return e.charCodeAt(0)}function o(e,t){void 0!==e.length?e.forEach(function(e){t.push(e)}):t.push(e)}function s(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t]=!0}function l(e){if(void 0===e)throw Error("Internal Error - Should never get here!")}var c=[];for(t=a("0");t<=a("9");t++)c.push(t);var u=[a("_")].concat(c);for(t=a("a");t<=a("z");t++)u.push(t);for(t=a("A");t<=a("Z");t++)u.push(t);var h=[a(" "),a("\f"),a("\n"),a("\r"),a("\t"),a("\v"),a("\t"),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a("\u2028"),a("\u2029"),a(" "),a(" "),a("　"),a("\ufeff")];function d(){}return d.prototype.visitChildren=function(e){for(var t in e){var r=e[t];e.hasOwnProperty(t)&&(void 0!==r.type?this.visit(r):Array.isArray(r)&&r.forEach(function(e){this.visit(e)},this))}},d.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)},d.prototype.visitPattern=function(e){},d.prototype.visitFlags=function(e){},d.prototype.visitDisjunction=function(e){},d.prototype.visitAlternative=function(e){},d.prototype.visitStartAnchor=function(e){},d.prototype.visitEndAnchor=function(e){},d.prototype.visitWordBoundary=function(e){},d.prototype.visitNonWordBoundary=function(e){},d.prototype.visitLookahead=function(e){},d.prototype.visitNegativeLookahead=function(e){},d.prototype.visitCharacter=function(e){},d.prototype.visitSet=function(e){},d.prototype.visitGroup=function(e){},d.prototype.visitGroupBackReference=function(e){},d.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:d,VERSION:"0.4.0"}})?n.apply(t,i):n)||(e.exports=a)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->"+e.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(e,t,r,n,i){return"unexpected character: ->"+e.charAt(t)+"<- at offset: "+t+", skipped "+r+" characters."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=r(8);function o(e){if(e instanceof i.NonTerminal)return o(e.referencedRule);if(e instanceof i.Terminal)return c(e);if(a.isSequenceProd(e))return s(e);if(a.isBranchingProd(e))return l(e);throw Error("non exhaustive match")}function s(e){for(var t,r=[],i=e.definition,s=0,l=i.length>s,c=!0;l&&c;)t=i[s],c=a.isOptionalProd(t),r=r.concat(o(t)),s+=1,l=i.length>s;return n.uniq(r)}function l(e){var t=n.map(e.definition,function(e){return o(e)});return n.uniq(n.flatten(t))}function c(e){return[e.terminalType]}t.first=o,t.firstForSequence=s,t.firstForBranching=l,t.firstForTerminal=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IN="_~IN~_"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(29),a=r(0),o=r(1);!function(e){e[e.OPTION=0]="OPTION",e[e.OR=1]="OR",e[e.MANY=2]="MANY",e[e.MANY_SEP=3]="MANY_SEP",e[e.AT_LEAST_ONE=4]="AT_LEAST_ONE",e[e.AT_LEAST_ONE_SEP=5]="AT_LEAST_ONE_SEP",e[e.REF=6]="REF",e[e.TERMINAL=7]="TERMINAL",e[e.FLAT=8]="FLAT"}(n=t.ProdType||(t.ProdType={}));var s=/(?:\s*{\s*NAME\s*:\s*["'`]([\w$]*)["'`])?/,l=new RegExp(s.source.replace("{","").replace(")?","\\s*,)?")),c=/\.\s*CONSUME(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,u=new RegExp(c.source,"g"),h=/\.\s*SUBRULE(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,d=new RegExp(h.source,"g"),f=/\.\s*OPTION(\d+)?\s*\(/,p=new RegExp(f.source+s.source),m=new RegExp(f.source,"g"),v=/\.\s*MANY(\d+)?\s*\(/,g=new RegExp(v.source+s.source),y=new RegExp(v.source,"g"),E=/\s*SEP\s*:\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,x=new RegExp(/\.\s*MANY_SEP(\d+)?\s*\(\s*{/.source+l.source+E.source),T=new RegExp(x.source,"g"),b=new RegExp(/\.\s*AT_LEAST_ONE_SEP(\d+)?\s*\(\s*{/.source+l.source+E.source),w=new RegExp(b.source,"g"),_=/\.\s*AT_LEAST_ONE(\d+)?\s*\(/,R=new RegExp(_.source+s.source),M=new RegExp(_.source,"g"),S=/\.\s*OR(\d+)?\s*\(/,A=new RegExp(S.source+s.source),L=new RegExp(S.source,"g"),P=new RegExp(l.source+/\s*(ALT)\s*:/.source),C=new RegExp(P.source,"g");function H(e,r,i){switch(e.type){case n.AT_LEAST_ONE:return function(e,t,r){return I(R,new o.RepetitionMandatory({definition:[]}),e,t,r)}(e,r,i);case n.AT_LEAST_ONE_SEP:return function(e,t,r){return k(e,t,o.RepetitionMandatoryWithSeparator,b,r)}(e,r,i);case n.MANY_SEP:return function(e,t,r){return k(e,t,o.RepetitionWithSeparator,x,r)}(e,r,i);case n.MANY:return function(e,t,r){return I(g,new o.Repetition({definition:[]}),e,t,r)}(e,r,i);case n.OPTION:return function(e,t,r){return I(p,new o.Option({definition:[]}),e,t,r)}(e,r,i);case n.OR:return function(e,t,r){return I(A,new o.Alternation({definition:[]}),e,t,r)}(e,r,i);case n.FLAT:return function(e,t,r){var n=new o.Flat({definition:[]}),i=P.exec(e.text)[1];return a.isUndefined(i)||(n.name=i),N(n,e.range,t,r)}(e,r,i);case n.REF:return function(e){var t=h.exec(e.text),r=void 0===t[1]?0:parseInt(t[1],10),n=t[2];return new o.NonTerminal({nonTerminalName:n,idx:r})}(e);case n.TERMINAL:return function(e,r){var n=c.exec(e.text),i=void 0===n[1]?0:parseInt(n[1],10),a=n[2],s=t.terminalNameToConstructor[a];if(!s)throw Error("Terminal Token name: <"+a+"> not found in rule: <"+r+">  \n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#TERMINAL_NAME_NOT_FOUND\n\tFor Further details.");return new o.Terminal({terminalType:s,idx:i})}(e,i);default:throw Error("non exhaustive match")}}function I(e,t,r,n,i){var o=e.exec(r.text),s=void 0===o[1];t.idx=s?0:parseInt(o[1],10);var l=o[2];return a.isUndefined(l)||(t.name=l),N(t,r.range,n,i)}function k(e,r,n,i,o){var s=i.exec(e.text),l=void 0===s[1]?0:parseInt(s[1],10),c=s[3],u=t.terminalNameToConstructor[c];if(!u)throw Error("Separator Terminal Token name: "+c+" not found");var h=new n({definition:[],separator:u,idx:l}),d=s[2];return a.isUndefined(d)||(h.name=d),N(h,e.range,r,o)}function N(e,t,r,n){var i=O(t,r),o=a.sortBy(i,function(e){return e.range.start}),s=[];return a.forEach(o,function(e){s.push(H(e,r,n))}),e.definition=s,e}function O(e,t){return a.filter(t,function(r){var n=e.strictlyContainsRange(r.range),i=a.every(t,function(t){var n=t.range.strictlyContainsRange(r.range),i=t.range.isStrictlyContainedInRange(e);return!(n&&i)});return n&&i})}t.terminalNameToConstructor={},t.buildTopProduction=function(e,r,n){t.terminalNameToConstructor=n;var a=j(V(B("  "+e)));return function(e,t,r,n){return N(new o.Rule({name:e,definition:[],orgText:n}),t,r,e)}(r,new i.Range(0,e.length+2),a,e)},t.buildProdGast=H,t.getDirectlyContainedRanges=O;var F=/\/\/.*/g,D=/\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\//g,U=/(NAME\s*:\s*)?"([^\\"]|\\([bfnrtv"\\\/]|u[0-9a-fA-F]{4}))*"/g,z=/(NAME\s*:\s*)?'([^\\']|\\([bfnrtv'\\\/]|u[0-9a-fA-F]{4}))*'/g;function B(e){return e.replace(F,"").replace(D,"")}function G(e,t){return void 0!==t?e:""}function V(e){return e.replace(U,G).replace(z,G)}function j(e){var t=W(e),r=X(e),n=Y(e),i=q(e),a=Z(e),o=Q(e),s=K(e),l=J(e);return[].concat(t,r,n,i,a,o,s,l)}function W(e){return re(e,n.TERMINAL,u)}function X(e){return re(e,n.REF,d)}function Y(e){return ne(e,n.AT_LEAST_ONE,M)}function q(e){return ne(e,n.AT_LEAST_ONE_SEP,w)}function Z(e){return ne(e,n.MANY,y)}function Q(e){return ne(e,n.MANY_SEP,T)}function K(e){return ne(e,n.OPTION,m)}function J(e){var t=ne(e,n.OR,L),r=te(t);return t.concat(r)}t.removeComments=B,t.removeStringLiterals=V,t.createRanges=j,t.createTerminalRanges=W,t.createRefsRanges=X,t.createAtLeastOneRanges=Y,t.createAtLeastOneSepRanges=q,t.createManyRanges=Z,t.createManySepRanges=Q,t.createOptionRanges=K,t.createOrRanges=J;var $=a.partial(ae,"{","}"),ee=a.partial(ae,"(",")");function te(e){var t=[];return a.forEach(e,function(e){var r=ie(e.text,n.FLAT,C,$),i=e.range.start;a.forEach(r,function(e){e.range.start+=i,e.range.end+=i}),t=t.concat(r)}),a.uniq(t,function(e){return e.type+"~"+e.range.start+"~"+e.range.end+"~"+e.text})}function re(e,t,r){for(var n,a=[];n=r.exec(e);){var o=n.index,s=r.lastIndex,l=new i.Range(o,s),c=n[0];a.push({range:l,text:c,type:t})}return a}function ne(e,t,r){return ie(e,t,r,ee)}function ie(e,t,r,n){for(var a,o=[];a=r.exec(e);){var s=a.index,l=n(s+a[0].length,e),c=new i.Range(s,l),u=e.substr(s,l-s+1);o.push({range:c,text:u,type:t})}return o}function ae(e,t,r,n){for(var i=[1],o=-1;!a.isEmpty(i)&&o+r<n.length;){o++;var s=n.charAt(r+o);s===e?i.push(1):s===t&&i.pop()}if(a.isEmpty(i))return o+r;throw new Error("INVALID INPUT TEXT, UNTERMINATED PARENTHESIS")}function oe(e,t){return a.map(e,function(e){return se(e,t)})}function se(e,t){switch(e.type){case"NonTerminal":return new o.NonTerminal({nonTerminalName:e.name,idx:e.idx});case"Flat":return new o.Flat({name:e.name,definition:oe(e.definition,t)});case"Option":return new o.Option({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatory":return new o.RepetitionMandatory({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatoryWithSeparator":return new o.RepetitionMandatoryWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"RepetitionWithSeparator":return new o.RepetitionWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"Repetition":return new o.Repetition({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Alternation":return new o.Alternation({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Terminal":return new o.Terminal({terminalType:t[e.name],idx:e.idx});case"Rule":return new o.Rule({name:e.name,orgText:e.orgText,definition:oe(e.definition,t)})}}t.createOrPartRanges=te,t.findClosingOffset=ae,t.deserializeGrammar=oe,t.deserializeProduction=se},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(30),o=r(11),s=r(10),l=r(8);t.resolveGrammar=function(e){e=n.defaults(e,{errMsgProvider:s.defaultGrammarResolverErrorProvider});var t=new i.HashTable;return n.forEach(e.rules,function(e){t.put(e.name,e)}),a.resolveGrammar(t,e.errMsgProvider)},t.validateGrammar=function(e){return e=n.defaults(e,{errMsgProvider:s.defaultGrammarValidatorErrorProvider,ignoredIssues:{}}),o.validateGrammar(e.rules,e.maxLookahead,e.tokenTypes,e.ignoredIssues,e.errMsgProvider,e.grammarName)},t.assignOccurrenceIndices=function(e){n.forEach(e.rules,function(e){var t=new l.DslMethodsCollectorVisitor;e.accept(t),n.forEach(t.dslMethods,function(e){n.forEach(e,function(e,t){e.idx=t+1})})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(6),o=r(22),s=r(4),l=r(3);function c(e){this.name=t.IN_RULE_RECOVERY_EXCEPTION,this.message=e}t.EOF_FOLLOW_KEY={},t.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",t.InRuleRecoveryException=c,c.prototype=Error.prototype;var u=function(){function e(){}return e.prototype.initRecoverable=function(e){this.firstAfterRepMap=new s.HashTable,this.resyncFollows=new s.HashTable,this.recoveryEnabled=i.has(e,"recoveryEnabled")?e.recoveryEnabled:l.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=h)},e.prototype.getTokenToInsert=function(e){var t=n.createTokenInstance(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},e.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},e.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var o=this,s=this.findReSyncTokenType(),l=this.exportLexerState(),c=[],u=!1,h=this.LA(1),d=this.LA(1),f=function(){var e=o.LA(0),t=o.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:h,previous:e,ruleName:o.getCurrRuleFullName()}),r=new a.MismatchedTokenException(t,h,o.LA(0));r.resyncedTokens=i.dropRight(c),o.SAVE_ERROR(r)};!u;){if(this.tokenMatcher(d,n))return void f();if(r.call(this))return f(),void e.apply(this,t);this.tokenMatcher(d,s)?u=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,c))}this.importLexerState(l)},e.prototype.shouldInRepetitionRecoveryBeTried=function(e,t){return void 0!==e&&void 0!==t&&!this.tokenMatcher(this.LA(1),e)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t))},e.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)},e.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new c("sad sad panda")},e.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},e.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e))return!1;if(i.isEmpty(t))return!1;var n=this.LA(1);return void 0!==i.find(t,function(e){return r.tokenMatcher(n,e)})},e.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},e.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return i.contains(r,e)},e.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if(i.contains(e,n))return n;t=this.LA(r),r++}},e.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return t.EOF_FOLLOW_KEY;var e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}},e.prototype.buildFullFollowKeyStack=function(){var e=this,r=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(r=i.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.RULE_STACK[t]}),n=i.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.RULE_OCCURRENCE_STACK[t]})),i.map(r,function(i,a){return 0===a?t.EOF_FOLLOW_KEY:{ruleName:e.shortRuleNameToFullName(i),idxInCallingRule:n[a],inRule:e.shortRuleNameToFullName(r[a-1])}})},e.prototype.flattenFollowSet=function(){var e=this,t=i.map(this.buildFullFollowKeyStack(),function(t){return e.getFollowSetFromFollowKey(t)});return i.flatten(t)},e.prototype.getFollowSetFromFollowKey=function(e){if(e===t.EOF_FOLLOW_KEY)return[n.EOF];var r=e.ruleName+e.idxInCallingRule+o.IN+e.inRule;return this.resyncFollows.get(r)},e.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,n.EOF)||t.push(e),t},e.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);!1===this.tokenMatcher(r,e);)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return i.dropRight(t)},e.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,a){},e.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},e.prototype.getHumanReadableRuleStack=function(){var e=this;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)?i.map(this.RULE_STACK,function(t){return e.shortRuleNameToFullName(t)}):i.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])})},e}();function h(e,t,r,i,a,o){var s=this.getKeyForAutomaticLookahead(i,a),l=this.firstAfterRepMap.get(s);if(void 0===l){var c=this.getCurrRuleFullName();l=new o(this.getGAstProductions().get(c),a).startWalking(),this.firstAfterRepMap.put(s,l)}var u=l.token,h=l.occurrence,d=l.isEndOfRule;1===this.RULE_STACK.length&&d&&void 0===u&&(u=n.EOF,h=1),this.shouldInRepetitionRecoveryBeTried(u,h)&&this.tryInRepetitionRecovery(e,t,r,u)}t.Recoverable=u,t.attemptInRepetitionRecovery=h},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(4),s=r(21),l=r(0),c=r(22),u=r(2),h=r(1),d=function(e){function t(t){var r=e.call(this)||this;return r.topProd=t,r.follows=new o.HashTable,r}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},t.prototype.walkTerminal=function(e,t,r){},t.prototype.walkProdRef=function(e,t,r){var n=f(e.referencedRule,e.idx)+this.topProd.name,i=t.concat(r),a=new h.Flat({definition:i}),o=s.first(a);this.follows.put(n,o)},t}(a.RestWalker);function f(e,t){return e.name+t+c.IN}t.ResyncFollowsWalker=d,t.computeAllProdsFollows=function(e){var t=new o.HashTable;return l.forEach(e,function(e){var r=new d(e).startWalking();t.putAll(r)}),t},t.buildBetweenProdsFollowPrefix=f,t.buildInProdFollowPrefix=function(e){return u.tokenName(e.terminalType)+e.idx+c.IN}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(2),s=r(15),l=r(0),c=r(28),u=new a.RegExpParser,h="PATTERN";function d(e){var t=l.filter(e,function(e){return!l.has(e,h)});return{errors:l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- missing static 'PATTERN' property",type:s.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}}),valid:l.difference(e,t)}}function f(e){var t=l.filter(e,function(e){var t=e[h];return!(l.isRegExp(t)||l.isFunction(t)||l.has(t,"exec")||l.isString(t))});return{errors:l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:s.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}}),valid:l.difference(e,t)}}t.DEFAULT_MODE="defaultMode",t.MODES="modes",t.SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky,t.disableSticky=function(){t.SUPPORT_STICKY=!1},t.enableSticky=function(){t.SUPPORT_STICKY=!0},t.analyzeTokenTypes=function(e,r){r=l.defaults(r,{useSticky:t.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"]});var n=l.reject(e,function(e){return e[h]===s.Lexer.NA}),i=!1,a=l.map(n,function(e){var t=e[h];if(l.isRegExp(t)){var n=t.source;return 1===n.length&&"^"!==n&&"$"!==n&&"."!==n?n:2!==n.length||"\\"!==n[0]||l.contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],n[1])?r.useSticky?R(t):_(t):n[1]}if(l.isFunction(t))return i=!0,{exec:t};if(l.has(t,"exec"))return i=!0,t;if("string"==typeof t){if(1===t.length)return t;var a=t.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),o=new RegExp(a);return r.useSticky?R(o):_(o)}throw Error("non exhaustive match")}),u=l.map(n,function(e){return e.tokenTypeIdx}),d=l.map(n,function(e){var t=e.GROUP;if(t!==s.Lexer.SKIPPED){if(l.isString(t))return t;if(l.isUndefined(t))return!1;throw Error("non exhaustive match")}}),f=l.map(n,function(e){var t=e.LONGER_ALT;if(t)return l.indexOf(n,t)}),p=l.map(n,function(e){return e.PUSH_MODE}),m=l.map(n,function(e){return l.has(e,"POP_MODE")}),v=P(r.lineTerminatorCharacters),g=l.map(n,function(e){return!1});"onlyOffset"!==r.positionTracking&&(g=l.map(n,function(e){return l.has(e,"LINE_BREAKS")?e.LINE_BREAKS:!1===A(e,v)?c.canMatchCharCode(v,e.PATTERN):void 0}));var y=l.map(n,M),E=l.map(a,S),x=l.reduce(n,function(e,t){var r=t.GROUP;return l.isString(r)&&r!==s.Lexer.SKIPPED&&(e[r]=[]),e},{}),T=l.map(a,function(e,t){return{pattern:a[t],longerAlt:f[t],canLineTerminator:g[t],isCustom:y[t],short:E[t],group:d[t],push:p[t],pop:m[t],tokenTypeIdx:u[t],tokenType:n[t]}});function b(e,t,r){void 0===e[t]&&(e[t]=[]),e[t].push(r)}var w=!0,L=[];return r.safeMode||(L=l.reduce(n,function(e,t,n){if("string"==typeof t.PATTERN){var i=t.PATTERN.charCodeAt(0);b(e,i,T[n])}else if(l.isArray(t.START_CHARS_HINT))l.forEach(t.START_CHARS_HINT,function(t){var r="string"==typeof t?t.charCodeAt(0):t;b(e,r,T[n])});else if(l.isRegExp(t.PATTERN))if(t.PATTERN.unicode)w=!1,r.ensureOptimizations&&l.PRINT_ERROR(c.failedOptimizationPrefixMsg+"\tUnable to analyze < "+t.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var a=c.getStartCodes(t.PATTERN,r.ensureOptimizations);l.isEmpty(a)&&(w=!1),l.forEach(a,function(t){b(e,t,T[n])})}else r.ensureOptimizations&&l.PRINT_ERROR(c.failedOptimizationPrefixMsg+"\tTokenType: <"+o.tokenName(t)+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),w=!1;return e},[])),w&&L.length<65536&&(L=l.packArray(L)),{emptyGroups:x,patternIdxToConfig:T,charCodeToPatternIdxToConfig:L,hasCustom:i,canBeOptimized:w}},t.validatePatterns=function(e,t){var r=[],n=d(e);r=r.concat(n.errors);var i=f(n.valid),a=i.valid;return r=(r=(r=(r=(r=r.concat(i.errors)).concat(function(e){var t=[],r=l.filter(e,function(e){return l.isRegExp(e[h])});return t=(t=(t=(t=(t=t.concat(m(r))).concat(y(r))).concat(E(r))).concat(x(r))).concat(v(r))}(a))).concat(T(a))).concat(b(a,t))).concat(w(a))},t.findMissingPatterns=d,t.findInvalidPatterns=f;var p=/[^\\][\$]/;function m(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitEndAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=l.filter(e,function(e){var r=e[h];try{var n=u.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return p.test(r.source)}});return l.map(r,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}})}function v(e){var t=l.filter(e,function(e){return e[h].test("")});return l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' must not match an empty string",type:s.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}})}t.findEndOfInputAnchor=m,t.findEmptyMatchRegExps=v;var g=/[^\\[][\^]|^\^/;function y(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitStartAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=l.filter(e,function(e){var r=e[h];try{var n=u.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return g.test(r.source)}});return l.map(r,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}})}function E(e){var t=l.filter(e,function(e){var t=e[h];return t instanceof RegExp&&(t.multiline||t.global)});return l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:s.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}})}function x(e){var t=[],r=l.map(e,function(r){return l.reduce(e,function(e,n){return r.PATTERN.source!==n.PATTERN.source||l.contains(t,n)||n.PATTERN===s.Lexer.NA?e:(t.push(n),e.push(n),e)},[])});r=l.compact(r);var n=l.filter(r,function(e){return e.length>1});return l.map(n,function(e){var t=l.map(e,function(e){return o.tokenName(e)});return{message:"The same RegExp pattern ->"+l.first(e).PATTERN+"<-has been used in all of the following Token Types: "+t.join(", ")+" <-",type:s.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}})}function T(e){var t=l.filter(e,function(e){if(!l.has(e,"GROUP"))return!1;var t=e.GROUP;return t!==s.Lexer.SKIPPED&&t!==s.Lexer.NA&&!l.isString(t)});return l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:s.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}})}function b(e,t){var r=l.filter(e,function(e){return void 0!==e.PUSH_MODE&&!l.contains(t,e.PUSH_MODE)});return l.map(r,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+e.PUSH_MODE+"<-which does not exist",type:s.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}})}function w(e){var t=[],r=l.reduce(e,function(e,t,r){var n,i=t.PATTERN;return i===s.Lexer.NA?e:(l.isString(i)?e.push({str:i,idx:r,tokenType:t}):l.isRegExp(i)&&(n=i,void 0===l.find([".","\\","[","]","|","^","$","(",")","?","*","+","{"],function(e){return-1!==n.source.indexOf(e)}))&&e.push({str:i.source,idx:r,tokenType:t}),e)},[]);return l.forEach(e,function(e,n){l.forEach(r,function(r){var i=r.str,a=r.idx,c=r.tokenType;if(n<a&&function(e,t){if(l.isRegExp(t)){var r=t.exec(e);return null!==r&&0===r.index}if(l.isFunction(t))return t(e,0,[],{});if(l.has(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}(i,e.PATTERN)){var u="Token: ->"+o.tokenName(c)+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+o.tokenName(e)+"<-in the lexer's definition.\nSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE";t.push({message:u,type:s.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,c]})}})}),t}function _(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:"+e.source+")",t)}function R(e){var t=e.ignoreCase?"iy":"y";return new RegExp(""+e.source,t)}function M(e){var t=e.PATTERN;if(l.isRegExp(t))return!1;if(l.isFunction(t))return!0;if(l.has(t,"exec"))return!0;if(l.isString(t))return!1;throw Error("non exhaustive match")}function S(e){return!(!l.isString(e)||1!==e.length)&&e.charCodeAt(0)}function A(e,t){if(l.has(e,"LINE_BREAKS"))return!1;if(l.isRegExp(e.PATTERN)){try{c.canMatchCharCode(t,e.PATTERN)}catch(e){return{issue:s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}if(l.isString(e.PATTERN))return!1;if(M(e))return{issue:s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function L(e,t){if(t.issue===s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+e.name+"> Token Type\n\t Root cause: "+t.errMsg+".\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+e.name+"> Token Type\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function P(e){return l.map(e,function(e){return l.isString(e)&&e.length>0?e.charCodeAt(0):e})}t.findStartOfInputAnchor=y,t.findUnsupportedFlags=E,t.findDuplicatePatterns=x,t.findInvalidGroupType=T,t.findModesThatDoNotExist=b,t.findUnreachablePatterns=w,t.addStartOfInput=_,t.addStickyFlag=R,t.performRuntimeChecks=function(e,r,n){var i=[];return l.has(e,t.DEFAULT_MODE)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.DEFAULT_MODE+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),l.has(e,t.MODES)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.MODES+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),l.has(e,t.MODES)&&l.has(e,t.DEFAULT_MODE)&&!l.has(e.modes,e.defaultMode)&&i.push({message:"A MultiMode Lexer cannot be initialized with a "+t.DEFAULT_MODE+": <"+e.defaultMode+">which does not exist\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),l.has(e,t.MODES)&&l.forEach(e.modes,function(e,t){l.forEach(e,function(e,r){l.isUndefined(e)&&i.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+t+"> at index: <"+r+">\n",type:s.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),i},t.performWarningRuntimeChecks=function(e,t,r){var n=[],i=!1,a=l.compact(l.flatten(l.mapValues(e.modes,function(e){return e}))),o=l.reject(a,function(e){return e[h]===s.Lexer.NA}),u=P(r);return t&&l.forEach(o,function(e){var t=A(e,u);if(!1!==t){var r={message:L(e,t),type:t.issue,tokenType:e};n.push(r)}else l.has(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(i=!0):c.canMatchCharCode(u,e.PATTERN)&&(i=!0)}),t&&!i&&n.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:s.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),n},t.cloneEmptyGroups=function(e){var t={},r=l.keys(e);return l.forEach(r,function(r){var n=e[r];if(!l.isArray(n))throw Error("non exhaustive match");t[r]=[]}),t},t.isCustomPattern=M,t.isShortPattern=S,t.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,r=this.lastIndex;r<t;r++){var n=e.charCodeAt(r);if(10===n)return this.lastIndex=r+1,!0;if(13===n)return 10===e.charCodeAt(r+1)?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0},t.buildLineBreakIssueMessage=L},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(0),s=new a.RegExpParser,l="Complement Sets are not supported for first char optimization";function c(e){switch(e.type){case"Disjunction":return o.flatten(o.map(e.value,c));case"Alternative":for(var t=[],r=e.value,n=0;n<r.length;n++){var i=r[n];if(!o.contains(["GroupBackReference","Lookahead","NegativeLookahead","StartAnchor","EndAnchor","WordBoundary","NonWordBoundary"],i.type)){var a=i;switch(a.type){case"Character":t.push(a.value);break;case"Set":if(!0===a.complement)throw Error(l);o.forEach(a.value,function(e){if("number"==typeof e)t.push(e);else for(var r=e,n=r.from;n<=r.to;n++)t.push(n)});break;case"Group":var s=c(a.value);o.forEach(s,function(e){return t.push(e)});break;default:throw Error("Non Exhaustive Match")}var u=void 0!==a.quantifier&&0===a.quantifier.atLeast;if("Group"===a.type&&!1===d(a)||"Group"!==a.type&&!1===u)break}}return t;default:throw Error("non exhaustive match!")}}function u(e){var t=[];return o.forEach(e,function(e){t.push(e);var r=String.fromCharCode(e);r.toUpperCase()!==r?t.push(r.toUpperCase().charCodeAt(0)):r.toLowerCase()!==r&&t.push(r.toLowerCase().charCodeAt(0))}),t}function h(e,t){return o.find(e.value,function(e){if("number"==typeof e)return o.contains(t,e);var r=e;return void 0!==o.find(t,function(e){return r.from<=e&&e<=r.to})})}function d(e){return!(!e.quantifier||0!==e.quantifier.atLeast)||!!e.value&&(o.isArray(e.value)?o.every(e.value,d):d(e.value))}t.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',t.getStartCodes=function(e,r){void 0===r&&(r=!1);try{var n=s.pattern(e.toString()),i=c(n.value);return n.flags.ignoreCase&&(i=u(i)),i}catch(n){if(n.message===l)r&&o.PRINT_WARNING(t.failedOptimizationPrefixMsg+"\tUnable to optimize: < "+e.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var h="";r&&(h="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),o.PRINT_ERROR(t.failedOptimizationPrefixMsg+"\n\tFailed parsing: < "+e.toString()+" >\n\tUsing the regexp-to-ast library version: "+a.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+h)}}return[]},t.firstChar=c,t.applyIgnoreCase=u;var f=function(e){function t(t){var r=e.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return i(t,e),t.prototype.visitChildren=function(t){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}e.prototype.visitChildren.call(this,t)},t.prototype.visitCharacter=function(e){o.contains(this.targetCharCodes,e.value)&&(this.found=!0)},t.prototype.visitSet=function(e){e.complement?void 0===h(e,this.targetCharCodes)&&(this.found=!0):void 0!==h(e,this.targetCharCodes)&&(this.found=!0)},t}(a.BaseRegExpVisitor);t.canMatchCharCode=function(e,t){if(t instanceof RegExp){var r=s.pattern(t.toString()),n=new f(e);return n.visit(r),n.found}return void 0!==o.find(t,function(t){return o.contains(e,t.charCodeAt(0))})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){if(this.start=e,this.end=t,!i(e,t))throw new Error("INVALID RANGE")}return e.prototype.contains=function(e){return this.start<=e&&this.end>=e},e.prototype.containsRange=function(e){return this.start<=e.start&&this.end>=e.end},e.prototype.isContainedInRange=function(e){return e.containsRange(this)},e.prototype.strictlyContainsRange=function(e){return this.start<e.start&&this.end>e.end},e.prototype.isStrictlyContainedInRange=function(e){return e.strictlyContainsRange(this)},e}();function i(e,t){return!(e<0||t<e)}t.Range=n,t.isValidRange=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(3),o=r(0),s=r(5);t.resolveGrammar=function(e,t){var r=new l(e,t);return r.resolveRefs(),r.errors};var l=function(e){function t(t,r){var n=e.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return i(t,e),t.prototype.resolveRefs=function(){var e=this;o.forEach(this.nameToTopRule.values(),function(t){e.currTopLevel=t,t.accept(e)})},t.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule.get(e.nonTerminalName);if(t)e.referencedRule=t;else{var r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:a.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},t}(s.GAstVisitor);t.GastRefResolverVisitor=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(0),a=r(3),o=r(9),s=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=i.has(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:a.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=i.has(e,"maxLookahead")?e.maxLookahead:a.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=i.isES2015MapSupported()?new Map:[],i.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.lookAheadBuilderForOptional=function(e,t,r){return n.buildSingleAlternativeLookaheadFunction(e,t,r)},e.prototype.lookAheadBuilderForAlternatives=function(e,t,r,i){return n.buildAlternativesLookAheadFunc(e,t,r,i)},e.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return o.getKeyForAutomaticLookahead(r,e,t)},e.prototype.getLookaheadFuncForOr=function(e,t){var r=this.getKeyForAutomaticLookahead(o.OR_IDX,e),a=this.getLaFuncFromCache(r);if(void 0===a){var s=this.getCurrRuleFullName(),l=this.getGAstProductions().get(s),c=i.some(t,function(e){return i.isFunction(e.GATE)});return a=n.buildLookaheadFuncForOr(e,l,this.maxLookahead,c,this.dynamicTokensEnabled,this.lookAheadBuilderForAlternatives),this.setLaFuncCache(r,a),a}return a},e.prototype.getLookaheadFuncForOption=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.OPTION)},e.prototype.getLookaheadFuncForMany=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION)},e.prototype.getLookaheadFuncForManySep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_WITH_SEPARATOR)},e.prototype.getLookaheadFuncForAtLeastOne=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY)},e.prototype.getLookaheadFuncForAtLeastOneSep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.getLookaheadFuncFor=function(e,t,r,i){var a=this.getLaFuncFromCache(e);if(void 0===a){var o=this.getCurrRuleFullName(),s=this.getGAstProductions().get(o);return a=n.buildLookaheadFuncForOptionalProd(t,s,r,this.dynamicTokensEnabled,i,this.lookAheadBuilderForOptional),this.setLaFuncCache(e,a),a}return a},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}();t.LooksAhead=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(16),i=r(0),a=r(33),o=r(9),s=r(3),l=function(){function e(){}return e.prototype.initTreeBuilder=function(e){this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=i.has(e,"outputCst")?e.outputCst:s.DEFAULT_PARSER_CONFIG.outputCst,this.outputCst||(this.cstInvocationStateUpdate=i.NOOP,this.cstFinallyStateUpdate=i.NOOP,this.cstPostTerminal=i.NOOP,this.cstPostNonTerminal=i.NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst)},e.prototype.cstNestedInvocationStateUpdate=function(e,t){this.CST_STACK.push({name:e,fullName:this.shortRuleNameToFull.get(this.getLastExplicitRuleShortName())+e,children:{}})},e.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1),this.CST_STACK.push({name:e,children:{}})},e.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},e.prototype.cstNestedFinallyStateUpdate=function(){this.CST_STACK.pop()},e.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];n.addTerminalToCst(r,t,e)},e.prototype.cstPostNonTerminal=function(e,t){n.addNoneTerminalToCst(this.CST_STACK[this.CST_STACK.length-1],t,e)},e.prototype.getBaseCstVisitorConstructor=function(){if(i.isUndefined(this.baseCstVisitorConstructor)){var e=a.createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(i.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var e=a.createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.nestedRuleBeforeClause=function(e,t){var r;return void 0!==e.NAME?(r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r):void 0},e.prototype.nestedAltBeforeClause=function(e,t,r,n){var i,a=this.getLastExplicitRuleShortName(),s=o.getKeyForAltIndex(a,r,t,n);return void 0!==e.NAME?(i=e.NAME,this.nestedRuleInvocationStateUpdate(i,s),{shortName:s,nestedName:i}):void 0},e.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,i=r[r.length-1];this.nestedRuleFinallyStateUpdate();var a=r[r.length-1];n.addNoneTerminalToCst(a,t,i)},e.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},e.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},e.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},e.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},e.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},e}();t.TreeBuilder=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(0),a=r(4),o=r(11);function s(e,t){for(var r=i.keys(e),n=r.length,a=0;a<n;a++)for(var o=e[r[a]],s=o.length,l=0;l<s;l++){var c=o[l];void 0===c.tokenTypeIdx&&(void 0!==c.fullName?this[c.fullName](c.children,t):this[c.name](c.children,t))}}function l(e,t){var r=c(e,t),n=h(e,t);return r.concat(n)}function c(e,t){var r=i.map(t,function(t){if(!i.isFunction(e[t]))return{msg:"Missing visitor method: <"+t+"> on "+a.functionName(e.constructor)+" CST Visitor.",type:n.MISSING_METHOD,methodName:t}});return i.compact(r)}t.defaultVisit=s,t.createBaseSemanticVisitorConstructor=function(e,t){var r=function(){};return a.defineNameProp(r,e+"BaseSemantics"),(r.prototype={visit:function(e,t){if(i.isArray(e)&&(e=e[0]),!i.isUndefined(e))return void 0!==e.fullName?this[e.fullName](e.children,t):this[e.name](e.children,t)},validateVisitor:function(){var e=l(this,t);if(!i.isEmpty(e)){var r=i.map(e,function(e){return e.msg});throw Error("Errors Detected in CST Visitor <"+a.functionName(this.constructor)+">:\n\t"+r.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=r,r._RULE_NAMES=t,r},t.createBaseVisitorConstructorWithDefaults=function(e,t,r){var n=function(){};a.defineNameProp(n,e+"BaseSemanticsWithDefaults");var o=Object.create(r.prototype);return i.forEach(t,function(e){o[e]=s}),(n.prototype=o).constructor=n,n},function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"}(n=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={})),t.validateVisitor=l,t.validateMissingCstMethods=c;var u=["constructor","visit","validateVisitor"];function h(e,t){var r=[];for(var s in e)o.validTermsPattern.test(s)&&i.isFunction(e[s])&&!i.contains(u,s)&&!i.contains(t,s)&&r.push({msg:"Redundant visitor method: <"+s+"> on "+a.functionName(e.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\nFor utility methods on visitor classes use methods names that do not match /"+o.validTermsPattern.source+"/.",type:n.REDUNDANT_METHOD,methodName:s});return r}t.validateRedundantMethods=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,"input",{get:function(){return this.tokVector},set:function(e){this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):n.END_OF_FILE},e.prototype.LA=function(e){return this.currIdx+e<0||this.tokVectorLength<=this.currIdx+e?n.END_OF_FILE:this.tokVector[this.currIdx+e]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}();t.LexerAdapter=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(6),a=r(3),o=r(10),s=r(23),l=r(11),c=r(1),u=function(){function e(){}return e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,t,r){if(void 0===r&&(r=a.DEFAULT_RULE_CONFIG),n.contains(this.definedRulesNames,e)){var i={message:o.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:a.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}if(this.definedRulesNames.push(e),!this.gastProductionsCache.containsKey(e)&&!this.serializedGrammar){var l=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,l)}var c=this.defineRule(e,t,r);return this[e]=c,c},e.prototype.OVERRIDE_RULE=function(e,t,r){void 0===r&&(r=a.DEFAULT_RULE_CONFIG);var n=[];if(n=n.concat(l.validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,n),!this.serializedGrammar){var i=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,i)}var o=this.defineRule(e,t,r);return this[e]=o,o},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(i.isRecognitionException(e))return!1;throw e}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return c.serializeGrammar(this.gastProductionsCache.values())},e}();t.RecognizerApi=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(9),a=r(6),o=r(12),s=r(13),l=r(3),c=r(25),u=r(2),h=r(7),d=r(4),f=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,t){if(this.className=d.classNameFromInstance(this),this.shortRuleNameToFull=new d.HashTable,this.fullRuleNameToShort=new d.HashTable,this.ruleShortNameIdx=256,this.tokenMatcher=h.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache=new d.HashTable,this.serializedGrammar=n.has(t,"serializedGrammar")?t.serializedGrammar:l.DEFAULT_PARSER_CONFIG.serializedGrammar,n.isArray(e)){if(n.isEmpty(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(n.isArray(e))this.tokensMap=n.reduce(e,function(e,t){return e[u.tokenName(t)]=t,e},{});else if(n.has(e,"modes")&&n.every(n.flatten(n.values(e.modes)),h.isTokenType)){var r=n.flatten(n.values(e.modes)),i=n.uniq(r);this.tokensMap=n.reduce(i,function(e,t){return e[u.tokenName(t)]=t,e},{})}else{if(!n.isObject(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=n.cloneObj(e)}this.tokensMap.EOF=u.EOF;var a=n.every(n.values(e),function(e){return n.isEmpty(e.categoryMatches)});this.tokenMatcher=a?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,h.augmentTokenTypes(n.values(this.tokensMap))},e.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var o,s=n.has(r,"resyncEnabled")?r.resyncEnabled:l.DEFAULT_RULE_CONFIG.resyncEnabled,c=n.has(r,"recoveryValueFunc")?r.recoveryValueFunc:l.DEFAULT_RULE_CONFIG.recoveryValueFunc,u=this.ruleShortNameIdx<<i.BITS_FOR_METHOD_IDX+i.BITS_FOR_OCCURRENCE_IDX;return this.ruleShortNameIdx++,this.shortRuleNameToFull.put(u,e),this.fullRuleNameToShort.put(e,u),(o=function(r,n){return void 0===r&&(r=0),this.ruleInvocationStateUpdate(u,e,r),function(e){try{return!0===this.outputCst?(t.apply(this,e),this.CST_STACK[this.CST_STACK.length-1]):t.apply(this,e)}catch(e){var r=1===this.RULE_STACK.length,n=s&&!this.isBackTracking()&&this.recoveryEnabled;if(a.isRecognitionException(e)){if(n){var i,o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))return e.resyncedTokens=this.reSyncTo(o),this.outputCst?((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,i):c();throw this.outputCst&&((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,e.partialCstResult=i),e}if(r)return this.moveToTerminatedState(),c();throw e}throw e}finally{this.ruleFinallyStateUpdate()}}.call(this,n)}).ruleName=e,o},e.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t),n=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t);return this.optionInternalLogic(e,t,r)},e.prototype.optionInternalLogic=function(e,t,r){var n,i,a=this,o=this.getLookaheadFuncForOption(r,t);if(void 0!==e.DEF){if(n=e.DEF,void 0!==(i=e.GATE)){var s=o;o=function(){return i.call(a)&&s.call(a)}}}else n=e;if(!0===o.call(this))return n.call(this)},e.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e);this.atLeastOneInternalLogic(e,t,r)},e.prototype.atLeastOneInternalLogic=function(e,t,r){var n,a,l=this,c=this.getLookaheadFuncForAtLeastOne(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var u=c;c=function(){return a.call(l)&&u.call(l)}}}else n=t;if(!0!==c.call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var h=this.doSingleRepetition(n);!0===c.call(this)&&!0===h;)h=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],c,i.AT_LEAST_ONE_IDX,e,s.NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,l=t.SEP;if(!0!==this.getLookaheadFuncForAtLeastOneSep(r,e).call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);a.call(this);for(var c=function(){return n.tokenMatcher(n.LA(1),l)};!0===this.tokenMatcher(this.LA(1),l);)this.CONSUME(l),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,l,c,a,s.NextTerminalAfterAtLeastOneSepWalker],c,i.AT_LEAST_ONE_SEP_IDX,e,s.NextTerminalAfterAtLeastOneSepWalker)},e.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e);return this.manyInternalLogic(e,t,r)},e.prototype.manyInternalLogic=function(e,t,r){var n,a,o=this,l=this.getLookaheadFuncForMany(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var c=l;l=function(){return a.call(o)&&c.call(o)}}}else n=t;for(var u=!0;!0===l.call(this)&&!0===u;)u=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],l,i.MANY_IDX,e,s.NextTerminalAfterManyWalker)},e.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,r)},e.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,o=t.SEP;if(!0===this.getLookaheadFuncForManySep(r,e).call(this)){a.call(this);for(var l=function(){return n.tokenMatcher(n.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,l,a,s.NextTerminalAfterManySepWalker],l,i.MANY_SEP_IDX,e,s.NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,r,n,a){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,a],r,i.AT_LEAST_ONE_SEP_IDX,e,a)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternalNoCst=function(e,t){var r=n.isArray(e)?e:e.DEF,i=this.getLookaheadFuncForOr(t,r).call(this,r);if(void 0!==i)return r[i].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},e.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OR_IDX,t),a=this.nestedRuleBeforeClause(e,r);try{var o=n.isArray(e)?e:e.DEF,s=this.getLookaheadFuncForOr(t,o).call(this,o);if(void 0!==s){var l=o[s],c=this.nestedAltBeforeClause(l,t,i.OR_IDX,s);try{return l.ALT.call(this)}finally{void 0!==c&&this.nestedRuleFinallyClause(c.shortName,c.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{void 0!==a&&this.nestedRuleFinallyClause(r,a)}},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new a.NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,r){var n;try{var i=void 0!==r?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),n}catch(t){throw a.isRecognitionException(t)&&void 0!==t.partialCstResult&&(this.cstPostNonTerminal(t.partialCstResult,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),delete t.partialCstResult),t}},e.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);if(!0!==this.tokenMatcher(i,e)){var o=void 0,s=this.LA(0);throw o=void 0!==r&&r.ERR_MSG?r.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:i,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new a.MismatchedTokenException(o,i,s))}this.consumeToken(),n=i}catch(r){if(!this.recoveryEnabled||"MismatchedTokenException"!==r.name||this.isBackTracking())throw r;var l=this.getFollowsForInRuleRecovery(e,t);try{n=this.tryInRuleRecovery(e,l)}catch(e){throw e.name===c.IN_RULE_RECOVERY_EXCEPTION?r:e}}return this.cstPostTerminal(void 0!==r&&void 0!==r.LABEL?r.LABEL:e.tokenName,n),n},e.prototype.saveRecogState=function(){var e=this.errors,t=n.cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return!n.isEmpty(this.isBackTrackingStack)},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull.get(e)},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull.get(e)},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),u.EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}();t.RecognizerEngine=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=r(0),a=r(12),o=r(3),s=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=i.defaults(e.errorMessageProvider,o.DEFAULT_PARSER_CONFIG.errorMessageProvider)},e.prototype.SAVE_ERROR=function(e){if(n.isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(e.prototype,"errors",{get:function(){return i.cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,t,r){for(var i=this.getCurrRuleFullName(),o=this.getGAstProductions().get(i),s=a.getLookaheadPathsForOptionalProd(e,o,t,this.maxLookahead)[0],l=[],c=1;c<this.maxLookahead;c++)l.push(this.LA(c));var u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:s,actual:l,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new n.EarlyExitException(u,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),i=this.getGAstProductions().get(r),o=a.getLookaheadPathsForOr(e,i,this.maxLookahead),s=[],l=1;l<=this.maxLookahead;l++)s.push(this.LA(l));var c=this.LA(0),u=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:o,actual:s,previous:c,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new n.NoViableAltException(u,this.LA(1),c))},e}();t.ErrorHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(13),i=r(0),a=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache.get(e);if(i.isUndefined(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return n.nextPossibleTokensAfter([r],t,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var t=i.first(e.ruleStack),r=this.getGAstProductions().get(t);return new n.NextAfterTokenWalker(r,e).startWalking()},e}();t.ContentAssist=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(17);t.createSyntaxDiagramsCode=function(e,t){var r=void 0===t?{}:t,i=r.resourceBase,a=void 0===i?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/":i,o=r.css;return"\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n\n<link rel='stylesheet' href='"+(void 0===o?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/diagrams.css":o)+"'>\n\n<script src='"+a+"vendor/railroad-diagrams.js'><\/script>\n<script src='"+a+"src/diagrams_builder.js'><\/script>\n<script src='"+a+"src/diagrams_behavior.js'><\/script>\n<script src='"+a+'src/main.js\'><\/script>\n\n<div id="diagrams" align="center"></div>    \n\n<script>\n    window.serializedGrammar = '+JSON.stringify(e,null,"  ")+';\n<\/script>\n\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(41);t.generateParserFactory=function(e){var t=n.genWrapperFunction({name:e.name,rules:e.rules}),i=new Function("tokenVocabulary","config","chevrotain",t);return function(t){return i(e.tokenVocabulary,t,r(18))}},t.generateParserModule=function(e){return n.genUmdModule({name:e.name,rules:e.rules})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),a=r(1),o="\n";function s(e){return"\nfunction "+e.name+"(tokenVocabulary, config) {\n    // invoke super constructor\n    // No support for embedded actions currently, so we can 'hardcode'\n    // The use of CstParser.\n    chevrotain.CstParser.call(this, tokenVocabulary, config)\n\n    const $ = this\n\n    "+l(e.rules)+"\n\n    // very important to call this after all the rules have been defined.\n    // otherwise the parser may not work correctly as it will lack information\n    // derived during the self analysis phase.\n    this.performSelfAnalysis(this)\n}\n\n// inheritance as implemented in javascript in the previous decade... :(\n"+e.name+".prototype = Object.create(chevrotain.CstParser.prototype)\n"+e.name+".prototype.constructor = "+e.name+"    \n    "}function l(e){return n.map(e,function(e){return c(e,1)}).join("\n")}function c(e,t){var r=g(t,'$.RULE("'+e.name+'", function() {')+o;return r+=v(e.definition,t+1),r+=g(t+1,"})")+o}function u(e,t){var r=i.tokenName(e.terminalType);return g(t,"$.CONSUME"+e.idx+"(this.tokensMap."+r+")"+o)}function h(e,t){return g(t,"$.SUBRULE"+e.idx+"($."+e.nonTerminalName+")"+o)}function d(e,t){var r=g(t,"$.OR"+e.idx+"([")+o;return r+=n.map(e.definition,function(e){return f(e,t+1)}).join(","+o),r+=o+g(t,"])"+o)}function f(e,t){var r=g(t,"{")+o;return e.name&&(r+=g(t+1,'NAME: "'+e.name+'",')+o),r+=g(t+1,"ALT: function() {")+o,r+=v(e.definition,t+1),r+=g(t+1,"}")+o,r+=g(t,"}")}function p(e,t,r){var n=g(r,"$."+(e+t.idx)+"(");return t.name||t.separator?(n+="{"+o,t.name&&(n+=g(r+1,'NAME: "'+t.name+'"')+","+o),t.separator&&(n+=g(r+1,"SEP: this.tokensMap."+i.tokenName(t.separator))+","+o),n+="DEF: "+m(t.definition,r+2)+o,n+=g(r,"}")+o):n+=m(t.definition,r+1),n+=g(r,")")+o}function m(e,t){var r="function() {"+o;return r+=v(e,t),r+=g(t,"}")+o}function v(e,t){var r="";return n.forEach(e,function(e){r+=function(e,t){if(e instanceof a.NonTerminal)return h(e,t);if(e instanceof a.Option)return p("OPTION",e,t);if(e instanceof a.RepetitionMandatory)return p("AT_LEAST_ONE",e,t);if(e instanceof a.RepetitionMandatoryWithSeparator)return p("AT_LEAST_ONE_SEP",e,t);if(e instanceof a.RepetitionWithSeparator)return p("MANY_SEP",e,t);if(e instanceof a.Repetition)return p("MANY",e,t);if(e instanceof a.Alternation)return d(e,t);if(e instanceof a.Terminal)return u(e,t);if(e instanceof a.Flat)return v(e.definition,t);throw Error("non exhaustive match")}(e,t+1)}),r}function g(e,t){return Array(4*e+1).join(" ")+t}t.genUmdModule=function(e){return"\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['chevrotain'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('chevrotain'));\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory(root.b);\n    }\n}(typeof self !== 'undefined' ? self : this, function (chevrotain) {\n\n"+s(e)+"\n    \nreturn {\n    "+e.name+": "+e.name+" \n}\n}));\n"},t.genWrapperFunction=function(e){return"    \n"+s(e)+"\nreturn new "+e.name+"(tokenVocabulary, config)    \n"},t.genClass=s,t.genAllRules=l,t.genRule=c,t.genTerminal=u,t.genNonTerminal=h,t.genAlternation=d,t.genSingleAlt=f}])},function(e,t){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";var e=void 0,t=this;function r(r,n){var i,a=r.split("."),o=t;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||n===e?o=o[i]?o[i]:o[i]={}:o[i]=n}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function i(e){var t,r,i,a,o,s,l,c,u,h,d=e.length,f=0,p=Number.POSITIVE_INFINITY;for(c=0;c<d;++c)e[c]>f&&(f=e[c]),e[c]<p&&(p=e[c]);for(t=1<<f,r=new(n?Uint32Array:Array)(t),i=1,a=0,o=2;i<=f;){for(c=0;c<d;++c)if(e[c]===i){for(s=0,l=a,u=0;u<i;++u)s=s<<1|1&l,l>>=1;for(h=i<<16|c,u=s;u<t;u+=o)r[u]=h;++a}++i,a<<=1,o<<=1}return[r,f,p]}function a(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=n?new Uint8Array(e):e,this.m=!1,this.i=s,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case o:this.b=32768,this.c=new(n?Uint8Array:Array)(32768+this.h+258);break;case s:this.b=0,this.c=new(n?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var o=0,s=1,l={t:o,s:s};a.prototype.k=function(){for(;!this.m;){var t=S(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var r=this.input,a=this.a,l=this.c,c=this.b,u=r.length,h=e,f=l.length,p=e;if(this.d=this.f=0,a+1>=u)throw Error("invalid uncompressed block header: LEN");if(h=r[a++]|r[a++]<<8,a+1>=u)throw Error("invalid uncompressed block header: NLEN");if(h===~(r[a++]|r[a++]<<8))throw Error("invalid uncompressed block header: length verify");if(a+h>r.length)throw Error("input buffer is broken");switch(this.i){case o:for(;c+h>l.length;){if(h-=p=f-c,n)l.set(r.subarray(a,a+p),c),c+=p,a+=p;else for(;p--;)l[c++]=r[a++];this.b=c,l=this.e(),c=this.b}break;case s:for(;c+h>l.length;)l=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(n)l.set(r.subarray(a,a+h),c),c+=h,a+=h;else for(;h--;)l[c++]=r[a++];this.a=a,this.b=c,this.c=l;break;case 1:this.j(_,M);break;case 2:var m,v,g,y,E=S(this,5)+257,x=S(this,5)+1,T=S(this,4)+4,b=new(n?Uint8Array:Array)(d.length),w=e,R=e,L=e,P=e,C=e;for(C=0;C<T;++C)b[d[C]]=S(this,3);if(!n)for(C=T,T=b.length;C<T;++C)b[d[C]]=0;for(m=i(b),w=new(n?Uint8Array:Array)(E+x),C=0,y=E+x;C<y;)switch(R=A(this,m),R){case 16:for(P=3+S(this,2);P--;)w[C++]=L;break;case 17:for(P=3+S(this,3);P--;)w[C++]=0;L=0;break;case 18:for(P=11+S(this,7);P--;)w[C++]=0;L=0;break;default:L=w[C++]=R}v=i(n?w.subarray(0,E):w.slice(0,E)),g=i(n?w.subarray(E):w.slice(E)),this.j(v,g);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var c,u,h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=n?new Uint16Array(h):h,f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],p=n?new Uint16Array(f):f,m=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],v=n?new Uint8Array(m):m,g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],y=n?new Uint16Array(g):g,E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=n?new Uint8Array(E):E,T=new(n?Uint8Array:Array)(288);for(c=0,u=T.length;c<u;++c)T[c]=143>=c?8:255>=c?9:279>=c?7:8;var b,w,_=i(T),R=new(n?Uint8Array:Array)(30);for(b=0,w=R.length;b<w;++b)R[b]=5;var M=i(R);function S(e,t){for(var r,n=e.f,i=e.d,a=e.input,o=e.a,s=a.length;i<t;){if(o>=s)throw Error("input buffer is broken");n|=a[o++]<<i,i+=8}return r=n&(1<<t)-1,e.f=n>>>t,e.d=i-t,e.a=o,r}function A(e,t){for(var r,n,i=e.f,a=e.d,o=e.input,s=e.a,l=o.length,c=t[0],u=t[1];a<u&&!(s>=l);)i|=o[s++]<<a,a+=8;if((n=(r=c[i&(1<<u)-1])>>>16)>a)throw Error("invalid code length: "+n);return e.f=i>>n,e.d=a-n,e.a=s,65535&r}function L(e,t){var r,n;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),r=e[this.a++],n=e[this.a++],15&r){case P:this.method=P;break;default:throw Error("unsupported compression method")}if(0!=((r<<8)+n)%31)throw Error("invalid fcheck flag:"+((r<<8)+n)%31);if(32&n)throw Error("fdict flag is not supported");this.q=new a(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}a.prototype.j=function(e,t){var r=this.c,n=this.b;this.o=e;for(var i,a,o,s,l=r.length-258;256!==(i=A(this,e));)if(256>i)n>=l&&(this.b=n,r=this.e(),n=this.b),r[n++]=i;else for(s=p[a=i-257],0<v[a]&&(s+=S(this,v[a])),i=A(this,t),o=y[i],0<x[i]&&(o+=S(this,x[i])),n>=l&&(this.b=n,r=this.e(),n=this.b);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},a.prototype.w=function(e,t){var r=this.c,n=this.b;this.o=e;for(var i,a,o,s,l=r.length;256!==(i=A(this,e));)if(256>i)n>=l&&(l=(r=this.e()).length),r[n++]=i;else for(s=p[a=i-257],0<v[a]&&(s+=S(this,v[a])),i=A(this,t),o=y[i],0<x[i]&&(o+=S(this,x[i])),n+s>l&&(l=(r=this.e()).length);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},a.prototype.e=function(){var e,t,r=new(n?Uint8Array:Array)(this.b-32768),i=this.b-32768,a=this.c;if(n)r.set(a.subarray(32768,r.length));else for(e=0,t=r.length;e<t;++e)r[e]=a[e+32768];if(this.g.push(r),this.l+=r.length,n)a.set(a.subarray(i,i+32768));else for(e=0;32768>e;++e)a[e]=a[i+e];return this.b=32768,a},a.prototype.z=function(e){var t,r,i,a=this.input.length/this.a+1|0,o=this.input,s=this.c;return e&&("number"==typeof e.p&&(a=e.p),"number"==typeof e.u&&(a+=e.u)),2>a?r=(i=(o.length-this.a)/this.o[2]/2*258|0)<s.length?s.length+i:s.length<<1:r=s.length*a,n?(t=new Uint8Array(r)).set(s):t=s,this.c=t},a.prototype.n=function(){var e,t,r,i,a,o=0,s=this.c,l=this.g,c=new(n?Uint8Array:Array)(this.l+(this.b-32768));if(0===l.length)return n?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,r=l.length;t<r;++t)for(i=0,a=(e=l[t]).length;i<a;++i)c[o++]=e[i];for(t=32768,r=this.b;t<r;++t)c[o++]=s[t];return this.g=[],this.buffer=c},a.prototype.v=function(){var e,t=this.b;return n?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},L.prototype.k=function(){var e,t,r=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;var n=e;if("string"==typeof n){var i,a,o=n.split("");for(i=0,a=o.length;i<a;i++)o[i]=(255&o[i].charCodeAt(0))>>>0;n=o}for(var s,l=1,c=0,u=n.length,h=0;0<u;){u-=s=1024<u?1024:u;do{c+=l+=n[h++]}while(--s);l%=65521,c%=65521}if(t!==(c<<16|l)>>>0)throw Error("invalid adler-32 checksum")}return e};var P=8;r("Zlib.Inflate",L),r("Zlib.Inflate.prototype.decompress",L.prototype.k);var C,H,I,k,N={ADAPTIVE:l.s,BLOCK:l.t};if(Object.keys)C=Object.keys(N);else for(H in C=[],I=0,N)C[I++]=H;for(I=0,k=C.length;I<k;++I)r("Zlib.Inflate.BufferType."+(H=C[I]),N[H])}).call(this)},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){e.exports=function(){"use strict";var e=Math.pow(2,-52),t=function(t){var o=t.length>>1;if(o>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;var s=2*o-5,l=this.triangles=new Uint32Array(3*s),c=this.halfedges=new Int32Array(3*s);this._hashSize=Math.ceil(Math.sqrt(o));for(var u=this.hullPrev=new Uint32Array(o),h=this.hullNext=new Uint32Array(o),d=this.hullTri=new Uint32Array(o),f=new Int32Array(this._hashSize).fill(-1),p=new Uint32Array(o),m=1/0,v=1/0,g=-1/0,y=-1/0,E=0;E<o;E++){var x=t[2*E],T=t[2*E+1];x<m&&(m=x),T<v&&(v=T),x>g&&(g=x),T>y&&(y=T),p[E]=E}for(var b,w,_,R=(m+g)/2,M=(v+y)/2,S=1/0,A=0;A<o;A++){var L=r(R,M,t[2*A],t[2*A+1]);L<S&&(b=A,S=L)}var P=t[2*b],C=t[2*b+1];S=1/0;for(var H=0;H<o;H++)if(H!==b){var I=r(P,C,t[2*H],t[2*H+1]);I<S&&I>0&&(w=H,S=I)}for(var k=t[2*w],N=t[2*w+1],O=1/0,F=0;F<o;F++)if(F!==b&&F!==w){var D=i(P,C,k,N,t[2*F],t[2*F+1]);D<O&&(_=F,O=D)}var U=t[2*_],z=t[2*_+1];if(O===1/0)throw new Error("No Delaunay triangulation exists for this input.");if(n(P,C,k,N,U,z)){var B=w,G=k,V=N;w=_,k=U,N=z,_=B,U=G,z=V}var j=function(e,t,r,n,i,a){var o=NaN,s=NaN,l=NaN,c=NaN,u=o*o+s*s,h=l*l+c*c,d=.5/(o*c-s*l);return{x:e+(c*u-s*h)*d,y:t+(o*h-l*u)*d}}(P,C);this._cx=j.x,this._cy=j.y;for(var W=new Float64Array(o),X=0;X<o;X++)W[X]=r(t[2*X],t[2*X+1],j.x,j.y);!function e(t,r,n,i){if(i-n<=20)for(var o=n+1;o<=i;o++){for(var s=t[o],l=r[s],c=o-1;c>=n&&r[t[c]]>l;)t[c+1]=t[c--];t[c+1]=s}else{var u=n+i>>1,h=n+1,d=i;a(t,u,h),r[t[n]]>r[t[i]]&&a(t,n,i),r[t[h]]>r[t[i]]&&a(t,h,i),r[t[n]]>r[t[h]]&&a(t,n,h);for(var f=t[h],p=r[f];;){do{h++}while(r[t[h]]<p);do{d--}while(r[t[d]]>p);if(d<h)break;a(t,h,d)}t[n+1]=t[d],t[d]=f,i-h+1>=d-n?(e(t,r,h,i),e(t,r,n,d-1)):(e(t,r,n,d-1),e(t,r,h,i))}}(p,W,0,o-1),this.hullStart=b;var Y=3;h[b]=u[_]=w,h[w]=u[b]=_,h[_]=u[w]=b,d[b]=0,d[w]=1,d[_]=2,f[this._hashKey(P,C)]=b,f[this._hashKey(k,N)]=w,f[this._hashKey(U,z)]=_,this.trianglesLen=0,this._addTriangle(b,w,_,-1,-1,-1);for(var q=0,Z=void 0,Q=void 0;q<p.length;q++){var K=p[q],J=t[2*K],$=t[2*K+1];if(!(q>0&&Math.abs(J-Z)<=e&&Math.abs($-Q)<=e)&&(Z=J,Q=$,K!==b&&K!==w&&K!==_)){for(var ee=0,te=0,re=this._hashKey(J,$);te<this._hashSize&&(-1===(ee=f[(re+te)%this._hashSize])||ee===h[ee]);te++);for(var ne=ee=u[ee],ie=void 0;ie=h[ne],!n(J,$,t[2*ne],t[2*ne+1],t[2*ie],t[2*ie+1]);)if((ne=ie)===ee){ne=-1;break}if(-1!==ne){var ae=this._addTriangle(ne,K,h[ne],-1,-1,d[ne]);d[K]=this._legalize(ae+2),d[ne]=ae,Y++;for(var oe=h[ne];ie=h[oe],n(J,$,t[2*oe],t[2*oe+1],t[2*ie],t[2*ie+1]);)ae=this._addTriangle(oe,K,ie,d[K],-1,d[oe]),d[K]=this._legalize(ae+2),h[oe]=oe,Y--,oe=ie;if(ne===ee)for(;n(J,$,t[2*(ie=u[ne])],t[2*ie+1],t[2*ne],t[2*ne+1]);)ae=this._addTriangle(ie,K,ne,-1,d[ne],d[ie]),this._legalize(ae+2),d[ie]=ae,h[ne]=ne,Y--,ne=ie;this.hullStart=u[K]=ne,h[ne]=u[oe]=K,h[K]=oe,f[this._hashKey(J,$)]=K,f[this._hashKey(t[2*ne],t[2*ne+1])]=ne}}}this.hull=new Uint32Array(Y);for(var se=0,le=this.hullStart;se<Y;se++)this.hull[se]=le,le=h[le];this.hullPrev=this.hullNext=this.hullTri=null,this.triangles=l.subarray(0,this.trianglesLen),this.halfedges=c.subarray(0,this.trianglesLen)};function r(e,t,r,n){var i=e-r,a=t-n;return i*i+a*a}function n(e,t,r,n,i,a){return(n-t)*(i-r)-(r-e)*(a-n)<0}function i(e,t,r,n,i,a){var o=r-e,s=n-t,l=i-e,c=a-t,u=o*o+s*s,h=l*l+c*c,d=.5/(o*c-s*l),f=(c*u-s*h)*d,p=(o*h-l*u)*d;return f*f+p*p}function a(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function o(e){return e[0]}function s(e){return e[1]}return t.from=function(e,r,n){void 0===r&&(r=o),void 0===n&&(n=s);for(var i=e.length,a=new Float64Array(2*i),l=0;l<i;l++){var c=e[l];a[2*l]=r(c),a[2*l+1]=n(c)}return new t(a)},t.prototype._hashKey=function(e,t){return Math.floor((r=e-this._cx,n=t-this._cy,i=r/(Math.abs(r)+Math.abs(n)),(n>0?3-i:1+i)/4*this._hashSize))%this._hashSize;var r,n,i},t.prototype._legalize=function(e){var t=this.triangles,r=this.coords,n=this.halfedges,i=n[e],a=e-e%3,o=i-i%3,s=a+(e+1)%3,l=a+(e+2)%3,c=o+(i+2)%3;if(-1===i)return l;var u,h,d,f,p,m,v,g,y,E,x,T,b,w,_,R,M=t[l],S=t[e],A=t[s],L=t[c];if(u=r[2*M],h=r[2*M+1],d=r[2*S],f=r[2*S+1],p=r[2*A],m=r[2*A+1],v=r[2*L],g=r[2*L+1],(y=u-v)*((T=f-g)*(R=(b=p-v)*b+(w=m-g)*w)-(_=(x=d-v)*x+T*T)*w)-(E=h-g)*(x*R-_*b)+(y*y+E*E)*(x*w-T*b)<0){t[e]=L,t[i]=M;var P=n[c];if(-1===P){var C=this.hullStart;do{if(this.hullTri[C]===c){this.hullTri[C]=e;break}C=this.hullNext[C]}while(C!==this.hullStart)}this._link(e,P),this._link(i,n[l]),this._link(l,c);var H=o+(i+1)%3;return this._legalize(e),this._legalize(H)}return l},t.prototype._link=function(e,t){this.halfedges[e]=t,-1!==t&&(this.halfedges[t]=e)},t.prototype._addTriangle=function(e,t,r,n,i,a){var o=this.trianglesLen;return this.triangles[o]=e,this.triangles[o+1]=t,this.triangles[o+2]=r,this._link(o,n),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o},t}()},function(e,t,r){(function(r){var n,i,a;i=[],void 0===(a="function"==typeof(n=function(){"use strict";function t(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){o(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r&&r.global===r?r:void 0,o=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype?function(e,r,o){var s=a.URL||a.webkitURL,l=document.createElement("a");r=r||e.name||"download",l.download=r,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?i(l):n(l.href)?t(e,r,o):i(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout(function(){s.revokeObjectURL(l.href)},4e4),setTimeout(function(){i(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,r,a){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),r);else if(n(e))t(e,r,a);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout(function(){i(o)})}}:function(e,r,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,r,n);var o="application/octet-stream"===e.type,s=/constructor/i.test(a.HTMLElement)||a.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||o&&s)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},c.readAsDataURL(e)}else{var u=a.URL||a.webkitURL,h=u.createObjectURL(e);i?i.location=h:location.href=h,i=null,setTimeout(function(){u.revokeObjectURL(h)},4e4)}});a.saveAs=o.saveAs=o,e.exports=o})?n.apply(t,i):n)||(e.exports=a)}).call(this,r(3))},function(e,t,r){!function(e){"use strict";void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t});var t=0,r=1,n=2,i=1,a=2,o=3,s=0,l=1,c=2,u=0,h=1,d=2,f=3,p=4,m=5,v=100,g=101,y=102,E=103,x=104,T=200,b=201,w=202,_=203,R=204,M=205,S=206,A=207,L=208,P=209,C=210,H=0,I=1,k=2,N=3,O=4,F=5,D=6,U=7,z=0,B=1,G=2,V=0,j=1,W=2,X=3,Y=4,q=5,Z=301,Q=302,K=303,J=304,$=305,ee=306,te=307,re=1e3,ne=1001,ie=1002,ae=1003,oe=1004,se=1005,le=1006,ce=1007,ue=1008,he=1009,de=1010,fe=1011,pe=1012,me=1013,ve=1014,ge=1015,ye=1016,Ee=1017,xe=1018,Te=1019,be=1020,we=1021,_e=1022,Re=1023,Me=1024,Se=1025,Ae=Re,Le=1026,Pe=1027,Ce=1028,He=1029,Ie=1030,ke=1031,Ne=1032,Oe=1033,Fe=33776,De=33777,Ue=33778,ze=33779,Be=35840,Ge=35841,Ve=35842,je=35843,We=36196,Xe=37492,Ye=37496,qe=37808,Ze=37809,Qe=37810,Ke=37811,Je=37812,$e=37813,et=37814,tt=37815,rt=37816,nt=37817,it=37818,at=37819,ot=37820,st=37821,lt=37840,ct=37841,ut=37842,ht=37843,dt=37844,ft=37845,pt=37846,mt=37847,vt=37848,gt=37849,yt=37850,Et=37851,xt=37852,Tt=37853,bt=2201,wt=2400,_t=3e3,Rt=3001,Mt=3007,St=3002,At=3003,Lt=3004,Pt=3005,Ct=3006,Ht=3200,It=3201,kt=0,Nt=1,Ot=7680,Ft=519,Dt=35044,Ut=35048;function zt(){}Object.assign(zt.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,n=r[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var n=r.slice(0),i=0,a=n.length;i<a;i++)n[i].call(this,e)}}}});for(var Bt=[],Gt=0;Gt<256;Gt++)Bt[Gt]=(Gt<16?"0":"")+Gt.toString(16);var Vt,jt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=Bt[255&e]+Bt[e>>8&255]+Bt[e>>16&255]+Bt[e>>24&255]+"-"+Bt[255&t]+Bt[t>>8&255]+"-"+Bt[t>>16&15|64]+Bt[t>>24&255]+"-"+Bt[63&r|128]+Bt[r>>8&255]+"-"+Bt[r>>16&255]+Bt[r>>24&255]+Bt[255&n]+Bt[n>>8&255]+Bt[n>>16&255]+Bt[n>>24&255];return i.toUpperCase()},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*jt.DEG2RAD},radToDeg:function(e){return e*jt.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,r,n,i){var a=Math.cos,o=Math.sin,s=a(r/2),l=o(r/2),c=a((t+n)/2),u=o((t+n)/2),h=a((t-n)/2),d=o((t-n)/2),f=a((n-t)/2),p=o((n-t)/2);"XYX"===i?e.set(s*u,l*h,l*d,s*c):"YZY"===i?e.set(l*d,s*u,l*h,s*c):"ZXZ"===i?e.set(l*h,l*d,s*u,s*c):"XZX"===i?e.set(s*u,l*p,l*f,s*c):"YXY"===i?e.set(l*f,s*u,l*p,s*c):"ZYZ"===i?e.set(l*p,l*f,s*u,s*c):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function Wt(e,t){this.x=e||0,this.y=t||0}function Xt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Wt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Wt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*n+e.x,this.y=i*n+a*r+e.y,this}}),Object.assign(Xt.prototype,{isMatrix3:!0,set:function(e,t,r,n,i,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=n,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=r,c[7]=a,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},extractBasis:function(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],f=r[8],p=n[0],m=n[3],v=n[6],g=n[1],y=n[4],E=n[7],x=n[2],T=n[5],b=n[8];return i[0]=a*p+o*g+s*x,i[3]=a*m+o*y+s*T,i[6]=a*v+o*E+s*b,i[1]=l*p+c*g+u*x,i[4]=l*m+c*y+u*T,i[7]=l*v+c*E+u*b,i[2]=h*p+d*g+f*x,i[5]=h*m+d*y+f*T,i[8]=h*v+d*E+f*b,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-r*i*c+r*o*s+n*i*l-n*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],f=d*l-c*h,p=c*u-d*s,m=h*s-l*u,v=i*f+a*p+o*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=f*y,n[1]=(o*h-d*a)*y,n[2]=(c*a-o*l)*y,n[3]=p*y,n[4]=(d*i-o*u)*y,n[5]=(o*s-c*i)*y,n[6]=m*y,n[7]=(a*u-h*i)*y,n[8]=(l*i-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,i,a,o){var s=Math.cos(i),l=Math.sin(i);this.set(r*s,r*l,-r*(s*a+l*o)+a+e,-n*l,n*s,-n*(-l*a+s*o)+o+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],l=n[4],c=n[7];return n[0]=t*i+r*s,n[3]=t*a+r*l,n[6]=t*o+r*c,n[1]=-r*i+t*s,n[4]=-r*a+t*l,n[7]=-r*o+t*c,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var Yt={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Vt&&(Vt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Vt.width=e.width,Vt.height=e.height;var r=Vt.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Vt}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},qt=0;function Zt(e,t,r,n,i,a,o,s,l,c){Object.defineProperty(this,"id",{value:qt++}),this.uuid=jt.generateUUID(),this.name="",this.image=void 0!==e?e:Zt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Zt.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:ne,this.wrapT=void 0!==n?n:ne,this.magFilter=void 0!==i?i:le,this.minFilter=void 0!==a?a:ue,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:Re,this.internalFormat=null,this.type=void 0!==s?s:he,this.offset=new Wt(0,0),this.repeat=new Wt(1,1),this.center=new Wt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:_t,this.version=0,this.onUpdate=null}function Qt(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function Kt(e,t,r){this.width=e,this.height=t,this.scissor=new Qt(0,0,e,t),this.scissorTest=!1,this.viewport=new Qt(0,0,e,t),r=r||{},this.texture=new Zt(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:le,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function Jt(e,t,r){Kt.call(this,e,t,r),this.samples=4}function $t(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}Zt.DEFAULT_IMAGE=void 0,Zt.DEFAULT_MAPPING=300,Zt.prototype=Object.assign(Object.create(zt.prototype),{constructor:Zt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(this.isDataTexture){var i=document.createElement("canvas"),a=i.getContext("2d");n=a.getImageData(0,0,n.width,n.height)}if(void 0===n.uuid&&(n.uuid=jt.generateUUID()),!t&&void 0===e.images[n.uuid]){var o;if(Array.isArray(n)){o=[];for(var s=0,l=n.length;s<l;s++)o.push(Yt.getDataURL(n[s]))}else o=Yt.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:o}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case re:e.x=e.x-Math.floor(e.x);break;case ne:e.x=e.x<0?0:1;break;case ie:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case re:e.y=e.y-Math.floor(e.y);break;case ne:e.y=e.y<0?0:1;break;case ie:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Zt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(Qt.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(Qt.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,a=e.elements,o=a[0],s=a[4],l=a[8],c=a[1],u=a[5],h=a[9],d=a[2],f=a[6],p=a[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(o+u+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,v=(u+1)/2,g=(p+1)/2,y=(s+c)/4,E=(l+d)/4,x=(h+f)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(m),n=y/r,i=E/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(v),r=y/n,i=x/n):g<.01?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(g),r=E/i,n=x/i),this.set(r,n,i,t),this}var T=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(c-s)*(c-s));return Math.abs(T)<.001&&(T=1),this.x=(f-h)/T,this.y=(l-d)/T,this.z=(c-s)/T,this.w=Math.acos((o+u+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Kt.prototype=Object.assign(Object.create(zt.prototype),{constructor:Kt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Jt.prototype=Object.assign(Object.create(Kt.prototype),{constructor:Jt,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Kt.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign($t,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,i,a,o){var s=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[a+0],d=i[a+1],f=i[a+2],p=i[a+3];if(u!==p||s!==h||l!==d||c!==f){var m=1-o,v=s*h+l*d+c*f+u*p,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var E=Math.sqrt(y),x=Math.atan2(E,v*g);m=Math.sin(m*x)/E,o=Math.sin(o*x)/E}var T=o*g;if(s=s*m+h*T,l=l*m+d*T,c=c*m+f*T,u=u*m+p*T,m===1-o){var b=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=b,l*=b,c*=b,u*=b}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties($t.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign($t.prototype,{isQuaternion:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,a=e.order,o=Math.cos,s=Math.sin,l=o(r/2),c=o(n/2),u=o(i/2),h=s(r/2),d=s(n/2),f=s(i/2);return"XYZ"===a?(this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f):"YXZ"===a?(this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f):"ZXY"===a?(this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f):"ZYX"===a?(this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f):"YZX"===a?(this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f):"XZY"===a&&(this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-l)*t,this._y=(a-c)*t,this._z=(o-i)*t):n>s&&n>h?(t=2*Math.sqrt(1+n-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+c)/t):s>h?(t=2*Math.sqrt(1+s-n-h),this._w=(a-c)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-n-s),this._w=(o-i)/t,this._x=(a+c)/t,this._y=(l+u)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=e.dot(t)+1;return r<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(jt.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var n=Math.min(1,t/r);return this.slerp(e,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=r*c+a*o+n*l-i*s,this._y=n*c+a*s+i*o-r*l,this._z=i*c+a*l+r*s-n*o,this._w=a*c-r*o-n*s-i*l,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,a=this._w,o=a*e._w+r*e._x+n*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=n,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*r+t*this._x,this._y=l*n+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),u=Math.atan2(c,o),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var er=new rr,tr=new $t;function rr(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}Object.assign(rr.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(tr.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(tr.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,a=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*a,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*n-o*r,c=s*r+o*t-i*n,u=s*n+i*r-a*t,h=-i*t-a*r-o*n;return this.x=l*s+h*-i+c*-o-u*-a,this.y=c*s+h*-a+u*-i-l*-o,this.z=u*s+h*-o+l*-a-c*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this},projectOnVector:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)},projectOnPlane:function(e){return er.copy(this).projectOnVector(e),this.sub(er)},reflect:function(e){return this.sub(er.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var r=this.dot(e)/t;return Math.acos(jt.clamp(r,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var nr=new rr,ir=new ur,ar=new rr(0,0,0),or=new rr(1,1,1),sr=new rr,lr=new rr,cr=new rr;function ur(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(ur.prototype,{isMatrix4:!0,set:function(e,t,r,n,i,a,o,s,l,c,u,h,d,f,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=f,v[11]=p,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new ur).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,r=e.elements,n=1/nr.setFromMatrixColumn(e,0).length(),i=1/nr.setFromMatrixColumn(e,1).length(),a=1/nr.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){var h=a*c,d=a*u,f=o*c,p=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-o*s,t[2]=p-h*l,t[6]=f+d*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*c,v=s*u,g=l*c,y=l*u;t[0]=m+y*o,t[4]=g*o-v,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=v*o-g,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){var m=s*c,v=s*u,g=l*c,y=l*u;t[0]=m-y*o,t[4]=-a*u,t[8]=g+v*o,t[1]=v+g*o,t[5]=a*c,t[9]=y-m*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var h=a*c,d=a*u,f=o*c,p=o*u;t[0]=s*c,t[4]=f*l-d,t[8]=h*l+p,t[1]=s*u,t[5]=p*l+h,t[9]=d*l-f,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var E=a*s,x=a*l,T=o*s,b=o*l;t[0]=s*c,t[4]=b-E*u,t[8]=T*u+x,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=x*u+T,t[10]=E-b*u}else if("XZY"===e.order){var E=a*s,x=a*l,T=o*s,b=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=E*u+b,t[5]=a*c,t[9]=x*u-T,t[2]=T*u-x,t[6]=o*c,t[10]=b*u+E}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(ar,e,or)},lookAt:function(e,t,r){var n=this.elements;return cr.subVectors(e,t),0===cr.lengthSq()&&(cr.z=1),cr.normalize(),sr.crossVectors(r,cr),0===sr.lengthSq()&&(1===Math.abs(r.z)?cr.x+=1e-4:cr.z+=1e-4,cr.normalize(),sr.crossVectors(r,cr)),sr.normalize(),lr.crossVectors(cr,sr),n[0]=sr.x,n[4]=lr.x,n[8]=cr.x,n[1]=sr.y,n[5]=lr.y,n[9]=cr.y,n[2]=sr.z,n[6]=lr.z,n[10]=cr.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],c=r[1],u=r[5],h=r[9],d=r[13],f=r[2],p=r[6],m=r[10],v=r[14],g=r[3],y=r[7],E=r[11],x=r[15],T=n[0],b=n[4],w=n[8],_=n[12],R=n[1],M=n[5],S=n[9],A=n[13],L=n[2],P=n[6],C=n[10],H=n[14],I=n[3],k=n[7],N=n[11],O=n[15];return i[0]=a*T+o*R+s*L+l*I,i[4]=a*b+o*M+s*P+l*k,i[8]=a*w+o*S+s*C+l*N,i[12]=a*_+o*A+s*H+l*O,i[1]=c*T+u*R+h*L+d*I,i[5]=c*b+u*M+h*P+d*k,i[9]=c*w+u*S+h*C+d*N,i[13]=c*_+u*A+h*H+d*O,i[2]=f*T+p*R+m*L+v*I,i[6]=f*b+p*M+m*P+v*k,i[10]=f*w+p*S+m*C+v*N,i[14]=f*_+p*A+m*H+v*O,i[3]=g*T+y*R+E*L+x*I,i[7]=g*b+y*M+E*P+x*k,i[11]=g*w+y*S+E*C+x*N,i[15]=g*_+y*A+E*H+x*O,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],f=e[3],p=e[7],m=e[11],v=e[15];return f*(+i*s*u-n*l*u-i*o*h+r*l*h+n*o*d-r*s*d)+p*(+t*s*d-t*l*h+i*a*h-n*a*d+n*l*c-i*s*c)+m*(+t*l*u-t*o*d-i*a*u+r*a*d+i*o*c-r*l*c)+v*(-n*o*c-t*s*u+t*o*h+n*a*u-r*a*h+r*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,r){var n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],f=n[9],p=n[10],m=n[11],v=n[12],g=n[13],y=n[14],E=n[15],x=f*y*h-g*p*h+g*u*m-c*y*m-f*u*E+c*p*E,T=v*p*h-d*y*h-v*u*m+l*y*m+d*u*E-l*p*E,b=d*g*h-v*f*h+v*c*m-l*g*m-d*c*E+l*f*E,w=v*f*u-d*g*u-v*c*p+l*g*p+d*c*y-l*f*y,_=i*x+a*T+o*b+s*w;if(0===_){var R="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(R);return console.warn(R),this.identity()}var M=1/_;return r[0]=x*M,r[1]=(g*p*s-f*y*s-g*o*m+a*y*m+f*o*E-a*p*E)*M,r[2]=(c*y*s-g*u*s+g*o*h-a*y*h-c*o*E+a*u*E)*M,r[3]=(f*u*s-c*p*s-f*o*h+a*p*h+c*o*m-a*u*m)*M,r[4]=T*M,r[5]=(d*y*s-v*p*s+v*o*m-i*y*m-d*o*E+i*p*E)*M,r[6]=(v*u*s-l*y*s-v*o*h+i*y*h+l*o*E-i*u*E)*M,r[7]=(l*p*s-d*u*s+d*o*h-i*p*h-l*o*m+i*u*m)*M,r[8]=b*M,r[9]=(v*f*s-d*g*s-v*a*m+i*g*m+d*a*E-i*f*E)*M,r[10]=(l*g*s-v*c*s+v*a*h-i*g*h-l*a*E+i*c*E)*M,r[11]=(d*c*s-l*f*s-d*a*h+i*f*h+l*a*m-i*c*m)*M,r[12]=w*M,r[13]=(d*g*o-v*f*o+v*a*p-i*g*p-d*a*y+i*f*y)*M,r[14]=(v*c*o-l*g*o-v*a*u+i*g*u+l*a*y-i*c*y)*M,r[15]=(l*f*o-d*c*o+d*a*u-i*f*u-l*a*p+i*c*p)*M,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,c*o+r,c*s-n*a,0,l*s-n*o,c*s+n*a,i*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var n=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,h=i*l,d=i*c,f=i*u,p=a*c,m=a*u,v=o*u,g=s*l,y=s*c,E=s*u,x=r.x,T=r.y,b=r.z;return n[0]=(1-(p+v))*x,n[1]=(d+E)*x,n[2]=(f-y)*x,n[3]=0,n[4]=(d-E)*T,n[5]=(1-(h+v))*T,n[6]=(m+g)*T,n[7]=0,n[8]=(f+y)*b,n[9]=(m-g)*b,n[10]=(1-(h+p))*b,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:function(e,t,r){var n=this.elements,i=nr.set(n[0],n[1],n[2]).length(),a=nr.set(n[4],n[5],n[6]).length(),o=nr.set(n[8],n[9],n[10]).length(),s=this.determinant();s<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],ir.copy(this);var l=1/i,c=1/a,u=1/o;return ir.elements[0]*=l,ir.elements[1]*=l,ir.elements[2]*=l,ir.elements[4]*=c,ir.elements[5]*=c,ir.elements[6]*=c,ir.elements[8]*=u,ir.elements[9]*=u,ir.elements[10]*=u,t.setFromRotationMatrix(ir),r.x=i,r.y=a,r.z=o,this},makePerspective:function(e,t,r,n,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),l=2*i/(r-n),c=(t+e)/(t-e),u=(r+n)/(r-n),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,r,n,i,a){var o=this.elements,s=1/(t-e),l=1/(r-n),c=1/(a-i),u=(t+e)*s,h=(r+n)*l,d=(a+i)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}});var hr=new ur,dr=new $t;function fr(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||fr.DefaultOrder}function pr(){this.mask=1}fr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],fr.DefaultOrder="XYZ",Object.defineProperties(fr.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(fr.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=jt.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],f=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-u,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,r){return hr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(hr,t,r)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return dr.setFromEuler(this),this.setFromQuaternion(dr,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new rr(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(pr.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!=(this.mask&e.mask)}});var mr=0,vr=new rr,gr=new $t,yr=new ur,Er=new rr,xr=new rr,Tr=new rr,br=new $t,wr=new rr(1,0,0),_r=new rr(0,1,0),Rr=new rr(0,0,1),Mr={type:"added"},Sr={type:"removed"};function Ar(){Object.defineProperty(this,"id",{value:mr++}),this.uuid=jt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ar.DefaultUp.clone();var e=new rr,t=new fr,r=new $t,n=new rr(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ur},normalMatrix:{value:new Xt}}),this.matrix=new ur,this.matrixWorld=new ur,this.matrixAutoUpdate=Ar.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new pr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Lr(){Ar.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ar.DefaultUp=new rr(0,1,0),Ar.DefaultMatrixAutoUpdate=!0,Ar.prototype=Object.assign(Object.create(zt.prototype),{constructor:Ar,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return gr.setFromAxisAngle(e,t),this.quaternion.multiply(gr),this},rotateOnWorldAxis:function(e,t){return gr.setFromAxisAngle(e,t),this.quaternion.premultiply(gr),this},rotateX:function(e){return this.rotateOnAxis(wr,e)},rotateY:function(e){return this.rotateOnAxis(_r,e)},rotateZ:function(e){return this.rotateOnAxis(Rr,e)},translateOnAxis:function(e,t){return vr.copy(e).applyQuaternion(this.quaternion),this.position.add(vr.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(wr,e)},translateY:function(e){return this.translateOnAxis(_r,e)},translateZ:function(e){return this.translateOnAxis(Rr,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(yr.getInverse(this.matrixWorld))},lookAt:function(e,t,r){e.isVector3?Er.copy(e):Er.set(e,t,r);var n=this.parent;this.updateWorldMatrix(!0,!1),xr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?yr.lookAt(xr,Er,this.up):yr.lookAt(Er,xr,this.up),this.quaternion.setFromRotationMatrix(yr),n&&(yr.extractRotation(n.matrixWorld),gr.setFromRotationMatrix(yr),this.quaternion.premultiply(gr.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Mr)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent(Sr)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),yr.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),yr.multiply(e.parent.matrixWorld)),e.applyMatrix4(yr),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r],a=i.getObjectByProperty(e,t);if(void 0!==a)return a}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new rr),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new $t),this.updateMatrixWorld(!0),this.matrixWorld.decompose(xr,e,Tr),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new rr),this.updateMatrixWorld(!0),this.matrixWorld.decompose(xr,br,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new rr),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var n=this.children,i=0,a=n.length;i<a;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var c=o[s];i(e.shapes,c)}else i(e.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var u=[],s=0,l=this.material.length;s<l;s++)u.push(i(e.materials,this.material[s]));n.material=u}else n.material=i(e.materials,this.material);if(this.children.length>0){n.children=[];for(var s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(e).object)}if(t){var h=m(e.geometries),d=m(e.materials),f=m(e.textures),p=m(e.images),o=m(e.shapes);h.length>0&&(r.geometries=h),d.length>0&&(r.materials=d),f.length>0&&(r.textures=f),p.length>0&&(r.images=p),o.length>0&&(r.shapes=o)}return r.object=n,r;function m(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}}),Lr.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Lr,isScene:!0,copy:function(e,t){return Ar.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Ar.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Pr=[new rr,new rr,new rr,new rr,new rr,new rr,new rr,new rr],Cr=new rr,Hr=new Vr,Ir=new rr,kr=new rr,Nr=new rr,Or=new rr,Fr=new rr,Dr=new rr,Ur=new rr,zr=new rr,Br=new rr,Gr=new rr;function Vr(e,t){this.min=void 0!==e?e:new rr(1/0,1/0,1/0),this.max=void 0!==t?t:new rr(-1/0,-1/0,-1/0)}function jr(e,t,r,n,i){var a,o;for(a=0,o=e.length-3;a<=o;a+=3){Gr.fromArray(e,a);var s=i.x*Math.abs(Gr.x)+i.y*Math.abs(Gr.y)+i.z*Math.abs(Gr.z),l=t.dot(Gr),c=r.dot(Gr),u=n.dot(Gr);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}Object.assign(Vr.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=Cr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new rr),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new rr),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Hr.copy(t.boundingBox),Hr.applyMatrix4(e.matrixWorld),this.union(Hr));for(var r=e.children,n=0,i=r.length;n<i;n++)this.expandByObject(r[n]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new rr),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,Cr),Cr.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(Ur),zr.subVectors(this.max,Ur),Ir.subVectors(e.a,Ur),kr.subVectors(e.b,Ur),Nr.subVectors(e.c,Ur),Or.subVectors(kr,Ir),Fr.subVectors(Nr,kr),Dr.subVectors(Ir,Nr);var t=[0,-Or.z,Or.y,0,-Fr.z,Fr.y,0,-Dr.z,Dr.y,Or.z,0,-Or.x,Fr.z,0,-Fr.x,Dr.z,0,-Dr.x,-Or.y,Or.x,0,-Fr.y,Fr.x,0,-Dr.y,Dr.x,0];return!!jr(t,Ir,kr,Nr,zr)&&!!jr(t=[1,0,0,0,1,0,0,0,1],Ir,kr,Nr,zr)&&(Br.crossVectors(Or,Fr),jr(t=[Br.x,Br.y,Br.z],Ir,kr,Nr,zr))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new rr),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=Cr.copy(e).clamp(this.min,this.max);return t.sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Cr).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()?this:(Pr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Pr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Pr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Pr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Pr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Pr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Pr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Pr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Pr),this)},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Wr=new Vr;function Xr(e,t){this.center=void 0!==e?e:new rr,this.radius=void 0!==t?t:0}Object.assign(Xr.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var r=this.center;void 0!==t?r.copy(t):Wr.setFromPoints(e).getCenter(r);for(var n=0,i=0,a=e.length;i<a;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new rr),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Vr),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Yr=new rr,qr=new rr,Zr=new rr,Qr=new rr,Kr=new rr,Jr=new rr,$r=new rr;function en(e,t){this.origin=void 0!==e?e:new rr,this.direction=void 0!==t?t:new rr(0,0,-1)}Object.assign(en.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new rr),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Yr)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new rr),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Yr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Yr.copy(this.direction).multiplyScalar(t).add(this.origin),Yr.distanceToSquared(e))},distanceSqToSegment:function(e,t,r,n){qr.copy(e).add(t).multiplyScalar(.5),Zr.copy(t).sub(e).normalize(),Qr.copy(this.origin).sub(qr);var i,a,o,s,l=.5*e.distanceTo(t),c=-this.direction.dot(Zr),u=Qr.dot(this.direction),h=-Qr.dot(Zr),d=Qr.lengthSq(),f=Math.abs(1-c*c);if(f>0)if(a=c*u-h,s=l*f,(i=c*h-u)>=0)if(a>=-s)if(a<=s){var p=1/f;o=(i*=p)*(i+c*(a*=p)+2*u)+a*(c*i+a+2*h)+d}else a=l,i=Math.max(0,-(c*a+u)),o=-i*i+a*(a+2*h)+d;else a=-l,i=Math.max(0,-(c*a+u)),o=-i*i+a*(a+2*h)+d;else a<=-s?(i=Math.max(0,-(-c*l+u)),a=i>0?-l:Math.min(Math.max(-l,-h),l),o=-i*i+a*(a+2*h)+d):a<=s?(i=0,a=Math.min(Math.max(-l,-h),l),o=a*(a+2*h)+d):(i=Math.max(0,-(c*l+u)),a=i>0?l:Math.min(Math.max(-l,-h),l),o=-i*i+a*(a+2*h)+d);else a=c>0?-l:l,i=Math.max(0,-(c*a+u)),o=-i*i+a*(a+2*h)+d;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(Zr).multiplyScalar(a).add(qr),o},intersectSphere:function(e,t){Yr.subVectors(e.center,this.origin);var r=Yr.dot(this.direction),n=Yr.dot(Yr)-r*r,i=e.radius*e.radius;if(n>i)return null;var a=Math.sqrt(i-n),o=r-a,s=r+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return r*t<0},intersectBox:function(e,t){var r,n,i,a,o,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),r>a||i>n?null:((i>r||r!=r)&&(r=i),(a<n||n!=n)&&(n=a),u>=0?(o=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),r>s||o>n?null:((o>r||r!=r)&&(r=o),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,Yr)},intersectTriangle:function(e,t,r,n,i){Kr.subVectors(t,e),Jr.subVectors(r,e),$r.crossVectors(Kr,Jr);var a,o=this.direction.dot($r);if(o>0){if(n)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Qr.subVectors(this.origin,e);var s=a*this.direction.dot(Jr.crossVectors(Qr,Jr));if(s<0)return null;var l=a*this.direction.dot(Kr.cross(Qr));if(l<0)return null;if(s+l>o)return null;var c=-a*Qr.dot($r);return c<0?null:this.at(c/o,i)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var tn=new rr,rn=new rr,nn=new Xt;function an(e,t){this.normal=void 0!==e?e:new rr(1,0,0),this.constant=void 0!==t?t:0}Object.assign(an.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,r){var n=tn.subVectors(r,t).cross(rn.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new rr),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new rr);var r=e.delta(tn),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/n;return i<0||i>1?void 0:t.copy(r).multiplyScalar(i).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new rr),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var r=t||nn.getNormalMatrix(e),n=this.coplanarPoint(tn).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var on=new rr,sn=new rr,ln=new rr,cn=new rr,un=new rr,hn=new rr,dn=new rr,fn=new rr,pn=new rr,mn=new rr;function vn(e,t,r){this.a=void 0!==e?e:new rr,this.b=void 0!==t?t:new rr,this.c=void 0!==r?r:new rr}Object.assign(vn,{getNormal:function(e,t,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new rr),n.subVectors(r,t),on.subVectors(e,t),n.cross(on);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)},getBarycoord:function(e,t,r,n,i){on.subVectors(n,t),sn.subVectors(r,t),ln.subVectors(e,t);var a=on.dot(on),o=on.dot(sn),s=on.dot(ln),l=sn.dot(sn),c=sn.dot(ln),u=a*l-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new rr),0===u)return i.set(-2,-1,-1);var h=1/u,d=(l*s-o*c)*h,f=(a*c-o*s)*h;return i.set(1-d-f,f,d)},containsPoint:function(e,t,r,n){return vn.getBarycoord(e,t,r,n,cn),cn.x>=0&&cn.y>=0&&cn.x+cn.y<=1},getUV:function(e,t,r,n,i,a,o,s){return this.getBarycoord(e,t,r,n,cn),s.set(0,0),s.addScaledVector(i,cn.x),s.addScaledVector(a,cn.y),s.addScaledVector(o,cn.z),s},isFrontFacing:function(e,t,r,n){return on.subVectors(r,t),sn.subVectors(e,t),on.cross(sn).dot(n)<0}}),Object.assign(vn.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return on.subVectors(this.c,this.b),sn.subVectors(this.a,this.b),.5*on.cross(sn).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new rr),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return vn.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new an),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return vn.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,r,n,i){return vn.getUV(e,this.a,this.b,this.c,t,r,n,i)},containsPoint:function(e){return vn.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return vn.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new rr);var r,n,i=this.a,a=this.b,o=this.c;un.subVectors(a,i),hn.subVectors(o,i),fn.subVectors(e,i);var s=un.dot(fn),l=hn.dot(fn);if(s<=0&&l<=0)return t.copy(i);pn.subVectors(e,a);var c=un.dot(pn),u=hn.dot(pn);if(c>=0&&u<=c)return t.copy(a);var h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return r=s/(s-c),t.copy(i).addScaledVector(un,r);mn.subVectors(e,o);var d=un.dot(mn),f=hn.dot(mn);if(f>=0&&d<=f)return t.copy(o);var p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return n=l/(l-f),t.copy(i).addScaledVector(hn,n);var m=c*f-d*u;if(m<=0&&u-c>=0&&d-f>=0)return dn.subVectors(o,a),n=(u-c)/(u-c+(d-f)),t.copy(a).addScaledVector(dn,n);var v=1/(m+p+h);return r=p*v,n=h*v,t.copy(i).addScaledVector(un,r).addScaledVector(hn,n)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var gn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},yn={h:0,s:0,l:0},En={h:0,s:0,l:0};function xn(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function Tn(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function bn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function wn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function _n(e,t,r,n,i,a){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new rr,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new xn,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}Object.assign(xn.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(e=jt.euclideanModulo(e,1),t=jt.clamp(t,0,1),r=jt.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=Tn(i,n,e+1/3),this.g=Tn(i,n,e),this.b=Tn(i,n,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,i=r[1],a=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(o,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=r[1],u=c.length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=gn[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=bn(e.r),this.g=bn(e.g),this.b=bn(e.b),this},copyLinearToSRGB:function(e){return this.r=wn(e.r),this.g=wn(e.g),this.b=wn(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,i=this.g,a=this.b,o=Math.max(n,i,a),s=Math.min(n,i,a),l=(s+o)/2;if(s===o)t=0,r=0;else{var c=o-s;switch(r=l<=.5?c/(o+s):c/(2-o-s),o){case n:t=(i-a)/c+(i<a?6:0);break;case i:t=(a-n)/c+2;break;case a:t=(n-i)/c+4}t/=6}return e.h=t,e.s=r,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){return this.getHSL(yn),yn.h+=e,yn.s+=t,yn.l+=r,this.setHSL(yn.h,yn.s,yn.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(yn),e.getHSL(En);var r=jt.lerp(yn.h,En.h,t),n=jt.lerp(yn.s,En.s,t),i=jt.lerp(yn.l,En.l,t);return this.setHSL(r,n,i),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),xn.NAMES=gn,Object.assign(_n.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Rn=0;function Mn(){Object.defineProperty(this,"id",{value:Rn++}),this.uuid=jt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=h,this.side=s,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=R,this.blendDst=M,this.blendEquation=v,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=N,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ft,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ot,this.stencilZFail=Ot,this.stencilZPass=Ot,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Sn(e){Mn.call(this),this.type="MeshBasicMaterial",this.color=new xn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}Mn.prototype=Object.assign(Object.create(zt.prototype),{constructor:Mn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==h&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==s&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var i=n(e.textures),a=n(e.images);i.length>0&&(r.textures=i),a.length>0&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Mn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Sn.prototype=Object.create(Mn.prototype),Sn.prototype.constructor=Sn,Sn.prototype.isMeshBasicMaterial=!0,Sn.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var An=new rr;function Ln(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=Dt,this.updateRange={offset:0,count:-1},this.version=0}function Pn(e,t,r){Ln.call(this,new Int8Array(e),t,r)}function Cn(e,t,r){Ln.call(this,new Uint8Array(e),t,r)}function Hn(e,t,r){Ln.call(this,new Uint8ClampedArray(e),t,r)}function In(e,t,r){Ln.call(this,new Int16Array(e),t,r)}function kn(e,t,r){Ln.call(this,new Uint16Array(e),t,r)}function Nn(e,t,r){Ln.call(this,new Int32Array(e),t,r)}function On(e,t,r){Ln.call(this,new Uint32Array(e),t,r)}function Fn(e,t,r){Ln.call(this,new Float32Array(e),t,r)}function Dn(e,t,r){Ln.call(this,new Float64Array(e),t,r)}function Un(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function zn(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}Object.defineProperty(Ln.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ln.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new xn),t[r++]=a.r,t[r++]=a.g,t[r++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new Wt),t[r++]=a.x,t[r++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new rr),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new Qt),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=a.w}return this},applyMatrix3:function(e){for(var t=0,r=this.count;t<r;t++)An.x=this.getX(t),An.y=this.getY(t),An.z=this.getZ(t),An.applyMatrix3(e),this.setXYZ(t,An.x,An.y,An.z);return this},applyMatrix4:function(e){for(var t=0,r=this.count;t<r;t++)An.x=this.getX(t),An.y=this.getY(t),An.z=this.getZ(t),An.applyMatrix4(e),this.setXYZ(t,An.x,An.y,An.z);return this},applyNormalMatrix:function(e){for(var t=0,r=this.count;t<r;t++)An.x=this.getX(t),An.y=this.getY(t),An.z=this.getZ(t),An.applyNormalMatrix(e),this.setXYZ(t,An.x,An.y,An.z);return this},transformDirection:function(e){for(var t=0,r=this.count;t<r;t++)An.x=this.getX(t),An.y=this.getY(t),An.z=this.getZ(t),An.transformDirection(e),this.setXYZ(t,An.x,An.y,An.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Pn.prototype=Object.create(Ln.prototype),Pn.prototype.constructor=Pn,Cn.prototype=Object.create(Ln.prototype),Cn.prototype.constructor=Cn,Hn.prototype=Object.create(Ln.prototype),Hn.prototype.constructor=Hn,In.prototype=Object.create(Ln.prototype),In.prototype.constructor=In,kn.prototype=Object.create(Ln.prototype),kn.prototype.constructor=kn,Nn.prototype=Object.create(Ln.prototype),Nn.prototype.constructor=Nn,On.prototype=Object.create(Ln.prototype),On.prototype.constructor=On,Fn.prototype=Object.create(Ln.prototype),Fn.prototype.constructor=Fn,Dn.prototype=Object.create(Ln.prototype),Dn.prototype.constructor=Dn,Object.assign(Un.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,i=e.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==n&&(n=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,r.push(t)),t={start:3*a,materialIndex:n})}void 0!==t&&(t.count=3*a-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var u,h=e.morphNormals,d=h.length;if(d>0){u=[];for(var c=0;c<d;c++)u[c]={name:h[c].name,data:[]};this.morphTargets.normal=u}var f=e.skinIndices,p=e.skinWeights,m=f.length===n.length,v=p.length===n.length;n.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var c=0;c<r.length;c++){var g=r[c];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var E=g.normal;this.normals.push(E,E,E)}var x=g.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var T=g.color;this.colors.push(T,T,T)}if(!0===a){var b=i[0][c];void 0!==b?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Wt,new Wt,new Wt))}if(!0===o){var b=i[1][c];void 0!==b?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Wt,new Wt,new Wt))}for(var w=0;w<l;w++){var _=s[w].vertices;t[w].data.push(_[g.a],_[g.b],_[g.c])}for(var w=0;w<d;w++){var R=h[w].vertexNormals[c];u[w].data.push(R.a,R.b,R.c)}m&&this.skinIndices.push(f[g.a],f[g.b],f[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Bn=1,Gn=new ur,Vn=new Ar,jn=new rr,Wn=new Vr,Xn=new Vr,Yn=new rr;function qn(){Object.defineProperty(this,"id",{value:Bn+=2}),this.uuid=jt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}qn.prototype=Object.assign(Object.create(zt.prototype),{constructor:qn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(zn(e)>65535?On:kn)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var n=(new Xt).getNormalMatrix(e);r.applyNormalMatrix(n),r.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Gn.makeRotationX(e),this.applyMatrix4(Gn),this},rotateY:function(e){return Gn.makeRotationY(e),this.applyMatrix4(Gn),this},rotateZ:function(e){return Gn.makeRotationZ(e),this.applyMatrix4(Gn),this},translate:function(e,t,r){return Gn.makeTranslation(e,t,r),this.applyMatrix4(Gn),this},scale:function(e,t,r){return Gn.makeScale(e,t,r),this.applyMatrix4(Gn),this},lookAt:function(e){return Vn.lookAt(e),Vn.updateMatrix(),this.applyMatrix4(Vn.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(jn).negate(),this.translate(jn.x,jn.y,jn.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new Fn(3*t.vertices.length,3),n=new Fn(3*t.colors.length,3);if(this.setAttribute("position",r.copyVector3sArray(t.vertices)),this.setAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new Fn(t.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Fn(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Un).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Ln(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Ln(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.setAttribute("color",new Ln(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Ln(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Ln(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],c=0,u=l.length;c<u;c++){var h=l[c],d=new Fn(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var f=new Fn(4*e.skinIndices.length,4);this.setAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var p=new Fn(4*e.skinWeights.length,4);this.setAttribute("skinWeight",p.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Vr);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var r=0,n=t.length;r<n;r++){var i=t[r];Wn.setFromBufferAttribute(i),this.morphTargetsRelative?(Yn.addVectors(this.boundingBox.min,Wn.min),this.boundingBox.expandByPoint(Yn),Yn.addVectors(this.boundingBox.max,Wn.max),this.boundingBox.expandByPoint(Yn)):(this.boundingBox.expandByPoint(Wn.min),this.boundingBox.expandByPoint(Wn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Xr);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var r=this.boundingSphere.center;if(Wn.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var a=t[n];Xn.setFromBufferAttribute(a),this.morphTargetsRelative?(Yn.addVectors(Wn.min,Xn.min),Wn.expandByPoint(Yn),Yn.addVectors(Wn.max,Xn.max),Wn.expandByPoint(Yn)):(Wn.expandByPoint(Xn.min),Wn.expandByPoint(Xn.max))}Wn.getCenter(r);for(var o=0,n=0,i=e.count;n<i;n++)Yn.fromBufferAttribute(e,n),o=Math.max(o,r.distanceToSquared(Yn));if(t)for(var n=0,i=t.length;n<i;n++)for(var a=t[n],s=this.morphTargetsRelative,l=0,c=a.count;l<c;l++)Yn.fromBufferAttribute(a,l),s&&(jn.fromBufferAttribute(e,l),Yn.add(jn)),o=Math.max(o,r.distanceToSquared(Yn));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new Ln(new Float32Array(r.length),3));else for(var n=t.normal.array,i=0,a=n.length;i<a;i++)n[i]=0;var o,s,l,c=t.normal.array,u=new rr,h=new rr,d=new rr,f=new rr,p=new rr;if(e)for(var m=e.array,i=0,a=e.count;i<a;i+=3)o=3*m[i+0],s=3*m[i+1],l=3*m[i+2],u.fromArray(r,o),h.fromArray(r,s),d.fromArray(r,l),f.subVectors(d,h),p.subVectors(u,h),f.cross(p),c[o]+=f.x,c[o+1]+=f.y,c[o+2]+=f.z,c[s]+=f.x,c[s+1]+=f.y,c[s+2]+=f.z,c[l]+=f.x,c[l+1]+=f.y,c[l+2]+=f.z;else for(var i=0,a=r.length;i<a;i+=9)u.fromArray(r,i),h.fromArray(r,i+3),d.fromArray(r,i+6),f.subVectors(d,h),p.subVectors(u,h),f.cross(p),c[i]=f.x,c[i+1]=f.y,c[i+2]=f.z,c[i+3]=f.x,c[i+4]=f.y,c[i+5]=f.z,c[i+6]=f.x,c[i+7]=f.y,c[i+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var i=r[n],a=i.array,o=e.attributes[n],s=o.array,l=o.itemSize*t,c=Math.min(s.length,a.length-l),u=0,h=l;u<c;u++,h++)a[h]=s[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,r=e.count;t<r;t++)Yn.x=e.getX(t),Yn.y=e.getY(t),Yn.z=e.getZ(t),Yn.normalize(),e.setXYZ(t,Yn.x,Yn.y,Yn.z)},toNonIndexed:function(){function e(e,t){for(var r=e.array,n=e.itemSize,i=new r.constructor(t.length*n),a=0,o=0,s=0,l=t.length;s<l;s++){a=t[s]*n;for(var c=0;c<n;c++)i[o++]=r[a++]}return new Ln(i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new qn,r=this.index.array,n=this.attributes;for(var i in n){var a=n[i],o=e(a,r);t.setAttribute(i,o)}var s=this.morphAttributes;for(i in s){for(var l=[],c=s[i],u=0,h=c.length;u<h;u++){var a=c[u],o=e(a,r);l.push(o)}t.morphAttributes[i]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var d=this.groups,u=0,f=d.length;u<f;u++){var p=d[u];t.addGroup(p.start,p.count,p.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;null!==n&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var i=this.attributes;for(var r in i){var a=i[r],o=a.toJSON();""!==a.name&&(o.name=a.name),e.data.attributes[r]=o}var s={},l=!1;for(var r in this.morphAttributes){for(var c=this.morphAttributes[r],u=[],h=0,d=c.length;h<d;h++){var a=c[h],o=a.toJSON();""!==a.name&&(o.name=a.name),u.push(o)}u.length>0&&(s[r]=u,l=!0)}l&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));var p=this.boundingSphere;return null!==p&&(e.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),e},clone:function(){return(new qn).copy(this)},copy:function(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var a=e.attributes;for(t in a){var o=a[t];this.setAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(r=0,n=c.length;r<n;r++)l.push(c[r].clone());this.morphAttributes[t]=l}this.morphTargetsRelative=e.morphTargetsRelative;var u=e.groups;for(r=0,n=u.length;r<n;r++){var h=u[r];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Zn=new ur,Qn=new en,Kn=new Xr,Jn=new rr,$n=new rr,ei=new rr,ti=new rr,ri=new rr,ni=new rr,ii=new rr,ai=new rr,oi=new rr,si=new Wt,li=new Wt,ci=new Wt,ui=new rr,hi=new rr;function di(e,t){Ar.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new qn,this.material=void 0!==t?t:new Sn,this.updateMorphTargets()}function fi(e,t,r,n,i,a,o,s){if(null===(t.side===l?n.intersectTriangle(o,a,i,!0,s):n.intersectTriangle(i,a,o,t.side!==c,s)))return null;hi.copy(s),hi.applyMatrix4(e.matrixWorld);var u=r.ray.origin.distanceTo(hi);return u<r.near||u>r.far?null:{distance:u,point:hi.clone(),object:e}}function pi(e,t,r,n,i,a,o,s,l,c,u,h){Jn.fromBufferAttribute(i,c),$n.fromBufferAttribute(i,u),ei.fromBufferAttribute(i,h);var d=e.morphTargetInfluences;if(t.morphTargets&&a&&d){ii.set(0,0,0),ai.set(0,0,0),oi.set(0,0,0);for(var f=0,p=a.length;f<p;f++){var m=d[f],v=a[f];0!==m&&(ti.fromBufferAttribute(v,c),ri.fromBufferAttribute(v,u),ni.fromBufferAttribute(v,h),o?(ii.addScaledVector(ti,m),ai.addScaledVector(ri,m),oi.addScaledVector(ni,m)):(ii.addScaledVector(ti.sub(Jn),m),ai.addScaledVector(ri.sub($n),m),oi.addScaledVector(ni.sub(ei),m)))}Jn.add(ii),$n.add(ai),ei.add(oi)}var g=fi(e,t,r,n,Jn,$n,ei,ui);if(g){s&&(si.fromBufferAttribute(s,c),li.fromBufferAttribute(s,u),ci.fromBufferAttribute(s,h),g.uv=vn.getUV(ui,Jn,$n,ei,si,li,ci,new Wt)),l&&(si.fromBufferAttribute(l,c),li.fromBufferAttribute(l,u),ci.fromBufferAttribute(l,h),g.uv2=vn.getUV(ui,Jn,$n,ei,si,li,ci,new Wt));var y=new _n(c,u,h);vn.getNormal(Jn,$n,ei,y.normal),g.face=y}return g}di.prototype=Object.assign(Object.create(Ar.prototype),{constructor:di,isMesh:!0,copy:function(e){return Ar.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var r,n=this.geometry,i=this.material,a=this.matrixWorld;if(void 0!==i&&(null===n.boundingSphere&&n.computeBoundingSphere(),Kn.copy(n.boundingSphere),Kn.applyMatrix4(a),!1!==e.ray.intersectsSphere(Kn)&&(Zn.getInverse(a),Qn.copy(e.ray).applyMatrix4(Zn),null===n.boundingBox||!1!==Qn.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var o,s,l,c,u,h,d,f,p,m,v,g=n.index,y=n.attributes.position,E=n.morphAttributes.position,x=n.morphTargetsRelative,T=n.attributes.uv,b=n.attributes.uv2,w=n.groups,_=n.drawRange;if(null!==g)if(Array.isArray(i))for(c=0,h=w.length;c<h;c++)for(f=w[c],p=i[f.materialIndex],m=Math.max(f.start,_.start),v=Math.min(f.start+f.count,_.start+_.count),u=m,d=v;u<d;u+=3)o=g.getX(u),s=g.getX(u+1),l=g.getX(u+2),(r=pi(this,p,e,Qn,y,E,x,T,b,o,s,l))&&(r.faceIndex=Math.floor(u/3),r.face.materialIndex=f.materialIndex,t.push(r));else for(m=Math.max(0,_.start),v=Math.min(g.count,_.start+_.count),c=m,h=v;c<h;c+=3)o=g.getX(c),s=g.getX(c+1),l=g.getX(c+2),(r=pi(this,i,e,Qn,y,E,x,T,b,o,s,l))&&(r.faceIndex=Math.floor(c/3),t.push(r));else if(void 0!==y)if(Array.isArray(i))for(c=0,h=w.length;c<h;c++)for(f=w[c],p=i[f.materialIndex],m=Math.max(f.start,_.start),v=Math.min(f.start+f.count,_.start+_.count),u=m,d=v;u<d;u+=3)(r=pi(this,p,e,Qn,y,E,x,T,b,o=u,s=u+1,l=u+2))&&(r.faceIndex=Math.floor(u/3),r.face.materialIndex=f.materialIndex,t.push(r));else for(m=Math.max(0,_.start),v=Math.min(y.count,_.start+_.count),c=m,h=v;c<h;c+=3)(r=pi(this,i,e,Qn,y,E,x,T,b,o=c,s=c+1,l=c+2))&&(r.faceIndex=Math.floor(c/3),t.push(r))}else if(n.isGeometry){var R,M,S,A,L=Array.isArray(i),P=n.vertices,C=n.faces,H=n.faceVertexUvs[0];H.length>0&&(A=H);for(var I=0,k=C.length;I<k;I++){var N=C[I],O=L?i[N.materialIndex]:i;if(void 0!==O&&(R=P[N.a],M=P[N.b],S=P[N.c],r=fi(this,O,e,Qn,R,M,S,ui))){if(A&&A[I]){var F=A[I];si.copy(F[0]),li.copy(F[1]),ci.copy(F[2]),r.uv=vn.getUV(ui,R,M,S,si,li,ci,new Wt)}r.face=N,r.faceIndex=I,t.push(r)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var mi=0,vi=new ur,gi=new Ar,yi=new rr;function Ei(){Object.defineProperty(this,"id",{value:mi+=2}),this.uuid=jt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Ei.prototype=Object.assign(Object.create(zt.prototype),{constructor:Ei,isGeometry:!0,applyMatrix4:function(e){for(var t=(new Xt).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++){var i=this.vertices[r];i.applyMatrix4(e)}for(var r=0,n=this.faces.length;r<n;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;o<s;o++)a.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return vi.makeRotationX(e),this.applyMatrix4(vi),this},rotateY:function(e){return vi.makeRotationY(e),this.applyMatrix4(vi),this},rotateZ:function(e){return vi.makeRotationZ(e),this.applyMatrix4(vi),this},translate:function(e,t,r){return vi.makeTranslation(e,t,r),this.applyMatrix4(vi),this},scale:function(e,t,r){return vi.makeScale(e,t,r),this.applyMatrix4(vi),this},lookAt:function(e){return gi.lookAt(e),gi.updateMatrix(),this.applyMatrix4(gi.matrix),this},fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,o=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=0;c<i.length;c+=3)t.vertices.push((new rr).fromArray(i,c)),void 0!==o&&t.colors.push((new xn).fromArray(o,c));function u(e,r,n,i){var c=void 0===o?[]:[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()],u=void 0===a?[]:[(new rr).fromArray(a,3*e),(new rr).fromArray(a,3*r),(new rr).fromArray(a,3*n)],h=new _n(e,r,n,u,c,i);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new Wt).fromArray(s,2*e),(new Wt).fromArray(s,2*r),(new Wt).fromArray(s,2*n)]),void 0!==l&&t.faceVertexUvs[1].push([(new Wt).fromArray(l,2*e),(new Wt).fromArray(l,2*r),(new Wt).fromArray(l,2*n)])}var h=e.groups;if(h.length>0)for(var c=0;c<h.length;c++)for(var d=h[c],f=d.start,p=d.count,m=f,v=f+p;m<v;m+=3)void 0!==r?u(r[m],r[m+1],r[m+2],d.materialIndex):u(m,m+1,m+2,d.materialIndex);else if(void 0!==r)for(var c=0;c<r.length;c+=3)u(r[c],r[c+1],r[c+2]);else for(var c=0;c<i.length/3;c+=3)u(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(yi).negate(),this.translate(yi.x,yi.y,yi.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new ur;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){for(var e=new rr,t=new rr,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)o[t]=new rr;if(e){var s,l,c,u=new rr,h=new rr;for(n=0,i=this.faces.length;n<i;n++)a=this.faces[n],s=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),o[a.a].add(u),o[a.b].add(u),o[a.c].add(u)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)a=this.faces[n],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,r=this.vertices.length;t<r;t++)o[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var d=(a=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(o[a.a]),d[1].copy(o[a.b]),d[2].copy(o[a.c])):(d[0]=o[a.a].clone(),d[1]=o[a.b].clone(),d[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var a=new Ei;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new rr,c={a:new rr,b:new rr,c:new rr},o.push(l),s.push(c)}var l,c,u=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],l=u.faceNormals[r],c=u.vertexNormals[r],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Vr),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Xr),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,c=this.colors,u=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new Xt).getNormalMatrix(t));for(var h=0,d=o.length;h<d;h++){var f=o[h],p=f.clone();void 0!==t&&p.applyMatrix4(t),a.push(p)}for(var h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(h=0,d=l.length;h<d;h++){var m,v,g,y=l[h],E=y.vertexNormals,x=y.vertexColors;(m=new _n(y.a+i,y.b+i,y.c+i)).normal.copy(y.normal),void 0!==n&&m.normal.applyMatrix3(n).normalize();for(var T=0,b=E.length;T<b;T++)v=E[T].clone(),void 0!==n&&v.applyMatrix3(n).normalize(),m.vertexNormals.push(v);m.color.copy(y.color);for(var T=0,b=x.length;T<b;T++)g=x[T],m.vertexColors.push(g.clone());m.materialIndex=y.materialIndex+r,s.push(m)}for(var h=0,d=e.faceVertexUvs.length;h<d;h++){var w=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(var T=0,b=w.length;T<b;T++){for(var _=w[T],R=[],M=0,S=_.length;M<S;M++)R.push(_[M].clone());this.faceVertexUvs[h].push(R)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,n,i,a,o,s,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h),void 0===l[t]?(l[t]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[t]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],a=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(a[f]===a[(f+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var p=d[r];for(this.faces.splice(p,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(p,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new rr(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(n=[]),o&&o.length===t&&(i=[]);for(var r=0;r<t;r++){var s=e[r]._id;n&&n.push(a[s]),i&&i.push(o[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}for(var o=[],s=[],l={},c=[],u={},h=[],d={},i=0;i<this.faces.length;i++){var f=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=f.normal.length()>0,v=f.vertexNormals.length>0,g=1!==f.color.r||1!==f.color.g||1!==f.color.b,y=f.vertexColors.length>0,E=0;if(E=w(E,0,0),E=w(E,1,!0),E=w(E,2,!1),E=w(E,3,p),E=w(E,4,m),E=w(E,5,v),E=w(E,6,g),E=w(E,7,y),o.push(E),o.push(f.a,f.b,f.c),o.push(f.materialIndex),p){var x=this.faceVertexUvs[0][i];o.push(M(x[0]),M(x[1]),M(x[2]))}if(m&&o.push(_(f.normal)),v){var T=f.vertexNormals;o.push(_(T[0]),_(T[1]),_(T[2]))}if(g&&o.push(R(f.color)),y){var b=f.vertexColors;o.push(R(b[0]),R(b[1]),R(b[2]))}}function w(e,t,r){return r?e|1<<t:e&~(1<<t)}function _(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function R(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function M(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/2,h.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=n,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=o,e},clone:function(){return(new Ei).copy(this)},copy:function(e){var t,r,n,i,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,r=c.length;t<r;t++)this.faces.push(c[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=u.length;n<i;n++){var h=u[n],d=[];for(a=0,o=h.length;a<o;a++){var f=h[a];d.push(f.clone())}this.faceVertexUvs[t].push(d)}}var p=e.morphTargets;for(t=0,r=p.length;t<r;t++){var m={};if(m.name=p[t].name,void 0!==p[t].vertices)for(m.vertices=[],n=0,i=p[t].vertices.length;n<i;n++)m.vertices.push(p[t].vertices[n].clone());if(void 0!==p[t].normals)for(m.normals=[],n=0,i=p[t].normals.length;n<i;n++)m.normals.push(p[t].normals[n].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,r=v.length;t<r;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],n=0,i=v[t].vertexNormals.length;n<i;n++){var y=v[t].vertexNormals[n],E={};E.a=y.a.clone(),E.b=y.b.clone(),E.c=y.c.clone(),g.vertexNormals.push(E)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],n=0,i=v[t].faceNormals.length;n<i;n++)g.faceNormals.push(v[t].faceNormals[n].clone());this.morphNormals.push(g)}var x=e.skinWeights;for(t=0,r=x.length;t<r;t++)this.skinWeights.push(x[t].clone());var T=e.skinIndices;for(t=0,r=T.length;t<r;t++)this.skinIndices.push(T[t].clone());var b=e.lineDistances;for(t=0,r=b.length;t<r;t++)this.lineDistances.push(b[t]);var w=e.boundingBox;null!==w&&(this.boundingBox=w.clone());var _=e.boundingSphere;return null!==_&&(this.boundingSphere=_.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var xi=function(e){function t(t,r,n,i,a,o){e.call(this),this.type="BoxGeometry",this.parameters={width:t,height:r,depth:n,widthSegments:i,heightSegments:a,depthSegments:o},this.fromBufferGeometry(new Ti(t,r,n,i,a,o)),this.mergeVertices()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Ei),Ti=function(e){function t(t,r,n,i,a,o){e.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:r,depth:n,widthSegments:i,heightSegments:a,depthSegments:o};var s=this;t=t||1,r=r||1,n=n||1,i=Math.floor(i)||1,a=Math.floor(a)||1,o=Math.floor(o)||1;var l=[],c=[],u=[],h=[],d=0,f=0;function p(e,t,r,n,i,a,o,p,m,v,g){var y,E,x=a/m,T=o/v,b=a/2,w=o/2,_=p/2,R=m+1,M=v+1,S=0,A=0,L=new rr;for(E=0;E<M;E++){var P=E*T-w;for(y=0;y<R;y++){var C=y*x-b;L[e]=C*n,L[t]=P*i,L[r]=_,c.push(L.x,L.y,L.z),L[e]=0,L[t]=0,L[r]=p>0?1:-1,u.push(L.x,L.y,L.z),h.push(y/m),h.push(1-E/v),S+=1}}for(E=0;E<v;E++)for(y=0;y<m;y++){var H=d+y+R*E,I=d+y+R*(E+1),k=d+(y+1)+R*(E+1),N=d+(y+1)+R*E;l.push(H,I,N),l.push(I,k,N),A+=6}s.addGroup(f,A,g),f+=A,d+=S}p("z","y","x",-1,-1,n,r,t,o,a,0),p("z","y","x",1,-1,n,r,-t,o,a,1),p("x","z","y",1,1,t,n,r,i,o,2),p("x","z","y",1,-1,t,n,-r,i,o,3),p("x","y","z",1,-1,t,r,n,i,a,4),p("x","y","z",-1,-1,t,r,-n,i,a,5),this.setIndex(l),this.setAttribute("position",new Fn(c,3)),this.setAttribute("normal",new Fn(u,3)),this.setAttribute("uv",new Fn(h,2))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(qn);function bi(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}function wi(e){for(var t={},r=0;r<e.length;r++){var n=bi(e[r]);for(var i in n)t[i]=n[i]}return t}var _i={clone:bi,merge:wi},Ri="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",Mi="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function Si(e){Mn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Ri,this.fragmentShader=Mi,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Ai(){Ar.call(this),this.type="Camera",this.matrixWorldInverse=new ur,this.projectionMatrix=new ur,this.projectionMatrixInverse=new ur}function Li(e,t,r,n){Ai.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Si.prototype=Object.create(Mn.prototype),Si.prototype.constructor=Si,Si.prototype.isShaderMaterial=!0,Si.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=bi(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Si.prototype.toJSON=function(e){var t=Mn.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var n=this.uniforms[r],i=n.value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t},Ai.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Ai,isCamera:!0,copy:function(e,t){return Ar.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new rr),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Ar.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){Ar.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Li.prototype=Object.assign(Object.create(Ai.prototype),{constructor:Li,isPerspectiveCamera:!0,copy:function(e,t){return Ai.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*jt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*jt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*jt.RAD2DEG*Math.atan(Math.tan(.5*jt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*jt.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*n/o,t-=a.offsetY*r/s,n*=a.width/o,r*=a.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Ar.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var Pi=90,Ci=1;function Hi(e,t,r,n){Ar.call(this),this.type="CubeCamera";var i=new Li(Pi,Ci,e,t);i.up.set(0,-1,0),i.lookAt(new rr(1,0,0)),this.add(i);var a=new Li(Pi,Ci,e,t);a.up.set(0,-1,0),a.lookAt(new rr(-1,0,0)),this.add(a);var o=new Li(Pi,Ci,e,t);o.up.set(0,0,1),o.lookAt(new rr(0,1,0)),this.add(o);var s=new Li(Pi,Ci,e,t);s.up.set(0,0,-1),s.lookAt(new rr(0,-1,0)),this.add(s);var l=new Li(Pi,Ci,e,t);l.up.set(0,-1,0),l.lookAt(new rr(0,0,1)),this.add(l);var c=new Li(Pi,Ci,e,t);c.up.set(0,-1,0),c.lookAt(new rr(0,0,-1)),this.add(c),n=n||{format:_e,magFilter:le,minFilter:le},this.renderTarget=new Ii(r,n),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=e.getRenderTarget(),n=this.renderTarget,u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=u,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(r)},this.clear=function(e,t,r,n){for(var i=e.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)e.setRenderTarget(a,o),e.clear(t,r,n);e.setRenderTarget(i)}}function Ii(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),Kt.call(this,e,e,t)}function ki(e,t,r,n,i,a,o,s,l,c,u,h){Zt.call(this,null,a,o,s,l,c,n,i,u,h),this.image={data:e||null,width:t||1,height:r||1},this.magFilter=void 0!==l?l:ae,this.minFilter=void 0!==c?c:ae,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Hi.prototype=Object.create(Ar.prototype),Hi.prototype.constructor=Hi,Ii.prototype=Object.create(Kt.prototype),Ii.prototype.constructor=Ii,Ii.prototype.isWebGLCubeRenderTarget=!0,Ii.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new Lr,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new Si({type:"CubemapFromEquirect",uniforms:bi(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:l,blending:u});i.uniforms.tEquirect.value=t;var a=new di(new Ti(5,5,5),i);r.add(a);var o=new Hi(1,10,1);return o.renderTarget=this,o.renderTarget.texture.name="CubeCameraTexture",o.update(e,r),a.geometry.dispose(),a.material.dispose(),this},ki.prototype=Object.create(Zt.prototype),ki.prototype.constructor=ki,ki.prototype.isDataTexture=!0;var Ni=new Xr,Oi=new rr;function Fi(e,t,r,n,i,a){this.planes=[void 0!==e?e:new an,void 0!==t?t:new an,void 0!==r?r:new an,void 0!==n?n:new an,void 0!==i?i:new an,void 0!==a?a:new an]}Object.assign(Fi.prototype,{set:function(e,t,r,n,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromProjectionMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],f=r[10],p=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(o-n,u-s,p-h,y-m).normalize(),t[1].setComponents(o+n,u+s,p+h,y+m).normalize(),t[2].setComponents(o+i,u+l,p+d,y+v).normalize(),t[3].setComponents(o-i,u-l,p-d,y-v).normalize(),t[4].setComponents(o-a,u-c,p-f,y-g).normalize(),t[5].setComponents(o+a,u+c,p+f,y+g).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Ni.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ni)},intersectsSprite:function(e){return Ni.center.set(0,0,0),Ni.radius=.7071067811865476,Ni.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ni)},intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++){var a=t[i].distanceToPoint(r);if(a<n)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];if(Oi.x=n.normal.x>0?e.max.x:e.min.x,Oi.y=n.normal.y>0?e.max.y:e.min.y,Oi.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Oi)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var Di={common:{diffuse:{value:new xn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Xt},uv2Transform:{value:new Xt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Wt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new xn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new xn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Xt}},sprite:{diffuse:{value:new xn(15658734)},opacity:{value:1},center:{value:new Wt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Xt}}};function Ui(){var e=null,t=!1,r=null;function n(i,a){!1!==t&&(r(i,a),e.requestAnimationFrame(n))}return{start:function(){!0!==t&&null!==r&&(e.requestAnimationFrame(n),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function zi(e,t){var r=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var r=n.get(t);r&&(e.deleteBuffer(r.buffer),n.delete(t))},update:function(t,i){t.isInterleavedBufferAttribute&&(t=t.data);var a=n.get(t);void 0===a?n.set(t,function(t,r){var n=t.array,i=t.usage,a=e.createBuffer();e.bindBuffer(r,a),e.bufferData(r,n,i),t.onUploadCallback();var o=5126;return n instanceof Float32Array?o=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?o=5123:n instanceof Int16Array?o=5122:n instanceof Uint32Array?o=5125:n instanceof Int32Array?o=5124:n instanceof Int8Array?o=5120:n instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,i)):a.version<t.version&&(function(t,n,i){var a=n.array,o=n.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(r?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(a.buffer,t,i),a.version=t.version)}}}function Bi(e,t,r,n){Ei.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Gi(e,t,r,n)),this.mergeVertices()}function Gi(e,t,r,n){qn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,a,o=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(r)||1,c=Math.floor(n)||1,u=l+1,h=c+1,d=e/l,f=t/c,p=[],m=[],v=[],g=[];for(a=0;a<h;a++){var y=a*f-s;for(i=0;i<u;i++){var E=i*d-o;m.push(E,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-a/c)}}for(a=0;a<c;a++)for(i=0;i<l;i++){var x=i+u*a,T=i+u*(a+1),b=i+1+u*(a+1),w=i+1+u*a;p.push(x,T,w),p.push(T,b,w)}this.setIndex(p),this.setAttribute("position",new Fn(m,3)),this.setAttribute("normal",new Fn(v,3)),this.setAttribute("uv",new Fn(g,2))}Bi.prototype=Object.create(Ei.prototype),Bi.prototype.constructor=Bi,Gi.prototype=Object.create(qn.prototype),Gi.prototype.constructor=Gi;var Vi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP ) && ! defined( TOON )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP ) && ! defined( TOON )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP ) && ! defined( TOON )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},ji={basic:{uniforms:wi([Di.common,Di.specularmap,Di.envmap,Di.aomap,Di.lightmap,Di.fog]),vertexShader:Vi.meshbasic_vert,fragmentShader:Vi.meshbasic_frag},lambert:{uniforms:wi([Di.common,Di.specularmap,Di.envmap,Di.aomap,Di.lightmap,Di.emissivemap,Di.fog,Di.lights,{emissive:{value:new xn(0)}}]),vertexShader:Vi.meshlambert_vert,fragmentShader:Vi.meshlambert_frag},phong:{uniforms:wi([Di.common,Di.specularmap,Di.envmap,Di.aomap,Di.lightmap,Di.emissivemap,Di.bumpmap,Di.normalmap,Di.displacementmap,Di.fog,Di.lights,{emissive:{value:new xn(0)},specular:{value:new xn(1118481)},shininess:{value:30}}]),vertexShader:Vi.meshphong_vert,fragmentShader:Vi.meshphong_frag},standard:{uniforms:wi([Di.common,Di.envmap,Di.aomap,Di.lightmap,Di.emissivemap,Di.bumpmap,Di.normalmap,Di.displacementmap,Di.roughnessmap,Di.metalnessmap,Di.fog,Di.lights,{emissive:{value:new xn(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Vi.meshphysical_vert,fragmentShader:Vi.meshphysical_frag},toon:{uniforms:wi([Di.common,Di.specularmap,Di.aomap,Di.lightmap,Di.emissivemap,Di.bumpmap,Di.normalmap,Di.displacementmap,Di.gradientmap,Di.fog,Di.lights,{emissive:{value:new xn(0)},specular:{value:new xn(1118481)},shininess:{value:30}}]),vertexShader:Vi.meshtoon_vert,fragmentShader:Vi.meshtoon_frag},matcap:{uniforms:wi([Di.common,Di.bumpmap,Di.normalmap,Di.displacementmap,Di.fog,{matcap:{value:null}}]),vertexShader:Vi.meshmatcap_vert,fragmentShader:Vi.meshmatcap_frag},points:{uniforms:wi([Di.points,Di.fog]),vertexShader:Vi.points_vert,fragmentShader:Vi.points_frag},dashed:{uniforms:wi([Di.common,Di.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vi.linedashed_vert,fragmentShader:Vi.linedashed_frag},depth:{uniforms:wi([Di.common,Di.displacementmap]),vertexShader:Vi.depth_vert,fragmentShader:Vi.depth_frag},normal:{uniforms:wi([Di.common,Di.bumpmap,Di.normalmap,Di.displacementmap,{opacity:{value:1}}]),vertexShader:Vi.normal_vert,fragmentShader:Vi.normal_frag},sprite:{uniforms:wi([Di.sprite,Di.fog]),vertexShader:Vi.sprite_vert,fragmentShader:Vi.sprite_frag},background:{uniforms:{uvTransform:{value:new Xt},t2D:{value:null}},vertexShader:Vi.background_vert,fragmentShader:Vi.background_frag},cube:{uniforms:wi([Di.envmap,{opacity:{value:1}}]),vertexShader:Vi.cube_vert,fragmentShader:Vi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vi.equirect_vert,fragmentShader:Vi.equirect_frag},distanceRGBA:{uniforms:wi([Di.common,Di.displacementmap,{referencePosition:{value:new rr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vi.distanceRGBA_vert,fragmentShader:Vi.distanceRGBA_frag},shadow:{uniforms:wi([Di.lights,Di.fog,{color:{value:new xn(0)},opacity:{value:1}}]),vertexShader:Vi.shadow_vert,fragmentShader:Vi.shadow_frag}};function Wi(e,t,r,n){var i,a,o=new xn(0),c=0,u=null,h=0,d=null;function f(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,n)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),f(o,c=void 0!==t?t:1)},getClearAlpha:function(){return c},setClearAlpha:function(e){f(o,c=e)},render:function(t,n,p,m){var v=n.background,g=e.xr,y=g.getSession&&g.getSession();if(y&&"additive"===y.environmentBlendMode&&(v=null),null===v?f(o,c):v&&v.isColor&&(f(v,1),m=!0),(e.autoClear||m)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.isWebGLCubeRenderTarget||v.mapping===ee)){void 0===a&&((a=new di(new Ti(1,1,1),new Si({type:"BackgroundCubeMaterial",uniforms:bi(ji.cube.uniforms),vertexShader:ji.cube.vertexShader,fragmentShader:ji.cube.fragmentShader,side:l,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a));var E=v.isWebGLCubeRenderTarget?v.texture:v;a.material.uniforms.envMap.value=E,a.material.uniforms.flipEnvMap.value=E.isCubeTexture?-1:1,u===v&&h===E.version&&d===e.toneMapping||(a.material.needsUpdate=!0,u=v,h=E.version,d=e.toneMapping),t.unshift(a,a.geometry,a.material,0,0,null)}else v&&v.isTexture&&(void 0===i&&((i=new di(new Gi(2,2),new Si({type:"BackgroundMaterial",uniforms:bi(ji.background.uniforms),vertexShader:ji.background.vertexShader,fragmentShader:ji.background.fragmentShader,side:s,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),i.material.uniforms.uvTransform.value.copy(v.matrix),u===v&&h===v.version&&d===e.toneMapping||(i.material.needsUpdate=!0,u=v,h=v.version,d=e.toneMapping),t.unshift(i,i.geometry,i.material,0,0,null))}}}function Xi(e,t,r,n){var i,a=n.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,n){e.drawArrays(i,t,n),r.update(n,i)},this.renderInstances=function(n,o,s,l){if(0!==l){var c,u;if(a)c=e,u="drawArraysInstanced";else if(c=t.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](i,o,s,l),r.update(s,i,l)}}}function Yi(e,t,r){var n;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==r.precision?r.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===r.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),p=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=u>0,y=a||!!t.get("OES_texture_float"),E=g&&y,x=a?e.getParameter(36183):0;return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=t.get("EXT_texture_filter_anisotropic");return n=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:E,maxSamples:x}}function qi(){var e=this,t=null,r=0,n=!1,i=!1,a=new an,o=new Xt,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(t,r,n,i){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=s.value,!0!==i||null===c){var u=n+4*l,h=r.matrixWorldInverse;o.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var d=0,f=n;d!==l;++d,f+=4)a.copy(t[d]).applyMatrix4(h,o),a.normal.toArray(c,f),c[f+3]=a.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=l,e.numIntersection=0,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,a){var o=0!==e.length||i||0!==r||n;return n=i,t=c(e,a,0),r=e.length,o},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,l()},this.setState=function(e,a,o,u,h,d){if(!n||null===e||0===e.length||i&&!o)i?c(null):l();else{var f=i?0:r,p=4*f,m=h.clippingState||null;s.value=m,m=c(e,u,p,d);for(var v=0;v!==p;++v)m[v]=t[v];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=f}}}function Zi(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}}}function Qi(e,t,r){var n=new WeakMap,i=new WeakMap;function a(e){var o=e.target,s=n.get(o);for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);o.removeEventListener("dispose",a),n.delete(o);var c=i.get(s);c&&(t.remove(c),i.delete(s)),r.memory.geometries--}function o(e){var r=[],n=e.index,a=e.attributes.position,o=0;if(null!==n){var s=n.array;o=n.version;for(var l=0,c=s.length;l<c;l+=3){var u=s[l+0],h=s[l+1],d=s[l+2];r.push(u,h,h,d,d,u)}}else{var s=a.array;o=a.version;for(var l=0,c=s.length/3-1;l<c;l+=3){var u=l+0,h=l+1,d=l+2;r.push(u,h,h,d,d,u)}}var f=new(zn(r)>65535?On:kn)(r,1);f.version=o,t.update(f,34963);var p=i.get(e);p&&t.remove(p),i.set(e,f)}return{get:function(e,t){var i=n.get(t);return i||(t.addEventListener("dispose",a),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new qn).setFromObject(e)),i=t._bufferGeometry),n.set(t,i),r.memory.geometries++,i)},update:function(e){var r=e.index,n=e.attributes;for(var i in null!==r&&t.update(r,34963),n)t.update(n[i],34962);var a=e.morphAttributes;for(var i in a)for(var o=a[i],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var r=e.index;null!==r&&t.version<r.version&&o(e)}else o(e);return i.get(e)}}}function Ki(e,t,r,n){var i,a,o,s=n.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,n){e.drawElements(i,n,a,t*o),r.update(n,i)},this.renderInstances=function(n,l,c,u){if(0!==u){var h,d;if(s)h=e,d="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](i,c,a,l*o,u),r.update(c,i,u)}}}function Ji(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,r,n){switch(n=n||1,t.calls++,r){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function $i(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ea(e){var t={},r=new Float32Array(8);return{update:function(n,i,a,o){var s=n.morphTargetInfluences,l=void 0===s?0:s.length,c=t[i.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];t[i.id]=c}for(var h=a.morphTargets&&i.morphAttributes.position,d=a.morphNormals&&i.morphAttributes.normal,u=0;u<l;u++){var f=c[u];0!==f[1]&&(h&&i.deleteAttribute("morphTarget"+u),d&&i.deleteAttribute("morphNormal"+u))}for(var u=0;u<l;u++){var f=c[u];f[0]=u,f[1]=s[u]}c.sort($i);for(var p=0,u=0;u<8;u++){var f=c[u];if(f){var m=f[0],v=f[1];if(v){h&&i.setAttribute("morphTarget"+u,h[m]),d&&i.setAttribute("morphNormal"+u,d[m]),r[u]=v,p+=v;continue}}r[u]=0}var g=i.morphTargetsRelative?1:1-p;o.getUniforms().setValue(e,"morphTargetBaseInfluence",g),o.getUniforms().setValue(e,"morphTargetInfluences",r)}}}function ta(e,t,r,n){var i=new WeakMap;return{update:function(e){var a=n.render.frame,o=e.geometry,s=t.get(e,o);return i.get(s)!==a&&(o.isGeometry&&s.updateFromObject(e),t.update(s),i.set(s,a)),e.isInstancedMesh&&r.update(e.instanceMatrix,34962),s},dispose:function(){i=new WeakMap}}}function ra(e,t,r,n,i,a,o,s,l,c){e=void 0!==e?e:[],t=void 0!==t?t:Z,o=void 0!==o?o:_e,Zt.call(this,e,t,r,n,i,a,o,s,l,c),this.flipY=!1}function na(e,t,r,n){Zt.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:n||1},this.magFilter=ae,this.minFilter=ae,this.wrapR=ne,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function ia(e,t,r,n){Zt.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:n||1},this.magFilter=ae,this.minFilter=ae,this.wrapR=ne,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ji.physical={uniforms:wi([ji.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new xn(0)},clearcoatNormalScale:{value:new Wt(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:Vi.meshphysical_vert,fragmentShader:Vi.meshphysical_frag},ra.prototype=Object.create(Zt.prototype),ra.prototype.constructor=ra,ra.prototype.isCubeTexture=!0,Object.defineProperty(ra.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),na.prototype=Object.create(Zt.prototype),na.prototype.constructor=na,na.prototype.isDataTexture2DArray=!0,ia.prototype=Object.create(Zt.prototype),ia.prototype.constructor=ia,ia.prototype.isDataTexture3D=!0;var aa=new Zt,oa=new na,sa=new ia,la=new ra,ca=[],ua=[],ha=new Float32Array(16),da=new Float32Array(9),fa=new Float32Array(4);function pa(e,t,r){var n=e[0];if(n<=0||n>0)return e;var i=t*r,a=ca[i];if(void 0===a&&(a=new Float32Array(i),ca[i]=a),0!==t){n.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=r,e[o].toArray(a,s)}return a}function ma(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function va(e,t){for(var r=0,n=t.length;r<n;r++)e[r]=t[r]}function ga(e,t){var r=ua[t];void 0===r&&(r=new Int32Array(t),ua[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocateTextureUnit();return r}function ya(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function Ea(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(ma(r,t))return;e.uniform2fv(this.addr,t),va(r,t)}}function xa(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(ma(r,t))return;e.uniform3fv(this.addr,t),va(r,t)}}function Ta(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(ma(r,t))return;e.uniform4fv(this.addr,t),va(r,t)}}function ba(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(ma(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),va(r,t)}else{if(ma(r,n))return;fa.set(n),e.uniformMatrix2fv(this.addr,!1,fa),va(r,n)}}function wa(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(ma(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),va(r,t)}else{if(ma(r,n))return;da.set(n),e.uniformMatrix3fv(this.addr,!1,da),va(r,n)}}function _a(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(ma(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),va(r,t)}else{if(ma(r,n))return;ha.set(n),e.uniformMatrix4fv(this.addr,!1,ha),va(r,n)}}function Ra(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(t||aa,i)}function Ma(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(t||oa,i)}function Sa(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||sa,i)}function Aa(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(t||la,i)}function La(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function Pa(e,t){var r=this.cache;ma(r,t)||(e.uniform2iv(this.addr,t),va(r,t))}function Ca(e,t){var r=this.cache;ma(r,t)||(e.uniform3iv(this.addr,t),va(r,t))}function Ha(e,t){var r=this.cache;ma(r,t)||(e.uniform4iv(this.addr,t),va(r,t))}function Ia(e,t){var r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function ka(e,t){e.uniform1fv(this.addr,t)}function Na(e,t){e.uniform1iv(this.addr,t)}function Oa(e,t){e.uniform2iv(this.addr,t)}function Fa(e,t){e.uniform3iv(this.addr,t)}function Da(e,t){e.uniform4iv(this.addr,t)}function Ua(e,t){var r=pa(t,this.size,2);e.uniform2fv(this.addr,r)}function za(e,t){var r=pa(t,this.size,3);e.uniform3fv(this.addr,r)}function Ba(e,t){var r=pa(t,this.size,4);e.uniform4fv(this.addr,r)}function Ga(e,t){var r=pa(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function Va(e,t){var r=pa(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function ja(e,t){var r=pa(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function Wa(e,t,r){var n=t.length,i=ga(r,n);e.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTexture2D(t[a]||aa,i[a])}function Xa(e,t,r){var n=t.length,i=ga(r,n);e.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTextureCube(t[a]||la,i[a])}function Ya(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ya;case 35664:return Ea;case 35665:return xa;case 35666:return Ta;case 35674:return ba;case 35675:return wa;case 35676:return _a;case 5124:case 35670:return La;case 35667:case 35671:return Pa;case 35668:case 35672:return Ca;case 35669:case 35673:return Ha;case 5125:return Ia;case 35678:case 36198:case 36298:case 36306:case 35682:return Ra;case 35679:case 36299:case 36307:return Sa;case 35680:case 36300:case 36308:case 36293:return Aa;case 36289:case 36303:case 36311:case 36292:return Ma}}(t.type)}function qa(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ka;case 35664:return Ua;case 35665:return za;case 35666:return Ba;case 35674:return Ga;case 35675:return Va;case 35676:return ja;case 5124:case 35670:return Na;case 35667:case 35671:return Oa;case 35668:case 35672:return Fa;case 35669:case 35673:return Da;case 35678:case 36198:case 36298:case 36306:case 35682:return Wa;case 35680:case 36300:case 36308:case 36293:return Xa}}(t.type)}function Za(e){this.id=e,this.seq=[],this.map={}}qa.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),va(t,e)},Za.prototype.setValue=function(e,t,r){for(var n=this.seq,i=0,a=n.length;i!==a;++i){var o=n[i];o.setValue(e,t[o.id],r)}};var Qa=/([\w\d_]+)(\])?(\[|\.)?/g;function Ka(e,t){e.seq.push(t),e.map[t.id]=t}function Ja(e,t,r){var n=e.name,i=n.length;for(Qa.lastIndex=0;;){var a=Qa.exec(n),o=Qa.lastIndex,s=a[1],l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===i){Ka(r,void 0===c?new Ya(s,e,t):new qa(s,e,t));break}var u=r.map,h=u[s];void 0===h&&(h=new Za(s),Ka(r,h)),r=h}}function $a(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,35718),n=0;n<r;++n){var i=e.getActiveUniform(t,n),a=e.getUniformLocation(t,i.name);Ja(i,a,this)}}function eo(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}$a.prototype.setValue=function(e,t,r,n){var i=this.map[t];void 0!==i&&i.setValue(e,r,n)},$a.prototype.setOptional=function(e,t,r){var n=t[r];void 0!==n&&this.setValue(e,r,n)},$a.upload=function(e,t,r,n){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=r[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,n)}},$a.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var a=e[n];a.id in t&&r.push(a)}return r};var to=0;function ro(e){switch(e){case _t:return["Linear","( value )"];case Rt:return["sRGB","( value )"];case St:return["RGBE","( value )"];case Lt:return["RGBM","( value, 7.0 )"];case Pt:return["RGBM","( value, 16.0 )"];case Ct:return["RGBD","( value, 256.0 )"];case Mt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case At:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function no(e,t,r){var n=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(n&&""===i)return"";var a=e.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+i+function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(a)}function io(e,t){var r=ro(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function ao(e,t){var r;switch(t){case j:r="Linear";break;case W:r="Reinhard";break;case X:r="Uncharted2";break;case Y:r="OptimizedCineon";break;case q:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function oo(e){return""!==e}function so(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function lo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var co=/^[ \t]*#include +<([\w\d.\/]+)>/gm;function uo(e){return e.replace(co,ho)}function ho(e,t){var r=Vi[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return uo(r)}var fo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function po(e){return e.replace(fo,mo)}function mo(e,t,r,n){for(var i="",a=parseInt(t);a<parseInt(r);a++)i+=n.replace(/\[ i \]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function vo(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function go(e,t,r){var n,s,l,c,u,h=e.getContext(),d=r.defines,f=r.vertexShader,p=r.fragmentShader,m=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===i?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===a?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===o&&(t="SHADOWMAP_TYPE_VSM"),t}(r),v=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Z:case Q:t="ENVMAP_TYPE_CUBE";break;case ee:case te:t="ENVMAP_TYPE_CUBE_UV";break;case K:case J:t="ENVMAP_TYPE_EQUIREC";break;case $:t="ENVMAP_TYPE_SPHERE"}return t}(r),g=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Q:case J:t="ENVMAP_MODE_REFRACTION"}return t}(r),y=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case z:t="ENVMAP_BLENDING_MULTIPLY";break;case B:t="ENVMAP_BLENDING_MIX";break;case G:t="ENVMAP_BLENDING_ADD"}return t}(r),E=e.gammaFactor>0?e.gammaFactor:1,x=r.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(oo).join("\n")}(r),T=function(e){var t=[];for(var r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(d),b=h.createProgram();if(r.isRawShaderMaterial?((n=[T].filter(oo).join("\n")).length>0&&(n+="\n"),(s=[x,T].filter(oo).join("\n")).length>0&&(s+="\n")):(n=[vo(r),"#define SHADER_NAME "+r.shaderName,T,r.instancing?"#define USE_INSTANCING":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+E,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+g:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+m:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(oo).join("\n"),s=[x,vo(r),"#define SHADER_NAME "+r.shaderName,T,r.alphaTest?"#define ALPHATEST "+r.alphaTest+(r.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+E,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+v:"",r.envMap?"#define "+g:"",r.envMap?"#define "+y:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.sheen?"#define USE_SHEEN":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+m:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==V?"#define TONE_MAPPING":"",r.toneMapping!==V?Vi.tonemapping_pars_fragment:"",r.toneMapping!==V?ao("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.matcapEncoding||r.envMapEncoding||r.emissiveMapEncoding||r.lightMapEncoding?Vi.encodings_pars_fragment:"",r.mapEncoding?io("mapTexelToLinear",r.mapEncoding):"",r.matcapEncoding?io("matcapTexelToLinear",r.matcapEncoding):"",r.envMapEncoding?io("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?io("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.lightMapEncoding?io("lightMapTexelToLinear",r.lightMapEncoding):"",r.outputEncoding?(l="linearToOutputTexel",c=r.outputEncoding,u=ro(c),"vec4 "+l+"( vec4 value ) { return LinearTo"+u[0]+u[1]+"; }"):"",r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(oo).join("\n")),f=lo(f=so(f=uo(f),r),r),p=lo(p=so(p=uo(p),r),r),f=po(f),p=po(p),r.isWebGL2&&!r.isRawShaderMaterial){var w=!1,_=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==f.match(_)&&null!==p.match(_)&&(w=!0,f=f.replace(_,""),p=p.replace(_,"")),n=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+n,s=["#version 300 es\n","#define varying in",w?"":"out highp vec4 pc_fragColor;",w?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s}var R,M,S=n+f,A=s+p,L=eo(h,35633,S),P=eo(h,35632,A);if(h.attachShader(b,L),h.attachShader(b,P),void 0!==r.index0AttributeName?h.bindAttribLocation(b,0,r.index0AttributeName):!0===r.morphTargets&&h.bindAttribLocation(b,0,"position"),h.linkProgram(b),e.debug.checkShaderErrors){var C=h.getProgramInfoLog(b).trim(),H=h.getShaderInfoLog(L).trim(),I=h.getShaderInfoLog(P).trim(),k=!0,N=!0;if(!1===h.getProgramParameter(b,35714)){k=!1;var O=no(h,L,"vertex"),F=no(h,P,"fragment");console.error("THREE.WebGLProgram: shader error: ",h.getError(),"35715",h.getProgramParameter(b,35715),"gl.getProgramInfoLog",C,O,F)}else""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):""!==H&&""!==I||(N=!1);N&&(this.diagnostics={runnable:k,programLog:C,vertexShader:{log:H,prefix:n},fragmentShader:{log:I,prefix:s}})}return h.detachShader(b,L),h.detachShader(b,P),h.deleteShader(L),h.deleteShader(P),this.getUniforms=function(){return void 0===R&&(R=new $a(h,b)),R},this.getAttributes=function(){return void 0===M&&(M=function(e,t){for(var r={},n=e.getProgramParameter(t,35721),i=0;i<n;i++){var a=e.getActiveAttrib(t,i),o=a.name;r[o]=e.getAttribLocation(t,o)}return r}(h,b)),M},this.destroy=function(){h.deleteProgram(b),this.program=void 0},this.name=r.shaderName,this.id=to++,this.cacheKey=t,this.usedTimes=1,this.program=b,this.vertexShader=L,this.fragmentShader=P,this}function yo(e,t,r){var n=[],i=r.isWebGL2,a=r.logarithmicDepthBuffer,o=r.floatVertexTextures,s=r.precision,u=r.maxVertexUniforms,h=r.vertexTextures,d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function p(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=_t,t}this.getParameters=function(n,f,m,v,g,y,E){var x=v.fog,T=n.isMeshStandardMaterial?v.environment:null,b=n.envMap||T,w=d[n.type],_=E.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(o)return 1024;var r=u,n=Math.floor((r-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(E):0;null!==n.precision&&(s=r.getMaxPrecision(n.precision))!==n.precision&&console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",s,"instead.");var R=function(e,t){var r;if(t){var n=ji[t];r={name:e.type,uniforms:_i.clone(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}}else r={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return r}(n,w);n.onBeforeCompile(R,e);var M=e.getRenderTarget(),S={isWebGL2:i,shaderID:w,shaderName:R.name,uniforms:R.uniforms,vertexShader:R.vertexShader,fragmentShader:R.fragmentShader,defines:n.defines,isRawShaderMaterial:n.isRawShaderMaterial,isShaderMaterial:n.isShaderMaterial,precision:s,instancing:!0===E.isInstancedMesh,supportsVertexTextures:h,outputEncoding:null!==M?p(M.texture):e.outputEncoding,map:!!n.map,mapEncoding:p(n.map),matcap:!!n.matcap,matcapEncoding:p(n.matcap),envMap:!!b,envMapMode:b&&b.mapping,envMapEncoding:p(b),envMapCubeUV:!!b&&(b.mapping===ee||b.mapping===te),lightMap:!!n.lightMap,lightMapEncoding:p(n.lightMap),aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:p(n.emissiveMap),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:n.normalMapType===Nt,tangentSpaceNormalMap:n.normalMapType===kt,clearcoatNormalMap:!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,gradientMap:!!n.gradientMap,sheen:!!n.sheen,combine:n.combine,vertexTangents:n.normalMap&&n.vertexTangents,vertexColors:n.vertexColors,vertexUvs:!!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||n.displacementMap),uvsVertexOnly:!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||!n.displacementMap),fog:!!x,useFog:n.fog,fogExp2:x&&x.isFogExp2,flatShading:n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:a,skinning:n.skinning&&_>0,maxBones:_,useVertexTexture:o,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:f.directional.length,numPointLights:f.point.length,numSpotLights:f.spot.length,numRectAreaLights:f.rectArea.length,numHemiLights:f.hemi.length,numDirLightShadows:f.directionalShadowMap.length,numPointLightShadows:f.pointShadowMap.length,numSpotLightShadows:f.spotShadowMap.length,numClippingPlanes:g,numClipIntersection:y,dithering:n.dithering,shadowMapEnabled:e.shadowMap.enabled&&m.length>0,shadowMapType:e.shadowMap.type,toneMapping:n.toneMapped?e.toneMapping:V,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:n.side===c,flipSided:n.side===l,depthPacking:void 0!==n.depthPacking&&n.depthPacking,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.fragDepth,extensionDrawbuffers:n.extensions&&n.extensions.drawBuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:i||null!==t.get("EXT_frag_depth"),rendererExtensionDrawBuffers:i||null!==t.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:i||null!==t.get("EXT_shader_texture_lod"),onBeforeCompile:n.onBeforeCompile};return S},this.getProgramCacheKey=function(t){var r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)r.push(n),r.push(t.defines[n]);if(void 0===t.isRawShaderMaterial){for(var i=0;i<f.length;i++)r.push(t[f[i]]);r.push(e.outputEncoding),r.push(e.gammaFactor)}return r.push(t.onBeforeCompile.toString()),r.join()},this.acquireProgram=function(t,r){for(var i,a=0,o=n.length;a<o;a++){var s=n[a];if(s.cacheKey===r){++(i=s).usedTimes;break}}return void 0===i&&(i=new go(e,r,t),n.push(i)),i},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function Eo(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,n){e.get(t)[r]=n},dispose:function(){e=new WeakMap}}}function xo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function To(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function bo(){var e=[],t=0,r=[],n=[],i={id:-1};function a(r,n,a,o,s,l){var c=e[t];return void 0===c?(c={id:r.id,object:r,geometry:n,material:a,program:a.program||i,groupOrder:o,renderOrder:r.renderOrder,z:s,group:l},e[t]=c):(c.id=r.id,c.object=r,c.geometry=n,c.material=a,c.program=a.program||i,c.groupOrder=o,c.renderOrder=r.renderOrder,c.z=s,c.group=l),t++,c}return{opaque:r,transparent:n,init:function(){t=0,r.length=0,n.length=0},push:function(e,t,i,o,s,l){var c=a(e,t,i,o,s,l);(!0===i.transparent?n:r).push(c)},unshift:function(e,t,i,o,s,l){var c=a(e,t,i,o,s,l);(!0===i.transparent?n:r).unshift(c)},finish:function(){for(var r=t,n=e.length;r<n;r++){var i=e[r];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){r.length>1&&r.sort(e||xo),n.length>1&&n.sort(t||To)}}}function wo(){var e=new WeakMap;function t(r){var n=r.target;n.removeEventListener("dispose",t),e.delete(n)}return{get:function(r,n){var i,a=e.get(r);return void 0===a?(i=new bo,e.set(r,new WeakMap),e.get(r).set(n,i),r.addEventListener("dispose",t)):void 0===(i=a.get(n))&&(i=new bo,a.set(n,i)),i},dispose:function(){e=new WeakMap}}}function _o(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new rr,color:new xn};break;case"SpotLight":r={position:new rr,direction:new rr,color:new xn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new rr,color:new xn,distance:0,decay:0};break;case"HemisphereLight":r={direction:new rr,skyColor:new xn,groundColor:new xn};break;case"RectAreaLight":r={color:new xn,position:new rr,halfWidth:new rr,halfHeight:new rr}}return e[t.id]=r,r}}}var Ro=0;function Mo(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function So(){for(var e,t=new _o,r=(e={},{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new Wt};break;case"PointLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new Wt,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r,r}}),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=0;i<9;i++)n.probe.push(new rr);var a=new rr,o=new ur,s=new ur;return{setup:function(e,i,l){for(var c=0,u=0,h=0,d=0;d<9;d++)n.probe[d].set(0,0,0);var f=0,p=0,m=0,v=0,g=0,y=0,E=0,x=0,T=l.matrixWorldInverse;e.sort(Mo);for(var d=0,b=e.length;d<b;d++){var w=e[d],_=w.color,R=w.intensity,M=w.distance,S=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)c+=_.r*R,u+=_.g*R,h+=_.b*R;else if(w.isLightProbe)for(var A=0;A<9;A++)n.probe[A].addScaledVector(w.sh.coefficients[A],R);else if(w.isDirectionalLight){var L=t.get(w);if(L.color.copy(w.color).multiplyScalar(w.intensity),L.direction.setFromMatrixPosition(w.matrixWorld),a.setFromMatrixPosition(w.target.matrixWorld),L.direction.sub(a),L.direction.transformDirection(T),w.castShadow){var P=w.shadow,C=r.get(w);C.shadowBias=P.bias,C.shadowRadius=P.radius,C.shadowMapSize=P.mapSize,n.directionalShadow[f]=C,n.directionalShadowMap[f]=S,n.directionalShadowMatrix[f]=w.shadow.matrix,y++}n.directional[f]=L,f++}else if(w.isSpotLight){var L=t.get(w);if(L.position.setFromMatrixPosition(w.matrixWorld),L.position.applyMatrix4(T),L.color.copy(_).multiplyScalar(R),L.distance=M,L.direction.setFromMatrixPosition(w.matrixWorld),a.setFromMatrixPosition(w.target.matrixWorld),L.direction.sub(a),L.direction.transformDirection(T),L.coneCos=Math.cos(w.angle),L.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),L.decay=w.decay,w.castShadow){var P=w.shadow,C=r.get(w);C.shadowBias=P.bias,C.shadowRadius=P.radius,C.shadowMapSize=P.mapSize,n.spotShadow[m]=C,n.spotShadowMap[m]=S,n.spotShadowMatrix[m]=w.shadow.matrix,x++}n.spot[m]=L,m++}else if(w.isRectAreaLight){var L=t.get(w);L.color.copy(_).multiplyScalar(R),L.position.setFromMatrixPosition(w.matrixWorld),L.position.applyMatrix4(T),s.identity(),o.copy(w.matrixWorld),o.premultiply(T),s.extractRotation(o),L.halfWidth.set(.5*w.width,0,0),L.halfHeight.set(0,.5*w.height,0),L.halfWidth.applyMatrix4(s),L.halfHeight.applyMatrix4(s),n.rectArea[v]=L,v++}else if(w.isPointLight){var L=t.get(w);if(L.position.setFromMatrixPosition(w.matrixWorld),L.position.applyMatrix4(T),L.color.copy(w.color).multiplyScalar(w.intensity),L.distance=w.distance,L.decay=w.decay,w.castShadow){var P=w.shadow,C=r.get(w);C.shadowBias=P.bias,C.shadowRadius=P.radius,C.shadowMapSize=P.mapSize,C.shadowCameraNear=P.camera.near,C.shadowCameraFar=P.camera.far,n.pointShadow[p]=C,n.pointShadowMap[p]=S,n.pointShadowMatrix[p]=w.shadow.matrix,E++}n.point[p]=L,p++}else if(w.isHemisphereLight){var L=t.get(w);L.direction.setFromMatrixPosition(w.matrixWorld),L.direction.transformDirection(T),L.direction.normalize(),L.skyColor.copy(w.color).multiplyScalar(R),L.groundColor.copy(w.groundColor).multiplyScalar(R),n.hemi[g]=L,g++}}n.ambient[0]=c,n.ambient[1]=u,n.ambient[2]=h;var H=n.hash;H.directionalLength===f&&H.pointLength===p&&H.spotLength===m&&H.rectAreaLength===v&&H.hemiLength===g&&H.numDirectionalShadows===y&&H.numPointShadows===E&&H.numSpotShadows===x||(n.directional.length=f,n.spot.length=m,n.rectArea.length=v,n.point.length=p,n.hemi.length=g,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=E,n.pointShadowMap.length=E,n.spotShadow.length=x,n.spotShadowMap.length=x,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=E,n.spotShadowMatrix.length=x,H.directionalLength=f,H.pointLength=p,H.spotLength=m,H.rectAreaLength=v,H.hemiLength=g,H.numDirectionalShadows=y,H.numPointShadows=E,H.numSpotShadows=x,n.version=Ro++)},state:n}}function Ao(){var e=new So,t=[],r=[],n={lightsArray:t,shadowsArray:r,lights:e};return{init:function(){t.length=0,r.length=0},state:n,setupLights:function(n){e.setup(t,r,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function Lo(){var e=new WeakMap;function t(r){var n=r.target;n.removeEventListener("dispose",t),e.delete(n)}return{get:function(r,n){var i;return!1===e.has(r)?(i=new Ao,e.set(r,new WeakMap),e.get(r).set(n,i),r.addEventListener("dispose",t)):!1===e.get(r).has(n)?(i=new Ao,e.get(r).set(n,i)):i=e.get(r).get(n),i},dispose:function(){e=new WeakMap}}}function Po(e){Mn.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ht,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function Co(e){Mn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new rr,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}Po.prototype=Object.create(Mn.prototype),Po.prototype.constructor=Po,Po.prototype.isMeshDepthMaterial=!0,Po.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Co.prototype=Object.create(Mn.prototype),Co.prototype.constructor=Co,Co.prototype.isMeshDistanceMaterial=!0,Co.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var Ho="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",Io="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function ko(e,t,r){var n=new Fi,a=new Wt,h=new Wt,d=new Qt,f=[],p=[],m={},v={0:l,1:s,2:c},g=new Si({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Wt},radius:{value:4}},vertexShader:Io,fragmentShader:Ho}),y=g.clone();y.defines.HORIZONAL_PASS=1;var E=new qn;E.setAttribute("position",new Ln(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var x=new di(E,g),T=this;function b(r,n){var i=t.update(x);g.uniforms.shadow_pass.value=r.map.texture,g.uniforms.resolution.value=r.mapSize,g.uniforms.radius.value=r.radius,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(n,null,i,g,x,null),y.uniforms.shadow_pass.value=r.mapPass.texture,y.uniforms.resolution.value=r.mapSize,y.uniforms.radius.value=r.radius,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(n,null,i,y,x,null)}function w(e,t,r){var n=e<<0|t<<1|r<<2,i=f[n];return void 0===i&&(i=new Po({depthPacking:It,morphTargets:e,skinning:t}),f[n]=i),i}function _(e,t,r){var n=e<<0|t<<1|r<<2,i=p[n];return void 0===i&&(i=new Co({morphTargets:e,skinning:t}),p[n]=i),i}function R(t,r,n,i,a,s){var l=t.geometry,c=null,u=w,h=t.customDepthMaterial;if(!0===n.isPointLight&&(u=_,h=t.customDistanceMaterial),void 0===h){var d=!1;!0===r.morphTargets&&(!0===l.isBufferGeometry?d=l.morphAttributes&&l.morphAttributes.position&&l.morphAttributes.position.length>0:!0===l.isGeometry&&(d=l.morphTargets&&l.morphTargets.length>0));var f=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?f=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t));var p=!0===t.isInstancedMesh;c=u(d,f,p)}else c=h;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var g=c.uuid,y=r.uuid,E=m[g];void 0===E&&(E={},m[g]=E);var x=E[y];void 0===x&&(x=c.clone(),E[y]=x),c=x}return c.visible=r.visible,c.wireframe=r.wireframe,c.side=s===o?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:v[r.side],c.clipShadows=r.clipShadows,c.clippingPlanes=r.clippingPlanes,c.clipIntersection=r.clipIntersection,c.wireframeLinewidth=r.wireframeLinewidth,c.linewidth=r.linewidth,!0===n.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(n.matrixWorld),c.nearDistance=i,c.farDistance=a),c}function M(r,i,a,s,l){if(!1!==r.visible){var c=r.layers.test(i.layers);if(c&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&l===o)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);var u=t.update(r),h=r.material;if(Array.isArray(h))for(var d=u.groups,f=0,p=d.length;f<p;f++){var m=d[f],v=h[m.materialIndex];if(v&&v.visible){var g=R(r,v,s,a.near,a.far,l);e.renderBufferDirect(a,null,u,g,r,m)}}else if(h.visible){var g=R(r,h,s,a.near,a.far,l);e.renderBufferDirect(a,null,u,g,r,null)}}for(var y=r.children,E=0,x=y.length;E<x;E++)M(y[E],i,a,s,l)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=i,this.render=function(t,i,s){if(!1!==T.enabled&&(!1!==T.autoUpdate||!1!==T.needsUpdate)&&0!==t.length){var l=e.getRenderTarget(),c=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.state;p.setBlending(u),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var m=0,v=t.length;m<v;m++){var g=t[m],y=g.shadow;if(void 0!==y){a.copy(y.mapSize);var E=y.getFrameExtents();if(a.multiply(E),h.copy(y.mapSize),(a.x>r||a.y>r)&&(console.warn("THREE.WebGLShadowMap:",g,"has shadow exceeding max texture size, reducing"),a.x>r&&(h.x=Math.floor(r/E.x),a.x=h.x*E.x,y.mapSize.x=h.x),a.y>r&&(h.y=Math.floor(r/E.y),a.y=h.y*E.y,y.mapSize.y=h.y)),null===y.map&&!y.isPointLightShadow&&this.type===o){var x={minFilter:le,magFilter:le,format:Re};y.map=new Kt(a.x,a.y,x),y.map.texture.name=g.name+".shadowMap",y.mapPass=new Kt(a.x,a.y,x),y.camera.updateProjectionMatrix()}if(null===y.map){var x={minFilter:ae,magFilter:ae,format:Re};y.map=new Kt(a.x,a.y,x),y.map.texture.name=g.name+".shadowMap",y.camera.updateProjectionMatrix()}e.setRenderTarget(y.map),e.clear();for(var w=y.getViewportCount(),_=0;_<w;_++){var R=y.getViewport(_);d.set(h.x*R.x,h.y*R.y,h.x*R.z,h.y*R.w),p.viewport(d),y.updateMatrices(g,_),n=y.getFrustum(),M(i,s,y.camera,g,this.type)}y.isPointLightShadow||this.type!==o||b(y,s)}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}T.needsUpdate=!1,e.setRenderTarget(l,c,f)}}}function No(e,i,a){var o=a.isWebGL2,s=new function(){var t=!1,r=new Qt,n=null,i=new Qt(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,a,o,s){!0===s&&(t*=o,n*=o,a*=o),r.set(t,n,a,o),!1===i.equals(r)&&(e.clearColor(t,n,a,o),i.copy(r))},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}},z=new function(){var t=!1,r=null,n=null,i=null;return{setTest:function(e){e?Ee(2929):xe(2929)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case H:e.depthFunc(512);break;case I:e.depthFunc(519);break;case k:e.depthFunc(513);break;case N:e.depthFunc(515);break;case O:e.depthFunc(514);break;case F:e.depthFunc(518);break;case D:e.depthFunc(516);break;case U:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},B=new function(){var t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?Ee(2960):xe(2960))},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,o){n===t&&i===r&&a===o||(e.stencilFunc(t,r,o),n=t,i=r,a=o)},setOp:function(t,r,n){o===t&&s===r&&l===n||(e.stencilOp(t,r,n),o=t,s=r,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,c=null}}},G=e.getParameter(34921),V=new Uint8Array(G),j=new Uint8Array(G),W=new Uint8Array(G),X={},Y=null,q=null,Z=null,Q=null,K=null,J=null,$=null,ee=null,te=null,re=!1,ne=null,ie=null,ae=null,oe=null,se=null,le=e.getParameter(35661),ce=!1,ue=0,he=e.getParameter(7938);-1!==he.indexOf("WebGL")?(ue=parseFloat(/^WebGL\ ([0-9])/.exec(he)[1]),ce=ue>=1):-1!==he.indexOf("OpenGL ES")&&(ue=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(he)[1]),ce=ue>=2);var de=null,fe={},pe=new Qt,me=new Qt;function ve(t,r,n){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<n;o++)e.texImage2D(r+o,0,6408,1,1,0,6408,5121,i);return a}var ge={};function ye(t,r){if(V[t]=1,0===j[t]&&(e.enableVertexAttribArray(t),j[t]=1),W[t]!==r){var n=o?e:i.get("ANGLE_instanced_arrays");n[o?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](t,r),W[t]=r}}function Ee(t){!0!==X[t]&&(e.enable(t),X[t]=!0)}function xe(t){!1!==X[t]&&(e.disable(t),X[t]=!1)}ge[3553]=ve(3553,3553,1),ge[34067]=ve(34067,34069,6),s.setClear(0,0,0,1),z.setClear(1),B.setClear(0),Ee(2929),z.setFunc(N),Re(!1),Me(r),Ee(2884),_e(u);var Te={};if(Te[v]=32774,Te[g]=32778,Te[y]=32779,o)Te[E]=32775,Te[x]=32776;else{var be=i.get("EXT_blend_minmax");null!==be&&(Te[E]=be.MIN_EXT,Te[x]=be.MAX_EXT)}var we={};function _e(t,r,n,i,a,o,s,l){if(t!==u){if(q||(Ee(3042),q=!0),t===m)a=a||r,o=o||n,s=s||i,r===Q&&a===$||(e.blendEquationSeparate(Te[r],Te[a]),Q=r,$=a),n===K&&i===J&&o===ee&&s===te||(e.blendFuncSeparate(we[n],we[i],we[o],we[s]),K=n,J=i,ee=o,te=s),Z=t,re=null;else if(t!==Z||l!==re){if(Q===v&&$===v||(e.blendEquation(32774),Q=v,$=v),l)switch(t){case h:e.blendFuncSeparate(1,771,1,771);break;case d:e.blendFunc(1,1);break;case f:e.blendFuncSeparate(0,0,769,771);break;case p:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case h:e.blendFuncSeparate(770,771,1,771);break;case d:e.blendFunc(770,1);break;case f:e.blendFunc(0,769);break;case p:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}K=null,J=null,ee=null,te=null,Z=t,re=l}}else q&&(xe(3042),q=!1)}function Re(t){ne!==t&&(t?e.frontFace(2304):e.frontFace(2305),ne=t)}function Me(i){i!==t?(Ee(2884),i!==ie&&(i===r?e.cullFace(1029):i===n?e.cullFace(1028):e.cullFace(1032))):xe(2884),ie=i}function Se(t,r,n){t?(Ee(32823),oe===r&&se===n||(e.polygonOffset(r,n),oe=r,se=n)):xe(32823)}function Ae(t){void 0===t&&(t=33984+le-1),de!==t&&(e.activeTexture(t),de=t)}return we[T]=0,we[b]=1,we[w]=768,we[R]=770,we[C]=776,we[L]=774,we[S]=772,we[_]=769,we[M]=771,we[P]=775,we[A]=773,{buffers:{color:s,depth:z,stencil:B},initAttributes:function(){for(var e=0,t=V.length;e<t;e++)V[e]=0},enableAttribute:function(e){ye(e,0)},enableAttributeAndDivisor:ye,disableUnusedAttributes:function(){for(var t=0,r=j.length;t!==r;++t)j[t]!==V[t]&&(e.disableVertexAttribArray(t),j[t]=0)},enable:Ee,disable:xe,useProgram:function(t){return Y!==t&&(e.useProgram(t),Y=t,!0)},setBlending:_e,setMaterial:function(e,t){e.side===c?xe(2884):Ee(2884);var r=e.side===l;t&&(r=!r),Re(r),e.blending===h&&!1===e.transparent?_e(u):_e(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),z.setFunc(e.depthFunc),z.setTest(e.depthTest),z.setMask(e.depthWrite),s.setMask(e.colorWrite);var n=e.stencilWrite;B.setTest(n),n&&(B.setMask(e.stencilWriteMask),B.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),B.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Se(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:Re,setCullFace:Me,setLineWidth:function(t){t!==ae&&(ce&&e.lineWidth(t),ae=t)},setPolygonOffset:Se,setScissorTest:function(e){e?Ee(3089):xe(3089)},activeTexture:Ae,bindTexture:function(t,r){null===de&&Ae();var n=fe[de];void 0===n&&(n={type:void 0,texture:void 0},fe[de]=n),n.type===t&&n.texture===r||(e.bindTexture(t,r||ge[t]),n.type=t,n.texture=r)},unbindTexture:function(){var t=fe[de];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===pe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),pe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){for(var t=0;t<j.length;t++)1===j[t]&&(e.disableVertexAttribArray(t),j[t]=0);X={},de=null,fe={},Y=null,Z=null,ne=null,ie=null,s.reset(),z.reset(),B.reset()}}}function Oo(e,t,r,n,i,a,o){var s,l=i.isWebGL2,c=i.maxTextures,u=i.maxCubemapSize,h=i.maxTextureSize,d=i.maxSamples,f=new WeakMap,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return p?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,r,n){var i=1;if((e.width>n||e.height>n)&&(i=n/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?jt.floorPowerOfTwo:Math.floor,o=a(i*e.width),l=a(i*e.height);void 0===s&&(s=m(o,l));var c=r?m(o,l):s;c.width=o,c.height=l;var u=c.getContext("2d");return u.drawImage(e,0,0,o,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+l+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function g(e){return jt.isPowerOfTwo(e.width)&&jt.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==ae&&e.minFilter!==le}function E(t,r,i,a){e.generateMipmap(t);var o=n.get(r);o.__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function x(r,n,i){if(!1===l)return n;if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}var a=n;return 6403===n&&(5126===i&&(a=33326),5131===i&&(a=33325),5121===i&&(a=33321)),6407===n&&(5126===i&&(a=34837),5131===i&&(a=34843),5121===i&&(a=32849)),6408===n&&(5126===i&&(a=34836),5131===i&&(a=34842),5121===i&&(a=32856)),33325===a||33326===a||34842===a||34836===a?t.get("EXT_color_buffer_float"):34843!==a&&34837!==a||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),a}function T(e){return e===ae||e===oe||e===se?9728:9729}function b(t){var r=t.target;r.removeEventListener("dispose",b),function(t){var r=n.get(t);void 0!==r.__webglInit&&(e.deleteTexture(r.__webglTexture),n.remove(t))}(r),r.isVideoTexture&&f.delete(r),o.memory.textures--}function w(t){var r=t.target;r.removeEventListener("dispose",w),function(t){var r=n.get(t),i=n.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(var a=0;a<6;a++)e.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[a]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}}(r),o.memory.textures--}var _=0;function R(e,t){var i=n.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void H(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+t),r.bindTexture(3553,i.__webglTexture)}function M(t,i){if(6===t.image.length){var o=n.get(t);if(t.version>0&&o.__version!==t.version){C(o,t),r.activeTexture(33984+i),r.bindTexture(34067,o.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),c=t.image[0]&&t.image[0].isDataTexture,h=[],d=0;d<6;d++)h[d]=s||c?c?t.image[d].image:t.image[d]:v(t.image[d],!1,!0,u);var f,p=h[0],m=g(p)||l,T=a.convert(t.format),b=a.convert(t.type),w=x(t.internalFormat,T,b);if(P(34067,t,m),s){for(var d=0;d<6;d++){f=h[d].mipmaps;for(var _=0;_<f.length;_++){var R=f[_];t.format!==Re&&t.format!==_e?null!==T?r.compressedTexImage2D(34069+d,_,w,R.width,R.height,0,R.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+d,_,w,R.width,R.height,0,T,b,R.data)}}o.__maxMipLevel=f.length-1}else{f=t.mipmaps;for(var d=0;d<6;d++)if(c){r.texImage2D(34069+d,0,w,h[d].width,h[d].height,0,T,b,h[d].data);for(var _=0;_<f.length;_++){var R=f[_],M=R.image[d].image;r.texImage2D(34069+d,_+1,w,M.width,M.height,0,T,b,M.data)}}else{r.texImage2D(34069+d,0,w,T,b,h[d]);for(var _=0;_<f.length;_++){var R=f[_];r.texImage2D(34069+d,_+1,w,T,b,R.image[d])}}o.__maxMipLevel=f.length}y(t,m)&&E(34067,t,p.width,p.height),o.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(33984+i),r.bindTexture(34067,o.__webglTexture)}}function S(e,t){r.activeTexture(33984+t),r.bindTexture(34067,n.get(e).__webglTexture)}var A={};A[re]=10497,A[ne]=33071,A[ie]=33648;var L={};function P(r,a,o){o?(e.texParameteri(r,10242,A[a.wrapS]),e.texParameteri(r,10243,A[a.wrapT]),32879!==r&&35866!==r||e.texParameteri(r,32882,A[a.wrapR]),e.texParameteri(r,10240,L[a.magFilter]),e.texParameteri(r,10241,L[a.minFilter])):(e.texParameteri(r,10242,33071),e.texParameteri(r,10243,33071),32879!==r&&35866!==r||e.texParameteri(r,32882,33071),a.wrapS===ne&&a.wrapT===ne||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,10240,T(a.magFilter)),e.texParameteri(r,10241,T(a.minFilter)),a.minFilter!==ae&&a.minFilter!==le&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(a.type===ge&&null===t.get("OES_texture_float_linear"))return;if(a.type===ye&&null===(l||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(e.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function C(t,r){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",b),t.__webglTexture=e.createTexture(),o.memory.textures++)}function H(t,n,i){var o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),C(t,n),r.activeTexture(33984+i),r.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment);var s=function(e){return!l&&(e.wrapS!==ne||e.wrapT!==ne||e.minFilter!==ae&&e.minFilter!==le)}(n)&&!1===g(n.image),c=v(n.image,s,!1,h),u=g(c)||l,d=a.convert(n.format),f=a.convert(n.type),p=x(n.internalFormat,d,f);P(o,n,u);var m,T=n.mipmaps;if(n.isDepthTexture){if(p=6402,n.type===ge){if(!1===l)throw new Error("Float Depth Texture only supported in WebGL2.0");p=36012}else l&&(p=33189);n.format===Le&&6402===p&&n.type!==pe&&n.type!==ve&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=pe,f=a.convert(n.type)),n.format===Pe&&(p=34041,n.type!==be&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=be,f=a.convert(n.type))),r.texImage2D(3553,0,p,c.width,c.height,0,d,f,null)}else if(n.isDataTexture)if(T.length>0&&u){for(var b=0,w=T.length;b<w;b++)m=T[b],r.texImage2D(3553,b,p,m.width,m.height,0,d,f,m.data);n.generateMipmaps=!1,t.__maxMipLevel=T.length-1}else r.texImage2D(3553,0,p,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(var b=0,w=T.length;b<w;b++)m=T[b],n.format!==Re&&n.format!==_e?null!==d?r.compressedTexImage2D(3553,b,p,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,b,p,m.width,m.height,0,d,f,m.data);t.__maxMipLevel=T.length-1}else if(n.isDataTexture2DArray)r.texImage3D(35866,0,p,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(32879,0,p,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(T.length>0&&u){for(var b=0,w=T.length;b<w;b++)m=T[b],r.texImage2D(3553,b,p,d,f,m);n.generateMipmaps=!1,t.__maxMipLevel=T.length-1}else r.texImage2D(3553,0,p,d,f,c),t.__maxMipLevel=0;y(n,u)&&E(o,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function I(t,i,o,s){var l=a.convert(i.texture.format),c=a.convert(i.texture.type),u=x(i.texture.internalFormat,l,c);r.texImage2D(s,0,u,i.width,i.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,n.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function k(t,r,n){if(e.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer){if(n){var i=O(r);e.renderbufferStorageMultisample(36161,i,33189,r.width,r.height)}else e.renderbufferStorage(36161,33189,r.width,r.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(r.depthBuffer&&r.stencilBuffer){if(n){var i=O(r);e.renderbufferStorageMultisample(36161,i,35056,r.width,r.height)}else e.renderbufferStorage(36161,34041,r.width,r.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var o=a.convert(r.texture.format),s=a.convert(r.texture.type),l=x(r.texture.internalFormat,o,s);if(n){var i=O(r);e.renderbufferStorageMultisample(36161,i,l,r.width,r.height)}else e.renderbufferStorage(36161,l,r.width,r.height)}e.bindRenderbuffer(36161,null)}function N(t){var r=n.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),R(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Le)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(r.depthTexture.format!==Pe)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(r.__webglFramebuffer,t)}else if(i){r.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=e.createRenderbuffer(),k(r.__webglDepthbuffer[a],t)}else e.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),k(r.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function O(e){return l&&e.isWebGLMultisampleRenderTarget?Math.min(d,e.samples):0}L[ae]=9728,L[oe]=9984,L[se]=9986,L[le]=9729,L[ce]=9985,L[ue]=9987;var F=!1,D=!1;this.allocateTextureUnit=function(){var e=_;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),_+=1,e},this.resetTextureUnits=function(){_=0},this.setTexture2D=R,this.setTexture2DArray=function(e,t){var i=n.get(e);e.version>0&&i.__version!==e.version?H(i,e,t):(r.activeTexture(33984+t),r.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=n.get(e);e.version>0&&i.__version!==e.version?H(i,e,t):(r.activeTexture(33984+t),r.bindTexture(32879,i.__webglTexture))},this.setTextureCube=M,this.setTextureCubeDynamic=S,this.setupRenderTarget=function(t){var i=n.get(t),s=n.get(t.texture);t.addEventListener("dispose",w),s.__webglTexture=e.createTexture(),o.memory.textures++;var c=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultisampleRenderTarget,h=g(t)||l;if(c){i.__webglFramebuffer=[];for(var d=0;d<6;d++)i.__webglFramebuffer[d]=e.createFramebuffer()}else if(i.__webglFramebuffer=e.createFramebuffer(),u)if(l){i.__webglMultisampledFramebuffer=e.createFramebuffer(),i.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,i.__webglColorRenderbuffer);var f=a.convert(t.texture.format),p=a.convert(t.texture.type),m=x(t.texture.internalFormat,f,p),v=O(t);e.renderbufferStorageMultisample(36161,v,m,t.width,t.height),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(i.__webglDepthRenderbuffer=e.createRenderbuffer(),k(i.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){r.bindTexture(34067,s.__webglTexture),P(34067,t.texture,h);for(var d=0;d<6;d++)I(i.__webglFramebuffer[d],t,36064,34069+d);y(t.texture,h)&&E(34067,t.texture,t.width,t.height),r.bindTexture(34067,null)}else r.bindTexture(3553,s.__webglTexture),P(3553,t.texture,h),I(i.__webglFramebuffer,t,36064,3553),y(t.texture,h)&&E(3553,t.texture,t.width,t.height),r.bindTexture(3553,null);t.depthBuffer&&N(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture,i=g(e)||l;if(y(t,i)){var a=e.isWebGLCubeRenderTarget?34067:3553,o=n.get(t).__webglTexture;r.bindTexture(a,o),E(a,t,e.width,e.height),r.bindTexture(a,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(l){var r=n.get(t);e.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,r.__webglFramebuffer);var i=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024),e.blitFramebuffer(0,0,i,a,0,0,i,a,o,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),e=e.texture),R(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),D=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?M(e,t):S(e,t)}}function Fo(e,t,r){var n=r.isWebGL2;return{convert:function(e){var r;if(e===he)return 5121;if(e===Ee)return 32819;if(e===xe)return 32820;if(e===Te)return 33635;if(e===de)return 5120;if(e===fe)return 5122;if(e===pe)return 5123;if(e===me)return 5124;if(e===ve)return 5125;if(e===ge)return 5126;if(e===ye)return n?5131:null!==(r=t.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(e===we)return 6406;if(e===_e)return 6407;if(e===Re)return 6408;if(e===Me)return 6409;if(e===Se)return 6410;if(e===Le)return 6402;if(e===Pe)return 34041;if(e===Ce)return 6403;if(e===He)return 36244;if(e===Ie)return 33319;if(e===ke)return 33320;if(e===Ne)return 36248;if(e===Oe)return 36249;if(e===Fe||e===De||e===Ue||e===ze){if(null===(r=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===Fe)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===De)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Ue)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===ze)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Be||e===Ge||e===Ve||e===je){if(null===(r=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===Be)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ge)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Ve)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===je)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===We)return null!==(r=t.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===Xe||e===Ye)&&null!==(r=t.get("WEBGL_compressed_texture_etc"))){if(e===Xe)return r.COMPRESSED_RGB8_ETC2;if(e===Ye)return r.COMPRESSED_RGBA8_ETC2_EAC}return e===qe||e===Ze||e===Qe||e===Ke||e===Je||e===$e||e===et||e===tt||e===rt||e===nt||e===it||e===at||e===ot||e===st||e===lt||e===ct||e===ut||e===ht||e===dt||e===ft||e===pt||e===mt||e===vt||e===gt||e===yt||e===Et||e===xt||e===Tt?null!==(r=t.get("WEBGL_compressed_texture_astc"))?e:null:e===be?n?34042:null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Do(e){Li.call(this),this.cameras=e||[]}function Uo(){Ar.call(this),this.type="Group"}function zo(e,t){var r=this,n=null,i=1,a=null,o="local-floor",s=null,l=[],c=new Map,u=new Li;u.layers.enable(1),u.viewport=new Qt;var h=new Li;h.layers.enable(2),h.viewport=new Qt;var d=new Do([u,h]);d.layers.enable(1),d.layers.enable(2);var f=null,p=null;function m(e){var t=c.get(e.inputSource);t&&(t.targetRay&&t.targetRay.dispatchEvent({type:e.type}),t.grip&&t.grip.dispatchEvent({type:e.type}))}function v(){c.forEach(function(e,t){e.targetRay&&(e.targetRay.dispatchEvent({type:"disconnected",data:t}),e.targetRay.visible=!1),e.grip&&(e.grip.dispatchEvent({type:"disconnected",data:t}),e.grip.visible=!1)}),c.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),w.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function g(e){a=e,w.setContext(n),w.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}function y(e){for(var t=n.inputSources,r=0;r<l.length;r++)c.set(t[r],l[r]);for(var r=0;r<e.removed.length;r++){var i=e.removed[r],a=c.get(i);a&&(a.targetRay&&a.targetRay.dispatchEvent({type:"disconnected",data:i}),a.grip&&a.grip.dispatchEvent({type:"disconnected",data:i}),c.delete(i))}for(var r=0;r<e.added.length;r++){var i=e.added[r],a=c.get(i);a&&(a.targetRay&&a.targetRay.dispatchEvent({type:"connected",data:i}),a.grip&&a.grip.dispatchEvent({type:"connected",data:i}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=l[e];return void 0===t&&(t={},l[e]=t),void 0===t.targetRay&&(t.targetRay=new Uo,t.targetRay.matrixAutoUpdate=!1,t.targetRay.visible=!1),t.targetRay},this.getControllerGrip=function(e){var t=l[e];return void 0===t&&(t={},l[e]=t),void 0===t.grip&&(t.grip=new Uo,t.grip.matrixAutoUpdate=!1,t.grip.visible=!1),t.grip},this.setFramebufferScaleFactor=function(e){i=e,1==r.isPresenting&&console.warn("WebXRManager: Cannot change framebuffer scale while presenting VR content")},this.setReferenceSpaceType=function(e){o=e},this.getReferenceSpace=function(){return a},this.getSession=function(){return n},this.setSession=function(e){if(null!==(n=e)){n.addEventListener("select",m),n.addEventListener("selectstart",m),n.addEventListener("selectend",m),n.addEventListener("squeeze",m),n.addEventListener("squeezestart",m),n.addEventListener("squeezeend",m),n.addEventListener("end",v);var r=t.getContextAttributes(),a={antialias:r.antialias,alpha:r.alpha,depth:r.depth,stencil:r.stencil,framebufferScaleFactor:i},s=new XRWebGLLayer(n,t,a);n.updateRenderState({baseLayer:s}),n.requestReferenceSpace(o).then(g),n.addEventListener("inputsourceschange",y)}};var E=new rr,x=new rr;function T(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){d.near=h.near=u.near=e.near,d.far=h.far=u.far=e.far,f===d.near&&p===d.far||(n.updateRenderState({depthNear:d.near,depthFar:d.far}),f=d.near,p=d.far);var t=e.parent,r=d.cameras;T(d,t);for(var i=0;i<r.length;i++)T(r[i],t);e.matrixWorld.copy(d.matrixWorld);for(var a=e.children,i=0,o=a.length;i<o;i++)a[i].updateMatrixWorld(!0);return function(e,t,r){E.setFromMatrixPosition(t.matrixWorld),x.setFromMatrixPosition(r.matrixWorld);var n=E.distanceTo(x),i=t.projectionMatrix.elements,a=r.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*u,f=o*h,p=n/(-u+h),m=p*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var v=o+p,g=s+p,y=d-m,T=f+(n-m),b=l*s/g*v,w=c*s/g*v;e.projectionMatrix.makePerspective(y,T,b,w,v,g)}(d,u,h),d};var b=null,w=new Ui;w.setAnimationLoop(function(t,r){if(null!==(s=r.getViewerPose(a))){var i=s.views,o=n.renderState.baseLayer;e.setFramebuffer(o.framebuffer);for(var c=0;c<i.length;c++){var u=i[c],h=o.getViewport(u),f=d.cameras[c];f.matrix.fromArray(u.transform.matrix),f.projectionMatrix.fromArray(u.projectionMatrix),f.viewport.set(h.x,h.y,h.width,h.height),0===c&&d.matrix.copy(f.matrix)}}for(var p=n.inputSources,c=0;c<l.length;c++){var m=l[c],v=p[c],g=null,y=null;v&&(m.targetRay&&null!==(g=r.getPose(v.targetRaySpace,a))&&(m.targetRay.matrix.fromArray(g.transform.matrix),m.targetRay.matrix.decompose(m.targetRay.position,m.targetRay.rotation,m.targetRay.scale)),m.grip&&v.gripSpace&&null!==(y=r.getPose(v.gripSpace,a))&&(m.grip.matrix.fromArray(y.transform.matrix),m.grip.matrix.decompose(m.grip.position,m.grip.rotation,m.grip.scale))),m.targetRay&&(m.targetRay.visible=null!==g),m.grip&&(m.grip.visible=null!==y)}b&&b(t,r)}),this.setAnimationLoop=function(e){b=e},this.dispose=function(){}}function Bo(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,d=null,f=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=_t,this.physicallyCorrectLights=!1,this.toneMapping=j,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p,m,v,g,y,E,x,T,b,w,_,R,M,S,A,L,P,C,H=this,I=!1,k=null,N=0,O=0,F=null,D=null,U=-1,z={geometry:null,program:null,wireframe:!1},B=null,G=null,V=new Qt,W=new Qt,X=null,Y=t.width,q=t.height,Z=1,Q=null,K=null,J=new Qt(0,0,Y,q),$=new Qt(0,0,Y,q),ee=!1,te=new Fi,re=new qi,ne=!1,ie=!1,ae=new ur,oe=new rr;function se(){return null===F?Z:1}try{var le={alpha:n,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h,xrCompatible:!0};if(t.addEventListener("webglcontextlost",fe,!1),t.addEventListener("webglcontextrestored",pe,!1),null===(p=r||t.getContext("webgl",le)||t.getContext("experimental-webgl",le)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===p.getShaderPrecisionFormat&&(p.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ce(){m=new Zi(p),!1===(v=new Yi(p,m,e)).isWebGL2&&(m.get("WEBGL_depth_texture"),m.get("OES_texture_float"),m.get("OES_texture_half_float"),m.get("OES_texture_half_float_linear"),m.get("OES_standard_derivatives"),m.get("OES_element_index_uint"),m.get("ANGLE_instanced_arrays")),m.get("OES_texture_float_linear"),C=new Fo(p,m,v),(g=new No(p,m,v)).scissor(W.copy($).multiplyScalar(Z).floor()),g.viewport(V.copy(J).multiplyScalar(Z).floor()),y=new Ji(p),E=new Eo,x=new Oo(p,m,g,E,v,C,y),T=new zi(p,v),b=new Qi(p,T,y),w=new ta(p,b,T,y),A=new ea(p),_=new yo(H,m,v),R=new wo,M=new Lo,S=new Wi(H,g,w,s),L=new Xi(p,m,y,v),P=new Ki(p,m,y,v),y.programs=_.programs,H.capabilities=v,H.extensions=m,H.properties=E,H.renderLists=R,H.state=g,H.info=y}ce();var ue=new zo(H,p);this.xr=ue;var de=new ko(H,w,v.maxTextureSize);function fe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function pe(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1,ce()}function me(e){var t=e.target;t.removeEventListener("dispose",me),function(e){ve(e),E.remove(e)}(t)}function ve(e){var t=E.get(e).program;e.program=void 0,void 0!==t&&_.releaseProgram(t)}this.shadowMap=de,this.getContext=function(){return p},this.getContextAttributes=function(){return p.getContextAttributes()},this.forceContextLoss=function(){var e=m.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=m.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Z},this.setPixelRatio=function(e){void 0!==e&&(Z=e,this.setSize(Y,q,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Wt),e.set(Y,q)},this.setSize=function(e,r,n){ue.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Y=e,q=r,t.width=Math.floor(e*Z),t.height=Math.floor(r*Z),!1!==n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Wt),e.set(Y*Z,q*Z).floor()},this.setDrawingBufferSize=function(e,r,n){Y=e,q=r,Z=n,t.width=Math.floor(e*n),t.height=Math.floor(r*n),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Qt),e.copy(V)},this.getViewport=function(e){return e.copy(J)},this.setViewport=function(e,t,r,n){e.isVector4?J.set(e.x,e.y,e.z,e.w):J.set(e,t,r,n),g.viewport(V.copy(J).multiplyScalar(Z).floor())},this.getScissor=function(e){return e.copy($)},this.setScissor=function(e,t,r,n){e.isVector4?$.set(e.x,e.y,e.z,e.w):$.set(e,t,r,n),g.scissor(W.copy($).multiplyScalar(Z).floor())},this.getScissorTest=function(){return ee},this.setScissorTest=function(e){g.setScissorTest(ee=e)},this.setOpaqueSort=function(e){Q=e},this.setTransparentSort=function(e){K=e},this.getClearColor=function(){return S.getClearColor()},this.setClearColor=function(){S.setClearColor.apply(S,arguments)},this.getClearAlpha=function(){return S.getClearAlpha()},this.setClearAlpha=function(){S.setClearAlpha.apply(S,arguments)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===r||r)&&(n|=1024),p.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",fe,!1),t.removeEventListener("webglcontextrestored",pe,!1),R.dispose(),M.dispose(),E.dispose(),w.dispose(),ue.dispose(),Te.stop()},this.renderBufferImmediate=function(e,t){g.initAttributes();var r=E.get(e);e.hasPositions&&!r.position&&(r.position=p.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=p.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=p.createBuffer()),e.hasColors&&!r.color&&(r.color=p.createBuffer());var n=t.getAttributes();e.hasPositions&&(p.bindBuffer(34962,r.position),p.bufferData(34962,e.positionArray,35048),g.enableAttribute(n.position),p.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(p.bindBuffer(34962,r.normal),p.bufferData(34962,e.normalArray,35048),g.enableAttribute(n.normal),p.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(p.bindBuffer(34962,r.uv),p.bufferData(34962,e.uvArray,35048),g.enableAttribute(n.uv),p.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(p.bindBuffer(34962,r.color),p.bufferData(34962,e.colorArray,35048),g.enableAttribute(n.color),p.vertexAttribPointer(n.color,3,5126,!1,0,0)),g.disableUnusedAttributes(),p.drawArrays(4,0,e.count),e.count=0};var Ee=new Lr;this.renderBufferDirect=function(e,t,r,n,i,a){null===t&&(t=Ee);var o=i.isMesh&&i.matrixWorld.determinant()<0,s=Se(e,t,n,i);g.setMaterial(n,o);var l=!1;z.geometry===r.id&&z.program===s.id&&z.wireframe===(!0===n.wireframe)||(z.geometry=r.id,z.program=s.id,z.wireframe=!0===n.wireframe,l=!0),(n.morphTargets||n.morphNormals)&&(A.update(i,r,n,s),l=!0);var c=r.index,u=r.attributes.position;if(null===c){if(void 0===u||0===u.count)return}else if(0===c.count)return;var h,d=1;!0===n.wireframe&&(c=b.getWireframeAttribute(r),d=2);var f=L;null!==c&&(h=T.get(c),(f=P).setIndex(h)),l&&(function(e,t,r,n){if(!1!==v.isWebGL2||!e.isInstancedMesh&&!t.isInstancedBufferGeometry||null!==m.get("ANGLE_instanced_arrays")){g.initAttributes();var i=t.attributes,a=n.getAttributes(),o=r.defaultAttributeValues;for(var s in a){var l=a[s];if(l>=0){var c=i[s];if(void 0!==c){var u=c.normalized,h=c.itemSize,d=T.get(c);if(void 0===d)continue;var f=d.buffer,y=d.type,E=d.bytesPerElement;if(c.isInterleavedBufferAttribute){var x=c.data,b=x.stride,w=c.offset;x&&x.isInstancedInterleavedBuffer?(g.enableAttributeAndDivisor(l,x.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=x.meshPerAttribute*x.count)):g.enableAttribute(l),p.bindBuffer(34962,f),p.vertexAttribPointer(l,h,y,u,b*E,w*E)}else c.isInstancedBufferAttribute?(g.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=c.meshPerAttribute*c.count)):g.enableAttribute(l),p.bindBuffer(34962,f),p.vertexAttribPointer(l,h,y,u,0,0)}else if("instanceMatrix"===s){var d=T.get(e.instanceMatrix);if(void 0===d)continue;var f=d.buffer,y=d.type;g.enableAttributeAndDivisor(l+0,1),g.enableAttributeAndDivisor(l+1,1),g.enableAttributeAndDivisor(l+2,1),g.enableAttributeAndDivisor(l+3,1),p.bindBuffer(34962,f),p.vertexAttribPointer(l+0,4,y,!1,64,0),p.vertexAttribPointer(l+1,4,y,!1,64,16),p.vertexAttribPointer(l+2,4,y,!1,64,32),p.vertexAttribPointer(l+3,4,y,!1,64,48)}else if(void 0!==o){var _=o[s];if(void 0!==_)switch(_.length){case 2:p.vertexAttrib2fv(l,_);break;case 3:p.vertexAttrib3fv(l,_);break;case 4:p.vertexAttrib4fv(l,_);break;default:p.vertexAttrib1fv(l,_)}}}}g.disableUnusedAttributes()}}(i,r,n,s),null!==c&&p.bindBuffer(34963,h.buffer));var y=null!==c?c.count:u.count,E=r.drawRange.start*d,x=r.drawRange.count*d,w=null!==a?a.start*d:0,_=null!==a?a.count*d:1/0,R=Math.max(E,w),M=Math.min(y,E+x,w+_)-1,S=Math.max(0,M-R+1);if(0!==S){if(i.isMesh)!0===n.wireframe?(g.setLineWidth(n.wireframeLinewidth*se()),f.setMode(1)):f.setMode(4);else if(i.isLine){var C=n.linewidth;void 0===C&&(C=1),g.setLineWidth(C*se()),i.isLineSegments?f.setMode(1):i.isLineLoop?f.setMode(2):f.setMode(3)}else i.isPoints?f.setMode(0):i.isSprite&&f.setMode(4);i.isInstancedMesh?f.renderInstances(r,R,S,i.count):r.isInstancedBufferGeometry?f.renderInstances(r,R,S,r.maxInstancedCount):f.render(R,S)}},this.compile=function(e,t){(f=M.get(e,t)).init(),e.traverse(function(e){e.isLight&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))}),f.setupLights(t);var r={};e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)t.material[n].uuid in r==0&&(Me(t.material[n],e,t),r[t.material[n].uuid]=!0);else t.material.uuid in r==0&&(Me(t.material,e,t),r[t.material.uuid]=!0)})};var xe=null,Te=new Ui;function be(e,t,r,n){if(!1!==e.visible){var i=e.layers.test(t.layers);if(i)if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||te.intersectsSprite(e)){n&&oe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ae);var a=w.update(e),o=e.material;o.visible&&d.push(e,a,o,r,oe.z,null)}}else if(e.isImmediateRenderObject)n&&oe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ae),d.push(e,null,e.material,r,oe.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==y.render.frame&&(e.skeleton.update(),e.skeleton.frame=y.render.frame),!e.frustumCulled||te.intersectsObject(e))){n&&oe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ae);var a=w.update(e),o=e.material;if(Array.isArray(o))for(var s=a.groups,l=0,c=s.length;l<c;l++){var u=s[l],h=o[u.materialIndex];h&&h.visible&&d.push(e,a,h,r,oe.z,u)}else o.visible&&d.push(e,a,o,r,oe.z,null)}for(var p=e.children,l=0,c=p.length;l<c;l++)be(p[l],t,r,n)}}function we(e,t,r,n){for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,c=void 0===n?o.material:n,u=o.group;if(r.isArrayCamera){G=r;for(var h=r.cameras,d=0,p=h.length;d<p;d++){var m=h[d];s.layers.test(m.layers)&&(g.viewport(V.copy(m.viewport)),f.setupLights(m),_e(s,t,m,l,c,u))}}else G=null,_e(s,t,r,l,c,u)}}function _e(e,t,r,n,i,a){if(e.onBeforeRender(H,t,r,n,i,a),f=M.get(t,G||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var o=Se(r,t,i,e);g.setMaterial(i),z.geometry=null,z.program=null,z.wireframe=!1,function(e,t){e.render(function(e){H.renderBufferImmediate(e,t)})}(e,o)}else H.renderBufferDirect(r,t,n,i,e,a);e.onAfterRender(H,t,r,n,i,a),f=M.get(t,G||r)}function Me(e,t,r){var n=E.get(e),i=f.state.lights,a=f.state.shadowsArray,o=i.state.version,s=_.getParameters(e,i.state,a,t,re.numPlanes,re.numIntersection,r),l=_.getProgramCacheKey(s),c=n.program,u=!0;if(void 0===c)e.addEventListener("dispose",me);else if(c.cacheKey!==l)ve(e);else if(n.lightsStateVersion!==o)n.lightsStateVersion=o,u=!1;else{if(void 0!==s.shaderID)return;u=!1}u&&(c=_.acquireProgram(s,l),n.program=c,n.uniforms=s.uniforms,n.environment=e.isMeshStandardMaterial?t.environment:null,n.outputEncoding=H.outputEncoding,e.program=c);var h=c.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var d=0;d<H.maxMorphTargets;d++)h["morphTarget"+d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var d=0;d<H.maxMorphNormals;d++)h["morphNormal"+d]>=0&&e.numSupportedMorphNormals++}var p=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=re.numPlanes,n.numIntersection=re.numIntersection,p.clippingPlanes=re.uniform),n.fog=t.fog,n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=o,n.needsLights&&(p.ambientLightColor.value=i.state.ambient,p.lightProbe.value=i.state.probe,p.directionalLights.value=i.state.directional,p.directionalLightShadows.value=i.state.directionalShadow,p.spotLights.value=i.state.spot,p.spotLightShadows.value=i.state.spotShadow,p.rectAreaLights.value=i.state.rectArea,p.pointLights.value=i.state.point,p.pointLightShadows.value=i.state.pointShadow,p.hemisphereLights.value=i.state.hemi,p.directionalShadowMap.value=i.state.directionalShadowMap,p.directionalShadowMatrix.value=i.state.directionalShadowMatrix,p.spotShadowMap.value=i.state.spotShadowMap,p.spotShadowMatrix.value=i.state.spotShadowMatrix,p.pointShadowMap.value=i.state.pointShadowMap,p.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=n.program.getUniforms(),v=$a.seqWithValue(m.seq,p);n.uniformsList=v}function Se(e,t,r,n){x.resetTextureUnits();var i=t.fog,a=r.isMeshStandardMaterial?t.environment:null,o=E.get(r),s=f.state.lights;if(ne&&(ie||e!==B)){var c=e===B&&r.id===U;re.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,o,c)}r.version===o.__version?void 0===o.program?Me(r,t,n):r.fog&&o.fog!==i?Me(r,t,n):o.environment!==a?Me(r,t,n):o.needsLights&&o.lightsStateVersion!==s.state.version?Me(r,t,n):void 0===o.numClippingPlanes||o.numClippingPlanes===re.numPlanes&&o.numIntersection===re.numIntersection?o.outputEncoding!==H.outputEncoding&&Me(r,t,n):Me(r,t,n):(Me(r,t,n),o.__version=r.version);var u,h,d=!1,m=!1,y=!1,T=o.program,b=T.getUniforms(),w=o.uniforms;if(g.useProgram(T.program)&&(d=!0,m=!0,y=!0),r.id!==U&&(U=r.id,m=!0),d||B!==e){if(b.setValue(p,"projectionMatrix",e.projectionMatrix),v.logarithmicDepthBuffer&&b.setValue(p,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),B!==e&&(B=e,m=!0,y=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var _=b.map.cameraPosition;void 0!==_&&_.setValue(p,oe.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&b.setValue(p,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&b.setValue(p,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){b.setOptional(p,n,"bindMatrix"),b.setOptional(p,n,"bindMatrixInverse");var R=n.skeleton;if(R){var M=R.bones;if(v.floatVertexTextures){if(void 0===R.boneTexture){var S=Math.sqrt(4*M.length);S=jt.ceilPowerOfTwo(S),S=Math.max(S,4);var A=new Float32Array(S*S*4);A.set(R.boneMatrices);var L=new ki(A,S,S,Re,ge);R.boneMatrices=A,R.boneTexture=L,R.boneTextureSize=S}b.setValue(p,"boneTexture",R.boneTexture,x),b.setValue(p,"boneTextureSize",R.boneTextureSize)}else b.setOptional(p,R,"boneMatrices")}}return(m||o.receiveShadow!==n.receiveShadow)&&(o.receiveShadow=n.receiveShadow,b.setValue(p,"receiveShadow",n.receiveShadow)),m&&(b.setValue(p,"toneMappingExposure",H.toneMappingExposure),b.setValue(p,"toneMappingWhitePoint",H.toneMappingWhitePoint),o.needsLights&&(h=y,(u=w).ambientLightColor.needsUpdate=h,u.lightProbe.needsUpdate=h,u.directionalLights.needsUpdate=h,u.directionalLightShadows.needsUpdate=h,u.pointLights.needsUpdate=h,u.pointLightShadows.needsUpdate=h,u.spotLights.needsUpdate=h,u.spotLightShadows.needsUpdate=h,u.rectAreaLights.needsUpdate=h,u.hemisphereLights.needsUpdate=h),i&&r.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(w,i),r.isMeshBasicMaterial?Ae(w,r):r.isMeshLambertMaterial?(Ae(w,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(w,r)):r.isMeshToonMaterial?(Ae(w,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===l&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===l&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,r)):r.isMeshPhongMaterial?(Ae(w,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===l&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===l&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,r)):r.isMeshStandardMaterial?(Ae(w,r,a),r.isMeshPhysicalMaterial?function(e,t,r){Le(e,t,r),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===l&&e.clearcoatNormalScale.value.negate()),e.transparency.value=t.transparency}(w,r,a):Le(w,r,a)):r.isMeshMatcapMaterial?(Ae(w,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===l&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===l&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,r)):r.isMeshDepthMaterial?(Ae(w,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,r)):r.isMeshDistanceMaterial?(Ae(w,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(w,r)):r.isMeshNormalMaterial?(Ae(w,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===l&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===l&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(w,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(w,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(w,r)):r.isPointsMaterial?function(e,t){var r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*Z,e.scale.value=.5*q,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(w,r):r.isSpriteMaterial?function(e,t){var r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(w,r):r.isShadowMaterial&&(w.color.value.copy(r.color),w.opacity.value=r.opacity),void 0!==w.ltc_1&&(w.ltc_1.value=Di.LTC_1),void 0!==w.ltc_2&&(w.ltc_2.value=Di.LTC_2),$a.upload(p,o.uniformsList,w,x),r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&($a.upload(p,o.uniformsList,w,x),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&b.setValue(p,"center",n.center),b.setValue(p,"modelViewMatrix",n.modelViewMatrix),b.setValue(p,"normalMatrix",n.normalMatrix),b.setValue(p,"modelMatrix",n.matrixWorld),T}function Ae(e,t,r){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var n,i,a=t.envMap||r;a&&(e.envMap.value=a,e.flipEnvMap.value=a.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=E.get(a).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix)),t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function Le(e,t,r){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===l&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===l&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||r)&&(e.envMapIntensity.value=t.envMapIntensity)}Te.setAnimationLoop(function(e){ue.isPresenting||xe&&xe(e)}),"undefined"!=typeof window&&Te.setContext(window),this.setAnimationLoop=function(e){xe=e,ue.setAnimationLoop(e),Te.start()},this.render=function(e,t){var r,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),t&&t.isCamera){if(!I){z.geometry=null,z.program=null,z.wireframe=!1,U=-1,B=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ue.enabled&&ue.isPresenting&&(t=ue.getCamera(t)),(f=M.get(e,t)).init(),e.onBeforeRender(H,e,t,r||F),ae.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),te.setFromProjectionMatrix(ae),ie=this.localClippingEnabled,ne=re.init(this.clippingPlanes,ie,t),(d=R.get(e,t)).init(),be(e,t,0,H.sortObjects),d.finish(),!0===H.sortObjects&&d.sort(Q,K),ne&&re.beginShadows();var i=f.state.shadowsArray;de.render(i,e,t),f.setupLights(t),ne&&re.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),S.render(d,e,t,n);var a=d.opaque,o=d.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&we(a,e,t,s),o.length&&we(o,e,t,s)}else a.length&&we(a,e,t),o.length&&we(o,e,t);e.onAfterRender(H,e,t),null!==F&&(x.updateRenderTargetMipmap(F),x.updateMultisampleRenderTarget(F)),g.buffers.depth.setTest(!0),g.buffers.depth.setMask(!0),g.buffers.color.setMask(!0),g.setPolygonOffset(!1),d=null,f=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){k!==e&&null===F&&p.bindFramebuffer(36160,e),k=e},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return O},this.getRenderTarget=function(){return F},this.setRenderTarget=function(e,t,r){F=e,N=t,O=r,e&&void 0===E.get(e).__webglFramebuffer&&x.setupRenderTarget(e);var n=k,i=!1;if(e){var a=E.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=a[t||0],i=!0):n=e.isWebGLMultisampleRenderTarget?E.get(e).__webglMultisampledFramebuffer:a,V.copy(e.viewport),W.copy(e.scissor),X=e.scissorTest}else V.copy(J).multiplyScalar(Z).floor(),W.copy($).multiplyScalar(Z).floor(),X=ee;if(D!==n&&(p.bindFramebuffer(36160,n),D=n),g.viewport(V),g.scissor(W),g.setScissorTest(X),i){var o=E.get(e.texture);p.framebufferTexture2D(36160,36064,34069+(t||0),o.__webglTexture,r||0)}},this.readRenderTargetPixels=function(e,t,r,n,i,a,o){if(e&&e.isWebGLRenderTarget){var s=E.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){var l=!1;s!==D&&(p.bindFramebuffer(36160,s),l=!0);try{var c=e.texture,u=c.format,h=c.type;if(u!==Re&&C.convert(u)!==p.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===he||C.convert(h)===p.getParameter(35738)||h===ge&&(v.isWebGL2||m.get("OES_texture_float")||m.get("WEBGL_color_buffer_float"))||h===ye&&(v.isWebGL2?m.get("EXT_color_buffer_float"):m.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===p.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&p.readPixels(t,r,n,i,C.convert(u),C.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&p.bindFramebuffer(36160,D)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){void 0===r&&(r=0);var n=Math.pow(2,-r),i=Math.floor(t.image.width*n),a=Math.floor(t.image.height*n),o=C.convert(t.format);x.setTexture2D(t,0),p.copyTexImage2D(3553,r,o,e.x,e.y,i,a,0),g.unbindTexture()},this.copyTextureToTexture=function(e,t,r,n){var i=t.image.width,a=t.image.height,o=C.convert(r.format),s=C.convert(r.type);x.setTexture2D(r,0),t.isDataTexture?p.texSubImage2D(3553,n||0,e.x,e.y,i,a,o,s,t.image.data):p.texSubImage2D(3553,n||0,e.x,e.y,o,s,t.image),g.unbindTexture()},this.initTexture=function(e){x.setTexture2D(e,0),g.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Go(e,t){this.name="",this.color=new xn(e),this.density=void 0!==t?t:25e-5}function Vo(e,t,r){this.name="",this.color=new xn(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function jo(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Dt,this.updateRange={offset:0,count:-1},this.version=0}Do.prototype=Object.assign(Object.create(Li.prototype),{constructor:Do,isArrayCamera:!0}),Uo.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Uo,isGroup:!0}),Object.assign(zo.prototype,zt.prototype),Object.assign(Go.prototype,{isFogExp2:!0,clone:function(){return new Go(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Vo.prototype,{isFog:!0,clone:function(){return new Vo(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(jo.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(jo.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var Wo,Xo=new rr;function Yo(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function qo(e){Mn.call(this),this.type="SpriteMaterial",this.color=new xn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(Yo.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Yo.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,r=this.data.count;t<r;t++)Xo.x=this.getX(t),Xo.y=this.getY(t),Xo.z=this.getZ(t),Xo.applyMatrix4(e),this.setXYZ(t,Xo.x,Xo.y,Xo.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}}),qo.prototype=Object.create(Mn.prototype),qo.prototype.constructor=qo,qo.prototype.isSpriteMaterial=!0,qo.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Zo=new rr,Qo=new rr,Ko=new rr,Jo=new Wt,$o=new Wt,es=new ur,ts=new rr,rs=new rr,ns=new rr,is=new Wt,as=new Wt,os=new Wt;function ss(e){if(Ar.call(this),this.type="Sprite",void 0===Wo){Wo=new qn;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new jo(t,5);Wo.setIndex([0,1,2,0,2,3]),Wo.setAttribute("position",new Yo(r,3,0,!1)),Wo.setAttribute("uv",new Yo(r,2,3,!1))}this.geometry=Wo,this.material=void 0!==e?e:new qo,this.center=new Wt(.5,.5)}function ls(e,t,r,n,i,a){Jo.subVectors(e,r).addScalar(.5).multiply(n),void 0!==i?($o.x=a*Jo.x-i*Jo.y,$o.y=i*Jo.x+a*Jo.y):$o.copy(Jo),e.copy(t),e.x+=$o.x,e.y+=$o.y,e.applyMatrix4(es)}ss.prototype=Object.assign(Object.create(Ar.prototype),{constructor:ss,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Qo.setFromMatrixScale(this.matrixWorld),es.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ko.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Qo.multiplyScalar(-Ko.z);var r,n,i=this.material.rotation;0!==i&&(n=Math.cos(i),r=Math.sin(i));var a=this.center;ls(ts.set(-.5,-.5,0),Ko,a,Qo,r,n),ls(rs.set(.5,-.5,0),Ko,a,Qo,r,n),ls(ns.set(.5,.5,0),Ko,a,Qo,r,n),is.set(0,0),as.set(1,0),os.set(1,1);var o=e.ray.intersectTriangle(ts,rs,ns,!1,Zo);if(null!==o||(ls(rs.set(-.5,.5,0),Ko,a,Qo,r,n),as.set(0,1),null!==(o=e.ray.intersectTriangle(ts,ns,rs,!1,Zo)))){var s=e.ray.origin.distanceTo(Zo);s<e.near||s>e.far||t.push({distance:s,point:Zo.clone(),uv:vn.getUV(Zo,ts,rs,ns,is,as,os,new Wt),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Ar.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var cs=new rr,us=new rr;function hs(){Ar.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function ds(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),di.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ur,this.bindMatrixInverse=new ur}hs.prototype=Object.assign(Object.create(Ar.prototype),{constructor:hs,isLOD:!0,copy:function(e){Ar.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object}return null},raycast:function(e,t){var r=this.levels;if(r.length>0){cs.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(cs);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){cs.setFromMatrixPosition(e.matrixWorld),us.setFromMatrixPosition(this.matrixWorld);var r=cs.distanceTo(us)/e.zoom;t[0].object.visible=!0;for(var n=1,i=t.length;n<i&&r>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<i;n++)t[n].object.visible=!1}},toJSON:function(e){var t=Ar.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var a=r[n];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),ds.prototype=Object.assign(Object.create(di.prototype),{constructor:ds,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Qt,t=this.geometry.attributes.skinWeight,r=0,n=t.count;r<n;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){di.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var fs=new ur,ps=new ur;function ms(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new ur)}}function vs(){Ar.call(this),this.type="Bone"}Object.assign(ms.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new ur;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:ps;fs.multiplyMatrices(o,t[i]),fs.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new ms(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}}),vs.prototype=Object.assign(Object.create(Ar.prototype),{constructor:vs,isBone:!0});var gs=new ur,ys=new ur,Es=[],xs=new di;function Ts(e,t,r){di.call(this,e,t),this.instanceMatrix=new Ln(new Float32Array(16*r),16),this.count=r,this.frustumCulled=!1}function bs(e){Mn.call(this),this.type="LineBasicMaterial",this.color=new xn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Ts.prototype=Object.assign(Object.create(di.prototype),{constructor:Ts,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var r=this.matrixWorld,n=this.count;if(xs.geometry=this.geometry,xs.material=this.material,void 0!==xs.material)for(var i=0;i<n;i++)this.getMatrixAt(i,gs),ys.multiplyMatrices(r,gs),xs.matrixWorld=ys,xs.raycast(e,Es),Es.length>0&&(Es[0].instanceId=i,Es[0].object=this,t.push(Es[0]),Es.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),bs.prototype=Object.create(Mn.prototype),bs.prototype.constructor=bs,bs.prototype.isLineBasicMaterial=!0,bs.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var ws=new rr,_s=new rr,Rs=new ur,Ms=new en,Ss=new Xr;function As(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Ar.call(this),this.type="Line",this.geometry=void 0!==e?e:new qn,this.material=void 0!==t?t:new bs}As.prototype=Object.assign(Object.create(Ar.prototype),{constructor:As,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],n=1,i=t.count;n<i;n++)ws.fromBufferAttribute(t,n-1),_s.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=ws.distanceTo(_s);e.setAttribute("lineDistance",new Fn(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices,r=e.lineDistances;r[0]=0;for(var n=1,i=a.length;n<i;n++)r[n]=r[n-1],r[n]+=a[n-1].distanceTo(a[n])}return this},raycast:function(e,t){var r=this.geometry,n=this.matrixWorld,i=e.params.Line.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),Ss.copy(r.boundingSphere),Ss.applyMatrix4(n),Ss.radius+=i,!1!==e.ray.intersectsSphere(Ss)){Rs.getInverse(n),Ms.copy(e.ray).applyMatrix4(Rs);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new rr,l=new rr,c=new rr,u=new rr,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var d=r.index,f=r.attributes,p=f.position.array;if(null!==d)for(var m=d.array,v=0,g=m.length-1;v<g;v+=h){var y=m[v],E=m[v+1];s.fromArray(p,3*y),l.fromArray(p,3*E);var x=Ms.distanceSqToSegment(s,l,u,c);if(!(x>o)){u.applyMatrix4(this.matrixWorld);var T=e.ray.origin.distanceTo(u);T<e.near||T>e.far||t.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var v=0,g=p.length/3-1;v<g;v+=h){s.fromArray(p,3*v),l.fromArray(p,3*v+3);var x=Ms.distanceSqToSegment(s,l,u,c);if(!(x>o)){u.applyMatrix4(this.matrixWorld);var T=e.ray.origin.distanceTo(u);T<e.near||T>e.far||t.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}else if(r.isGeometry)for(var b=r.vertices,w=b.length,v=0;v<w-1;v+=h){var x=Ms.distanceSqToSegment(b[v],b[v+1],u,c);if(!(x>o)){u.applyMatrix4(this.matrixWorld);var T=e.ray.origin.distanceTo(u);T<e.near||T>e.far||t.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ls=new rr,Ps=new rr;function Cs(e,t){As.call(this,e,t),this.type="LineSegments"}function Hs(e,t){As.call(this,e,t),this.type="LineLoop"}function Is(e){Mn.call(this),this.type="PointsMaterial",this.color=new xn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}Cs.prototype=Object.assign(Object.create(As.prototype),{constructor:Cs,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[],n=0,i=t.count;n<i;n+=2)Ls.fromBufferAttribute(t,n),Ps.fromBufferAttribute(t,n+1),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Ls.distanceTo(Ps);e.setAttribute("lineDistance",new Fn(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(var a=e.vertices,r=e.lineDistances,n=0,i=a.length;n<i;n+=2)Ls.copy(a[n]),Ps.copy(a[n+1]),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Ls.distanceTo(Ps);return this}}),Hs.prototype=Object.assign(Object.create(As.prototype),{constructor:Hs,isLineLoop:!0}),Is.prototype=Object.create(Mn.prototype),Is.prototype.constructor=Is,Is.prototype.isPointsMaterial=!0,Is.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var ks=new ur,Ns=new en,Os=new Xr,Fs=new rr;function Ds(e,t){Ar.call(this),this.type="Points",this.geometry=void 0!==e?e:new qn,this.material=void 0!==t?t:new Is,this.updateMorphTargets()}function Us(e,t,r,n,i,a,o){var s=Ns.distanceSqToPoint(e);if(s<r){var l=new rr;Ns.closestPointToPoint(e,l),l.applyMatrix4(n);var c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;a.push({distance:c,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}function zs(e,t,r,n,i,a,o,s,l){Zt.call(this,e,t,r,n,i,a,o,s,l),this.format=void 0!==o?o:_e,this.minFilter=void 0!==a?a:le,this.magFilter=void 0!==i?i:le,this.generateMipmaps=!1}function Bs(e,t,r,n,i,a,o,s,l,c,u,h){Zt.call(this,null,a,o,s,l,c,n,i,u,h),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Gs(e,t,r,n,i,a,o,s,l){Zt.call(this,e,t,r,n,i,a,o,s,l),this.needsUpdate=!0}function Vs(e,t,r,n,i,a,o,s,l,c){if((c=void 0!==c?c:Le)!==Le&&c!==Pe)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&c===Le&&(r=pe),void 0===r&&c===Pe&&(r=be),Zt.call(this,null,n,i,a,o,s,c,r,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:ae,this.minFilter=void 0!==s?s:ae,this.flipY=!1,this.generateMipmaps=!1}function js(e){qn.call(this),this.type="WireframeGeometry";var t,r,n,i,a,o,s,l,c,u,h=[],d=[0,0],f={},p=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var v=m[t];for(r=0;r<3;r++)s=v[p[r]],l=v[p[(r+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),c=d[0]+","+d[1],void 0===f[c]&&(f[c]={index1:d[0],index2:d[1]})}for(c in f)o=f[c],u=e.vertices[o.index1],h.push(u.x,u.y,u.z),u=e.vertices[o.index2],h.push(u.x,u.y,u.z)}else if(e&&e.isBufferGeometry){var g,y,E,x,T,b,w,_;if(u=new rr,null!==e.index){for(g=e.attributes.position,y=e.index,0===(E=e.groups).length&&(E=[{start:0,count:y.count,materialIndex:0}]),i=0,a=E.length;i<a;++i)for(x=E[i],T=x.start,b=x.count,t=T,n=T+b;t<n;t+=3)for(r=0;r<3;r++)s=y.getX(t+r),l=y.getX(t+(r+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),c=d[0]+","+d[1],void 0===f[c]&&(f[c]={index1:d[0],index2:d[1]});for(c in f)o=f[c],u.fromBufferAttribute(g,o.index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,o.index2),h.push(u.x,u.y,u.z)}else for(g=e.attributes.position,t=0,n=g.count/3;t<n;t++)for(r=0;r<3;r++)w=3*t+r,u.fromBufferAttribute(g,w),h.push(u.x,u.y,u.z),_=3*t+(r+1)%3,u.fromBufferAttribute(g,_),h.push(u.x,u.y,u.z)}this.setAttribute("position",new Fn(h,3))}function Ws(e,t,r){Ei.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new Xs(e,t,r)),this.mergeVertices()}function Xs(e,t,r){qn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,a=[],o=[],s=[],l=[],c=new rr,u=new rr,h=new rr,d=new rr,f=new rr;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var p=t+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=t;i++){var v=i/t;e(v,m,u),o.push(u.x,u.y,u.z),v-1e-5>=0?(e(v-1e-5,m,h),d.subVectors(u,h)):(e(v+1e-5,m,h),d.subVectors(h,u)),m-1e-5>=0?(e(v,m-1e-5,h),f.subVectors(u,h)):(e(v,m+1e-5,h),f.subVectors(h,u)),c.crossVectors(d,f).normalize(),s.push(c.x,c.y,c.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<t;i++){var g=n*p+i,y=n*p+i+1,E=(n+1)*p+i+1,x=(n+1)*p+i;a.push(g,y,x),a.push(y,E,x)}this.setIndex(a),this.setAttribute("position",new Fn(o,3)),this.setAttribute("normal",new Fn(s,3)),this.setAttribute("uv",new Fn(l,2))}function Ys(e,t,r,n){Ei.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new qs(e,t,r,n)),this.mergeVertices()}function qs(e,t,r,n){qn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var i=[],a=[];function o(e,t,r,n){var i,a,o=Math.pow(2,n),l=[];for(i=0;i<=o;i++){l[i]=[];var c=e.clone().lerp(r,i/o),u=t.clone().lerp(r,i/o),h=o-i;for(a=0;a<=h;a++)l[i][a]=0===a&&i===o?c:c.clone().lerp(u,a/h)}for(i=0;i<o;i++)for(a=0;a<2*(o-i)-1;a++){var d=Math.floor(a/2);a%2==0?(s(l[i][d+1]),s(l[i+1][d]),s(l[i][d])):(s(l[i][d+1]),s(l[i+1][d+1]),s(l[i+1][d]))}}function s(e){i.push(e.x,e.y,e.z)}function l(t,r){var n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function c(e,t,r,n){n<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=n/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){for(var r=new rr,n=new rr,i=new rr,a=0;a<t.length;a+=3)l(t[a+0],r),l(t[a+1],n),l(t[a+2],i),o(r,n,i,e)}(n=n||0),function(e){for(var t=new rr,r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function(){for(var e=new rr,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var r=u(e)/2/Math.PI+.5,n=(o=e,Math.atan2(-o.y,Math.sqrt(o.x*o.x+o.z*o.z))/Math.PI+.5);a.push(r,1-n)}var o;(function(){for(var e=new rr,t=new rr,r=new rr,n=new rr,o=new Wt,s=new Wt,l=new Wt,h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),n.copy(e).add(t).add(r).divideScalar(3);var f=u(n);c(o,d+0,e,f),c(s,d+2,t,f),c(l,d+4,r,f)}})(),function(){for(var e=0;e<a.length;e+=6){var t=a[e+0],r=a[e+2],n=a[e+4],i=Math.max(t,r,n),o=Math.min(t,r,n);i>.9&&o<.1&&(t<.2&&(a[e+0]+=1),r<.2&&(a[e+2]+=1),n<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new Fn(i,3)),this.setAttribute("normal",new Fn(i.slice(),3)),this.setAttribute("uv",new Fn(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Zs(e,t){Ei.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Qs(e,t)),this.mergeVertices()}function Qs(e,t){qs.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ks(e,t){Ei.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Js(e,t)),this.mergeVertices()}function Js(e,t){qs.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function $s(e,t){Ei.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new el(e,t)),this.mergeVertices()}function el(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];qs.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function tl(e,t){Ei.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new rl(e,t)),this.mergeVertices()}function rl(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];qs.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function nl(e,t,r,n,i,a){Ei.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new il(e,t,r,n,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function il(e,t,r,n,i){qn.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},t=t||64,r=r||1,n=n||8,i=i||!1;var a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,l=new rr,c=new rr,u=new Wt,h=new rr,d=[],f=[],p=[],m=[];function v(i){h=e.getPointAt(i/t,h);var o=a.normals[i],u=a.binormals[i];for(s=0;s<=n;s++){var p=s/n*Math.PI*2,m=Math.sin(p),v=-Math.cos(p);c.x=v*o.x+m*u.x,c.y=v*o.y+m*u.y,c.z=v*o.z+m*u.z,c.normalize(),f.push(c.x,c.y,c.z),l.x=h.x+r*c.x,l.y=h.y+r*c.y,l.z=h.z+r*c.z,d.push(l.x,l.y,l.z)}}!function(){for(o=0;o<t;o++)v(o);v(!1===i?t:0),function(){for(o=0;o<=t;o++)for(s=0;s<=n;s++)u.x=o/t,u.y=s/n,p.push(u.x,u.y)}(),function(){for(s=1;s<=t;s++)for(o=1;o<=n;o++){var e=(n+1)*(s-1)+(o-1),r=(n+1)*s+(o-1),i=(n+1)*s+o,a=(n+1)*(s-1)+o;m.push(e,r,a),m.push(r,i,a)}}()}(),this.setIndex(m),this.setAttribute("position",new Fn(d,3)),this.setAttribute("normal",new Fn(f,3)),this.setAttribute("uv",new Fn(p,2))}function al(e,t,r,n,i,a,o){Ei.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new ol(e,t,r,n,i,a)),this.mergeVertices()}function ol(e,t,r,n,i,a){qn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,a=a||3;var o,s,l=[],c=[],u=[],h=[],d=new rr,f=new rr,p=new rr,m=new rr,v=new rr,g=new rr,y=new rr;for(o=0;o<=r;++o){var E=o/r*i*Math.PI*2;for(S(E,i,a,e,p),S(E+.01,i,a,e,m),g.subVectors(m,p),y.addVectors(m,p),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=n;++s){var x=s/n*Math.PI*2,T=-t*Math.cos(x),b=t*Math.sin(x);d.x=p.x+(T*y.x+b*v.x),d.y=p.y+(T*y.y+b*v.y),d.z=p.z+(T*y.z+b*v.z),c.push(d.x,d.y,d.z),f.subVectors(d,p).normalize(),u.push(f.x,f.y,f.z),h.push(o/r),h.push(s/n)}}for(s=1;s<=r;s++)for(o=1;o<=n;o++){var w=(n+1)*(s-1)+(o-1),_=(n+1)*s+(o-1),R=(n+1)*s+o,M=(n+1)*(s-1)+o;l.push(w,_,M),l.push(_,R,M)}function S(e,t,r,n,i){var a=Math.cos(e),o=Math.sin(e),s=r/t*e,l=Math.cos(s);i.x=n*(2+l)*.5*a,i.y=n*(2+l)*o*.5,i.z=n*Math.sin(s)*.5}this.setIndex(l),this.setAttribute("position",new Fn(c,3)),this.setAttribute("normal",new Fn(u,3)),this.setAttribute("uv",new Fn(h,2))}function sl(e,t,r,n,i){Ei.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new ll(e,t,r,n,i)),this.mergeVertices()}function ll(e,t,r,n,i){qn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var a,o,s=[],l=[],c=[],u=[],h=new rr,d=new rr,f=new rr;for(a=0;a<=r;a++)for(o=0;o<=n;o++){var p=o/n*i,m=a/r*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(p),d.y=(e+t*Math.cos(m))*Math.sin(p),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),h.x=e*Math.cos(p),h.y=e*Math.sin(p),f.subVectors(d,h).normalize(),c.push(f.x,f.y,f.z),u.push(o/n),u.push(a/r)}for(a=1;a<=r;a++)for(o=1;o<=n;o++){var v=(n+1)*a+o-1,g=(n+1)*(a-1)+o-1,y=(n+1)*(a-1)+o,E=(n+1)*a+o;s.push(v,g,E),s.push(g,y,E)}this.setIndex(s),this.setAttribute("position",new Fn(l,3)),this.setAttribute("normal",new Fn(c,3)),this.setAttribute("uv",new Fn(u,2))}Ds.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Ds,isPoints:!0,raycast:function(e,t){var r=this.geometry,n=this.matrixWorld,i=e.params.Points.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),Os.copy(r.boundingSphere),Os.applyMatrix4(n),Os.radius+=i,!1!==e.ray.intersectsSphere(Os)){ks.getInverse(n),Ns.copy(e.ray).applyMatrix4(ks);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(r.isBufferGeometry){var s=r.index,l=r.attributes,c=l.position.array;if(null!==s)for(var u=s.array,h=0,d=u.length;h<d;h++){var f=u[h];Fs.fromArray(c,3*f),Us(Fs,f,o,n,e,t,this)}else for(var h=0,p=c.length/3;h<p;h++)Fs.fromArray(c,3*h),Us(Fs,h,o,n,e,t,this)}else for(var m=r.vertices,h=0,p=m.length;h<p;h++)Us(m[h],h,o,n,e,t,this)}},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),zs.prototype=Object.assign(Object.create(Zt.prototype),{constructor:zs,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Bs.prototype=Object.create(Zt.prototype),Bs.prototype.constructor=Bs,Bs.prototype.isCompressedTexture=!0,Gs.prototype=Object.create(Zt.prototype),Gs.prototype.constructor=Gs,Gs.prototype.isCanvasTexture=!0,Vs.prototype=Object.create(Zt.prototype),Vs.prototype.constructor=Vs,Vs.prototype.isDepthTexture=!0,js.prototype=Object.create(qn.prototype),js.prototype.constructor=js,Ws.prototype=Object.create(Ei.prototype),Ws.prototype.constructor=Ws,Xs.prototype=Object.create(qn.prototype),Xs.prototype.constructor=Xs,Ys.prototype=Object.create(Ei.prototype),Ys.prototype.constructor=Ys,qs.prototype=Object.create(qn.prototype),qs.prototype.constructor=qs,Zs.prototype=Object.create(Ei.prototype),Zs.prototype.constructor=Zs,Qs.prototype=Object.create(qs.prototype),Qs.prototype.constructor=Qs,Ks.prototype=Object.create(Ei.prototype),Ks.prototype.constructor=Ks,Js.prototype=Object.create(qs.prototype),Js.prototype.constructor=Js,$s.prototype=Object.create(Ei.prototype),$s.prototype.constructor=$s,el.prototype=Object.create(qs.prototype),el.prototype.constructor=el,tl.prototype=Object.create(Ei.prototype),tl.prototype.constructor=tl,rl.prototype=Object.create(qs.prototype),rl.prototype.constructor=rl,nl.prototype=Object.create(Ei.prototype),nl.prototype.constructor=nl,il.prototype=Object.create(qn.prototype),il.prototype.constructor=il,il.prototype.toJSON=function(){var e=qn.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},al.prototype=Object.create(Ei.prototype),al.prototype.constructor=al,ol.prototype=Object.create(qn.prototype),ol.prototype.constructor=ol,sl.prototype=Object.create(Ei.prototype),sl.prototype.constructor=sl,ll.prototype=Object.create(qn.prototype),ll.prototype.constructor=ll;var cl={triangulate:function(e,t,r){r=r||2;var n,i,a,o,s,l,c,u=t&&t.length,h=u?t[0]*r:e.length,d=ul(e,0,h,r,!0),f=[];if(!d||d.next===d.prev)return f;if(u&&(d=function(e,t,r,n){var i,a,o,s,l,c=[];for(i=0,a=t.length;i<a;i++)o=t[i]*n,s=i<a-1?t[i+1]*n:e.length,(l=ul(e,o,s,n,!1))===l.next&&(l.steiner=!0),c.push(xl(l));for(c.sort(gl),i=0;i<c.length;i++)yl(c[i],r),r=hl(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=a=e[0],i=o=e[1];for(var p=r;p<h;p+=r)s=e[p],l=e[p+1],s<n&&(n=s),l<i&&(i=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-n,o-i))?1/c:0}return dl(d,f,r,n,i,c),f}};function ul(e,t,r,n,i){var a,o;if(i===function(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,r,n)>0)for(a=t;a<r;a+=n)o=Al(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=Al(a,e[a],e[a+1],o);return o&&_l(o,o.next)&&(Ll(o),o=o.next),o}function hl(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!_l(n,n.next)&&0!==wl(n.prev,n,n.next))n=n.next;else{if(Ll(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function dl(e,t,r,n,i,a,o){if(e){!o&&a&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=El(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,c=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,c*=2}while(o>1)}(i)}(e,n,i,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?pl(e,n,i,a):fl(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),Ll(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?dl(e=ml(e,t,r),t,r,n,i,a,2):2===o&&vl(e,t,r,n,i,a):dl(hl(e),t,r,n,i,a,1);break}}}function fl(e){var t=e.prev,r=e,n=e.next;if(wl(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Tl(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&wl(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function pl(e,t,r,n){var i=e.prev,a=e,o=e.next;if(wl(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,c=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=El(s,l,t,r,n),d=El(c,u,t,r,n),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&Tl(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&wl(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&Tl(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&wl(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&Tl(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&wl(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&Tl(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&wl(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function ml(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!_l(i,a)&&Rl(i,n,n.next,a)&&Ml(i,a)&&Ml(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),Ll(n),Ll(n.next),n=e=a),n=n.next}while(n!==e);return n}function vl(e,t,r,n,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&bl(o,s)){var l=Sl(o,s);return o=hl(o,o.next),l=hl(l,l.next),dl(o,t,r,n,i,a),void dl(l,t,r,n,i,a)}s=s.next}o=o.next}while(o!==e)}function gl(e,t){return e.x-t.x}function yl(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&Tl(a<h?i:o,a,u,h,a<h?o:i,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&Ml(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=Sl(t,e);hl(r,r.next)}}function El(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xl(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function Tl(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function bl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Rl(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&Ml(e,t)&&Ml(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function wl(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function _l(e,t){return e.x===t.x&&e.y===t.y}function Rl(e,t,r,n){return!!(_l(e,r)&&_l(t,n)||_l(e,n)&&_l(r,t))||wl(e,t,r)>0!=wl(e,t,n)>0&&wl(r,n,e)>0!=wl(r,n,t)>0}function Ml(e,t){return wl(e.prev,e,e.next)<0?wl(e,t,e.next)>=0&&wl(e,e.prev,t)>=0:wl(e,t,e.prev)<0||wl(e,e.next,t)<0}function Sl(e,t){var r=new Pl(e.i,e.x,e.y),n=new Pl(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function Al(e,t,r,n){var i=new Pl(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ll(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Pl(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Cl={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function(e){return Cl.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],i=[];Hl(e),Il(r,e);var a=e.length;t.forEach(Hl);for(var o=0;o<t.length;o++)n.push(a),a+=t[o].length,Il(r,t[o]);for(var s=cl.triangulate(r,n),o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function Hl(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Il(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function kl(e,t){Ei.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Nl(e,t)),this.mergeVertices()}function Nl(e,t){qn.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,n=[],i=[],a=0,o=e.length;a<o;a++){var s=e[a];l(s)}function l(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3,p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Ol;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var v,g,y,E,x,T,b,w,_=!1;p&&(v=p.getSpacedPoints(s),_=!0,c=!1,g=p.computeFrenetFrames(s,!1),y=new rr,E=new rr,x=new rr),c||(f=0,u=0,h=0,d=0);var R=e.extractPoints(o),M=R.shape,S=R.holes,A=!Cl.isClockWise(M);if(A)for(M=M.reverse(),b=0,w=S.length;b<w;b++)T=S[b],Cl.isClockWise(T)&&(S[b]=T.reverse());var L=Cl.triangulateShape(M,S),P=M;for(b=0,w=S.length;b<w;b++)T=S[b],M=M.concat(T);function C(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var H,I,k,N,O,F,D=M.length,U=L.length;function z(e,t,r){var n,i,a,o=e.x-t.x,s=e.y-t.y,l=r.x-e.x,c=r.y-e.y,u=o*o+s*s,h=o*c-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(u),f=Math.sqrt(l*l+c*c),p=t.x-s/d,m=t.y+o/d,v=r.x-c/f,g=r.y+l/f,y=((v-p)*c-(g-m)*l)/(o*c-s*l);n=p+o*y-e.x,i=m+s*y-e.y;var E=n*n+i*i;if(E<=2)return new Wt(n,i);a=Math.sqrt(E/2)}else{var x=!1;o>Number.EPSILON?l>Number.EPSILON&&(x=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(x=!0):Math.sign(s)===Math.sign(c)&&(x=!0),x?(n=-s,i=o,a=Math.sqrt(u)):(n=o,i=s,a=Math.sqrt(u/2))}return new Wt(n/a,i/a)}for(var B=[],G=0,V=P.length,j=V-1,W=G+1;G<V;G++,j++,W++)j===V&&(j=0),W===V&&(W=0),B[G]=z(P[G],P[j],P[W]);var X,Y,q=[],Z=B.concat();for(b=0,w=S.length;b<w;b++){for(T=S[b],X=[],G=0,V=T.length,j=V-1,W=G+1;G<V;G++,j++,W++)j===V&&(j=0),W===V&&(W=0),X[G]=z(T[G],T[j],T[W]);q.push(X),Z=Z.concat(X)}for(H=0;H<f;H++){for(k=H/f,N=u*Math.cos(k*Math.PI/2),I=h*Math.sin(k*Math.PI/2)+d,G=0,V=P.length;G<V;G++)K((O=C(P[G],B[G],I)).x,O.y,-N);for(b=0,w=S.length;b<w;b++)for(T=S[b],X=q[b],G=0,V=T.length;G<V;G++)K((O=C(T[G],X[G],I)).x,O.y,-N)}for(I=h+d,G=0;G<D;G++)O=c?C(M[G],Z[G],I):M[G],_?(E.copy(g.normals[0]).multiplyScalar(O.x),y.copy(g.binormals[0]).multiplyScalar(O.y),x.copy(v[0]).add(E).add(y),K(x.x,x.y,x.z)):K(O.x,O.y,0);for(Y=1;Y<=s;Y++)for(G=0;G<D;G++)O=c?C(M[G],Z[G],I):M[G],_?(E.copy(g.normals[Y]).multiplyScalar(O.x),y.copy(g.binormals[Y]).multiplyScalar(O.y),x.copy(v[Y]).add(E).add(y),K(x.x,x.y,x.z)):K(O.x,O.y,l/s*Y);for(H=f-1;H>=0;H--){for(k=H/f,N=u*Math.cos(k*Math.PI/2),I=h*Math.sin(k*Math.PI/2)+d,G=0,V=P.length;G<V;G++)K((O=C(P[G],B[G],I)).x,O.y,l+N);for(b=0,w=S.length;b<w;b++)for(T=S[b],X=q[b],G=0,V=T.length;G<V;G++)O=C(T[G],X[G],I),_?K(O.x,O.y+v[s-1].y,v[s-1].x+N):K(O.x,O.y,l+N)}function Q(e,t){var r,n;for(G=e.length;--G>=0;){r=G,(n=G-1)<0&&(n=e.length-1);var i=0,a=s+2*f;for(i=0;i<a;i++){var o=D*i,l=D*(i+1),c=t+r+o,u=t+n+o,h=t+n+l,d=t+r+l;$(c,u,h,d)}}}function K(e,t,r){a.push(e),a.push(t),a.push(r)}function J(e,t,i){ee(e),ee(t),ee(i);var a=n.length/3,o=m.generateTopUV(r,n,a-3,a-2,a-1);te(o[0]),te(o[1]),te(o[2])}function $(e,t,i,a){ee(e),ee(t),ee(a),ee(t),ee(i),ee(a);var o=n.length/3,s=m.generateSideWallUV(r,n,o-6,o-3,o-2,o-1);te(s[0]),te(s[1]),te(s[3]),te(s[1]),te(s[2]),te(s[3])}function ee(e){n.push(a[3*e+0]),n.push(a[3*e+1]),n.push(a[3*e+2])}function te(e){i.push(e.x),i.push(e.y)}!function(){var e=n.length/3;if(c){var t=0,i=D*t;for(G=0;G<U;G++)J((F=L[G])[2]+i,F[1]+i,F[0]+i);for(i=D*(t=s+2*f),G=0;G<U;G++)J((F=L[G])[0]+i,F[1]+i,F[2]+i)}else{for(G=0;G<U;G++)J((F=L[G])[2],F[1],F[0]);for(G=0;G<U;G++)J((F=L[G])[0]+D*s,F[1]+D*s,F[2]+D*s)}r.addGroup(e,n.length/3-e,0)}(),function(){var e=n.length/3,t=0;for(Q(P,t),t+=P.length,b=0,w=S.length;b<w;b++)Q(T=S[b],t),t+=T.length;r.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new Fn(n,3)),this.setAttribute("uv",new Fn(i,2)),this.computeVertexNormals()}kl.prototype=Object.create(Ei.prototype),kl.prototype.constructor=kl,kl.prototype.toJSON=function(){var e=Ei.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return Fl(t,r,e)},Nl.prototype=Object.create(qn.prototype),Nl.prototype.constructor=Nl,Nl.prototype.toJSON=function(){var e=qn.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return Fl(t,r,e)};var Ol={generateTopUV:function(e,t,r,n,i){var a=t[3*r],o=t[3*r+1],s=t[3*n],l=t[3*n+1],c=t[3*i],u=t[3*i+1];return[new Wt(a,o),new Wt(s,l),new Wt(c,u)]},generateSideWallUV:function(e,t,r,n,i,a){var o=t[3*r],s=t[3*r+1],l=t[3*r+2],c=t[3*n],u=t[3*n+1],h=t[3*n+2],d=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*a],v=t[3*a+1],g=t[3*a+2];return Math.abs(s-u)<.01?[new Wt(o,1-l),new Wt(c,1-h),new Wt(d,1-p),new Wt(m,1-g)]:[new Wt(s,1-l),new Wt(u,1-h),new Wt(f,1-p),new Wt(v,1-g)]}};function Fl(e,t,r){if(r.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var a=e[n];r.shapes.push(a.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function Dl(e,t){Ei.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Ul(e,t)),this.mergeVertices()}function Ul(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Ei;var n=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Nl.call(this,n,t),this.type="TextBufferGeometry"}function zl(e,t,r,n,i,a,o){Ei.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Bl(e,t,r,n,i,a,o)),this.mergeVertices()}function Bl(e,t,r,n,i,a,o){qn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,l,c=Math.min(a+o,Math.PI),u=0,h=[],d=new rr,f=new rr,p=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],E=l/r,x=0;for(0==l&&0==a?x=.5/t:l==r&&c==Math.PI&&(x=-.5/t),s=0;s<=t;s++){var T=s/t;d.x=-e*Math.cos(n+T*i)*Math.sin(a+E*o),d.y=e*Math.cos(a+E*o),d.z=e*Math.sin(n+T*i)*Math.sin(a+E*o),m.push(d.x,d.y,d.z),f.copy(d).normalize(),v.push(f.x,f.y,f.z),g.push(T+x,1-E),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(s=0;s<t;s++){var b=h[l][s+1],w=h[l][s],_=h[l+1][s],R=h[l+1][s+1];(0!==l||a>0)&&p.push(b,w,R),(l!==r-1||c<Math.PI)&&p.push(w,_,R)}this.setIndex(p),this.setAttribute("position",new Fn(m,3)),this.setAttribute("normal",new Fn(v,3)),this.setAttribute("uv",new Fn(g,2))}function Gl(e,t,r,n,i,a){Ei.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new Vl(e,t,r,n,i,a)),this.mergeVertices()}function Vl(e,t,r,n,i,a){qn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,n=void 0!==n?Math.max(1,n):1;var o,s,l,c=[],u=[],h=[],d=[],f=e,p=(t-e)/n,m=new rr,v=new Wt;for(s=0;s<=n;s++){for(l=0;l<=r;l++)o=i+l/r*a,m.x=f*Math.cos(o),m.y=f*Math.sin(o),u.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,d.push(v.x,v.y);f+=p}for(s=0;s<n;s++){var g=s*(r+1);for(l=0;l<r;l++){var y=o=l+g,E=o+r+1,x=o+r+2,T=o+1;c.push(y,E,T),c.push(E,x,T)}}this.setIndex(c),this.setAttribute("position",new Fn(u,3)),this.setAttribute("normal",new Fn(h,3)),this.setAttribute("uv",new Fn(d,2))}function jl(e,t,r,n){Ei.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new Wl(e,t,r,n)),this.mergeVertices()}function Wl(e,t,r,n){qn.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=jt.clamp(n,0,2*Math.PI);var i,a,o,s=[],l=[],c=[],u=1/t,h=new rr,d=new Wt;for(a=0;a<=t;a++){var f=r+a*u*n,p=Math.sin(f),m=Math.cos(f);for(o=0;o<=e.length-1;o++)h.x=e[o].x*p,h.y=e[o].y,h.z=e[o].x*m,l.push(h.x,h.y,h.z),d.x=a/t,d.y=o/(e.length-1),c.push(d.x,d.y)}for(a=0;a<t;a++)for(o=0;o<e.length-1;o++){var v=i=o+a*e.length,g=i+e.length,y=i+e.length+1,E=i+1;s.push(v,g,E),s.push(g,y,E)}if(this.setIndex(s),this.setAttribute("position",new Fn(l,3)),this.setAttribute("uv",new Fn(c,2)),this.computeVertexNormals(),n===2*Math.PI){var x=this.attributes.normal.array,T=new rr,b=new rr,w=new rr;for(i=t*e.length*3,a=0,o=0;a<e.length;a++,o+=3)T.x=x[o+0],T.y=x[o+1],T.z=x[o+2],b.x=x[i+o+0],b.y=x[i+o+1],b.z=x[i+o+2],w.addVectors(T,b).normalize(),x[o+0]=x[i+o+0]=w.x,x[o+1]=x[i+o+1]=w.y,x[o+2]=x[i+o+2]=w.z}}function Xl(e,t){Ei.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Yl(e,t)),this.mergeVertices()}function Yl(e,t){qn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],i=[],a=[],o=0,s=0;if(!1===Array.isArray(e))c(e);else for(var l=0;l<e.length;l++)c(e[l]),this.addGroup(o,s,l),o+=s,s=0;function c(e){var o,l,c,u=n.length/3,h=e.extractPoints(t),d=h.shape,f=h.holes;for(!1===Cl.isClockWise(d)&&(d=d.reverse()),o=0,l=f.length;o<l;o++)c=f[o],!0===Cl.isClockWise(c)&&(f[o]=c.reverse());var p=Cl.triangulateShape(d,f);for(o=0,l=f.length;o<l;o++)c=f[o],d=d.concat(c);for(o=0,l=d.length;o<l;o++){var m=d[o];n.push(m.x,m.y,0),i.push(0,0,1),a.push(m.x,m.y)}for(o=0,l=p.length;o<l;o++){var v=p[o],g=v[0]+u,y=v[1]+u,E=v[2]+u;r.push(g,y,E),s+=3}}this.setIndex(r),this.setAttribute("position",new Fn(n,3)),this.setAttribute("normal",new Fn(i,3)),this.setAttribute("uv",new Fn(a,2))}function ql(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function Zl(e,t){qn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,i,a,o=[],s=Math.cos(jt.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];e.isBufferGeometry?(a=new Ei).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,d=a.faces,f=0,p=d.length;f<p;f++)for(var m=d[f],v=0;v<3;v++)r=m[u[v]],n=m[u[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),i=l[0]+","+l[1],void 0===c[i]?c[i]={index1:l[0],index2:l[1],face1:f,face2:void 0}:c[i].face2=f;for(i in c){var g=c[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=h[g.index1];o.push(y.x,y.y,y.z),y=h[g.index2],o.push(y.x,y.y,y.z)}}this.setAttribute("position",new Fn(o,3))}function Ql(e,t,r,n,i,a,o,s){Ei.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Kl(e,t,r,n,i,a,o,s)),this.mergeVertices()}function Kl(e,t,r,n,i,a,o,s){qn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var c=[],u=[],h=[],d=[],f=0,p=[],m=r/2,v=0;function g(r){var i,a,p,g=new Wt,y=new rr,E=0,x=!0===r?e:t,T=!0===r?1:-1;for(a=f,i=1;i<=n;i++)u.push(0,m*T,0),h.push(0,T,0),d.push(.5,.5),f++;for(p=f,i=0;i<=n;i++){var b=i/n,w=b*s+o,_=Math.cos(w),R=Math.sin(w);y.x=x*R,y.y=m*T,y.z=x*_,u.push(y.x,y.y,y.z),h.push(0,T,0),g.x=.5*_+.5,g.y=.5*R*T+.5,d.push(g.x,g.y),f++}for(i=0;i<n;i++){var M=a+i,S=p+i;!0===r?c.push(S,S+1,M):c.push(S+1,S,M),E+=3}l.addGroup(v,E,!0===r?1:2),v+=E}!function(){var a,g,y=new rr,E=new rr,x=0,T=(t-e)/r;for(g=0;g<=i;g++){var b=[],w=g/i,_=w*(t-e)+e;for(a=0;a<=n;a++){var R=a/n,M=R*s+o,S=Math.sin(M),A=Math.cos(M);E.x=_*S,E.y=-w*r+m,E.z=_*A,u.push(E.x,E.y,E.z),y.set(S,T,A).normalize(),h.push(y.x,y.y,y.z),d.push(R,1-w),b.push(f++)}p.push(b)}for(a=0;a<n;a++)for(g=0;g<i;g++){var L=p[g][a],P=p[g+1][a],C=p[g+1][a+1],H=p[g][a+1];c.push(L,P,H),c.push(P,C,H),x+=6}l.addGroup(v,x,0),v+=x}(),!1===a&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.setAttribute("position",new Fn(u,3)),this.setAttribute("normal",new Fn(h,3)),this.setAttribute("uv",new Fn(d,2))}function Jl(e,t,r,n,i,a,o){Ql.call(this,0,e,t,r,n,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function $l(e,t,r,n,i,a,o){Kl.call(this,0,e,t,r,n,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function ec(e,t,r,n){Ei.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new tc(e,t,r,n)),this.mergeVertices()}function tc(e,t,r,n){qn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,a,o=[],s=[],l=[],c=[],u=new rr,h=new Wt;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),a=0,i=3;a<=t;a++,i+=3){var d=r+a/t*n;u.x=e*Math.cos(d),u.y=e*Math.sin(d),s.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(s[i]/e+1)/2,h.y=(s[i+1]/e+1)/2,c.push(h.x,h.y)}for(i=1;i<=t;i++)o.push(i,i+1,0);this.setIndex(o),this.setAttribute("position",new Fn(s,3)),this.setAttribute("normal",new Fn(l,3)),this.setAttribute("uv",new Fn(c,2))}Dl.prototype=Object.create(Ei.prototype),Dl.prototype.constructor=Dl,Ul.prototype=Object.create(Nl.prototype),Ul.prototype.constructor=Ul,zl.prototype=Object.create(Ei.prototype),zl.prototype.constructor=zl,Bl.prototype=Object.create(qn.prototype),Bl.prototype.constructor=Bl,Gl.prototype=Object.create(Ei.prototype),Gl.prototype.constructor=Gl,Vl.prototype=Object.create(qn.prototype),Vl.prototype.constructor=Vl,jl.prototype=Object.create(Ei.prototype),jl.prototype.constructor=jl,Wl.prototype=Object.create(qn.prototype),Wl.prototype.constructor=Wl,Xl.prototype=Object.create(Ei.prototype),Xl.prototype.constructor=Xl,Xl.prototype.toJSON=function(){var e=Ei.prototype.toJSON.call(this),t=this.parameters.shapes;return ql(t,e)},Yl.prototype=Object.create(qn.prototype),Yl.prototype.constructor=Yl,Yl.prototype.toJSON=function(){var e=qn.prototype.toJSON.call(this),t=this.parameters.shapes;return ql(t,e)},Zl.prototype=Object.create(qn.prototype),Zl.prototype.constructor=Zl,Ql.prototype=Object.create(Ei.prototype),Ql.prototype.constructor=Ql,Kl.prototype=Object.create(qn.prototype),Kl.prototype.constructor=Kl,Jl.prototype=Object.create(Ql.prototype),Jl.prototype.constructor=Jl,$l.prototype=Object.create(Kl.prototype),$l.prototype.constructor=$l,ec.prototype=Object.create(Ei.prototype),ec.prototype.constructor=ec,tc.prototype=Object.create(qn.prototype),tc.prototype.constructor=tc;var rc=Object.freeze({__proto__:null,WireframeGeometry:js,ParametricGeometry:Ws,ParametricBufferGeometry:Xs,TetrahedronGeometry:Zs,TetrahedronBufferGeometry:Qs,OctahedronGeometry:Ks,OctahedronBufferGeometry:Js,IcosahedronGeometry:$s,IcosahedronBufferGeometry:el,DodecahedronGeometry:tl,DodecahedronBufferGeometry:rl,PolyhedronGeometry:Ys,PolyhedronBufferGeometry:qs,TubeGeometry:nl,TubeBufferGeometry:il,TorusKnotGeometry:al,TorusKnotBufferGeometry:ol,TorusGeometry:sl,TorusBufferGeometry:ll,TextGeometry:Dl,TextBufferGeometry:Ul,SphereGeometry:zl,SphereBufferGeometry:Bl,RingGeometry:Gl,RingBufferGeometry:Vl,PlaneGeometry:Bi,PlaneBufferGeometry:Gi,LatheGeometry:jl,LatheBufferGeometry:Wl,ShapeGeometry:Xl,ShapeBufferGeometry:Yl,ExtrudeGeometry:kl,ExtrudeBufferGeometry:Nl,EdgesGeometry:Zl,ConeGeometry:Jl,ConeBufferGeometry:$l,CylinderGeometry:Ql,CylinderBufferGeometry:Kl,CircleGeometry:ec,CircleBufferGeometry:tc,BoxGeometry:xi,BoxBufferGeometry:Ti});function nc(e){Mn.call(this),this.type="ShadowMaterial",this.color=new xn(0),this.transparent=!0,this.setValues(e)}function ic(e){Si.call(this,e),this.type="RawShaderMaterial"}function ac(e){Mn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new xn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kt,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function oc(e){ac.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Wt(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function sc(e){Mn.call(this),this.type="MeshPhongMaterial",this.color=new xn(16777215),this.specular=new xn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kt,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function lc(e){Mn.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new xn(16777215),this.specular=new xn(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kt,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function cc(e){Mn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kt,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function uc(e){Mn.call(this),this.type="MeshLambertMaterial",this.color=new xn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new xn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function hc(e){Mn.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new xn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=kt,this.normalScale=new Wt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function dc(e){bs.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}nc.prototype=Object.create(Mn.prototype),nc.prototype.constructor=nc,nc.prototype.isShadowMaterial=!0,nc.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.color.copy(e.color),this},ic.prototype=Object.create(Si.prototype),ic.prototype.constructor=ic,ic.prototype.isRawShaderMaterial=!0,ac.prototype=Object.create(Mn.prototype),ac.prototype.constructor=ac,ac.prototype.isMeshStandardMaterial=!0,ac.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},oc.prototype=Object.create(ac.prototype),oc.prototype.constructor=oc,oc.prototype.isMeshPhysicalMaterial=!0,oc.prototype.copy=function(e){return ac.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new xn).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},sc.prototype=Object.create(Mn.prototype),sc.prototype.constructor=sc,sc.prototype.isMeshPhongMaterial=!0,sc.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},lc.prototype=Object.create(Mn.prototype),lc.prototype.constructor=lc,lc.prototype.isMeshToonMaterial=!0,lc.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},cc.prototype=Object.create(Mn.prototype),cc.prototype.constructor=cc,cc.prototype.isMeshNormalMaterial=!0,cc.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},uc.prototype=Object.create(Mn.prototype),uc.prototype.constructor=uc,uc.prototype.isMeshLambertMaterial=!0,uc.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},hc.prototype=Object.create(Mn.prototype),hc.prototype.constructor=hc,hc.prototype.isMeshMatcapMaterial=!0,hc.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},dc.prototype=Object.create(bs.prototype),dc.prototype.constructor=dc,dc.prototype.isLineDashedMaterial=!0,dc.prototype.copy=function(e){return bs.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var fc=Object.freeze({__proto__:null,ShadowMaterial:nc,SpriteMaterial:qo,RawShaderMaterial:ic,ShaderMaterial:Si,PointsMaterial:Is,MeshPhysicalMaterial:oc,MeshStandardMaterial:ac,MeshPhongMaterial:sc,MeshToonMaterial:lc,MeshNormalMaterial:cc,MeshLambertMaterial:uc,MeshDepthMaterial:Po,MeshDistanceMaterial:Co,MeshBasicMaterial:Sn,MeshMatcapMaterial:hc,LineDashedMaterial:dc,LineBasicMaterial:bs,Material:Mn}),pc={arraySlice:function(e,t,r){return pc.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),n=0;n!==t;++n)r[n]=n;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(e,t,r){for(var n=e.length,i=new e.constructor(n),a=0,o=0;o!==n;++a)for(var s=r[a]*t,l=0;l!==t;++l)i[o++]=e[s+l];return i},flattenJSON:function(e,t,r,n){for(var i=1,a=e[0];void 0!==a&&void 0===a[n];)a=e[i++];if(void 0!==a){var o=a[n];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[n])&&(t.push(a.time),r.push.apply(r,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[n])&&(t.push(a.time),o.toArray(r,r.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[n])&&(t.push(a.time),r.push(o)),a=e[i++]}while(void 0!==a)}},subclip:function(e,t,r,n,i){i=i||30;var a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var l=a.tracks[s],c=l.getValueSize(),u=[],h=[],d=0;d<l.times.length;++d){var f=l.times[d]*i;if(!(f<r||f>=n)){u.push(l.times[d]);for(var p=0;p<c;++p)h.push(l.values[d*c+p])}}0!==u.length&&(l.times=pc.convertArray(u,l.times.constructor),l.values=pc.convertArray(h,l.values.constructor),o.push(l))}a.tracks=o;for(var m=1/0,s=0;s<a.tracks.length;++s)m>a.tracks[s].times[0]&&(m=a.tracks[s].times[0]);for(var s=0;s<a.tracks.length;++s)a.tracks[s].shift(-1*m);return a.resetDuration(),a}};function mc(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function vc(e,t,r,n){mc.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function gc(e,t,r,n){mc.call(this,e,t,r,n)}function yc(e,t,r,n){mc.call(this,e,t,r,n)}function Ec(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=pc.convertArray(t,this.TimeBufferType),this.values=pc.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function xc(e,t,r){Ec.call(this,e,t,r)}function Tc(e,t,r,n){Ec.call(this,e,t,r,n)}function bc(e,t,r,n){Ec.call(this,e,t,r,n)}function wc(e,t,r,n){mc.call(this,e,t,r,n)}function _c(e,t,r,n){Ec.call(this,e,t,r,n)}function Rc(e,t,r,n){Ec.call(this,e,t,r,n)}function Mc(e,t,r,n){Ec.call(this,e,t,r,n)}function Sc(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=jt.generateUUID(),this.duration<0&&this.resetDuration()}function Ac(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return bc;case"vector":case"vector2":case"vector3":case"vector4":return Mc;case"color":return Tc;case"quaternion":return _c;case"bool":case"boolean":return xc;case"string":return Rc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var r=[],n=[];pc.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(mc.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{var a;r:{n:if(!(e<n)){for(var o=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===o)break;if(i=n,n=t[++r],e<n)break t}a=t.length;break r}if(e>=i)break e;var s=t[1];e<s&&(r=2,i=s);for(var o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===o)break;if(n=i,i=t[--r-1],e>=i)break t}a=r,r=0}for(;r<a;){var l=r+a>>>1;e<t[l]?a=l:r=l+1}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n,a=0;a!==n;++a)t[a]=r[i+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(mc.prototype,{beforeStart_:mc.prototype.copySampleValue_,afterEnd_:mc.prototype.copySampleValue_}),vc.prototype=Object.assign(Object.create(mc.prototype),{constructor:vc,DefaultSettings_:{endingStart:wt,endingEnd:wt},intervalChanged_:function(e,t,r){var n=this.parameterPositions,i=e-2,a=e+1,o=n[i],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:i=e,o=2*t-r;break;case 2402:i=n.length-2,o=t+n[i]-n[i+1];break;default:i=e,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*r-t;break;case 2402:a=1,s=r+n[1]-n[0];break;default:a=e-1,s=t}var l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-r),this._offsetPrev=i*c,this._offsetNext=a*c},interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(r-t)/(n-t),p=f*f,m=p*f,v=-h*m+2*h*p-h*f,g=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,E=d*m-d*p,x=0;x!==o;++x)i[x]=v*a[c+x]+g*a[l+x]+y*a[s+x]+E*a[u+x];return i}}),gc.prototype=Object.assign(Object.create(mc.prototype),{constructor:gc,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(r-t)/(n-t),u=1-c,h=0;h!==o;++h)i[h]=a[l+h]*u+a[s+h]*c;return i}}),yc.prototype=Object.assign(Object.create(mc.prototype),{constructor:yc,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Ec,{toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:pc.convertArray(e.times,Array),values:pc.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}}),Object.assign(Ec.prototype,{constructor:Ec,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new yc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new gc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new vc(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,i=0,a=n-1;i!==n&&r[i]<e;)++i;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==i||a!==n){i>=a&&(a=Math.max(a,1),i=a-1);var o=this.getValueSize();this.times=pc.arraySlice(r,i,a),this.values=pc.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==n&&pc.isTypedArray(n))for(var o=0,l=n.length;o!==l;++o){var c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e},optimize:function(){for(var e=pc.arraySlice(this.times),t=pc.arraySlice(this.values),r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o],c=e[o+1];if(l!==c&&(1!==o||l!==l[0]))if(n)s=!0;else for(var u=o*r,h=u-r,d=u+r,f=0;f!==r;++f){var p=t[u+f];if(p!==t[h+f]||p!==t[d+f]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];for(var m=o*r,v=i*r,f=0;f!==r;++f)t[v+f]=t[m+f]}++i}}if(a>0){e[i]=e[a];for(var m=a*r,v=i*r,f=0;f!==r;++f)t[v+f]=t[m+f];++i}return i!==e.length?(this.times=pc.arraySlice(e,0,i),this.values=pc.arraySlice(t,0,i*r)):(this.times=e,this.values=t),this},clone:function(){var e=pc.arraySlice(this.times,0),t=pc.arraySlice(this.values,0),r=this.constructor,n=new r(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),xc.prototype=Object.assign(Object.create(Ec.prototype),{constructor:xc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Tc.prototype=Object.assign(Object.create(Ec.prototype),{constructor:Tc,ValueTypeName:"color"}),bc.prototype=Object.assign(Object.create(Ec.prototype),{constructor:bc,ValueTypeName:"number"}),wc.prototype=Object.assign(Object.create(mc.prototype),{constructor:wc,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(r-t)/(n-t),c=s+o;s!==c;s+=4)$t.slerpFlat(i,0,a,s-o,a,s,l);return i}}),_c.prototype=Object.assign(Object.create(Ec.prototype),{constructor:_c,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new wc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Rc.prototype=Object.assign(Object.create(Ec.prototype),{constructor:Rc,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Mc.prototype=Object.assign(Object.create(Ec.prototype),{constructor:Mc,ValueTypeName:"vector"}),Object.assign(Sc,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,a=r.length;i!==a;++i)t.push(Ac(r[i]).scale(n));return new Sc(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,a=r.length;i!==a;++i)t.push(Ec.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i),l.push(0,1,0);var c=pc.getKeyframeOrder(s);s=pc.sortedArray(s,1,c),l=pc.sortedArray(l,1,c),n||0!==s[0]||(s.push(i),l.push(l[0])),a.push(new bc(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/r))}return new Sc(e,-1,a)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(i);if(l&&l.length>1){var c=l[1],u=n[c];u||(n[c]=u=[]),u.push(s)}}var h=[];for(var c in n)h.push(Sc.CreateFromMorphTargetSequence(c,n[c],t,r));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,n,i){if(0!==r.length){var a=[],o=[];pc.flattenJSON(r,a,o,n),0!==a.length&&i.push(new e(t,a,o))}},n=[],i=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;for(var f in u){for(var p=[],m=[],d=0;d!==c[h].morphTargets.length;++d){var v=c[h];p.push(v.time),m.push(v.morphTarget===f?1:0)}n.push(new bc(".morphTargetInfluence["+f+"]",p,m))}a=u.length*(o||1)}else{var g=".bones["+t[l].name+"]";r(Mc,g+".position",c,"pos",n),r(_c,g+".quaternion",c,"rot",n),r(Mc,g+".scale",c,"scl",n)}}if(0===n.length)return null;var y=new Sc(i,a,n);return y}}),Object.assign(Sc.prototype,{resetDuration:function(){for(var e=this.tracks,t=0,r=0,n=e.length;r!==n;++r){var i=this.tracks[r];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Sc(this.name,this.duration,e)}});var Lc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Pc(e,t,r){var n=this,i=!1,a=0,o=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===i&&void 0!==n.onStart&&n.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==n.onProgress&&n.onProgress(e,a,o),a===o&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,r=l.length;t<r;t+=2){var n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}var Cc=new Pc;function Hc(e){this.manager=void 0!==e?e:Cc,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Hc.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var Ic={};function kc(e){Hc.call(this,e)}function Nc(e){Hc.call(this,e)}function Oc(e){Hc.call(this,e)}function Fc(e){Hc.call(this,e)}function Dc(e){Hc.call(this,e)}function Uc(e){Hc.call(this,e)}function zc(e){Hc.call(this,e)}function Bc(){this.type="Curve",this.arcLengthDivisions=200}function Gc(e,t,r,n,i,a,o,s){Bc.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function Vc(e,t,r,n,i,a){Gc.call(this,e,t,r,r,n,i,a),this.type="ArcCurve"}function jc(){var e=0,t=0,r=0,n=0;function i(i,a,o,s){e=i,t=o,r=-3*i+3*a-2*o-s,n=2*i-2*a+o+s}return{initCatmullRom:function(e,t,r,n,a){i(t,r,a*(r-e),a*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,a,o,s){var l=(t-e)/a-(r-e)/(a+o)+(r-t)/o,c=(r-t)/o-(n-t)/(o+s)+(n-r)/s;i(t,r,l*=o,c*=o)},calc:function(i){var a=i*i,o=a*i;return e+t*i+r*a+n*o}}}kc.prototype=Object.assign(Object.create(Hc.prototype),{constructor:kc,load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=Lc.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;if(void 0===Ic[e]){var o=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],l=!!o[2],c=o[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),f=0;f<c.length;f++)d[f]=c.charCodeAt(f);u="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var p=new DOMParser;u=p.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}setTimeout(function(){t&&t(u),i.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)},0)}}else{Ic[e]=[],Ic[e].push({onLoad:t,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",function(t){var r=this.response,n=Ic[e];if(delete Ic[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Lc.add(e,r);for(var a=0,o=n.length;a<o;a++){var s=n[a];s.onLoad&&s.onLoad(r)}i.manager.itemEnd(e)}else{for(var a=0,o=n.length;a<o;a++){var s=n[a];s.onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}},!1),m.addEventListener("progress",function(t){for(var r=Ic[e],n=0,i=r.length;n<i;n++){var a=r[n];a.onProgress&&a.onProgress(t)}},!1),m.addEventListener("error",function(t){var r=Ic[e];delete Ic[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),m.addEventListener("abort",function(t){var r=Ic[e];delete Ic[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}Ic[e].push({onLoad:t,onProgress:r,onError:n})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Nc.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Nc,load:function(e,t,r,n){var i=this,a=new kc(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){for(var t=[],r=0;r<e.length;r++){var n=Sc.parse(e[r]);t.push(n)}return t}}),Oc.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Oc,load:function(e,t,r,n){var i=this,a=[],o=new Bs;o.image=a;var s=new kc(this.manager);function l(l){s.load(e[l],function(e){var r=i.parse(e,!0);a[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(o.minFilter=le),o.format=r.format,o.needsUpdate=!0,t&&t(o))},r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,h=e.length;u<h;++u)l(u);else s.load(e,function(e){var r=i.parse(e,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){a[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)a[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),a[s].format=r.format,a[s].width=r.width,a[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=le),o.format=r.format,o.needsUpdate=!0,t&&t(o)},r,n);return o}}),Fc.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Fc,load:function(e,t,r,n){var i=this,a=new ki,o=new kc(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,function(e){var r=i.parse(e);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:ne,a.wrapT=void 0!==r.wrapT?r.wrapT:ne,a.magFilter=void 0!==r.magFilter?r.magFilter:le,a.minFilter=void 0!==r.minFilter?r.minFilter:le,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps,a.minFilter=ue),1===r.mipmapCount&&(a.minFilter=le),a.needsUpdate=!0,t&&t(a,r))},r,n),a}}),Dc.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Dc,load:function(e,t,r,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=Lc.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),Lc.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}),Uc.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Uc,load:function(e,t,r,n){var i=new ra,a=new Dc(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(r){a.load(e[r],function(e){i.images[r]=e,6==++o&&(i.needsUpdate=!0,t&&t(i))},void 0,n)}for(var l=0;l<e.length;++l)s(l);return i}}),zc.prototype=Object.assign(Object.create(Hc.prototype),{constructor:zc,load:function(e,t,r,n){var i=new Zt,a=new Dc(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(r){i.image=r;var n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=n?_e:Re,i.needsUpdate=!0,void 0!==t&&t(i)},r,n),i}}),Object.assign(Bc.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),a=0;for(n.push(0),r=1;r<=e;r++)t=this.getPoint(r/e),a+=t.distanceTo(i),n.push(a),i=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,n=this.getLengths(),i=0,a=n.length;r=t||e*n[a-1];for(var o,s=0,l=a-1;s<=l;)if(i=Math.floor(s+(l-s)/2),(o=n[i]-r)<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(a-1);var c=n[i],u=n[i+1],h=u-c,d=(r-c)/h,f=(i+d)/(a-1);return f},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var n=this.getPoint(t),i=this.getPoint(r),a=i.clone().sub(n);return a.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,n,i,a=new rr,o=[],s=[],l=[],c=new rr,u=new ur;for(r=0;r<=e;r++)n=r/e,o[r]=this.getTangentAt(n),o[r].normalize();s[0]=new rr,l[0]=new rr;var h=Number.MAX_VALUE,d=Math.abs(o[0].x),f=Math.abs(o[0].y),p=Math.abs(o[0].z);for(d<=h&&(h=d,a.set(1,0,0)),f<=h&&(h=f,a.set(0,1,0)),p<=h&&a.set(0,0,1),c.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],c),l[0].crossVectors(o[0],s[0]),r=1;r<=e;r++)s[r]=s[r-1].clone(),l[r]=l[r-1].clone(),c.crossVectors(o[r-1],o[r]),c.length()>Number.EPSILON&&(c.normalize(),i=Math.acos(jt.clamp(o[r-1].dot(o[r]),-1,1)),s[r].applyMatrix4(u.makeRotationAxis(c,i))),l[r].crossVectors(o[r],s[r]);if(!0===t)for(i=Math.acos(jt.clamp(s[0].dot(s[e]),-1,1)),i/=e,o[0].dot(c.crossVectors(s[0],s[e]))>0&&(i=-i),r=1;r<=e;r++)s[r].applyMatrix4(u.makeRotationAxis(o[r],i*r)),l[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Gc.prototype=Object.create(Bc.prototype),Gc.prototype.constructor=Gc,Gc.prototype.isEllipseCurve=!0,Gc.prototype.getPoint=function(e,t){for(var r=t||new Wt,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=a?0:n),!0!==this.aClockwise||a||(i===n?i=-n:i-=n);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return r.set(s,l)},Gc.prototype.copy=function(e){return Bc.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Gc.prototype.toJSON=function(){var e=Bc.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Gc.prototype.fromJSON=function(e){return Bc.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Vc.prototype=Object.create(Gc.prototype),Vc.prototype.constructor=Vc,Vc.prototype.isArcCurve=!0;var Wc=new rr,Xc=new jc,Yc=new jc,qc=new jc;function Zc(e,t,r,n){Bc.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function Qc(e,t,r,n,i){var a=.5*(n-t),o=.5*(i-r),s=e*e,l=e*s;return(2*r-2*n+a+o)*l+(-3*r+3*n-2*a-o)*s+a*e+r}function Kc(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}function Jc(e,t,r,n,i){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}function $c(e,t,r,n){Bc.call(this),this.type="CubicBezierCurve",this.v0=e||new Wt,this.v1=t||new Wt,this.v2=r||new Wt,this.v3=n||new Wt}function eu(e,t,r,n){Bc.call(this),this.type="CubicBezierCurve3",this.v0=e||new rr,this.v1=t||new rr,this.v2=r||new rr,this.v3=n||new rr}function tu(e,t){Bc.call(this),this.type="LineCurve",this.v1=e||new Wt,this.v2=t||new Wt}function ru(e,t){Bc.call(this),this.type="LineCurve3",this.v1=e||new rr,this.v2=t||new rr}function nu(e,t,r){Bc.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Wt,this.v1=t||new Wt,this.v2=r||new Wt}function iu(e,t,r){Bc.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new rr,this.v1=t||new rr,this.v2=r||new rr}function au(e){Bc.call(this),this.type="SplineCurve",this.points=e||[]}Zc.prototype=Object.create(Bc.prototype),Zc.prototype.constructor=Zc,Zc.prototype.isCatmullRomCurve3=!0,Zc.prototype.getPoint=function(e,t){var r,n,i,a,o=t||new rr,s=this.points,l=s.length,c=(l-(this.closed?0:1))*e,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/l)+1)*l:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?r=s[(u-1)%l]:(Wc.subVectors(s[0],s[1]).add(s[0]),r=Wc),n=s[u%l],i=s[(u+1)%l],this.closed||u+2<l?a=s[(u+2)%l]:(Wc.subVectors(s[l-1],s[l-2]).add(s[l-1]),a=Wc),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,f=Math.pow(r.distanceToSquared(n),d),p=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(a),d);p<1e-4&&(p=1),f<1e-4&&(f=p),m<1e-4&&(m=p),Xc.initNonuniformCatmullRom(r.x,n.x,i.x,a.x,f,p,m),Yc.initNonuniformCatmullRom(r.y,n.y,i.y,a.y,f,p,m),qc.initNonuniformCatmullRom(r.z,n.z,i.z,a.z,f,p,m)}else"catmullrom"===this.curveType&&(Xc.initCatmullRom(r.x,n.x,i.x,a.x,this.tension),Yc.initCatmullRom(r.y,n.y,i.y,a.y,this.tension),qc.initCatmullRom(r.z,n.z,i.z,a.z,this.tension));return o.set(Xc.calc(h),Yc.calc(h),qc.calc(h)),o},Zc.prototype.copy=function(e){Bc.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Zc.prototype.toJSON=function(){var e=Bc.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Zc.prototype.fromJSON=function(e){Bc.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new rr).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},$c.prototype=Object.create(Bc.prototype),$c.prototype.constructor=$c,$c.prototype.isCubicBezierCurve=!0,$c.prototype.getPoint=function(e,t){var r=t||new Wt,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Jc(e,n.x,i.x,a.x,o.x),Jc(e,n.y,i.y,a.y,o.y)),r},$c.prototype.copy=function(e){return Bc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},$c.prototype.toJSON=function(){var e=Bc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},$c.prototype.fromJSON=function(e){return Bc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},eu.prototype=Object.create(Bc.prototype),eu.prototype.constructor=eu,eu.prototype.isCubicBezierCurve3=!0,eu.prototype.getPoint=function(e,t){var r=t||new rr,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Jc(e,n.x,i.x,a.x,o.x),Jc(e,n.y,i.y,a.y,o.y),Jc(e,n.z,i.z,a.z,o.z)),r},eu.prototype.copy=function(e){return Bc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},eu.prototype.toJSON=function(){var e=Bc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},eu.prototype.fromJSON=function(e){return Bc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},tu.prototype=Object.create(Bc.prototype),tu.prototype.constructor=tu,tu.prototype.isLineCurve=!0,tu.prototype.getPoint=function(e,t){var r=t||new Wt;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},tu.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},tu.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},tu.prototype.copy=function(e){return Bc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},tu.prototype.toJSON=function(){var e=Bc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},tu.prototype.fromJSON=function(e){return Bc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ru.prototype=Object.create(Bc.prototype),ru.prototype.constructor=ru,ru.prototype.isLineCurve3=!0,ru.prototype.getPoint=function(e,t){var r=t||new rr;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},ru.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ru.prototype.copy=function(e){return Bc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ru.prototype.toJSON=function(){var e=Bc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ru.prototype.fromJSON=function(e){return Bc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},nu.prototype=Object.create(Bc.prototype),nu.prototype.constructor=nu,nu.prototype.isQuadraticBezierCurve=!0,nu.prototype.getPoint=function(e,t){var r=t||new Wt,n=this.v0,i=this.v1,a=this.v2;return r.set(Kc(e,n.x,i.x,a.x),Kc(e,n.y,i.y,a.y)),r},nu.prototype.copy=function(e){return Bc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},nu.prototype.toJSON=function(){var e=Bc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},nu.prototype.fromJSON=function(e){return Bc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},iu.prototype=Object.create(Bc.prototype),iu.prototype.constructor=iu,iu.prototype.isQuadraticBezierCurve3=!0,iu.prototype.getPoint=function(e,t){var r=t||new rr,n=this.v0,i=this.v1,a=this.v2;return r.set(Kc(e,n.x,i.x,a.x),Kc(e,n.y,i.y,a.y),Kc(e,n.z,i.z,a.z)),r},iu.prototype.copy=function(e){return Bc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},iu.prototype.toJSON=function(){var e=Bc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},iu.prototype.fromJSON=function(e){return Bc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},au.prototype=Object.create(Bc.prototype),au.prototype.constructor=au,au.prototype.isSplineCurve=!0,au.prototype.getPoint=function(e,t){var r=t||new Wt,n=this.points,i=(n.length-1)*e,a=Math.floor(i),o=i-a,s=n[0===a?a:a-1],l=n[a],c=n[a>n.length-2?n.length-1:a+1],u=n[a>n.length-3?n.length-1:a+2];return r.set(Qc(o,s.x,l.x,c.x,u.x),Qc(o,s.y,l.y,c.y,u.y)),r},au.prototype.copy=function(e){Bc.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this},au.prototype.toJSON=function(){var e=Bc.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e},au.prototype.fromJSON=function(e){Bc.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new Wt).fromArray(n))}return this};var ou=Object.freeze({__proto__:null,ArcCurve:Vc,CatmullRomCurve3:Zc,CubicBezierCurve:$c,CubicBezierCurve3:eu,EllipseCurve:Gc,LineCurve:tu,LineCurve3:ru,QuadraticBezierCurve:nu,QuadraticBezierCurve3:iu,SplineCurve:au});function su(){Bc.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function lu(e){su.call(this),this.type="Path",this.currentPoint=new Wt,e&&this.setFromPoints(e)}function cu(e){lu.call(this,e),this.uuid=jt.generateUUID(),this.type="Shape",this.holes=[]}function uu(e,t){Ar.call(this),this.type="Light",this.color=new xn(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function hu(e,t,r){uu.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Ar.DefaultUp),this.updateMatrix(),this.groundColor=new xn(t)}function du(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Wt(512,512),this.map=null,this.mapPass=null,this.matrix=new ur,this._frustum=new Fi,this._frameExtents=new Wt(1,1),this._viewportCount=1,this._viewports=[new Qt(0,0,1,1)]}function fu(){du.call(this,new Li(50,1,.5,500))}function pu(e,t,r,n,i,a){uu.call(this,e,t),this.type="SpotLight",this.position.copy(Ar.DefaultUp),this.updateMatrix(),this.target=new Ar,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new fu}function mu(){du.call(this,new Li(90,1,.5,500)),this._frameExtents=new Wt(4,2),this._viewportCount=6,this._viewports=[new Qt(2,1,1,1),new Qt(0,1,1,1),new Qt(3,1,1,1),new Qt(1,1,1,1),new Qt(3,0,1,1),new Qt(1,0,1,1)],this._cubeDirections=[new rr(1,0,0),new rr(-1,0,0),new rr(0,0,1),new rr(0,0,-1),new rr(0,1,0),new rr(0,-1,0)],this._cubeUps=[new rr(0,1,0),new rr(0,1,0),new rr(0,1,0),new rr(0,1,0),new rr(0,0,1),new rr(0,0,-1)]}function vu(e,t,r,n){uu.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new mu}function gu(e,t,r,n,i,a){Ai.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function yu(){du.call(this,new gu(-5,5,5,-5,.5,500))}function Eu(e,t){uu.call(this,e,t),this.type="DirectionalLight",this.position.copy(Ar.DefaultUp),this.updateMatrix(),this.target=new Ar,this.shadow=new yu}function xu(e,t){uu.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Tu(e,t,r,n){uu.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function bu(e){Hc.call(this,e),this.textures={}}su.prototype=Object.assign(Object.create(Bc.prototype),{constructor:su,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new tu(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var i=r[n]-t,a=this.curves[n],o=a.getLength(),s=0===o?0:1-i/o;return a.getPointAt(s)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],n=0,i=this.curves;n<i.length;n++)for(var a=i[n],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(r.push(c),t=c)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){Bc.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Bc.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){Bc.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new ou[n.type]).fromJSON(n))}return this}}),lu.prototype=Object.assign(Object.create(su.prototype),{constructor:lu,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var r=new tu(this.currentPoint.clone(),new Wt(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,r,n){var i=new nu(this.currentPoint.clone(),new Wt(e,t),new Wt(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this},bezierCurveTo:function(e,t,r,n,i,a){var o=new $c(this.currentPoint.clone(),new Wt(e,t),new Wt(r,n),new Wt(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e),r=new au(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,r,n,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,r,n,i,a),this},absarc:function(e,t,r,n,i,a){return this.absellipse(e,t,r,r,n,i,a),this},ellipse:function(e,t,r,n,i,a,o,s){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,r,n,i,a,o,s),this},absellipse:function(e,t,r,n,i,a,o,s){var l=new Gc(e,t,r,n,i,a,o,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);return this.currentPoint.copy(u),this},copy:function(e){return su.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=su.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return su.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),cu.prototype=Object.assign(Object.create(lu.prototype),{constructor:cu,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){lu.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=lu.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){lu.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new lu).fromJSON(n))}return this}}),uu.prototype=Object.assign(Object.create(Ar.prototype),{constructor:uu,isLight:!0,copy:function(e){return Ar.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Ar.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),hu.prototype=Object.assign(Object.create(uu.prototype),{constructor:hu,isHemisphereLight:!0,copy:function(e){return uu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(du.prototype,{_projScreenMatrix:new ur,_lightPositionWorld:new rr,_lookTarget:new rr,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,r=this.matrix,n=this._projScreenMatrix,i=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld),t.position.copy(a),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),n.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),fu.prototype=Object.assign(Object.create(du.prototype),{constructor:fu,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,r=2*jt.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix()),du.prototype.updateMatrices.call(this,e)}}),pu.prototype=Object.assign(Object.create(uu.prototype),{constructor:pu,isSpotLight:!0,copy:function(e){return uu.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),mu.prototype=Object.assign(Object.create(du.prototype),{constructor:mu,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var r=this.camera,n=this.matrix,i=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),r.position.copy(i),a.copy(r.position),a.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(a),r.updateMatrixWorld(),n.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),vu.prototype=Object.assign(Object.create(uu.prototype),{constructor:vu,isPointLight:!0,copy:function(e){return uu.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),gu.prototype=Object.assign(Object.create(Ai.prototype),{constructor:gu,isOrthographicCamera:!0,copy:function(e,t){return Ai.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,n,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,a=r+e,o=n+t,s=n-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=l*this.view.offsetX,a=i+l*this.view.width,o-=c*this.view.offsetY,s=o-c*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Ar.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),yu.prototype=Object.assign(Object.create(du.prototype),{constructor:yu,isDirectionalLightShadow:!0,updateMatrices:function(e){du.prototype.updateMatrices.call(this,e)}}),Eu.prototype=Object.assign(Object.create(uu.prototype),{constructor:Eu,isDirectionalLight:!0,copy:function(e){return uu.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),xu.prototype=Object.assign(Object.create(uu.prototype),{constructor:xu,isAmbientLight:!0}),Tu.prototype=Object.assign(Object.create(uu.prototype),{constructor:Tu,isRectAreaLight:!0,copy:function(e){return uu.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=uu.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),bu.prototype=Object.assign(Object.create(Hc.prototype),{constructor:bu,load:function(e,t,r,n){var i=this,a=new kc(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var n=new fc[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=(new xn).setHex(e.sheen)),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.vertexTangents&&(n.vertexTangents=e.vertexTangents),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var i in e.uniforms){var a=e.uniforms[i];switch(n.uniforms[i]={},a.type){case"t":n.uniforms[i].value=r(a.value);break;case"c":n.uniforms[i].value=(new xn).setHex(a.value);break;case"v2":n.uniforms[i].value=(new Wt).fromArray(a.value);break;case"v3":n.uniforms[i].value=(new rr).fromArray(a.value);break;case"v4":n.uniforms[i].value=(new Qt).fromArray(a.value);break;case"m3":n.uniforms[i].value=(new Xt).fromArray(a.value);case"m4":n.uniforms[i].value=(new ur).fromArray(a.value);break;default:n.uniforms[i].value=a.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)n.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.matcap&&(n.matcap=r(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),n.normalScale=(new Wt).fromArray(s)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Wt).fromArray(e.clearcoatNormalScale)),n},setTextures:function(e){return this.textures=e,this}});var wu={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function _u(){qn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Ru(e,t,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Ln.call(this,e,t,r),this.meshPerAttribute=n||1}function Mu(e){Hc.call(this,e)}_u.prototype=Object.assign(Object.create(qn.prototype),{constructor:_u,isInstancedBufferGeometry:!0,copy:function(e){return qn.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=qn.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),Ru.prototype=Object.assign(Object.create(Ln.prototype),{constructor:Ru,isInstancedBufferAttribute:!0,copy:function(e){return Ln.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Ln.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Mu.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Mu,load:function(e,t,r,n){var i=this,a=new kc(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=e.isInstancedBufferGeometry?new _u:new qn,r=e.data.index;if(void 0!==r){var n=new Su[r.type](r.array);t.setIndex(new Ln(n,1))}var i=e.data.attributes;for(var a in i){var o=i[a],n=new Su[o.type](o.array),s=o.isInstancedBufferAttribute?Ru:Ln,l=new s(n,o.itemSize,o.normalized);void 0!==o.name&&(l.name=o.name),t.setAttribute(a,l)}var c=e.data.morphAttributes;if(c)for(var a in c){for(var u=c[a],h=[],d=0,f=u.length;d<f;d++){var o=u[d],n=new Su[o.type](o.array),l=new Ln(n,o.itemSize,o.normalized);void 0!==o.name&&(l.name=o.name),h.push(l)}t.morphAttributes[a]=h}var p=e.data.morphTargetsRelative;p&&(t.morphTargetsRelative=!0);var m=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==m)for(var d=0,v=m.length;d!==v;++d){var g=m[d];t.addGroup(g.start,g.count,g.materialIndex)}var y=e.data.boundingSphere;if(void 0!==y){var E=new rr;void 0!==y.center&&E.fromArray(y.center),t.boundingSphere=new Xr(E,y.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var Su={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Au(e){Hc.call(this,e)}Au.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Au,load:function(e,t,r,n){var i=this,a=""===this.path?wu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new kc(i.manager);o.setPath(this.path),o.load(e,function(r){var a=null;try{a=JSON.parse(r)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)},r,n)},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,function(){void 0!==t&&t(s)}),a=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,n,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new cu).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new Mu,i=0,a=e.length;i<a;i++){var o,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new rc[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new rc[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new rc[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new rc[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new rc[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new rc[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new rc[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new rc[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new rc[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new rc[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new rc[s.type]((new ou[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new rc[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new rc[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}o=new rc[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new ou[d.type]).fromJSON(d)),o=new rc[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(s);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),r[s.uuid]=o}return r},parseMaterials:function(e,t){var r={},n={};if(void 0!==e){var i=new bu;i.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var u=s.materials[c];void 0===r[u.uuid]&&(r[u.uuid]=i.parse(u)),l.push(r[u.uuid])}n[s.uuid]=l}else void 0===r[s.uuid]&&(r[s.uuid]=i.parse(s)),n[s.uuid]=r[s.uuid]}}return n},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=Sc.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),t.push(i)}return t},parseImages:function(e,t){var r=this,n={};function i(e){return r.manager.itemStart(e),o.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}if(void 0!==e&&e.length>0){var a=new Pc(t),o=new Dc(a);o.setCrossOrigin(this.crossOrigin);for(var s=0,l=e.length;s<l;s++){var c=e[s],u=c.url;if(Array.isArray(u)){n[c.uuid]=[];for(var h=0,d=u.length;h<d;h++){var f=u[h],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(f)?f:r.resourcePath+f;n[c.uuid].push(i(p))}}else{var p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:r.resourcePath+c.url;n[c.uuid]=i(p)}}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var i=0,a=e.length;i<a;i++){var o,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(t[s.image])?new ra(t[s.image]):new Zt(t[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=r(s.mapping,Pu)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=r(s.wrap[0],Cu),o.wrapT=r(s.wrap[1],Cu)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=r(s.minFilter,Hu)),void 0!==s.magFilter&&(o.magFilter=r(s.magFilter,Hu)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),n[s.uuid]=o}return n},parseObject:function(e,t,r){var n;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var a=e[n];void 0===r[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(r[a])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":n=new Lr,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new xn(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new Vo(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new Go(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new Li(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new gu(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new xu(e.color,e.intensity);break;case"DirectionalLight":n=new Eu(e.color,e.intensity);break;case"PointLight":n=new vu(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new Tu(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new pu(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new hu(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=i(e.geometry),s=a(e.material);n=o.bones&&o.bones.length>0?new ds(o,s):new di(o,s);break;case"InstancedMesh":var o=i(e.geometry),s=a(e.material),l=e.count,c=e.instanceMatrix;(n=new Ts(o,s,l)).instanceMatrix=new Ln(new Float32Array(c.array),16);break;case"LOD":n=new hs;break;case"Line":n=new As(i(e.geometry),a(e.material),e.mode);break;case"LineLoop":n=new Hs(i(e.geometry),a(e.material));break;case"LineSegments":n=new Cs(i(e.geometry),a(e.material));break;case"PointCloud":case"Points":n=new Ds(i(e.geometry),a(e.material));break;case"Sprite":n=new ss(a(e.material));break;case"Group":n=new Uo;break;default:n=new Ar}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.layers&&(n.layers.mask=e.layers),void 0!==e.children)for(var u=e.children,h=0;h<u.length;h++)n.add(this.parseObject(u[h],t,r));if("LOD"===e.type){void 0!==e.autoUpdate&&(n.autoUpdate=e.autoUpdate);for(var d=e.levels,f=0;f<d.length;f++){var p=d[f],m=n.getObjectByProperty("uuid",p.object);void 0!==m&&n.addLevel(m,p.distance)}}return n}});var Lu,Pu={UVMapping:300,CubeReflectionMapping:Z,CubeRefractionMapping:Q,EquirectangularReflectionMapping:K,EquirectangularRefractionMapping:J,SphericalReflectionMapping:$,CubeUVReflectionMapping:ee,CubeUVRefractionMapping:te},Cu={RepeatWrapping:re,ClampToEdgeWrapping:ne,MirroredRepeatWrapping:ie},Hu={NearestFilter:ae,NearestMipmapNearestFilter:oe,NearestMipmapLinearFilter:se,LinearFilter:le,LinearMipmapNearestFilter:ce,LinearMipmapLinearFilter:ue};function Iu(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Hc.call(this,e),this.options=void 0}function ku(){this.type="ShapePath",this.color=new xn,this.subPaths=[],this.currentPath=null}function Nu(e){this.type="Font",this.data=e}function Ou(e,t,r,n,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,c,u,h,d,f,p=new ku;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),v=0,g=m.length;v<g;){var y=m[v++];switch(y){case"m":o=m[v++]*t+r,s=m[v++]*t+n,p.moveTo(o,s);break;case"l":o=m[v++]*t+r,s=m[v++]*t+n,p.lineTo(o,s);break;case"q":l=m[v++]*t+r,c=m[v++]*t+n,u=m[v++]*t+r,h=m[v++]*t+n,p.quadraticCurveTo(u,h,l,c);break;case"b":l=m[v++]*t+r,c=m[v++]*t+n,u=m[v++]*t+r,h=m[v++]*t+n,d=m[v++]*t+r,f=m[v++]*t+n,p.bezierCurveTo(u,h,d,f,l,c)}}return{offsetX:a.ha*t,path:p}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}function Fu(e){Hc.call(this,e)}Iu.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Iu,setOptions:function(e){return this.options=e,this},load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=Lc.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;fetch(e).then(function(e){return e.blob()}).then(function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)}).then(function(r){Lc.add(e,r),t&&t(r),i.manager.itemEnd(e)}).catch(function(t){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}),i.manager.itemStart(e)}}),Object.assign(ku.prototype,{moveTo:function(e,t){return this.currentPath=new lu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,r,n){return this.currentPath.quadraticCurveTo(e,t,r,n),this},bezierCurveTo:function(e,t,r,n,i,a){return this.currentPath.bezierCurveTo(e,t,r,n,i,a),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=new cu;a.curves=i.curves,t.push(a)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,a=0;a<r;i=a++){var o=t[i],s=t[a],l=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(o=t[a],l=-l,s=t[i],c=-c),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var u=c*(e.x-o.x)-l*(e.y-o.y);if(0===u)return!0;if(u<0)continue;n=!n}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return n}var i=Cl.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return r(a);var o,s,l,c=[];if(1===a.length)return s=a[0],(l=new cu).curves=s.curves,c.push(l),c;var u=!i(a[0].getPoints());u=e?!u:u;var h,d,f=[],p=[],m=[],v=0;p[v]=void 0,m[v]=[];for(var g=0,y=a.length;g<y;g++)s=a[g],h=s.getPoints(),o=i(h),(o=e?!o:o)?(!u&&p[v]&&v++,p[v]={s:new cu,p:h},p[v].s.curves=s.curves,u&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!p[0])return r(a);if(p.length>1){for(var E=!1,x=[],T=0,b=p.length;T<b;T++)f[T]=[];for(var T=0,b=p.length;T<b;T++)for(var w=m[T],_=0;_<w.length;_++){for(var R=w[_],M=!0,S=0;S<p.length;S++)n(R.p,p[S].p)&&(T!==S&&x.push({froms:T,tos:S,hole:_}),M?(M=!1,f[S].push(R)):E=!0);M&&f[T].push(R)}x.length>0&&(E||(m=f))}for(var g=0,A=p.length;g<A;g++){l=p[g].s,c.push(l),d=m[g];for(var L=0,P=d.length;L<P;L++)l.holes.push(d[L].h)}return c}}),Object.assign(Nu.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],n=function(e,t,r){for(var n=Array.from?Array.from(e):String(e).split(""),i=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,o=[],s=0,l=0,c=0;c<n.length;c++){var u=n[c];if("\n"===u)s=0,l-=a;else{var h=Ou(u,i,s,l,r);s+=h.offsetX,o.push(h.path)}}return o}(e,t,this.data),i=0,a=n.length;i<a;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),Fu.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Fu,load:function(e,t,r,n){var i=this,a=new kc(this.manager);a.setPath(this.path),a.load(e,function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var n=i.parse(r);t&&t(n)},r,n)},parse:function(e){return new Nu(e)}});var Du={getContext:function(){return void 0===Lu&&(Lu=new(window.AudioContext||window.webkitAudioContext)),Lu},setContext:function(e){Lu=e}};function Uu(e){Hc.call(this,e)}function zu(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new rr)}function Bu(e,t){uu.call(this,void 0,t),this.sh=void 0!==e?e:new zu}function Gu(e,t,r){Bu.call(this,void 0,r);var n=(new xn).set(e),i=(new xn).set(t),a=new rr(n.r,n.g,n.b),o=new rr(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function Vu(e,t){Bu.call(this,void 0,t);var r=(new xn).set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}Uu.prototype=Object.assign(Object.create(Hc.prototype),{constructor:Uu,load:function(e,t,r,n){var i=new kc(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,function(e){var r=e.slice(0),n=Du.getContext();n.decodeAudioData(r,function(e){t(e)})},r,n)}}),Object.assign(zu.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var r=e.x,n=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScale(a[1],.488603*n),t.addScale(a[2],.488603*i),t.addScale(a[3],.488603*r),t.addScale(a[4],r*n*1.092548),t.addScale(a[5],n*i*1.092548),t.addScale(a[6],.315392*(3*i*i-1)),t.addScale(a[7],r*i*1.092548),t.addScale(a[8],.546274*(r*r-n*n)),t},getIrradianceAt:function(e,t){var r=e.x,n=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScale(a[1],1.023328*n),t.addScale(a[2],1.023328*i),t.addScale(a[3],1.023328*r),t.addScale(a[4],.858086*r*n),t.addScale(a[5],.858086*n*i),t.addScale(a[6],.743125*i*i-.247708),t.addScale(a[7],.858086*r*i),t.addScale(a[8],.429043*(r*r-n*n)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].fromArray(e,t+3*n);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].toArray(e,t+3*n);return e}}),Object.assign(zu,{getBasisAt:function(e,t){var r=e.x,n=e.y,i=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*i,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*r*i,t[8]=.546274*(r*r-n*n)}}),Bu.prototype=Object.assign(Object.create(uu.prototype),{constructor:Bu,isLightProbe:!0,copy:function(e){return uu.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){var t=uu.prototype.toJSON.call(this,e);return t}}),Gu.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Gu,isHemisphereLightProbe:!0,copy:function(e){return Bu.prototype.copy.call(this,e),this},toJSON:function(e){var t=Bu.prototype.toJSON.call(this,e);return t}}),Vu.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Vu,isAmbientLightProbe:!0,copy:function(e){return Bu.prototype.copy.call(this,e),this},toJSON:function(e){var t=Bu.prototype.toJSON.call(this,e);return t}});var ju=new ur,Wu=new ur;function Xu(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Li,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Li,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Yu(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Xu.prototype,{update:function(e){var t=this._cache,r=t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep;if(r){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,i,a=e.projectionMatrix.clone(),o=t.eyeSep/2,s=o*t.near/t.focus,l=t.near*Math.tan(jt.DEG2RAD*t.fov*.5)/t.zoom;Wu.elements[12]=-o,ju.elements[12]=o,n=-l*t.aspect+s,i=l*t.aspect+s,a.elements[0]=2*t.near/(i-n),a.elements[8]=(i+n)/(i-n),this.cameraL.projectionMatrix.copy(a),n=-l*t.aspect-s,i=l*t.aspect-s,a.elements[0]=2*t.near/(i-n),a.elements[8]=(i+n)/(i-n),this.cameraR.projectionMatrix.copy(a)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Wu),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(ju)}}),Object.assign(Yu.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var qu=new rr,Zu=new $t,Qu=new rr,Ku=new rr;function Ju(){Ar.call(this),this.type="AudioListener",this.context=Du.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Yu}function $u(e){Ar.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Ju.prototype=Object.assign(Object.create(Ar.prototype),{constructor:Ju,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){Ar.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(qu,Zu,Qu),Ku.set(0,0,-1).applyQuaternion(Zu),t.positionX){var n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(qu.x,n),t.positionY.linearRampToValueAtTime(qu.y,n),t.positionZ.linearRampToValueAtTime(qu.z,n),t.forwardX.linearRampToValueAtTime(Ku.x,n),t.forwardY.linearRampToValueAtTime(Ku.y,n),t.forwardZ.linearRampToValueAtTime(Ku.z,n),t.upX.linearRampToValueAtTime(r.x,n),t.upY.linearRampToValueAtTime(r.y,n),t.upZ.linearRampToValueAtTime(r.z,n)}else t.setPosition(qu.x,qu.y,qu.z),t.setOrientation(Ku.x,Ku.y,Ku.z,r.x,r.y,r.z)}}),$u.prototype=Object.assign(Object.create(Ar.prototype),{constructor:$u,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var eh=new rr,th=new $t,rh=new rr,nh=new rr;function ih(e){$u.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function ah(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function oh(e,t,r){this.binding=e,this.valueSize=r;var n,i=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}ih.prototype=Object.assign(Object.create($u.prototype),{constructor:ih,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(e){if(Ar.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(eh,th,rh),nh.set(0,0,1).applyQuaternion(th);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(eh.x,r),t.positionY.linearRampToValueAtTime(eh.y,r),t.positionZ.linearRampToValueAtTime(eh.z,r),t.orientationX.linearRampToValueAtTime(nh.x,r),t.orientationY.linearRampToValueAtTime(nh.y,r),t.orientationZ.linearRampToValueAtTime(nh.z,r)}else t.setPosition(eh.x,eh.y,eh.z),t.setOrientation(nh.x,nh.y,nh.z)}}}),Object.assign(ah.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(oh.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,i=e*n+n,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==n;++o)r[i+o]=r[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,i<1){var o=3*t;this._mixBufferRegion(r,n,o,1-i,t)}for(var s=t,l=t+t;s!==l;++s)if(r[s]!==r[s+t]){a.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,a=n;i!==a;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,n,i){if(n>=.5)for(var a=0;a!==i;++a)e[t+a]=e[r+a]},_slerp:function(e,t,r,n){$t.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,i){for(var a=1-n,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[r+o]*n}}});var sh=new RegExp("[\\[\\]\\.:\\/]","g"),lh="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",ch=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),uh=/(WCOD+)?/.source.replace("WCOD",lh),hh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),dh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),fh=new RegExp("^"+ch+uh+hh+dh+"$"),ph=["material","materials","bones"];function mh(e,t,r){var n=r||vh.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function vh(e,t,r){this.path=t,this.parsedPath=r||vh.parseTrackName(t),this.node=vh.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function gh(){this.uuid=jt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function yh(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,i=n.length,a=new Array(i),o={endingStart:wt,endingEnd:wt},s=0;s!==i;++s){var l=n[s].createInterpolant(null);a[s]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=bt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Eh(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function xh(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Th(e,t,r){jo.call(this,e,t),this.meshPerAttribute=r||1}function bh(e,t,r,n){this.ray=new en(e,t),this.near=r||0,this.far=n||1/0,this.camera=null,this.layers=new pr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function wh(e,t){return e.distance-t.distance}function _h(e,t,r,n){if(e.layers.test(t.layers)&&e.raycast(t,r),!0===n)for(var i=e.children,a=0,o=i.length;a<o;a++)_h(i[a],t,r,!0)}function Rh(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function Mh(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}Object.assign(mh.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(vh,{Composite:mh,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new vh.Composite(e,t,r):new vh(e,t,r)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(sh,"")},parseTrackName:function(e){var t=fh.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==ph.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var n=function(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t)return i;var a=n(i.children);if(a)return a}return null},i=n(e.children);if(i)return i}return null}}),Object.assign(vh.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=vh.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var a=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[n];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(var o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(var o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===i){i=o;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(vh.prototype,{_getValue_unbound:vh.prototype.getValue,_setValue_unbound:vh.prototype.setValue}),Object.assign(gh.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],d=h.uuid,f=n[d];if(void 0===f){f=t++,n[d]=f,e.push(h);for(var p=0,m=s;p!==m;++p)o[p].push(new vh(h,i[p],a[p]))}else if(f<r){l=e[f];var v=--r,g=e[v];n[g.uuid]=f,e[f]=g,n[d]=v,e[v]=h;for(var p=0,m=s;p!==m;++p){var y=o[p],E=y[v],x=y[f];y[f]=E,void 0===x&&(x=new vh(h,i[p],a[p])),y[v]=x}}else e[f]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,c=r[l];if(void 0!==c&&c>=t){var u=t++,h=e[u];r[h.uuid]=c,e[c]=h,r[l]=u,e[u]=s;for(var d=0,f=i;d!==f;++d){var p=n[d],m=p[u],v=p[c];p[c]=m,p[u]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o],c=l.uuid,u=n[c];if(void 0!==u)if(delete n[c],u<r){var h=--r,d=e[h],f=--t,p=e[f];n[d.uuid]=u,e[u]=d,n[p.uuid]=h,e[h]=p,e.pop();for(var m=0,v=a;m!==v;++m){var g=i[m],y=g[h],E=g[f];g[u]=y,g[h]=E,g.pop()}}else{var f=--t,p=e[f];n[p.uuid]=u,e[u]=p,e.pop();for(var m=0,v=a;m!==v;++m){var g=i[m];g[u]=g[f],g.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);n=i.length,r[e]=n,a.push(e),o.push(t),i.push(u);for(var h=c,d=s.length;h!==d;++h){var f=s[h];u[h]=new vh(f,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o],l=e[o];t[l]=r,a[r]=s,a.pop(),i[r]=i[o],i.pop(),n[r]=n[o],n.pop()}}}),Object.assign(yh.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,i=e._clip.duration,a=i/n,o=n/i;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,i=n.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+r,l[0]=e/o,l[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var a=(e-i)*r;if(a<0||0===r)return;this._startTime=null,t=r*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(n,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,n=this.loop,i=this._loopCount,a=2202===n;if(0===e)return-1===i?t:a&&1==(1&i)?r-t:t;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=r||t<0){var o=Math.floor(t/r);t-=r*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=t;if(a&&1==(1&i))return r-t}return t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:wt:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:wt:2402)},_scheduleFading:function(e,t,r){var n=this._mixer,i=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=r,this}}),Eh.prototype=Object.assign(Object.create(zt.prototype),{constructor:Eh,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,a=e._propertyBindings,o=e._interpolants,s=r.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==i;++u){var h=n[u],d=h.name,f=c[d];if(void 0!==f)a[u]=f;else{if(void 0!==(f=a[u])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[u].binding.parsedPath;++(f=new oh(vh.create(r,d,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),a[u]=f}o[u].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;var u=o.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,i=n[t],a=this._bindings;void 0===i&&(i={},n[t]=i),i[r]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,a=this._bindingsByRootAndName,o=a[n],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[n]},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new gc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Sc.findByName(r,e):e,a=null!==i?i.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var l=o.actionByRoot[n];if(void 0!==l)return l;s=o.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var c=new yh(this,i,t);return this._bindAction(c,s),this._addInactiveAction(c,a,n),c},existingAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Sc.findByName(r,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(var i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==r;++o){var s=t[o];s._update(n,e,i,a)}for(var l=this._bindings,c=this._nActiveBindings,o=0;o!==c;++o)l[o].apply(a);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot,a=i[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var o=this._bindingsByRootAndName,s=o[t];if(void 0!==s)for(var l in s){var c=s[l];c.restoreOriginalState(),this._removeInactiveBinding(c)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),xh.prototype.clone=function(){return new xh(void 0===this.value.clone?this.value:this.value.clone())},Th.prototype=Object.assign(Object.create(jo.prototype),{constructor:Th,isInstancedInterleavedBuffer:!0,copy:function(e){return jo.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(bh.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var n=r||[];return _h(e,this,n,t),n.sort(wh),n},intersectObjects:function(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,a=e.length;i<a;i++)_h(e[i],this,n,t);return n.sort(wh),n}}),Object.assign(Rh.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(jt.clamp(t/this.radius,-1,1))),this}}),Object.assign(Mh.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}});var Sh=new Wt;function Ah(e,t){this.min=void 0!==e?e:new Wt(1/0,1/0),this.max=void 0!==t?t:new Wt(-1/0,-1/0)}Object.assign(Ah.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=Sh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Wt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Wt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Wt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Wt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=Sh.copy(e).clamp(this.min,this.max);return t.sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Lh=new rr,Ph=new rr;function Ch(e,t){this.start=void 0!==e?e:new rr,this.end=void 0!==t?t:new rr}function Hh(e){Ar.call(this),this.material=e,this.render=function(){}}Object.assign(Ch.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new rr),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new rr),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new rr),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){Lh.subVectors(e,this.start),Ph.subVectors(this.end,this.start);var r=Ph.dot(Ph),n=Ph.dot(Lh),i=n/r;return t&&(i=jt.clamp(i,0,1)),i},closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new rr),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Hh.prototype=Object.create(Ar.prototype),Hh.prototype.constructor=Hh,Hh.prototype.isImmediateRenderObject=!0;var Ih=new rr;function kh(e,t){Ar.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new qn,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1;i<32;i++,a++){var o=i/32*Math.PI*2,s=a/32*Math.PI*2;n.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.setAttribute("position",new Fn(n,3));var l=new bs({fog:!1});this.cone=new Cs(r,l),this.add(this.cone),this.update()}kh.prototype=Object.create(Ar.prototype),kh.prototype.constructor=kh,kh.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},kh.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Ih.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ih),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Nh=new rr,Oh=new ur,Fh=new ur;function Dh(e){for(var t=function e(t){var r=[];t&&t.isBone&&r.push(t);for(var n=0;n<t.children.length;n++)r.push.apply(r,e(t.children[n]));return r}(e),r=new qn,n=[],i=[],a=new xn(0,0,1),o=new xn(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}r.setAttribute("position",new Fn(n,3)),r.setAttribute("color",new Fn(i,3));var c=new bs({vertexColors:!0,depthTest:!1,depthWrite:!1,transparent:!0});Cs.call(this,r,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Uh(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new Bl(t,4,2),i=new Sn({wireframe:!0,fog:!1});di.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Dh.prototype=Object.create(Cs.prototype),Dh.prototype.constructor=Dh,Dh.prototype.isSkeletonHelper=!0,Dh.prototype.updateMatrixWorld=function(e){var t=this.bones,r=this.geometry,n=r.getAttribute("position");Fh.getInverse(this.root.matrixWorld);for(var i=0,a=0;i<t.length;i++){var o=t[i];o.parent&&o.parent.isBone&&(Oh.multiplyMatrices(Fh,o.matrixWorld),Nh.setFromMatrixPosition(Oh),n.setXYZ(a,Nh.x,Nh.y,Nh.z),Oh.multiplyMatrices(Fh,o.parent.matrixWorld),Nh.setFromMatrixPosition(Oh),n.setXYZ(a+1,Nh.x,Nh.y,Nh.z),a+=2)}r.getAttribute("position").needsUpdate=!0,Ar.prototype.updateMatrixWorld.call(this,e)},Uh.prototype=Object.create(di.prototype),Uh.prototype.constructor=Uh,Uh.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Uh.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var zh=new rr,Bh=new xn,Gh=new xn;function Vh(e,t,r){Ar.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new Js(t);n.rotateY(.5*Math.PI),this.material=new Sn({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=!0);var i=n.getAttribute("position"),a=new Float32Array(3*i.count);n.setAttribute("color",new Ln(a,3)),this.add(new di(n,this.material)),this.update()}function jh(e,t,r,n){e=e||10,t=t||10,r=new xn(void 0!==r?r:4473924),n=new xn(void 0!==n?n:8947848);for(var i=t/2,a=e/t,o=e/2,s=[],l=[],c=0,u=0,h=-o;c<=t;c++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var d=c===i?r:n;d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3}var f=new qn;f.setAttribute("position",new Fn(s,3)),f.setAttribute("color",new Fn(l,3));var p=new bs({vertexColors:!0});Cs.call(this,f,p)}function Wh(e,t,r,n,i,a){e=e||10,t=t||16,r=r||8,n=n||64,i=new xn(void 0!==i?i:4473924),a=new xn(void 0!==a?a:8947848);var o,s,l,c,u,h,d,f=[],p=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),o=Math.sin(l)*e,s=Math.cos(l)*e,f.push(0,0,0),f.push(o,0,s),d=1&c?i:a,p.push(d.r,d.g,d.b),p.push(d.r,d.g,d.b);for(c=0;c<=r;c++)for(d=1&c?i:a,h=e-e/r*c,u=0;u<n;u++)l=u/n*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,f.push(o,0,s),p.push(d.r,d.g,d.b),l=(u+1)/n*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,f.push(o,0,s),p.push(d.r,d.g,d.b);var m=new qn;m.setAttribute("position",new Fn(f,3)),m.setAttribute("color",new Fn(p,3));var v=new bs({vertexColors:!0});Cs.call(this,m,v)}Vh.prototype=Object.create(Ar.prototype),Vh.prototype.constructor=Vh,Vh.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Vh.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Bh.copy(this.light.color),Gh.copy(this.light.groundColor);for(var r=0,n=t.count;r<n;r++){var i=r<n/2?Bh:Gh;t.setXYZ(r,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(zh.setFromMatrixPosition(this.light.matrixWorld).negate())},jh.prototype=Object.assign(Object.create(Cs.prototype),{constructor:jh,copy:function(e){return Cs.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Wh.prototype=Object.create(Cs.prototype),Wh.prototype.constructor=Wh;var Xh=new rr,Yh=new rr,qh=new rr;function Zh(e,t,r){Ar.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new qn;n.setAttribute("position",new Fn([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new bs({fog:!1});this.lightPlane=new As(n,i),this.add(this.lightPlane),(n=new qn).setAttribute("position",new Fn([0,0,0,0,0,1],3)),this.targetLine=new As(n,i),this.add(this.targetLine),this.update()}Zh.prototype=Object.create(Ar.prototype),Zh.prototype.constructor=Zh,Zh.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Zh.prototype.update=function(){Xh.setFromMatrixPosition(this.light.matrixWorld),Yh.setFromMatrixPosition(this.light.target.matrixWorld),qh.subVectors(Yh,Xh),this.lightPlane.lookAt(Yh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Yh),this.targetLine.scale.z=qh.length()};var Qh=new rr,Kh=new Ai;function Jh(e){var t=new qn,r=new bs({color:16777215,vertexColors:!0}),n=[],i=[],a={},o=new xn(16755200),s=new xn(16711680),l=new xn(43775),c=new xn(16777215),u=new xn(3355443);function h(e,t,r){d(e,r),d(t,r)}function d(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(n.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.setAttribute("position",new Fn(n,3)),t.setAttribute("color",new Fn(i,3)),Cs.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function $h(e,t,r,n,i,a,o){Qh.set(i,a,o).unproject(n);var s=t[e];if(void 0!==s)for(var l=r.getAttribute("position"),c=0,u=s.length;c<u;c++)l.setXYZ(s[c],Qh.x,Qh.y,Qh.z)}Jh.prototype=Object.create(Cs.prototype),Jh.prototype.constructor=Jh,Jh.prototype.update=function(){var e=this.geometry,t=this.pointMap;Kh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),$h("c",t,e,Kh,0,0,-1),$h("t",t,e,Kh,0,0,1),$h("n1",t,e,Kh,-1,-1,-1),$h("n2",t,e,Kh,1,-1,-1),$h("n3",t,e,Kh,-1,1,-1),$h("n4",t,e,Kh,1,1,-1),$h("f1",t,e,Kh,-1,-1,1),$h("f2",t,e,Kh,1,-1,1),$h("f3",t,e,Kh,-1,1,1),$h("f4",t,e,Kh,1,1,1),$h("u1",t,e,Kh,.7,1.1,-1),$h("u2",t,e,Kh,-.7,1.1,-1),$h("u3",t,e,Kh,0,2,-1),$h("cf1",t,e,Kh,-1,0,1),$h("cf2",t,e,Kh,1,0,1),$h("cf3",t,e,Kh,0,-1,1),$h("cf4",t,e,Kh,0,1,1),$h("cn1",t,e,Kh,-1,0,-1),$h("cn2",t,e,Kh,1,0,-1),$h("cn3",t,e,Kh,0,-1,-1),$h("cn4",t,e,Kh,0,1,-1),e.getAttribute("position").needsUpdate=!0};var ed=new Vr;function td(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new qn;i.setIndex(new Ln(r,1)),i.setAttribute("position",new Ln(n,3)),Cs.call(this,i,new bs({color:t})),this.matrixAutoUpdate=!1,this.update()}function rd(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new qn;n.setIndex(new Ln(r,1)),n.setAttribute("position",new Fn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Cs.call(this,n,new bs({color:t})),this.geometry.computeBoundingSphere()}function nd(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,i=new qn;i.setAttribute("position",new Fn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),As.call(this,i,new bs({color:n}));var a=new qn;a.setAttribute("position",new Fn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new di(a,new Sn({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}td.prototype=Object.create(Cs.prototype),td.prototype.constructor=td,td.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&ed.setFromObject(this.object),!ed.isEmpty()){var t=ed.min,r=ed.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=t.x,i[4]=r.y,i[5]=r.z,i[6]=t.x,i[7]=t.y,i[8]=r.z,i[9]=r.x,i[10]=t.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=t.z,i[15]=t.x,i[16]=r.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=r.x,i[22]=t.y,i[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},td.prototype.setFromObject=function(e){return this.object=e,this.update(),this},td.prototype.copy=function(e){return Cs.prototype.copy.call(this,e),this.object=e.object,this},td.prototype.clone=function(){return(new this.constructor).copy(this)},rd.prototype=Object.create(Cs.prototype),rd.prototype.constructor=rd,rd.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Ar.prototype.updateMatrixWorld.call(this,e))},nd.prototype=Object.create(As.prototype),nd.prototype.constructor=nd,nd.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?l:s,this.lookAt(this.plane.normal),Ar.prototype.updateMatrixWorld.call(this,e)};var id,ad,od=new rr;function sd(e,t,r,n,i,a){Ar.call(this),void 0===e&&(e=new rr(0,0,1)),void 0===t&&(t=new rr(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*r),void 0===a&&(a=.2*i),void 0===id&&((id=new qn).setAttribute("position",new Fn([0,0,0,0,1,0],3)),(ad=new Kl(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new As(id,new bs({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new di(ad,new Sn({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,a)}function ld(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new qn;r.setAttribute("position",new Fn(t,3)),r.setAttribute("color",new Fn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new bs({vertexColors:!0});Cs.call(this,r,n)}sd.prototype=Object.create(Ar.prototype),sd.prototype.constructor=sd,sd.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{od.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(od,t)}},sd.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},sd.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},sd.prototype.copy=function(e){return Ar.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},sd.prototype.clone=function(){return(new this.constructor).copy(this)},ld.prototype=Object.create(Cs.prototype),ld.prototype.constructor=ld;var cd=4,ud=8,hd=Math.pow(2,ud),dd=[.125,.215,.35,.446,.526,.582],fd=ud-cd+1+dd.length,pd=20,md={};md[_t]=0,md[Rt]=1,md[St]=2,md[Lt]=3,md[Pt]=4,md[Ct]=5,md[Mt]=6;var vd,gd,yd,Ed,xd=new gu,Td=(vd=pd,gd=new Float32Array(vd),yd=new rr(0,1,0),(Ed=new ic({defines:{n:vd},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:gd},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:yd},inputEncoding:{value:md[_t]},outputEncoding:{value:md[_t]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:u,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",Ed),bd=null,wd=null,_d=function(){for(var e=[],t=[],r=[],n=ud,i=0;i<fd;i++){var a=Math.pow(2,n);t.push(a);var o=1/a;i>ud-cd?o=dd[i-ud+cd-1]:0==i&&(o=0),r.push(o);for(var s=1/(a-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=new Float32Array(108),d=new Float32Array(72),f=new Float32Array(36),p=0;p<6;p++){var m=p%3*2/3-1,v=p>2?0:-1,g=[m,v,0,m+2/3,v,0,m+2/3,v+1,0,m,v,0,m+2/3,v+1,0,m,v+1,0];h.set(g,18*p),d.set(u,12*p);var y=[p,p,p,p,p,p];f.set(y,6*p)}var E=new qn;E.setAttribute("position",new Ln(h,3)),E.setAttribute("uv",new Ln(d,2)),E.setAttribute("faceIndex",new Ln(f,1)),e.push(E),n>cd&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:r}}(),Rd=_d._lodPlanes,Md=_d._sizeLods,Sd=_d._sigmas,Ad=null,Ld=null,Pd=null,Cd=(1+Math.sqrt(5))/2,Hd=1/Cd,Id=[new rr(1,1,1),new rr(-1,1,1),new rr(1,1,-1),new rr(-1,1,-1),new rr(0,Cd,Hd),new rr(0,Cd,-Hd),new rr(Hd,0,Cd),new rr(-Hd,0,Cd),new rr(Cd,Hd,0),new rr(-Cd,Hd,0)];function kd(e){Ld=e,Fd(Td)}function Nd(e){var t={magFilter:ae,minFilter:ae,generateMipmaps:!1,type:e?e.type:he,format:e?e.format:Ae,encoding:e?e.encoding:St,depthBuffer:!1,stencilBuffer:!1},r=Dd(t);return r.depthBuffer=!e,Ad=Dd(t),r}function Od(e){Ad.dispose(),Ld.setRenderTarget(Pd),e.scissorTest=!1,e.setSize(e.width,e.height)}function Fd(e){var t=new Lr;t.add(new di(Rd[0],e)),Ld.compile(t,xd)}function Dd(e){var t=new Kt(3*hd,3*hd,e);return t.texture.mapping=ee,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Ud(e,t,r,n,i){e.viewport.set(t,r,n,i),e.scissor.set(t,r,n,i)}function zd(e){var t=Ld.autoClear;Ld.autoClear=!1;for(var r=1;r<fd;r++){var n=Math.sqrt(Sd[r]*Sd[r]-Sd[r-1]*Sd[r-1]),i=Id[(r-1)%Id.length];Bd(e,r-1,r,n,i)}Ld.autoClear=t}function Bd(e,t,r,n,i){Gd(e,Ad,t,r,n,"latitudinal",i),Gd(Ad,e,r,r,n,"longitudinal",i)}function Gd(e,t,r,n,i,a,o){"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var s=new Lr;s.add(new di(Rd[n],Td));var l=Td.uniforms,c=Md[r]-1,u=isFinite(i)?Math.PI/(2*c):2*Math.PI/(2*pd-1),h=i/u,d=isFinite(i)?1+Math.floor(3*h):pd;d>pd&&console.warn("sigmaRadians, "+i+", is too large and will clip, as it requested "+d+" samples when the maximum is set to "+pd);for(var f=[],p=0,m=0;m<pd;++m){var v=m/h,g=Math.exp(-v*v/2);f.push(g),0==m?p+=g:m<d&&(p+=2*g)}for(var m=0;m<f.length;m++)f[m]=f[m]/p;l.envMap.value=e.texture,l.samples.value=d,l.weights.value=f,l.latitudinal.value="latitudinal"===a,o&&(l.poleAxis.value=o),l.dTheta.value=u,l.mipInt.value=ud-r,l.inputEncoding.value=md[e.texture.encoding],l.outputEncoding.value=md[e.texture.encoding];var y=Md[n],v=3*Math.max(0,hd-2*y),E=(0===n?0:2*hd)+2*y*(n>ud-cd?n-ud+cd:0);Ud(t,v,E,3*y,2*y),Ld.setRenderTarget(t),Ld.render(s,xd)}function Vd(){var e=new Wt(1,1),t=new ic({uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:md[_t]},outputEncoding:{value:md[_t]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:u,depthTest:!1,depthWrite:!1});return t.type="EquirectangularToCubeUV",t}function jd(){var e=new ic({uniforms:{envMap:{value:null},inputEncoding:{value:md[_t]},outputEncoding:{value:md[_t]}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t",blending:u,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function Wd(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Zc.call(this,e),this.type="catmullrom",this.closed=!0}function Xd(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Zc.call(this,e),this.type="catmullrom"}function Yd(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Zc.call(this,e),this.type="catmullrom"}kd.prototype={constructor:kd,fromScene:function(e,t,r,n){void 0===t&&(t=0),void 0===r&&(r=.1),void 0===n&&(n=100),Pd=Ld.getRenderTarget();var i=Nd();return function(e,t,r,n){var i=new Li(90,1,t,r),a=[1,1,1,1,-1,1],o=[1,1,-1,-1,-1,1],s=Ld.outputEncoding,l=Ld.toneMapping,c=Ld.toneMappingExposure,u=Ld.getClearColor(),h=Ld.getClearAlpha();Ld.toneMapping=j,Ld.toneMappingExposure=1,Ld.outputEncoding=_t,e.scale.z*=-1;var d=e.background;if(d&&d.isColor){d.convertSRGBToLinear();var f=Math.max(d.r,d.g,d.b),p=Math.min(Math.max(Math.ceil(Math.log2(f)),-128),127);d=d.multiplyScalar(Math.pow(2,-p));var m=(p+128)/255;Ld.setClearColor(d,m),e.background=null}for(var v=0;v<6;v++){var g=v%3;0==g?(i.up.set(0,a[v],0),i.lookAt(o[v],0,0)):1==g?(i.up.set(0,0,a[v]),i.lookAt(0,o[v],0)):(i.up.set(0,a[v],0),i.lookAt(0,0,o[v])),Ud(n,g*hd,v>2?hd:0,hd,hd),Ld.setRenderTarget(n),Ld.render(e,i)}Ld.toneMapping=l,Ld.toneMappingExposure=c,Ld.outputEncoding=s,Ld.setClearColor(u,h),e.scale.z*=-1}(e,r,n,i),t>0&&Bd(i,0,0,t),zd(i),Od(i),i},fromEquirectangular:function(e){return e.magFilter=ae,e.minFilter=ae,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){Pd=Ld.getRenderTarget();var t=Nd(e);return function(e,t){var r=new Lr;e.isCubeTexture?null==wd&&(wd=jd()):null==bd&&(bd=Vd());var n=e.isCubeTexture?wd:bd;r.add(new di(Rd[0],n));var i=n.uniforms;i.envMap.value=e,e.isCubeTexture||i.texelSize.value.set(1/e.image.width,1/e.image.height),i.inputEncoding.value=md[e.encoding],i.outputEncoding.value=md[e.encoding],Ud(t,0,0,3*hd,2*hd),Ld.setRenderTarget(t),Ld.render(r,xd)}(e,t),zd(t),Od(t),t},compileCubemapShader:function(){null==wd&&Fd(wd=jd())},compileEquirectangularShader:function(){null==bd&&Fd(bd=Vd())},dispose:function(){Td.dispose(),null!=wd&&wd.dispose(),null!=bd&&bd.dispose();for(var e=0;e<Rd.length;e++)Rd[e].dispose()}},Bc.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Bc.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(su.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Ei,r=0,n=e.length;r<n;r++){var i=e[r];t.vertices.push(new rr(i.x,i.y,i.z||0))}return t}}),Object.assign(lu.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Wd.prototype=Object.create(Zc.prototype),Xd.prototype=Object.create(Zc.prototype),Yd.prototype=Object.create(Zc.prototype),Object.assign(Yd.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),jh.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Dh.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Hc.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),wu.extractUrlBase(e)}}),Hc.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Au.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Ah.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Vr.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Fi.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Ch.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(jt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),jt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),jt.ceilPowerOfTwo(e)}}),Object.assign(Xt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(ur.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new rr).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,n,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,a)}}),an.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},$t.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(en.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(vn.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(vn,{barycoordFromPoint:function(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),vn.getBarycoord(e,t,r,n,i)},normal:function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),vn.getNormal(e,t,r,n)}}),Object.assign(cu.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new kl(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Xl(this,e)}}),Object.assign(Wt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(rr.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Qt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ei.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(Ar.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Ar.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(di.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(di.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(hs.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ms.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),ds.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Bc.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Li.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(uu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ln.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Ut},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Ut)}}}),Object.assign(Ln.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ut:Dt),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(qn.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Ln(arguments[1],arguments[2])))},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(qn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(bh.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(jo.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Ut},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(jo.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ut:Dt),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Nl.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(xh.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Mn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new xn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(sc.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Si.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Bo.prototype,{clearTarget:function(e,t,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Bo.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Rt:_t}}}),Object.defineProperties(ko.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Kt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties($u.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,r=new Uu;return r.load(e,function(e){t.setBuffer(e)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),ah.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Hi.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var qd={merge:function(e,t,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};Yt.crossOrigin=void 0,Yt.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new zc;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},Yt.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Uc;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},Yt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Yt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Zd={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"114"}})),e.ACESFilmicToneMapping=q,e.AddEquation=v,e.AddOperation=G,e.AdditiveBlending=d,e.AlphaFormat=we,e.AlwaysDepth=I,e.AlwaysStencilFunc=Ft,e.AmbientLight=xu,e.AmbientLightProbe=Vu,e.AnimationClip=Sc,e.AnimationLoader=Nc,e.AnimationMixer=Eh,e.AnimationObjectGroup=gh,e.AnimationUtils=pc,e.ArcCurve=Vc,e.ArrayCamera=Do,e.ArrowHelper=sd,e.Audio=$u,e.AudioAnalyser=ah,e.AudioContext=Du,e.AudioListener=Ju,e.AudioLoader=Uu,e.AxesHelper=ld,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new ld(e)},e.BackSide=l,e.BasicDepthPacking=Ht,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Fc(e)},e.Bone=vs,e.BooleanKeyframeTrack=xc,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new td(e,t)},e.Box2=Ah,e.Box3=Vr,e.Box3Helper=rd,e.BoxBufferGeometry=Ti,e.BoxGeometry=xi,e.BoxHelper=td,e.BufferAttribute=Ln,e.BufferGeometry=qn,e.BufferGeometryLoader=Mu,e.ByteType=de,e.Cache=Lc,e.Camera=Ai,e.CameraHelper=Jh,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=Gs,e.CatmullRomCurve3=Zc,e.CineonToneMapping=Y,e.CircleBufferGeometry=tc,e.CircleGeometry=ec,e.ClampToEdgeWrapping=ne,e.Clock=Yu,e.ClosedSplineCurve3=Wd,e.Color=xn,e.ColorKeyframeTrack=Tc,e.CompressedTexture=Bs,e.CompressedTextureLoader=Oc,e.ConeBufferGeometry=$l,e.ConeGeometry=Jl,e.CubeCamera=Hi,e.CubeGeometry=xi,e.CubeReflectionMapping=Z,e.CubeRefractionMapping=Q,e.CubeTexture=ra,e.CubeTextureLoader=Uc,e.CubeUVReflectionMapping=ee,e.CubeUVRefractionMapping=te,e.CubicBezierCurve=$c,e.CubicBezierCurve3=eu,e.CubicInterpolant=vc,e.CullFaceBack=r,e.CullFaceFront=n,e.CullFaceFrontBack=3,e.CullFaceNone=t,e.Curve=Bc,e.CurvePath=su,e.CustomBlending=m,e.CylinderBufferGeometry=Kl,e.CylinderGeometry=Ql,e.Cylindrical=Mh,e.DataTexture=ki,e.DataTexture2DArray=na,e.DataTexture3D=ia,e.DataTextureLoader=Fc,e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=Cc,e.DepthFormat=Le,e.DepthStencilFormat=Pe,e.DepthTexture=Vs,e.DirectionalLight=Eu,e.DirectionalLightHelper=Zh,e.DirectionalLightShadow=yu,e.DiscreteInterpolant=yc,e.DodecahedronBufferGeometry=rl,e.DodecahedronGeometry=tl,e.DoubleSide=c,e.DstAlphaFactor=S,e.DstColorFactor=L,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ln(e,t).setUsage(Ut)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=Ut,e.DynamicReadUsage=35049,e.EdgesGeometry=Zl,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Cs(new Zl(e.geometry),new bs({color:void 0!==t?t:16777215}))},e.EllipseCurve=Gc,e.EqualDepth=O,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=K,e.EquirectangularRefractionMapping=J,e.Euler=fr,e.EventDispatcher=zt,e.ExtrudeBufferGeometry=Nl,e.ExtrudeGeometry=kl,e.Face3=_n,e.Face4=function(e,t,r,n,i,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new _n(e,t,r,i,a,o)},e.FaceColors=1,e.FileLoader=kc,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Fn(e,t)},e.Float32BufferAttribute=Fn,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Dn(e,t)},e.Float64BufferAttribute=Dn,e.FloatType=ge,e.Fog=Vo,e.FogExp2=Go,e.Font=Nu,e.FontLoader=Fu,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=s,e.Frustum=Fi,e.GammaEncoding=Mt,e.Geometry=Ei,e.GeometryUtils=qd,e.GreaterDepth=D,e.GreaterEqualDepth=F,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=jh,e.Group=Uo,e.HalfFloatType=ye,e.HemisphereLight=hu,e.HemisphereLightHelper=Vh,e.HemisphereLightProbe=Gu,e.IcosahedronBufferGeometry=el,e.IcosahedronGeometry=$s,e.ImageBitmapLoader=Iu,e.ImageLoader=Dc,e.ImageUtils=Yt,e.ImmediateRenderObject=Hh,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=Ru,e.InstancedBufferGeometry=_u,e.InstancedInterleavedBuffer=Th,e.InstancedMesh=Ts,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new In(e,t)},e.Int16BufferAttribute=In,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Nn(e,t)},e.Int32BufferAttribute=Nn,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Pn(e,t)},e.Int8BufferAttribute=Pn,e.IntType=me,e.InterleavedBuffer=jo,e.InterleavedBufferAttribute=Yo,e.Interpolant=mc,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=Ot,e.KeyframeTrack=Ec,e.LOD=hs,e.LatheBufferGeometry=Wl,e.LatheGeometry=jl,e.Layers=pr,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=k,e.LessEqualDepth=N,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=uu,e.LightProbe=Bu,e.LightShadow=du,e.Line=As,e.Line3=Ch,e.LineBasicMaterial=bs,e.LineCurve=tu,e.LineCurve3=ru,e.LineDashedMaterial=dc,e.LineLoop=Hs,e.LinePieces=1,e.LineSegments=Cs,e.LineStrip=0,e.LinearEncoding=_t,e.LinearFilter=le,e.LinearInterpolant=gc,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=ue,e.LinearMipmapNearestFilter=ce,e.LinearToneMapping=j,e.Loader=Hc,e.LoaderUtils=wu,e.LoadingManager=Pc,e.LogLuvEncoding=At,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=bt,e.LuminanceAlphaFormat=Se,e.LuminanceFormat=Me,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=Mn,e.MaterialLoader=bu,e.Math=jt,e.MathUtils=jt,e.Matrix3=Xt,e.Matrix4=ur,e.MaxEquation=x,e.Mesh=di,e.MeshBasicMaterial=Sn,e.MeshDepthMaterial=Po,e.MeshDistanceMaterial=Co,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=uc,e.MeshMatcapMaterial=hc,e.MeshNormalMaterial=cc,e.MeshPhongMaterial=sc,e.MeshPhysicalMaterial=oc,e.MeshStandardMaterial=ac,e.MeshToonMaterial=lc,e.MinEquation=E,e.MirroredRepeatWrapping=ie,e.MixOperation=B,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=p,e.MultiplyOperation=z,e.NearestFilter=ae,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=se,e.NearestMipmapNearestFilter=oe,e.NeverDepth=H,e.NeverStencilFunc=512,e.NoBlending=u,e.NoColors=0,e.NoToneMapping=V,e.NormalBlending=h,e.NotEqualDepth=U,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=bc,e.Object3D=Ar,e.ObjectLoader=Au,e.ObjectSpaceNormalMap=Nt,e.OctahedronBufferGeometry=Js,e.OctahedronGeometry=Ks,e.OneFactor=b,e.OneMinusDstAlphaFactor=A,e.OneMinusDstColorFactor=P,e.OneMinusSrcAlphaFactor=M,e.OneMinusSrcColorFactor=_,e.OrthographicCamera=gu,e.PCFShadowMap=i,e.PCFSoftShadowMap=a,e.PMREMGenerator=kd,e.ParametricBufferGeometry=Xs,e.ParametricGeometry=Ws,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new ss(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Is(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ds(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Is(e)},e.Path=lu,e.PerspectiveCamera=Li,e.Plane=an,e.PlaneBufferGeometry=Gi,e.PlaneGeometry=Bi,e.PlaneHelper=nd,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ds(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Is(e)},e.PointLight=vu,e.PointLightHelper=Uh,e.Points=Ds,e.PointsMaterial=Is,e.PolarGridHelper=Wh,e.PolyhedronBufferGeometry=qs,e.PolyhedronGeometry=Ys,e.PositionalAudio=ih,e.PropertyBinding=vh,e.PropertyMixer=oh,e.QuadraticBezierCurve=nu,e.QuadraticBezierCurve3=iu,e.Quaternion=$t,e.QuaternionKeyframeTrack=_c,e.QuaternionLinearInterpolant=wc,e.REVISION="114",e.RGBADepthPacking=It,e.RGBAFormat=Re,e.RGBAIntegerFormat=Oe,e.RGBA_ASTC_10x10_Format=at,e.RGBA_ASTC_10x5_Format=rt,e.RGBA_ASTC_10x6_Format=nt,e.RGBA_ASTC_10x8_Format=it,e.RGBA_ASTC_12x10_Format=ot,e.RGBA_ASTC_12x12_Format=st,e.RGBA_ASTC_4x4_Format=qe,e.RGBA_ASTC_5x4_Format=Ze,e.RGBA_ASTC_5x5_Format=Qe,e.RGBA_ASTC_6x5_Format=Ke,e.RGBA_ASTC_6x6_Format=Je,e.RGBA_ASTC_8x5_Format=$e,e.RGBA_ASTC_8x6_Format=et,e.RGBA_ASTC_8x8_Format=tt,e.RGBA_ETC2_EAC_Format=Ye,e.RGBA_PVRTC_2BPPV1_Format=je,e.RGBA_PVRTC_4BPPV1_Format=Ve,e.RGBA_S3TC_DXT1_Format=De,e.RGBA_S3TC_DXT3_Format=Ue,e.RGBA_S3TC_DXT5_Format=ze,e.RGBDEncoding=Ct,e.RGBEEncoding=St,e.RGBEFormat=Ae,e.RGBFormat=_e,e.RGBIntegerFormat=Ne,e.RGBM16Encoding=Pt,e.RGBM7Encoding=Lt,e.RGB_ETC1_Format=We,e.RGB_ETC2_Format=Xe,e.RGB_PVRTC_2BPPV1_Format=Ge,e.RGB_PVRTC_4BPPV1_Format=Be,e.RGB_S3TC_DXT1_Format=Fe,e.RGFormat=Ie,e.RGIntegerFormat=ke,e.RawShaderMaterial=ic,e.Ray=en,e.Raycaster=bh,e.RectAreaLight=Tu,e.RedFormat=Ce,e.RedIntegerFormat=He,e.ReinhardToneMapping=W,e.RepeatWrapping=re,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=y,e.RingBufferGeometry=Vl,e.RingGeometry=Gl,e.SRGB8_ALPHA8_ASTC_10x10_Format=Et,e.SRGB8_ALPHA8_ASTC_10x5_Format=vt,e.SRGB8_ALPHA8_ASTC_10x6_Format=gt,e.SRGB8_ALPHA8_ASTC_10x8_Format=yt,e.SRGB8_ALPHA8_ASTC_12x10_Format=xt,e.SRGB8_ALPHA8_ASTC_12x12_Format=Tt,e.SRGB8_ALPHA8_ASTC_4x4_Format=lt,e.SRGB8_ALPHA8_ASTC_5x4_Format=ct,e.SRGB8_ALPHA8_ASTC_5x5_Format=ut,e.SRGB8_ALPHA8_ASTC_6x5_Format=ht,e.SRGB8_ALPHA8_ASTC_6x6_Format=dt,e.SRGB8_ALPHA8_ASTC_8x5_Format=ft,e.SRGB8_ALPHA8_ASTC_8x6_Format=pt,e.SRGB8_ALPHA8_ASTC_8x8_Format=mt,e.Scene=Lr,e.SceneUtils=Zd,e.ShaderChunk=Vi,e.ShaderLib=ji,e.ShaderMaterial=Si,e.ShadowMaterial=nc,e.Shape=cu,e.ShapeBufferGeometry=Yl,e.ShapeGeometry=Xl,e.ShapePath=ku,e.ShapeUtils=Cl,e.ShortType=fe,e.Skeleton=ms,e.SkeletonHelper=Dh,e.SkinnedMesh=ds,e.SmoothShading=2,e.Sphere=Xr,e.SphereBufferGeometry=Bl,e.SphereGeometry=zl,e.Spherical=Rh,e.SphericalHarmonics3=zu,e.SphericalReflectionMapping=$,e.Spline=Yd,e.SplineCurve=au,e.SplineCurve3=Xd,e.SpotLight=pu,e.SpotLightHelper=kh,e.SpotLightShadow=fu,e.Sprite=ss,e.SpriteMaterial=qo,e.SrcAlphaFactor=R,e.SrcAlphaSaturateFactor=C,e.SrcColorFactor=w,e.StaticCopyUsage=35046,e.StaticDrawUsage=Dt,e.StaticReadUsage=35045,e.StereoCamera=Xu,e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=Rc,e.SubtractEquation=g,e.SubtractiveBlending=f,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=kt,e.TetrahedronBufferGeometry=Qs,e.TetrahedronGeometry=Zs,e.TextBufferGeometry=Ul,e.TextGeometry=Dl,e.Texture=Zt,e.TextureLoader=zc,e.TorusBufferGeometry=ll,e.TorusGeometry=sl,e.TorusKnotBufferGeometry=ol,e.TorusKnotGeometry=al,e.Triangle=vn,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=il,e.TubeGeometry=nl,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new kn(e,t)},e.Uint16BufferAttribute=kn,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new On(e,t)},e.Uint32BufferAttribute=On,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Cn(e,t)},e.Uint8BufferAttribute=Cn,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Hn(e,t)},e.Uint8ClampedBufferAttribute=Hn,e.Uncharted2ToneMapping=X,e.Uniform=xh,e.UniformsLib=Di,e.UniformsUtils=_i,e.UnsignedByteType=he,e.UnsignedInt248Type=be,e.UnsignedIntType=ve,e.UnsignedShort4444Type=Ee,e.UnsignedShort5551Type=xe,e.UnsignedShort565Type=Te,e.UnsignedShortType=pe,e.VSMShadowMap=o,e.Vector2=Wt,e.Vector3=rr,e.Vector4=Qt,e.VectorKeyframeTrack=Mc,e.Vertex=function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new rr(e,t,r)},e.VertexColors=2,e.VideoTexture=zs,e.WebGLCubeRenderTarget=Ii,e.WebGLMultisampleRenderTarget=Jt,e.WebGLRenderTarget=Kt,e.WebGLRenderTargetCube=function(e,t,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ii(e,r)},e.WebGLRenderer=Bo,e.WebGLUtils=Fo,e.WireframeGeometry=js,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Cs(new js(e.geometry),new bs({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new kc(e)},e.ZeroCurvatureEnding=wt,e.ZeroFactor=T,e.ZeroSlopeEnding=2401,e.ZeroStencilOp=0,e.sRGBEncoding=Rt,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,r){(function(r){var n,i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:o.now();r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var i=this._tweens[r[n]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[r[n]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var a,o=new i;o.Group=i,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof self&&void 0!==r&&r.hrtime?o.now=function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?o.now=self.performance.now.bind(self.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onRepeat:function(e){return this._onRepeatCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,n;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r,n=this._easingFunction(r),this._valuesEnd)if(void 0!==this._valuesStart[t]){var i=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,n):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?i+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=i+(a-i)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],n):t>1?a(e[r],e[r-1],r-n):a(e[i],e[i+1>r?r:i+1],n-i)},Bezier:function(e,t){for(var r=0,n=e.length-1,i=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=n;s++)r+=i(1-t,n-s)*i(t,s)*e[s]*a(n,s);return r},CatmullRom:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(i=Math.floor(n=r*(1+t))),a(e[(i-1+r)%r],e[i],e[(i+1)%r],e[(i+2)%r],n-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[r]-(a(e[r],e[r],e[r-1],e[r-1],n-r)-e[r]):a(e[i?i-1:0],e[i],e[r<i+1?r:i+1],e[r<i+2?r:i+2],n-i)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=o.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(a=[1],function(e){var t=1;if(a[e])return a[e];for(var r=e;r>1;r--)t*=r;return a[e]=t,t}),CatmullRom:function(e,t,r,n,i){var a=.5*(r-e),o=.5*(n-t),s=i*i;return(2*t-2*r+a+o)*(i*s)+(-3*t+3*r-2*a-o)*s+a*i+t}}},void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}).call(this,r(96))},function(e,t){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";function e(e){throw e}var t=void 0,r=this;function n(e,n){var i,a=e.split("."),o=r;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||n===t?o=o[i]?o[i]:o[i]={}:o[i]=n}var i,a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;for(new(a?Uint8Array:Array)(256),i=0;256>i;++i)for(var o=(o=i)>>>1;o;o>>>=1)0;function s(e,t,r){var n,i="number"==typeof t?t:t=0,a="number"==typeof r?r:e.length;for(n=-1,i=7&a;i--;++t)n=n>>>8^c[255&(n^e[t])];for(i=a>>3;i--;t+=8)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^c[255&(n^e[t])])>>>8^c[255&(n^e[t+1])])>>>8^c[255&(n^e[t+2])])>>>8^c[255&(n^e[t+3])])>>>8^c[255&(n^e[t+4])])>>>8^c[255&(n^e[t+5])])>>>8^c[255&(n^e[t+6])])>>>8^c[255&(n^e[t+7])];return(4294967295^n)>>>0}var l=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],c=a?new Uint32Array(l):l;function u(){}function h(e){var t,r,n,i,o,s,l,c,u,h,d=e.length,f=0,p=Number.POSITIVE_INFINITY;for(c=0;c<d;++c)e[c]>f&&(f=e[c]),e[c]<p&&(p=e[c]);for(t=1<<f,r=new(a?Uint32Array:Array)(t),n=1,i=0,o=2;n<=f;){for(c=0;c<d;++c)if(e[c]===n){for(s=0,l=i,u=0;u<n;++u)s=s<<1|1&l,l>>=1;for(h=n<<16|c,u=s;u<t;u+=o)r[u]=h;++i}++n,i<<=1,o<<=1}return[r,f,p]}u.prototype.getName=function(){return this.name},u.prototype.getData=function(){return this.data},u.prototype.H=function(){return this.I},n("Zlib.GunzipMember",u),n("Zlib.GunzipMember.prototype.getName",u.prototype.getName),n("Zlib.GunzipMember.prototype.getData",u.prototype.getData),n("Zlib.GunzipMember.prototype.getMtime",u.prototype.H);var d,f=[];for(d=0;288>d;d++)switch(!0){case 143>=d:f.push([d+48,8]);break;case 255>=d:f.push([d-144+400,9]);break;case 279>=d:f.push([d-256+0,7]);break;case 287>=d:f.push([d-280+192,8]);break;default:e("invalid literal: "+d)}var p=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var r,n,i=[];for(r=3;258>=r;r++)n=t(r),i[r]=n[2]<<24|n[1]<<16|n[0];return i}();function m(t,r){switch(this.i=[],this.j=32768,this.d=this.f=this.c=this.n=0,this.input=a?new Uint8Array(t):t,this.o=!1,this.k=g,this.z=!1,!r&&(r={})||(r.index&&(this.c=r.index),r.bufferSize&&(this.j=r.bufferSize),r.bufferType&&(this.k=r.bufferType),r.resize&&(this.z=r.resize)),this.k){case v:this.a=32768,this.b=new(a?Uint8Array:Array)(32768+this.j+258);break;case g:this.a=0,this.b=new(a?Uint8Array:Array)(this.j),this.e=this.F,this.q=this.B,this.l=this.D;break;default:e(Error("invalid inflate mode"))}}a&&new Uint32Array(p);var v=0,g=1;m.prototype.g=function(){for(;!this.o;){var r=O(this,3);switch(1&r&&(this.o=!0),r>>>=1){case 0:var n=this.input,i=this.c,o=this.b,s=this.a,l=n.length,c=t,u=o.length,h=t;switch(this.d=this.f=0,i+1>=l&&e(Error("invalid uncompressed block header: LEN")),c=n[i++]|n[i++]<<8,i+1>=l&&e(Error("invalid uncompressed block header: NLEN")),c===~(n[i++]|n[i++]<<8)&&e(Error("invalid uncompressed block header: length verify")),i+c>n.length&&e(Error("input buffer is broken")),this.k){case v:for(;s+c>o.length;){if(c-=h=u-s,a)o.set(n.subarray(i,i+h),s),s+=h,i+=h;else for(;h--;)o[s++]=n[i++];this.a=s,o=this.e(),s=this.a}break;case g:for(;s+c>o.length;)o=this.e({t:2});break;default:e(Error("invalid inflate mode"))}if(a)o.set(n.subarray(i,i+c),s),s+=c,i+=c;else for(;c--;)o[s++]=n[i++];this.c=i,this.a=s,this.b=o;break;case 1:this.l(I,N);break;case 2:D(this);break;default:e(Error("unknown BTYPE: "+r))}}return this.q()};var y,E,x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],T=a?new Uint16Array(x):x,b=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],w=a?new Uint16Array(b):b,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],R=a?new Uint8Array(_):_,M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],S=a?new Uint16Array(M):M,A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=a?new Uint8Array(A):A,P=new(a?Uint8Array:Array)(288);for(y=0,E=P.length;y<E;++y)P[y]=143>=y?8:255>=y?9:279>=y?7:8;var C,H,I=h(P),k=new(a?Uint8Array:Array)(30);for(C=0,H=k.length;C<H;++C)k[C]=5;var N=h(k);function O(t,r){for(var n,i=t.f,a=t.d,o=t.input,s=t.c,l=o.length;a<r;)s>=l&&e(Error("input buffer is broken")),i|=o[s++]<<a,a+=8;return n=i&(1<<r)-1,t.f=i>>>r,t.d=a-r,t.c=s,n}function F(e,t){for(var r,n,i=e.f,a=e.d,o=e.input,s=e.c,l=o.length,c=t[0],u=t[1];a<u&&!(s>=l);)i|=o[s++]<<a,a+=8;return n=(r=c[i&(1<<u)-1])>>>16,e.f=i>>n,e.d=a-n,e.c=s,65535&r}function D(e){function t(e,t,r){var n,i,a,o=this.w;for(a=0;a<e;)switch(n=F(this,t),n){case 16:for(i=3+O(this,2);i--;)r[a++]=o;break;case 17:for(i=3+O(this,3);i--;)r[a++]=0;o=0;break;case 18:for(i=11+O(this,7);i--;)r[a++]=0;o=0;break;default:o=r[a++]=n}return this.w=o,r}var r,n,i,o,s=O(e,5)+257,l=O(e,5)+1,c=O(e,4)+4,u=new(a?Uint8Array:Array)(T.length);for(o=0;o<c;++o)u[T[o]]=O(e,3);if(!a)for(o=c,c=u.length;o<c;++o)u[T[o]]=0;r=h(u),n=new(a?Uint8Array:Array)(s),i=new(a?Uint8Array:Array)(l),e.w=0,e.l(h(t.call(e,s,r,n)),h(t.call(e,l,r,i)))}function U(e){this.input=e,this.c=0,this.m=[],this.s=!1}m.prototype.l=function(e,t){var r=this.b,n=this.a;this.r=e;for(var i,a,o,s,l=r.length-258;256!==(i=F(this,e));)if(256>i)n>=l&&(this.a=n,r=this.e(),n=this.a),r[n++]=i;else for(s=w[a=i-257],0<R[a]&&(s+=O(this,R[a])),i=F(this,t),o=S[i],0<L[i]&&(o+=O(this,L[i])),n>=l&&(this.a=n,r=this.e(),n=this.a);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},m.prototype.D=function(e,t){var r=this.b,n=this.a;this.r=e;for(var i,a,o,s,l=r.length;256!==(i=F(this,e));)if(256>i)n>=l&&(l=(r=this.e()).length),r[n++]=i;else for(s=w[a=i-257],0<R[a]&&(s+=O(this,R[a])),i=F(this,t),o=S[i],0<L[i]&&(o+=O(this,L[i])),n+s>l&&(l=(r=this.e()).length);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},m.prototype.e=function(){var e,t,r=new(a?Uint8Array:Array)(this.a-32768),n=this.a-32768,i=this.b;if(a)r.set(i.subarray(32768,r.length));else for(e=0,t=r.length;e<t;++e)r[e]=i[e+32768];if(this.i.push(r),this.n+=r.length,a)i.set(i.subarray(n,n+32768));else for(e=0;32768>e;++e)i[e]=i[n+e];return this.a=32768,i},m.prototype.F=function(e){var t,r,n,i=this.input.length/this.c+1|0,o=this.input,s=this.b;return e&&("number"==typeof e.t&&(i=e.t),"number"==typeof e.A&&(i+=e.A)),2>i?r=(n=(o.length-this.c)/this.r[2]/2*258|0)<s.length?s.length+n:s.length<<1:r=s.length*i,a?(t=new Uint8Array(r)).set(s):t=s,this.b=t},m.prototype.q=function(){var e,t,r,n,i,o=0,s=this.b,l=this.i,c=new(a?Uint8Array:Array)(this.n+(this.a-32768));if(0===l.length)return a?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(t=0,r=l.length;t<r;++t)for(n=0,i=(e=l[t]).length;n<i;++n)c[o++]=e[n];for(t=32768,r=this.a;t<r;++t)c[o++]=s[t];return this.i=[],this.buffer=c},m.prototype.B=function(){var e,t=this.a;return a?this.z?(e=new Uint8Array(t)).set(this.b.subarray(0,t)):e=this.b.subarray(0,t):(this.b.length>t&&(this.b.length=t),e=this.b),this.buffer=e},U.prototype.G=function(){return this.s||this.g(),this.m.slice()},U.prototype.g=function(){for(var r=this.input.length;this.c<r;){var n,i,o=new u,l=t,c=t,h=t,d=t,f=t,p=t,v=t,g=this.input,y=this.c;switch(o.u=g[y++],o.v=g[y++],(31!==o.u||139!==o.v)&&e(Error("invalid file signature:"+o.u+","+o.v)),o.p=g[y++],o.p){case 8:break;default:e(Error("unknown compression method: "+o.p))}if(o.h=g[y++],i=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24,o.I=new Date(1e3*i),o.O=g[y++],o.N=g[y++],0<(4&o.h)&&(o.J=g[y++]|g[y++]<<8,y+=o.J),0<(8&o.h)){for(p=[],f=0;0<(d=g[y++]);)p[f++]=String.fromCharCode(d);o.name=p.join("")}if(0<(16&o.h)){for(p=[],f=0;0<(d=g[y++]);)p[f++]=String.fromCharCode(d);o.K=p.join("")}0<(2&o.h)&&(o.C=65535&s(g,0,y),o.C!==(g[y++]|g[y++]<<8)&&e(Error("invalid header crc16"))),l=g[g.length-4]|g[g.length-3]<<8|g[g.length-2]<<16|g[g.length-1]<<24,g.length-y-4-4<512*l&&(h=l),c=new m(g,{index:y,bufferSize:h}),o.data=n=c.g(),y=c.c,o.L=v=(g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24)>>>0,s(n,t,t)!==v&&e(Error("invalid CRC-32 checksum: 0x"+s(n,t,t).toString(16)+" / 0x"+v.toString(16))),o.M=l=(g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24)>>>0,(4294967295&n.length)!==l&&e(Error("invalid input size: "+(4294967295&n.length)+" / "+l)),this.m.push(o),this.c=y}this.s=!0;var E,x,T,b=this.m,w=0,_=0;for(E=0,x=b.length;E<x;++E)_+=b[E].data.length;if(a)for(T=new Uint8Array(_),E=0;E<x;++E)T.set(b[E].data,w),w+=b[E].data.length;else{for(T=[],E=0;E<x;++E)T[E]=b[E].data;T=Array.prototype.concat.apply([],T)}return T},n("Zlib.Gunzip",U),n("Zlib.Gunzip.prototype.decompress",U.prototype.g),n("Zlib.Gunzip.prototype.getMembers",U.prototype.G)}).call(this)},function(e,t,r){var n,i,a;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r,s){"object"===o(t)&&void 0!==e?s(t):(i=[t],void 0===(a="function"==typeof(n=s)?n.apply(t,i):n)||(e.exports=a))}(0,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(e,t,r){return M(R(e,r),t)}function d(e,t,r,n){var i,a=0;return t<r?(i=t,a=0):(i=r,a=1),n<i&&(a=2),Ee[e][a]}function f(e){var t,r,n=e.children,i=0;if(null!==n)for(t=0,r=n.length;t<r;++t)i+=f(n[t]);else null!==e.points&&(i=e.points.length);return i}function p(e,t,r,n,i){var a,o,s=n.children,l=!1,c=!1;if(n.contains(e,r.bias)){if(null===s){if(null===n.points)n.points=[],n.data=[];else for(a=0,o=n.points.length;!l&&a<o;++a)l=n.points[a].equals(e);l?(n.data[a-1]=t,c=!0):n.points.length<r.maxPoints||i===r.maxDepth?(n.points.push(e.clone()),n.data.push(t),++r.pointCount,c=!0):(n.split(),n.redistribute(r.bias),s=n.children)}if(null!==s)for(++i,a=0,o=s.length;!c&&a<o;++a)c=p(e,t,r,s[a],i)}return c}function m(e,t,r,n){var i,a,o,s,l,c=r.children,u=null;if(r.contains(e,t.bias))if(null!==c)for(i=0,a=c.length;null===u&&i<a;++i)u=m(e,t,c[i],r);else if(null!==r.points)for(o=r.points,s=r.data,i=0,a=o.length;i<a;++i)if(o[i].equals(e)){l=a-1,u=s[i],i<l&&(o[i]=o[l],s[i]=s[l]),o.pop(),s.pop(),--t.pointCount,null!==n&&f(n)<=t.maxPoints&&n.merge();break}return u}function v(e,t,r,n){var i,a,o,s,l,c,u,h=n.points,d=n.children,f=null,p=t;if(null!==d)for(i=0,a=(l=d.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance})).length;i<a;++i)(c=l[i].octant).contains(e,p)&&(null!==(u=v(e,p,r,c))&&(s=u.point.distanceToSquared(e),(!r||0<s)&&s<p&&(p=s,f=u)));else if(null!==h)for(i=0,a=h.length;i<a;++i)o=h[i],s=e.distanceToSquared(o),(!r||0<s)&&s<p&&(p=s,f={point:o.clone(),data:n.data[i]});return f}function g(e,t,r,n,i){var a,o,s,l,c,u=n.points,h=n.children;if(null!==h)for(a=0,o=h.length;a<o;++a)(c=h[a]).contains(e,t)&&g(e,t,r,c,i);else if(null!==u)for(a=0,o=u.length;a<o;++a)s=u[a],l=e.distanceToSquared(s),(!r||0<l)&&l<=t*t&&i.push({point:s.clone(),data:n.data[a]})}var y=Math.PI,E=Math.atan2,x=Math.round,T=Math.ceil,b=Math.floor,w=Math.abs,_=Math.acos,R=Math.min,M=Math.max,S=Math.sqrt,A=Math.cos,L=Math.sin,P=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=r,this.y=n,this.z=i}return n(e,[{key:"set",value:function(e,t,r){return this.x=e,this.y=t,this.z=r,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"setFromSpherical",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,r){var n=L(t)*e;return this.x=n*L(r),this.y=A(t)*e,this.z=n*A(r),this}},{key:"setFromCylindrical",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,r){return this.x=e*L(t),this.y=r,this.z=e*A(t),this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:"crossVectors",value:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"transformDirection",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}},{key:"applyMatrix3",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}},{key:"applyMatrix4",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this}},{key:"applyQuaternion",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*n-o*r,c=s*r+o*t-i*n,u=s*n+i*r-a*t,h=-i*t-a*r-o*n;return this.x=l*s+h*-i+c*-o-u*-a,this.y=c*s+h*-a+u*-i-l*-o,this.z=u*s+h*-o+l*-a-c*-i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"reflect",value:function(e){var t=e.x,r=e.y,n=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,r,n),this}},{key:"angleTo",value:function(e){var t=this.dot(e)/S(this.lengthSquared()*e.lengthSquared());return _(R(M(t,-1),1))}},{key:"manhattanLength",value:function(){return w(this.x)+w(this.y)+w(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return S(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(e){return w(this.x-e.x)+w(this.y-e.y)+w(this.z-e.z)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}},{key:"distanceTo",value:function(e){return S(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=R(this.x,e.x),this.y=R(this.y,e.y),this.z=R(this.z,e.z),this}},{key:"max",value:function(e){return this.x=M(this.x,e.x),this.y=M(this.y,e.y),this.z=M(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=M(e.x,R(t.x,this.x)),this.y=M(e.y,R(t.y,this.y)),this.z=M(e.z,R(t.z,this.z)),this}},{key:"floor",value:function(){return this.x=b(this.x),this.y=b(this.y),this.z=b(this.z),this}},{key:"ceil",value:function(){return this.x=T(this.x),this.y=T(this.y),this.z=T(this.z),this}},{key:"round",value:function(){return this.x=x(this.x),this.y=x(this.y),this.z=x(this.z),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),e}(),C=new P,H=[new P,new P,new P,new P,new P,new P,new P,new P],I=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P(-1/0,-1/0,-1/0);t(this,e),this.min=r,this.max=n}return n(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,r;for(this.min.set(0,0,0),this.max.set(0,0,0),t=0,r=e.length;t<r;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var r=C.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return C.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"applyMatrix4",value:function(e){var t=this.min,r=this.max;return this.isEmpty()||(H[0].set(t.x,t.y,t.z).applyMatrix4(e),H[1].set(t.x,t.y,r.z).applyMatrix4(e),H[2].set(t.x,r.y,t.z).applyMatrix4(e),H[3].set(t.x,r.y,r.z).applyMatrix4(e),H[4].set(r.x,t.y,t.z).applyMatrix4(e),H[5].set(r.x,t.y,r.z).applyMatrix4(e),H[6].set(r.x,r.y,t.z).applyMatrix4(e),H[7].set(r.x,r.y,r.z).applyMatrix4(e),this.setFromPoints(H)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,r=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=r.x&&e.y<=r.y&&e.z<=r.z}},{key:"containsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=r.x&&t.y<=n.y&&i.y<=r.y&&t.z<=n.z&&i.z<=r.z}},{key:"intersectsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&n.x<=r.x&&n.y<=r.y&&n.z<=r.z}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,C).distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,r;return 0<e.normal.x?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),k=new I,N=new P,O=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.center=r,this.radius=n}return n(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(e){var t,r,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:k.setFromPoints(e).getCenter(this.center),i=0;for(t=0,r=e.length;t<r;++t)i=M(i,n.distanceToSquared(e[t]));return this.radius=S(i),this}},{key:"setFromBox",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(N).length(),this}},{key:"isEmpty",value:function(){return 0>=this.radius}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return w(e.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),F=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.x=r,this.y=n}return n(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this}},{key:"applyMatrix3",value:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"manhattanLength",value:function(){return w(this.x)+w(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return S(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(e){return w(this.x-e.x)+w(this.y-e.y)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r}},{key:"distanceTo",value:function(e){return S(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=R(this.x,e.x),this.y=R(this.y,e.y),this}},{key:"max",value:function(e){return this.x=M(this.x,e.x),this.y=M(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=M(e.x,R(t.x,this.x)),this.y=M(e.y,R(t.y,this.y)),this}},{key:"floor",value:function(){return this.x=b(this.x),this.y=b(this.y),this}},{key:"ceil",value:function(){return this.x=T(this.x),this.y=T(this.y),this}},{key:"round",value:function(){return this.x=x(this.x),this.y=x(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var e=E(this.y,this.x);return 0>e&&(e+=2*y),e}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"rotateAround",value:function(e,t){var r=A(t),n=L(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*n+e.x,this.y=i*n+a*r+e.y,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"width",get:function(){return this.x},set:function(e){return this.x=e}},{key:"height",get:function(){return this.y},set:function(e){return this.y=e}}]),e}(),D=new F,U=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new F(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new F(-1/0,-1/0);t(this,e),this.min=r,this.max=n}n(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new F;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new F;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new O;return this.getCenter(e.center),e.radius=.5*this.getSize(D).length(),e}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,r;for(this.min.set(0,0),this.max.set(0,0),t=0,r=e.length;t<r;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var r=D.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new F;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return D.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,r=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=r.x&&e.y<=r.y}},{key:"containsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=r.x&&t.y<=n.y&&i.y<=r.y}},{key:"intersectsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&n.x<=r.x&&n.y<=r.y}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}])}(),function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=r,this.theta=n,this.y=i}n(e,[{key:"set",value:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,r){return this.radius=S(e*e+r*r),this.theta=E(e,r),this.y=t,this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return n(e,[{key:"set",value:function(e,t,r,n,i,a,o,s,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=r,c[1]=n,c[4]=i,c[7]=a,c[2]=o,c[5]=s,c[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,r=this.elements;return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;9>t;++t)n[t]=e[t+r];return this}},{key:"toArray",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;9>e;++e)t[e+r]=n[e];return t}},{key:"multiplyMatrices",value:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],f=r[8],p=n[0],m=n[3],v=n[6],g=n[1],y=n[4],E=n[7],x=n[2],T=n[5],b=n[8];return i[0]=a*p+o*g+s*x,i[3]=a*m+o*y+s*T,i[6]=a*v+o*E+s*b,i[1]=l*p+c*g+u*x,i[4]=l*m+c*y+u*T,i[7]=l*v+c*E+u*b,i[2]=h*p+d*g+f*x,i[5]=h*m+d*y+f*T,i[8]=h*v+d*E+f*b,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-r*i*c+r*o*s+n*i*l-n*a*s}},{key:"getInverse",value:function(e){var t,r=e.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],f=d*l-c*h,p=c*u-d*s,m=h*s-l*u,v=i*f+a*p+o*m;return 0==v?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(t=1/v,n[0]=f*t,n[1]=(o*h-d*a)*t,n[2]=(c*a-o*l)*t,n[3]=p*t,n[4]=(d*i-o*u)*t,n[5]=(o*s-c*i)*t,n[6]=m*t,n[7]=(a*u-h*i)*t,n[8]=(l*i-a*s)*t),this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"scale",value:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}},{key:"rotate",value:function(e){var t=A(e),r=L(e),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],l=n[4],c=n[7];return n[0]=t*i+r*s,n[3]=t*a+r*l,n[6]=t*o+r*c,n[1]=-r*i+t*s,n[4]=-r*a+t*l,n[7]=-r*o+t*c,this}},{key:"translate",value:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}},{key:"equals",value:function(e){var t,r=this.elements,n=e.elements,i=!0;for(t=0;i&&9>t;++t)r[t]!==n[t]&&(i=!1);return i}}]),e}()),z="XYZ",B="YZX",G="ZXY",V="XZY",j="YXZ",W="ZYX",X=new P,Y=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=r,this.y=n,this.z=i,this.w=a}var r=Number.EPSILON;return n(e,[{key:"set",value:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setFromEuler",value:function(e){var t=e.x,r=e.y,n=e.z,i=A,a=L,o=i(t/2),s=i(r/2),l=i(n/2),c=a(t/2),u=a(r/2),h=a(n/2);switch(e.order){case z:this.x=c*s*l+o*u*h,this.y=o*u*l-c*s*h,this.z=o*s*h+c*u*l,this.w=o*s*l-c*u*h;break;case j:this.x=c*s*l+o*u*h,this.y=o*u*l-c*s*h,this.z=o*s*h-c*u*l,this.w=o*s*l+c*u*h;break;case G:this.x=c*s*l-o*u*h,this.y=o*u*l+c*s*h,this.z=o*s*h+c*u*l,this.w=o*s*l-c*u*h;break;case W:this.x=c*s*l-o*u*h,this.y=o*u*l+c*s*h,this.z=o*s*h-c*u*l,this.w=o*s*l+c*u*h;break;case B:this.x=c*s*l+o*u*h,this.y=o*u*l+c*s*h,this.z=o*s*h-c*u*l,this.w=o*s*l-c*u*h;break;case V:this.x=c*s*l-o*u*h,this.y=o*u*l-c*s*h,this.z=o*s*h+c*u*l,this.w=o*s*l+c*u*h}return this}},{key:"setFromAxisAngle",value:function(e,t){var r=t/2,n=L(r);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=A(r),this}},{key:"setFromRotationMatrix",value:function(e){var t,r=e.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+s+h;return 0<d?(t=.5/S(d+1),this.w=.25/t,this.x=(u-l)*t,this.y=(a-c)*t,this.z=(o-i)*t):n>s&&n>h?(t=2*S(1+n-s-h),this.w=(u-l)/t,this.x=.25*t,this.y=(i+o)/t,this.z=(a+c)/t):s>h?(t=2*S(1+s-n-h),this.w=(a-c)/t,this.x=(i+o)/t,this.y=.25*t,this.z=(l+u)/t):(t=2*S(1+h-n-s),this.w=(o-i)/t,this.x=(a+c)/t,this.y=(l+u)/t,this.z=.25*t),this}},{key:"setFromUnitVectors",value:function(e,t){var r=e.dot(t)+1;return 1e-6>r?(r=0,w(e.x)>w(e.z)?X.set(-e.y,e.x,0):X.set(0,-e.z,e.y)):X.crossVectors(e,t),this.x=X.x,this.y=X.y,this.z=X.z,this.w=r,this.normalize()}},{key:"angleTo",value:function(e){return 2*_(w(R(M(this.dot(e),-1),1)))}},{key:"rotateTowards",value:function(e,t){var r=this.angleTo(e);return 0!==r&&this.slerp(e,R(1,t/r)),this}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return S(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var e,t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"multiplyQuaternions",value:function(e,t){var r=e.x,n=e.y,i=e.z,a=e.w,o=t.x,s=t.y,l=t.z,c=t.w;return this.x=r*c+a*o+n*l-i*s,this.y=n*c+a*s+i*o-r*l,this.z=i*c+a*l+r*s-n*o,this.w=a*c-r*o-n*s-i*l,this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"slerp",value:function(e,t){var n,i,a,o,s,l,c,u=this.x,h=this.y,d=this.z,f=this.w;return 1===t?this.copy(e):0<t&&(0>(n=f*e.w+u*e.x+h*e.y+d*e.z)?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,n=-n):this.copy(e),1<=n?(this.w=f,this.x=u,this.y=h,this.z=d):(s=1-t,(i=1-n*n)<=r?(this.w=s*f+t*this.w,this.x=s*u+t*this.x,this.y=s*h+t*this.y,this.z=s*d+t*this.z,this.normalize()):(a=S(i),o=E(a,n),l=L(s*o)/a,c=L(t*o)/a,this.w=f*l+this.w*c,this.x=u*l+this.x*c,this.y=h*l+this.y*c,this.z=d*l+this.z*c))),this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:"slerp",value:function(e,t,r,n){return r.copy(e).slerp(t,n)}},{key:"slerpFlat",value:function(e,t,n,i,a,o,s){var l,c,u,h,d,f,p,m,v=a[o],g=a[o+1],y=a[o+2],x=a[o+3],T=n[i],b=n[i+1],w=n[i+2],_=n[i+3];(_!==x||T!==v||b!==g||w!==y)&&(l=1-s,f=0<=(h=T*v+b*g+w*y+_*x)?1:-1,(d=1-h*h)>r&&(u=S(d),p=E(u,h*f),l=L(l*p)/u,s=L(s*p)/u),T=T*l+v*(m=s*f),b=b*l+g*m,w=w*l+y*m,_=_*l+x*m,l===1-s&&(T*=c=1/S(T*T+b*b+w*w+_*_),b*=c,w*=c,_*=c)),e[t]=T,e[t+1]=b,e[t+2]=w,e[t+3]=_}}]),e}(),q=new U,Z=new Y,Q=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=r,this.y=n,this.z=i,this.order=e.defaultOrder}n(e,[{key:"set",value:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.order=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.order=e.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:"toVector3",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(e){var t=Math.asin,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,n=e.elements,i=n[0],a=n[4],o=n[8],s=n[1],l=n[5],c=n[9],u=n[2],d=n[6],f=n[10],p=.99999;switch(r){case z:this.y=t(h(o,-1,1)),w(o)<p?(this.x=E(-c,f),this.z=E(-a,i)):(this.x=E(d,l),this.z=0);break;case j:this.x=t(-h(c,-1,1)),w(c)<p?(this.y=E(o,f),this.z=E(s,l)):(this.y=E(-u,i),this.z=0);break;case G:this.x=t(h(d,-1,1)),w(d)<p?(this.y=E(-u,f),this.z=E(-a,l)):(this.y=0,this.z=E(s,i));break;case W:this.y=t(-h(u,-1,1)),w(u)<p?(this.x=E(d,f),this.z=E(s,i)):(this.x=0,this.z=E(-a,l));break;case B:this.z=t(h(s,-1,1)),w(s)<p?(this.x=E(-c,l),this.y=E(-u,i)):(this.x=0,this.y=E(o,f));break;case V:this.z=t(-h(a,-1,1)),w(a)<p?(this.x=E(d,l),this.y=E(o,i)):(this.x=E(-c,f),this.y=0)}return this.order=r,this}},{key:"setFromQuaternion",value:function(e,t){return q.makeRotationFromQuaternion(e),this.setFromRotationMatrix(q,t)}},{key:"setFromVector3",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return Z.setFromEuler(this),this.setFromQuaternion(Z,e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.order===this.order}}],[{key:"defaultOrder",get:function(){return z}}])}(),new P),K=new P,J=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.normal=r,this.constant=n}return n(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,r){var n=Q.subVectors(r,t).cross(K.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,Q),this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"intersectLine",value:function(e,t){var r=e.delta(Q),n=this.normal.dot(r);if(0===n)0===this.distanceToPoint(e.start)&&t.copy(e.start);else{var i=-(e.start.dot(this.normal)+this.constant)/n;0<=i&&1>=i&&t.copy(r).multiplyScalar(i).add(e.start)}return t}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&0<r||0>r&&0<t}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),$=new P,ee=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new J,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new J,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new J,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new J,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new J,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new J;t(this,e),this.planes=[r,n,i,a,o,s]}n(e,[{key:"set",value:function(e,t,r,n,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){var t,r=this.planes;for(t=0;6>t;++t)r[t].copy(e.planes[t]);return this}},{key:"setFromMatrix",value:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],f=r[10],p=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(o-n,u-s,p-h,y-m).normalize(),t[1].setComponents(o+n,u+s,p+h,y+m).normalize(),t[2].setComponents(o+i,u+l,p+d,y+v).normalize(),t[3].setComponents(o-i,u-l,p-d,y-v).normalize(),t[4].setComponents(o-a,u-c,p-f,y-g).normalize(),t[5].setComponents(o+a,u+c,p+f,y+g).normalize(),this}},{key:"intersectsSphere",value:function(e){var t,r=this.planes,n=e.center,i=-e.radius,a=!0;for(t=0;6>t;++t)if(r[t].distanceToPoint(n)<i){a=!1;break}return a}},{key:"intersectsBox",value:function(e){var t,r,n=this.planes,i=e.min,a=e.max;for(t=0;6>t;++t)if(r=n[t],$.x=0<r.normal.x?a.x:i.x,$.y=0<r.normal.y?a.y:i.y,$.z=0<r.normal.z?a.z:i.z,0>r.distanceToPoint($))return!1;return!0}},{key:"containsPoint",value:function(e){var t,r=this.planes,n=!0;for(t=0;6>t;++t)if(0>r[t].distanceToPoint(e)){n=!1;break}return n}}])}(),new P),te=new P,re=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;t(this,e),this.start=r,this.end=n}n(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){ee.subVectors(e,this.start),te.subVectors(this.end,this.start);var r=te.dot(te),n=te.dot(ee);return t?R(M(n/r,0),1):n/r}},{key:"closestPointToPoint",value:function(e){var t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new P,n=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(n).add(this.start)}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}])}(),new P),ne=new P,ie=new P,ae=(function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}n(e,[{key:"set",value:function(e,t,r,n,i,a,o,s,l,c,u,h,d,f,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=f,v[11]=p,v[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,r=this.elements;return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;16>t;++t)n[t]=e[t+r];return this}},{key:"toArray",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;16>e;++e)t[e+r]=n[e];return t}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return S(M(t,r,n))}},{key:"copyPosition",value:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}},{key:"setPosition",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:"extractBasis",value:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,r=e.elements,n=1/re.setFromMatrixColumn(e,0).length(),i=1/re.setFromMatrixColumn(e,1).length(),a=1/re.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t,r,n,i,a,o,s,l,c,u,h,d,f=this.elements,p=e.x,m=e.y,v=e.z,g=A(p),y=L(p),E=A(m),x=L(m),T=A(v),b=L(v);switch(e.order){case z:t=g*T,r=g*b,n=y*T,i=y*b,f[0]=E*T,f[4]=-E*b,f[8]=x,f[1]=r+n*x,f[5]=t-i*x,f[9]=-y*E,f[2]=i-t*x,f[6]=n+r*x,f[10]=g*E;break;case j:a=E*T,o=E*b,s=x*T,l=x*b,f[0]=a+l*y,f[4]=s*y-o,f[8]=g*x,f[1]=g*b,f[5]=g*T,f[9]=-y,f[2]=o*y-s,f[6]=l+a*y,f[10]=g*E;break;case G:a=E*T,o=E*b,s=x*T,l=x*b,f[0]=a-l*y,f[4]=-g*b,f[8]=s+o*y,f[1]=o+s*y,f[5]=g*T,f[9]=l-a*y,f[2]=-g*x,f[6]=y,f[10]=g*E;break;case W:t=g*T,r=g*b,n=y*T,i=y*b,f[0]=E*T,f[4]=n*x-r,f[8]=t*x+i,f[1]=E*b,f[5]=i*x+t,f[9]=r*x-n,f[2]=-x,f[6]=y*E,f[10]=g*E;break;case B:c=g*E,u=g*x,h=y*E,d=y*x,f[0]=E*T,f[4]=d-c*b,f[8]=h*b+u,f[1]=b,f[5]=g*T,f[9]=-y*T,f[2]=-x*T,f[6]=u*b+h,f[10]=c-d*b;break;case V:c=g*E,u=g*x,h=y*E,d=y*x,f[0]=E*T,f[4]=-b,f[8]=x*T,f[1]=c*b+d,f[5]=g*T,f[9]=u*b-h,f[2]=h*b-u,f[6]=y*T,f[10]=d*b+c}return f[3]=0,f[7]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(re.set(0,0,0),e,ne.set(1,1,1))}},{key:"lookAt",value:function(e,t,r){var n=this.elements,i=re,a=ne,o=ie;return o.subVectors(e,t),0===o.lengthSquared()&&(o.z=1),o.normalize(),i.crossVectors(r,o),0===i.lengthSquared()&&(1===w(r.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),i.crossVectors(r,o)),i.normalize(),a.crossVectors(o,i),n[0]=i.x,n[4]=a.x,n[8]=o.x,n[1]=i.y,n[5]=a.y,n[9]=o.y,n[2]=i.z,n[6]=a.z,n[10]=o.z,this}},{key:"multiplyMatrices",value:function(e,t){var r=this.elements,n=e.elements,i=t.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],v=n[14],g=n[3],y=n[7],E=n[11],x=n[15],T=i[0],b=i[4],w=i[8],_=i[12],R=i[1],M=i[5],S=i[9],A=i[13],L=i[2],P=i[6],C=i[10],H=i[14],I=i[3],k=i[7],N=i[11],O=i[15];return r[0]=a*T+o*R+s*L+l*I,r[4]=a*b+o*M+s*P+l*k,r[8]=a*w+o*S+s*C+l*N,r[12]=a*_+o*A+s*H+l*O,r[1]=c*T+u*R+h*L+d*I,r[5]=c*b+u*M+h*P+d*k,r[9]=c*w+u*S+h*C+d*N,r[13]=c*_+u*A+h*H+d*O,r[2]=f*T+p*R+m*L+v*I,r[6]=f*b+p*M+m*P+v*k,r[10]=f*w+p*S+m*C+v*N,r[14]=f*_+p*A+m*H+v*O,r[3]=g*T+y*R+E*L+x*I,r[7]=g*b+y*M+E*P+x*k,r[11]=g*w+y*S+E*C+x*N,r[15]=g*_+y*A+E*H+x*O,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],f=t*o,p=t*s,m=t*l,v=r*a,g=r*s,y=r*l,E=n*a,x=n*o,T=n*l,b=i*a,w=i*o,_=i*s;return e[3]*(_*u-T*u-w*h+y*h+x*d-g*d)+e[7]*(p*d-m*h+b*h-E*d+T*c-_*c)+e[11]*(m*u-f*d-b*u+v*d+w*c-y*c)+e[15]*(-x*c-p*u+f*h+E*u-v*h+g*c)}},{key:"getInverse",value:function(e){var t,r=this.elements,n=e.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],f=n[9],p=n[10],m=n[11],v=n[12],g=n[13],y=n[14],E=n[15],x=f*y*h-g*p*h+g*u*m-c*y*m-f*u*E+c*p*E,T=v*p*h-d*y*h-v*u*m+l*y*m+d*u*E-l*p*E,b=d*g*h-v*f*h+v*c*m-l*g*m-d*c*E+l*f*E,w=v*f*u-d*g*u-v*c*p+l*g*p+d*c*y-l*f*y,_=i*x+a*T+o*b+s*w;return 0==_?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(t=1/_,r[0]=x*t,r[1]=(g*p*s-f*y*s-g*o*m+a*y*m+f*o*E-a*p*E)*t,r[2]=(c*y*s-g*u*s+g*o*h-a*y*h-c*o*E+a*u*E)*t,r[3]=(f*u*s-c*p*s-f*o*h+a*p*h+c*o*m-a*u*m)*t,r[4]=T*t,r[5]=(d*y*s-v*p*s+v*o*m-i*y*m-d*o*E+i*p*E)*t,r[6]=(v*u*s-l*y*s-v*o*h+i*y*h+l*o*E-i*u*E)*t,r[7]=(l*p*s-d*u*s+d*o*h-i*p*h-l*o*m+i*u*m)*t,r[8]=b*t,r[9]=(v*f*s-d*g*s-v*a*m+i*g*m+d*a*E-i*f*E)*t,r[10]=(l*g*s-v*c*s+v*a*h-i*g*h-l*a*E+i*c*E)*t,r[11]=(d*c*s-l*f*s-d*a*h+i*f*h+l*a*m-i*c*m)*t,r[12]=w*t,r[13]=(d*g*o-v*f*o+v*a*p-i*g*p-d*a*y+i*f*y)*t,r[14]=(v*c*o-l*g*o-v*a*u+i*g*u+l*a*y-i*c*y)*t,r[15]=(l*f*o-d*c*o+d*a*u-i*f*u-l*a*p+i*c*p)*t),this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"scale",value:function(e,t,r){var n=this.elements;return n[0]*=e,n[4]*=t,n[8]*=r,n[1]*=e,n[5]*=t,n[9]*=r,n[2]*=e,n[6]*=t,n[10]*=r,n[3]*=e,n[7]*=t,n[11]*=r,this}},{key:"makeScale",value:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}},{key:"makeTranslation",value:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=A(e),r=L(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=A(e),r=L(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=A(e),r=L(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var r=A(t),n=L(t),i=1-r,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,c*o+r,c*s-n*a,0,l*s-n*o,c*s+n*a,i*s*s+r,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,r){var n=this.elements,i=t.x,a=t.y,o=t.z,s=t.w,l=i+i,c=a+a,u=o+o,h=i*l,d=i*c,f=i*u,p=a*c,m=a*u,v=o*u,g=s*l,y=s*c,E=s*u,x=r.x,T=r.y,b=r.z;return n[0]=(1-(p+v))*x,n[1]=(d+E)*x,n[2]=(f-y)*x,n[3]=0,n[4]=(d-E)*T,n[5]=(1-(h+v))*T,n[6]=(m+g)*T,n[7]=0,n[8]=(f+y)*b,n[9]=(m-g)*b,n[10]=(1-(h+p))*b,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}},{key:"decompose",value:function(e,t,r){var n=this.elements,i=n[0],a=n[1],o=n[2],s=n[4],l=n[5],c=n[6],u=n[8],h=n[9],d=n[10],f=this.determinant(),p=re.set(i,a,o).length()*(0>f?-1:1),m=re.set(s,l,c).length(),v=re.set(u,h,d).length(),g=1/p,y=1/m,E=1/v;return e.x=n[12],e.y=n[13],e.z=n[14],n[0]*=g,n[1]*=g,n[2]*=g,n[4]*=y,n[5]*=y,n[6]*=y,n[8]*=E,n[9]*=E,n[10]*=E,t.setFromRotationMatrix(this),n[0]=i,n[1]=a,n[2]=o,n[4]=s,n[5]=l,n[6]=c,n[8]=u,n[9]=h,n[10]=d,r.x=p,r.y=m,r.z=v,this}},{key:"makePerspective",value:function(e,t,r,n,i,a){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(a+i)/(a-i),o[14]=-2*a*i/(a-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,r,n,i,a){var o=this.elements,s=1/(t-e),l=1/(r-n),c=1/(a-i);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-(t+e)*s,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-(r+n)*l,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-(a+i)*c,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){var t,r=this.elements,n=e.elements,i=!0;for(t=0;i&&16>t;++t)r[t]!==n[t]&&(i=!1);return i}}])}(),[new P,new P,new P,new P]),oe=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;t(this,e),this.origin=r,this.direction=n}return n(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,ae[0])),this}},{key:"closestPointToPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,r=t.subVectors(e,this.origin).dot(this.direction);return 0<=r?t.copy(this.direction).multiplyScalar(r).add(this.origin):t.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(e){var t=ae[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):ae[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:"distanceToPoint",value:function(e){return S(this.distanceSquaredToPoint(e))}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction),r=0===t?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/t;return 0<=r?r:null}},{key:"distanceSquaredToSegment",value:function(e,t,r,n){var i,a,o,s,l,c=ae[0].copy(e).add(t).multiplyScalar(.5),u=ae[1].copy(t).sub(e).normalize(),h=ae[2].copy(this.origin).sub(c),d=.5*e.distanceTo(t),f=-this.direction.dot(u),p=h.dot(this.direction),m=-h.dot(u),v=h.lengthSq(),g=w(1-f*f);return 0<g?(a=f*p-m,o=d*g,0<=(i=f*m-p)?a>=-o?a<=o?l=(i*=s=1/g)*(i+f*(a*=s)+2*p)+a*(f*i+a+2*m)+v:l=-(i=M(0,-(f*(a=d)+p)))*i+a*(a+2*m)+v:l=-(i=M(0,-(f*(a=-d)+p)))*i+a*(a+2*m)+v:a<=-o?l=-(i=M(0,-(-f*d+p)))*i+(a=0<i?-d:R(M(-d,-m),d))*(a+2*m)+v:a<=o?(i=0,l=(a=R(M(-d,-m),d))*(a+2*m)+v):l=-(i=M(0,-(f*d+p)))*i+(a=0<i?d:R(M(-d,-m),d))*(a+2*m)+v):l=-(i=M(0,-(f*(a=0<f?-d:d)+p)))*i+a*(a+2*m)+v,void 0!==r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),void 0!==n&&n.copy(u).multiplyScalar(a).add(c),l}},{key:"intersectSphere",value:function(e){var t,r,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,a=ae[0].subVectors(e.center,this.origin),o=a.dot(this.direction),s=a.dot(a)-o*o,l=e.radius*e.radius,c=null;return s<=l&&(n=o+(t=S(l-s)),(0<=(r=o-t)||0<=n)&&(c=0>r?this.at(n,i):this.at(r,i))),c}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"intersectPlane",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:"intersectBox",value:function(e){var t,r,n,i,a,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P,l=this.origin,c=this.direction,u=e.min,h=e.max,d=1/c.x,f=1/c.y,p=1/c.z,m=null;return 0<=d?(t=(u.x-l.x)*d,r=(h.x-l.x)*d):(t=(h.x-l.x)*d,r=(u.x-l.x)*d),0<=f?(n=(u.y-l.y)*f,i=(h.y-l.y)*f):(n=(h.y-l.y)*f,i=(u.y-l.y)*f),t<=i&&n<=r&&((n>t||t!=t)&&(t=n),(i<r||r!=r)&&(r=i),0<=p?(a=(u.z-l.z)*p,o=(h.z-l.z)*p):(a=(h.z-l.z)*p,o=(u.z-l.z)*p),t<=o&&a<=r&&((a>t||t!=t)&&(t=a),(o<r||r!=r)&&(r=o),0<=r&&(m=this.at(0<=t?t:r,s)))),m}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,ae[0])}},{key:"intersectTriangle",value:function(e,t,r,n,i){var a,o,s,l,c,u=this.direction,h=ae[0],d=ae[1],f=ae[2],p=ae[3],m=null;return d.subVectors(t,e),f.subVectors(r,e),p.crossVectors(d,f),0===(a=u.dot(p))||n&&0<a||(0<a?o=1:(o=-1,a=-a),h.subVectors(this.origin,e),0<=(s=o*u.dot(f.crossVectors(h,f)))&&(0<=(l=o*u.dot(d.cross(h)))&&s+l<=a&&(0<=(c=-o*h.dot(p))&&(m=this.at(c/a,i))))),m}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),se=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=r,this.phi=n,this.theta=i}n(e,[{key:"set",value:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeSafe",value:function(){return this.phi=M(1e-6,R(y-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,r){return this.radius=S(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=E(e,r),this.phi=_(R(M(t/this.radius,-1),1))),this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}n(e,[{key:"set",value:function(e,t,r,n,i,a){var o=this.elements;return o[0]=e,o[1]=t,o[3]=n,o[2]=r,o[4]=i,o[5]=a,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:"add",value:function(e){var t=this.elements,r=e.elements;return t[0]+=r[0],t[1]+=r[1],t[3]+=r[3],t[2]+=r[2],t[4]+=r[4],t[5]+=r[5],this}},{key:"norm",value:function(){var e=this.elements,t=e[1]*e[1],r=e[2]*e[2],n=e[4]*e[4];return S(e[0]*e[0]+t+r+t+e[3]*e[3]+n+r+n+e[5]*e[5])}},{key:"off",value:function(){var e=this.elements;return S(2*(e[1]*e[1]+e[2]*e[2]+e[4]*e[4]))}},{key:"applyToVector3",value:function(e){var t=e.x,r=e.y,n=e.z,i=this.elements;return e.x=i[0]*t+i[1]*r+i[2]*n,e.y=i[1]*t+i[3]*r+i[4]*n,e.z=i[2]*t+i[4]*r+i[5]*n,e}},{key:"equals",value:function(e){var t,r=this.elements,n=e.elements,i=!0;for(t=0;i&&6>t;++t)r[t]!==n[t]&&(i=!1);return i}}],[{key:"calculateIndex",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}])}(),function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=r,this.y=n,this.z=i,this.w=a}n(e,[{key:"set",value:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*_(e.w);var t=S(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,r,n,i,a,o,s,l,c,u,h,d=.01,f=e.elements,p=f[0],m=f[4],v=f[8],g=f[1],E=f[5],x=f[9],T=f[2],b=f[6],R=f[10];return w(m-g)<d&&w(v-T)<d&&w(x-b)<d?w(m+g)<.1&&w(v+T)<.1&&w(x+b)<.1&&w(p+E+R-3)<.1?this.set(1,0,0,0):(t=y,s=(R+1)/2,l=(m+g)/4,c=(v+T)/4,u=(x+b)/4,(a=(p+1)/2)>(o=(E+1)/2)&&a>s?a<d?(r=0,n=.707106781,i=.707106781):(n=l/(r=S(a)),i=c/r):o>s?o<d?(r=.707106781,n=0,i=.707106781):(r=l/(n=S(o)),i=u/n):s<d?(r=.707106781,n=.707106781,i=0):(r=c/(i=S(s)),n=u/i),this.set(r,n,i,t)):(h=S((b-x)*(b-x)+(v-T)*(v-T)+(g-m)*(g-m)),.001>w(h)&&(h=1),this.x=(b-x)/h,this.y=(v-T)/h,this.z=(g-m)/h,this.w=_((p+E+R-1)/2)),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"manhattanLength",value:function(){return w(this.x)+w(this.y)+w(this.z)+w(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return S(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(e){return w(this.x-e.x)+w(this.y-e.y)+w(this.z-e.z)+w(this.w-e.w)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z,i=this.w-e.w;return t*t+r*r+n*n+i*i}},{key:"distanceTo",value:function(e){return S(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=R(this.x,e.x),this.y=R(this.y,e.y),this.z=R(this.z,e.z),this.w=R(this.w,e.w),this}},{key:"max",value:function(e){return this.x=M(this.x,e.x),this.y=M(this.y,e.y),this.z=M(this.z,e.z),this.w=M(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=M(e.x,R(t.x,this.x)),this.y=M(e.y,R(t.y,this.y)),this.z=M(e.z,R(t.z,this.z)),this.w=M(e.w,R(t.w,this.w)),this}},{key:"floor",value:function(){return this.x=b(this.x),this.y=b(this.y),this.z=b(this.z),this.w=b(this.w),this}},{key:"ceil",value:function(){return this.x=T(this.x),this.y=T(this.y),this.z=T(this.z),this.w=T(this.w),this}},{key:"round",value:function(){return this.x=x(this.x),this.y=x(this.y),this.z=x(this.z),this.w=x(this.w),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}])}(),new P),le=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new P;t(this,e),this.min=r,this.max=n,this.children=null}return n(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.subVectors(this.max,this.min)}},{key:"split",value:function(){var e,t,r=this.min,n=this.max,i=this.getCenter(se),a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=ce[e],a[e]=new this.constructor(new P(0===t[0]?r.x:i.x,0===t[1]?r.y:i.y,0===t[2]?r.z:i.z),new P(0===t[0]?i.x:n.x,0===t[1]?i.y:n.y,0===t[2]?i.z:n.z))}}]),e}(),ce=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],ue=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],he=new P,de=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.min=r,this.size=n,this.children=null}return n(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new P;return e.set(this.size,this.size,this.size)}},{key:"split",value:function(){var e,t,r=this.min,n=this.getCenter(he),i=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=ce[e],a[e]=new this.constructor(new P(0===t[0]?r.x:n.x,0===t[1]?r.y:n.y,0===t[2]?r.z:n.z),i)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),fe=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];t(this,e),this.value=r,this.done=n}return n(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),pe=new I,me=function(){function e(r){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;t(this,e),this.octree=r,this.region=n,this.cull=null!==n,this.result=new fe,this.trace=null,this.indices=null,this.reset()}return n(e,[{key:"reset",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(pe.min=e.min,pe.max=e.max,(!this.cull||this.region.intersectsBox(pe))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var e,t,r,n=this.cull,i=this.region,a=this.indices,o=this.trace,s=null,l=o.length-1;null===s&&0<=l;)if(e=a[l]++,t=o[l].children,8>e)if(null!==t){if(r=t[e],n&&(pe.min=r.min,pe.max=r.max,!i.intersectsBox(pe)))continue;o.push(r),a.push(0),++l}else s=o.pop(),a.pop();else o.pop(),a.pop(),--l;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),ve=[new P,new P,new P],ge=new I,ye=new oe,Ee=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],xe=0,Te=function(){function e(){t(this,e)}return n(e,null,[{key:"intersectOctree",value:function(e,t,r){var n,i,a,o,s,l,c,u,h,f=ge.min.set(0,0,0),p=ge.max.subVectors(e.max,e.min),m=e.getDimensions(ve[0]),v=ve[1].copy(m).multiplyScalar(.5),g=ye.origin.copy(t.ray.origin),y=ye.direction.copy(t.ray.direction);g.sub(e.getCenter(ve[2])).add(v),xe=0,0>y.x&&(g.x=m.x-g.x,y.x=-y.x,xe|=4),0>y.y&&(g.y=m.y-g.y,y.y=-y.y,xe|=2),0>y.z&&(g.z=m.z-g.z,y.z=-y.z,xe|=1),n=1/y.x,i=1/y.y,a=1/y.z,o=(f.x-g.x)*n,s=(p.x-g.x)*n,l=(f.y-g.y)*i,c=(p.y-g.y)*i,u=(f.z-g.z)*a,h=(p.z-g.z)*a,M(M(o,l),u)<R(R(s,c),h)&&function e(t,r,n,i,a,o,s,l,c){var u,h,f,p,m=t.children;if(0<=a&&0<=o&&0<=s)if(null===m)c.push(t);else{u=function(e,t,r,n,i,a){var o=0;return e>t&&e>r?(i<e&&(o|=2),a<e&&(o|=1)):t>r?(n<t&&(o|=4),a<t&&(o|=1)):(n<r&&(o|=4),i<r&&(o|=2)),o}(r,n,i,h=.5*(r+a),f=.5*(n+o),p=.5*(i+s));do{0===u?(e(m[xe],r,n,i,h,f,p,l,c),u=d(u,h,f,p)):1===u?(e(m[1^xe],r,n,p,h,f,s,l,c),u=d(u,h,f,s)):2===u?(e(m[2^xe],r,f,i,h,o,p,l,c),u=d(u,h,o,p)):3===u?(e(m[3^xe],r,f,p,h,o,s,l,c),u=d(u,h,o,s)):4===u?(e(m[4^xe],h,n,i,a,f,p,l,c),u=d(u,a,f,p)):5===u?(e(m[5^xe],h,n,p,a,f,s,l,c),u=d(u,a,f,s)):6===u?(e(m[6^xe],h,f,i,a,o,p,l,c),u=d(u,a,o,p)):7===u&&(e(m[7^xe],h,f,p,a,o,s,l,c),u=8)}while(8>u)}}(e.root,o,l,u,s,c,h,t,r)}}]),e}(),be=new I,we=function(){function e(r,n){t(this,e),this.root=void 0!==r&&void 0!==n?new le(r,n):null}return n(e,[{key:"getCenter",value:function(e){return this.root.getCenter(e)}},{key:"getDimensions",value:function(e){return this.root.getDimensions(e)}},{key:"getDepth",value:function(){return function e(t){var r,n,i,a=t.children,o=0;if(null!==a)for(r=0,n=a.length;r<n;++r)(i=1+e(a[r]))>o&&(o=i);return o}(this.root)}},{key:"cull",value:function(e){var t=[];return function e(t,r,n){var i,a,o=t.children;if(be.min=t.min,be.max=t.max,r.intersectsBox(be))if(null!==o)for(i=0,a=o.length;i<a;++i)e(o[i],r,n);else n.push(t)}(this.root,e,t),t}},{key:"findOctantsByLevel",value:function(e){var t=[];return function e(t,r,n,i){var a,o,s=t.children;if(n===r)i.push(t);else if(null!==s)for(++n,a=0,o=s.length;a<o;++a)e(s[a],r,n,i)}(this.root,e,0,t),t}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Te.intersectOctree(this,e,t),t}},{key:"leaves",value:function(e){return new me(this,e)}},{key:Symbol.iterator,value:function(){return new me(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),_e=new P,Re=function(e){function r(e,n){var i;return t(this,r),(i=l(this,a(r).call(this,e,n))).points=null,i.data=null,i}return i(r,le),n(r,[{key:"distanceToSquared",value:function(e){return _e.copy(e).clamp(this.min,this.max).sub(e).lengthSquared()}},{key:"distanceToCenterSquared",value:function(e){var t=this.getCenter(_e),r=e.x-t.x,n=e.y-t.x,i=e.z-t.z;return r*r+n*n+i*i}},{key:"contains",value:function(e,t){var r=this.min,n=this.max;return e.x>=r.x-t&&e.y>=r.y-t&&e.z>=r.z-t&&e.x<=n.x+t&&e.y<=n.y+t&&e.z<=n.z+t}},{key:"redistribute",value:function(e){var t,r,n,i,a,o,s,l=this.children,c=this.points,u=this.data;if(null!==l&&null!==c)for(t=0,n=c.length;t<n;++t)for(o=c[t],s=u[t],r=0,i=l.length;r<i;++r)if((a=l[r]).contains(o,e)){null===a.points&&(a.points=[],a.data=[]),a.points.push(o),a.data.push(s);break}this.points=null,this.data=null}},{key:"merge",value:function(){var e,t,r,n=this.children;if(null!==n){for(this.points=[],this.data=[],e=0,t=n.length;e<t;++e)if(null!==(r=n[e]).points){var i,a;(i=this.points).push.apply(i,u(r.points)),(a=this.data).push.apply(a,u(r.data))}this.children=null}}}]),r}(),Me=function e(r,n,i){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;t(this,e),this.distance=r,this.distanceToRay=n,this.point=i,this.object=a},Se=1e-6,Ae=function(e){function r(e,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,c=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return t(this,r),(i=l(this,a(r).call(this))).root=new Re(e,n),i.bias=M(0,o),i.maxPoints=M(1,x(s)),i.maxDepth=M(0,x(c)),i.pointCount=0,i}return i(r,we),n(r,[{key:"countPoints",value:function(e){return f(e)}},{key:"put",value:function(e,t){return p(e,t,this,this.root,0)}},{key:"remove",value:function(e){return m(e,this,this.root,null)}},{key:"fetch",value:function(e){return function e(t,r,n){var i,a,o,s=n.children,l=null;if(n.contains(t,r.bias))if(null!==s)for(i=0,a=s.length;null===l&&i<a;++i)l=e(t,r,s[i]);else if(null!==n.points)for(i=0,a=(o=n.points).length;null===l&&i<a;++i)t.distanceToSquared(o[i])<=Se&&(l=n.data[i]);return l}(e,this,this.root)}},{key:"move",value:function(e,t){return function e(t,r,n,i,a,o){var s,l,c,u=i.children,h=null;if(i.contains(t,n.bias))if(i.contains(r,n.bias)){if(null!==u)for(++o,s=0,l=u.length;null===h&&s<l;++s)h=e(t,r,n,u[s],i,o);else if(null!==i.points)for(s=0,l=(c=i.points).length;s<l;++s)if(t.distanceToSquared(c[s])<=Se){c[s].copy(r),h=i.data[s];break}}else p(r,h=m(t,n,i,a),n,a,o-1);return h}(e,t,this,this.root,null,0)}},{key:"findNearestPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];return v(e,t,r,this.root)}},{key:"findPoints",value:function(e,t){var r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=[];return g(e,t,r,this.root,n),n}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=c(a(r.prototype),"raycast",this).call(this,e);return 0<n.length&&this.testPoints(n,e,t),t}},{key:"testPoints",value:function(e,t,r){var n,i,a,o,s,l,c,u,h,d,f,p=t.params.Points.threshold;for(s=0,c=e.length;s<c;++s)if(null!==(d=(h=e[s]).points))for(l=0,u=d.length;l<u;++l)f=d[l],(o=t.ray.distanceSqToPoint(f))<p*p&&(n=t.ray.closestPointToPoint(f,new P),(i=t.ray.origin.distanceTo(n))>=t.near&&i<=t.far&&(a=S(o),r.push(new Me(i,a,n,h.data[l]))))}}]),r}(),Le=new I,Pe=new P,Ce=new P,He=new P,Ie=function(){function e(){t(this,e)}return n(e,null,[{key:"recycleOctants",value:function(e,t){var r,n,i,a,o=e.min,s=e.getCenter(Ce),l=e.getDimensions(He).multiplyScalar(.5),c=e.children,u=t.length;for(r=0;8>r;++r)for(i=ce[r],Le.min.addVectors(o,Pe.fromArray(i).multiply(l)),Le.max.addVectors(s,Pe.fromArray(i).multiply(l)),n=0;n<u;++n)if(null!==(a=t[n])&&Le.min.equals(a.min)&&Le.max.equals(a.max)){c[r]=a,t[n]=null;break}}}]),e}();e.CubicOctant=de,e.edges=ue,e.Octant=le,e.Octree=we,e.OctantIterator=me,e.OctreeRaycaster=Te,e.pattern=ce,e.PointOctant=Re,e.PointOctree=Ae,e.RayPointIntersection=Me,e.OctreeUtils=Ie,Object.defineProperty(e,"__esModule",{value:!0})})},function(e,t,r){(function(t){var r;e.exports=function e(t,n,i){function a(s,l){if(!n[s]){if(!t[s]){var c="function"==typeof r&&r;if(!l&&c)return r(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var r=t[s][1][e];return a(r||e)},h,h.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){t.exports={version:"1.5.0"}},{}],2:[function(e,t,r){"use strict";var n=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};n.prototype.head=function(){return this.head_},n.prototype.setHead=function(e){this.head_=e},n.prototype.tail=function(){return this.tail_},n.prototype.setTail=function(e){this.tail_=e},n.prototype.search=function(){return this.search_node_},n.prototype.setSearch=function(e){this.search_node_=e},n.prototype.findSearchNode=function(){return this.search_node_},n.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},n.prototype.locatePoint=function(e){var t=e.x,r=this.findSearchNode(t),n=r.point.x;if(t===n){if(e!==r.point)if(e===r.prev.point)r=r.prev;else{if(e!==r.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");r=r.next}}else if(t<n)for(;(r=r.prev)&&e!==r.point;);else for(;(r=r.next)&&e!==r.point;);return r&&(this.search_node_=r),r},t.exports=n,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,r){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};i.prototype.toString=function(){return n.toStringBase(this)},i.prototype.toJSON=function(){return{x:this.x,y:this.y}},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.set_zero=function(){return this.x=0,this.y=0,this},i.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},i.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},i.prototype.mul=function(e){return this.x*=e,this.y*=e,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},i.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},i.negate=function(e){return new i(-e.x,-e.y)},i.add=function(e,t){return new i(e.x+t.x,e.y+t.y)},i.sub=function(e,t){return new i(e.x-t.x,e.y-t.y)},i.mul=function(e,t){return new i(e*t.x,e*t.y)},i.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new i(-e*t.y,e*t.x):"number"==typeof t?new i(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},i.toString=n.toString,i.compare=n.compare,i.cmp=n.compare,i.equals=n.equals,i.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=i},{"./xy":11}],5:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var r=0;r<t.length;r++)this.message+=" "+n.toString(t[r])};(i.prototype=new Error).constructor=i,t.exports=i},{"./xy":11}],6:[function(e,r,n){(function(t){"use strict";var r=t.poly2tri;n.noConflict=function(){return t.poly2tri=r,n},n.VERSION=e("../dist/version.json").version,n.PointError=e("./pointerror"),n.Point=e("./point"),n.Triangle=e("./triangle"),n.SweepContext=e("./sweepcontext");var i=e("./sweep");n.triangulate=i.triangulate,n.sweep={Triangulate:i.triangulate}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,r){"use strict";function n(e,t){var r=e.locateNode(t),n=function(e,t,r){var n=new E(t,r.point,r.next.point);n.markNeighbor(r.triangle),e.addToMap(n);var i=new x(t);return i.next=r.next,i.prev=r,r.next.prev=i,r.next=i,l(e,n)||e.mapTriangleToNodes(n),i}(e,t,r);return t.x<=r.point.x+b&&s(e,r),function(e,t){for(var r=t.next;r.next&&!M(r.point,r.next.point,r.prev.point);)s(e,r),r=r.next;for(r=t.prev;r.prev&&!M(r.point,r.next.point,r.prev.point);)s(e,r),r=r.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,r=e.point.y-e.next.next.point.y;return g(r>=0,"unordered y"),t>=0||Math.abs(t)<r}(t)&&function(e,t){for(_(t.point,t.next.point,t.next.next.point)===w.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,r){if(!function(e,t){var r;return r=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>r}(t,r)&&(s(t,r),r.prev!==t.basin.left_node||r.next!==t.basin.right_node)){if(r.prev===t.basin.left_node){if(_(r.point,r.next.point,r.next.next.point)===w.CW)return;r=r.next}else if(r.next===t.basin.right_node){if(_(r.point,r.prev.point,r.prev.prev.point)===w.CCW)return;r=r.prev}else r=r.prev.point.y<r.next.point.y?r.prev:r.next;e(t,r)}}(e,e.basin.bottom_node))}}(e,t)}(e,n),n}function i(e,t,r){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,o(r.triangle,t.p,t.q)||(function(e,t,r){e.edge_event.right?function(e,t,r){for(;r.next.point.x<t.p.x;)_(t.q,r.next.point,t.p)===w.CCW?h(e,t,r):r=r.next}(e,t,r):function(e,t,r){for(;r.prev.point.x>t.p.x;)_(t.q,r.prev.point,t.p)===w.CW?f(e,t,r):r=r.prev}(e,t,r)}(e,t,r),a(e,t.p,t.q,r.triangle,t.q))}function a(e,t,r,n,i){if(!o(n,t,r)){var s=n.pointCCW(i),l=_(r,s,t);if(l===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[r,s,t]);var c=n.pointCW(i),u=_(r,c,t);if(u===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[r,c,t]);l===u?(n=l===w.CW?n.neighborCCW(i):n.neighborCW(i),a(e,t,r,n,i)):m(e,t,r,n,i)}}function o(e,t,r){var n=e.edgeIndex(t,r);if(-1!==n){e.markConstrainedEdgeByIndex(n);var i=e.getNeighbor(n);return i&&i.markConstrainedEdgeByPoints(t,r),!0}return!1}function s(e,t){var r=new E(t.prev.point,t.point,t.next.point);r.markNeighbor(t.prev.triangle),r.markNeighbor(t.triangle),e.addToMap(r),t.prev.next=t.next,t.next.prev=t.prev,l(e,r)||e.mapTriangleToNodes(r)}function l(e,t){for(var r=0;r<3;++r)if(!t.delaunay_edge[r]){var n=t.getNeighbor(r);if(n){var i=t.getPoint(r),a=n.oppositePoint(t,i),o=n.index(a);if(n.constrained_edge[o]||n.delaunay_edge[o]){t.constrained_edge[r]=n.constrained_edge[o];continue}var s=c(i,t.pointCCW(i),t.pointCW(i),a);if(s){t.delaunay_edge[r]=!0,n.delaunay_edge[o]=!0,u(t,i,n,a);var h=!l(e,t);return h&&e.mapTriangleToNodes(t),(h=!l(e,n))&&e.mapTriangleToNodes(n),t.delaunay_edge[r]=!1,n.delaunay_edge[o]=!1,!0}}}return!1}function c(e,t,r,n){var i=e.x-n.x,a=e.y-n.y,o=t.x-n.x,s=t.y-n.y,l=i*s,c=o*a,u=l-c;if(u<=0)return!1;var h=r.x-n.x,d=r.y-n.y,f=h*a,p=i*d,m=f-p;return!(m<=0)&&(i*i+a*a)*(o*d-h*s)+(o*o+s*s)*m+(h*h+d*d)*u>0}function u(e,t,r,n){var i,a,o,s,l,c,u,h,d,f,p,m;i=e.neighborCCW(t),a=e.neighborCW(t),o=r.neighborCCW(n),s=r.neighborCW(n),l=e.getConstrainedEdgeCCW(t),c=e.getConstrainedEdgeCW(t),u=r.getConstrainedEdgeCCW(n),h=r.getConstrainedEdgeCW(n),d=e.getDelaunayEdgeCCW(t),f=e.getDelaunayEdgeCW(t),p=r.getDelaunayEdgeCCW(n),m=r.getDelaunayEdgeCW(n),e.legalize(t,n),r.legalize(n,t),r.setDelaunayEdgeCCW(t,d),e.setDelaunayEdgeCW(t,f),e.setDelaunayEdgeCCW(n,p),r.setDelaunayEdgeCW(n,m),r.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,c),e.setConstrainedEdgeCCW(n,u),r.setConstrainedEdgeCW(n,h),e.clearNeighbors(),r.clearNeighbors(),i&&r.markNeighbor(i),a&&e.markNeighbor(a),o&&e.markNeighbor(o),s&&r.markNeighbor(s),e.markNeighbor(r)}function h(e,t,r){r.point.x<t.p.x&&(_(r.point,r.next.point,r.next.next.point)===w.CCW?d(e,t,r):(function e(t,r,n){_(n.next.point,n.next.next.point,n.next.next.next.point)===w.CCW?d(t,r,n.next):_(r.q,n.next.next.point,r.p)===w.CCW&&e(t,r,n.next)}(e,t,r),h(e,t,r)))}function d(e,t,r){s(e,r.next),r.next.point!==t.p&&_(t.q,r.next.point,t.p)===w.CCW&&_(r.point,r.next.point,r.next.next.point)===w.CCW&&d(e,t,r)}function f(e,t,r){r.point.x>t.p.x&&(_(r.point,r.prev.point,r.prev.prev.point)===w.CW?p(e,t,r):(function e(t,r,n){_(n.prev.point,n.prev.prev.point,n.prev.prev.prev.point)===w.CW?p(t,r,n.prev):_(r.q,n.prev.prev.point,r.p)===w.CW&&e(t,r,n.prev)}(e,t,r),f(e,t,r)))}function p(e,t,r){s(e,r.prev),r.prev.point!==t.p&&_(t.q,r.prev.point,t.p)===w.CW&&_(r.point,r.prev.point,r.prev.prev.point)===w.CW&&p(e,t,r)}function m(e,t,r,n,i){var o=n.neighborAcross(i);g(o,"FLIP failed due to missing triangle!");var s=o.oppositePoint(n,i);if(n.getConstrainedEdgeAcross(i)){var c=n.index(i);throw new y("poly2tri Intersecting Constraints",[i,s,n.getPoint((c+1)%3),n.getPoint((c+2)%3)])}if(R(i,n.pointCCW(i),n.pointCW(i),s))if(u(n,i,o,s),e.mapTriangleToNodes(n),e.mapTriangleToNodes(o),i===r&&s===t)r===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(n.markConstrainedEdgeByPoints(t,r),o.markConstrainedEdgeByPoints(t,r),l(e,n),l(e,o));else{var h=_(r,s,t);n=function(e,t,r,n,i,a){var o;return t===w.CCW?(o=n.edgeIndex(i,a),n.delaunay_edge[o]=!0,l(e,n),n.clearDelaunayEdges(),r):(o=r.edgeIndex(i,a),r.delaunay_edge[o]=!0,l(e,r),r.clearDelaunayEdges(),n)}(e,h,n,o,i,s),m(e,t,r,n,i)}else(function e(t,r,n,i,a,o){var s=a.neighborAcross(o);g(s,"FLIP failed due to missing triangle");var l=s.oppositePoint(a,o);R(n,i.pointCCW(n),i.pointCW(n),l)?m(t,n,l,s,l):e(t,r,n,i,s,v(r,n,s,l))})(e,t,r,n,o,v(t,r,o,s)),a(e,t,r,n,i)}function v(e,t,r,n){var i=_(t,n,e);if(i===w.CW)return r.pointCCW(n);if(i===w.CCW)return r.pointCW(n);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,n,e])}var g=e("./assert"),y=e("./pointerror"),E=e("./triangle"),x=e("./advancingfront").Node,T=e("./utils"),b=T.EPSILON,w=T.Orientation,_=T.orient2d,R=T.inScanArea,M=T.isAngleObtuse;r.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,r=e.pointCount();for(t=1;t<r;++t)for(var a=e.getPoint(t),o=n(e,a),s=a._p2t_edge_list,l=0;s&&l<s.length;++l)i(e,s[l],o)}(e),function(e){for(var t=e.front().head().next.triangle,r=e.front().head().next.point;!t.getConstrainedEdgeCW(r);)t=t.neighborCCW(r);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,r){"use strict";var n=e("./pointerror"),i=e("./point"),a=e("./triangle"),o=e("./sweep"),s=e("./advancingfront"),l=s.Node,c=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new n("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},u=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};u.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},d=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new u,this.edge_event=new h,this.initEdges(this.points_)};d.prototype.addHole=function(e){this.initEdges(e);var t,r=e.length;for(t=0;t<r;t++)this.points_.push(e[t]);return this},d.prototype.AddHole=d.prototype.addHole,d.prototype.addHoles=function(e){var t,r=e.length;for(t=0;t<r;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},d.prototype.addPoint=function(e){return this.points_.push(e),this},d.prototype.AddPoint=d.prototype.addPoint,d.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},d.prototype.triangulate=function(){return o.triangulate(this),this},d.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},d.prototype.getTriangles=function(){return this.triangles_},d.prototype.GetTriangles=d.prototype.getTriangles,d.prototype.front=function(){return this.front_},d.prototype.pointCount=function(){return this.points_.length},d.prototype.head=function(){return this.head_},d.prototype.setHead=function(e){this.head_=e},d.prototype.tail=function(){return this.tail_},d.prototype.setTail=function(e){this.tail_=e},d.prototype.getMap=function(){return this.map_},d.prototype.initTriangulation=function(){var e,t=this.points_[0].x,r=this.points_[0].x,n=this.points_[0].y,a=this.points_[0].y,o=this.points_.length;for(e=1;e<o;e++){var s=this.points_[e];s.x>t&&(t=s.x),s.x<r&&(r=s.x),s.y>n&&(n=s.y),s.y<a&&(a=s.y)}this.pmin_=new i(r,a),this.pmax_=new i(t,n);var l=.3*(t-r),c=.3*(n-a);this.head_=new i(t+l,a-c),this.tail_=new i(r-l,a-c),this.points_.sort(i.compare)},d.prototype.initEdges=function(e){var t,r=e.length;for(t=0;t<r;++t)this.edge_list.push(new c(e[t],e[(t+1)%r]))},d.prototype.getPoint=function(e){return this.points_[e]},d.prototype.addToMap=function(e){this.map_.push(e)},d.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},d.prototype.createAdvancingFront=function(){var e,t,r,n=new a(this.points_[0],this.tail_,this.head_);this.map_.push(n),e=new l(n.getPoint(1),n),t=new l(n.getPoint(0),n),r=new l(n.getPoint(2)),this.front_=new s(e,r),e.next=t,t.next=r,t.prev=e,r.prev=t},d.prototype.removeNode=function(e){},d.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var r=this.front_.locatePoint(e.pointCW(e.getPoint(t)));r&&(r.triangle=e)}},d.prototype.removeFromMap=function(e){var t,r=this.map_,n=r.length;for(t=0;t<n;t++)if(r[t]===e){r.splice(t,1);break}},d.prototype.meshClean=function(e){for(var t,r,n=[e];t=n.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),r=0;r<3;r++)t.constrained_edge[r]||n.push(t.getNeighbor(r))},t.exports=d},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t,r){this.points_=[e,t,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},a=n.toString;i.prototype.toString=function(){return"["+a(this.points_[0])+a(this.points_[1])+a(this.points_[2])+"]"},i.prototype.getPoint=function(e){return this.points_[e]},i.prototype.GetPoint=i.prototype.getPoint,i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(e){return this.neighbors_[e]},i.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},i.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},i.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(e){return this.interior_=e,this},i.prototype.markNeighborPointers=function(e,t,r){var n=this.points_;if(e===n[2]&&t===n[1]||e===n[1]&&t===n[2])this.neighbors_[0]=r;else if(e===n[0]&&t===n[2]||e===n[2]&&t===n[0])this.neighbors_[1]=r;else{if(!(e===n[0]&&t===n[1]||e===n[1]&&t===n[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=r}},i.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},i.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},i.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},i.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},i.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},i.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},i.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(e,t){var r=e.pointCW(t);return this.pointCW(r)},i.prototype.legalize=function(e,t){var r=this.points_;if(e===r[0])r[1]=r[0],r[0]=r[2],r[2]=t;else if(e===r[1])r[2]=r[1],r[1]=r[0],r[0]=t;else{if(e!==r[2])throw new Error("poly2tri Invalid Triangle.legalize() call");r[0]=r[2],r[2]=r[1],r[1]=t}},i.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(e,t){var r=this.points_;if(e===r[0]){if(t===r[1])return 2;if(t===r[2])return 1}else if(e===r[1]){if(t===r[2])return 0;if(t===r[0])return 2}else if(e===r[2]){if(t===r[0])return 1;if(t===r[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},i.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},i.prototype.markConstrainedEdgeByPoints=function(e,t){var r=this.points_;t===r[0]&&e===r[1]||t===r[1]&&e===r[0]?this.constrained_edge[2]=!0:t===r[0]&&e===r[2]||t===r[2]&&e===r[0]?this.constrained_edge[1]=!0:(t===r[1]&&e===r[2]||t===r[2]&&e===r[1])&&(this.constrained_edge[0]=!0)},t.exports=i},{"./xy":11}],10:[function(e,t,r){"use strict";var n=1e-12;r.EPSILON=n;var i={CW:1,CCW:-1,COLLINEAR:0};r.Orientation=i,r.orient2d=function(e,t,r){var a=(e.x-r.x)*(t.y-r.y),o=(e.y-r.y)*(t.x-r.x),s=a-o;return s>-n&&s<n?i.COLLINEAR:s>0?i.CCW:i.CW},r.inScanArea=function(e,t,r,i){return!((e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)>=-n||(e.x-r.x)*(i.y-r.y)-(i.x-r.x)*(e.y-r.y)<=n)},r.isAngleObtuse=function(e,t,r){var n=t.x-e.x,i=t.y-e.y;return n*(r.x-e.x)+i*(r.y-e.y)<0}},{}],11:[function(e,t,r){"use strict";function n(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?n(e):t},toStringBase:n,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)}).call(this,r(3))},function(e,t,r){var n;!function(i){function a(e,t,r,n,i){this._listener=t,this._isOnce=r,this.context=n,this._signal=e,this._priority=i||0}function o(e,t){if("function"!=typeof e)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function s(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){s.prototype.dispatch.apply(e,arguments)}}a.prototype={active:!0,params:null,execute:function(e){var t;return this.active&&this._listener&&(e=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,e),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},s.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,n){var i=this._indexOfListener(e,r);if(-1!==i){if((e=this._bindings[i]).isOnce()!==t)throw Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else e=new a(this,e,t,r,n),this._addBinding(e);return this.memorize&&this._prevParams&&e.execute(this._prevParams),e},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var r,n=this._bindings.length;n--;)if((r=this._bindings[n])._listener===e&&r.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,r){return o(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return o(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){o(e,"remove");var r=this._indexOfListener(e,t);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,r=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=r),n){t=this._bindings.slice(),this._shouldPropagate=!0;do{n--}while(t[n]&&this._shouldPropagate&&!1!==t[n].execute(r))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var l=s;l.Signal=s,void 0===(n=function(){return l}.call(t,r,t,e))||(e.exports=n)}()},function(e,t,r){var n=function(){function e(e){return i.appendChild(e.dom),e}function t(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),t(++r%i.children.length)},!1);var a=(performance||Date).now(),o=a,s=0,l=e(new n.Panel("FPS","#0ff","#002")),c=e(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=e(new n.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:i,addPanel:e,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-a,200),e>o+1e3&&(l.update(1e3*s/(e-o),100),o=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:i,setMode:t}};n.Panel=function(e,t,r){var n=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,l=48*o,c=3*o,u=2*o,h=3*o,d=15*o,f=74*o,p=30*o,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=r,v.fillRect(0,0,s,l),v.fillStyle=t,v.fillText(e,c,u),v.fillRect(h,d,f,p),v.fillStyle=r,v.globalAlpha=.9,v.fillRect(h,d,f,p),{dom:m,update:function(l,g){n=Math.min(n,l),i=Math.max(i,l),v.fillStyle=r,v.globalAlpha=1,v.fillRect(0,0,s,d),v.fillStyle=t,v.fillText(a(l)+" "+e+" ("+a(n)+"-"+a(i)+")",c,u),v.drawImage(m,h+o,d,f-o,p,h,d,f-o,p),v.fillRect(h+f-o,d,o,p),v.fillStyle=r,v.globalAlpha=.9,v.fillRect(h+f-o,d,o,a((1-l/g)*p))}}},e.exports=n},function(e,t,r){(function(r){var n;
/*!
 *  howler.js v2.0.8
 *  howlerjs.com
 *
 *  (c) 2013-2018, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
/*!
 *  howler.js v2.0.8
 *  howlerjs.com
 *
 *  (c) 2013-2018, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||a;return e._counter=1e3,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var t=this||a;if(e=parseFloat(e),t.ctx||f(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,a.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||a;t.ctx||f(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,a.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},unload:function(){for(var e=this||a,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,f()),e},codecs:function(e){return(this||a)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||a;if(e.state=e.ctx&&e.ctx.state||"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||a,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var r=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=n&&parseInt(n[0].split("/")[1],10)<33;return e._codecs={mp3:!(i||!r&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||a,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),r=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||r)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function(){a._autoResume();var t=e.ctx.createBufferSource();t.buffer=e._scratchBuffer,t.connect(e.ctx.destination),void 0===t.start?t.noteOn(0):t.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),t.onended=function(){t.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0)}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&a.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var r=0;r<e._howls[t]._sounds.length;r++)if(!e._howls[t]._sounds[r]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&a.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then(function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var a=new i,o=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(e){var t=this;return a.ctx||f(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhrWithCredentials=e.xhrWithCredentials||!1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onresume=[],t._webAudio=a.usingWebAudio&&!t._html5,void 0!==a.ctx&&a.ctx&&a.mobileAutoEnable&&a._enableMobileAudio(),a._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&t.load(),t},load:function(){var e=null;if(a.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var t=0;t<this._src.length;t++){var r,n;if(this._format&&this._format[t])r=this._format[t];else{if("string"!=typeof(n=this._src[t])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(n))||(r=/\.([^.]+)$/.exec(n.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&a.codecs(r)){e=this._src[t];break}}if(e)return this._src=e,this._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new s(this),this._webAudio&&c(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var r=this,n=null;if("number"==typeof e)n=e,e=null;else{if("string"==typeof e&&"loaded"===r._state&&!r._sprite[e])return null;if(void 0===e){e="__default";for(var i=0,o=0;o<r._sounds.length;o++)r._sounds[o]._paused&&!r._sounds[o]._ended&&(i++,n=r._sounds[o]._id);1===i?e=null:n=null}}var s=n?r._soundById(n):r._inactiveSound();if(!s)return null;if(n&&!e&&(e=s._sprite||"__default"),"loaded"!==r._state){s._sprite=e,s._ended=!1;var l=s._id;return r._queue.push({event:"play",action:function(){r.play(l)}}),l}if(n&&!s._paused)return t||setTimeout(function(){r._emit("play",s._id)},0),s._id;r._webAudio&&a._autoResume();var c=Math.max(0,s._seek>0?s._seek:r._sprite[e][0]/1e3),u=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-c),h=1e3*u/Math.abs(s._rate);s._paused=!1,s._ended=!1,s._sprite=e,s._seek=c,s._start=r._sprite[e][0]/1e3,s._stop=(r._sprite[e][0]+r._sprite[e][1])/1e3,s._loop=!(!s._loop&&!r._sprite[e][2]);var d=s._node;if(r._webAudio){var f=function(){r._refreshBuffer(s);var e=s._muted||r._muted?0:s._volume;d.gain.setValueAtTime(e,a.ctx.currentTime),s._playStart=a.ctx.currentTime,void 0===d.bufferSource.start?s._loop?d.bufferSource.noteGrainOn(0,c,86400):d.bufferSource.noteGrainOn(0,c,u):s._loop?d.bufferSource.start(0,c,86400):d.bufferSource.start(0,c,u),h!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h)),t||setTimeout(function(){r._emit("play",s._id)},0)};"running"===a.state?f():(r.once("resume",f),r._clearTimer(s._id))}else{var p=function(){d.currentTime=c,d.muted=s._muted||r._muted||a._muted||d.muted,d.volume=s._volume*a.volume(),d.playbackRate=s._rate;try{var e=d.play();if("undefined"!=typeof Promise&&e instanceof Promise&&(r._playLock=!0,e.then(function(){r._playLock=!1,r._loadQueue()})),d.paused)return void r._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices where playback was not within a user interaction.");h!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h)),t||r._emit("play",s._id)}catch(e){r._emit("playerror",s._id,e)}},m=window&&window.ejecta||!d.readyState&&a._navigator.isCocoonJS;if(4===d.readyState||m)p();else{var v=function(){p(),d.removeEventListener(a._canPlayEvent,v,!1)};d.addEventListener(a._canPlayEvent,v,!1),r._clearTimer(s._id)}}return s._id},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var r=t._getSoundIds(e),n=0;n<r.length;n++){t._clearTimer(r[n]);var i=t._soundById(r[n]);if(i&&!i._paused&&(i._seek=t.seek(r[n]),i._rateSeek=0,i._paused=!0,t._stopFade(r[n]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var r=this;if("loaded"!==r._state)return r._queue.push({event:"stop",action:function(){r.stop(e)}}),r;for(var n=r._getSoundIds(e),i=0;i<n.length;i++){r._clearTimer(n[i]);var a=r._soundById(n[i]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,r._stopFade(n[i]),a._node&&(r._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),r._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause())),t||r._emit("stop",a._id))}return r},mute:function(e,t){var r=this;if("loaded"!==r._state)return r._queue.push({event:"mute",action:function(){r.mute(e,t)}}),r;if(void 0===t){if("boolean"!=typeof e)return r._muted;r._muted=e}for(var n=r._getSoundIds(t),i=0;i<n.length;i++){var o=r._soundById(n[i]);o&&(o._muted=e,o._interval&&r._stopFade(o._id),r._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,a.ctx.currentTime):o._node&&(o._node.muted=!!a._muted||e),r._emit("mute",o._id))}return r},volume:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._volume;if(1===i.length||2===i.length&&void 0===i[1]){var o=n._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(r=t?n._soundById(t):n._sounds[0])?r._volume:0;if("loaded"!==n._state)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,i)}}),n;void 0===t&&(n._volume=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)(r=n._soundById(t[l]))&&(r._volume=e,i[2]||n._stopFade(t[l]),n._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(e,a.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=e*a.volume()),n._emit("volume",r._id));return n},fade:function(e,t,r,n){var i=this;if("loaded"!==i._state)return i._queue.push({event:"fade",action:function(){i.fade(e,t,r,n)}}),i;i.volume(e,n);for(var o=i._getSoundIds(n),s=0;s<o.length;s++){var l=i._soundById(o[s]);if(l){if(n||i._stopFade(o[s]),i._webAudio&&!l._muted){var c=a.ctx.currentTime,u=c+r/1e3;l._volume=e,l._node.gain.setValueAtTime(e,c),l._node.gain.linearRampToValueAtTime(t,u)}i._startFadeInterval(l,e,t,r,o[s],void 0===n)}}return i},_startFadeInterval:function(e,t,r,n,i,a){var o=this,s=t,l=r-t,c=Math.abs(l/.01),u=Math.max(4,c>0?n/c:n),h=Date.now();e._fadeTo=r,e._interval=setInterval(function(){var i=(Date.now()-h)/n;h=Date.now(),s+=l*i,s=Math.max(0,s),s=Math.min(1,s),s=Math.round(100*s)/100,o._webAudio?e._volume=s:o.volume(s,e._id,!0),a&&(o._volume=s),(r<t&&s<=r||r>t&&s>=r)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(r,e._id),o._emit("fade",e._id))},u)},_stopFade:function(e){var t=this._soundById(e);return t&&t._interval&&(this._webAudio&&t._node.gain.cancelScheduledValues(a.ctx.currentTime),clearInterval(t._interval),t._interval=null,this.volume(t._fadeTo,e),t._fadeTo=null,this._emit("fade",e)),this},loop:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(r=n._soundById(parseInt(i[0],10)))&&r._loop;e=i[0],n._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var a=n._getSoundIds(t),o=0;o<a.length;o++)(r=n._soundById(a[o]))&&(r._loop=e,n._webAudio&&r._node&&r._node.bufferSource&&(r._node.bufferSource.loop=e,e&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop)));return n},rate:function(){var e,t,r,n=this,i=arguments;if(0===i.length)t=n._sounds[0]._id;else if(1===i.length){var o=n._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(r=n._soundById(t))?r._rate:n._rate;if("loaded"!==n._state)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,i)}}),n;void 0===t&&(n._rate=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)if(r=n._soundById(t[l])){r._rateSeek=n.seek(t[l]),r._playStart=n._webAudio?a.ctx.currentTime:r._playStart,r._rate=e,n._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(e,a.ctx.currentTime):r._node&&(r._node.playbackRate=e);var c=n.seek(t[l]),u=(n._sprite[r._sprite][0]+n._sprite[r._sprite][1])/1e3-c,h=1e3*u/Math.abs(r._rate);!n._endTimers[t[l]]&&r._paused||(n._clearTimer(t[l]),n._endTimers[t[l]]=setTimeout(n._ended.bind(n,r),h)),n._emit("rate",r._id)}return n},seek:function(){var e,t,r=this,n=arguments;if(0===n.length)t=r._sounds[0]._id;else if(1===n.length){var i=r._getSoundIds(),o=i.indexOf(n[0]);o>=0?t=parseInt(n[0],10):r._sounds.length&&(t=r._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if(void 0===t)return r;if("loaded"!==r._state)return r._queue.push({event:"seek",action:function(){r.seek.apply(r,n)}}),r;var s=r._soundById(t);if(s){if(!("number"==typeof e&&e>=0)){if(r._webAudio){var l=r.playing(t)?a.ctx.currentTime-s._playStart:0,c=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(c+l*Math.abs(s._rate))}return s._node.currentTime}var u=r.playing(t);u&&r.pause(t,!0),s._seek=e,s._ended=!1,r._clearTimer(t),u&&r.play(t,!0),!r._webAudio&&s._node&&(s._node.currentTime=e),r._emit("seek",t)}return r},playing:function(e){if("number"==typeof e){var t=this._soundById(e);return!!t&&!t._paused}for(var r=0;r<this._sounds.length;r++)if(!this._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this._duration,r=this._soundById(e);return r&&(t=this._sprite[r._sprite][1]/1e3),t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,r=0;r<t.length;r++){if(t[r]._paused||e.stop(t[r]._id),!e._webAudio)/MSIE |Trident\//.test(a._navigator&&a._navigator.userAgent)||(t[r]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),t[r]._node.removeEventListener("error",t[r]._errorFn,!1),t[r]._node.removeEventListener(a._canPlayEvent,t[r]._loadFn,!1);delete t[r]._node,e._clearTimer(t[r]._id);var n=a._howls.indexOf(e);n>=0&&a._howls.splice(n,1)}var i=!0;for(r=0;r<a._howls.length;r++)if(a._howls[r]._src===e._src){i=!1;break}return l&&i&&delete l[e._src],a.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,r,n){var i=this["_on"+e];return"function"==typeof t&&i.push(n?{id:r,fn:t,once:n}:{id:r,fn:t}),this},off:function(e,t,r){var n=this["_on"+e],i=0;if("number"==typeof t&&(r=t,t=null),t||r)for(i=0;i<n.length;i++){var a=r===n[i].id;if(t===n[i].fn&&a||!t&&a){n.splice(i,1);break}}else if(e)this["_on"+e]=[];else{var o=Object.keys(this);for(i=0;i<o.length;i++)0===o[i].indexOf("_on")&&Array.isArray(this[o[i]])&&(this[o[i]]=[])}return this},once:function(e,t,r){return this.on(e,t,r,1),this},_emit:function(e,t,r){for(var n=this["_on"+e],i=n.length-1;i>=0;i--)n[i].id&&n[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,r)}.bind(this,n[i].fn),0),n[i].once&&this.off(e,n[i].fn,n[i].id));return this},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,function(){e._queue.shift(),e._loadQueue()}),t.action()}return e},_ended:function(e){var t=e._sprite;if(!this._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(this._ended.bind(this,e),100),this;var r=!(!e._loop&&!this._sprite[t][2]);if(this._emit("end",e._id),!this._webAudio&&r&&this.stop(e._id,!0).play(e._id),this._webAudio&&r){this._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=a.ctx.currentTime;var n=1e3*(e._stop-e._start)/Math.abs(e._rate);this._endTimers[e._id]=setTimeout(this._ended.bind(this,e),n)}return this._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,this._clearTimer(e._id),this._cleanBuffer(e._node),a._autoSuspend()),this._webAudio||r||this.stop(e._id),this},_clearTimer:function(e){return this._endTimers[e]&&(clearTimeout(this._endTimers[e]),delete this._endTimers[e]),this},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){this._drain();for(var e=0;e<this._sounds.length;e++)if(this._sounds[e]._ended)return this._sounds[e].reset();return new s(this)},_drain:function(){var e=this._pool,t=0,r=0;if(!(this._sounds.length<e)){for(r=0;r<this._sounds.length;r++)this._sounds[r]._ended&&t++;for(r=this._sounds.length-1;r>=0;r--){if(t<=e)return;this._sounds[r]._ended&&(this._webAudio&&this._sounds[r]._node&&this._sounds[r]._node.disconnect(0),this._sounds.splice(r,1),t--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],r=0;r<this._sounds.length;r++)t.push(this._sounds[r]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=a.ctx.createBufferSource(),e._node.bufferSource.buffer=l[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,a.ctx.currentTime),this},_cleanBuffer:function(e){if(a._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=a._scratchBuffer}catch(e){}}return e.bufferSource=null,this}};var s=function(e){this._parent=e,this.init()};s.prototype={init:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++a._counter,e._sounds.push(this),this.create(),this},create:function(){var e=this._parent,t=a._muted||this._muted||this._parent._muted?0:this._volume;return e._webAudio?(this._node=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),this._node.gain.setValueAtTime(t,a.ctx.currentTime),this._node.paused=!0,this._node.connect(a.masterGain)):(this._node=new Audio,this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(a._canPlayEvent,this._loadFn,!1),this._node.src=e._src,this._node.preload="auto",this._node.volume=t*a.volume(),this._node.load()),this},reset:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++a._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(a._canPlayEvent,this._loadFn,!1)}};var l={},c=function(e){var t=e._src;if(l[t])return e._duration=l[t].duration,void d(e);if(/^data:[^;]+;base64,/.test(t)){for(var r=atob(t.split(",")[1]),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);h(n.buffer,e)}else{var a=new XMLHttpRequest;a.open("GET",t,!0),a.withCredentials=e._xhrWithCredentials,a.responseType="arraybuffer",a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?h(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete l[t],e.load())},u(a)}},u=function(e){try{e.send()}catch(t){e.onerror()}},h=function(e,t){a.ctx.decodeAudioData(e,function(e){e&&t._sounds.length>0&&(l[t._src]=e,d(t,e))},function(){t._emit("loaderror",null,"Decoding audio data failed.")})},d=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},f=function(){try{"undefined"!=typeof AudioContext?a.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?a.ctx=new webkitAudioContext:a.usingWebAudio=!1}catch(e){a.usingWebAudio=!1}var e=/iP(hone|od|ad)/.test(a._navigator&&a._navigator.platform),t=a._navigator&&a._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=t?parseInt(t[1],10):null;if(e&&r&&r<9){var n=/safari/.test(a._navigator&&a._navigator.userAgent.toLowerCase());(a._navigator&&a._navigator.standalone&&!n||a._navigator&&!a._navigator.standalone&&!n)&&(a.usingWebAudio=!1)}a.usingWebAudio&&(a.masterGain=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),a.masterGain.gain.setValueAtTime(a._muted?0:1,a.ctx.currentTime),a.masterGain.connect(a.ctx.destination)),a._setup()};void 0===(n=function(){return{Howler:a,Howl:o}}.apply(t,[]))||(e.exports=n),t.Howler=a,t.Howl=o,"undefined"!=typeof window?(window.HowlerGlobal=i,window.Howler=a,window.Howl=o,window.Sound=s):void 0!==r&&(r.HowlerGlobal=i,r.Howler=a,r.Howl=o,r.Sound=s)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.0.8
 *  howlerjs.com
 *
 *  (c) 2013-2018, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){if(!this.ctx||!this.ctx.listener)return this;for(var t=this._howls.length-1;t>=0;t--)this._howls[t].stereo(e);return this},HowlerGlobal.prototype.pos=function(e,t,r){return this.ctx&&this.ctx.listener?(t="number"!=typeof t?this._pos[1]:t,r="number"!=typeof r?this._pos[2]:r,"number"!=typeof e?this._pos:(this._pos=[e,t,r],this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(e,t,r,n,i,a){if(!this.ctx||!this.ctx.listener)return this;var o=this._orientation;return t="number"!=typeof t?o[1]:t,r="number"!=typeof r?o[2]:r,n="number"!=typeof n?o[3]:n,i="number"!=typeof i?o[4]:i,a="number"!=typeof a?o[5]:a,"number"!=typeof e?o:(this._orientation=[e,t,r,n,i,a],this.ctx.listener.setOrientation(e,t,r,n,i,a),this)},Howl.prototype.init=(e=Howl.prototype.init,function(t){return this._orientation=t.orientation||[1,0,0],this._stereo=t.stereo||null,this._pos=t.pos||null,this._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},this._onstereo=t.onstereo?[{fn:t.onstereo}]:[],this._onpos=t.onpos?[{fn:t.onpos}]:[],this._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,r)}}),n;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===r){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var s=n._soundById(a[o]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,i),"spatial"===i?s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",s._id)}}return n},Howl.prototype.pos=function(e,r,n,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"pos",action:function(){a.pos(e,r,n,i)}}),a;if(r="number"!=typeof r?0:r,n="number"!=typeof n?-.5:n,void 0===i){if("number"!=typeof e)return a._pos;a._pos=[e,r,n]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,r,n],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),l._panner.setPosition(e,r,n)),a._emit("pos",l._id)}}return a},Howl.prototype.orientation=function(e,r,n,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"orientation",action:function(){a.orientation(e,r,n,i)}}),a;if(r="number"!=typeof r?a._orientation[1]:r,n="number"!=typeof n?a._orientation[2]:n,void 0===i){if("number"!=typeof e)return a._orientation;a._orientation=[e,r,n]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,r,n],l._node&&(l._panner||(l._pos||(l._pos=a._pos||[0,0,-.5]),t(l,"spatial")),l._panner.setOrientation(e,r,n)),a._emit("orientation",l._id)}}return a},Howl.prototype.pannerAttr=function(){var e,r,n,i=this,a=arguments;if(!i._webAudio)return i;if(0===a.length)return i._pannerAttr;if(1===a.length){if("object"!=typeof a[0])return(n=i._soundById(parseInt(a[0],10)))?n._pannerAttr:i._pannerAttr;e=a[0],void 0===r&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===a.length&&(e=a[0],r=parseInt(a[1],10));for(var o=i._getSoundIds(r),s=0;s<o.length;s++)if(n=i._soundById(o[s])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var c=n._panner;c?(c.coneInnerAngle=l.coneInnerAngle,c.coneOuterAngle=l.coneOuterAngle,c.coneOuterGain=l.coneOuterGain,c.distanceModel=l.distanceModel,c.maxDistance=l.maxDistance,c.refDistance=l.refDistance,c.rolloffFactor=l.rolloffFactor,c.panningModel=l.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this._parent;this._orientation=t._orientation,this._stereo=t._stereo,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this),this._stereo?t.stereo(this._stereo):this._pos&&t.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this._parent;return this._orientation=t._orientation,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()}).call(this,r(3))},function(e,t){THREE.OrbitControls=function(e,t){var r,n,i,a,o;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return p.phi},this.getAzimuthalAngle=function(){return p.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=h.NONE},this.update=(r=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=n.clone().inverse(),a=new THREE.Vector3,o=new THREE.Quaternion,function(){var e=s.object.position;return r.copy(e).sub(s.target),r.applyQuaternion(n),p.setFromVector3(r),s.autoRotate&&d===h.NONE&&L(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(p.theta+=m.theta*s.dampingFactor,p.phi+=m.phi*s.dampingFactor):(p.theta+=m.theta,p.phi+=m.phi),p.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,p.theta)),p.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,p.phi)),p.makeSafe(),p.radius*=v,p.radius=Math.max(s.minDistance,Math.min(s.maxDistance,p.radius)),!0===s.enableDamping?s.target.addScaledVector(g,s.dampingFactor):s.target.add(g),r.setFromSpherical(p),r.applyQuaternion(i),e.copy(s.target).add(r),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,g.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),v=1,!!(y||a.distanceToSquared(s.object.position)>f||8*(1-o.dot(s.object.quaternion))>f)&&(s.dispatchEvent(l),a.copy(s.object.position),o.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",$,!1),s.domElement.removeEventListener("mousedown",W,!1),s.domElement.removeEventListener("wheel",q,!1),s.domElement.removeEventListener("touchstart",Q,!1),s.domElement.removeEventListener("touchend",J,!1),s.domElement.removeEventListener("touchmove",K,!1),document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",Y,!1),s.domElement.removeEventListener("keydown",Z,!1)};var s=this,l={type:"change"},c={type:"start"},u={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},d=h.NONE,f=1e-6,p=new THREE.Spherical,m=new THREE.Spherical,v=1,g=new THREE.Vector3,y=!1,E=new THREE.Vector2,x=new THREE.Vector2,T=new THREE.Vector2,b=new THREE.Vector2,w=new THREE.Vector2,_=new THREE.Vector2,R=new THREE.Vector2,M=new THREE.Vector2,S=new THREE.Vector2;function A(){return Math.pow(.95,s.zoomSpeed)}function L(e){m.theta-=e}function P(e){m.phi-=e}var C,H=(C=new THREE.Vector3,function(e,t){C.setFromMatrixColumn(t,0),C.multiplyScalar(-e),g.add(C)}),I=function(){var e=new THREE.Vector3;return function(t,r){!0===s.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),g.add(e)}}(),k=function(){var e=new THREE.Vector3;return function(t,r){var n=s.domElement;if(s.object.isPerspectiveCamera){var i=s.object.position;e.copy(i).sub(s.target);var a=e.length();a*=Math.tan(s.object.fov/2*Math.PI/180),H(2*t*a/n.clientHeight,s.object.matrix),I(2*r*a/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(H(t*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),I(r*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function N(e){s.object.isPerspectiveCamera?v/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function O(e){s.object.isPerspectiveCamera?v*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function F(e){E.set(e.clientX,e.clientY)}function D(e){b.set(e.clientX,e.clientY)}function U(e){if(1==e.touches.length)E.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(t,r)}}function z(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,r)}}function B(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);R.set(0,n)}function G(e){if(1==e.touches.length)x.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);x.set(t,r)}T.subVectors(x,E).multiplyScalar(s.rotateSpeed);var n=s.domElement;L(2*Math.PI*T.x/n.clientHeight),P(2*Math.PI*T.y/n.clientHeight),E.copy(x)}function V(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,r)}_.subVectors(w,b).multiplyScalar(s.panSpeed),k(_.x,_.y),b.copy(w)}function j(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);M.set(0,n),S.set(0,Math.pow(M.y/R.y,s.zoomSpeed)),N(S.y),R.copy(M)}function W(e){if(!1!==s.enabled){var t;switch(e.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),e.button){case 0:t=s.mouseButtons.LEFT;break;case 1:t=s.mouseButtons.MIDDLE;break;case 2:t=s.mouseButtons.RIGHT;break;default:t=-1}switch(t){case THREE.MOUSE.DOLLY:if(!1===s.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),d=h.DOLLY;break;case THREE.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;D(e),d=h.PAN}else{if(!1===s.enableRotate)return;F(e),d=h.ROTATE}break;case THREE.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;F(e),d=h.ROTATE}else{if(!1===s.enablePan)return;D(e),d=h.PAN}break;default:d=h.NONE}d!==h.NONE&&(document.addEventListener("mousemove",X,!1),document.addEventListener("mouseup",Y,!1),s.dispatchEvent(c))}}function X(e){if(!1!==s.enabled)switch(e.preventDefault(),d){case h.ROTATE:if(!1===s.enableRotate)return;!function(e){x.set(e.clientX,e.clientY),T.subVectors(x,E).multiplyScalar(s.rotateSpeed);var t=s.domElement;L(2*Math.PI*T.x/t.clientHeight),P(2*Math.PI*T.y/t.clientHeight),E.copy(x),s.update()}(e);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(e){M.set(e.clientX,e.clientY),S.subVectors(M,R),S.y>0?N(A()):S.y<0&&O(A()),R.copy(M),s.update()}(e);break;case h.PAN:if(!1===s.enablePan)return;!function(e){w.set(e.clientX,e.clientY),_.subVectors(w,b).multiplyScalar(s.panSpeed),k(_.x,_.y),b.copy(w),s.update()}(e)}}function Y(e){!1!==s.enabled&&(document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",Y,!1),s.dispatchEvent(u),d=h.NONE)}function q(e){!1===s.enabled||!1===s.enableZoom||d!==h.NONE&&d!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(c),function(e){e.deltaY<0?O(A()):e.deltaY>0&&N(A()),s.update()}(e),s.dispatchEvent(u))}function Z(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){var t=!1;switch(e.keyCode){case s.keys.UP:k(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:k(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:k(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:k(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function Q(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(s.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===s.enableRotate)return;U(e),d=h.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===s.enablePan)return;z(e),d=h.TOUCH_PAN;break;default:d=h.NONE}break;case 2:switch(s.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){s.enableZoom&&B(e),s.enablePan&&z(e)}(e),d=h.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){s.enableZoom&&B(e),s.enableRotate&&U(e)}(e),d=h.TOUCH_DOLLY_ROTATE;break;default:d=h.NONE}break;default:d=h.NONE}d!==h.NONE&&s.dispatchEvent(c)}}function K(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),d){case h.TOUCH_ROTATE:if(!1===s.enableRotate)return;G(e),s.update();break;case h.TOUCH_PAN:if(!1===s.enablePan)return;V(e),s.update();break;case h.TOUCH_DOLLY_PAN:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){s.enableZoom&&j(e),s.enablePan&&V(e)}(e),s.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){s.enableZoom&&j(e),s.enableRotate&&G(e)}(e),s.update();break;default:d=h.NONE}}function J(e){!1!==s.enabled&&(s.dispatchEvent(u),d=h.NONE)}function $(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",$,!1),s.domElement.addEventListener("mousedown",W,!1),s.domElement.addEventListener("wheel",q,!1),s.domElement.addEventListener("touchstart",Q,!1),s.domElement.addEventListener("touchend",J,!1),s.domElement.addEventListener("touchmove",K,!1),s.domElement.addEventListener("keydown",Z,!1),-1===s.domElement.tabIndex&&(s.domElement.tabIndex=0),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.MapControls=function(e,t){THREE.OrbitControls.call(this,e,t),this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls},function(e,t){THREE.TrackballControls=function(e,t){void 0===t&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=t,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.ZOOM,RIGHT:THREE.MOUSE.PAN},this.target=new THREE.Vector3;var i=new THREE.Vector3,a=1,o=n.NONE,s=n.NONE,l=new THREE.Vector3,c=new THREE.Vector2,u=new THREE.Vector2,h=new THREE.Vector3,d=0,f=new THREE.Vector2,p=new THREE.Vector2,m=0,v=0,g=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;var E={type:"change"},x={type:"start"},T={type:"end"};this.handleResize=function(){var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height};var b,w,_,R,M,S,A,L,P,C,H,I=(b=new THREE.Vector2,function(e,t){return b.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),b}),k=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),e}}();function N(e){!1!==r.enabled&&(window.removeEventListener("keydown",N),s===n.NONE&&(e.keyCode!==r.keys[n.ROTATE]||r.noRotate?e.keyCode!==r.keys[n.ZOOM]||r.noZoom?e.keyCode!==r.keys[n.PAN]||r.noPan||(s=n.PAN):s=n.ZOOM:s=n.ROTATE))}function O(){!1!==r.enabled&&(s=n.NONE,window.addEventListener("keydown",N,!1))}function F(e){if(!1!==r.enabled){if(e.preventDefault(),e.stopPropagation(),o===n.NONE)switch(e.button){case r.mouseButtons.LEFT:o=n.ROTATE;break;case r.mouseButtons.MIDDLE:o=n.ZOOM;break;case r.mouseButtons.RIGHT:o=n.PAN;break;default:o=n.NONE}var t=s!==n.NONE?s:o;t!==n.ROTATE||r.noRotate?t!==n.ZOOM||r.noZoom?t!==n.PAN||r.noPan||(g.copy(I(e.pageX,e.pageY)),y.copy(g)):(f.copy(I(e.pageX,e.pageY)),p.copy(f)):(u.copy(k(e.pageX,e.pageY)),c.copy(u)),document.addEventListener("mousemove",D,!1),document.addEventListener("mouseup",U,!1),r.dispatchEvent(x)}}function D(e){if(!1!==r.enabled){e.preventDefault(),e.stopPropagation();var t=s!==n.NONE?s:o;t!==n.ROTATE||r.noRotate?t!==n.ZOOM||r.noZoom?t!==n.PAN||r.noPan||y.copy(I(e.pageX,e.pageY)):p.copy(I(e.pageX,e.pageY)):(c.copy(u),u.copy(k(e.pageX,e.pageY)))}}function U(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o=n.NONE,document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",U),r.dispatchEvent(T))}function z(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:f.y-=.025*e.deltaY;break;case 1:f.y-=.01*e.deltaY;break;default:f.y-=25e-5*e.deltaY}r.dispatchEvent(x),r.dispatchEvent(T)}}function B(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:o=n.TOUCH_ROTATE,u.copy(k(e.touches[0].pageX,e.touches[0].pageY)),c.copy(u);break;default:o=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;v=m=Math.sqrt(t*t+i*i);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;g.copy(I(a,s)),y.copy(g)}r.dispatchEvent(x)}}function G(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:c.copy(u),u.copy(k(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;v=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;y.copy(I(i,a))}}function V(e){if(!1!==r.enabled){switch(e.touches.length){case 0:o=n.NONE;break;case 1:o=n.TOUCH_ROTATE,u.copy(k(e.touches[0].pageX,e.touches[0].pageY)),c.copy(u)}r.dispatchEvent(T)}}function j(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=(_=new THREE.Vector3,R=new THREE.Quaternion,M=new THREE.Vector3,S=new THREE.Vector3,A=new THREE.Vector3,L=new THREE.Vector3,function(){L.set(u.x-c.x,u.y-c.y,0),(w=L.length())?(l.copy(r.object.position).sub(r.target),M.copy(l).normalize(),S.copy(r.object.up).normalize(),A.crossVectors(S,M).normalize(),S.setLength(u.y-c.y),A.setLength(u.x-c.x),L.copy(S.add(A)),_.crossVectors(L,l).normalize(),w*=r.rotateSpeed,R.setFromAxisAngle(_,w),l.applyQuaternion(R),r.object.up.applyQuaternion(R),h.copy(_),d=w):!r.staticMoving&&d&&(d*=Math.sqrt(1-r.dynamicDampingFactor),l.copy(r.object.position).sub(r.target),R.setFromAxisAngle(h,d),l.applyQuaternion(R),r.object.up.applyQuaternion(R)),c.copy(u)}),this.zoomCamera=function(){var e;o===n.TOUCH_ZOOM_PAN?(e=m/v,m=v,r.object.isPerspectiveCamera?l.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom*=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!==(e=1+(p.y-f.y)*r.zoomSpeed)&&e>0&&(r.object.isPerspectiveCamera?l.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom/=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),r.staticMoving?f.copy(p):f.y+=(p.y-f.y)*this.dynamicDampingFactor)},this.panCamera=(P=new THREE.Vector2,C=new THREE.Vector3,H=new THREE.Vector3,function(){if(P.copy(y).sub(g),P.lengthSq()){if(r.object.isOrthographicCamera){var e=(r.object.right-r.object.left)/r.object.zoom/r.domElement.clientWidth,t=(r.object.top-r.object.bottom)/r.object.zoom/r.domElement.clientWidth;P.x*=e,P.y*=t}P.multiplyScalar(l.length()*r.panSpeed),H.copy(l).cross(r.object.up).setLength(P.x),H.add(C.copy(r.object.up).setLength(P.y)),r.object.position.add(H),r.target.add(H),r.staticMoving?g.copy(y):g.add(P.subVectors(y,g).multiplyScalar(r.dynamicDampingFactor))}}),this.checkDistances=function(){r.noZoom&&r.noPan||(l.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,l.setLength(r.maxDistance)),f.copy(p)),l.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,l.setLength(r.minDistance)),f.copy(p)))},this.update=function(){l.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,l),r.object.isPerspectiveCamera?(r.checkDistances(),r.object.lookAt(r.target),i.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(E),i.copy(r.object.position))):r.object.isOrthographicCamera?(r.object.lookAt(r.target),(i.distanceToSquared(r.object.position)>1e-6||a!==r.object.zoom)&&(r.dispatchEvent(E),i.copy(r.object.position),a=r.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){o=n.NONE,s=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),l.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(E),i.copy(r.object.position),a=r.object.zoom},this.dispose=function(){this.domElement.removeEventListener("contextmenu",j,!1),this.domElement.removeEventListener("mousedown",F,!1),this.domElement.removeEventListener("wheel",z,!1),this.domElement.removeEventListener("touchstart",B,!1),this.domElement.removeEventListener("touchend",V,!1),this.domElement.removeEventListener("touchmove",G,!1),document.removeEventListener("mousemove",D,!1),document.removeEventListener("mouseup",U,!1),window.removeEventListener("keydown",N,!1),window.removeEventListener("keyup",O,!1)},this.domElement.addEventListener("contextmenu",j,!1),this.domElement.addEventListener("mousedown",F,!1),this.domElement.addEventListener("wheel",z,!1),this.domElement.addEventListener("touchstart",B,!1),this.domElement.addEventListener("touchend",V,!1),this.domElement.addEventListener("touchmove",G,!1),window.addEventListener("keydown",N,!1),window.addEventListener("keyup",O,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls},function(e,t){THREE.FirstPersonControls=function(e,t){void 0===t&&(console.warn('THREE.FirstPersonControls: The second parameter "domElement" is now mandatory.'),t=document),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;var r,n=0,i=0,a=new THREE.Vector3,o=new THREE.Spherical,s=new THREE.Vector3;function l(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,r){return e.isVector3?s.copy(e):s.set(e,t,r),this.object.lookAt(s),m(this),this},this.update=(r=new THREE.Vector3,function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=THREE.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var a=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(a+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(a),this.moveLeft&&this.object.translateX(-a),this.moveRight&&this.object.translateX(a),this.moveUp&&this.object.translateY(a),this.moveDown&&this.object.translateY(-a);var o=e*this.lookSpeed;this.activeLook||(o=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),i-=this.mouseX*o,this.lookVertical&&(n-=this.mouseY*o*s),n=Math.max(-85,Math.min(85,n));var l=THREE.MathUtils.degToRad(90-n),c=THREE.MathUtils.degToRad(i);this.constrainVertical&&(l=THREE.MathUtils.mapLinear(l,0,Math.PI,this.verticalMin,this.verticalMax));var u=this.object.position;r.setFromSphericalCoords(1,l,c).add(u),this.object.lookAt(r)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",l,!1),this.domElement.removeEventListener("mousedown",u,!1),this.domElement.removeEventListener("mousemove",c,!1),this.domElement.removeEventListener("mouseup",h,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",f,!1)};var c=p(this,this.onMouseMove),u=p(this,this.onMouseDown),h=p(this,this.onMouseUp),d=p(this,this.onKeyDown),f=p(this,this.onKeyUp);function p(e,t){return function(){t.apply(e,arguments)}}function m(e){var t=e.object.quaternion;a.set(0,0,-1).applyQuaternion(t),o.setFromVector3(a),n=90-THREE.MathUtils.radToDeg(o.phi),i=THREE.MathUtils.radToDeg(o.theta)}this.domElement.addEventListener("contextmenu",l,!1),this.domElement.addEventListener("mousemove",c,!1),this.domElement.addEventListener("mousedown",u,!1),this.domElement.addEventListener("mouseup",h,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",f,!1),this.handleResize(),m(this)}},function(e,t){THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var r=this,n=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,s=t.shader||THREE.Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,c=void 0!==t.encoding?t.encoding:THREE.LinearEncoding,u=new THREE.Plane,h=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Matrix4,m=new THREE.Vector3(0,0,-1),v=new THREE.Vector4,g=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector4,x=new THREE.Matrix4,T=new THREE.PerspectiveCamera,b={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1,encoding:c},w=new THREE.WebGLRenderTarget(i,a,b);THREE.MathUtils.isPowerOfTwo(i)&&THREE.MathUtils.isPowerOfTwo(a)||(w.texture.generateMipmaps=!1);var _=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});_.uniforms.tDiffuse.value=w.texture,_.uniforms.color.value=n,_.uniforms.textureMatrix.value=x,this.material=_,this.onBeforeRender=function(e,t,n){if("recursion"in n.userData){if(n.userData.recursion===l)return;n.userData.recursion++}if(d.setFromMatrixPosition(r.matrixWorld),f.setFromMatrixPosition(n.matrixWorld),p.extractRotation(r.matrixWorld),h.set(0,0,1),h.applyMatrix4(p),g.subVectors(d,f),!(g.dot(h)>0)){g.reflect(h).negate(),g.add(d),p.extractRotation(n.matrixWorld),m.set(0,0,-1),m.applyMatrix4(p),m.add(f),y.subVectors(d,m),y.reflect(h).negate(),y.add(d),T.position.copy(g),T.up.set(0,1,0),T.up.applyMatrix4(p),T.up.reflect(h),T.lookAt(y),T.far=n.far,T.updateMatrixWorld(),T.projectionMatrix.copy(n.projectionMatrix),T.userData.recursion=0,x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(T.projectionMatrix),x.multiply(T.matrixWorldInverse),x.multiply(r.matrixWorld),u.setFromNormalAndCoplanarPoint(h,d),u.applyMatrix4(T.matrixWorldInverse),v.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var i=T.projectionMatrix;E.x=(Math.sign(v.x)+i.elements[8])/i.elements[0],E.y=(Math.sign(v.y)+i.elements[9])/i.elements[5],E.z=-1,E.w=(1+i.elements[10])/i.elements[14],v.multiplyScalar(2/v.dot(E)),i.elements[2]=v.x,i.elements[6]=v.y,i.elements[10]=v.z+1-o,i.elements[14]=v.w,r.visible=!1;var a=e.getRenderTarget(),s=e.xr.enabled,c=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(w),e.clear(),e.render(t,T),e.xr.enabled=s,e.shadowMap.autoUpdate=c,e.setRenderTarget(a);var b=n.viewport;void 0!==b&&e.state.viewport(b),r.visible=!0}},this.getRenderTarget=function(){return w}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(e,t){THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var r=this,n=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,s=t.shader||THREE.Refractor.RefractorShader,l=void 0!==t.encoding?t.encoding:THREE.LinearEncoding,c=new THREE.PerspectiveCamera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;var u=new THREE.Plane,h=new THREE.Matrix4,d={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1,encoding:l},f=new THREE.WebGLRenderTarget(i,a,d);THREE.MathUtils.isPowerOfTwo(i)&&THREE.MathUtils.isPowerOfTwo(a)||(f.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=f.texture,this.material.uniforms.textureMatrix.value=h;p=new THREE.Vector3,m=new THREE.Vector3,v=new THREE.Matrix4,g=new THREE.Vector3,y=new THREE.Vector3;var p,m,v,g,y,E,x,T,b=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;return function(){r.matrixWorld.decompose(t,n,i),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),w=(E=new THREE.Plane,x=new THREE.Vector4,T=new THREE.Vector4,function(e){c.matrixWorld.copy(e.matrixWorld),c.matrixWorldInverse.getInverse(c.matrixWorld),c.projectionMatrix.copy(e.projectionMatrix),c.far=e.far,E.copy(u),E.applyMatrix4(c.matrixWorldInverse),x.set(E.normal.x,E.normal.y,E.normal.z,E.constant);var t=c.projectionMatrix;T.x=(Math.sign(x.x)+t.elements[8])/t.elements[0],T.y=(Math.sign(x.y)+t.elements[9])/t.elements[5],T.z=-1,T.w=(1+t.elements[10])/t.elements[14],x.multiplyScalar(2/x.dot(T)),t.elements[2]=x.x,t.elements[6]=x.y,t.elements[10]=x.z+1-o,t.elements[14]=x.w});this.onBeforeRender=function(e,t,n){!0!==n.userData.refractor&&(b(),function(e){h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(e.projectionMatrix),h.multiply(e.matrixWorldInverse),h.multiply(r.matrixWorld)}(n),w(n),function(e,t,n){r.visible=!1;var i=e.getRenderTarget(),a=e.xr.enabled,o=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(f),e.clear(),e.render(t,c),e.xr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(i);var s=n.viewport;void 0!==s&&e.state.viewport(s),r.visible=!0}(e,t,n))},this.getRenderTarget=function(){return f}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(e,t){THREE.FresnelShader={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","\tvec3 I = worldPosition.xyz - cameraPosition;","\tvReflect = reflect( I, worldNormal );","\tvRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","\tvRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","\tvRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","\tvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","\tvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","\tvec4 refractedColor = vec4( 1.0 );","\trefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","\trefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","\trefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","\tgl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")}},function(e,t){THREE.RGBELoader=function(e){THREE.DataTextureLoader.call(this,e),this.type=THREE.UnsignedByteType},THREE.RGBELoader.prototype=Object.assign(Object.create(THREE.DataTextureLoader.prototype),{constructor:THREE.RGBELoader,parse:function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;for(var n=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));0>(i=s.indexOf("\n"))&&a<t&&n<e.byteLength;)o+=s,a+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<i&&(!1!==r&&(e.pos+=a+i+1),o+s.slice(0,i))},n=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function r(r){e[0]=r;var n=t[0],i=n>>16&32768,a=n>>12&2047,o=n>>23&255;return o<103?i:o>142?(i|=31744,i|=(255==o?0:1)&&8388607&n):o<113?i|=((a|=2048)>>114-o)+(a>>113-o&1):(i|=o-112<<10|a>>1,i+=1&a)}return function(e,t,n,i){var a=e[t+3],o=Math.pow(2,a-128)/255;n[i+0]=r(e[t+0]*o),n[i+1]=r(e[t+1]*o),n[i+2]=r(e[t+2]*o)}}(),i=new Uint8Array(e);i.pos=0;var a,o,s,l,c,u,h=function(e){var n,i,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(n=r(e)))return t(1,"no header found");if(!(i=n.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(c.valid|=1,c.programtype=i[1],c.string+=n+"\n";!1!==(n=r(e));)if(c.string+=n+"\n","#"!==n.charAt(0)){if((i=n.match(a))&&(c.gamma=parseFloat(i[1],10)),(i=n.match(o))&&(c.exposure=parseFloat(i[1],10)),(i=n.match(s))&&(c.valid|=2,c.format=i[1]),(i=n.match(l))&&(c.valid|=4,c.height=parseInt(i[1],10),c.width=parseInt(i[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=n+"\n";return 2&c.valid?4&c.valid?c:t(3,"missing image size specifier"):t(3,"missing format specifier")}(i);if(-1!==h){var d=h.width,f=h.height,p=function(e,r,n){var i,a,o,s,l,c,u,h,d,f,p,m,v,g=r,y=n;if(g<8||g>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(g!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(i=new Uint8Array(4*r*n))||!i.length)return t(4,"unable to allocate buffer space");for(a=0,o=0,h=4*g,v=new Uint8Array(4),c=new Uint8Array(h);y>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(v[0]=e[o++],v[1]=e[o++],v[2]=e[o++],v[3]=e[o++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return t(3,"bad rgbe scanline format");for(u=0;u<h&&o<e.byteLength;){if((m=(s=e[o++])>128)&&(s-=128),0===s||u+s>h)return t(3,"bad scanline data");if(m)for(l=e[o++],d=0;d<s;d++)c[u++]=l;else c.set(e.subarray(o,o+s),u),u+=s,o+=s}for(f=g,d=0;d<f;d++)p=0,i[a]=c[d+p],p+=g,i[a+1]=c[d+p],p+=g,i[a+2]=c[d+p],p+=g,i[a+3]=c[d+p],a+=4;y--}return i}(i.subarray(i.pos),d,f);if(-1!==p){switch(this.type){case THREE.UnsignedByteType:var m=p,v=THREE.RGBEFormat,g=THREE.UnsignedByteType;break;case THREE.FloatType:for(var y=p.length/4*3,E=new Float32Array(y),x=0;x<y;x++)s=E,l=3*x,c=void 0,u=void 0,c=(a=p)[(o=4*x)+3],u=Math.pow(2,c-128)/255,s[l+0]=a[o+0]*u,s[l+1]=a[o+1]*u,s[l+2]=a[o+2]*u;m=E,v=THREE.RGBFormat,g=THREE.FloatType;break;case THREE.HalfFloatType:y=p.length/4*3;var T=new Uint16Array(y);for(x=0;x<y;x++)n(p,4*x,T,3*x);m=T,v=THREE.RGBFormat,g=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:d,height:f,data:m,header:h.string,gamma:h.gamma,exposure:h.exposure,format:v,type:g}}}return null},setDataType:function(e){return this.type=e,this},load:function(e,t,r,n){return THREE.DataTextureLoader.prototype.load.call(this,e,function(e,r){switch(e.type){case THREE.UnsignedByteType:e.encoding=THREE.RGBEEncoding,e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case THREE.FloatType:case THREE.HalfFloatType:e.encoding=THREE.LinearEncoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}})},function(e,t){THREE.HDRCubeTextureLoader=function(e){THREE.Loader.call(this,e),this.hdrLoader=new THREE.RGBELoader,this.type=THREE.UnsignedByteType},THREE.HDRCubeTextureLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.HDRCubeTextureLoader,load:function(e,t,r,n){Array.isArray(e)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setDataType() instead."),this.setDataType(e),e=t,t=r,r=n,n=arguments[4]);var i=new THREE.CubeTexture;switch(i.type=this.type,i.type){case THREE.UnsignedByteType:i.encoding=THREE.RGBEEncoding,i.format=THREE.RGBAFormat,i.minFilter=THREE.NearestFilter,i.magFilter=THREE.NearestFilter,i.generateMipmaps=!1;break;case THREE.FloatType:case THREE.HalfFloatType:i.encoding=THREE.LinearEncoding,i.format=THREE.RGBFormat,i.minFilter=THREE.LinearFilter,i.magFilter=THREE.LinearFilter,i.generateMipmaps=!1}var a=this,o=0;function s(t,r,n,s){new THREE.FileLoader(a.manager).setPath(a.path).setResponseType("arraybuffer").load(e[t],function(e){o++;var n=a.hdrLoader.parse(e);if(n){if(void 0!==n.data){var s=new THREE.DataTexture(n.data,n.width,n.height);s.type=i.type,s.encoding=i.encoding,s.format=i.format,s.minFilter=i.minFilter,s.magFilter=i.magFilter,s.generateMipmaps=i.generateMipmaps,i.images[t]=s}6===o&&(i.needsUpdate=!0,r&&r(i))}},n,s)}for(var l=0;l<e.length;l++)s(l,t,r,n);return i},setDataType:function(e){return this.type=e,this.hdrLoader.setDataType(e),this}})},function(e,t){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,r=/^usemtl /,n=/^usemap /;function i(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addColor:function(e,t,r){var n=this.colors,i=this.object.geometry.colors;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]),i.push(n[t+0],n[t+1]),i.push(n[r+0],n[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,i,a,o,s,l){var c=this.vertices.length,u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(r,c);if(this.addVertex(u,h,d),this.colors.length>0&&this.addColor(u,h,d),void 0!==n&&""!==n){var f=this.uvs.length;u=this.parseUVIndex(n,f),h=this.parseUVIndex(i,f),d=this.parseUVIndex(a,f),this.addUV(u,h,d)}if(void 0!==o&&""!==o){var p=this.normals.length;u=this.parseNormalIndex(o,p),h=o===s?u:this.parseNormalIndex(s,p),d=o===l?u:this.parseNormalIndex(l,p),this.addNormal(u,h,d)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,n=e.length;r<n;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,a=e.length;i<a;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));var o=0;for(a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],n))}};return e.startObject("",!1),e}function a(e){THREE.Loader.call(this,e),this.materials=null}return a.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:a,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(this.path),a.load(e,function(e){t(i.parse(e))},r,n)},setMaterials:function(e){return this.materials=e,this},parse:function(a){var o=new i;-1!==a.indexOf("\r\n")&&(a=a.replace(/\r\n/g,"\n")),-1!==a.indexOf("\\\n")&&(a=a.replace(/\\\n/g,""));for(var s=a.split("\n"),l="",c="",u=[],h="function"==typeof"".trimLeft,d=0,f=s.length;d<f;d++)if(l=s[d],0!==(l=h?l.trimLeft():l.trim()).length&&"#"!==(c=l.charAt(0)))if("v"===c){var p=l.split(/\s+/);switch(p[0]){case"v":o.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),p.length>=7&&o.colors.push(parseFloat(p[4]/255),parseFloat(p[5]/255),parseFloat(p[6]/255));break;case"vn":o.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":o.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===c){for(var m=l.substr(1).trim().split(/\s+/),v=[],g=0,y=m.length;g<y;g++){var E=m[g];if(E.length>0){var x=E.split("/");v.push(x)}}var T=v[0];for(g=1,y=v.length-1;g<y;g++){var b=v[g],w=v[g+1];o.addFace(T[0],b[0],w[0],T[1],b[1],w[1],T[2],b[2],w[2])}}else if("l"===c){var _=l.substring(1).trim().split(" "),R=[],M=[];if(-1===l.indexOf("/"))R=_;else for(var S=0,A=_.length;S<A;S++){var L=_[S].split("/");""!==L[0]&&R.push(L[0]),""!==L[1]&&M.push(L[1])}o.addLineGeometry(R,M)}else if("p"===c){var P=l.substr(1).trim().split(" ");o.addPointGeometry(P)}else if(null!==(u=e.exec(l))){var C=(" "+u[0].substr(1).trim()).substr(1);o.startObject(C)}else if(r.test(l))o.object.startMaterial(l.substring(7).trim(),o.materialLibraries);else if(t.test(l))o.materialLibraries.push(l.substring(7).trim());else if(n.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if((u=l.split(" ")).length>1){var H=u[1].trim().toLowerCase();o.object.smooth="0"!==H&&"off"!==H}else o.object.smooth=!0;(X=o.object.currentMaterial())&&(X.smooth=o.object.smooth)}else{if("\0"===l)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}o.finalize();var I=new THREE.Group;I.materialLibraries=[].concat(o.materialLibraries);for(d=0,f=o.objects.length;d<f;d++){var k=o.objects[d],N=k.geometry,O=k.materials,F="Line"===N.type,D="Points"===N.type,U=!1;if(0!==N.vertices.length){var z=new THREE.BufferGeometry;z.setAttribute("position",new THREE.Float32BufferAttribute(N.vertices,3)),N.normals.length>0?z.setAttribute("normal",new THREE.Float32BufferAttribute(N.normals,3)):z.computeVertexNormals(),N.colors.length>0&&(U=!0,z.setAttribute("color",new THREE.Float32BufferAttribute(N.colors,3))),N.uvs.length>0&&z.setAttribute("uv",new THREE.Float32BufferAttribute(N.uvs,2));for(var B,G=[],V=0,j=O.length;V<j;V++){var W=(Z=O[V]).name+"_"+Z.smooth+"_"+U,X=o.materials[W];if(null!==this.materials)if(X=this.materials.create(Z.name),!F||!X||X instanceof THREE.LineBasicMaterial){if(D&&X&&!(X instanceof THREE.PointsMaterial)){var Y=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(Y,X),Y.color.copy(X.color),Y.map=X.map,X=Y}}else{var q=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(q,X),q.color.copy(X.color),X=q}void 0===X&&((X=F?new THREE.LineBasicMaterial:D?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=Z.name,X.flatShading=!Z.smooth,X.vertexColors=U,o.materials[W]=X),G.push(X)}if(G.length>1){for(V=0,j=O.length;V<j;V++){var Z=O[V];z.addGroup(Z.groupStart,Z.groupCount,V)}B=F?new THREE.LineSegments(z,G):D?new THREE.Points(z,G):new THREE.Mesh(z,G)}else B=F?new THREE.LineSegments(z,G[0]):D?new THREE.Points(z,G[0]):new THREE.Mesh(z,G[0]);B.name=k.name,I.add(B)}}return I}}),a}()},function(e,t){THREE.OBJExporter=function(){},THREE.OBJExporter.prototype={constructor:THREE.OBJExporter,parse:function(e){var t,r,n,i,a,o="",s=0,l=0,c=0,u=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector2,f=[];return e.traverse(function(e){e instanceof THREE.Mesh&&function(e){var n=0,p=0,m=0,v=e.geometry,g=new THREE.Matrix3;if(v instanceof THREE.Geometry&&(v=(new THREE.BufferGeometry).setFromObject(e)),v instanceof THREE.BufferGeometry){var y=v.getAttribute("position"),E=v.getAttribute("normal"),x=v.getAttribute("uv"),T=v.getIndex();if(o+="o "+e.name+"\n",e.material&&e.material.name&&(o+="usemtl "+e.material.name+"\n"),void 0!==y)for(t=0,i=y.count;t<i;t++,n++)u.x=y.getX(t),u.y=y.getY(t),u.z=y.getZ(t),u.applyMatrix4(e.matrixWorld),o+="v "+u.x+" "+u.y+" "+u.z+"\n";if(void 0!==x)for(t=0,i=x.count;t<i;t++,m++)d.x=x.getX(t),d.y=x.getY(t),o+="vt "+d.x+" "+d.y+"\n";if(void 0!==E)for(g.getNormalMatrix(e.matrixWorld),t=0,i=E.count;t<i;t++,p++)h.x=E.getX(t),h.y=E.getY(t),h.z=E.getZ(t),h.applyMatrix3(g).normalize(),o+="vn "+h.x+" "+h.y+" "+h.z+"\n";if(null!==T)for(t=0,i=T.count;t<i;t+=3){for(a=0;a<3;a++)r=T.getX(t+a)+1,f[a]=s+r+(E||x?"/"+(x?l+r:"")+(E?"/"+(c+r):""):"");o+="f "+f.join(" ")+"\n"}else for(t=0,i=y.count;t<i;t+=3){for(a=0;a<3;a++)r=t+a+1,f[a]=s+r+(E||x?"/"+(x?l+r:"")+(E?"/"+(c+r):""):"");o+="f "+f.join(" ")+"\n"}}else console.warn("THREE.OBJExporter.parseMesh(): geometry type unsupported",v);s+=n,l+=m,c+=p}(e),e instanceof THREE.Line&&function(e){var a=0,l=e.geometry,c=e.type;if(l instanceof THREE.Geometry&&(l=(new THREE.BufferGeometry).setFromObject(e)),l instanceof THREE.BufferGeometry){var h=l.getAttribute("position");if(o+="o "+e.name+"\n",void 0!==h)for(t=0,i=h.count;t<i;t++,a++)u.x=h.getX(t),u.y=h.getY(t),u.z=h.getZ(t),u.applyMatrix4(e.matrixWorld),o+="v "+u.x+" "+u.y+" "+u.z+"\n";if("Line"===c){for(o+="l ",r=1,i=h.count;r<=i;r++)o+=s+r+" ";o+="\n"}if("LineSegments"===c)for(n=1+(r=1),i=h.count;r<i;n=(r+=2)+1)o+="l "+(s+r)+" "+(s+n)+"\n"}else console.warn("THREE.OBJExporter.parseLine(): geometry type unsupported",l);s+=a}(e)}),o}}},function(e,t){THREE.MTLLoader=function(e){THREE.Loader.call(this,e)},THREE.MTLLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.MTLLoader,load:function(e,t,r,n){var i=this,a=""===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.load(e,function(e){t(i.parse(e,a))},r,n)},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var r=e.split("\n"),n={},i=/\s+/,a={},o=0;o<r.length;o++){var s=r[o];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var l=s.indexOf(" "),c=l>=0?s.substring(0,l):s;c=c.toLowerCase();var u=l>=0?s.substring(l+1):"";if(u=u.trim(),"newmtl"===c)n={name:u},a[u]=n;else if("ka"===c||"kd"===c||"ks"===c||"ke"===c){var h=u.split(i,3);n[c]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else n[c]=u}}var d=new THREE.MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(a),d}}),THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var n=e[r],i={};for(var a in t[r]=i,n){var o=!0,s=n[a],l=a.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(i[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,r=this.materialsInfo[e],n={name:e,side:this.side};function i(e,r){if(!n[e]){var i,a,o=t.getTextureParams(r,n),s=t.loadTexture((i=t.baseUrl,"string"!=typeof(a=o.url)||""===a?"":/^https?:\/\//i.test(a)?a:i+a));s.repeat.copy(o.scale),s.offset.copy(o.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,n[e]=s}}for(var a in r){var o,s=r[a];if(""!==s)switch(a.toLowerCase()){case"kd":n.color=(new THREE.Color).fromArray(s);break;case"ks":n.specular=(new THREE.Color).fromArray(s);break;case"ke":n.emissive=(new THREE.Color).fromArray(s);break;case"map_kd":i("map",s);break;case"map_ks":i("specularMap",s);break;case"map_ke":i("emissiveMap",s);break;case"norm":i("normalMap",s);break;case"map_bump":case"bump":i("bumpMap",s);break;case"map_d":i("alphaMap",s),n.transparent=!0;break;case"ns":n.shininess=parseFloat(s);break;case"d":(o=parseFloat(s))<1&&(n.opacity=o,n.transparent=!0);break;case"tr":o=parseFloat(s),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(n.opacity=1-o,n.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(n),this.materials[e]},getTextureParams:function(e,t){var r,n={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},i=e.split(/\s+/);return(r=i.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),(r=i.indexOf("-s"))>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),(r=i.indexOf("-o"))>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n},loadTexture:function(e,t,r,n,i){var a,o=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager,s=o.getHandler(e);return null===s&&(s=new THREE.TextureLoader(o)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),a=s.load(e,r,n,i),void 0!==t&&(a.mapping=t),a}}},function(e,t){THREE.STLLoader=function(e){THREE.Loader.call(this,e)},THREE.STLLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.STLLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){try{t(i.parse(e))}catch(e){n&&n(e)}},r,n)},parse:function(e){function t(e,t,r){for(var n=0,i=e.length;n<i;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}var r,n=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){var r;if(84+50*(r=new DataView(e)).getUint32(80,!0)===r.byteLength)return!0;for(var n=[115,111,108,105,100],i=0;i<5;i++)if(t(n,r,i))return!1;return!0}(n)?function(e){for(var t,r,n,i,a,o,s,l,c=new DataView(e),u=c.getUint32(80,!0),h=!1,d=0;d<70;d++)1129270351==c.getUint32(d,!1)&&82==c.getUint8(d+4)&&61==c.getUint8(d+5)&&(h=!0,i=new Float32Array(3*u*3),a=c.getUint8(d+6)/255,o=c.getUint8(d+7)/255,s=c.getUint8(d+8)/255,l=c.getUint8(d+9)/255);for(var f=new THREE.BufferGeometry,p=new Float32Array(3*u*3),m=new Float32Array(3*u*3),v=0;v<u;v++){var g=84+50*v,y=c.getFloat32(g,!0),E=c.getFloat32(g+4,!0),x=c.getFloat32(g+8,!0);if(h){var T=c.getUint16(g+48,!0);0==(32768&T)?(t=(31&T)/31,r=(T>>5&31)/31,n=(T>>10&31)/31):(t=a,r=o,n=s)}for(var b=1;b<=3;b++){var w=g+12*b,_=3*v*3+3*(b-1);p[_]=c.getFloat32(w,!0),p[_+1]=c.getFloat32(w+4,!0),p[_+2]=c.getFloat32(w+8,!0),m[_]=y,m[_+1]=E,m[_+2]=x,h&&(i[_]=t,i[_+1]=r,i[_+2]=n)}}return f.setAttribute("position",new THREE.BufferAttribute(p,3)),f.setAttribute("normal",new THREE.BufferAttribute(m,3)),h&&(f.setAttribute("color",new THREE.BufferAttribute(i,3)),f.hasColors=!0,f.alpha=l),f}(n):function(e){for(var t,r=new THREE.BufferGeometry,n=/solid([\s\S]*?)endsolid/g,i=/facet([\s\S]*?)endfacet/g,a=0,o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,s=new RegExp("vertex"+o+o+o,"g"),l=new RegExp("normal"+o+o+o,"g"),c=[],u=[],h=new THREE.Vector3,d=0,f=0,p=0;null!==(t=n.exec(e));){f=p;for(var m=t[0];null!==(t=i.exec(m));){for(var v=0,g=0,y=t[0];null!==(t=l.exec(y));)h.x=parseFloat(t[1]),h.y=parseFloat(t[2]),h.z=parseFloat(t[3]),g++;for(;null!==(t=s.exec(y));)c.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),u.push(h.x,h.y,h.z),v++,p++;1!==g&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+a),3!==v&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+a),a++}var E=f,x=p-f;r.addGroup(E,x,d),d++}return r.setAttribute("position",new THREE.Float32BufferAttribute(c,3)),r.setAttribute("normal",new THREE.Float32BufferAttribute(u,3)),r}("string"!=typeof(r=e)?THREE.LoaderUtils.decodeText(new Uint8Array(r)):r)}})},function(e,t){var r,n;THREE.STLExporter=function(){},THREE.STLExporter.prototype={constructor:THREE.STLExporter,parse:(r=new THREE.Vector3,n=new THREE.Matrix3,function(e,t){void 0===t&&(t={});var i=void 0!==t.binary&&t.binary,a=[],o=0;if(e.traverse(function(e){if(e.isMesh){var t=e.geometry;t.isBufferGeometry&&(t=(new THREE.Geometry).fromBufferGeometry(t)),t.isGeometry&&(o+=t.faces.length,a.push({geometry:t,matrixWorld:e.matrixWorld}))}}),i){var s=80,l=new ArrayBuffer(2*o+3*o*4*4+80+4);(E=new DataView(l)).setUint32(s,o,!0),s+=4;for(var c=0,u=a.length;c<u;c++){var h=(x=a[c]).geometry.vertices,d=x.geometry.faces,f=x.matrixWorld;n.getNormalMatrix(f);for(var p=0,m=d.length;p<m;p++){var v=d[p];r.copy(v.normal).applyMatrix3(n).normalize(),E.setFloat32(s,r.x,!0),s+=4,E.setFloat32(s,r.y,!0),s+=4,E.setFloat32(s,r.z,!0),s+=4;for(var g=[v.a,v.b,v.c],y=0;y<3;y++)r.copy(h[g[y]]).applyMatrix4(f),E.setFloat32(s,r.x,!0),s+=4,E.setFloat32(s,r.y,!0),s+=4,E.setFloat32(s,r.z,!0),s+=4;E.setUint16(s,0,!0),s+=2}}return E}var E="";for(E+="solid exported\n",c=0,u=a.length;c<u;c++){var x;for(h=(x=a[c]).geometry.vertices,d=x.geometry.faces,f=x.matrixWorld,n.getNormalMatrix(f),p=0,m=d.length;p<m;p++){for(v=d[p],r.copy(v.normal).applyMatrix3(n).normalize(),E+="\tfacet normal "+r.x+" "+r.y+" "+r.z+"\n",E+="\t\touter loop\n",g=[v.a,v.b,v.c],y=0;y<3;y++)r.copy(h[g[y]]).applyMatrix4(f),E+="\t\t\tvertex "+r.x+" "+r.y+" "+r.z+"\n";E+="\t\tendloop\n",E+="\tendfacet\n"}}return E+="endsolid exported\n"})}},function(e,t){THREE.PLYLoader=function(e){THREE.Loader.call(this,e),this.propertyNameMapping={}},THREE.PLYLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.PLYLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",r=0,n=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==n&&(t=n[1],r=n[0].length);var i,a,o,s,l,c,h={comments:[],elements:[],headerLength:r},d=t.split("\n");for(var f=0;f<d.length;f++){var p=d[f];if(""!==(p=p.trim()))switch(a=(o=p.split(/\s+/)).shift(),p=o.join(" "),a){case"format":h.format=o[0],h.version=o[1];break;case"comment":h.comments.push(p);break;case"element":void 0!==i&&h.elements.push(i),(i={}).name=o[0],i.count=parseInt(o[1]),i.properties=[];break;case"property":i.properties.push((s=o,l=u.propertyNameMapping,c=void 0,"list"===(c={type:s[0]}).type?(c.name=s[3],c.countType=s[1],c.itemType=s[2]):c.name=s[1],c.name in l&&(c.name=l[c.name]),c));break;default:console.log("unhandled",a,o)}}return void 0!==i&&h.elements.push(i),h}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function n(e,t){for(var n=t.split(/\s+/),i={},a=0;a<e.length;a++)if("list"===e[a].type){for(var o=[],s=r(n.shift(),e[a].countType),l=0;l<s;l++)o.push(r(n.shift(),e[a].itemType));i[e[a].name]=o}else i[e[a].name]=r(n.shift(),e[a].type);return i}function i(e,t){var r,i={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},s="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(s=r[1]);for(var l=s.split("\n"),c=0,u=0,h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim())){u>=t.elements[c].count&&(c++,u=0);var f=n(t.elements[c].properties,d);o(i,t.elements[c].name,f),u++}}return a(i)}function a(e){var t=new THREE.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).setAttribute("uv",new THREE.Float32BufferAttribute(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function o(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var n=r.vertex_indices||r.vertex_index,i=r.texcoord;3===n.length?(e.indices.push(n[0],n[1],n[2]),i&&6===i.length&&(e.faceVertexUvs.push(i[0],i[1]),e.faceVertexUvs.push(i[2],i[3]),e.faceVertexUvs.push(i[4],i[5]))):4===n.length&&(e.indices.push(n[0],n[1],n[3]),e.indices.push(n[1],n[2],n[3]))}}function s(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}}function l(e,t,r,n){for(var i,a={},o=0,l=0;l<r.length;l++)if("list"===r[l].type){var c=[],u=(i=s(e,t+o,r[l].countType,n))[0];o+=i[1];for(var h=0;h<u;h++)i=s(e,t+o,r[l].itemType,n),c.push(i[0]),o+=i[1];a[r[l].name]=c}else i=s(e,t+o,r[l].type,n),a[r[l].name]=i[0],o+=i[1];return[a,o]}var c,u=this;if(e instanceof ArrayBuffer){var h=THREE.LoaderUtils.decodeText(new Uint8Array(e)),d=t(h);c="ascii"===d.format?i(h,d):function(e,t){for(var r,n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="binary_little_endian"===t.format,s=new DataView(e,t.headerLength),c=0,u=0;u<t.elements.length;u++)for(var h=0;h<t.elements[u].count;h++){c+=(r=l(s,c,t.elements[u].properties,i))[1];var d=r[0];o(n,t.elements[u].name,d)}return a(n)}(e,d)}else c=i(e,t(e));return c}})},function(e,t){THREE.PLYExporter=function(){},THREE.PLYExporter.prototype={constructor:THREE.PLYExporter,parse:function(e,t,r){function n(t){e.traverse(function(e){if(!0===e.isMesh){var r=e,n=r.geometry;!0===n.isGeometry&&(n=a.get(n)),!0===n.isBufferGeometry&&void 0!==n.getAttribute("position")&&t(r,n)}})}t&&"object"==typeof t&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),r=t,t=void 0);var i=(r=Object.assign({binary:!1,excludeAttributes:[]},r)).excludeAttributes,a=new WeakMap,o=!1,s=!1,l=!1,c=0,u=0;e.traverse(function(e){if(!0===e.isMesh){var t=e,r=t.geometry;if(!0===r.isGeometry){var n=a.get(r)||(new THREE.BufferGeometry).setFromObject(t);a.set(r,n),r=n}if(!0===r.isBufferGeometry){var i=r.getAttribute("position"),h=r.getAttribute("normal"),d=r.getAttribute("uv"),f=r.getAttribute("color"),p=r.getIndex();if(void 0===i)return;c+=i.count,u+=p?p.count/3:i.count/3,void 0!==h&&(o=!0),void 0!==d&&(l=!0),void 0!==f&&(s=!0)}}});var h=-1===i.indexOf("index");if(o=o&&-1===i.indexOf("normal"),s=s&&-1===i.indexOf("color"),l=l&&-1===i.indexOf("uv"),h&&u!==Math.floor(u))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;var d="ply\n"+`format ${r.binary?"binary_big_endian":"ascii"} 1.0\n`+`element vertex ${c}\n`+"property float x\nproperty float y\nproperty float z\n";!0===o&&(d+="property float nx\nproperty float ny\nproperty float nz\n"),!0===l&&(d+="property float s\nproperty float t\n"),!0===s&&(d+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===h&&(d+=`element face ${u}\n`+"property list uchar int vertex_index\n"),d+="end_header\n";var f=new THREE.Vector3,p=new THREE.Matrix3,m=null;if(!0===r.binary){var v=(new TextEncoder).encode(d),g=c*(12+(o?12:0)+(s?3:0)+(l?8:0)),y=h?13*u:0,E=new DataView(new ArrayBuffer(v.length+g+y));new Uint8Array(E.buffer).set(v,0);var x=v.length,T=v.length+g,b=0;n(function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),i=t.getAttribute("uv"),a=t.getAttribute("color"),c=t.getIndex();p.getNormalMatrix(e.matrixWorld);for(var u=0,d=r.count;u<d;u++)f.x=r.getX(u),f.y=r.getY(u),f.z=r.getZ(u),f.applyMatrix4(e.matrixWorld),E.setFloat32(x,f.x),x+=4,E.setFloat32(x,f.y),x+=4,E.setFloat32(x,f.z),x+=4,!0===o&&(null!=n?(f.x=n.getX(u),f.y=n.getY(u),f.z=n.getZ(u),f.applyMatrix3(p).normalize(),E.setFloat32(x,f.x),x+=4,E.setFloat32(x,f.y),x+=4,E.setFloat32(x,f.z),x+=4):(E.setFloat32(x,0),x+=4,E.setFloat32(x,0),x+=4,E.setFloat32(x,0),x+=4)),!0===l&&(null!=i?(E.setFloat32(x,i.getX(u)),x+=4,E.setFloat32(x,i.getY(u)),x+=4):!1!==l&&(E.setFloat32(x,0),x+=4,E.setFloat32(x,0),x+=4)),!0===s&&(null!=a?(E.setUint8(x,Math.floor(255*a.getX(u))),x+=1,E.setUint8(x,Math.floor(255*a.getY(u))),x+=1,E.setUint8(x,Math.floor(255*a.getZ(u))),x+=1):(E.setUint8(x,255),x+=1,E.setUint8(x,255),x+=1,E.setUint8(x,255),x+=1));if(!0===h)if(null!==c)for(u=0,d=c.count;u<d;u+=3)E.setUint8(T,3),T+=1,E.setUint32(T,c.getX(u+0)+b),T+=4,E.setUint32(T,c.getX(u+1)+b),T+=4,E.setUint32(T,c.getX(u+2)+b),T+=4;else for(u=0,d=r.count;u<d;u+=3)E.setUint8(T,3),T+=1,E.setUint32(T,b+u),T+=4,E.setUint32(T,b+u+1),T+=4,E.setUint32(T,b+u+2),T+=4;b+=r.count}),m=E.buffer}else{b=0;var w="",_="";n(function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),i=t.getAttribute("uv"),a=t.getAttribute("color"),c=t.getIndex();p.getNormalMatrix(e.matrixWorld);for(var d=0,m=r.count;d<m;d++){f.x=r.getX(d),f.y=r.getY(d),f.z=r.getZ(d),f.applyMatrix4(e.matrixWorld);var v=f.x+" "+f.y+" "+f.z;!0===o&&(null!=n?(f.x=n.getX(d),f.y=n.getY(d),f.z=n.getZ(d),f.applyMatrix3(p).normalize(),v+=" "+f.x+" "+f.y+" "+f.z):v+=" 0 0 0"),!0===l&&(null!=i?v+=" "+i.getX(d)+" "+i.getY(d):!1!==l&&(v+=" 0 0")),!0===s&&(v+=null!=a?" "+Math.floor(255*a.getX(d))+" "+Math.floor(255*a.getY(d))+" "+Math.floor(255*a.getZ(d)):" 255 255 255"),w+=v+"\n"}if(!0===h){if(null!==c)for(d=0,m=c.count;d<m;d+=3)_+=`3 ${c.getX(d+0)+b}`,_+=` ${c.getX(d+1)+b}`,_+=` ${c.getX(d+2)+b}\n`;else for(d=0,m=r.count;d<m;d+=3)_+=`3 ${b+d} ${b+d+1} ${b+d+2}\n`;u+=c?c.count/3:r.count/3}b+=r.count}),m=`${d}${w}${h?`${_}\n`:"\n"}`}return"function"==typeof t&&requestAnimationFrame(()=>t(m)),m}}},function(e,t){THREE.ColladaLoader=function(e){THREE.Loader.call(this,e)},THREE.ColladaLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.ColladaLoader,load:function(e,t,r,n){var i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(i.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(e,a))},r,n)},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(e,t){function r(e,t){for(var r=[],n=e.childNodes,i=0,a=n.length;i<a;i++){var o=n[i];o.nodeName===t&&r.push(o)}return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseFloat(t[n]);return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseInt(t[n]);return r}function o(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function c(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,n,i){var a=r(e,t)[0];if(void 0!==a)for(var o=r(a,n),s=0;s<o.length;s++)i(o[s])}function h(e,t){for(var r in e){e[r].build=t(e[r])}}function d(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function f(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=o(i.getAttribute("source")),s=i.getAttribute("semantic");t.inputs[s]=a}}return t}function p(e){var t={},r=e.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),a=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)r=i.split("."),i=r.shift(),t.member=r.shift();else if(a){var l=i.split("(");i=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=i,t.arraySyntax=a,t.memberSyntax=s,t.sampler=o(e.getAttribute("source")),t}function m(e){var t=[],r=e.channels,n=e.samplers,i=e.sources;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a],s=n[o.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT;T(g(o,i[l],i[c]),t)}return t}function v(e){return d(Qe.animations[e],m)}function g(e,t,r){var n,i,a,o,s,l,c=Qe.nodes[e.id],u=Ne(c.id),h=c.transforms[e.sid],d=c.matrix.clone().transpose(),f={};switch(h){case"matrix":for(a=0,o=t.array.length;a<o;a++)if(n=t.array[a],i=a*r.stride,void 0===f[n]&&(f[n]={}),!0===e.arraySyntax){var p=r.array[i],m=e.indices[0]+4*e.indices[1];f[n][m]=p}else for(s=0,l=r.stride;s<l;s++)f[n][s]=r.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var v=function(e,t){var r=[];for(var n in e)r.push({time:parseFloat(n),value:e[n]});r.sort(function(e,t){return e.time-t.time});for(var i=0;i<16;i++)b(r,i,t.elements[i]);return r}(f,d);return{name:u.uuid,keyframes:v}}var y=new THREE.Vector3,E=new THREE.Vector3,x=new THREE.Quaternion;function T(e,t){for(var r=e.keyframes,n=e.name,i=[],a=[],o=[],s=[],l=0,c=r.length;l<c;l++){var u=r[l],h=u.time,d=u.value;_e.fromArray(d).transpose(),_e.decompose(y,x,E),i.push(h),a.push(y.x,y.y,y.z),o.push(x.x,x.y,x.z,x.w),s.push(E.x,E.y,E.z)}return a.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",i,a)),o.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",i,o)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",i,s)),t}function b(e,t,r){var n,i,a,o=!0;for(i=0,a=e.length;i<a;i++)void 0===(n=e[i]).value[t]?n.value[t]=null:o=!1;if(!0===o)for(i=0,a=e.length;i<a;i++)(n=e[i]).value[t]=r;else!function(e,t){for(var r,n,i=0,a=e.length;i<a;i++){var o=e[i];if(null===o.value[t]){if(r=w(e,i,t),n=_(e,i,t),null===r){o.value[t]=n.value[t];continue}if(null===n){o.value[t]=r.value[t];continue}R(o,r,n,t)}}}(e,t)}function w(e,t,r){for(;t>=0;){var n=e[t];if(null!==n.value[r])return n;t--}return null}function _(e,t,r){for(;t<e.length;){var n=e[t];if(null!==n.value[r])return n;t++}return null}function R(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function M(e){for(var t=[],r=e.name,n=e.end-e.start||-1,i=e.animations,a=0,o=i.length;a<o;a++)for(var s=v(i[a]),l=0,c=s.length;l<c;l++)t.push(s[l]);return new THREE.AnimationClip(r,n,t)}function S(e){return d(Qe.clips[e],M)}function A(e){for(var t={sources:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(a.textContent);break;case"source":var o=a.getAttribute("id");t.sources[o]=ie(a);break;case"joints":t.joints=L(a);break;case"vertex_weights":t.vertexWeights=P(a)}}return t}function L(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),s=o(i.getAttribute("source"));t.inputs[a]=s}}return t}function P(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),l=o(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));t.inputs[s]={id:l,offset:c};break;case"vcount":t.vcount=a(i.textContent);break;case"v":t.v=a(i.textContent)}}return t}function C(e){var t={id:e.id},r=Qe.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,r,n,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},a=e.sources,o=e.vertexWeights,s=o.vcount,l=o.v,c=o.inputs.JOINT.offset,u=o.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=a[o.inputs.WEIGHT.id].array,p=0;for(t=0,n=s.length;t<n;t++){var m=s[t],v=[];for(r=0;r<m;r++){var g=l[p+c],y=l[p+u],E=f[y];v.push({index:g,weight:E}),p+=2}for(v.sort(w),r=0;r<4;r++){var x=v[r];void 0!==x?(i.indices.array.push(x.index),i.weights.array.push(x.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}e.bindShapeMatrix?i.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():i.bindMatrix=(new THREE.Matrix4).identity();for(t=0,n=h.array.length;t<n;t++){var T=h.array[t],b=(new THREE.Matrix4).fromArray(d.array,t*d.stride).transpose();i.joints.push({name:T,boneInverse:b})}return i;function w(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function H(e){return void 0!==e.build?e.build:e.init_from}function I(e){var t=Qe.images[e];return void 0!==t?d(t,H):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function k(e){for(var t={surfaces:{},samplers:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":N(i,t);break;case"technique":t.technique=D(i);break;case"extra":t.extra=j(i)}}return t}function N(e,t){for(var r=e.getAttribute("sid"),n=0,i=e.childNodes.length;n<i;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[r]=O(a);break;case"sampler2D":t.samplers[r]=F(a)}}}function O(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":t.init_from=i.textContent}}return t}function F(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":t.source=i.textContent}}return t}function D(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=U(i)}}return t}function U(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=z(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:z(i)}}}return t}function z(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":t[a.nodeName]=i(a.textContent);break;case"float":t[a.nodeName]=parseFloat(a.textContent);break;case"texture":t[a.nodeName]={id:a.getAttribute("texture"),extra:B(a)}}}return t}function B(e){for(var t={technique:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":G(i,t)}}return t}function G(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":V(i,t)}}}function V(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function j(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":t.technique=W(i)}}return t}function W(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent)}}return t}function X(e){return e}function Y(e){var t,r,n=(t=e.url,d(Qe.effects[t],X)),i=n.profile.technique,a=n.profile.extra;switch(i.type){case"phong":case"blinn":r=new THREE.MeshPhongMaterial;break;case"lambert":r=new THREE.MeshLambertMaterial;break;default:r=new THREE.MeshBasicMaterial}function o(e){var t=n.profile.samplers[e.id],r=null;void 0!==t?r=I(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=I(e.id));if(null!==r){var i=function(e){var t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":t=je;break;default:t=Xe}return t}(r);if(void 0!==i){var a=i.load(r),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===s(o.technique)){var l=o.technique;a.wrapS=l.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.wrapT=l.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.offset.set(l.offsetU||0,l.offsetV||0),a.repeat.set(l.repeatU||1,l.repeatV||1)}else a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping;return a}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name||"";var l=i.parameters;for(var c in l){var u=l[c];switch(c){case"diffuse":u.color&&r.color.fromArray(u.color),u.texture&&(r.map=o(u.texture));break;case"specular":u.color&&r.specular&&r.specular.fromArray(u.color),u.texture&&(r.specularMap=o(u.texture));break;case"bump":u.texture&&(r.normalMap=o(u.texture));break;case"ambient":u.texture&&(r.lightMap=o(u.texture));break;case"shininess":u.float&&r.shininess&&(r.shininess=u.float);break;case"emission":u.color&&r.emissive&&r.emissive.fromArray(u.color),u.texture&&(r.emissiveMap=o(u.texture))}}var h=l.transparent,f=l.transparency;if(void 0===f&&h&&(f={float:1}),void 0===h&&f&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&f)if(h.data.texture)r.transparent=!0;else{var p=h.data.color;switch(h.opaque){case"A_ONE":r.opacity=p[3]*f.float;break;case"RGB_ZERO":r.opacity=1-p[0]*f.float;break;case"A_ZERO":r.opacity=1-p[3]*f.float;break;case"RGB_ONE":r.opacity=p[0]*f.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==a&&void 0!==a.technique&&1===a.technique.double_sided&&(r.side=THREE.DoubleSide),r}function q(e){return d(Qe.materials[e],Y)}function Z(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return Q(r)}}return{}}function Q(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=K(n)}}return t}function K(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function J(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,n*=.5,r*=.5,t=new THREE.OrthographicCamera(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name||"",t}function $(e){var t=Qe.cameras[e];return void 0!==t?d(t,J):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=te(i)}}return t}function te(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":var o=i(a.textContent);t.color=(new THREE.Color).fromArray(o);break;case"falloff_angle":t.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var s=parseFloat(a.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function re(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=Qe.lights[e];return void 0!==t?d(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ie(e){for(var t={array:[],stride:3},a=0;a<e.childNodes.length;a++){var o=e.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=n(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ae(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=o(n.getAttribute("source")))}return t}function oe(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=o(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset")),u=parseInt(i.getAttribute("set")),h=u>0?l+u:l;t.inputs[h]={id:s,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=a(i.textContent);break;case"p":t.p=a(i.textContent)}}return t}function se(e){for(var t=0,r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},r=e.sources,n=e.vertices,i=e.primitives;if(0===i.length)return{};var a=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(i);for(var o in a){var s=a[o];se(s),t[o]=ce(s,r,n)}return t}function ce(e,t,r){for(var n={},i={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c=[],u=4,h=[],d=4,f=new THREE.BufferGeometry,p=[],m=0,v=0;v<e.length;v++){var g=e[v],y=g.inputs,E=0;switch(g.type){case"lines":case"linestrips":E=2*g.count;break;case"triangles":E=3*g.count;break;case"polylist":for(var x=0;x<g.count;x++){var T=g.vcount[x];switch(T){case 3:E+=3;break;case 4:E+=6;break;default:E+=3*(T-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",g.type)}for(var b in f.addGroup(m,E,v),m+=E,g.material&&p.push(g.material),y){var w=y[b];switch(b){case"VERTEX":for(var _ in r){var R=r[_];switch(_){case"POSITION":var M=i.array.length;if(ue(g,t[R],w.offset,i.array),i.stride=t[R].stride,t.skinWeights&&t.skinIndices&&(ue(g,t.skinIndices,w.offset,c),ue(g,t.skinWeights,w.offset,h)),!1===g.hasUV&&!0===e.uvsNeedsFix){E=(i.array.length-M)/i.stride;for(var S=0;S<E;S++)o.array.push(0,0)}break;case"NORMAL":ue(g,t[R],w.offset,a.array),a.stride=t[R].stride;break;case"COLOR":ue(g,t[R],w.offset,l.array),l.stride=t[R].stride;break;case"TEXCOORD":ue(g,t[R],w.offset,o.array),o.stride=t[R].stride;break;case"TEXCOORD1":ue(g,t[R],w.offset,s.array),o.stride=t[R].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',_)}}break;case"NORMAL":ue(g,t[w.id],w.offset,a.array),a.stride=t[w.id].stride;break;case"COLOR":ue(g,t[w.id],w.offset,l.array),l.stride=t[w.id].stride;break;case"TEXCOORD":ue(g,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"TEXCOORD1":ue(g,t[w.id],w.offset,s.array),s.stride=t[w.id].stride}}}return i.array.length>0&&f.setAttribute("position",new THREE.Float32BufferAttribute(i.array,i.stride)),a.array.length>0&&f.setAttribute("normal",new THREE.Float32BufferAttribute(a.array,a.stride)),l.array.length>0&&f.setAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),o.array.length>0&&f.setAttribute("uv",new THREE.Float32BufferAttribute(o.array,o.stride)),s.array.length>0&&f.setAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),c.length>0&&f.setAttribute("skinIndex",new THREE.Float32BufferAttribute(c,u)),h.length>0&&f.setAttribute("skinWeight",new THREE.Float32BufferAttribute(h,d)),n.data=f,n.type=e[0].type,n.materialKeys=p,n}function ue(e,t,r,n){var i=e.p,a=e.stride,o=e.vcount;function s(e){for(var t=i[e+r]*c,a=t+c;t<a;t++)n.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var u=0,h=0,d=o.length;h<d;h++){var f=o[h];if(4===f){var p=u+1*a,m=u+2*a,v=u+3*a;s(u+0*a),s(p),s(v),s(p),s(m),s(v)}else if(3===f){p=u+1*a,m=u+2*a;s(u+0*a),s(p),s(m)}else if(f>4)for(var g=1,y=f-2;g<=y;g++){p=u+a*g,m=u+a*(g+1);s(u+0*a),s(p),s(m)}u+=a*f}else for(h=0,d=i.length;h<d;h+=a)s(h)}function he(e){return d(Qe.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function fe(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=pe(n);break;case"link":t.links.push(ve(n))}}}function pe(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var a=i(n.textContent);t.axis.fromArray(a);break;case"limits":var o=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(o.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ge(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ge(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ye(e){var t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(r),t.angle=THREE.MathUtils.degToRad(r[3])}return t}function Ee(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":xe(n,t)}}}function xe(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=i(n.textContent);break;case"mass":t.mass=i(n.textContent)[0]}}}function Te(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];t.axis=i.textContent;var a=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=a.substr(0,a.length-1)}}return t}function be(e){return void 0!==e.build?e.build:e}function we(e){for(var t=[],r=Ue.querySelector('[id="'+e.id+'"]'),n=0;n<r.childNodes.length;n++){var a=r.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"matrix":var o=i(a.textContent),s=(new THREE.Matrix4).fromArray(o).transpose();t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:s});break;case"translate":case"scale":o=i(a.textContent);var l=(new THREE.Vector3).fromArray(o);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"rotate":o=i(a.textContent),l=(new THREE.Vector3).fromArray(o);var c=THREE.MathUtils.degToRad(o[3]);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l,angle:c})}}return t}var _e=new THREE.Matrix4,Re=new THREE.Vector3;function Me(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Me(n);break;case"instance_camera":t.instanceCameras.push(o(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Se(n));break;case"instance_light":t.instanceLights.push(o(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Se(n));break;case"instance_node":t.instanceNodes.push(o(n.getAttribute("url")));break;case"matrix":var a=i(n.textContent);t.matrix.multiply(_e.fromArray(a).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":a=i(n.textContent);Re.fromArray(a),t.matrix.multiply(_e.makeTranslation(Re.x,Re.y,Re.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":a=i(n.textContent);var s=THREE.MathUtils.degToRad(a[3]);t.matrix.multiply(_e.makeRotationAxis(Re.fromArray(a),s)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":a=i(n.textContent);t.matrix.scale(Re.fromArray(a)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return ke(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Qe.nodes[t.id]=t,t}function Se(e){for(var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),a=0;a<i.length;a++){var s=i[a],l=s.getAttribute("symbol"),c=s.getAttribute("target");t.materials[l]=o(c)}break;case"skeleton":t.skeletons.push(o(n.textContent))}}return t}function Ae(e,t){var r,n,i,a=[],o=[];for(r=0;r<e.length;r++){var s=e[r];if(ke(s))Le(Ne(s),t,a);else if(i=s,void 0!==Qe.visualScenes[i])for(var l=Qe.visualScenes[s].children,c=0;c<l.length;c++){var u=l[c];if("JOINT"===u.type)Le(Ne(u.id),t,a)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<t.length;r++)for(c=0;c<a.length;c++)if((n=a[c]).bone.name===t[r].name){o[r]=n,n.processed=!0;break}for(r=0;r<a.length;r++)!1===(n=a[r]).processed&&(o.push(n),n.processed=!0);var h=[],d=[];for(r=0;r<o.length;r++)n=o[r],h.push(n.bone),d.push(n.boneInverse);return new THREE.Skeleton(h,d)}function Le(e,t,r){e.traverse(function(e){if(!0===e.isBone){for(var n,i=0;i<t.length;i++){var a=t[i];if(a.name===e.name){n=a.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),r.push({bone:e,boneInverse:n,processed:!1})}})}function Pe(e){for(var t,r=[],n=e.matrix,i=e.nodes,a=e.type,o=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes,h=0,f=i.length;h<f;h++)r.push(Ne(i[h]));for(h=0,f=o.length;h<f;h++){var p=$(o[h]);null!==p&&r.push(p.clone())}for(h=0,f=s.length;h<f;h++)for(var m=s[h],v=(t=m.id,d(Qe.controllers[t],C)),g=Ie(he(v.id),m.materials),y=Ae(m.skeletons,v.skin.joints),E=0,x=g.length;E<x;E++){var T;(T=g[E]).isSkinnedMesh&&(T.bind(y,v.skin.bindMatrix),T.normalizeSkinWeights()),r.push(T)}for(h=0,f=l.length;h<f;h++){var b=ne(l[h]);null!==b&&r.push(b.clone())}for(h=0,f=c.length;h<f;h++)for(E=0,x=(g=Ie(he((m=c[h]).id),m.materials)).length;E<x;E++)r.push(g[E]);for(h=0,f=u.length;h<f;h++)r.push(Ne(u[h]).clone());if(0===i.length&&1===r.length)T=r[0];else{T="JOINT"===a?new THREE.Bone:new THREE.Group;for(h=0;h<r.length;h++)T.add(r[h])}return""===T.name&&(T.name="JOINT"===a?e.sid:e.name),T.matrix.copy(n),T.matrix.decompose(T.position,T.quaternion,T.scale),T}var Ce=new THREE.MeshBasicMaterial({color:16711935});function He(e,t){for(var r=[],n=0,i=e.length;n<i;n++){var a=t[e[n]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Ce)):r.push(q(a))}return r}function Ie(e,t){var r=[];for(var n in e){var i=e[n],a=He(i.materialKeys,t);0===a.length&&("lines"===n||"linestrips"===n?a.push(new THREE.LineBasicMaterial):a.push(new THREE.MeshPhongMaterial));var o=void 0!==i.data.attributes.skinIndex;if(o)for(var s=0,l=a.length;s<l;s++)a[s].skinning=!0;var c,u=1===a.length?a[0]:a;switch(n){case"lines":c=new THREE.LineSegments(i.data,u);break;case"linestrips":c=new THREE.Line(i.data,u);break;case"triangles":case"polylist":c=o?new THREE.SkinnedMesh(i.data,u):new THREE.Mesh(i.data,u)}r.push(c)}return r}function ke(e){return void 0!==Qe.nodes[e]}function Ne(e){return d(Qe.nodes[e],Pe)}function Oe(e){var t=new THREE.Group;t.name=e.name;for(var r=e.children,n=0;n<r.length;n++){var i=r[n];t.add(Ne(i.id))}return t}function Fe(e){return d(Qe.visualScenes[e],Oe)}if(0===e.length)return{scene:new THREE.Scene};var De=(new DOMParser).parseFromString(e,"application/xml"),Ue=r(De,"COLLADA")[0],ze=De.getElementsByTagName("parsererror")[0];if(void 0!==ze){var Be,Ge=r(ze,"div")[0];return Be=Ge?Ge.textContent:function(e){for(var t="",r=[e];r.length;){var n=r.shift();n.nodeType===Node.TEXT_NODE?t+=n.textContent:(t+="\n",r.push.apply(r,n.childNodes))}return t.trim()}(ze),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",Be),null}var Ve=Ue.getAttribute("version");console.log("THREE.ColladaLoader: File version",Ve);var je,We=function(e){return{unit:l(r(e,"unit")[0]),upAxis:c(r(e,"up_axis")[0])}}(r(Ue,"asset")[0]),Xe=new THREE.TextureLoader(this.manager);Xe.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(je=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var Ye=[],qe={},Ze=0,Qe={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(Ue,"library_animations","animation",function(e){for(var t={sources:{},samplers:{},channels:{}},r=0,n=e.childNodes.length;r<n;r++){var i,a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"source":i=a.getAttribute("id"),t.sources[i]=ie(a);break;case"sampler":i=a.getAttribute("id"),t.samplers[i]=f(a);break;case"channel":i=a.getAttribute("target"),t.channels[i]=p(a);break;default:console.log(a)}}Qe.animations[e.getAttribute("id")]=t}),u(Ue,"library_animation_clips","animation_clip",function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":t.animations.push(o(i.getAttribute("url")))}}Qe.clips[e.getAttribute("id")]=t}),u(Ue,"library_controllers","controller",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=o(i.getAttribute("source")),t.skin=A(i);break;case"morph":t.id=o(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Qe.controllers[e.getAttribute("id")]=t}),u(Ue,"library_images","image",function(e){var t={init_from:r(e,"init_from")[0].textContent};Qe.images[e.getAttribute("id")]=t}),u(Ue,"library_effects","effect",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":t.profile=k(i)}}Qe.effects[e.getAttribute("id")]=t}),u(Ue,"library_materials","material",function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":t.url=o(i.getAttribute("url"))}}Qe.materials[e.getAttribute("id")]=t}),u(Ue,"library_cameras","camera",function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":t.optics=Z(i)}}Qe.cameras[e.getAttribute("id")]=t}),u(Ue,"library_lights","light",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":t=ee(i)}}Qe.lights[e.getAttribute("id")]=t}),u(Ue,"library_geometries","geometry",function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var a=n.childNodes[i];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":t.sources[o]=ie(a);break;case"vertices":t.vertices=ae(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(oe(a));break;default:console.log(a)}}}Qe.geometries[e.getAttribute("id")]=t}}),u(Ue,"library_nodes","node",Me),u(Ue,"library_visual_scenes","visual_scene",function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var n=t[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Ze++)}}(e);for(var n=r(e,"node"),i=0;i<n.length;i++)t.children.push(Me(n[i]));Qe.visualScenes[e.getAttribute("id")]=t}),u(Ue,"library_kinematics_models","kinematics_model",function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":fe(n,t)}}Qe.kinematicsModels[e.getAttribute("id")]=t}),u(Ue,"library_physics_models","physics_model",function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},Ee(n,t.rigidBodies[n.getAttribute("name")])}}Qe.physicsModels[e.getAttribute("id")]=t}),u(Ue,"scene","instance_kinematics_scene",function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Te(n))}}Qe.kinematicsScenes[o(e.getAttribute("url"))]=t}),h(Qe.animations,m),h(Qe.clips,M),h(Qe.controllers,C),h(Qe.images,H),h(Qe.effects,X),h(Qe.materials,Y),h(Qe.cameras,J),h(Qe.lights,re),h(Qe.geometries,le),h(Qe.visualScenes,Oe),function(){var e=Qe.clips;if(!0===s(e)){if(!1===s(Qe.animations)){var t=[];for(var r in Qe.animations)for(var n=v(r),i=0,a=n.length;i<a;i++)t.push(n[i]);Ye.push(new THREE.AnimationClip("default",-1,t))}}else for(var r in e)Ye.push(S(r))}(),function(){var e=Object.keys(Qe.kinematicsModels)[0],t=Object.keys(Qe.kinematicsScenes)[0],r=Object.keys(Qe.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,i=(n=e,d(Qe.kinematicsModels[n],de)),a=function(e){return d(Qe.kinematicsScenes[e],be)}(t),o=Fe(r),s=a.bindJointAxis,l={},c=0,u=s.length;c<u;c++){var h=s[c],f=Ue.querySelector('[sid="'+h.target+'"]');if(f){var p=f.parentElement;v(h.jointIndex,p)}}var m=new THREE.Matrix4;qe={joints:i&&i.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=l[e];if(r){var n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=r.object,a=n.axis,o=r.transforms;_e.identity();for(var s=0;s<o.length;s++){var c=o[s];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":_e.multiply(m.makeRotationAxis(a,THREE.MathUtils.degToRad(t)));break;case"prismatic":_e.multiply(m.makeTranslation(a.x*t,a.y*t,a.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":_e.multiply(c.obj);break;case"translate":_e.multiply(m.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":_e.scale(c.obj);break;case"rotate":_e.multiply(m.makeRotationAxis(c.obj,c.angle))}}i.matrix.copy(_e),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var r=t.getAttribute("name"),n=i.joints[e];o.traverse(function(i){i.name===r&&(l[e]={object:i,transforms:we(t),joint:n,position:n.zeroPosition})})}}();var Ke=function(e){return Fe(o(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(Ue,"scene")[0]);return"Z_UP"===We.upAxis&&Ke.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Ke.scale.multiplyScalar(We.unit),{animations:Ye,kinematics:qe,library:Qe,scene:Ke}}})},function(e,t){THREE.ColladaExporter=function(){},THREE.ColladaExporter.prototype={constructor:THREE.ColladaExporter,parse:function(e,t,r){r=r||{},""!==(r=Object.assign({version:"1.4.1",author:null,textureDirectory:""},r)).textureDirectory&&(r.textureDirectory=`${r.textureDirectory}/`.replace(/\\/g,"/").replace(/\/+/g,"/"));var n,i,a=r.version;if("1.4.1"!==a&&"1.5.0"!==a)return console.warn(`ColladaExporter : Version ${a} not supported for export. Only 1.4.1 and 1.5.0.`),null;function o(e,t){return n=n||document.createElement("canvas"),i=i||n.getContext("2d"),n.width=e.naturalWidth,n.height=e.naturalHeight,i.drawImage(e,0,0),function(e){for(var t=atob(e),r=new Uint8Array(t.length),n=0,i=r.length;n<i;n++)r[n]=t.charCodeAt(n);return r}(n.toDataURL(`image/${t}`,1).replace(/^data:image\/(png|jpg);base64,/,""))}var s,l=["getX","getY","getZ","getW"];function c(e){if(e.isInterleavedBufferAttribute){for(var t=new e.array.constructor(e.count*e.itemSize),r=e.itemSize,n=0,i=e.count;n<i;n++)for(var a=0;a<r;a++)t[n*r+a]=e[l[a]](n);return t}return e.array}function u(e,t,r,n){var i=c(e);return`<source id="${t}">`+`<float_array id="${t}-array" count="${i.length}">`+i.join(" ")+"</float_array><technique_common>"+`<accessor source="#${t}-array" count="${Math.floor(i.length/e.itemSize)}" stride="${e.itemSize}">`+r.map(e=>`<param name="${e}" type="${n}" />`).join("")+"</accessor></technique_common></source>"}function h(e){var t=p.get(e);if(null==t){t=`image-${v.length+1}`;var n=e.name||t,i=`<image id="${t}" name="${n}">`;i+="1.5.0"===a?`<init_from><ref>${r.textureDirectory}${n}.png</ref></init_from>`:`<init_from>${r.textureDirectory}${n}.png</init_from>`,i+="</image>",v.push(i),p.set(e,t),m.push({directory:r.textureDirectory,name:n,ext:"png",data:o(e.image,"png"),original:e})}return t}var d=new WeakMap,f=new WeakMap,p=new WeakMap,m=[],v=[],g=[],y=[],E=[],x=function e(t){var r=`<node name="${t.name}">`;if(r+=function(e){return e.updateMatrix(),(s=s||new THREE.Matrix4).copy(e.matrix),s.transpose(),`<matrix>${s.toArray().join(" ")}</matrix>`}(t),t instanceof THREE.Mesh&&null!=t.geometry){var n=function(e){var t,r,n,i=d.get(e);if(!i){var a=e;a instanceof THREE.Geometry&&(a=(new THREE.BufferGeometry).fromGeometry(a));var o=`Mesh${g.length+1}`,s=a.index?a.index.count*a.index.itemSize:a.attributes.position.count,l=null!=a.groups&&0!==a.groups.length?a.groups:[{start:0,count:s,materialIndex:0}],h=`<geometry id="${o}"${e.name?` name="${e.name}"`:""}><mesh>`,f=`${o}-position`,p=`${o}-vertices`;h+=u(a.attributes.position,f,["X","Y","Z"],"float"),h+=`<vertices id="${p}"><input semantic="POSITION" source="#${f}" /></vertices>`;var m=`<input semantic="VERTEX" source="#${p}" offset="0" />`;if("normal"in a.attributes){var v=`${o}-normal`;h+=u(a.attributes.normal,v,["X","Y","Z"],"float"),m+=`<input semantic="NORMAL" source="#${v}" offset="0" />`}if("uv"in a.attributes){var y=`${o}-texcoord`;h+=u(a.attributes.uv,y,["S","T"],"float"),m+=`<input semantic="TEXCOORD" source="#${y}" offset="0" set="0" />`}if("color"in a.attributes){var E=`${o}-color`;h+=u(a.attributes.color,E,["X","Y","Z"],"uint8"),m+=`<input semantic="COLOR" source="#${E}" offset="0" />`}var x=null;if(a.index)x=c(a.index);else for(var T=0,b=(x=new Array(s)).length;T<b;T++)x[T]=T;for(T=0,b=l.length;T<b;T++){var w=l[T],_=(t=x,r=w.start,n=w.count,Array.isArray(t)?t.slice(r,r+n):new t.constructor(t.buffer,r*t.BYTES_PER_ELEMENT,n)),R=_.length/3;h+=`<triangles material="MESH_MATERIAL_${w.materialIndex}" count="${R}">`,h+=m,h+=`<p>${_.join(" ")}</p>`,h+="</triangles>"}h+="</mesh></geometry>",g.push(h),i={meshid:o,bufferGeometry:a},d.set(e,i)}return i}(t.geometry),i=n.meshid,a=n.bufferGeometry,o=null,l=t.material||new THREE.MeshBasicMaterial,p=Array.isArray(l)?l:[l];o=(a.groups.length>p.length?new Array(a.groups.length):new Array(p.length)).fill().map((e,t)=>(function(e){var t=f.get(e);if(null==t){t=`Mat${y.length+1}`;var r="phong";e instanceof THREE.MeshLambertMaterial?r="lambert":e instanceof THREE.MeshBasicMaterial&&(r="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial."));var n=e.emissive?e.emissive:new THREE.Color(0,0,0),i=e.color?e.color:new THREE.Color(0,0,0),a=e.specular?e.specular:new THREE.Color(1,1,1),o=e.shininess||0,s=e.reflectivity||0,l="";!0===e.transparent&&(l+="<transparent>"+(e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",e.opacity<1&&(l+=`<transparency><float>${e.opacity}</float></transparency>`));var c=`<technique sid="common"><${r}>`+"<emission>"+(e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':`<color sid="emission">${n.r} ${n.g} ${n.b} 1</color>`)+"</emission>"+("constant"!==r?"<diffuse>"+(e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':`<color sid="diffuse">${i.r} ${i.g} ${i.b} 1</color>`)+"</diffuse>":"")+("phong"===r?`<specular><color sid="specular">${a.r} ${a.g} ${a.b} 1</color></specular>`+"<shininess>"+(e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':`<float sid="shininess">${o}</float>`)+"</shininess>":"")+`<reflective><color>${i.r} ${i.g} ${i.b} 1</color></reflective>`+`<reflectivity><float>${s}</float></reflectivity>`+l+`</${r}></technique>`,u=`<effect id="${t}-effect">`+"<profile_COMMON>"+(e.map?'<newparam sid="diffuse-surface"><surface type="2D">'+`<init_from>${h(e.map)}</init_from>`+'</surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>':"")+(e.specularMap?'<newparam sid="specular-surface"><surface type="2D">'+`<init_from>${h(e.specularMap)}</init_from>`+'</surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>':"")+(e.emissiveMap?'<newparam sid="emissive-surface"><surface type="2D">'+`<init_from>${h(e.emissiveMap)}</init_from>`+'</surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>':"")+c+(e.side===THREE.DoubleSide?'<extra><technique profile="THREEJS"><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>",d=`<material id="${t}"${e.name?` name="${e.name}"`:""}><instance_effect url="#${t}-effect" /></material>`;E.push(d),y.push(u),f.set(e,t)}return t})(p[t%p.length])),r+=`<instance_geometry url="#${i}">`+(null!=o?"<bind_material><technique_common>"+o.map((e,t)=>`<instance_material symbol="MESH_MATERIAL_${t}" target="#${e}" >`+'<bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>').join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return t.children.forEach(t=>r+=e(t)),r+="</node>"}(e),T='<?xml version="1.0" encoding="UTF-8" standalone="no" ?>'+`<COLLADA xmlns="${"1.4.1"===a?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/"}" version="${a}">`+"<asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>"+(null!==r.author?`<author>${r.author}</author>`:"")+"</contributor>"+`<created>${(new Date).toISOString()}</created>`+`<modified>${(new Date).toISOString()}</modified>`+"<up_axis>Y_UP</up_axis></asset>";T+=`<library_images>${v.join("")}</library_images>`,T+=`<library_effects>${y.join("")}</library_effects>`,T+=`<library_materials>${E.join("")}</library_materials>`,T+=`<library_geometries>${g.join("")}</library_geometries>`,T+=`<library_visual_scenes><visual_scene id="Scene" name="scene">${x}</visual_scene></library_visual_scenes>`,T+='<scene><instance_visual_scene url="#Scene"/></scene>';var b,w,_,R,M,S,A={data:(b=T+="</COLLADA>",w=/^<\//,_=/(\?>$)|(\/>$)/,R=/<[^>]+>[^<]*<\/[^<]+>/,M=(e,t)=>t>0?e+M(e,t-1):"",S=0,b.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map(e=>{R.test(e)||_.test(e)||!w.test(e)||S--;var t=`${M("  ",S)}${e}`;return R.test(e)||_.test(e)||w.test(e)||S++,t}).join("\n")),textures:m};return"function"==typeof t&&requestAnimationFrame(()=>t(A)),A}}},function(e,t){THREE.GCodeLoader=function(e){THREE.Loader.call(this,e),this.splitLayer=!1},THREE.GCodeLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.GCodeLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){var t={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},r=[],n=void 0,i=new THREE.LineBasicMaterial({color:16711680});i.name="path";var a=new THREE.LineBasicMaterial({color:65280});function o(e){n={vertex:[],pathVertex:[],z:e.z},r.push(n)}function s(e,r){return t.relative?r:r-e}function l(e,r){return t.relative?e+r:r}a.name="extruded";for(var c,u,h=e.replace(/;.+/g,"").split("\n"),d=0;d<h.length;d++){var f=h[d].split(" "),p=f[0].toUpperCase(),m={};if(f.splice(1).forEach(function(e){if(void 0!==e[0]){var t=e[0].toLowerCase(),r=parseFloat(e.substring(1));m[t]=r}}),"G0"===p||"G1"===p){var v={x:void 0!==m.x?l(t.x,m.x):t.x,y:void 0!==m.y?l(t.y,m.y):t.y,z:void 0!==m.z?l(t.z,m.z):t.z,e:void 0!==m.e?l(t.e,m.e):t.e,f:void 0!==m.f?l(t.f,m.f):t.f};s(t.e,v.e)>0&&(v.extruding=s(t.e,v.e)>0,null!=n&&v.z==n.z||o(v)),c=t,u=v,void 0===n&&o(c),v.extruding?(n.vertex.push(c.x,c.y,c.z),n.vertex.push(u.x,u.y,u.z)):(n.pathVertex.push(c.x,c.y,c.z),n.pathVertex.push(u.x,u.y,u.z)),t=v}else if("G2"===p||"G3"===p);else if("G90"===p)t.relative=!1;else if("G91"===p)t.relative=!0;else if("G92"===p){(v=t).x=void 0!==m.x?m.x:v.x,v.y=void 0!==m.y?m.y:v.y,v.z=void 0!==m.z?m.z:v.z,v.e=void 0!==m.e?m.e:v.e,t=v}}function g(e,t){var r=new THREE.BufferGeometry;r.setAttribute("position",new THREE.Float32BufferAttribute(e,3));var n=new THREE.LineSegments(r,t?a:i);n.name="layer"+d,y.add(n)}var y=new THREE.Group;if(y.name="gcode",this.splitLayer)for(d=0;d<r.length;d++){g((T=r[d]).vertex,!0),g(T.pathVertex,!1)}else{var E=[],x=[];for(d=0;d<r.length;d++){var T=r[d];E=E.concat(T.vertex),x=x.concat(T.pathVertex)}g(E,!0),g(x,!1)}return y.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),y}})},function(e,t){THREE.DRACOLoader=function(e){THREE.Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}},THREE.DRACOLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.DRACOLoader,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,r,n){var i=new THREE.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&i.setWithCredentials(!0),i.load(e,e=>{var r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(n)},r,n)},decodeDracoFile:function(e,t,r,n){var i={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,i).then(t)},decodeGeometry:function(e,t){for(var r in t.attributeTypes){var n=t.attributeTypes[r];void 0!==n.BYTES_PER_ELEMENT&&(t.attributeTypes[r]=n.name)}var i,a=JSON.stringify(t);if(THREE.DRACOLoader.taskCache.has(e)){var o=THREE.DRACOLoader.taskCache.get(e);if(o.key===a)return o.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var s=this.workerNextTaskID++,l=e.byteLength,c=this._getWorker(s,l).then(r=>(i=r,new Promise((r,n)=>{i._callbacks[s]={resolve:r,reject:n},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return c.finally(()=>{i&&s&&this._releaseTask(i,s)}),THREE.DRACOLoader.taskCache.set(e,{key:a,promise:c}),c},_createGeometry:function(e){var t=new THREE.BufferGeometry;e.index&&t.setIndex(new THREE.BufferAttribute(e.index.array,1));for(var r=0;r<e.attributes.length;r++){var n=e.attributes[r],i=n.name,a=n.array,o=n.itemSize;t.setAttribute(i,new THREE.BufferAttribute(a,o))}return t},_loadLibrary:function(e,t){var r=new THREE.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),new Promise((t,n)=>{r.load(e,t,void 0,n)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{var r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var n=THREE.DRACOLoader.DRACOWorker.toString(),i=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{var r;this.workerPool.length<this.workerLimit?((r=new Worker(this.workerSourceURL))._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(r)):this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});return(r=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,r._taskLoad+=t,r})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),THREE.DRACOLoader.DRACOWorker=function(){var e,t;function r(e,t,r,n,i,a){var o,s,l=a.num_components(),c=r.num_points()*l;switch(i){case Float32Array:o=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,a,o),s=new Float32Array(c);break;case Int8Array:o=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,a,o),s=new Int8Array(c);break;case Int16Array:o=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,a,o),s=new Int16Array(c);break;case Int32Array:o=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,a,o),s=new Int32Array(c);break;case Uint8Array:o=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,a,o),s=new Uint8Array(c);break;case Uint16Array:o=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,a,o),s=new Uint16Array(c);break;case Uint32Array:o=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,a,o),s=new Uint32Array(c);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var u=0;u<c;u++)s[u]=o.GetValue(u);return e.destroy(o),{name:n,array:s,itemSize:l}}onmessage=function(n){var i=n.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":var a=i.buffer,o=i.taskConfig;t.then(e=>{var t=e.draco,n=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var l=function(e,t,n,i){var a,o,s=i.attributeIDs,l=i.attributeTypes,c=t.GetEncodedGeometryType(n);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(n,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(n,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var u={index:null,attributes:[]};for(var h in s){var d,f,p=self[l[h]];if(i.useUniqueIDs)f=s[h],d=t.GetAttributeByUniqueId(a,f);else{if(-1===(f=t.GetAttributeId(a,e[s[h]])))continue;d=t.GetAttribute(a,f)}u.attributes.push(r(e,t,a,h,p,d))}if(c===e.TRIANGULAR_MESH){for(var m=a.num_faces(),v=3*m,g=new Uint32Array(v),y=new e.DracoInt32Array,E=0;E<m;++E){t.GetFaceFromMesh(a,E,y);for(var x=0;x<3;++x)g[3*E+x]=y.GetValue(x)}u.index={array:g,itemSize:1},e.destroy(y)}return e.destroy(a),u}(t,n,s,o),c=l.attributes.map(e=>e.array.buffer);l.index&&c.push(l.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:l},c)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(s),t.destroy(n)}})}}},THREE.DRACOLoader.taskCache=new WeakMap,THREE.DRACOLoader.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},THREE.DRACOLoader.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},THREE.DRACOLoader.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},THREE.DRACOLoader.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")}},function(e,t){THREE.DDSLoader=function(e){THREE.CompressedTextureLoader.call(this,e)},THREE.DDSLoader.prototype=Object.assign(Object.create(THREE.CompressedTextureLoader.prototype),{constructor:THREE.DDSLoader,parse:function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,r,n){for(var i=r*n*4,a=new Uint8Array(e,t,i),o=new Uint8Array(i),s=0,l=0,c=0;c<n;c++)for(var u=0;u<r;u++){var h=a[l],d=a[++l],f=a[++l],p=a[++l];l++,o[s]=f,o[++s]=d,o[++s]=h,o[++s]=p,s++}return o}var a,o=n("DXT1"),s=n("DXT3"),l=n("DXT5"),c=n("ETC1"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var h,d=u[21],f=!1;switch(d){case o:a=8,r.format=THREE.RGB_S3TC_DXT1_Format;break;case s:a=16,r.format=THREE.RGBA_S3TC_DXT3_Format;break;case l:a=16,r.format=THREE.RGBA_S3TC_DXT5_Format;break;case c:a=8,r.format=THREE.RGB_ETC1_Format;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(h=d,String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255))),r;f=!0,a=64,r.format=THREE.RGBAFormat}r.mipmapCount=1,131072&u[2]&&!1!==t&&(r.mipmapCount=Math.max(1,u[7]));var p=u[28];if(r.isCubemap=!!(512&p),r.isCubemap&&(!(1024&p)||!(2048&p)||!(4096&p)||!(8192&p)||!(16384&p)||!(32768&p)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),r;r.width=u[4],r.height=u[3];for(var m=u[1]+4,v=r.isCubemap?6:1,g=0;g<v;g++)for(var y=r.width,E=r.height,x=0;x<r.mipmapCount;x++){if(f)var T=(b=i(e,m,y,E)).length;else{T=Math.max(4,y)/4*Math.max(4,E)/4*a;var b=new Uint8Array(e,m,T)}var w={data:b,width:y,height:E};r.mipmaps.push(w),m+=T,y=Math.max(y>>1,1),E=Math.max(E>>1,1)}return r}})},function(e,t){THREE.GLTFLoader=function(){function e(e){THREE.Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:e,load:function(e,t,r,n){var i,a=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),a.manager.itemStart(e);var o=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new THREE.FileLoader(a.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===a.crossOrigin&&s.setWithCredentials(!0),s.load(e,function(r){try{a.parse(r,i,function(r){t(r),a.manager.itemEnd(e)},o)}catch(e){o(e)}},r,o)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,s,l){var d,m={};if("string"==typeof e)d=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===o){try{m[r.KHR_BINARY_GLTF]=new c(e)}catch(e){return void(l&&l(e))}d=m[r.KHR_BINARY_GLTF].content}else d=THREE.LoaderUtils.decodeText(new Uint8Array(e));var v=JSON.parse(d);if(void 0===v.asset||v.asset.version[0]<2)l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(v.extensionsUsed)for(var g=0;g<v.extensionsUsed.length;++g){var y=v.extensionsUsed[g],E=v.extensionsRequired||[];switch(y){case r.KHR_LIGHTS_PUNCTUAL:m[y]=new i(v);break;case r.KHR_MATERIALS_UNLIT:m[y]=new a;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:m[y]=new f;break;case r.KHR_DRACO_MESH_COMPRESSION:m[y]=new u(v,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:m[y]=new n(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:m[y]=new h;break;case r.KHR_MESH_QUANTIZATION:m[y]=new p;break;default:E.indexOf(y)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}new U(v,m,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(s,l)}}});var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.name=r.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[r.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function a(){this.name=r.KHR_MATERIALS_UNLIT}i.prototype.loadLight=function(e){var t,r=this.lightDefs[e],n=new THREE.Color(16777215);void 0!==r.color&&n.fromArray(r.color);var i=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(n)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(n)).distance=i;break;case"spot":(t=new THREE.SpotLight(n)).distance=i,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},a.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},a.prototype.extendParams=function(e,t,r){var n=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(n)};var o="glTF",s=12,l={JSON:1313821514,BIN:5130562};function c(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,s);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=new DataView(e,s),i=0;i<n.byteLength;){var a=n.getUint32(i,!0);i+=4;var c=n.getUint32(i,!0);if(i+=4,c===l.JSON){var u=new Uint8Array(e,s+i,a);this.content=THREE.LoaderUtils.decodeText(u)}else if(c===l.BIN){var h=s+i;this.body=e.slice(h,h+a)}i+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function u(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function h(){this.name=r.KHR_TEXTURE_TRANSFORM}function d(e){THREE.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),o={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var s in o)e.uniforms[s]=o[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",t),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",i),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function f(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return d},extendParams:function(e,t,r){var n=t.extensions[this.name];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=[];if(Array.isArray(n.diffuseFactor)){var a=n.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==n.diffuseTexture&&i.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var o=n.specularGlossinessTexture;i.push(r.assignTexture(e,"glossinessMap",o)),i.push(r.assignTexture(e,"specularMap",o))}return Promise.all(i)},createMaterial:function(e){var t=new d(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=THREE.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function p(){this.name=r.KHR_MESH_QUANTIZATION}function m(e,t,r,n){THREE.Interpolant.call(this,e,t,r,n)}u.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var c in a){var u=S[c]||c.toLowerCase();o[u]=a[c]}for(c in e.attributes){u=S[c]||c.toLowerCase();if(void 0!==a[c]){var h=r.accessors[e.attributes[c]],d=w[h.componentType];l[u]=d,s[u]=!0===h.normalized}}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t){n.decodeDracoFile(e,function(e){for(var r in e.attributes){var n=e.attributes[r],i=s[r];void 0!==i&&(n.normalized=i)}t(e)},o,l)})})},h.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},d.prototype=Object.create(THREE.MeshStandardMaterial.prototype),d.prototype.constructor=d,d.prototype.copy=function(e){return THREE.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},m.prototype=Object.create(THREE.Interpolant.prototype),m.prototype.constructor=m,m.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n,a=0;a!==n;a++)t[a]=r[i+a];return t},m.prototype.beforeStart_=m.prototype.copySampleValue_,m.prototype.afterEnd_=m.prototype.copySampleValue_,m.prototype.interpolate_=function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=n-t,u=(r-t)/c,h=u*u,d=h*u,f=e*l,p=f-l,m=-2*d+3*h,v=d-h,g=1-m,y=v-h+u,E=0;E!==o;E++){var x=a[p+E+o],T=a[p+E+s]*c,b=a[f+E+o],w=a[f+E]*c;i[E]=g*x+y*T+m*b+v*w}return i};var v=0,g=1,y=2,E=3,x=4,T=5,b=6,w={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},R={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},M={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},S={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},A={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},L={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},P="OPAQUE",C="MASK",H="BLEND",I={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function k(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e)}function N(e,t,r){for(var n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function O(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function F(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(r=0,n=i.length;r<n;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function D(e){for(var t="",r=Object.keys(e).sort(),n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function U(e,r,n){this.json=e||{},this.extensions=r||{},this.options=n||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function z(e,t,r){var n=t.attributes,i=[];function a(t,n){return r.getDependency("accessor",t).then(function(t){e.setAttribute(n,t)})}for(var o in n){var s=S[o]||o.toLowerCase();s in e.attributes||i.push(a(n[o],s))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(l)}return O(e,t),function(e,t,r){var n=t.attributes,i=new THREE.Box3;if(void 0!==n.POSITION){var a=(h=r.json.accessors[n.POSITION]).min,o=h.max;if(void 0!==a&&void 0!==o){i.set(new THREE.Vector3(a[0],a[1],a[2]),new THREE.Vector3(o[0],o[1],o[2]));var s=t.targets;if(void 0!==s)for(var l=new THREE.Vector3,c=0,u=s.length;c<u;c++){var h,d=s[c];if(void 0!==d.POSITION)a=(h=r.json.accessors[d.POSITION]).min,o=h.max,void 0!==a&&void 0!==o?(l.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),l.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),l.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),i.expandByVector(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}e.boundingBox=i;var f=new THREE.Sphere;i.getCenter(f.center),f.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,r),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,r){for(var n=!1,i=!1,a=0,o=t.length;a<o&&(void 0!==(c=t[a]).POSITION&&(n=!0),void 0!==c.NORMAL&&(i=!0),!n||!i);a++);if(!n&&!i)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var c=t[a];if(n){var u=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION):e.attributes.position;s.push(u)}i&&(u=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL):e.attributes.normal,l.push(u))}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(t){var r=t[0],a=t[1];return n&&(e.morphAttributes.position=r),i&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e})}(e,t.targets,r):e})}function B(e,t){var r=e.getIndex();if(null===r){var n=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<i.count;a++)n.push(a);e.setIndex(n),r=e.getIndex()}var o=r.count-2,s=[];if(t===THREE.TriangleFanDrawMode)for(a=1;a<=o;a++)s.push(r.getX(0)),s.push(r.getX(a)),s.push(r.getX(a+1));else for(a=0;a<o;a++)a%2==0?(s.push(r.getX(a)),s.push(r.getX(a+1)),s.push(r.getX(a+2))):(s.push(r.getX(a+2)),s.push(r.getX(a+1)),s.push(r.getX(a)));s.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l}return U.prototype.parse=function(e,t){var r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){var a={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};N(i,a,n),O(a,n),e(a)}).catch(t)},U.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n={},i={},a=0,o=t.length;a<o;a++)for(var s=t[a].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var d=e[u];void 0!==d.mesh&&(void 0===n[d.mesh]&&(n[d.mesh]=i[d.mesh]=0),n[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=i},U.prototype.getDependency=function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[r.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},U.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map(function(t,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t},U.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,r){n.load(k(t.uri,i.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},U.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)})},U.prototype.loadAccessor=function(e){var t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var i=[];return void 0!==n.bufferView?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(e){var i,a,o=e[0],s=M[n.type],l=w[n.componentType],c=l.BYTES_PER_ELEMENT,u=c*s,h=n.byteOffset||0,d=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,f=!0===n.normalized;if(d&&d!==u){var p=Math.floor(h/d),m="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+p+":"+n.count,v=t.cache.get(m);v||(i=new l(o,p*d,n.count*d/c),v=new THREE.InterleavedBuffer(i,d/c),t.cache.add(m,v)),a=new THREE.InterleavedBufferAttribute(v,s,h%d/c,f)}else i=null===o?new l(n.count*s):new l(o,h,n.count*s),a=new THREE.BufferAttribute(i,s,f);if(void 0!==n.sparse){var g=M.SCALAR,y=w[n.sparse.indices.componentType],E=n.sparse.indices.byteOffset||0,x=n.sparse.values.byteOffset||0,T=new y(e[1],E,n.sparse.count*g),b=new l(e[2],x,n.sparse.count*s);null!==o&&(a=new THREE.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(var _=0,R=T.length;_<R;_++){var S=T[_];if(a.setX(S,b[_*s]),s>=2&&a.setY(S,b[_*s+1]),s>=3&&a.setZ(S,b[_*s+2]),s>=4&&a.setW(S,b[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})},U.prototype.loadTexture=function(e){var t,n=this,i=this.json,a=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,l=i.textures[e],c=l.extensions||{},u=(t=c[r.MSFT_TEXTURE_DDS]?i.images[c[r.MSFT_TEXTURE_DDS].source]:i.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(u=n.getDependency("bufferView",t.bufferView).then(function(e){h=!0;var r=new Blob([e],{type:t.mimeType});return u=s.createObjectURL(r)})),Promise.resolve(u).then(function(e){var t=a.manager.getHandler(e);return t||(t=c[r.MSFT_TEXTURE_DDS]?n.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(r,n){t.load(k(e,a.path),r,void 0,n)})}).then(function(e){!0===h&&s.revokeObjectURL(u),e.flipY=!1,l.name&&(e.name=l.name),t.mimeType in I&&(e.format=I[t.mimeType]);var r=(i.samplers||{})[l.sampler]||{};return e.magFilter=_[r.magFilter]||THREE.LinearFilter,e.minFilter=_[r.minFilter]||THREE.LinearMipmapLinearFilter,e.wrapS=R[r.wrapS]||THREE.RepeatWrapping,e.wrapT=R[r.wrapT]||THREE.RepeatWrapping,e})},U.prototype.assignTexture=function(e,t,n){var i=this;return this.getDependency("texture",n.index).then(function(a){if(!a.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":a.format=THREE.RGBFormat}if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;o&&(a=i.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(a,o))}e[t]=a})},U.prototype.assignFinalMaterial=function(e){var t=e.geometry,r=e.material,n=void 0!==t.attributes.color,i=void 0===t.attributes.normal,a=!0===e.isSkinnedMesh,o=Object.keys(t.morphAttributes).length>0,s=o&&void 0!==t.morphAttributes.normal;if(e.isPoints){var l="PointsMaterial:"+r.uuid,c=this.cache.get(l);c||(c=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(c,r),c.color.copy(r.color),c.map=r.map,c.sizeAttenuation=!1,this.cache.add(l,c)),r=c}else if(e.isLine){l="LineBasicMaterial:"+r.uuid;var u=this.cache.get(l);u||(u=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(u,r),u.color.copy(r.color),this.cache.add(l,u)),r=u}if(n||i||a||o){l="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),a&&(l+="skinning:"),n&&(l+="vertex-colors:"),i&&(l+="flat-shading:"),o&&(l+="morph-targets:"),s&&(l+="morph-normals:");var h=this.cache.get(l);h||(h=r.clone(),a&&(h.skinning=!0),n&&(h.vertexColors=!0),i&&(h.flatShading=!0),o&&(h.morphTargets=!0),s&&(h.morphNormals=!0),this.cache.add(l,h)),r=h}r.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",new THREE.BufferAttribute(t.attributes.uv.array,2)),r.normalScale&&(r.normalScale.y=-r.normalScale.y),e.material=r},U.prototype.loadMaterial=function(e){var t,n=this.json,i=this.extensions,a=n.materials[e],o={},s=a.extensions||{},l=[];if(s[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(),l.push(c.extendParams(o,a,this))}else if(s[r.KHR_MATERIALS_UNLIT]){var u=i[r.KHR_MATERIALS_UNLIT];t=u.getMaterialType(),l.push(u.extendParams(o,a,this))}else{t=THREE.MeshStandardMaterial;var h=a.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var f=h.baseColorFactor;o.color.fromArray(f),o.opacity=f[3]}void 0!==h.baseColorTexture&&l.push(this.assignTexture(o,"map",h.baseColorTexture)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))}!0===a.doubleSided&&(o.side=THREE.DoubleSide);var p=a.alphaMode||P;return p===H?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,p===C&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==a.normalTexture.scale&&o.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",a.emissiveTexture)),Promise.all(l).then(function(){var e;return e=t===d?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),a.name&&(e.name=a.name),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),O(e,a),a.extensions&&N(i,e,a),e})},U.prototype.loadGeometries=function(e){var t=this,n=this.extensions,i=this.primitiveCache;function a(e){return n[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return z(r,e,t)})}for(var o,s,l=[],c=0,u=e.length;c<u;c++){var h,d=e[c],f=(s=void 0,(s=(o=d).extensions&&o.extensions[r.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+D(s.attributes):o.indices+":"+D(o.attributes)+":"+o.mode),p=i[f];if(p)l.push(p.promise);else h=d.extensions&&d.extensions[r.KHR_DRACO_MESH_COMPRESSION]?a(d):z(new THREE.BufferGeometry,d,t),i[f]={primitive:d,promise:h},l.push(h)}return Promise.all(l)},U.prototype.loadMesh=function(e){for(var t,r=this,n=this.json.meshes[e],i=n.primitives,a=[],o=0,s=i.length;o<s;o++){var l=void 0===i[o].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),t.DefaultMaterial):this.getDependency("material",i[o].material);a.push(l)}return a.push(r.loadGeometries(i)),Promise.all(a).then(function(t){for(var a=t.slice(0,t.length-1),o=t[t.length-1],s=[],l=0,c=o.length;l<c;l++){var u,h=o[l],d=i[l],f=a[l];if(d.mode===x||d.mode===T||d.mode===b||void 0===d.mode)!0!==(u=!0===n.isSkinnedMesh?new THREE.SkinnedMesh(h,f):new THREE.Mesh(h,f)).isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),d.mode===T?u.geometry=B(u.geometry,THREE.TriangleStripDrawMode):d.mode===b&&(u.geometry=B(u.geometry,THREE.TriangleFanDrawMode));else if(d.mode===g)u=new THREE.LineSegments(h,f);else if(d.mode===E)u=new THREE.Line(h,f);else if(d.mode===y)u=new THREE.LineLoop(h,f);else{if(d.mode!==v)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);u=new THREE.Points(h,f)}Object.keys(u.geometry.morphAttributes).length>0&&F(u,n),u.name=n.name||"mesh_"+e,o.length>1&&(u.name+="_"+l),O(u,n),r.assignFinalMaterial(u),s.push(u)}if(1===s.length)return s[0];var p=new THREE.Group;for(l=0,c=s.length;l<c;l++)p.add(s[l]);return p})},U.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)),r.name&&(t.name=r.name),O(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},U.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},U.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],n=[],i=[],a=[],o=[],s=0,l=t.channels.length;s<l;s++){var c=t.channels[s],u=t.samplers[c.sampler],h=c.target,d=void 0!==h.node?h.node:h.id,f=void 0!==t.parameters?t.parameters[u.input]:u.input,p=void 0!==t.parameters?t.parameters[u.output]:u.output;r.push(this.getDependency("node",d)),n.push(this.getDependency("accessor",f)),i.push(this.getDependency("accessor",p)),a.push(u),o.push(h)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o)]).then(function(r){for(var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=[],c=0,u=n.length;c<u;c++){var h=n[c],d=i[c],f=a[c],p=o[c],v=s[c];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,A[v.path]){case A.weights:g=THREE.NumberKeyframeTrack;break;case A.rotation:g=THREE.QuaternionKeyframeTrack;break;case A.position:case A.scale:default:g=THREE.VectorKeyframeTrack}var y=h.name?h.name:h.uuid,E=void 0!==p.interpolation?L[p.interpolation]:THREE.InterpolateLinear,x=[];A[v.path]===A.weights?h.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&x.push(e.name?e.name:e.uuid)}):x.push(y);var T=f.array;if(f.normalized){var b;if(T.constructor===Int8Array)b=1/127;else if(T.constructor===Uint8Array)b=1/255;else if(T.constructor==Int16Array)b=1/32767;else{if(T.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");b=1/65535}for(var w=new Float32Array(T.length),_=0,R=T.length;_<R;_++)w[_]=T[_]*b;T=w}for(_=0,R=x.length;_<R;_++){var M=new g(x[_]+"."+A[v.path],d.array,T,E);"CUBICSPLINE"===p.interpolation&&(M.createInterpolant=function(e){return new m(this.times,this.values,this.getValueSize()/3,e)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(M)}}}var S=t.name?t.name:"animation_"+e;return new THREE.AnimationClip(S,void 0,l)})},U.prototype.loadNode=function(e){var t,n=this.json,i=this.extensions,a=this,o=n.meshReferences,s=n.meshUses,l=n.nodes[e];return(t=[],void 0!==l.mesh&&t.push(a.getDependency("mesh",l.mesh).then(function(e){var t;if(o[l.mesh]>1){var r=s[l.mesh]++;(t=e.clone()).name+="_instance_"+r}else t=e;return void 0!==l.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,r=l.weights.length;t<r;t++)e.morphTargetInfluences[t]=l.weights[t]}),t})),void 0!==l.camera&&t.push(a.getDependency("camera",l.camera)),l.extensions&&l.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[r.KHR_LIGHTS_PUNCTUAL].light&&t.push(a.getDependency("light",l.extensions[r.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t)).then(function(e){var t;if((t=!0===l.isBone?new THREE.Bone:e.length>1?new THREE.Group:1===e.length?e[0]:new THREE.Object3D)!==e[0])for(var r=0,n=e.length;r<n;r++)t.add(e[r]);if(l.name&&(t.userData.name=l.name,t.name=THREE.PropertyBinding.sanitizeNodeName(l.name)),O(t,l),l.extensions&&N(i,t,l),void 0!==l.matrix){var a=new THREE.Matrix4;a.fromArray(l.matrix),t.applyMatrix4(a)}else void 0!==l.translation&&t.position.fromArray(l.translation),void 0!==l.rotation&&t.quaternion.fromArray(l.rotation),void 0!==l.scale&&t.scale.fromArray(l.scale);return t})},U.prototype.loadScene=function(){function e(t,r,n,i){var a=n.nodes[t];return i.getDependency("node",t).then(function(e){return void 0===a.skin?e:i.getDependency("skin",a.skin).then(function(e){for(var r=[],n=0,a=(t=e).joints.length;n<a;n++)r.push(i.getDependency("node",t.joints[n]));return Promise.all(r)}).then(function(r){return e.traverse(function(e){if(e.isMesh){for(var n=[],i=[],a=0,o=r.length;a<o;a++){var s=r[a];if(s){n.push(s);var l=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*a),i.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}e.bind(new THREE.Skeleton(n,i),e.matrixWorld)}}),e});var t}).then(function(t){r.add(t);var o=[];if(a.children)for(var s=a.children,l=0,c=s.length;l<c;l++){var u=s[l];o.push(e(u,t,n,i))}return Promise.all(o)})}return function(t){var r=this.json,n=this.extensions,i=this.json.scenes[t],a=new THREE.Group;i.name&&(a.name=i.name),O(a,i),i.extensions&&N(n,a,i);for(var o=i.nodes||[],s=[],l=0,c=o.length;l<c;l++)s.push(e(o[l],a,r,this));return Promise.all(s).then(function(){return a})}}(),e}()},function(e,t){var r={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},n={};n[THREE.NearestFilter]=r.NEAREST,n[THREE.NearestMipmapNearestFilter]=r.NEAREST_MIPMAP_NEAREST,n[THREE.NearestMipmapLinearFilter]=r.NEAREST_MIPMAP_LINEAR,n[THREE.LinearFilter]=r.LINEAR,n[THREE.LinearMipmapNearestFilter]=r.LINEAR_MIPMAP_NEAREST,n[THREE.LinearMipmapLinearFilter]=r.LINEAR_MIPMAP_LINEAR,n[THREE.ClampToEdgeWrapping]=r.CLAMP_TO_EDGE,n[THREE.RepeatWrapping]=r.REPEAT,n[THREE.MirroredRepeatWrapping]=r.MIRRORED_REPEAT;var i={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(e,t,a){var o={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1};(a=Object.assign({},o,a)).animations.length>0&&(a.trs=!0);var s,l={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},c=0,u=[],h=[],d=new Map,f=[],p={},m={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},v=new Map,g=0;function y(e){return v.has(e)||v.set(e,g++),v.get(e)}function E(e,t){return e.length===t.length&&e.every(function(e,r){return e===t[r]})}function x(e){return 4*Math.ceil(e/4)}function T(e,t){t=t||0;var r=x(e.byteLength);if(r!==e.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(var i=e.byteLength;i<r;i++)n[i]=t;return n.buffer}return e}function b(e,t){if(0!==Object.keys(e.userData).length)try{var r=JSON.parse(JSON.stringify(e.userData));if(a.includeCustomExtensions&&r.gltfExtensions){for(var n in void 0===t.extensions&&(t.extensions={}),r.gltfExtensions)t.extensions[n]=r.gltfExtensions[n],p[n]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}function w(e,t){var r=!1,n={};0===t.offset.x&&0===t.offset.y||(n.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(n.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(n.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,p.KHR_texture_transform=!0)}function _(e){return l.buffers||(l.buffers=[{byteLength:0}]),u.push(e),0}function R(e,t,n,i){var o;if(e.array.constructor===Float32Array)o=r.FLOAT;else if(e.array.constructor===Uint32Array)o=r.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)o=r.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");o=r.UNSIGNED_BYTE}if(void 0===n&&(n=0),void 0===i&&(i=e.count),a.truncateDrawRange&&void 0!==t&&null===t.index){var s=n+i,u=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;n=Math.max(n,t.drawRange.start),(i=Math.min(s,u)-n)<0&&(i=0)}if(0===i)return null;var h,d=function(e,t,r){for(var n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},i=t;i<t+r;i++)for(var a=0;a<e.itemSize;a++){var o=e.array[i*e.itemSize+a];n.min[a]=Math.min(n.min[a],o),n.max[a]=Math.max(n.max[a],o)}return n}(e,n,i);void 0!==t&&(h=e===t.index?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER);var f=function(e,t,n,i,a){var o;l.bufferViews||(l.bufferViews=[]),o=t===r.UNSIGNED_BYTE?1:t===r.UNSIGNED_SHORT?2:4;for(var s=x(i*e.itemSize*o),u=new DataView(new ArrayBuffer(s)),h=0,d=n;d<n+i;d++)for(var f=0;f<e.itemSize;f++){var p=e.array[d*e.itemSize+f];t===r.FLOAT?u.setFloat32(h,p,!0):t===r.UNSIGNED_INT?u.setUint32(h,p,!0):t===r.UNSIGNED_SHORT?u.setUint16(h,p,!0):t===r.UNSIGNED_BYTE&&u.setUint8(h,p),h+=o}var m={buffer:_(u.buffer),byteOffset:c,byteLength:s};return void 0!==a&&(m.target=a),a===r.ARRAY_BUFFER&&(m.byteStride=e.itemSize*o),c+=s,l.bufferViews.push(m),{id:l.bufferViews.length-1,byteLength:0}}(e,o,n,i,h),p={bufferView:f.id,byteOffset:f.byteOffset,componentType:o,count:i,max:d.max,min:d.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return l.accessors||(l.accessors=[]),l.accessors.push(p),l.accessors.length-1}function M(e,t,r){m.images.has(e)||m.images.set(e,{});var n=m.images.get(e),i=t===THREE.RGBAFormat?"image/png":"image/jpeg",o=i+":flipY/"+r.toString();if(void 0!==n[o])return n[o];l.images||(l.images=[]);var u={mimeType:i};if(a.embedImages){var d=s=s||document.createElement("canvas");d.width=Math.min(e.width,a.maxTextureSize),d.height=Math.min(e.height,a.maxTextureSize),a.forcePowerOfTwoTextures&&!function(e){return THREE.MathUtils.isPowerOfTwo(e.width)&&THREE.MathUtils.isPowerOfTwo(e.height)}(d)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e),d.width=THREE.MathUtils.floorPowerOfTwo(d.width),d.height=THREE.MathUtils.floorPowerOfTwo(d.height));var f=d.getContext("2d");!0===r&&(f.translate(0,d.height),f.scale(1,-1)),f.drawImage(e,0,0,d.width,d.height),!0===a.binary?h.push(new Promise(function(e){d.toBlob(function(t){(function(e){return l.bufferViews||(l.bufferViews=[]),new Promise(function(t){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=T(r.result),n={buffer:_(e),byteOffset:c,byteLength:e.byteLength};c+=e.byteLength,l.bufferViews.push(n),t(l.bufferViews.length-1)}})})(t).then(function(t){u.bufferView=t,e()})},i)})):u.uri=d.toDataURL(i)}else u.uri=e.src;l.images.push(u);var p=l.images.length-1;return n[o]=p,p}function S(e){l.samplers||(l.samplers=[]);var t={magFilter:n[e.magFilter],minFilter:n[e.minFilter],wrapS:n[e.wrapS],wrapT:n[e.wrapT]};return l.samplers.push(t),l.samplers.length-1}function A(e){if(m.textures.has(e))return m.textures.get(e);l.textures||(l.textures=[]);var t={sampler:S(e),source:M(e.image,e.format,e.flipY)};e.name&&(t.name=e.name),l.textures.push(t);var r=l.textures.length-1;return m.textures.set(e,r),r}function L(e){if(m.materials.has(e))return m.materials.get(e);if(l.materials||(l.materials=[]),e.isShaderMaterial&&!e.isGLTFSpecularGlossinessMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},p.KHR_materials_unlit=!0):e.isGLTFSpecularGlossinessMaterial?(t.extensions={KHR_materials_pbrSpecularGlossiness:{}},p.KHR_materials_pbrSpecularGlossiness=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(E(r,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.isGLTFSpecularGlossinessMaterial){t.pbrMetallicRoughness.baseColorFactor&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var n=[1,1,1];e.specular.toArray(n,0),t.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor=n,t.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor=e.glossiness}if(e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var i={index:A(e.metalnessMap)};w(i,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=i}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var a={index:A(e.map)};w(a,e.map),e.isGLTFSpecularGlossinessMaterial&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseTexture=a),t.pbrMetallicRoughness.baseColorTexture=a}if(e.isGLTFSpecularGlossinessMaterial&&e.specularMap){var o={index:A(e.specularMap)};w(o,e.specularMap),t.extensions.KHR_materials_pbrSpecularGlossiness.specularGlossinessTexture=o}if(e.emissive){var s=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(E(s,[0,0,0])||(t.emissiveFactor=s),e.emissiveMap){var c={index:A(e.emissiveMap)};w(c,e.emissiveMap),t.emissiveTexture=c}}if(e.normalMap){var u={index:A(e.normalMap)};e.normalScale&&-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),u.scale=e.normalScale.x),w(u,e.normalMap),t.normalTexture=u}if(e.aoMap){var h={index:A(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(h.strength=e.aoMapIntensity),w(h,e.aoMap),t.occlusionTexture=h}e.transparent?t.alphaMode="BLEND":e.alphaTest>0&&(t.alphaMode="MASK",t.alphaCutoff=e.alphaTest),e.side===THREE.DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),b(e,t),l.materials.push(t);var d=l.materials.length-1;return m.materials.set(e,d),d}function P(e){var t=[e.geometry.uuid];if(Array.isArray(e.material))for(var n=0,i=e.material.length;n<i;n++)t.push(e.material[n].uuid);else t.push(e.material.uuid);var o=t.join(":");if(m.meshes.has(o))return m.meshes.get(o);var s,c=e.geometry;if(e.isLineSegments)s=r.LINES;else if(e.isLineLoop)s=r.LINE_LOOP;else if(e.isLine)s=r.LINE_STRIP;else if(e.isPoints)s=r.POINTS;else{if(!c.isBufferGeometry){console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use THREE.BufferGeometry instead.");var u=new THREE.BufferGeometry;u.fromGeometry(c),c=u}s=e.material.wireframe?r.LINES:r.TRIANGLES}var h={},d={},f=[],p=[],v={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},g=c.getAttribute("normal");void 0===g||function(e){if(m.attributesNormalized.has(e))return!1;for(var t=new THREE.Vector3,r=0,n=e.count;r<n;r++)if(Math.abs(t.fromArray(e.array,3*r).length()-1)>5e-4)return!1;return!0}(g)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),c.setAttribute("normal",function(e){if(m.attributesNormalized.has(e))return m.attributesNormalized.get(e);for(var t=e.clone(),r=new THREE.Vector3,n=0,i=t.count;n<i;n++)r.fromArray(t.array,3*n),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),r.toArray(t.array,3*n);return m.attributesNormalized.set(e,t),t}(g)));var E=null;for(var x in c.attributes)if("morph"!==x.substr(0,5)){var T=c.attributes[x];x=v[x]||x.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(x)||(x="_"+x),m.attributes.has(y(T)))d[x]=m.attributes.get(y(T));else{E=null;var w=T.array;"JOINTS_0"!==x||w instanceof Uint16Array||w instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),E=new THREE.BufferAttribute(new Uint16Array(w),T.itemSize,T.normalized));var _=R(E||T,c);null!==_&&(d[x]=_,m.attributes.set(y(T),_))}}if(void 0!==g&&c.setAttribute("normal",g),0===Object.keys(d).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var M=[],S=[],A={};if(void 0!==e.morphTargetDictionary)for(var P in e.morphTargetDictionary)A[e.morphTargetDictionary[P]]=P;for(n=0;n<e.morphTargetInfluences.length;++n){var C={},H=!1;for(var x in c.morphAttributes)if("position"===x||"normal"===x){T=c.morphAttributes[x][n];var I=x.toUpperCase(),k=c.attributes[x];if(m.attributes.has(y(T)))C[I]=m.attributes.get(y(T));else{var N=T.clone();if(!c.morphTargetsRelative)for(var O=0,F=T.count;O<F;O++)N.setXYZ(O,T.getX(O)-k.getX(O),T.getY(O)-k.getY(O),T.getZ(O)-k.getZ(O));C[I]=R(N,c),m.attributes.set(y(k),C[I])}}else H||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),H=!0);p.push(C),M.push(e.morphTargetInfluences[n]),void 0!==e.morphTargetDictionary&&S.push(A[n])}h.weights=M,S.length>0&&(h.extras={},h.extras.targetNames=S)}var D=a.forceIndices,U=Array.isArray(e.material);if(U&&0===c.groups.length)return null;!D&&null===c.index&&U&&(console.warn("THREE.GLTFExporter: Creating index for non-indexed multi-material mesh."),D=!0);var z=!1;if(null===c.index&&D){for(var B=[],G=(n=0,c.attributes.position.count);n<G;n++)B[n]=n;c.setIndex(B),z=!0}var V=U?e.material:[e.material],j=U?c.groups:[{materialIndex:0,start:void 0,count:void 0}];for(n=0,G=j.length;n<G;n++){var W={mode:s,attributes:d};if(b(c,W),p.length>0&&(W.targets=p),null!==c.index){var X=y(c.index);void 0===j[n].start&&void 0===j[n].count||(X+=":"+j[n].start+":"+j[n].count),m.attributes.has(X)?W.indices=m.attributes.get(X):(W.indices=R(c.index,c,j[n].start,j[n].count),m.attributes.set(X,W.indices)),null===W.indices&&delete W.indices}var Y=L(V[j[n].materialIndex]);null!==Y&&(W.material=Y),f.push(W)}z&&c.setIndex(null),h.primitives=f,l.meshes||(l.meshes=[]),l.meshes.push(h);var q=l.meshes.length-1;return m.meshes.set(o,q),q}function C(e,t){l.animations||(l.animations=[]);for(var r=(e=THREE.GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,n=[],a=[],o=0;o<r.length;++o){var s=r[o],c=THREE.PropertyBinding.parseTrackName(s.name),u=THREE.PropertyBinding.findNode(t,c.nodeName),h=i[c.propertyName];if("bones"===c.objectName&&(u=!0===u.isSkinnedMesh?u.skeleton.getBoneByName(c.objectIndex):void 0),!u||!h)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',s.name),null;var f,p=s.values.length/s.times.length;h===i.morphTargetInfluences&&(p/=u.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(f="CUBICSPLINE",p/=3):f=s.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",a.push({input:R(new THREE.BufferAttribute(s.times,1)),output:R(new THREE.BufferAttribute(s.values,p)),interpolation:f}),n.push({sampler:a.length-1,target:{node:d.get(u),path:h}})}return l.animations.push({name:e.name||"clip_"+l.animations.length,samplers:a,channels:n}),l.animations.length-1}function H(e){var t=l.nodes[d.get(e)],r=e.skeleton;if(void 0===r)return null;var n=e.skeleton.bones[0];if(void 0===n)return null;for(var i=[],a=new Float32Array(16*r.bones.length),o=0;o<r.bones.length;++o)i.push(d.get(r.bones[o])),r.boneInverses[o].toArray(a,16*o);return void 0===l.skins&&(l.skins=[]),l.skins.push({inverseBindMatrices:R(new THREE.BufferAttribute(a,16)),joints:i,skeleton:d.get(n)}),t.skin=l.skins.length-1}function I(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var r=l.extensions.KHR_lights_punctual.lights;return r.push(t),r.length-1}function k(e){l.nodes||(l.nodes=[]);var t={};if(a.trs){var r=e.quaternion.toArray(),n=e.position.toArray(),i=e.scale.toArray();E(r,[0,0,0,1])||(t.rotation=r),E(n,[0,0,0])||(t.translation=n),E(i,[1,1,1])||(t.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),E(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),b(e,t),e.isMesh||e.isLine||e.isPoints){var o=P(e);null!==o&&(t.mesh=o)}else if(e.isCamera)t.camera=function(e){l.cameras||(l.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:THREE.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),l.cameras.push(r),l.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)p.KHR_lights_punctual||(l.extensions=l.extensions||{},l.extensions.KHR_lights_punctual={lights:[]},p.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:I(e)};else if(e.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e),null;if(e.isSkinnedMesh&&f.push(e),e.children.length>0){for(var s=[],c=0,u=e.children.length;c<u;c++){var h=e.children[c];if(h.visible||!1===a.onlyVisible){var m=k(h);null!==m&&s.push(m)}}s.length>0&&(t.children=s)}l.nodes.push(t);var v=l.nodes.length-1;return d.set(e,v),v}function N(e){l.scenes||(l.scenes=[],l.scene=0);var t={nodes:[]};""!==e.name&&(t.name=e.name),l.scenes.push(t);for(var r=[],n=0,i=e.children.length;n<i;n++){var o=e.children[n];if(o.visible||!1===a.onlyVisible){var s=k(o);null!==s&&r.push(s)}}r.length>0&&(t.nodes=r),b(e,t)}!function(e){e=e instanceof Array?e:[e];for(var t=[],r=0;r<e.length;r++)e[r]instanceof THREE.Scene?N(e[r]):t.push(e[r]);for(t.length>0&&function(e){var t=new THREE.Scene;t.name="AuxScene";for(var r=0;r<e.length;r++)t.children.push(e[r]);N(t)}(t),r=0;r<f.length;++r)H(f[r]);for(r=0;r<a.animations.length;++r)C(a.animations[r],e[0])}(e),Promise.all(h).then(function(){var e=new Blob(u,{type:"application/octet-stream"}),r=Object.keys(p);if(r.length>0&&(l.extensionsUsed=r),l.buffers&&l.buffers.length>0){l.buffers[0].byteLength=e.size;var n=new window.FileReader;if(!0===a.binary){n.readAsArrayBuffer(e),n.onloadend=function(){var e=T(n.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,e.byteLength,!0),r.setUint32(4,5130562,!0);var i=T(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);t[r]=i>255?32:i}return t.buffer}(JSON.stringify(l)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,i.byteLength,!0),a.setUint32(4,1313821514,!0);var o=new ArrayBuffer(12),s=new DataView(o);s.setUint32(0,1179937895,!0),s.setUint32(4,2,!0);var c=12+a.byteLength+i.byteLength+r.byteLength+e.byteLength;s.setUint32(8,c,!0);var u=new Blob([o,a,i,r,e],{type:"application/octet-stream"}),h=new window.FileReader;h.readAsArrayBuffer(u),h.onloadend=function(){t(h.result)}}}else n.readAsDataURL(e),n.onloadend=function(){var e=n.result;l.buffers[0].uri=e,t(l)}}else t(l)})}},THREE.GLTFExporter.Utils={insertKeyframe:function(e,t){var r,n=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+n),o=e.createInterpolant(new e.ValueBufferType(n));if(0===e.times.length){i[0]=t;for(var s=0;s<n;s++)a[s]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;i[0]=t,i.set(e.times,1),a.set(o.evaluate(t),0),a.set(e.values,n),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),a.set(e.values,0),a.set(o.evaluate(t),e.values.length),r=i.length-1}else for(s=0;s<e.times.length;s++){if(Math.abs(e.times[s]-t)<.001)return s;if(e.times[s]<t&&e.times[s+1]>t){i.set(e.times.slice(0,s+1),0),i[s+1]=t,i.set(e.times.slice(s+1),s+2),a.set(e.values.slice(0,(s+1)*n),0),a.set(o.evaluate(t),(s+1)*n),a.set(e.values.slice((s+1)*n),(s+2)*n),r=s+1;break}}return e.times=i,e.values=a,r},mergeMorphTargetTracks:function(e,t){for(var r=[],n={},i=e.tracks,a=0;a<i.length;++a){var o=i[a],s=THREE.PropertyBinding.parseTrackName(o.name),l=THREE.PropertyBinding.findNode(t,s.nodeName);if("morphTargetInfluences"===s.propertyName&&void 0!==s.propertyIndex){if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(o=o.clone()).setInterpolation(THREE.InterpolateLinear)}var c,u=l.morphTargetInfluences.length,h=l.morphTargetDictionary[s.propertyIndex];if(void 0===h)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);if(void 0!==n[l.uuid]){var d=o.createInterpolant(new o.ValueBufferType(1));c=n[l.uuid];for(m=0;m<c.times.length;m++)c.values[m*u+h]=d.evaluate(c.times[m]);for(m=0;m<o.times.length;m++){var f=this.insertKeyframe(c,o.times[m]);c.values[f*u+h]=o.values[m]}}else{for(var p=new((c=o.clone()).ValueBufferType)(u*c.times.length),m=0;m<c.times.length;m++)p[m*u+h]=c.values[m];c.name=".morphTargetInfluences",c.values=p,n[l.uuid]=c,r.push(c)}}else r.push(o)}return e.tracks=r,e}}},function(e,t,r){"use strict";r.r(t);var n=r(0);THREE.AMFLoader=function(e){THREE.Loader.call(this,e)},THREE.AMFLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.AMFLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){function t(e){for(var t="AMF Material",n=e.attributes.id.textContent,i={r:1,g:1,b:1,a:1},a=null,o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(t=s.textContent):"color"===s.nodeName&&(i=r(s))}return a=new THREE.MeshPhongMaterial({flatShading:!0,color:new THREE.Color(i.r,i.g,i.b),name:t}),1!==i.a&&(a.transparent=!0,a.opacity=i.a),{id:n,material:a}}function r(e){for(var t={r:1,g:1,b:1,a:1},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];"r"===n.nodeName?t.r=n.textContent:"g"===n.nodeName?t.g=n.textContent:"b"===n.nodeName?t.b=n.textContent:"a"===n.nodeName&&(t.a=n.textContent)}return t}function i(e){var t={name:"",triangles:[],materialid:null},r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){var n=r.getElementsByTagName("v1")[0].textContent,i=r.getElementsByTagName("v2")[0].textContent,a=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(n,i,a)}r=r.nextElementSibling}return t}function a(e){for(var t=[],r=[],n=e.firstElementChild;n;){if("vertex"===n.nodeName)for(var i=n.firstElementChild;i;){if("coordinates"===i.nodeName){var a=i.getElementsByTagName("x")[0].textContent,o=i.getElementsByTagName("y")[0].textContent,s=i.getElementsByTagName("z")[0].textContent;t.push(a,o,s)}else if("normal"===i.nodeName){var l=i.getElementsByTagName("nx")[0].textContent,c=i.getElementsByTagName("ny")[0].textContent,u=i.getElementsByTagName("nz")[0].textContent;r.push(l,c,u)}i=i.nextElementSibling}n=n.nextElementSibling}return{vertices:t,normals:r}}function o(e){for(var t=e.attributes.id.textContent,n={name:"amfobject",meshes:[]},o=null,s=e.firstElementChild;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(n.name=s.textContent);else if("color"===s.nodeName)o=r(s);else if("mesh"===s.nodeName){for(var l=s.firstElementChild,c={vertices:[],normals:[],volumes:[],color:o};l;){if("vertices"===l.nodeName){var u=a(l);c.normals=c.normals.concat(u.normals),c.vertices=c.vertices.concat(u.vertices)}else"volume"===l.nodeName&&c.volumes.push(i(l));l=l.nextElementSibling}n.meshes.push(c)}s=s.nextElementSibling}return{id:t,obj:n}}var s,l,c=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var r=null,i=null;console.log("THREE.AMFLoader: Loading Zip");try{r=new n(e)}catch(e){if(e instanceof ReferenceError)return console.log("THREE.AMFLoader: jszip missing and file is compressed."),null}for(i in r.files)if(".amf"===i.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+i),t=new DataView(r.file(i).asArrayBuffer())}var a=THREE.LoaderUtils.decodeText(t),o=(new DOMParser).parseFromString(a,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):o}(e),u="",h="",d=function(e){var t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());var n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(t=n[r]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(c),f={},p={},m=c.documentElement.childNodes;for(s=0;s<m.length;s++){var v=m[s];if("metadata"===v.nodeName)void 0!==v.attributes.type&&("name"===v.attributes.type.value?u=v.textContent:"author"===v.attributes.type.value&&(h=v.textContent));else if("material"===v.nodeName){var g=t(v);f[g.id]=g.material}else if("object"===v.nodeName){var y=o(v);p[y.id]=y.obj}}var E=new THREE.Group,x=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0});for(var T in E.name=u,E.userData.author=h,E.userData.loader="AMF",p){var b=p[T],w=b.meshes,_=new THREE.Group;for(_.name=b.name||"",s=0;s<w.length;s++){var R=x,M=w[s],S=new THREE.Float32BufferAttribute(M.vertices,3),A=null;if(M.normals.length&&(A=new THREE.Float32BufferAttribute(M.normals,3)),M.color){var L=M.color;(R=x.clone()).color=new THREE.Color(L.r,L.g,L.b),1!==L.a&&(R.transparent=!0,R.opacity=L.a)}var P=M.volumes;for(l=0;l<P.length;l++){var C=P[l],H=new THREE.BufferGeometry,I=R;H.setIndex(C.triangles),H.setAttribute("position",S.clone()),A&&H.setAttribute("normal",A.clone()),void 0!==f[C.materialId]&&(I=f[C.materialId]),H.scale(d,d,d),_.add(new THREE.Mesh(H,I.clone()))}}E.add(_)}return E}})},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(38),i=r(39),a=r(40);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=s(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|f(t.length);return 0===(e=s(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(u(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|f(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,r);case"utf8":case"utf-8":return M(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return L(this,t,r);case"base64":return R(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(a=r;a<s;a++)if(c(e,a)===c(t,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*o}else-1!==u&&(a-=a-u),u=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(c(e,a+d)!==c(t,d)){h=!1;break}if(h)return a}return-1}function E(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function x(e,t,r,n){return V(B(t,e.length-r),e,r,n)}function T(e,t,r,n){return V(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r,n){return T(e,t,r,n)}function w(e,t,r,n){return V(G(t),e,r,n)}function _(e,t,r,n){return V(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function R(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function M(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,c=e[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&c)<<6|63&a)>127&&(u=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&c)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=h}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=S));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return c(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return u(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(n,i),u=e.slice(t,r),h=0;h<s;++h)if(c[h]!==u[h]){a=c[h],o=u[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return x(this,e,t,r);case"ascii":return T(this,e,t,r);case"latin1":case"binary":return b(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function L(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function P(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=z(e[a]);return i}function C(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function H(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function k(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function N(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function O(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function F(e,t,r,n,a){return a||O(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function D(e,t,r,n,a){return a||O(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||H(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||H(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||H(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||H(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||H(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||H(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||H(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||H(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||H(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||H(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||H(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||H(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||H(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||H(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||H(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||H(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||H(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||H(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return F(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return F(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return D(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return D(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:B(new l(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function z(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function G(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(3))},function(e,t,r){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){for(var t,r=c(e),n=r[0],o=r[1],s=new a(function(e,t,r){return 3*(t+r)/4-r}(0,n,o)),l=0,u=o>0?n-4:n,h=0;h<u;h+=4)t=i[e.charCodeAt(h)]<<18|i[e.charCodeAt(h+1)]<<12|i[e.charCodeAt(h+2)]<<6|i[e.charCodeAt(h+3)],s[l++]=t>>16&255,s[l++]=t>>8&255,s[l++]=255&t;2===o&&(t=i[e.charCodeAt(h)]<<2|i[e.charCodeAt(h+1)]>>4,s[l++]=255&t);1===o&&(t=i[e.charCodeAt(h)]<<10|i[e.charCodeAt(h+1)]<<4|i[e.charCodeAt(h+2)]>>2,s[l++]=t>>8&255,s[l++]=255&t);return s},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],o=0,s=r-i;o<s;o+=16383)a.push(u(e,o,o+16383>s?s:o+16383));1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return a.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,a=f&(1<<-u)-1,f>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=c}return(f?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,c=8*a-i-1,u=(1<<c)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&s,f+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[r+f]=255&o,f+=p,o/=256,c-=8);e[r+f-p]|=128*m}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";r.r(t);var n=r(0);THREE.ThreeMFLoader=function(e){THREE.Loader.call(this,e),this.availableExtensions=[]},THREE.ThreeMFLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.ThreeMFLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){var t=this,r=new THREE.TextureLoader(this.manager);function i(e){for(var t=[],r=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("Relationship"),n=0;n<r.length;n++){var i=r[n],a={target:i.getAttribute("Target"),id:i.getAttribute("Id"),type:i.getAttribute("Type")};t.push(a)}return t}function a(e){for(var t={id:e.getAttribute("id"),basematerials:[]},r=e.querySelectorAll("base"),n=0;n<r.length;n++){var i=c(r[n]);i.index=n,t.basematerials.push(i)}return t}function o(e){for(var t={id:e.getAttribute("id"),texid:e.getAttribute("texid"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("tex2coord"),n=[],i=0;i<r.length;i++){var a=r[i],o=a.getAttribute("u"),s=a.getAttribute("v");n.push(parseFloat(o),parseFloat(s))}return t.uvs=new Float32Array(n),t}function s(e){for(var t={id:e.getAttribute("id"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("color"),n=[],i=new THREE.Color,a=0;a<r.length;a++){var o=r[a].getAttribute("color");i.setStyle(o.substring(0,7)),i.convertSRGBToLinear(),n.push(i.r,i.g,i.b)}return t.colors=new Float32Array(n),t}function l(e){for(var t={id:e.getAttribute("id")},r=e.querySelectorAll("pbmetallic"),n=[],i=0;i<r.length;i++){var a=r[i];n.push({name:a.getAttribute("name"),metallicness:parseFloat(a.getAttribute("metallicness")),roughness:parseFloat(a.getAttribute("roughness"))})}return t.data=n,t}function c(e){var t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t.displaypropertiesid=e.getAttribute("displaypropertiesid"),t}function u(e){var t={};t.objectId=e.getAttribute("objectid");var r=e.getAttribute("transform");return r&&(t.transform=h(r)),t}function h(e){var t=[];e.split(" ").forEach(function(e){t.push(parseFloat(e))});var r=new THREE.Matrix4;return r.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),r}function d(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var n=e.getAttribute("pid");n&&(t.pid=n);var i=e.getAttribute("pindex");i&&(t.pindex=i);var a=e.getAttribute("thumbnail");a&&(t.thumbnail=a);var o=e.getAttribute("partnumber");o&&(t.partnumber=o);var s=e.getAttribute("name");s&&(t.name=s);var l=e.querySelector("mesh");l&&(t.mesh=function(e){for(var t={},r=[],n=e.querySelectorAll("vertices vertex"),i=0;i<n.length;i++){var a=n[i],o=a.getAttribute("x"),s=a.getAttribute("y"),l=a.getAttribute("z");r.push(parseFloat(o),parseFloat(s),parseFloat(l))}t.vertices=new Float32Array(r);var c=[],u=[],h=e.querySelectorAll("triangles triangle");for(i=0;i<h.length;i++){var d=h[i],f=d.getAttribute("v1"),p=d.getAttribute("v2"),m=d.getAttribute("v3"),v=d.getAttribute("p1"),g=d.getAttribute("p2"),y=d.getAttribute("p3"),E=d.getAttribute("pid"),x={};x.v1=parseInt(f,10),x.v2=parseInt(p,10),x.v3=parseInt(m,10),u.push(x.v1,x.v2,x.v3),v&&(x.p1=parseInt(v,10)),g&&(x.p2=parseInt(g,10)),y&&(x.p3=parseInt(y,10)),E&&(x.pid=E),0<Object.keys(x).length&&c.push(x)}return t.triangleProperties=c,t.triangles=new Uint32Array(u),t}(l));var c=e.querySelector("components");return c&&(t.components=function(e){for(var t=[],r=e.querySelectorAll("component"),n=0;n<r.length;n++){var i=u(r[n]);t.push(i)}return t}(c)),t}function f(e){var t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");r&&(t.metadata=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r],i=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(t[i]=n.textContent)}return t}(r));var n=e.querySelector("resources");n&&(t.resources=function(e){for(var t={basematerials:{}},r=e.querySelectorAll("basematerials"),n=0;n<r.length;n++){var i=a(r[n]);t.basematerials[i.id]=i}t.texture2d={};var c,u=e.querySelectorAll("texture2d");for(n=0;n<u.length;n++){var h=u[n],f={id:(c=h).getAttribute("id"),path:c.getAttribute("path"),contenttype:c.getAttribute("contenttype"),tilestyleu:c.getAttribute("tilestyleu"),tilestylev:c.getAttribute("tilestylev"),filter:c.getAttribute("filter")};t.texture2d[f.id]=f}t.colorgroup={};var p=e.querySelectorAll("colorgroup");for(n=0;n<p.length;n++){var m=s(p[n]);t.colorgroup[m.id]=m}t.pbmetallicdisplayproperties={};var v=e.querySelectorAll("pbmetallicdisplayproperties");for(n=0;n<v.length;n++){var g=l(v[n]);t.pbmetallicdisplayproperties[g.id]=g}t.texture2dgroup={};var y=e.querySelectorAll("texture2dgroup");for(n=0;n<y.length;n++){var E=o(y[n]);t.texture2dgroup[E.id]=E}t.object={};var x=e.querySelectorAll("object");for(n=0;n<x.length;n++){var T=d(x[n]);t.object[T.id]=T}return t}(n));var i=e.querySelector("build");return i&&(t.build=function(e){for(var t=[],r=e.querySelectorAll("item"),n=0;n<r.length;n++){var i=r[n],a={objectId:i.getAttribute("objectid")},o=i.getAttribute("transform");o&&(a.transform=h(o)),t.push(a)}return t}(i)),t}function p(e,t,n,i){var a=e.texid,o=n.resources.texture2d[a];if(o){var s=i[o.path],l=o.contenttype,c=new Blob([s],{type:l}),u=URL.createObjectURL(c),h=r.load(u,function(){URL.revokeObjectURL(u)});switch(h.encoding=THREE.sRGBEncoding,o.tilestyleu){case"wrap":h.wrapS=THREE.RepeatWrapping;break;case"mirror":h.wrapS=THREE.MirroredRepeatWrapping;break;case"none":case"clamp":h.wrapS=THREE.ClampToEdgeWrapping;break;default:h.wrapS=THREE.RepeatWrapping}switch(o.tilestylev){case"wrap":h.wrapT=THREE.RepeatWrapping;break;case"mirror":h.wrapT=THREE.MirroredRepeatWrapping;break;case"none":case"clamp":h.wrapT=THREE.ClampToEdgeWrapping;break;default:h.wrapT=THREE.RepeatWrapping}switch(o.filter){case"auto":h.magFilter=THREE.LinearFilter,h.minFilter=THREE.LinearMipmapLinearFilter;break;case"linear":h.magFilter=THREE.LinearFilter,h.minFilter=THREE.LinearFilter;break;case"nearest":h.magFilter=THREE.NearestFilter,h.minFilter=THREE.NearestFilter;break;default:h.magFilter=THREE.LinearFilter,h.minFilter=THREE.LinearMipmapLinearFilter}return h}return null}function m(e,t,r,n,i,a){for(var o=a.pindex,s={},l=0,c=t.length;l<c;l++){var u=void 0!==(w=t[l]).p1?w.p1:o;void 0===s[u]&&(s[u]=[]),s[u].push(w)}var h=Object.keys(s),d=[];for(l=0,c=h.length;l<c;l++){for(var f=h[l],p=s[f],m=T(e.basematerials[f],M,r,i,a,b),v=new THREE.BufferGeometry,g=[],y=n.vertices,E=0,x=p.length;E<x;E++){var w=p[E];g.push(y[3*w.v1+0]),g.push(y[3*w.v1+1]),g.push(y[3*w.v1+2]),g.push(y[3*w.v2+0]),g.push(y[3*w.v2+1]),g.push(y[3*w.v2+2]),g.push(y[3*w.v3+0]),g.push(y[3*w.v3+1]),g.push(y[3*w.v3+2])}v.setAttribute("position",new THREE.Float32BufferAttribute(g,3));var _=new THREE.Mesh(v,m);d.push(_)}return d}function v(e,t,r,n,i,a){for(var o=new THREE.BufferGeometry,s=[],l=[],c=n.vertices,u=e.uvs,h=0,d=t.length;h<d;h++){var f=t[h];s.push(c[3*f.v1+0]),s.push(c[3*f.v1+1]),s.push(c[3*f.v1+2]),s.push(c[3*f.v2+0]),s.push(c[3*f.v2+1]),s.push(c[3*f.v2+2]),s.push(c[3*f.v3+0]),s.push(c[3*f.v3+1]),s.push(c[3*f.v3+2]),l.push(u[2*f.p1+0]),l.push(u[2*f.p1+1]),l.push(u[2*f.p2+0]),l.push(u[2*f.p2+1]),l.push(u[2*f.p3+0]),l.push(u[2*f.p3+1])}o.setAttribute("position",new THREE.Float32BufferAttribute(s,3)),o.setAttribute("uv",new THREE.Float32BufferAttribute(l,2));var m=T(e,M,r,i,a,p),v=new THREE.MeshPhongMaterial({map:m,flatShading:!0});return new THREE.Mesh(o,v)}function g(e,t,r,n){for(var i=new THREE.BufferGeometry,a=[],o=[],s=n.vertices,l=e.colors,c=0,u=t.length;c<u;c++){var h=t[c],d=h.v1,f=h.v2,p=h.v3;a.push(s[3*d+0]),a.push(s[3*d+1]),a.push(s[3*d+2]),a.push(s[3*f+0]),a.push(s[3*f+1]),a.push(s[3*f+2]),a.push(s[3*p+0]),a.push(s[3*p+1]),a.push(s[3*p+2]);var m=h.p1,v=h.p2,g=h.p3;o.push(l[3*m+0]),o.push(l[3*m+1]),o.push(l[3*m+2]),o.push(l[3*(v||m)+0]),o.push(l[3*(v||m)+1]),o.push(l[3*(v||m)+2]),o.push(l[3*(g||m)+0]),o.push(l[3*(g||m)+1]),o.push(l[3*(g||m)+2])}i.setAttribute("position",new THREE.Float32BufferAttribute(a,3)),i.setAttribute("color",new THREE.Float32BufferAttribute(o,3));var y=new THREE.MeshPhongMaterial({vertexColors:!0,flatShading:!0});return new THREE.Mesh(i,y)}function y(e){var t=new THREE.BufferGeometry;t.setIndex(new THREE.BufferAttribute(e.triangles,1)),t.setAttribute("position",new THREE.BufferAttribute(e.vertices,3));var r=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0});return new THREE.Mesh(t,r)}function E(e,t){return void 0!==t.resources.texture2dgroup[e]?"texture":void 0!==t.resources.basematerials[e]?"material":void 0!==t.resources.colorgroup[e]?"vertexColors":"default"===e?"default":void 0}function x(e,t,r,n,i){for(var a=new THREE.Group,o=function(e,t,r,n,i){for(var a=Object.keys(e),o=[],s=0,l=a.length;s<l;s++){var c=a[s],u=e[c];switch(E(c,t)){case"material":for(var h=m(t.resources.basematerials[c],u,t,r,n,i),d=0,f=h.length;d<f;d++)o.push(h[d]);break;case"texture":var p=t.resources.texture2dgroup[c];o.push(v(p,u,t,r,n,i));break;case"vertexColors":var x=t.resources.colorgroup[c];o.push(g(x,u,0,r));break;case"default":o.push(y(r));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}return o}(function(e,t,r){for(var n={},i=t.triangleProperties,a=r.pid,o=0,s=i.length;o<s;o++){var l=i[o],c=void 0!==l.pid?l.pid:a;void 0===c&&(c="default"),void 0===n[c]&&(n[c]=[]),n[c].push(l)}return n}(0,e,i),r,e,n,i),s=0,l=o.length;s<l;s++)a.add(o[s]);return a}function T(e,t,r,n,i,a){return void 0!==e.build?e.build:(e.build=a(e,t,r,n,i),e.build)}function b(e,t,r){var n,i=e.displaypropertiesid,a=r.resources.pbmetallicdisplayproperties;if(null!==i&&void 0!==a[i]){var o=a[i].data[e.index];n=new THREE.MeshStandardMaterial({flatShading:!0,roughness:o.roughness,metalness:o.metallicness})}else n=new THREE.MeshPhongMaterial({flatShading:!0});n.name=e.name;var s=e.displaycolor,l=s.substring(0,7);return n.color.setStyle(l),n.color.convertSRGBToLinear(),9===s.length&&(n.opacity=parseInt(s.charAt(7)+s.charAt(8),16)/255),n}function w(e,t,r,n){for(var i=new THREE.Group,a=0;a<e.length;a++){var o=e[a],s=t[o.objectId];void 0===s&&(_(o.objectId,t,r,n),s=t[o.objectId]);var l=s.clone(),c=o.transform;c&&l.applyMatrix4(c),i.add(l)}return i}function _(e,r,n,i){var a=n.resources.object[e];if(a.mesh){var o=a.mesh;!function(e,r,n){if(e){for(var i=[],a=Object.keys(e),o=0;o<a.length;o++)for(var s=a[o],l=0;l<t.availableExtensions.length;l++)(c=t.availableExtensions[l]).ns===s&&i.push(c);for(o=0;o<i.length;o++){var c;(c=i[o]).apply(n,e[c.ns],r)}}}(n.extensions,o,n.xml),r[a.id]=T(o,r,n,i,a,x)}else{var s=a.components;r[a.id]=T(s,r,n,i,a,w)}}var R=function(e){var t,r,a,o,s=null,l=null,c=[],u=[],h=[],d=[],p={},m={};try{s=new n(e)}catch(e){if(e instanceof ReferenceError)return console.error("THREE.3MFLoader: jszip missing and file is compressed."),null}for(l in s.files)l.match(/\_rels\/.rels$/)?t=l:l.match(/3D\/_rels\/.*\.model\.rels$/)?r=l:l.match(/^3D\/.*\.model$/)?c.push(l):l.match(/^3D\/Metadata\/.*\.xml$/)?u.push(l):l.match(/^3D\/Textures?\/.*/)?h.push(l):l.match(/^3D\/Other\/.*/)&&d.push(l);var v=new Uint8Array(s.file(t).asArrayBuffer());a=i(THREE.LoaderUtils.decodeText(v)),r&&(v=new Uint8Array(s.file(r).asArrayBuffer()),o=i(THREE.LoaderUtils.decodeText(v)));for(var g=0;g<c.length;g++){var y=c[g],E=new Uint8Array(s.file(y).asArrayBuffer()),x=THREE.LoaderUtils.decodeText(E),T=(new DOMParser).parseFromString(x,"application/xml");"model"!==T.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",y);var b=T.querySelector("model"),w={};for(g=0;g<b.attributes.length;g++){var _=b.attributes[g];_.name.match(/^xmlns:(.+)$/)&&(w[_.value]=RegExp.$1)}var R=f(b);R.xml=b,0<Object.keys(w).length&&(R.extensions=w),p[y]=R}for(g=0;g<h.length;g++){var M=h[g];m[M]=s.file(M).asArrayBuffer()}return{rels:a,modelRels:o,model:p,printTicket:{},texture:m,other:{}}}(e),M=function(e){var t=e.model,r=e.modelRels,n={},i=Object.keys(t),a={};if(r)for(var o=0,s=r.length;o<s;o++){var l=r[o],c=l.target.substring(1);e.texture[c]&&(a[l.target]=e.texture[c])}for(o=0;o<i.length;o++)for(var u=t[i[o]],h=Object.keys(u.resources.object),d=0;d<h.length;d++)_(h[d],n,u,a);return n}(R);return function(e,t){for(var r=new THREE.Group,n=t.rels[0],i=t.model[n.target.substring(1)].build,a=0;a<i.length;a++){var o=i[a],s=e[o.objectId],l=o.transform;l&&s.applyMatrix4(l),r.add(s)}return r}(M,R)},addExtension:function(e){this.availableExtensions.push(e)}}),THREE.ThreeMFLoader.MaterialsAndPropertiesExtension={ns:"http://schemas.microsoft.com/3dmanufacturing/material/2015/02",apply:function(e,t,r){for(var n=e.querySelectorAll("colorgroup"),i=0;i<n.length;i++){var a=n[i];if(a.prefix===t){for(var o=a.getAttribute("id"),s=a.querySelectorAll("color"),l=[],c=0;c<s.length;c++){var u=s[c].getAttribute("color");u.match(/#[0-9a-fA-F]{8}/)?l.push(new THREE.Color(u.substring(0,7))):l.push(new THREE.Color(u))}for(var h=[],d=0;d<r.triangleProperties.length;d++){var f=r.triangleProperties[d];if(f.pid===o){var p=l[f.p1],m=l[f.p2||f.p1],v=l[f.p3||f.p1];h.push(p.r,p.g,p.b),h.push(m.r,m.g,m.b),h.push(v.r,v.g,v.b)}}r.colors=new Float32Array(h.length);for(var g=0;g<h.length;g++)r.colors[g]=h[g]}}}}},function(e,t,r){"use strict";r.r(t);var n=r(1),i=r.n(n);THREE.VRMLLoader=function(){if(void 0===i.a)throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.");function e(e){THREE.Loader.call(this,e)}function t(e){this.lexer=new i.a.Lexer(e)}function r(e){i.a.Parser.call(this,e);var t=this,r=e.Version,n=e.LCurly,a=e.RCurly,o=e.LSquare,s=e.RSquare,l=e.Identifier,c=e.RouteIdentifier,u=e.StringLiteral,h=e.HexLiteral,d=e.NumberLiteral,f=e.TrueLiteral,p=e.FalseLiteral,m=e.NullLiteral,v=e.DEF,g=e.USE,y=e.ROUTE,E=e.TO,x=e.NodeName;t.RULE("vrml",function(){t.SUBRULE(t.version),t.AT_LEAST_ONE(function(){t.SUBRULE(t.node)}),t.MANY(function(){t.SUBRULE(t.route)})}),t.RULE("version",function(){t.CONSUME(r)}),t.RULE("node",function(){t.OPTION(function(){t.SUBRULE(t.def)}),t.CONSUME(x),t.CONSUME(n),t.MANY(function(){t.SUBRULE(t.field)}),t.CONSUME(a)}),t.RULE("field",function(){t.CONSUME(l),t.OR2([{ALT:function(){t.SUBRULE(t.singleFieldValue)}},{ALT:function(){t.SUBRULE(t.multiFieldValue)}}])}),t.RULE("def",function(){t.CONSUME(v),t.CONSUME(l)}),t.RULE("use",function(){t.CONSUME(g),t.CONSUME(l)}),t.RULE("singleFieldValue",function(){t.AT_LEAST_ONE(function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(f)}},{ALT:function(){t.CONSUME(p)}},{ALT:function(){t.CONSUME(m)}}])})}),t.RULE("multiFieldValue",function(){t.CONSUME(o),t.MANY(function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(m)}}])}),t.CONSUME(s)}),t.RULE("route",function(){t.CONSUME(y),t.CONSUME(c),t.CONSUME(E),t.CONSUME2(c)}),this.performSelfAnalysis()}function n(e,t,r){this.a=e,this.b=t,this.c=r,this.normal=new THREE.Vector3}e.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:e,load:function(e,t,r,n){var i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(e,a))},r,n)},parse:function(e,o){var s={};function l(e){e.DEF&&(s[e.DEF]=e);for(var t=e.fields,r=0,n=t.length;r<n;r++){var i=t[r];if("node"===i.type)for(var a=i.values,o=0,c=a.length;o<c;o++)l(a[o])}}function c(e){return e.USE?(t=e.USE,(r=c(s[t])).isObject3D||r.isMaterial?r.clone():r):void 0!==e.build?e.build:(e.build=function(e){var t,r=e.name;switch(r){case"Group":case"Transform":t=function(e){for(var t=new THREE.Group,r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"center":break;case"children":d(s,t);break;case"rotation":var l=new THREE.Vector3(s[0],s[1],s[2]),c=s[3];t.quaternion.setFromAxisAngle(l,c);break;case"scale":t.scale.set(s[0],s[1],s[2]);break;case"scaleOrientation":break;case"translation":t.position.set(s[0],s[1],s[2]);break;case"bboxCenter":case"bboxSize":break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"Background":t=function(e){for(var t,r,n,i,a=new THREE.Group,o=e.fields,s=0,l=o.length;s<l;s++){var c=o[s],u=c.name,h=c.values;switch(u){case"groundAngle":t=h;break;case"groundColor":r=h;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":n=h;break;case"skyColor":i=h;break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}if(i){var d=new THREE.SphereBufferGeometry(1e4,32,16),f=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,depthWrite:!1,depthTest:!1});i.length>3?(H(d,1e4,n,C(i),!0),f.vertexColors=!0):f.color.setRGB(i[0],i[1],i[2]);var p=new THREE.Mesh(d,f);a.add(p)}if(r&&r.length>0){var m=new THREE.SphereBufferGeometry(1e4,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),v=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,vertexColors:!0,depthWrite:!1,depthTest:!1});H(m,1e4,t,C(r),!1);var g=new THREE.Mesh(m,v);a.add(g)}return a.renderOrder=-1/0,a}(e);break;case"Shape":t=function(e){for(var t,r,n=e.fields,i=new THREE.MeshBasicMaterial({color:0}),a=0,o=n.length;a<o;a++){var s=n[a],l=s.name,u=s.values;switch(l){case"appearance":null!==u[0]&&(i=c(u[0]));break;case"geometry":null!==u[0]&&(t=c(u[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}if(t&&t.attributes.position){var h=t._type;if("points"===h){var d=new THREE.PointsMaterial({color:16777215});void 0!==t.attributes.color?d.vertexColors=!0:i.isMeshPhongMaterial&&d.color.copy(i.emissive),r=new THREE.Points(t,d)}else if("line"===h){var f=new THREE.LineBasicMaterial({color:16777215});void 0!==t.attributes.color?f.vertexColors=!0:i.isMeshPhongMaterial&&f.color.copy(i.emissive),r=new THREE.LineSegments(t,f)}else void 0!==t._solid&&(i.side=t._solid?THREE.FrontSide:THREE.DoubleSide),void 0!==t.attributes.color&&(i.vertexColors=!0),r=new THREE.Mesh(t,i)}else(r=new THREE.Object3D).visible=!1;return r}(e);break;case"Appearance":t=function(e){for(var t,r=new THREE.MeshPhongMaterial,n=e.fields,i=0,o=n.length;i<o;i++){var s=n[i],l=s.name,u=s.values;switch(l){case"material":if(null!==u[0]){var h=c(u[0]);h.diffuseColor&&r.color.copy(h.diffuseColor),h.emissiveColor&&r.emissive.copy(h.emissiveColor),h.shininess&&(r.shininess=h.shininess),h.specularColor&&r.specular.copy(h.specularColor),h.transparency&&(r.opacity=1-h.transparency),h.transparency>0&&(r.transparent=!0)}else r=new THREE.MeshBasicMaterial({color:0});break;case"texture":var d=u[0];null!==d&&("ImageTexture"!==d.name&&"PixelTexture"!==d.name||(r.map=c(d)));break;case"textureTransform":null!==u[0]&&(t=c(u[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}if(r.map){if(r.map.__type){switch(r.map.__type){case a.INTENSITY_ALPHA:r.opacity=1;break;case a.RGB:r.color.set(16777215);break;case a.RGBA:r.color.set(16777215),r.opacity=1}delete r.map.__type}t&&(r.map.center.copy(t.center),r.map.rotation=t.rotation,r.map.repeat.copy(t.scale),r.map.offset.copy(t.translation))}return r}(e);break;case"Material":t=function(e){for(var t={},r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"ambientIntensity":break;case"diffuseColor":t.diffuseColor=new THREE.Color(s[0],s[1],s[2]);break;case"emissiveColor":t.emissiveColor=new THREE.Color(s[0],s[1],s[2]);break;case"shininess":t.shininess=s[0];break;case"specularColor":t.emissiveColor=new THREE.Color(s[0],s[1],s[2]);break;case"transparency":t.transparency=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"ImageTexture":t=function(e){for(var t,r=THREE.RepeatWrapping,n=THREE.RepeatWrapping,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,c=s.values;switch(l){case"url":var u=c[0];u&&(t=I.load(u));break;case"repeatS":!1===c[0]&&(r=THREE.ClampToEdgeWrapping);break;case"repeatT":!1===c[0]&&(n=THREE.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}t&&(t.wrapS=r,t.wrapT=n);return t}(e);break;case"PixelTexture":t=function(e){for(var t,r=THREE.RepeatWrapping,n=THREE.RepeatWrapping,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,c=s.values;switch(l){case"image":for(var d=c[0],f=c[1],p=c[2],m=2===p||4===p,v=h(p),g=d*f*(!0===m?4:3),y=new Uint8Array(g),E={r:0,g:0,b:0,a:0},x=3,T=0,b=c.length;x<b;x++,T++)if(u(c[x],v,E),!0===m){var w=4*T;y[w+0]=E.r,y[w+1]=E.g,y[w+2]=E.b,y[w+3]=E.a}else{var w=3*T;y[w+0]=E.r,y[w+1]=E.g,y[w+2]=E.b}(t=new THREE.DataTexture(y,d,f,!0===m?THREE.RGBAFormat:THREE.RGBFormat)).__type=v;break;case"repeatS":!1===c[0]&&(r=THREE.ClampToEdgeWrapping);break;case"repeatT":!1===c[0]&&(n=THREE.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}t&&(t.wrapS=r,t.wrapT=n);return t}(e);break;case"TextureTransform":t=function(e){for(var t={center:new THREE.Vector2,rotation:new THREE.Vector2,scale:new THREE.Vector2,translation:new THREE.Vector2},r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"center":t.center.set(s[0],s[1]);break;case"rotation":t.rotation=s[0];break;case"scale":t.scale.set(s[0],s[1]);break;case"translation":t.translation.set(s[0],s[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"IndexedFaceSet":t=function(e){for(var t,r,i,a,o,s,l,u,h=!0,d=!0,v=0,g=!0,T=!0,b=e.fields,w=0,M=b.length;w<M;w++){var C=b[w],H=C.name,I=C.values;switch(H){case"color":var k=I[0];null!==k&&(t=c(k));break;case"coord":var N=I[0];null!==N&&(r=c(N));break;case"normal":var O=I[0];null!==O&&(i=c(O));break;case"texCoord":var F=I[0];null!==F&&(a=c(F));break;case"ccw":h=I[0];break;case"colorIndex":o=I;break;case"colorPerVertex":g=I[0];break;case"convex":break;case"coordIndex":s=I;break;case"creaseAngle":v=I[0];break;case"normalIndex":l=I;break;case"normalPerVertex":T=I[0];break;case"solid":d=I[0];break;case"texCoordIndex":u=I;break;default:console.warn("THREE.VRMLLoader: Unknown field:",H)}}if(void 0===s)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new THREE.BufferGeometry;var D,U,z,B,G=f(s,h);if(t)if(!0===g)if(o&&o.length>0){var V=f(o,h);U=_(G,V,t,3)}else U=S(G,new THREE.Float32BufferAttribute(t,3));else if(o&&o.length>0){var j=m(t,o),W=p(j,s);U=R(G,W)}else{var W=p(t,s);U=R(G,W)}if(i)if(!0===T)if(l&&l.length>0){var X=f(l,h);z=_(G,X,i,3)}else z=S(G,new THREE.Float32BufferAttribute(i,3));else if(l&&l.length>0){var Y=m(i,l),q=p(Y,s);z=R(G,q)}else{var q=p(i,s);z=R(G,q)}else z=function(e,t,r){for(var i=[],a={},o=0,s=e.length;o<s;o+=3){var l=e[o],c=e[o+1],u=e[o+2],h=new n(l,c,u);y.fromArray(t,3*l),E.fromArray(t,3*c),x.fromArray(t,3*u),L.subVectors(x,E),A.subVectors(y,E),L.cross(A),L.normalize(),h.normal.copy(L),void 0===a[l]&&(a[l]=[]),void 0===a[c]&&(a[c]=[]),void 0===a[u]&&(a[u]=[]),a[l].push(h.normal),a[c].push(h.normal),a[u].push(h.normal),i.push(h)}for(var d=[],o=0,s=i.length;o<s;o++){var h=i[o],f=P(a[h.a],h.normal,r),p=P(a[h.b],h.normal,r),m=P(a[h.c],h.normal,r);y.fromArray(t,3*h.a),E.fromArray(t,3*h.b),x.fromArray(t,3*h.c),d.push(f.x,f.y,f.z),d.push(p.x,p.y,p.z),d.push(m.x,m.y,m.z)}return new THREE.Float32BufferAttribute(d,3)}(G,r,v);if(a)if(u&&u.length>0){var Z=f(u,h);B=_(G,Z,a,2)}else B=S(G,new THREE.Float32BufferAttribute(a,2));var Q=new THREE.BufferGeometry;D=S(G,new THREE.Float32BufferAttribute(r,3)),Q.setAttribute("position",D),Q.setAttribute("normal",z),U&&Q.setAttribute("color",U);B&&Q.setAttribute("uv",B);return Q._solid=d,Q._type="mesh",Q}(e);break;case"IndexedLineSet":t=function(e){for(var t,r,n,i,a,o=!0,s=e.fields,l=0,u=s.length;l<u;l++){var h=s[l],d=h.name,f=h.values;switch(d){case"color":var p=f[0];null!==p&&(t=c(p));break;case"coord":var y=f[0];null!==y&&(r=c(y));break;case"colorIndex":n=f;break;case"colorPerVertex":o=f[0];break;case"coordIndex":i=f;break;default:console.warn("THREE.VRMLLoader: Unknown field:",d)}}var E=v(i);if(t)if(!0===o)if(n.length>0){var x=v(n);a=_(E,x,t,3)}else a=S(E,new THREE.Float32BufferAttribute(t,3));else if(n.length>0){var T=m(t,n),b=g(T,i);a=M(E,b)}else{var b=g(t,i);a=M(E,b)}var w=new THREE.BufferGeometry,R=S(E,new THREE.Float32BufferAttribute(r,3));w.setAttribute("position",R),a&&w.setAttribute("color",a);return w._type="line",w}(e);break;case"PointSet":t=function(e){for(var t,r,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,l=o.values;switch(s){case"color":var u=l[0];null!==u&&(t=c(u));break;case"coord":var h=l[0];null!==h&&(r=c(h));break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}var d;(d=new THREE.BufferGeometry).setAttribute("position",new THREE.Float32BufferAttribute(r,3)),t&&d.setAttribute("color",new THREE.Float32BufferAttribute(t,3));return d._type="points",d}(e);break;case"Box":t=function(e){for(var t=new THREE.Vector3(2,2,2),r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"size":t.x=s[0],t.y=s[1],t.z=s[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new THREE.BoxBufferGeometry(t.x,t.y,t.z)}(e);break;case"Cone":t=function(e){for(var t=1,r=2,n=!1,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,c=s.values;switch(l){case"bottom":n=!c[0];break;case"bottomRadius":t=c[0];break;case"height":r=c[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}return new THREE.ConeBufferGeometry(t,r,16,1,n)}(e);break;case"Cylinder":t=function(e){for(var t=1,r=2,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,l=o.values;switch(s){case"bottom":break;case"radius":t=l[0];break;case"height":r=l[0];break;case"side":case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new THREE.CylinderBufferGeometry(t,t,r,16,1)}(e);break;case"Sphere":t=function(e){for(var t=1,r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"radius":t=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new THREE.SphereBufferGeometry(t,16,16)}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":t=function(e){return e.fields[0].values}(e);break;case"Anchor":case"Billboard":case"Collision":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"WorldInfo":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"ElevationGrid":case"Extrusion":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",r)}return t}(e),e.build);var t,r}function u(e,t,r){switch(t){case a.INTENSITY:var n=parseInt(e);r.r=n,r.g=n,r.b=n;break;case a.INTENSITY_ALPHA:n=parseInt("0x"+e.substring(2,4));r.r=n,r.g=n,r.b=n,r.a=parseInt("0x"+e.substring(4,6));break;case a.RGB:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8));break;case a.RGBA:r.r=parseInt("0x"+e.substring(2,4)),r.g=parseInt("0x"+e.substring(4,6)),r.b=parseInt("0x"+e.substring(6,8)),r.a=parseInt("0x"+e.substring(8,10))}}function h(e){var t;switch(e){case 1:t=a.INTENSITY;break;case 2:t=a.INTENSITY_ALPHA;break;case 3:t=a.RGB;break;case 4:t=a.RGBA}return t}function d(e,t){for(var r=0,n=e.length;r<n;r++){var i=c(e[r]);i instanceof THREE.Object3D&&t.add(i)}}function f(e,t){for(var r=[],n=0,i=0,a=e.length;i<a;i++){var o=e[n],s=e[i+(t?1:2)],l=e[i+(t?2:1)];r.push(o,s,l),(-1===e[i+3]||i+3>=a)&&(n=(i+=3)+1)}return r}function p(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],l=e[o+1],c=e[o+2];r.push(s,l,c),(-1===t[i+3]||i+3>=a)&&(i+=3,n++)}return r}function m(e,t){for(var r=[],n=0,i=t.length;n<i;n++){var a=3*t[n],o=e[a],s=e[a+1],l=e[a+2];r.push(o,s,l)}return r}function v(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=e[r+1];t.push(i,a),(-1===e[r+2]||r+2>=n)&&(r+=2)}return t}function g(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],l=e[o+1],c=e[o+2];r.push(s,l,c),(-1===t[i+2]||i+2>=a)&&(i+=2,n++)}return r}var y=new THREE.Vector3,E=new THREE.Vector3,x=new THREE.Vector3,T=new THREE.Vector2,b=new THREE.Vector2,w=new THREE.Vector2;function _(e,t,r,n){for(var i=[],a=0,o=e.length;a<o;a+=3){var s=t[a],l=t[a+1],c=t[a+2];2===n?(T.fromArray(r,s*n),b.fromArray(r,l*n),w.fromArray(r,c*n),i.push(T.x,T.y),i.push(b.x,b.y),i.push(w.x,w.y)):(y.fromArray(r,s*n),E.fromArray(r,l*n),x.fromArray(r,c*n),i.push(y.x,y.y,y.z),i.push(E.x,E.y,E.z),i.push(x.x,x.y,x.z))}return new THREE.Float32BufferAttribute(i,n)}function R(e,t){for(var r=[],n=0,i=0,a=e.length;n<a;n+=3,i++)y.fromArray(t,3*i),r.push(y.x,y.y,y.z),r.push(y.x,y.y,y.z),r.push(y.x,y.y,y.z);return new THREE.Float32BufferAttribute(r,3)}function M(e,t){for(var r=[],n=0,i=0,a=e.length;n<a;n+=2,i++)y.fromArray(t,3*i),r.push(y.x,y.y,y.z),r.push(y.x,y.y,y.z);return new THREE.Float32BufferAttribute(r,3)}function S(e,t){for(var r=t.array,n=t.itemSize,i=new r.constructor(e.length*n),a=0,o=0,s=0,l=e.length;s<l;s++){a=e[s]*n;for(var c=0;c<n;c++)i[o++]=r[a++]}return new THREE.Float32BufferAttribute(i,n)}var A=new THREE.Vector3,L=new THREE.Vector3;function P(e,t,r){var n=new THREE.Vector3;if(0===r)n.copy(t);else for(var i=0,a=e.length;i<a;i++)e[i].angleTo(t)<r&&n.add(e[i]);return n.normalize()}function C(e){for(var t=[],r=0,n=e.length;r<n;r+=3)t.push(new THREE.Color(e[r],e[r+1],e[r+2]));return t}function H(e,t,r,n,i){for(var a=[],o=!0===i?0:Math.PI,s=0,l=n.length;s<l;s++){var c=0===s?0:r[s-1];c=!0===i?c:o-c;var u=new THREE.Vector3;u.setFromSphericalCoords(t,c,0),a.push(u)}var h=e.index,d=e.attributes.position,f=new THREE.BufferAttribute(new Float32Array(3*e.attributes.position.count),3),p=new THREE.Vector3,m=new THREE.Color;for(s=0;s<h.count;s++){var v,g,y=h.getX(s);p.fromBufferAttribute(d,y);for(var E=1,x=1;x<a.length;x++){g=x;var T=a[v=x-1],b=a[g];if(!0===i){if(p.y<=T.y&&p.y>b.y){E=Math.abs(T.y-p.y)/Math.abs(T.y-b.y);break}}else if(p.y>=T.y&&p.y<b.y){E=Math.abs(T.y-p.y)/Math.abs(T.y-b.y);break}}var w=n[v],_=n[g];m.copy(w).lerp(_,E),f.setXYZ(y,m.r,m.g,m.b)}e.setAttribute("color",f)}var I=new THREE.TextureLoader(this.manager);I.setPath(this.resourcePath||o).setCrossOrigin(this.crossOrigin);var k=function(e){var n=function(){for(var e=i.a.createToken,t=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),r=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:t}),n=e({name:"Version",pattern:/#VRML.*/,longer_alt:r}),a=e({name:"NodeName",pattern:new RegExp(["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"].join("|")),longer_alt:r}),o=e({name:"DEF",pattern:/DEF/,longer_alt:r}),s=e({name:"USE",pattern:/USE/,longer_alt:r}),l=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:r}),c=e({name:"TO",pattern:/TO/,longer_alt:r}),u=e({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]+|\\(:?[bfnrtv"\\\/]|u[0-9a-fA-F]{4}))*"/}),h=e({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),d=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),f=e({name:"TrueLiteral",pattern:/TRUE/}),p=e({name:"FalseLiteral",pattern:/FALSE/}),m=e({name:"NullLiteral",pattern:/NULL/}),v=e({name:"LSquare",pattern:/\[/}),g=e({name:"RSquare",pattern:/]/}),y=e({name:"LCurly",pattern:/{/}),E=e({name:"RCurly",pattern:/}/}),x=e({name:"Comment",pattern:/#.*/,group:i.a.Lexer.SKIPPED}),T=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:i.a.Lexer.SKIPPED}),a,o,s,l,c,f,p,m,n,r,t,u,h,d,v,g,y,E,x],b={},w=0,_=T.length;w<_;w++){var R=T[w];b[R.name]=R}return{tokens:T,tokenVocabulary:b}}(),a=new t(n.tokens),o=new r(n.tokenVocabulary),s=function(e){function t(){e.call(this),this.validateVisitor()}function r(e,t){var r={type:null,values:[]};if(t.node){r.type="node";for(var n=0,i=t.node.length;n<i;n++){var a=t.node[n];r.values.push(e.visit(a))}}if(t.use){r.type="use";for(var n=0,i=t.use.length;n<i;n++){var o=t.use[n];r.values.push(e.visit(o))}}if(t.StringLiteral){r.type="string";for(var n=0,i=t.StringLiteral.length;n<i;n++){var s=t.StringLiteral[n];r.values.push(s.image.replace(/'|"/g,""))}}if(t.NumberLiteral){r.type="number";for(var n=0,i=t.NumberLiteral.length;n<i;n++){var l=t.NumberLiteral[n];r.values.push(parseFloat(l.image))}}if(t.HexLiteral){r.type="hex";for(var n=0,i=t.HexLiteral.length;n<i;n++){var c=t.HexLiteral[n];r.values.push(c.image)}}if(t.TrueLiteral){r.type="boolean";for(var n=0,i=t.TrueLiteral.length;n<i;n++){var u=t.TrueLiteral[n];"TRUE"===u.image&&r.values.push(!0)}}if(t.FalseLiteral){r.type="boolean";for(var n=0,i=t.FalseLiteral.length;n<i;n++){var h=t.FalseLiteral[n];"FALSE"===h.image&&r.values.push(!1)}}return t.NullLiteral&&(r.type="null",t.NullLiteral.forEach(function(){r.values.push(null)})),r}return t.prototype=Object.assign(Object.create(e.prototype),{constructor:t,vrml:function(e){for(var t={version:this.visit(e.version),nodes:[],routes:[]},r=0,n=e.node.length;r<n;r++){var i=e.node[r];t.nodes.push(this.visit(i))}if(e.route)for(r=0,n=e.route.length;r<n;r++){var a=e.route[r];t.routes.push(this.visit(a))}return t},version:function(e){return e.Version[0].image},node:function(e){var t={name:e.NodeName[0].image,fields:[]};if(e.field)for(var r=0,n=e.field.length;r<n;r++){var i=e.field[r];t.fields.push(this.visit(i))}return e.def&&(t.DEF=this.visit(e.def[0])),t},field:function(e){var t,r={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(t=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(t=this.visit(e.multiFieldValue[0])),r.type=t.type,r.values=t.values,r},def:function(e){return e.Identifier[0].image},use:function(e){return{USE:e.Identifier[0].image}},singleFieldValue:function(e){return r(this,e)},multiFieldValue:function(e){return r(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new t}(o.getBaseCstVisitorConstructor()),l=a.lex(e);o.input=l.tokens;var c=o.vrml();if(o.errors.length>0)throw console.error(o.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return s.visit(c)}(e);if(-1===k.version.indexOf("V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(e){for(var t=e.nodes,r=new THREE.Scene,n=0,i=t.length;n<i;n++)l(t[n]);for(n=0,i=t.length;n<i;n++){var a=c(t[n]);a instanceof THREE.Object3D&&r.add(a)}return r}(k)}}),t.prototype={constructor:t,lex:function(e){var t=this.lexer.tokenize(e);if(t.errors.length>0)throw console.error(t.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return t}},r.prototype=Object.create(i.a.Parser.prototype),r.prototype.constructor=r;var a={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};return e}()},function(e,t,r){"use strict";r.r(t);var n=r(2);THREE.FBXLoader=function(){var e,t,r;function i(e){THREE.Loader.call(this,e)}function a(e,t){this.textureLoader=e,this.manager=t}function o(){}function s(){}function l(){}function c(){}function u(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function d(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(e){return e/46186158e3}i.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:i,load:function(e,t,r,n){var i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.load(e,function(r){try{t(i.parse(r,a))}catch(t){setTimeout(function(){n&&n(t),i.manager.itemError(e)},0)}},r,n)},parse:function(t,r){if(o="Kaydara FBX Binary  \0",(i=t).byteLength>=o.length&&o===T(i,0,o.length))e=(new c).parse(t);else{var n=T(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(t){var n=e[t-1];return e=e.slice(r+t),r++,n}for(var i=0;i<t.length;++i){var a=n(1);if(a===t[i])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(d(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d(n));e=(new l).parse(n)}var i,o;return new a(new THREE.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}),a.prototype={constructor:a,parse:function(){t=this.parseConnections();var e=this.parseImages(),n=this.parseTextures(e),i=this.parseMaterials(n),a=this.parseDeformers(),s=(new o).parse(a);return this.parseScene(a,s,i),r},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach(function(e){var r=e[0],n=e[1],i=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};t.get(r).parents.push(a),t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};t.get(n).children.push(o)});return t},parseImages:function(){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var a=n[i];if(t[c=parseInt(i)]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"==typeof a.Content&&""!==a.Content;if(o||s){var l=this.parseImage(n[i]);r[a.RelativeFilename||a.Filename]=l}}}}for(var c in t){var u=t[c];void 0!==r[u]?t[c]=r[u]:t[c]=t[c].split("\\").pop()}return t},parseImage:function(e){var t,r=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var a=new Uint8Array(r);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(t){var r=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var i in n){var a=this.parseTexture(n[i],t);r.set(parseInt(i),a)}}return r},parseTexture:function(e,t){var r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;var n=e.WrapModeU,i=e.WrapModeV,a=void 0!==n?n.value:0,o=void 0!==i?i.value:0;if(r.wrapS=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r.wrapT=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;r.repeat.x=s[0],r.repeat.y=s[1]}return r},loadTexture:function(e,r){var n,i,a=this.textureLoader.path,o=t.get(e.id).children;void 0!==o&&o.length>0&&void 0!==r[o[0].ID]&&(0!==(n=r[o[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var l=this.manager.getHandler(".tga");null===l?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new THREE.Texture):i=l.load(n)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new THREE.Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(a),i},parseMaterials:function(t){var r=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var i in n){var a=this.parseMaterial(n[i],t);null!==a&&r.set(parseInt(i),a)}}return r},parseMaterial:function(e,r){var n=e.id,i=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!t.has(n))return null;var o,s=this.parseParameters(e,r,n);switch(a.toLowerCase()){case"phong":o=new THREE.MeshPhongMaterial;break;case"lambert":o=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new THREE.MeshPhongMaterial}return o.setValues(s),o.name=i,o},parseParameters:function(e,r,n){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(i.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(i.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var a=this;return t.get(n).children.forEach(function(e){var t=e.relationship;switch(t){case"Bump":i.bumpMap=a.getTexture(r,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=a.getTexture(r,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=a.getTexture(r,e.ID),i.map.encoding=THREE.sRGBEncoding;break;case"DisplacementColor":i.displacementMap=a.getTexture(r,e.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(r,e.ID),i.emissiveMap.encoding=THREE.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=a.getTexture(r,e.ID);break;case"ReflectionColor":i.envMap=a.getTexture(r,e.ID),i.envMap.mapping=THREE.EquirectangularReflectionMapping,i.envMap.encoding=THREE.sRGBEncoding;break;case"SpecularColor":i.specularMap=a.getTexture(r,e.ID),i.specularMap.encoding=THREE.sRGBEncoding;break;case"TransparentColor":i.alphaMap=a.getTexture(r,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}}),i},getTexture:function(r,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var a in i){var o=i[a],s=t.get(parseInt(a));if("Skin"===o.attrType){var l=this.parseSkeleton(s,i);l.ID=a,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,r[a]=l}else if("BlendShape"===o.attrType){var c={id:a};c.rawTargets=this.parseMorphTargets(s,i),c.id=a,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[a]=c}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(e,t){var r=[];return e.children.forEach(function(e){var n=t[e.ID];if("Cluster"===n.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}}),{rawBones:r,bones:[]}},parseMorphTargets:function(e,r){for(var n=[],i=0;i<e.children.length;i++){var a=e.children[i],o=r[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=t.get(parseInt(a.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,n.push(s)}return n},parseScene:function(n,i,a){r=new THREE.Group;var o=this.parseModels(n.skeletons,i,a),l=e.Objects.Model,c=this;o.forEach(function(e){var n=l[e.ID];c.setLookAtProperties(e,n),t.get(e.ID).parents.forEach(function(t){var r=o.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&r.add(e)}),this.bindSkeleton(n.skeletons,i,o),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=y(e.userData.transformData);e.applyMatrix4(t)}});var u=(new s).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=u,r=r.children[0]),r.animations=u},parseModels:function(r,n,i){var a=new Map,o=e.Objects.Model;for(var s in o){var l=parseInt(s),c=o[s],u=t.get(l),h=this.buildSkeleton(u,r,l,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(u);break;case"Light":h=this.createLight(u);break;case"Mesh":h=this.createMesh(u,n,i);break;case"NurbsCurve":h=this.createCurve(u,n);break;case"LimbNode":case"Root":h=new THREE.Bone;break;case"Null":default:h=new THREE.Group}h.name=c.attrName?THREE.PropertyBinding.sanitizeNodeName(c.attrName):"",h.ID=l}this.getTransformData(h,c),a.set(l,h)}return a},buildSkeleton:function(e,t,r,n){var i=null;return e.parents.forEach(function(e){for(var a in t){var o=t[a];o.rawBones.forEach(function(t,a){if(t.ID===e.ID){var s=i;(i=new THREE.Bone).matrixWorld.copy(t.transformLink),i.name=n?THREE.PropertyBinding.sanitizeNodeName(n):"",i.ID=r,o.bones[a]=i,null!==s&&i.add(s)}})}}),i},createCamera:function(t){var r,n;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)}),void 0===n)r=new THREE.Object3D;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var a=1;void 0!==n.NearPlane&&(a=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,l=n.AspectHeight.value);var c=s/l,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new THREE.PerspectiveCamera(u,c,a,o),null!==h&&r.setFocalLength(h);break;case 1:r=new THREE.OrthographicCamera(-s/2,s/2,l/2,-l/2,a,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),r=new THREE.Object3D}}return r},createLight:function(t){var r,n;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)}),void 0===n)r=new THREE.Object3D;else{var i;i=void 0===n.LightType?0:n.LightType.value;var a=16777215;void 0!==n.Color&&(a=(new THREE.Color).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(i){case 0:r=new THREE.PointLight(a,o,s,1);break;case 1:r=new THREE.DirectionalLight(a,o);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=THREE.MathUtils.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=THREE.MathUtils.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new THREE.SpotLight(a,o,s,l,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),r=new THREE.PointLight(a,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(e,t,r){var n,i=null,a=null,o=[];return e.children.forEach(function(e){t.has(e.ID)&&(i=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))}),o.length>1?a=o:o.length>0?a=o[0]:(a=new THREE.MeshPhongMaterial({color:13421772}),o.push(a)),"color"in i.attributes&&o.forEach(function(e){e.vertexColors=!0}),i.FBX_Deformer?(o.forEach(function(e){e.skinning=!0}),(n=new THREE.SkinnedMesh(i,a)).normalizeSkinWeights()):n=new THREE.Mesh(i,a),n},createCurve:function(e,t){var r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(r,n)},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?E(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(n,i){"LookAtProperty"in i&&t.get(n.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){var i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){var a=i.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(a),r.add(n.target)):n.lookAt((new THREE.Vector3).fromArray(a))}}})},bindSkeleton:function(e,r,n){var i=this.parsePoseNodes();for(var a in e){var o=e[a];t.get(parseInt(o.ID)).parents.forEach(function(e){if(r.has(e.ID)){var a=e.ID;t.get(a).parents.forEach(function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(o.bones),i[e.ID])})}})}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach(function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)}):t[i.Node]=(new THREE.Matrix4).fromArray(i.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],i=t[1],a=t[2];if(0!==n||0!==i||0!==a){var o=new THREE.Color(n,i,a);r.add(new THREE.AmbientLight(o,1))}}},setupMorphMaterials:function(){var e=this;r.traverse(function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach(function(r,n){e.setupMorphMaterial(t,r,n)}):e.setupMorphMaterial(t,t.material))})},setupMorphMaterial:function(e,t,n){var i=e.uuid,a=t.uuid,o=!1;if(r.traverse(function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach(function(t){t.uuid===a&&e.uuid!==i&&(o=!0)}):e.material.uuid===a&&e.uuid!==i&&(o=!0))}),!0===o){var s=t.clone();s.morphTargets=!0,void 0===n?e.material=s:e.material[n]=s}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(r){var n=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var a in i){var o=t.get(parseInt(a)),s=this.parseGeometry(o,i[a],r);n.set(parseInt(a),s)}}return n},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,r,n){var i=n.skeletons,a=[],o=t.parents.map(function(t){return e.Objects.Model[t.ID]});if(0!==o.length){var s=t.children.reduce(function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e},null);t.children.forEach(function(e){void 0!==n.morphTargets[e.ID]&&a.push(n.morphTargets[e.ID])});var l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=E(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);var u=y(c);return this.genGeometry(r,s,a,u)}},genGeometry:function(e,t,r,n){var i=new THREE.BufferGeometry;e.attrName&&(i.name=e.attrName);var a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new THREE.Float32BufferAttribute(o.vertex,3);if(s.applyMatrix4(n),i.setAttribute("position",s),o.colors.length>0&&i.setAttribute("color",new THREE.Float32BufferAttribute(o.colors,3)),t&&(i.setAttribute("skinIndex",new THREE.Uint16BufferAttribute(o.weightsIndices,4)),i.setAttribute("skinWeight",new THREE.Float32BufferAttribute(o.vertexWeights,4)),i.FBX_Deformer=t),o.normal.length>0){var l=(new THREE.Matrix3).getNormalMatrix(n),c=new THREE.Float32BufferAttribute(o.normal,3);c.applyNormalMatrix(l),i.setAttribute("normal",c)}if(o.uvs.forEach(function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),i.setAttribute(r,new THREE.Float32BufferAttribute(o.uvs[t],2))}),a.material&&"AllSame"!==a.material.mappingType){var u=o.materialIndex[0],h=0;if(o.materialIndex.forEach(function(e,t){e!==u&&(i.addGroup(h,t-h,u),u=e,h=t)}),i.groups.length>0){var d=i.groups[i.groups.length-1],f=d.start+d.count;f!==o.materialIndex.length&&i.addGroup(f,o.materialIndex.length-f,u)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,e,r,n),i},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var n=0;e.LayerElementUV[n];)r.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[i]})})})),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,i=!1,a=[],o=[],s=[],l=[],c=[],u=[],h=this;return e.vertexIndices.forEach(function(d,f){var p=!1;d<0&&(d^=-1,p=!0);var v=[],g=[];if(a.push(3*d,3*d+1,3*d+2),e.color){var y=m(f,r,d,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach(function(e){g.push(e.weight),v.push(e.id)}),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var E=[0,0,0,0],x=[0,0,0,0];g.forEach(function(e,t){var r=e,n=v[t];x.forEach(function(e,t,i){if(r>e){i[t]=r,r=e;var a=E[t];E[t]=n,n=a}})}),v=E,g=x}for(;g.length<4;)g.push(0),v.push(0);for(var T=0;T<4;++T)c.push(g[T]),u.push(v[T])}if(e.normal){y=m(f,r,d,e.normal);o.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var b=m(f,r,d,e.material)[0];e.uv&&e.uv.forEach(function(e,t){var n=m(f,r,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])}),n++,p&&(h.genFace(t,e,a,b,o,s,l,c,u,n),r++,n=0,a=[],o=[],s=[],l=[],c=[],u=[])}),t},genFace:function(e,t,r,n,i,a,o,s,l,c){for(var u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(u-1)]),e.colors.push(a[3*(u-1)+1]),e.colors.push(a[3*(u-1)+2]),e.colors.push(a[3*u]),e.colors.push(a[3*u+1]),e.colors.push(a[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(u-1)]),e.uvs[r].push(o[r][2*(u-1)+1]),e.uvs[r].push(o[r][2*u]),e.uvs[r].push(o[r][2*u+1])})},addMorphTargets:function(t,r,n,i){if(0!==n.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var a=this;n.forEach(function(n){n.rawTargets.forEach(function(n){var o=e.Objects.Geometry[n.geoID];void 0!==o&&a.genMorphGeometry(t,r,o,i,n.name)})})}},genMorphGeometry:function(e,t,r,n,i){for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==r.Vertices?r.Vertices.a:[],s=void 0!==r.Indexes?r.Indexes.a:[],l=3*e.attributes.position.count,c=new Float32Array(l),u=0;u<s.length;u++){var h=3*s[u];c[h]=o[3*u],c[h+1]=o[3*u+1],c[h+2]=o[3*u+2]}var d={vertexIndices:a,vertexPositions:c},f=this.genBuffers(d),p=new THREE.Float32BufferAttribute(f.vertex,3);p.name=i||r.attrName,p.applyMatrix4(n),e.morphAttributes.position.push(p)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,i=[];return"IndexToDirect"===r&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,i=[];return"IndexToDirect"===r&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,i=[];return"IndexToDirect"===r&&(i=e.ColorIndex.a),{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,i=[],a=0;a<n.length;++a)i.push(a);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:r}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var r,n,i=t-1,a=e.KnotVector.a,o=[],s=e.Points.a,l=0,c=s.length;l<c;l+=4)o.push((new THREE.Vector4).fromArray(s,l));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){r=i,n=a.length-1-r;for(l=0;l<i;++l)o.push(o[l])}var u=new THREE.NURBSCurve(i,a,o,r,n).getPoints(7*o.length),h=new Float32Array(3*u.length);u.forEach(function(e,t){e.toArray(h,3*t)});var d=new THREE.BufferGeometry;return d.setAttribute("position",new THREE.BufferAttribute(h,3)),d}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var r in t){var n=t[r],i=this.addClip(n);e.push(i)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var i=t[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var a={id:i.id,attr:i.attrName,curves:{}};r.set(a.id,a)}}return r},parseAnimationCurves:function(r){var n=e.Objects.AnimationCurve;for(var i in n){var a={id:n[i].id,times:n[i].KeyTime.a.map(f),values:n[i].KeyValueFloat.a},o=t.get(a.id);if(void 0!==o){var s=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?r.get(s).curves.x=a:l.match(/Y/)?r.get(s).curves.y=a:l.match(/Z/)?r.get(s).curves.z=a:l.match(/d|DeformPercent/)&&r.has(s)&&(r.get(s).curves.morph=a)}}},parseAnimationLayers:function(n){var i=e.Objects.AnimationLayer,a=new Map;for(var o in i){var s=[],l=t.get(parseInt(o));if(void 0!==l)l.children.forEach(function(i,a){if(n.has(i.ID)){var o=n.get(i.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[a])if(void 0!==(f=t.get(i.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID)){var l={modelName:(c=e.Objects.Model[f.toString()]).attrName?THREE.PropertyBinding.sanitizeNodeName(c.attrName):"",ID:c.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse(function(e){e.ID===c.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))}),l.transform||(l.transform=new THREE.Matrix4),"PreRotation"in c&&(l.preRotation=c.PreRotation.value),"PostRotation"in c&&(l.postRotation=c.PostRotation.value),s[a]=l}s[a]&&(s[a][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===s[a]){var c,u=t.get(i.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,h=t.get(u).parents[0].ID,d=t.get(h).parents[0].ID,f=t.get(d).parents[0].ID;l={modelName:(c=e.Objects.Model[f]).attrName?THREE.PropertyBinding.sanitizeNodeName(c.attrName):"",morphName:e.Objects.Deformer[u].attrName};s[a]=l}s[a][o.attr]=o}}}),a.set(parseInt(o),s)}return a},parseAnimStacks:function(r){var n=e.Objects.AnimationStack,i={};for(var a in n){var o=t.get(parseInt(a)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);i[a]={name:n[a].attrName,layer:s}}return i},addClip:function(e){var t=[],r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;if(e.transform&&e.transform.decompose(r,n,i),r=r.toArray(),n=(new THREE.Euler).setFromQuaternion(n,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var o=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&t.push(o)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,r,n){var i=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(i,t,r);return new THREE.VectorKeyframeTrack(e+"."+n,i,a)},generateRotationTrack:function(e,t,r,n,i,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.MathUtils.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,r);void 0!==n&&((n=n.map(THREE.MathUtils.degToRad)).push(a),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n)),void 0!==i&&((i=i.map(THREE.MathUtils.degToRad)).push(a),i=(new THREE.Euler).fromArray(i),i=(new THREE.Quaternion).setFromEuler(i).inverse());for(var l=new THREE.Quaternion,c=new THREE.Euler,u=[],h=0;h<s.length;h+=3)c.set(s[h],s[h+1],s[h+2],a),l.setFromEuler(c),void 0!==n&&l.premultiply(n),void 0!==i&&l.multiply(i),l.toArray(u,h/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",o,u)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map(function(e){return e/100}),i=r.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,r){return r.indexOf(e)==t})},getKeyframeTrackValues:function(e,t,r){var n=r,i=[],a=-1,o=-1,s=-1;return e.forEach(function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var r=t.x.values[a];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==o){var l=t.y.values[o];i.push(l),n[1]=l}else i.push(n[1]);if(-1!==s){var c=t.z.values[s];i.push(c),n[2]=c}else i.push(n[2])}),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var r=e.values[t-1],n=e.values[t]-r,i=Math.abs(n);if(i>=180){for(var a=i/180,o=n/a,s=r+o,l=e.times[t-1],c=(e.times[t]-l)/a,u=l+c,h=[],d=[];u<e.times[t];)h.push(u),u+=c,d.push(s),s+=o;e.times=b(e.times,t,h),e.values=b(e.values,t,d)}}}},l.prototype={constructor:l,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,n){var i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!i&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:r},a=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in o?("PoseNode"===r?o.PoseNode.push(i):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=i)):"number"==typeof a.id?(o[r]={},o[r][a.id]=i):"Properties70"!==r&&(o[r]="PoseNode"===r?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===n){var o=i.split(",").slice(1),s=parseInt(o[0]),l=parseInt(o[1]),c=i.split(",").slice(3);n="connections",function(e,t){for(var r=0,n=e.length,i=t.length;r<i;r++,n++)e[n]=t[r]}(i=[s,l],c=c.map(function(e){return e.trim().replace(/^"/,"")})),void 0===a[n]&&(a[n]=[])}"Node"===n&&(a.id=i),n in a&&Array.isArray(a[n])?a[n].push(i):"a"!==n?a[n]=i:a.a=i,this.setCurrentProp(a,n),"a"===n&&","!==i.slice(-1)&&(a.a=x(i))}else this.parseNodeSpecialProperty(e,n,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=x(t.a))},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=n[0],a=n[1],o=n[2],s=n[3],l=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=x(l)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}},c.prototype={constructor:c,parse:function(e){var t=new u(e);t.skip(23);var r=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+r);for(var n=new h;!this.endOfContent(t);){var i=this.parseNode(t,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32(),a=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(a);if(0===n)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(e));var c=s.length>0?s[0]:"",u=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(r.singleProperty=1===i&&e.getOffset()===n;n>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,r,d)}return r.propertyList=s,"number"==typeof c&&(r.id=c),""!==u&&(r.attrName=u),""!==h&&(r.attrType=h),""!==o&&(r.name=o),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var i=[];r.propertyList.forEach(function(e,t){0!==t&&i.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===r.name){Object.keys(r).forEach(function(e){t[e]=r[e]})}else if("Properties70"===e&&"P"===r.name){var a,o=r.propertyList[0],s=r.propertyList[1],l=r.propertyList[2],c=r.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[o]={type:s,type2:l,flag:c,value:a}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=e.getUint32(),a=e.getUint32(),o=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}void 0===n.Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new u(new n.Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(i);case"d":return s.getFloat64Array(i);case"f":return s.getFloat32Array(i);case"i":return s.getInt32Array(i);case"l":return s.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},u.prototype={constructor:u,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],r=0;r<e;r++)t[r]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var p=[];function m(e,t,r,n){var i;switch(n.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);var a=i*n.dataSize,o=a+n.dataSize;return function(e,t,r,n){for(var i=r,a=0;i<n;i++,a++)e[a]=t[i];return e}(p,n.buffer,a,o)}var v=new THREE.Euler,g=new THREE.Vector3;function y(e){var t,r=new THREE.Matrix4,n=new THREE.Matrix4,i=new THREE.Matrix4,a=new THREE.Matrix4,o=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,c=new THREE.Matrix4,u=new THREE.Matrix4,h=new THREE.Matrix4,d=new THREE.Matrix4,f=e.inheritType?e.inheritType:0;(e.translation&&r.setPosition(g.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(THREE.MathUtils.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(v.fromArray(t)));e.rotation&&((t=e.rotation.map(THREE.MathUtils.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(v.fromArray(t)));e.postRotation&&((t=e.postRotation.map(THREE.MathUtils.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(v.fromArray(t)));e.scale&&o.scale(g.fromArray(e.scale)),e.scalingOffset&&l.setPosition(g.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(g.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(g.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(g.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var p=n.multiply(i).multiply(a),m=new THREE.Matrix4;h.extractRotation(m);var y,E,x,T,b=new THREE.Matrix4;if(b.copyPosition(h),x=b.getInverse(b).multiply(h),E=m.getInverse(m).multiply(x),y=o,0===f)T=m.multiply(p).multiply(E).multiply(y);else if(1===f)T=m.multiply(E).multiply(p).multiply(y);else{var w=(new THREE.Matrix4).copy(o),_=E.multiply(w.getInverse(w));T=m.multiply(p).multiply(_).multiply(y)}var R=r.multiply(c).multiply(u).multiply(n).multiply(i).multiply(a).multiply(u.getInverse(u)).multiply(l).multiply(s).multiply(o).multiply(s.getInverse(s)),M=(new THREE.Matrix4).copyPosition(R),S=h.multiply(M);return d.copyPosition(S),R=d.multiply(T)}function E(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function x(e){return e.split(",").map(function(e){return parseFloat(e)})}function T(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function b(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return i}()},function(e,t,r){"use strict";r.r(t);var n=r(8);THREE.NRRDLoader=function(e){THREE.Loader.call(this,e)},THREE.NRRDLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.NRRDLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){var t=e,r=0,i=new Int8Array(new Int16Array([1]).buffer)[0]>0,a=!0,o={};var s=function(e,n){null==n&&(n=1);var o=1,s=Uint8Array;switch(e){case"uchar":break;case"schar":s=Int8Array;break;case"ushort":s=Uint16Array,o=2;break;case"sshort":s=Int16Array,o=2;break;case"uint":s=Uint32Array,o=4;break;case"sint":s=Int32Array,o=4;break;case"float":s=Float32Array,o=4;break;case"complex":case"double":s=Float64Array,o=8}var l=new s(t.slice(r,r+=n*o));return i!=a&&(l=function(e,t){for(var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=0;n<e.byteLength;n+=t)for(var i=n+t-1,a=n;i>a;i--,a++){var o=r[a];r[a]=r[i],r[i]=o}return e}(l,o)),1==n?l[0]:l}("uchar",e.byteLength),l=s.length,c=null,u=0;for(f=1;f<l;f++)if(10==s[f-1]&&10==s[f]){c=this.parseChars(s,0,f-2),u=f+1;break}!function(e){var t,r,n,i,a,s,l,c,u;for(c=0,u=(s=e.split(/\r?\n/)).length;c<u;c++)(a=s[c]).match(/NRRD\d+/)?o.isNrrd=!0:a.match(/^#/)||(l=a.match(/(.*):(.*)/))&&(r=l[1].trim(),t=l[2].trim(),(n=THREE.NRRDLoader.prototype.fieldFunctions[r])?n.call(o,t):o[r]=t);if(!o.isNrrd)throw new Error("Not an NRRD file");if("bz2"===o.encoding||"bzip2"===o.encoding)throw new Error("Bzip is not supported");if(!o.vectors&&(o.vectors=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],o.spacings))for(i=0;i<=2;i++)isNaN(o.spacings[i])||o.vectors[i].multiplyScalar(o.spacings[i])}(c);t=s.subarray(u);if("gzip"===o.encoding||"gz"===o.encoding){var h=new n.Zlib.Gunzip(new Uint8Array(t));t=h.decompress()}else if("ascii"===o.encoding||"text"===o.encoding||"txt"===o.encoding||"hex"===o.encoding)t=function(e,t,r){var n,i="";t=t||0,r=r||e.length;var a=o.sizes.reduce(function(e,t){return e*t},1),s=10;"hex"===o.encoding&&(s=16);var l=new o.__array(a),c=0,u=parseInt;o.__array!==Float32Array&&o.__array!==Float64Array||(u=parseFloat);for(var h=t;h<r;h++)((n=e[h])<9||n>13)&&32!==n?i+=String.fromCharCode(n):(""!==i&&(l[c]=u(i,s),c++),i="");return""!==i&&(l[c]=u(i,s),c++),l}(t);else if("raw"===o.encoding){for(var d=new Uint8Array(t.length),f=0;f<t.length;f++)d[f]=t[f];t=d}t=t.buffer;var p=new THREE.Volume;p.header=o,p.data=new o.__array(t);var m=p.computeMinMax(),v=m[0],g=m[1];p.windowLow=v,p.windowHigh=g,p.dimensions=[o.sizes[0],o.sizes[1],o.sizes[2]],p.xLength=p.dimensions[0],p.yLength=p.dimensions[1],p.zLength=p.dimensions[2];var y=new THREE.Vector3(o.vectors[0][0],o.vectors[0][1],o.vectors[0][2]).length(),E=new THREE.Vector3(o.vectors[1][0],o.vectors[1][1],o.vectors[1][2]).length(),x=new THREE.Vector3(o.vectors[2][0],o.vectors[2][1],o.vectors[2][2]).length();p.spacing=[y,E,x],p.matrix=new THREE.Matrix4;var T=1,b=1;if("left-posterior-superior"==o.space?(T=-1,b=-1):"left-anterior-superior"===o.space&&(T=-1),o.vectors){var w=o.vectors;p.matrix.set(T*w[0][0],T*w[1][0],T*w[2][0],0,b*w[0][1],b*w[1][1],b*w[2][1],0,1*w[0][2],1*w[1][2],1*w[2][2],0,0,0,0,1)}else p.matrix.set(T,0,0,0,0,b,0,0,0,0,1,0,0,0,0,1);return p.inverseMatrix=new THREE.Matrix4,p.inverseMatrix.getInverse(p.matrix),p.RASDimensions=new THREE.Vector3(p.xLength,p.yLength,p.zLength).applyMatrix4(p.matrix).round().toArray().map(Math.abs),p.lowerThreshold===-1/0&&(p.lowerThreshold=v),p.upperThreshold===1/0&&(p.upperThreshold=g),p},parseChars:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var n="",i=0;for(i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n},fieldFunctions:{type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){var t;return this.sizes=function(){var r,n,i,a;for(a=[],r=0,n=(i=e.split(/\s+/)).length;r<n;r++)t=i[r],a.push(parseInt(t,10));return a}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){var t,r,n;return r=e.match(/\(.*?\)/g),this.vectors=function(){var e,i,a;for(a=[],e=0,i=r.length;e<i;e++)n=r[e],a.push(function(){var e,r,i,a;for(a=[],e=0,r=(i=n.slice(1,-1).split(/,/)).length;e<r;e++)t=i[e],a.push(parseFloat(t));return a}());return a}()},spacings:function(e){var t,r;return r=e.split(/\s+/),this.spacings=function(){var e,n,i=[];for(e=0,n=r.length;e<n;e++)t=r[e],i.push(parseFloat(t));return i}()}}})},function(e,t,r){"use strict";r.r(t);var n=r(0);THREE.KMZLoader=function(e){THREE.Loader.call(this,e)},THREE.KMZLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.KMZLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){var t=new THREE.LoadingManager;t.setURLModifier(function(e){var t=function(e){for(var t in r.files)if(t.substr(-e.length)===e)return r.files[t]}(e);if(t){console.log("Loading",e);var n=new Blob([t.asArrayBuffer()],{type:"application/octet-stream"});return URL.createObjectURL(n)}return e});var r=new n(e);if(r.files["doc.kml"]){var i=(new DOMParser).parseFromString(r.files["doc.kml"].asText(),"application/xml").querySelector("Placemark Model Link href");if(i)return new THREE.ColladaLoader(t).parse(r.files[i.textContent].asText())}else for(var a in console.warn("KMZLoader: Missing doc.kml file."),r.files){if("dae"===a.split(".").pop().toLowerCase())return new THREE.ColladaLoader(t).parse(r.files[a].asText())}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new THREE.Group}}})},function(e,t){var r;THREE.MD2Loader=function(e){THREE.Loader.call(this,e)},THREE.MD2Loader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.MD2Loader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},parse:(r=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]],function(e){for(var t=new DataView(e),n={},i=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],a=0;a<i.length;a++)n[i[a]]=t.getInt32(4*a,!0);if(844121161===n.ident&&8===n.version){if(n.offset_end===t.byteLength){for(var o=new THREE.BufferGeometry,s=[],l=n.offset_st,c=(a=0,n.num_st);a<c;a++){var u=t.getInt16(l+0,!0),h=t.getInt16(l+2,!0);s.push(u/n.skinwidth,1-h/n.skinheight),l+=4}l=n.offset_tris;var d=[],f=[];for(a=0,c=n.num_tris;a<c;a++)d.push(t.getUint16(l+0,!0),t.getUint16(l+2,!0),t.getUint16(l+4,!0)),f.push(t.getUint16(l+6,!0),t.getUint16(l+8,!0),t.getUint16(l+10,!0)),l+=12;var p=new THREE.Vector3,m=new THREE.Vector3,v=[],g=[];for(l=n.offset_frames,a=0,c=n.num_frames;a<c;a++){m.set(t.getFloat32(l+0,!0),t.getFloat32(l+4,!0),t.getFloat32(l+8,!0)),p.set(t.getFloat32(l+12,!0),t.getFloat32(l+16,!0),t.getFloat32(l+20,!0)),l+=24;for(var y=0;y<16;y++){var E=t.getUint8(l+y,!0);if(0===E)break;v[y]=E}var x={name:String.fromCharCode.apply(null,v),vertices:[],normals:[]};for(l+=16,y=0;y<n.num_vertices;y++){var T=t.getUint8(l++,!0),b=t.getUint8(l++,!0),w=t.getUint8(l++,!0),_=r[t.getUint8(l++,!0)];T=T*m.x+p.x,b=b*m.y+p.y,w=w*m.z+p.z,x.vertices.push(T,w,b),x.normals.push(_[0],_[2],_[1])}g.push(x)}var R=[],M=[],S=[],A=g[0].vertices,L=g[0].normals;for(a=0,c=d.length;a<c;a++){T=A[F=3*d[a]],b=A[F+1],w=A[F+2],R.push(T,b,w);var P=L[F],C=L[F+1],H=L[F+2];M.push(P,C,H),u=s[F=2*f[a]],h=s[F+1],S.push(u,h)}o.setAttribute("position",new THREE.Float32BufferAttribute(R,3)),o.setAttribute("normal",new THREE.Float32BufferAttribute(M,3)),o.setAttribute("uv",new THREE.Float32BufferAttribute(S,2));var I=[],k=[];for(a=0,c=g.length;a<c;a++){var N=(x=g[a]).name;if(x.vertices.length>0){R=[],y=0;for(var O=d.length;y<O;y++){var F=3*d[y];T=x.vertices[F],b=x.vertices[F+1],w=x.vertices[F+2],R.push(T,b,w)}var D=new THREE.Float32BufferAttribute(R,3);D.name=N,I.push(D)}if(x.normals.length>0){for(M=[],y=0,O=d.length;y<O;y++)F=3*d[y],P=x.normals[F],C=x.normals[F+1],H=x.normals[F+2],M.push(P,C,H);var U=new THREE.Float32BufferAttribute(M,3);U.name=N,k.push(U)}}return o.morphAttributes.position=I,o.morphAttributes.normal=k,o.morphTargetsRelative=!1,o.animations=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(g,10),o}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")})})},function(e,t){var r,n,i,a,o,s,l,c,u,h,d,f,p,m,v,g,y;THREE.SVGLoader=function(e){THREE.Loader.call(this,e),this.defaultDPI=90,this.defaultUnit="px"},THREE.SVGLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.SVGLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){var t=this;function r(e,t,r,i,a,o,s,l){i=i*Math.PI/180,t=Math.abs(t),r=Math.abs(r);var c=(s.x-l.x)/2,u=(s.y-l.y)/2,h=Math.cos(i)*c+Math.sin(i)*u,d=-Math.sin(i)*c+Math.cos(i)*u,f=t*t,p=r*r,m=h*h,v=d*d,g=m/f+v/p;if(g>1){var y=Math.sqrt(g);f=(t*=y)*t,p=(r*=y)*r}var E=f*v+p*m,x=(f*p-E)/E,T=Math.sqrt(Math.max(0,x));a===o&&(T=-T);var b=T*t*d/r,w=-T*r*h/t,_=Math.cos(i)*b-Math.sin(i)*w+(s.x+l.x)/2,R=Math.sin(i)*b+Math.cos(i)*w+(s.y+l.y)/2,M=n(1,0,(h-b)/t,(d-w)/r),S=n((h-b)/t,(d-w)/r,(-h-b)/t,(-d-w)/r)%(2*Math.PI);e.currentPath.absellipse(_,R,t,r,M,M+S,0===o,i)}function n(e,t,r,n){var i=e*r+t*n,a=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n),o=Math.acos(Math.max(-1,Math.min(1,i/a)));return e*n-t*r<0&&(o=-o),o}function i(e,t){function r(r,n,i){void 0===i&&(i=function(e){return e}),e.hasAttribute(r)&&(t[n]=i(e.getAttribute(r))),e.style&&""!==e.style[r]&&(t[n]=i(e.style[r]))}function n(e){return Math.max(0,Math.min(1,c(e)))}function i(e){return Math.max(0,c(e))}return t=Object.assign({},t),r("fill","fill"),r("fill-opacity","fillOpacity",n),r("stroke","stroke"),r("stroke-opacity","strokeOpacity",n),r("stroke-width","strokeWidth",i),r("stroke-linejoin","strokeLineJoin"),r("stroke-linecap","strokeLineCap"),r("stroke-miterlimit","strokeMiterLimit",i),t}function a(e,t){return e-(t-e)}function o(e){for(var t=e.split(/[\s,]+|(?=\s?[+\-])/),r=0;r<t.length;r++){var n=t[r];if(n.indexOf(".")!==n.lastIndexOf("."))for(var i=n.split("."),a=2;a<i.length;a++)t.splice(r+a-1,0,"0."+i[a]);t[r]=c(n)}return t}var s=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function c(e){var r="px";if("string"==typeof e||e instanceof String)for(var n=0,i=s.length;n<i;n++){var a=s[n];if(e.endsWith(a)){r=a,e=e.substring(0,e.length-a.length);break}}var o=void 0;return"px"===r&&"px"!==t.defaultUnit?o=l.in[t.defaultUnit]/t.defaultDPI:(o=l[r][t.defaultUnit])<0&&(o=l[r].in*t.defaultDPI),o*parseFloat(e)}function u(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}var d=[],f=[],p=new THREE.Matrix3,m=new THREE.Matrix3,v=new THREE.Matrix3,g=new THREE.Matrix3,y=new THREE.Vector2,E=new THREE.Vector3,x=new THREE.Matrix3,T=(new DOMParser).parseFromString(e,"image/svg+xml");return function e(t,n){if(1===t.nodeType){var s=function(e){if(!e.hasAttribute("transform"))return null;var t=function(e){for(var t=new THREE.Matrix3,r=p,n=e.getAttribute("transform").split(")"),i=n.length-1;i>=0;i--){var a=n[i].trim();if(""!==a){var s=a.indexOf("("),l=a.length;if(s>0&&s<l){var c=a.substr(0,s),u=o(a.substr(s+1,l-s-1));switch(r.identity(),c){case"translate":if(u.length>=1){var h=u[0],d=h;u.length>=2&&(d=u[1]),r.translate(h,d)}break;case"rotate":if(u.length>=1){var f=0,y=0,E=0;f=-u[0]*Math.PI/180,u.length>=3&&(y=u[1],E=u[2]),m.identity().translate(-y,-E),v.identity().rotate(f),g.multiplyMatrices(v,m),m.identity().translate(y,E),r.multiplyMatrices(m,g)}break;case"scale":if(u.length>=1){var x=u[0],T=x;u.length>=2&&(T=u[1]),r.scale(x,T)}break;case"skewX":1===u.length&&r.set(1,Math.tan(u[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===u.length&&r.set(1,0,0,Math.tan(u[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===u.length&&r.set(u[0],u[2],u[4],u[1],u[3],u[5],0,0,1)}}t.premultiply(r)}}return t}(e);return f.length>0&&t.premultiply(f[f.length-1]),x.copy(t),f.push(t),t}(t),l=null;switch(t.nodeName){case"svg":break;case"g":n=i(t,n);break;case"path":n=i(t,n),t.hasAttribute("d")&&(l=function(e){for(var t=new THREE.ShapePath,n=new THREE.Vector2,i=new THREE.Vector2,s=new THREE.Vector2,l=!0,c=!1,u=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),h=0,d=u.length;h<d;h++){var f=u[h],p=f.charAt(0),m=f.substr(1).trim();switch(!0===l&&(c=!0,l=!1),p){case"M":for(var v=o(m),g=0,y=v.length;g<y;g+=2)n.x=v[g+0],n.y=v[g+1],i.x=n.x,i.y=n.y,0===g?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===g&&!0===c&&s.copy(n);break;case"H":for(var v=o(m),g=0,y=v.length;g<y;g++)n.x=v[g],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===g&&!0===c&&s.copy(n);break;case"V":for(var v=o(m),g=0,y=v.length;g<y;g++)n.y=v[g],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===g&&!0===c&&s.copy(n);break;case"L":for(var v=o(m),g=0,y=v.length;g<y;g+=2)n.x=v[g+0],n.y=v[g+1],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===g&&!0===c&&s.copy(n);break;case"C":for(var v=o(m),g=0,y=v.length;g<y;g+=6)t.bezierCurveTo(v[g+0],v[g+1],v[g+2],v[g+3],v[g+4],v[g+5]),i.x=v[g+2],i.y=v[g+3],n.x=v[g+4],n.y=v[g+5],0===g&&!0===c&&s.copy(n);break;case"S":for(var v=o(m),g=0,y=v.length;g<y;g+=4)t.bezierCurveTo(a(n.x,i.x),a(n.y,i.y),v[g+0],v[g+1],v[g+2],v[g+3]),i.x=v[g+0],i.y=v[g+1],n.x=v[g+2],n.y=v[g+3],0===g&&!0===c&&s.copy(n);break;case"Q":for(var v=o(m),g=0,y=v.length;g<y;g+=4)t.quadraticCurveTo(v[g+0],v[g+1],v[g+2],v[g+3]),i.x=v[g+0],i.y=v[g+1],n.x=v[g+2],n.y=v[g+3],0===g&&!0===c&&s.copy(n);break;case"T":for(var v=o(m),g=0,y=v.length;g<y;g+=2){var E=a(n.x,i.x),x=a(n.y,i.y);t.quadraticCurveTo(E,x,v[g+0],v[g+1]),i.x=E,i.y=x,n.x=v[g+0],n.y=v[g+1],0===g&&!0===c&&s.copy(n)}break;case"A":for(var v=o(m),g=0,y=v.length;g<y;g+=7){var T=n.clone();n.x=v[g+5],n.y=v[g+6],i.x=n.x,i.y=n.y,r(t,v[g],v[g+1],v[g+2],v[g+3],v[g+4],T,n),0===g&&!0===c&&s.copy(n)}break;case"m":for(var v=o(m),g=0,y=v.length;g<y;g+=2)n.x+=v[g+0],n.y+=v[g+1],i.x=n.x,i.y=n.y,0===g?t.moveTo(n.x,n.y):t.lineTo(n.x,n.y),0===g&&!0===c&&s.copy(n);break;case"h":for(var v=o(m),g=0,y=v.length;g<y;g++)n.x+=v[g],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===g&&!0===c&&s.copy(n);break;case"v":for(var v=o(m),g=0,y=v.length;g<y;g++)n.y+=v[g],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===g&&!0===c&&s.copy(n);break;case"l":for(var v=o(m),g=0,y=v.length;g<y;g+=2)n.x+=v[g+0],n.y+=v[g+1],i.x=n.x,i.y=n.y,t.lineTo(n.x,n.y),0===g&&!0===c&&s.copy(n);break;case"c":for(var v=o(m),g=0,y=v.length;g<y;g+=6)t.bezierCurveTo(n.x+v[g+0],n.y+v[g+1],n.x+v[g+2],n.y+v[g+3],n.x+v[g+4],n.y+v[g+5]),i.x=n.x+v[g+2],i.y=n.y+v[g+3],n.x+=v[g+4],n.y+=v[g+5],0===g&&!0===c&&s.copy(n);break;case"s":for(var v=o(m),g=0,y=v.length;g<y;g+=4)t.bezierCurveTo(a(n.x,i.x),a(n.y,i.y),n.x+v[g+0],n.y+v[g+1],n.x+v[g+2],n.y+v[g+3]),i.x=n.x+v[g+0],i.y=n.y+v[g+1],n.x+=v[g+2],n.y+=v[g+3],0===g&&!0===c&&s.copy(n);break;case"q":for(var v=o(m),g=0,y=v.length;g<y;g+=4)t.quadraticCurveTo(n.x+v[g+0],n.y+v[g+1],n.x+v[g+2],n.y+v[g+3]),i.x=n.x+v[g+0],i.y=n.y+v[g+1],n.x+=v[g+2],n.y+=v[g+3],0===g&&!0===c&&s.copy(n);break;case"t":for(var v=o(m),g=0,y=v.length;g<y;g+=2){var E=a(n.x,i.x),x=a(n.y,i.y);t.quadraticCurveTo(E,x,n.x+v[g+0],n.y+v[g+1]),i.x=E,i.y=x,n.x=n.x+v[g+0],n.y=n.y+v[g+1],0===g&&!0===c&&s.copy(n)}break;case"a":for(var v=o(m),g=0,y=v.length;g<y;g+=7){var T=n.clone();n.x+=v[g+5],n.y+=v[g+6],i.x=n.x,i.y=n.y,r(t,v[g],v[g+1],v[g+2],v[g+3],v[g+4],T,n),0===g&&!0===c&&s.copy(n)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(n.copy(s),t.currentPath.currentPoint.copy(n),l=!0);break;default:console.warn(f)}c=!1}return t}(t));break;case"rect":n=i(t,n),l=function(e){var t=c(e.getAttribute("x")||0),r=c(e.getAttribute("y")||0),n=c(e.getAttribute("rx")||0),i=c(e.getAttribute("ry")||0),a=c(e.getAttribute("width")),o=c(e.getAttribute("height")),s=new THREE.ShapePath;return s.moveTo(t+2*n,r),s.lineTo(t+a-2*n,r),(0!==n||0!==i)&&s.bezierCurveTo(t+a,r,t+a,r,t+a,r+2*i),s.lineTo(t+a,r+o-2*i),(0!==n||0!==i)&&s.bezierCurveTo(t+a,r+o,t+a,r+o,t+a-2*n,r+o),s.lineTo(t+2*n,r+o),(0!==n||0!==i)&&s.bezierCurveTo(t,r+o,t,r+o,t,r+o-2*i),s.lineTo(t,r+2*i),(0!==n||0!==i)&&s.bezierCurveTo(t,r,t,r,t+2*n,r),s}(t);break;case"polygon":n=i(t,n),l=function(e){var t=new THREE.ShapePath,r=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(e,n,i){var a=c(n),o=c(i);0===r?t.moveTo(a,o):t.lineTo(a,o),r++}),t.currentPath.autoClose=!0,t}(t);break;case"polyline":n=i(t,n),l=function(e){var t=new THREE.ShapePath,r=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(e,n,i){var a=c(n),o=c(i);0===r?t.moveTo(a,o):t.lineTo(a,o),r++}),t.currentPath.autoClose=!1,t}(t);break;case"circle":n=i(t,n),l=function(e){var t=c(e.getAttribute("cx")),r=c(e.getAttribute("cy")),n=c(e.getAttribute("r")),i=new THREE.Path;i.absarc(t,r,n,0,2*Math.PI);var a=new THREE.ShapePath;return a.subPaths.push(i),a}(t);break;case"ellipse":n=i(t,n),l=function(e){var t=c(e.getAttribute("cx")),r=c(e.getAttribute("cy")),n=c(e.getAttribute("rx")),i=c(e.getAttribute("ry")),a=new THREE.Path;a.absellipse(t,r,n,i,0,2*Math.PI);var o=new THREE.ShapePath;return o.subPaths.push(a),o}(t);break;case"line":n=i(t,n),l=function(e){var t=c(e.getAttribute("x1")),r=c(e.getAttribute("y1")),n=c(e.getAttribute("x2")),i=c(e.getAttribute("y2")),a=new THREE.ShapePath;return a.moveTo(t,r),a.lineTo(n,i),a.currentPath.autoClose=!1,a}(t);break;default:console.log(t)}l&&(void 0!==n.fill&&"none"!==n.fill&&l.color.setStyle(n.fill),function(e,t){function r(e){E.set(e.x,e.y,1).applyMatrix3(t),e.set(E.x,E.y)}for(var n=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),i=e.subPaths,a=0,o=i.length;a<o;a++)for(var s=i[a],l=s.curves,c=0;c<l.length;c++){var d=l[c];d.isLineCurve?(r(d.v1),r(d.v2)):d.isCubicBezierCurve?(r(d.v0),r(d.v1),r(d.v2),r(d.v3)):d.isQuadraticBezierCurve?(r(d.v0),r(d.v1),r(d.v2)):d.isEllipseCurve&&(n&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),y.set(d.aX,d.aY),r(y),d.aX=y.x,d.aY=y.y,d.xRadius*=u(t),d.yRadius*=h(t))}}(l,x),d.push(l),l.userData={node:t,style:n});for(var T=t.childNodes,b=0;b<T.length;b++)e(T[b],n);s&&(f.pop(),f.length>0?x.copy(f[f.length-1]):x.identity())}}(T.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:d,xml:T.documentElement}}}),THREE.SVGLoader.getStrokeStyle=function(e,t,r,n,i){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:i=void 0!==i?i:4}},THREE.SVGLoader.pointsToStroke=function(e,t,r,n){var i=[],a=[],o=[];if(0===THREE.SVGLoader.pointsToStrokeWithBuffers(e,t,r,n,i,a,o))return null;var s=new THREE.BufferGeometry;return s.setAttribute("position",new THREE.Float32BufferAttribute(i,3)),s.setAttribute("normal",new THREE.Float32BufferAttribute(a,3)),s.setAttribute("uv",new THREE.Float32BufferAttribute(o,2)),s},THREE.SVGLoader.pointsToStrokeWithBuffers=(r=new THREE.Vector2,n=new THREE.Vector2,i=new THREE.Vector2,a=new THREE.Vector2,o=new THREE.Vector2,s=new THREE.Vector2,l=new THREE.Vector2,c=new THREE.Vector2,u=new THREE.Vector2,h=new THREE.Vector2,d=new THREE.Vector2,f=new THREE.Vector2,p=new THREE.Vector2,m=new THREE.Vector2,v=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector2,function(e,t,E,x,T,b,w,_){E=void 0!==E?E:12,x=void 0!==x?x:.001,_=void 0!==_?_:0;var R=(e=function(e){for(var t=!1,r=1,n=e.length-1;r<n;r++)if(e[r].distanceTo(e[r+1])<x){t=!0;break}if(!t)return e;var i=[];i.push(e[0]);for(var r=1,n=e.length-1;r<n;r++)e[r].distanceTo(e[r+1])>=x&&i.push(e[r]);return i.push(e[e.length-1]),i}(e)).length;if(R<2)return 0;var M,S,A,L,P,C=e[0].equals(e[R-1]),H=e[0],I=t.strokeWidth/2,k=1/(R-1),N=0,O=!1,F=0,D=3*_,U=2*_;K(e[0],e[1],r).multiplyScalar(I),c.copy(e[0]).sub(r),u.copy(e[0]).add(r),h.copy(c),d.copy(u);for(var z=1;z<R;z++){M=e[z],S=z===R-1?C?e[1]:void 0:e[z+1];var B=r;K(H,M,B),i.copy(B).multiplyScalar(I),f.copy(M).sub(i),p.copy(M).add(i);var G=N+k;if(A=!1,void 0!==S){K(M,S,n),i.copy(n).multiplyScalar(I),m.copy(M).sub(i),v.copy(M).add(i),L=!0,i.subVectors(S,H),B.dot(i)<0&&(L=!1),1===z&&(O=L),i.subVectors(S,M),i.normalize();var V=Math.abs(B.dot(i));if(0!==V){var j=I/V;i.multiplyScalar(-j),a.subVectors(M,H),o.copy(a).setLength(j).add(i),g.copy(o).negate();var W=o.length(),X=a.length();a.divideScalar(X),s.subVectors(S,M);var Y=s.length();switch(s.divideScalar(Y),a.dot(g)<X&&s.dot(g)<Y&&(A=!0),y.copy(o).add(M),g.add(M),P=!1,A?L?(v.copy(g),p.copy(g)):(m.copy(g),f.copy(g)):ee(),t.strokeLineJoin){case"bevel":te(L,A,G);break;case"round":re(L,A),L?$(M,f,m,G,0):$(M,v,p,G,1);break;case"miter":case"miter-clip":default:var q=I*t.strokeMiterLimit/W;if(q<1){if("miter-clip"!==t.strokeLineJoin){te(L,A,G);break}re(L,A),L?(s.subVectors(y,f).multiplyScalar(q).add(f),l.subVectors(y,m).multiplyScalar(q).add(m),J(f,G,0),J(s,G,0),J(M,G,.5),J(M,G,.5),J(s,G,0),J(l,G,0),J(M,G,.5),J(l,G,0),J(m,G,0)):(s.subVectors(y,p).multiplyScalar(q).add(p),l.subVectors(y,v).multiplyScalar(q).add(v),J(p,G,1),J(s,G,1),J(M,G,.5),J(M,G,.5),J(s,G,1),J(l,G,1),J(M,G,.5),J(l,G,1),J(v,G,1))}else A?(L?(J(u,N,1),J(c,N,0),J(y,G,0),J(u,N,1),J(y,G,0),J(g,G,1)):(J(u,N,1),J(c,N,0),J(y,G,1),J(c,N,0),J(g,G,0),J(y,G,1)),L?m.copy(y):v.copy(y)):L?(J(f,G,0),J(y,G,0),J(M,G,.5),J(M,G,.5),J(y,G,0),J(m,G,0)):(J(p,G,1),J(y,G,1),J(M,G,.5),J(M,G,.5),J(y,G,1),J(v,G,1)),P=!0}}else ee()}else ee();C||z!==R-1||ne(e[0],h,d,L,!0,N),N=G,H=M,c.copy(m),u.copy(v)}if(C){if(A&&T){var Z=y,Q=g;O!==L&&(Z=g,Q=y),L?(P||O)&&(Q.toArray(T,0),Q.toArray(T,9),P&&Z.toArray(T,3)):!P&&O||(Q.toArray(T,3),Q.toArray(T,9),P&&Z.toArray(T,0))}}else ne(M,f,p,L,!1,G);return F;function K(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function J(e,t,r){T&&(T[D]=e.x,T[D+1]=e.y,T[D+2]=0,b&&(b[D]=0,b[D+1]=0,b[D+2]=1),D+=3,w&&(w[U]=t,w[U+1]=r,U+=2)),F+=3}function $(e,t,o,s,l){r.copy(t).sub(e).normalize(),n.copy(o).sub(e).normalize();var c=Math.PI,u=r.dot(n);Math.abs(u)<1&&(c=Math.abs(Math.acos(u))),c/=E,i.copy(t);for(var h=0,d=E-1;h<d;h++)a.copy(i).rotateAround(e,c),J(i,s,l),J(a,s,l),J(e,s,.5),i.copy(a);J(a,s,l),J(o,s,l),J(e,s,.5)}function ee(){J(u,N,1),J(c,N,0),J(f,G,0),J(u,N,1),J(f,G,1),J(p,G,0)}function te(e,t,r){t?e?(J(u,N,1),J(c,N,0),J(f,G,0),J(u,N,1),J(f,G,0),J(g,G,1),J(f,r,0),J(m,r,0),J(g,r,.5)):(J(u,N,1),J(c,N,0),J(p,G,1),J(c,N,0),J(g,G,0),J(p,G,1),J(p,r,1),J(v,r,0),J(g,r,.5)):e?(J(f,r,0),J(m,r,0),J(M,r,.5)):(J(p,r,1),J(v,r,0),J(M,r,.5))}function re(e,t){t&&(e?(J(u,N,1),J(c,N,0),J(f,G,0),J(u,N,1),J(f,G,0),J(g,G,1),J(f,N,0),J(M,G,.5),J(g,G,1),J(M,G,.5),J(m,N,0),J(g,G,1)):(J(u,N,1),J(c,N,0),J(p,G,1),J(c,N,0),J(g,G,0),J(p,G,1),J(p,N,1),J(g,G,0),J(M,G,.5),J(M,G,.5),J(g,G,0),J(v,N,1)))}function ne(e,o,s,l,c,u){switch(t.strokeLineCap){case"round":c?$(e,s,o,u,.5):$(e,o,s,u,.5);break;case"square":if(c)r.subVectors(o,e),n.set(r.y,-r.x),i.addVectors(r,n).add(e),a.subVectors(n,r).add(e),l?(i.toArray(T,3),a.toArray(T,0),a.toArray(T,9)):(i.toArray(T,3),i.toArray(T,9),a.toArray(T,0));else{r.subVectors(s,e),n.set(r.y,-r.x),i.addVectors(r,n).add(e),a.subVectors(n,r).add(e);var h=T.length;l?(i.toArray(T,h-3),a.toArray(T,h-6),a.toArray(T,h-12)):(i.toArray(T,h-6),a.toArray(T,h-3),a.toArray(T,h-12))}}}})},function(e,t){THREE.TDSLoader=function(e){THREE.Loader.call(this,e),this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]},THREE.TDSLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.TDSLoader,load:function(e,t,r,n){var i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(i.parse(e,a))},r,n)},parse:function(e,t){this.group=new THREE.Group,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(var r=0;r<this.meshes.length;r++)this.group.add(this.meshes[r]);return this.group},readFile:function(e,t){var o=new DataView(e),s=this.readChunk(o);if(s.id===n||s.id===i||s.id===r)for(var l=this.nextChunk(o,s);0!==l;){if(l===a){var c=this.readDWord(o);this.debugMessage("3DS file version: "+c)}else l===u?(this.resetPosition(o),this.readMeshData(o,t)):this.debugMessage("Unknown main chunk: "+l.toString(16));l=this.nextChunk(o,s)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(e,t){for(var r=this.readChunk(e),n=this.nextChunk(e,r);0!==n;){if(n===h){var i=+this.readDWord(e);this.debugMessage("Mesh Version: "+i)}else if(n===d){var a=this.readFloat(e);this.debugMessage("Master scale: "+a),this.group.scale.set(a,a,a)}else n===I?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):n===f?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+n.toString(16));n=this.nextChunk(e,r)}},readNamedObject:function(e){var t=this.readChunk(e),r=this.readString(e,64);t.cur=this.position;for(var n=this.nextChunk(e,t);0!==n;){if(n===k){this.resetPosition(e);var i=this.readMesh(e);i.name=r,this.meshes.push(i)}else this.debugMessage("Unknown named object chunk: "+n.toString(16));n=this.nextChunk(e,t)}this.endChunk(t)},readMaterialEntry:function(e,t){for(var r=this.readChunk(e),n=this.nextChunk(e,r),i=new THREE.MeshPhongMaterial;0!==n;){if(n===p)i.name=this.readString(e,64),this.debugMessage("   Name: "+i.name);else if(n===b)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(n===w){var a=this.readByte(e);i.wireframeLinewidth=a,this.debugMessage("   Wireframe Thickness: "+a)}else if(n===x)i.side=THREE.DoubleSide,this.debugMessage("   DoubleSided");else if(n===T)this.debugMessage("   Additive Blending"),i.blending=THREE.AdditiveBlending;else if(n===v)this.debugMessage("   Diffuse Color"),i.color=this.readColor(e);else if(n===g)this.debugMessage("   Specular Color"),i.specular=this.readColor(e);else if(n===m)this.debugMessage("   Ambient color"),i.color=this.readColor(e);else if(n===y){var o=this.readWord(e);i.shininess=o,this.debugMessage("   Shininess : "+o)}else if(n===E){var s=this.readWord(e);i.opacity=.01*s,this.debugMessage("  Opacity : "+s),i.transparent=s<100}else n===_?(this.debugMessage("   ColorMap"),this.resetPosition(e),i.map=this.readMap(e,t)):n===M?(this.debugMessage("   BumpMap"),this.resetPosition(e),i.bumpMap=this.readMap(e,t)):n===R?(this.debugMessage("   OpacityMap"),this.resetPosition(e),i.alphaMap=this.readMap(e,t)):n===S?(this.debugMessage("   SpecularMap"),this.resetPosition(e),i.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+n.toString(16));n=this.nextChunk(e,r)}this.endChunk(r),this.materials[i.name]=i},readMesh:function(e){var t=this.readChunk(e),r=this.nextChunk(e,t),n=new THREE.BufferGeometry,i=[],a=new THREE.MeshPhongMaterial,o=new THREE.Mesh(n,a);for(o.name="mesh";0!==r;){if(r===N){var s=this.readWord(e);this.debugMessage("   Vertex: "+s);for(var l=[],c=0;c<s;c++)l.push(this.readFloat(e)),l.push(this.readFloat(e)),l.push(this.readFloat(e));n.setAttribute("position",new THREE.Float32BufferAttribute(l,3))}else if(r===O)this.resetPosition(e),this.readFaceArray(e,o);else if(r===D){var u=this.readWord(e);this.debugMessage("   UV: "+u);for(i=[],c=0;c<u;c++)i.push(this.readFloat(e)),i.push(this.readFloat(e));n.setAttribute("uv",new THREE.Float32BufferAttribute(i,2))}else if(r===U){this.debugMessage("   Tranformation Matrix (TODO)");var h=[];for(c=0;c<12;c++)h[c]=this.readFloat(e);var d=new THREE.Matrix4;d.elements[0]=h[0],d.elements[1]=h[6],d.elements[2]=h[3],d.elements[3]=h[9],d.elements[4]=h[2],d.elements[5]=h[8],d.elements[6]=h[5],d.elements[7]=h[11],d.elements[8]=h[1],d.elements[9]=h[7],d.elements[10]=h[4],d.elements[11]=h[10],d.elements[12]=0,d.elements[13]=0,d.elements[14]=0,d.elements[15]=1,d.transpose();var f=new THREE.Matrix4;f.getInverse(d,!0),n.applyMatrix4(f),d.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+r.toString(16));r=this.nextChunk(e,t)}return this.endChunk(t),n.computeVertexNormals(),o},readFaceArray:function(e,t){var r=this.readChunk(e),n=this.readWord(e);this.debugMessage("   Faces: "+n);for(var i=[],a=0;a<n;++a)i.push(this.readWord(e),this.readWord(e),this.readWord(e)),this.readWord(e);for(t.geometry.setIndex(i);this.position<r.end;){if((r=this.readChunk(e)).id===F){this.debugMessage("      Material Group"),this.resetPosition(e);var o=this.readMaterialGroup(e),s=this.materials[o.name];void 0!==s&&(t.material=s,""===s.name&&(s.name=t.name))}else this.debugMessage("      Unknown face array chunk: "+r.toString(16));this.endChunk(r)}this.endChunk(r)},readMap:function(e,t){var r=this.readChunk(e),n=this.nextChunk(e,r),i={},a=new THREE.TextureLoader(this.manager);for(a.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);0!==n;){if(n===A){var o=this.readString(e,128);i=a.load(o),this.debugMessage("      File: "+t+o)}else n===C?(i.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+i.offset.x)):n===H?(i.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+i.offset.y)):n===L?(i.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+i.repeat.x)):n===P?(i.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+n.toString(16));n=this.nextChunk(e,r)}return this.endChunk(r),i},readMaterialGroup:function(e){this.readChunk(e);var t=this.readString(e,64),r=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+r);for(var n=[],i=0;i<r;++i)n.push(this.readWord(e));return{name:t,index:n}},readColor:function(e){var t=this.readChunk(e),r=new THREE.Color;if(t.id===s||t.id===l){var n=this.readByte(e),i=this.readByte(e),a=this.readByte(e);r.setRGB(n/255,i/255,a/255),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else if(t.id===o||t.id===c){n=this.readFloat(e),i=this.readFloat(e),a=this.readFloat(e);r.setRGB(n,i,a),this.debugMessage("      Color: "+r.r+", "+r.g+", "+r.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),r},readChunk:function(e){var t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t},endChunk:function(e){this.position=e.end},nextChunk:function(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{var r=this.readChunk(e);return t.cur+=r.size,r.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(e){var t=e.getUint8(this.position,!0);return this.position+=1,t},readFloat:function(e){try{var t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}},readInt:function(e){var t=e.getInt32(this.position,!0);return this.position+=4,t},readShort:function(e){var t=e.getInt16(this.position,!0);return this.position+=2,t},readDWord:function(e){var t=e.getUint32(this.position,!0);return this.position+=4,t},readWord:function(e){var t=e.getUint16(this.position,!0);return this.position+=2,t},readString:function(e,t){for(var r="",n=0;n<t;n++){var i=this.readByte(e);if(!i)break;r+=String.fromCharCode(i)}return r},debugMessage:function(e){this.debug&&console.log(e)}});var r=19789,n=15786,i=49725,a=2,o=16,s=17,l=18,c=19,u=15677,h=15678,d=256,f=45055,p=40960,m=40976,v=40992,g=41008,y=41024,E=41040,x=41089,T=41091,b=41093,w=41095,_=41472,R=41488,M=41520,S=41476,A=41728,L=41812,P=41814,C=41816,H=41818,I=16384,k=16640,N=16656,O=16672,F=16688,D=16704,U=16736},function(e,t,r){"use strict";r.r(t);var n=r(2);THREE.VTKLoader=function(e){THREE.Loader.call(this,e)},THREE.VTKLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.VTKLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},parse:function(e){function t(e,t){var r=e.length,n=new Int32Array(r+t.length);return n.set(e),n.set(t,r),n}function r(e){for(var t="",r=new Uint8Array(e),n=0,i=r.length;i--;)t+=String.fromCharCode(r[n++]);return t}var i=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,250)).split("\n");return-1!==i[0].indexOf("xml")?function(e){function r(e){var t,r,n,i,a,o,s="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],c=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=u.length;for(t=0;t<h;t++)l[t]=u[t];for(t=0;t<h;++t)c[u.charCodeAt(t)]=t;if(c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63,(h=e.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o=new s(3*h/4-(a="="===e[h-2]?2:"="===e[h-1]?1:0)),n=a>0?h-4:h;var d=0;for(t=0,r=0;t<n;t+=4,r+=3)i=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],o[d++]=(16711680&i)>>16,o[d++]=(65280&i)>>8,o[d++]=255&i;return 2===a?(i=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,o[d++]=255&i):1===a&&(i=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,o[d++]=i>>8&255,o[d++]=255&i),o}function i(e,i){var a,s,l,c,u=0;if("UInt64"===o.attributes.header_type?u=8:"UInt32"===o.attributes.header_type&&(u=4),"binary"===e.attributes.format&&i){var h,d,f,p,m,v;if("Float32"===e.attributes.type)var g=new Float32Array;else"Int64"===e.attributes.type&&(g=new Int32Array);d=(h=r(e["#text"]))[0];for(var y=1;y<u-1;y++)d|=h[y]<<y*u;for(p=(d+3)*u,v=p+=p%3>0?3-p%3:0,(m=[]).push(v),f=3*u,y=0;y<d;y++){for(var E=h[y*u+f],x=1;x<u-1;x++)E|=h[y*u+f+x]<<8*x;v+=E,m.push(v)}for(y=0;y<m.length-1;y++)T=(T=new n.Zlib.Inflate(h.slice(m[y],m[y+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===e.attributes.type?(T=new Float32Array(T),s=T,l=void 0,c=void 0,l=(a=g).length,(c=new Float32Array(l+s.length)).set(a),c.set(s,l),g=c):"Int64"===e.attributes.type&&(g=t(g,T=new Int32Array(T)));delete e["#text"],"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(g=g.filter(function(e,t){if(t%2!=1)return!0}))}else{if("binary"!==e.attributes.format||i)if(e["#text"])var T=e["#text"].split(/\s+/).filter(function(e){if(""!==e)return e});else T=new Int32Array(0).buffer;else T=(T=r(e["#text"])).slice(u).buffer;delete e["#text"],"Float32"===e.attributes.type?g=new Float32Array(T):"Int32"===e.attributes.type?g=new Int32Array(T):"Int64"===e.attributes.type&&(g=new Int32Array(T),"binary"===e.attributes.format&&(g=g.filter(function(e,t){if(t%2!=1)return!0})))}return g}var a=null;if(window.DOMParser)try{a=(new DOMParser).parseFromString(e,"text/xml")}catch(e){a=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((a=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!a.loadXML())throw new Error(a.parseError.reason+a.parseError.srcText)}catch(e){a=null}}var o=function e(t){var r={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){r.attributes={};for(var n=0;n<t.attributes.length;n++){var i=t.attributes.item(n);r.attributes[i.nodeName]=i.nodeValue.trim()}}}else 3===t.nodeType&&(r=t.nodeValue.trim());if(t.hasChildNodes())for(var a=0;a<t.childNodes.length;a++){var o=t.childNodes.item(a),s=o.nodeName;if(void 0===r[s])""!==(c=e(o))&&(r[s]=c);else{if(void 0===r[s].push){var l=r[s];r[s]=[l]}var c;""!==(c=e(o))&&r[s].push(c)}}return r}(a.documentElement),s=[],l=[],c=[];if(o.PolyData){for(var u=o.PolyData.Piece,h=o.attributes.hasOwnProperty("compressor"),d=["PointData","Points","Strips","Polys"],f=0,p=d.length;f<p;){var m=u[d[f]];if(m&&m.DataArray){if("[object Array]"===Object.prototype.toString.call(m.DataArray))var v=m.DataArray;else v=[m.DataArray];for(var g=0,y=v.length;g<y;)"#text"in v[g]&&v[g]["#text"].length>0&&(v[g].text=i(v[g],h)),g++;switch(d[f]){case"PointData":var E=parseInt(u.attributes.NumberOfPoints),x=m.attributes.Normals;if(E>0)for(var T=0,b=v.length;T<b;T++)if(x===v[T].attributes.Name){var w=v[T].attributes.NumberOfComponents;(l=new Float32Array(E*w)).set(v[T].text,0)}break;case"Points":(E=parseInt(u.attributes.NumberOfPoints))>0&&(w=m.DataArray.attributes.NumberOfComponents,(s=new Float32Array(E*w)).set(m.DataArray.text,0));break;case"Strips":var _=parseInt(u.attributes.NumberOfStrips);if(_>0){var R=new Int32Array(m.DataArray[0].text.length),M=new Int32Array(m.DataArray[1].text.length);R.set(m.DataArray[0].text,0),M.set(m.DataArray[1].text,0);var S=_+R.length;c=new Uint32Array(3*S-9*_);var A=0;for(T=0,b=_;T<b;T++){for(var L=[],P=0,C=M[T],H=0;P<C-H;P++)L.push(R[P]),T>0&&(H=M[T-1]);var I=0;for(C=M[T],H=0;I<C-H-2;I++)I%2?(c[A++]=L[I],c[A++]=L[I+2],c[A++]=L[I+1]):(c[A++]=L[I],c[A++]=L[I+1],c[A++]=L[I+2]),T>0&&(H=M[T-1])}}break;case"Polys":var k=parseInt(u.attributes.NumberOfPolys);if(k>0){R=new Int32Array(m.DataArray[0].text.length),M=new Int32Array(m.DataArray[1].text.length),R.set(m.DataArray[0].text,0),M.set(m.DataArray[1].text,0),S=k+R.length,c=new Uint32Array(3*S-9*k),A=0;var N=0;for(T=0,b=k,H=0;T<b;){var O=[];for(P=0,C=M[T];P<C-H;)O.push(R[N++]),P++;for(I=1;I<C-H-1;)c[A++]=O[0],c[A++]=O[I],c[A++]=O[I+1],I++;H=M[++T-1]}}}}f++}var F=new THREE.BufferGeometry;return F.setIndex(new THREE.BufferAttribute(c,1)),F.setAttribute("position",new THREE.BufferAttribute(s,3)),l.length===s.length&&F.setAttribute("normal",new THREE.BufferAttribute(l,3)),F}throw new Error("Unsupported DATASET type")}(r(e)):i[2].includes("ASCII")?function(e){for(var t,r=[],n=[],i=[],a=[],o=/^[^\d.\s-]+/,s=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,c=/^POINTS /,u=/^POLYGONS /,h=/^TRIANGLE_STRIPS /,d=/^POINT_DATA[ ]+(\d+)/,f=/^CELL_DATA[ ]+(\d+)/,p=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,m=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,v=!1,g=!1,y=!1,E=!1,x=!1,T=!1,b=!1,w=e.split("\n"),_=0,R=w.length;_<R;_++){var M=w[_].trim();if(0===M.indexOf("DATASET")){var S=M.split(" ")[1];if("POLYDATA"!==S)throw new Error("Unsupported DATASET type: "+S)}else if(v)for(;null!==(t=s.exec(M))&&null===o.exec(M);){var A=parseFloat(t[1]),L=parseFloat(t[2]),P=parseFloat(t[3]);n.push(A,L,P)}else if(g){if(null!==(t=l.exec(M))){var C=parseInt(t[1]),H=t[2].split(/\s+/);if(C>=3)for(var I=parseInt(H[0]),k=1,N=0;N<C-2;++N)O=parseInt(H[k]),F=parseInt(H[k+1]),r.push(I,O,F),k++}}else if(y){if(null!==(t=l.exec(M))){var O,F;if(C=parseInt(t[1]),H=t[2].split(/\s+/),C>=3)for(N=0;N<C-2;N++)N%2==1?(I=parseInt(H[N]),O=parseInt(H[N+2]),F=parseInt(H[N+1]),r.push(I,O,F)):(I=parseInt(H[N]),O=parseInt(H[N+1]),F=parseInt(H[N+2]),r.push(I,O,F))}}else if(E||x)if(T)for(;null!==(t=s.exec(M))&&null===o.exec(M);){var D=parseFloat(t[1]),U=parseFloat(t[2]),z=parseFloat(t[3]);i.push(D,U,z)}else if(b)for(;null!==(t=s.exec(M))&&null===o.exec(M);){var B=parseFloat(t[1]),G=parseFloat(t[2]),V=parseFloat(t[3]);a.push(B,G,V)}null!==u.exec(M)?(g=!0,v=!1,y=!1):null!==c.exec(M)?(g=!1,v=!0,y=!1):null!==h.exec(M)?(g=!1,v=!1,y=!0):null!==d.exec(M)?(E=!0,v=!1,g=!1,y=!1):null!==f.exec(M)?(x=!0,v=!1,g=!1,y=!1):null!==p.exec(M)?(T=!0,b=!1,v=!1,g=!1,y=!1):null!==m.exec(M)&&(b=!0,T=!1,v=!1,g=!1,y=!1)}var j=new THREE.BufferGeometry;if(j.setIndex(r),j.setAttribute("position",new THREE.Float32BufferAttribute(n,3)),a.length===n.length&&j.setAttribute("normal",new THREE.Float32BufferAttribute(a,3)),i.length!==r.length)i.length===n.length&&j.setAttribute("color",new THREE.Float32BufferAttribute(i,3));else{var W=(j=j.toNonIndexed()).attributes.position.count/3;if(i.length===3*W){var X=[];for(_=0;_<W;_++)D=i[3*_+0],U=i[3*_+1],z=i[3*_+2],X.push(D,U,z),X.push(D,U,z),X.push(D,U,z);j.setAttribute("color",new THREE.Float32BufferAttribute(X,3))}}return j}(r(e)):function(e){var t,r,n,i,a,o,s,l=new Uint8Array(e),c=new DataView(e),u=[],h=[],d=[],f=[],p=0;function m(e,t){for(var r=t,n=e[r],i=[];10!==n;)i.push(String.fromCharCode(n)),n=e[++r];return{start:t,end:r,next:r+1,parsedString:i.join("")}}for(;;){if(0===(s=(o=m(l,p)).parsedString).indexOf("DATASET")){var v=s.split(" ")[1];if("POLYDATA"!==v)throw new Error("Unsupported DATASET type: "+v)}else if(0===s.indexOf("POINTS")){for(f.push(s),t=4*(i=parseInt(s.split(" ")[1],10))*3,u=new Float32Array(3*i),r=o.next,n=0;n<i;n++)u[3*n]=c.getFloat32(r,!1),u[3*n+1]=c.getFloat32(r+4,!1),u[3*n+2]=c.getFloat32(r+8,!1),r+=12;o.next=o.next+t+1}else if(0===s.indexOf("TRIANGLE_STRIPS")){var g=parseInt(s.split(" ")[1],10);t=4*(b=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*b-9*g);var y=0;for(r=o.next,n=0;n<g;n++){var E=c.getInt32(r,!1),x=[];for(r+=4,a=0;a<E;a++)x.push(c.getInt32(r,!1)),r+=4;for(var T=0;T<E-2;T++)T%2?(d[y++]=x[T],d[y++]=x[T+2],d[y++]=x[T+1]):(d[y++]=x[T],d[y++]=x[T+1],d[y++]=x[T+2])}o.next=o.next+t+1}else if(0===s.indexOf("POLYGONS")){var b;for(g=parseInt(s.split(" ")[1],10),t=4*(b=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*b-9*g),y=0,r=o.next,n=0;n<g;n++){for(E=c.getInt32(r,!1),x=[],r+=4,a=0;a<E;a++)x.push(c.getInt32(r,!1)),r+=4;for(T=1;T<E-1;T++)d[y++]=x[0],d[y++]=x[T],d[y++]=x[T+1]}o.next=o.next+t+1}else if(0===s.indexOf("POINT_DATA")){for(i=parseInt(s.split(" ")[1],10),o=m(l,o.next),t=4*i*3,h=new Float32Array(3*i),r=o.next,n=0;n<i;n++)h[3*n]=c.getFloat32(r,!1),h[3*n+1]=c.getFloat32(r+4,!1),h[3*n+2]=c.getFloat32(r+8,!1),r+=12;o.next=o.next+t}if((p=o.next)>=l.byteLength)break}var w=new THREE.BufferGeometry;return w.setIndex(new THREE.BufferAttribute(d,1)),w.setAttribute("position",new THREE.BufferAttribute(u,3)),h.length===u.length&&w.setAttribute("normal",new THREE.BufferAttribute(h,3)),w}(e)}})},function(module,exports){THREE.Volume=function(e,t,r,n,i){if(arguments.length>0){switch(this.xLength=Number(e)||1,this.yLength=Number(t)||1,this.zLength=Number(r)||1,n){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(i);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(i);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(i);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(i);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(i);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(i);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in THREE.Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(i);break;case"Float64":case"float64":case"double":this.data=new Float64Array(i);break;default:this.data=new Uint8Array(i)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in THREE.Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new THREE.Matrix3,this.matrix.identity();var a=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return a},set:function(e){a=e,this.sliceList.forEach(function(e){e.geometryNeedsUpdate=!0})}});var o=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return o},set:function(e){o=e,this.sliceList.forEach(function(e){e.geometryNeedsUpdate=!0})}}),this.sliceList=[]},THREE.Volume.prototype={constructor:THREE.Volume,getData:function(e,t,r){return this.data[r*this.xLength*this.yLength+t*this.xLength+e]},access:function(e,t,r){return r*this.xLength*this.yLength+t*this.xLength+e},reverseAccess:function(e){var t=Math.floor(e/(this.yLength*this.xLength)),r=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-r*this.xLength,r,t]},map:function(e,t){var r=this.data.length;t=t||this;for(var n=0;n<r;n++)this.data[n]=e.call(t,this.data[n],n,this.data);return this},extractPerpendicularPlane:function(axis,RASIndex){var iLength,jLength,sliceAccess,planeMatrix=(new THREE.Matrix4).identity(),volume=this,planeWidth,planeHeight,firstSpacing,secondSpacing,positionOffset,IJKIndex,axisInIJK=new THREE.Vector3,firstDirection=new THREE.Vector3,secondDirection=new THREE.Vector3,dimensions=new THREE.Vector3(this.xLength,this.yLength,this.zLength);switch(axis){case"x":axisInIJK.set(1,0,0),firstDirection.set(0,0,-1),secondDirection.set(0,-1,0),firstSpacing=this.spacing[2],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(RASIndex,0,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationY(Math.PI/2)),positionOffset=(volume.RASDimensions[0]-1)/2,planeMatrix.setPosition(new THREE.Vector3(RASIndex-positionOffset,0,0));break;case"y":axisInIJK.set(0,1,0),firstDirection.set(1,0,0),secondDirection.set(0,0,1),firstSpacing=this.spacing[0],secondSpacing=this.spacing[2],IJKIndex=new THREE.Vector3(0,RASIndex,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationX(-Math.PI/2)),positionOffset=(volume.RASDimensions[1]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,RASIndex-positionOffset,0));break;case"z":default:axisInIJK.set(0,0,1),firstDirection.set(1,0,0),secondDirection.set(0,-1,0),firstSpacing=this.spacing[0],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(0,0,RASIndex),positionOffset=(volume.RASDimensions[2]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,0,RASIndex-positionOffset))}firstDirection.applyMatrix4(volume.inverseMatrix).normalize(),firstDirection.argVar="i",secondDirection.applyMatrix4(volume.inverseMatrix).normalize(),secondDirection.argVar="j",axisInIJK.applyMatrix4(volume.inverseMatrix).normalize(),iLength=Math.floor(Math.abs(firstDirection.dot(dimensions))),jLength=Math.floor(Math.abs(secondDirection.dot(dimensions))),planeWidth=Math.abs(iLength*firstSpacing),planeHeight=Math.abs(jLength*secondSpacing),IJKIndex=Math.abs(Math.round(IJKIndex.applyMatrix4(volume.inverseMatrix).dot(axisInIJK)));var base=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],iDirection=[firstDirection,secondDirection,axisInIJK].find(function(e){return Math.abs(e.dot(base[0]))>.9}),jDirection=[firstDirection,secondDirection,axisInIJK].find(function(e){return Math.abs(e.dot(base[1]))>.9}),kDirection=[firstDirection,secondDirection,axisInIJK].find(function(e){return Math.abs(e.dot(base[2]))>.9}),argumentsWithInversion=["volume.xLength-1-","volume.yLength-1-","volume.zLength-1-"],argArray=[iDirection,jDirection,kDirection].map(function(e,t){return(e.dot(base[t])>0?"":argumentsWithInversion[t])+(e===axisInIJK?"IJKIndex":e.argVar)}),argString=argArray.join(",");return sliceAccess=eval("(function sliceAccess (i,j) {return volume.access( "+argString+");})"),{iLength:iLength,jLength:jLength,sliceAccess:sliceAccess,matrix:planeMatrix,planeWidth:planeWidth,planeHeight:planeHeight}},extractSlice:function(e,t){var r=new THREE.VolumeSlice(this,t,e);return this.sliceList.push(r),r},repaintAllSlices:function(){return this.sliceList.forEach(function(e){e.repaint()}),this},computeMinMax:function(){var e=1/0,t=-1/0,r=this.data.length,n=0;for(n=0;n<r;n++)if(!isNaN(this.data[n])){var i=this.data[n];e=Math.min(e,i),t=Math.max(t,i)}return this.min=e,this.max=t,[e,t]}}},function(e,t){THREE.VolumeSlice=function(e,t,r){var n=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,n.geometryNeedsUpdate=!0,t}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new THREE.Texture(this.canvas);i.minFilter=THREE.LinearFilter,i.wrapS=i.wrapT=THREE.ClampToEdgeWrapping;var a=new THREE.MeshBasicMaterial({map:i,side:THREE.DoubleSide,transparent:!0});this.mesh=new THREE.Mesh(this.geometry,a),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()},THREE.VolumeSlice.prototype={constructor:THREE.VolumeSlice,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,r=this.sliceAccess,n=this.volume,i=this.canvasBuffer,a=this.ctxBuffer,o=a.getImageData(0,0,e,t),s=o.data,l=n.data,c=n.upperThreshold,u=n.lowerThreshold,h=n.windowLow,d=n.windowHigh,f=0;if("label"===n.dataType)for(var p=0;p<t;p++)for(var m=0;m<e;m++){var v=l[r(m,p)];v=v>=this.colorMap.length?v%this.colorMap.length+1:v;var g=this.colorMap[v];s[4*f]=g>>24&255,s[4*f+1]=g>>16&255,s[4*f+2]=g>>8&255,s[4*f+3]=255&g,f++}else for(p=0;p<t;p++)for(m=0;m<e;m++){var y=l[r(m,p)],E=255;E=c>=y&&u<=y?E:0,y=(y=Math.floor(255*(y-h)/(d-h)))>255?255:y<0?0:0|y,s[4*f]=y,s[4*f+1]=y,s[4*f+2]=y,s[4*f+3]=E,f++}a.putImageData(o,0,0),this.ctx.drawImage(i,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new THREE.PlaneBufferGeometry(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}}},function(e,t){THREE.UnpackDepthRGBAShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","\tgl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")}},function(e,t){var r,n,i;THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},n=e.getSize(new THREE.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock},Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,r,n=this.renderer.getRenderTarget(),i=!1,a=this.passes.length;for(r=0;r<a;r++)if(!1!==(t=this.passes[r]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var o=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(t instanceof THREE.MaskPass?i=!0:t instanceof THREE.ClearMaskPass&&(i=!1))}this.renderer.setRenderTarget(n)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}),THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),THREE.Pass.FullScreenQuad=(r=new THREE.OrthographicCamera(-1,1,1,-1,0,1),n=new THREE.PlaneBufferGeometry(2,2),i=function(e){this._mesh=new THREE.Mesh(n,e)},Object.defineProperty(i.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(i.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,r)}}),i)},function(e,t){THREE.RenderPass=function(e,t,r,n,i){THREE.Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(e,t,r){var n,i,a,o=e.autoClear;e.autoClear=!1,void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(n=e.getClearColor().getHex(),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(n,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=o}})},function(e,t){THREE.MaskPass=function(e,t){THREE.Pass.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.MaskPass,render:function(e,t,r){var n,i,a=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(n=0,i=1):(n=1,i=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,n,4294967295),o.buffers.stencil.setClear(i),o.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,4294967295),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.buffers.stencil.setLocked(!0)}}),THREE.ClearMaskPass=function(){THREE.Pass.call(this),this.needsSwap=!1},THREE.ClearMaskPass.prototype=Object.create(THREE.Pass.prototype),Object.assign(THREE.ClearMaskPass.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}})},function(e,t){THREE.OutlinePass=function(e,t,r,n){this.renderScene=t,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new THREE.Color(1,1,1),this.hiddenEdgeColor=new THREE.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,THREE.Pass.call(this),this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},a=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new THREE.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=THREE.DoubleSide,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new THREE.MeshDepthMaterial,this.depthMaterial.side=THREE.DoubleSide,this.depthMaterial.depthPacking=THREE.RGBADepthPacking,this.depthMaterial.blending=THREE.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(e,t){var r=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(a,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(a/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===THREE.CopyShader&&console.error("THREE.OutlinePass relies on THREE.CopyShader");var s=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.fsQuad=new THREE.Pass.FullScreenQuad(null),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4},THREE.OutlinePass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var r=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value.set(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value.set(r,n)},changeVisibilityOfSelectedObjects:function(e){function t(t){t.isMesh&&(e?(t.visible=t.userData.oldVisible,delete t.userData.oldVisible):(t.userData.oldVisible=t.visible,t.visible=e))}for(var r=0;r<this.selectedObjects.length;r++){this.selectedObjects[r].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function r(e){e.isMesh&&t.push(e)}for(var n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(r)}this.renderScene.traverse(function(r){if(r.isMesh||r.isLine||r.isSprite){for(var n=!1,i=0;i<t.length;i++)if(t[i].id===r.id){n=!0;break}if(!n){var a=r.visible;e&&!r.bVisible||(r.visible=e),r.bVisible=a}}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,r,n,i){if(this.selectedObjects.length>0){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,i&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))},getPrepareMaskMaterial:function(){return new THREE.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new THREE.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},visibleEdgeColor:{value:new THREE.Vector3(1,1,1)},hiddenEdgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),THREE.OutlinePass.BlurDirectionX=new THREE.Vector2(1,0),THREE.OutlinePass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.ShaderPass=function(e,t){THREE.Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new THREE.Pass.FullScreenQuad(this.material)},THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}})},function(e,t){THREE.UnrealBloomPass=function(e,t,r,n){THREE.Pass.call(this),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=n,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(a,o,i);l.texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var c=new THREE.WebGLRenderTarget(a,o,i);c.texture.name="UnrealBloomPass.v"+s,c.texture.generateMipmaps=!1,this.renderTargetsVertical.push(c),a=Math.round(a/2),o=Math.round(o/2)}void 0===THREE.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var u=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(u.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var h=[3,5,7,9,11];for(a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new THREE.Vector2(a,o),a=Math.round(a/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===THREE.CopyShader&&console.error("THREE.UnrealBloomPass relies on THREE.CopyShader");var d=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(d.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.basic=new THREE.MeshBasicMaterial,this.fsQuad=new THREE.Pass.FullScreenQuad(null)},THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),n=Math.round(t/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new THREE.Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(e,t,r,n,i){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var o=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0),THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.GlitchPass=function(e){THREE.Pass.call(this),void 0===THREE.DigitalGlitch&&console.error("THREE.GlitchPass relies on THREE.DigitalGlitch");var t=THREE.DigitalGlitch;this.uniforms=THREE.UniformsUtils.clone(t.uniforms),null==e&&(e=64),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new THREE.Pass.FullScreenQuad(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()},THREE.GlitchPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.GlitchPass,render:function(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=THREE.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=THREE.MathUtils.randFloat(-1,1),this.uniforms.seed_y.value=THREE.MathUtils.randFloat(-1,1),this.uniforms.distortion_x.value=THREE.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=THREE.MathUtils.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=THREE.MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=THREE.MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=THREE.MathUtils.randFloat(0,1),this.uniforms.seed_x.value=THREE.MathUtils.randFloat(-.3,.3),this.uniforms.seed_y.value=THREE.MathUtils.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},generateTrigger:function(){this.randX=THREE.MathUtils.randInt(120,240)},generateHeightmap:function(e){for(var t=new Float32Array(e*e*3),r=e*e,n=0;n<r;n++){var i=THREE.MathUtils.randFloat(0,1);t[3*n+0]=i,t[3*n+1]=i,t[3*n+2]=i}return new THREE.DataTexture(t,e,e,THREE.RGBFormat,THREE.FloatType)}})},function(e,t){THREE.SSAOPass=function(e,t,r,n){THREE.Pass.call(this),this.width=void 0!==r?r:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this.generateSampleKernel(),this.generateRandomKernelRotations();var i=new THREE.DepthTexture;i.type=THREE.UnsignedShortType,i.minFilter=THREE.NearestFilter,i.maxFilter=THREE.NearestFilter,this.beautyRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,depthTexture:i,depthBuffer:!0}),this.normalRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),this.ssaoRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===THREE.SSAOShader&&console.error("THREE.SSAOPass: The pass relies on THREE.SSAOShader."),this.ssaoMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOShader.uniforms),vertexShader:THREE.SSAOShader.vertexShader,fragmentShader:THREE.SSAOShader.fragmentShader,blending:THREE.NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.normalMaterial=new THREE.MeshNormalMaterial,this.normalMaterial.blending=THREE.NoBlending,this.blurMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOBlurShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOBlurShader.uniforms),vertexShader:THREE.SSAOBlurShader.vertexShader,fragmentShader:THREE.SSAOBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAODepthShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAODepthShader.uniforms),vertexShader:THREE.SSAODepthShader.vertexShader,fragmentShader:THREE.SSAODepthShader.fragmentShader,blending:THREE.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.CopyShader.uniforms),vertexShader:THREE.CopyShader.vertexShader,fragmentShader:THREE.CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:THREE.DstColorFactor,blendDst:THREE.ZeroFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.DstAlphaFactor,blendDstAlpha:THREE.ZeroFactor,blendEquationAlpha:THREE.AddEquation}),this.fsQuad=new THREE.Pass.FullScreenQuad(null),this.originalClearColor=new THREE.Color},THREE.SSAOPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.SSAOPass,dispose:function(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()},render:function(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case THREE.SSAOPass.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.CustomBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}},renderPass:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},renderOverride:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,i=t.clearAlpha||i,null!=n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},setSize:function(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.blurMaterial.uniforms.resolution.value.set(e,t)},generateSampleKernel:function(){for(var e=this.kernelSize,t=this.kernel,r=0;r<e;r++){var n=new THREE.Vector3;n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=Math.random(),n.normalize();var i=r/e;i=THREE.MathUtils.lerp(.1,1,i*i),n.multiplyScalar(i),t.push(n)}},generateRandomKernelRotations:function(){void 0===THREE.SimplexNoise&&console.error("THREE.SSAOPass: The pass relies on THREE.SimplexNoise.");for(var e=new THREE.SimplexNoise,t=new Float32Array(64),r=0;r<16;r++){var n=4*r,i=2*Math.random()-1,a=2*Math.random()-1,o=e.noise3d(i,a,0);t[n]=o,t[n+1]=o,t[n+2]=o,t[n+3]=1}this.noiseTexture=new THREE.DataTexture(t,4,4,THREE.RGBAFormat,THREE.FloatType),this.noiseTexture.wrapS=THREE.RepeatWrapping,this.noiseTexture.wrapT=THREE.RepeatWrapping}}),THREE.SSAOPass.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5}},function(e,t){THREE.BokehPass=function(e,t,r){THREE.Pass.call(this);var n=r.width||window.innerWidth||1,i=r.height||window.innerHeight||1,a=r.vignetting||0;this.scene=e,this.camera=t,this.mouse=new THREE.Vector2,this.width=n,this.height=i;var o=THREE.BokehDepthShader,s=THREE.UniformsUtils.clone(o.uniforms);this.materialDepth=new THREE.ShaderMaterial({uniforms:s,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),s.mNear.value=t.near,s.mFar.value=t.far,this.scene2=new THREE.Scene,this.camera2=new THREE.OrthographicCamera(n/-2,n/2,i/2,i/-2,-1e4,1e4),this.camera2.position.z=100,this.scene2.add(this.camera2);var l={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.rtTextureDepth=new THREE.WebGLRenderTarget(n,i,l),this.rtTextureColor=new THREE.WebGLRenderTarget(n,i,l);var c=3,u=4,h=THREE.BokehShader,d=THREE.UniformsUtils.clone(h.uniforms);d.textureWidth.value=n,d.textureHeight.value=i,d.shaderFocus.value=1,d.vignetting.value=a,this.materialBokeh=new THREE.ShaderMaterial({uniforms:d,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{RINGS:c,SAMPLES:u}}),this.materialBokeh.uniforms.tColor.value=this.rtTextureColor.texture,this.materialBokeh.uniforms.tDepth.value=this.rtTextureDepth.texture;var f=new THREE.Mesh(new THREE.PlaneBufferGeometry(n,i),this.materialBokeh);f.position.z=-500,this.scene2.add(f)},THREE.BokehPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.BokehPass,render:function(e,t,r,n,i){var a=this.scene,o=this.camera,s=this.materialBokeh.uniforms,l=this.materialDepth.uniforms,c=.5,u=.5;c=.5*this.mouse.x+.5,u=.5*this.mouse.y+.5,s.focusCoords.value.set(c,u),s.znear.value=o.near,s.zfar.value=o.far,l.mNear.value=o.near,l.mFar.value=o.far,e.setRenderTarget(this.rtTextureColor),e.clear(),e.render(a,o),a.overrideMaterial=this.materialDepth,e.setRenderTarget(this.rtTextureDepth),e.clear(),e.render(a,o),a.overrideMaterial=null,this.renderToScreen?e.render(this.scene2,this.camera2):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene2,this.camera2))}})},function(e,t){THREE.BokehShader={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:1},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new THREE.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","\t//pentagonal shape","\tfloat scale = float(rings) - 1.3;","\tvec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","\tvec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","\tvec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","\tvec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","\tvec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","\tvec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","\tvec4  one = vec4( 1.0 );","\tvec4 P = vec4((coords),vec2(scale, scale));","\tvec4 dist = vec4(0.0);","\tfloat inorout = -4.0;","\tdist.x = dot( P, HS0 );","\tdist.y = dot( P, HS1 );","\tdist.z = dot( P, HS2 );","\tdist.w = dot( P, HS3 );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dot( dist, one );","\tdist.x = dot( P, HS4 );","\tdist.y = HS5.w - abs( P.z );","\tdist = smoothstep( -feather, feather, dist );","\tinorout += dist.x;","\treturn clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","\t// Depth buffer blur","\tfloat d = 0.0;","\tfloat kernel[9];","\tvec2 offset[9];","\tvec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","\toffset[0] = vec2(-wh.x,-wh.y);","\toffset[1] = vec2( 0.0, -wh.y);","\toffset[2] = vec2( wh.x -wh.y);","\toffset[3] = vec2(-wh.x,  0.0);","\toffset[4] = vec2( 0.0,   0.0);","\toffset[5] = vec2( wh.x,  0.0);","\toffset[6] = vec2(-wh.x, wh.y);","\toffset[7] = vec2( 0.0,  wh.y);","\toffset[8] = vec2( wh.x, wh.y);","\tkernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","\tkernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","\tkernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","\tfor( int i=0; i<9; i++ ) {","\t\tfloat tmp = texture2D(tDepth, coords + offset[i]).r;","\t\td += tmp * kernel[i];","\t}","\treturn d;","}","vec3 color(vec2 coords,float blur) {","\t//processing the sample","\tvec3 col = vec3(0.0);","\tvec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","\tcol.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","\tcol.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","\tcol.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","\tvec3 lumcoeff = vec3(0.299,0.587,0.114);","\tfloat lum = dot(col.rgb, lumcoeff);","\tfloat thresh = max((lum-threshold)*gain, 0.0);","\treturn col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","\tfloat edge = 0.002*depth; //distance based edge smoothing","\tfloat m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","\tfloat e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","\tcol = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","\tcol = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","\treturn col;","}","float linearize(float depth) {","\treturn -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","\tfloat dist = distance(vUv.xy, vec2(0.5,0.5));","\tdist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","\treturn clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","\tfloat rings2 = float(rings);","\tfloat step = PI*2.0 / float(ringsamples);","\tfloat pw = cos(j*step)*i;","\tfloat ph = sin(j*step)*i;","\tfloat p = 1.0;","\tif (pentagon) {","\t\tp = penta(vec2(pw,ph));","\t}","\tcol += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","\treturn 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","\t//scene depth calculation","\tfloat depth = linearize(texture2D(tDepth,vUv.xy).x);","\t// Blur depth?","\tif ( depthblur ) {","\t\tdepth = linearize(bdepth(vUv.xy));","\t}","\t//focal plane calculation","\tfloat fDepth = focalDepth;","\tif (shaderFocus) {","\t\tfDepth = linearize(texture2D(tDepth,focusCoords).x);","\t}","\t// dof blur factor calculation","\tfloat blur = 0.0;","\tif (manualdof) {","\t\tfloat a = depth-fDepth; // Focal plane","\t\tfloat b = (a-fdofstart)/fdofdist; // Far DoF","\t\tfloat c = (-a-ndofstart)/ndofdist; // Near Dof","\t\tblur = (a>0.0) ? b : c;","\t} else {","\t\tfloat f = focalLength; // focal length in mm","\t\tfloat d = fDepth*1000.0; // focal plane in mm","\t\tfloat o = depth*1000.0; // depth in mm","\t\tfloat a = (o*f)/(o-f);","\t\tfloat b = (d*f)/(d-f);","\t\tfloat c = (d-f)/(d*fstop*CoC);","\t\tblur = abs(a-b)*c;","\t}","\tblur = clamp(blur,0.0,1.0);","\t// calculation of pattern for dithering","\tvec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","\t// getting blur x and y step factor","\tfloat w = (1.0/textureWidth)*blur*maxblur+noise.x;","\tfloat h = (1.0/textureHeight)*blur*maxblur+noise.y;","\t// calculation of final color","\tvec3 col = vec3(0.0);","\tif(blur < 0.05) {","\t\t//some optimization thingy","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t} else {","\t\tcol = texture2D(tColor, vUv.xy).rgb;","\t\tfloat s = 1.0;","\t\tint ringsamples;","\t\tfor (int i = 1; i <= rings; i++) {","\t\t\t/*unboxstart*/","\t\t\tringsamples = i * samples;","\t\t\tfor (int j = 0 ; j < maxringsamples ; j++) {","\t\t\t\tif (j >= ringsamples) break;","\t\t\t\ts += gather(float(i), float(j), ringsamples, col, w, h, blur);","\t\t\t}","\t\t\t/*unboxend*/","\t\t}","\t\tcol /= s; //divide by sample count","\t}","\tif (showFocus) {","\t\tcol = debugFocus(col, blur, depth);","\t}","\tif (vignetting) {","\t\tcol *= vignette();","\t}","\tgl_FragColor.rgb = col;","\tgl_FragColor.a = 1.0;","} "].join("\n")},THREE.BokehDepthShader={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")}},function(e,t){THREE.BleachBypassShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 base = texture2D( tDiffuse, vUv );","\tvec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","\tfloat lum = dot( lumCoeff, base.rgb );","\tvec3 blend = vec3( lum );","\tfloat L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","\tvec3 result1 = 2.0 * base.rgb * blend;","\tvec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","\tvec3 newColor = mix( result1, result2, L );","\tfloat A2 = opacity * base.a;","\tvec3 mixRGB = A2 * newColor.rgb;","\tmixRGB += ( ( 1.0 - A2 ) * base.rgb );","\tgl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")}},function(e,t){THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")}},function(e,t){THREE.DotScreenShader={uniforms:{tDiffuse:{value:null},tSize:{value:new THREE.Vector2(256,256)},center:{value:new THREE.Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","\tfloat s = sin( angle ), c = cos( angle );","\tvec2 tex = vUv * tSize - center;","\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tfloat average = ( color.r + color.g + color.b ) / 3.0;","\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")}},function(e,t){THREE.FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")}},function(e,t){THREE.GammaCorrectionShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")}},function(e,t){THREE.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new THREE.Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","\tvec2 imageCoord = vUv;","\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","\t\timageCoord += uImageIncrement;","\t}","\tgl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-e*e/(2*t*t))}var r,n,i,a,o=2*Math.ceil(3*e)+1;for(o>25&&(o=25),a=.5*(o-1),n=new Array(o),i=0,r=0;r<o;++r)n[r]=t(r-a,e),i+=n[r];for(r=0;r<o;++r)n[r]/=i;return n}}},function(e,t){THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new THREE.Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")}},function(e,t){THREE.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 color = texture2D( tDiffuse, vUv );","\tvec3 c = color.rgb;","\tcolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","\tcolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","\tcolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","\tgl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")}},function(e,t){THREE.DigitalGlitch={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","\tif(byp<1) {","\t\tvec2 p = vUv;","\t\tfloat xs = floor(gl_FragCoord.x / 0.5);","\t\tfloat ys = floor(gl_FragCoord.y / 0.5);","\t\tvec4 normal = texture2D (tDisp, p*seed*seed);","\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","\t\t\tif(seed_x>0.){","\t\t\t\tp.y = 1. - (p.y + distortion_y);","\t\t\t}","\t\t\telse {","\t\t\t\tp.y = distortion_y;","\t\t\t}","\t\t}","\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","\t\t\tif(seed_y>0.){","\t\t\t\tp.x=distortion_x;","\t\t\t}","\t\t\telse {","\t\t\t\tp.x = 1. - (p.x + distortion_x);","\t\t\t}","\t\t}","\t\tp.x+=normal.x*seed_x*(seed/5.);","\t\tp.y+=normal.y*seed_y*(seed/5.);","\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));","\t\tvec4 cr = texture2D(tDiffuse, p + offset);","\t\tvec4 cga = texture2D(tDiffuse, p);","\t\tvec4 cb = texture2D(tDiffuse, p - offset);","\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","\t\tgl_FragColor = gl_FragColor+ snow;","\t}","\telse {","\t\tgl_FragColor=texture2D (tDiffuse, vUv);","\t}","}"].join("\n")}},function(e,t){THREE.SSAOShader={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new THREE.Vector2},cameraProjectionMatrix:{value:new THREE.Matrix4},cameraInverseProjectionMatrix:{value:new THREE.Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\treturn texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","\tfloat depth = getDepth( vUv );","\tfloat viewZ = getViewZ( depth );","\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );","\tvec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","\tvec3 bitangent = cross( viewNormal, tangent );","\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","\t\tvec3 sampleVector = kernelMatrix * kernel[ i ];","\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","\t\tsamplePointNDC /= samplePointNDC.w;","\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","\t\tfloat realDepth = getLinearDepth( samplePointUv );","\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","\t\tfloat delta = sampleDepth - realDepth;","\t\tif ( delta > minDistance && delta < maxDistance ) {","\t\t\tocclusion += 1.0;","\t\t}","\t}","\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join("\n")},THREE.SSAODepthShader={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","void main() {","\tfloat depth = getLinearDepth( vUv );","\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join("\n")},THREE.SSAOBlurShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texelSize = ( 1.0 / resolution );","\tfloat result = 0.0;","\tfor ( int i = - 2; i <= 2; i ++ ) {","\t\tfor ( int j = - 2; j <= 2; j ++ ) {","\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;","\t\t}","\t}","\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join("\n")}},function(e,t){THREE.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")}},function(e,t){THREE.AnaglyphEffect=function(e,t,r){this.colorMatrixLeft=(new THREE.Matrix3).fromArray([1.0671679973602295,-.0016435992438346148,.0001777536963345483,-.028107794001698494,-.00019593400065787137,-.0002875397040043026,-.04279090091586113,15809757314855233e-21,-.00024287120322696865]),this.colorMatrixRight=(new THREE.Matrix3).fromArray([-.0355340838432312,-.06440307199954987,.018319187685847282,-.10269022732973099,.8079727292060852,-.04835830628871918,.0001224992738571018,-.009558862075209618,.567823588848114]);var n=new THREE.OrthographicCamera(-1,1,1,-1,0,1),i=new THREE.Scene,a=new THREE.StereoCamera,o={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat};void 0===t&&(t=512),void 0===r&&(r=512);var s=new THREE.WebGLRenderTarget(t,r,o),l=new THREE.WebGLRenderTarget(t,r,o),c=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:s.texture},mapRight:{value:l.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","\treturn c <= 0.04045 ? c * 0.0773993808 :","\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","\treturn c <= 0.0031308 ? c * 12.92","\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","\tvec2 uv = vUv;","\tvec4 colorL = lin( texture2D( mapLeft, uv ) );","\tvec4 colorR = lin( texture2D( mapRight, uv ) );","\tvec3 color = clamp(","\t\t\tcolorMatrixLeft * colorL.rgb +","\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );","\tgl_FragColor = vec4(","\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),","\t\t\tmax( colorL.a, colorR.a ) );","}"].join("\n")}),u=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),c);i.add(u),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();s.setSize(t*n,r*n),l.setSize(t*n,r*n)},this.render=function(t,r){var o=e.getRenderTarget();t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),a.update(r),e.setRenderTarget(s),e.clear(),e.render(t,a.cameraL),e.setRenderTarget(l),e.clear(),e.render(t,a.cameraR),e.setRenderTarget(null),e.render(i,n),e.setRenderTarget(o)},this.dispose=function(){s&&s.dispose(),l&&l.dispose(),u&&u.geometry.dispose(),c&&c.dispose()}}},function(e,t){THREE.StereoEffect=function(e){var t=new THREE.StereoCamera;t.aspect=.5;var r=new THREE.Vector2;this.setEyeSeparation=function(e){t.eyeSep=e},this.setSize=function(t,r){e.setSize(t,r)},this.render=function(n,i){n.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),t.update(i),e.getSize(r),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,r.width/2,r.height),e.setViewport(0,0,r.width/2,r.height),e.render(n,t.cameraL),e.setScissor(r.width/2,0,r.width/2,r.height),e.setViewport(r.width/2,0,r.width/2,r.height),e.render(n,t.cameraR),e.setScissorTest(!1)}}},function(e,t){THREE.ParallaxBarrierEffect=function(e){var t=new THREE.OrthographicCamera(-1,1,1,-1,0,1),r=new THREE.Scene,n=new THREE.StereoCamera,i={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},a=new THREE.WebGLRenderTarget(512,512,i),o=new THREE.WebGLRenderTarget(512,512,i),s=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:a.texture},mapRight:{value:o.texture}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","\tvec2 uv = vUv;","\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","\t\tgl_FragColor = texture2D( mapLeft, uv );","\t} else {","\t\tgl_FragColor = texture2D( mapRight, uv );","\t}","}"].join("\n")}),l=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),s);r.add(l),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();a.setSize(t*n,r*n),o.setSize(t*n,r*n)},this.render=function(i,s){i.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),n.update(s),e.setRenderTarget(a),e.clear(),e.render(i,n.cameraL),e.setRenderTarget(o),e.clear(),e.render(i,n.cameraR),e.setRenderTarget(null),e.render(r,t)}}},function(e,t){THREE.TypedArrayUtils={},
/**
 * In-place quicksort for typed arrays (e.g. for Float32Array)
 * provides fast sorting
 * useful e.g. for a custom shader and/or BufferGeometry
 *
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 *
 * Complexity: http://bigocheatsheet.com/ see Quicksort
 *
 * Example:
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * eleSize: 3 //because of (x, y, z)
 * orderElement: 0 //order according to x
 */
THREE.TypedArrayUtils.quicksortIP=function(e,t,r){for(var n,i,a=[],o=-1,s=0,l=e.length/t-1,c=0,u=0,h=0,d=function(r,n){for(r*=t,n*=t,h=0;h<t;h++)c=e[r+h],e[r+h]=e[n+h],e[n+h]=c},f=new Float32Array(t),p=new Float32Array(t);;)if(l-s<=25){for(i=s+1;i<=l;i++){for(u=0;u<t;u++)f[u]=e[i*t+u];for(n=i-1;n>=s&&e[n*t+r]>f[r];){for(u=0;u<t;u++)e[(n+1)*t+u]=e[n*t+u];n--}for(u=0;u<t;u++)e[(n+1)*t+u]=f[u]}if(-1==o)break;l=a[o--],s=a[o--]}else{for(i=l,d(s+l>>1,n=s+1),e[s*t+r]>e[l*t+r]&&d(s,l),e[n*t+r]>e[l*t+r]&&d(n,l),e[s*t+r]>e[n*t+r]&&d(s,n),u=0;u<t;u++)p[u]=e[n*t+u];for(;;){do{n++}while(e[n*t+r]<p[r]);do{i--}while(e[i*t+r]>p[r]);if(i<n)break;d(n,i)}for(u=0;u<t;u++)e[(s+1)*t+u]=e[i*t+u],e[i*t+u]=p[u];l-n+1>=i-s?(a[++o]=n,a[++o]=l,l=i-1):(a[++o]=s,a[++o]=i-1,s=n)}return e},
/**
 * k-d Tree for typed arrays (e.g. for Float32Array), in-place
 * provides fast nearest neighbour search
 * useful e.g. for a custom shader and/or BufferGeometry, saves tons of memory
 * has no insert and remove, only buildup and neares neighbour search
 *
 * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs
 *
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 *
 * Requires typed array quicksort
 *
 * Example:
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * metric: function(a, b){	return Math.pow(a[0] - b[0], 2) +  Math.pow(a[1] - b[1], 2) +  Math.pow(a[2] - b[2], 2); }  //Manhatten distance
 * eleSize: 3 //because of (x, y, z)
 *
 * Further information (including mathematical properties)
 * http://en.wikipedia.org/wiki/Binary_tree
 * http://en.wikipedia.org/wiki/K-d_tree
 *
 * If you want to further minimize memory usage, remove Node.depth and replace in search algorithm with a traversal to root node (see comments at THREE.TypedArrayUtils.Kdtree.prototype.Node)
 */
THREE.TypedArrayUtils.Kdtree=function(e,t,r){var n=this,i=0,a=function(e,t){return e.subarray(t*r,t*r+r)};this.root=function e(t,o,s,l){var c,u,h=o%r,d=t.length/r;return o>i&&(i=o),0===d?null:1===d?new n.Node(a(t,0),o,s,l):(THREE.TypedArrayUtils.quicksortIP(t,r,h),c=Math.floor(d/2),(u=new n.Node(a(t,c),o,s,c+l)).left=e(t.subarray(0,c*r),o+1,u,l),u.right=e(t.subarray((c+1)*r,t.length),o+1,u,l+c+1),u)}(e,0,null,0),this.getMaxDepth=function(){return i},this.nearest=function(e,i,a){var o,s,l;if(l=new THREE.TypedArrayUtils.Kdtree.BinaryHeap(function(e){return-e[1]}),a)for(o=0;o<i;o+=1)l.push([null,a]);for(function n(a){var o,s,c,u,h=a.depth%r,d=t(e,a.obj),f=[];function p(e,t){l.push([e,t]),l.size()>i&&l.pop()}for(u=0;u<r;u+=1)u===a.depth%r?f[u]=e[u]:f[u]=a.obj[u];s=t(f,a.obj),null!==a.right||null!==a.left?(n(o=null===a.right?a.left:null===a.left?a.right:e[h]<a.obj[h]?a.left:a.right),(l.size()<i||d<l.peek()[1])&&p(a,d),(l.size()<i||Math.abs(s)<l.peek()[1])&&null!==(c=o===a.left?a.right:a.left)&&n(c)):(l.size()<i||d<l.peek()[1])&&p(a,d)}(n.root),s=[],o=0;o<i;o+=1)l.content[o][0]&&s.push([l.content[o][0],l.content[o][1]]);return s}},THREE.TypedArrayUtils.Kdtree.prototype.Node=function(e,t,r,n){this.obj=e,this.left=null,this.right=null,this.parent=r,this.depth=t,this.pos=n},THREE.TypedArrayUtils.Kdtree.BinaryHeap=function(e){this.content=[],this.scoreFunction=e},THREE.TypedArrayUtils.Kdtree.BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,r=0;r<t;r++)if(this.content[r]==e){var n=this.content.pop();return void(r!=t-1&&(this.content[r]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.bubbleUp(r):this.sinkDown(r)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var r=Math.floor((e+1)/2)-1,n=this.content[r];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[r]=t,this.content[e]=n,e=r}},sinkDown:function(e){for(var t=this.content.length,r=this.content[e],n=this.scoreFunction(r);;){var i=2*(e+1),a=i-1,o=null;if(a<t){var s=this.content[a],l=this.scoreFunction(s);l<n&&(o=a)}if(i<t){var c=this.content[i];this.scoreFunction(c)<(null===o?n:l)&&(o=i)}if(null===o)break;this.content[e]=this.content[o],this.content[o]=r,e=o}}}},function(e,t){THREE.BufferGeometryUtils={computeTangents:function(e){var t=e.index,r=e.attributes;if(null!==t&&void 0!==r.position&&void 0!==r.normal&&void 0!==r.uv){var n=t.array,i=r.position.array,a=r.normal.array,o=r.uv.array,s=i.length/3;void 0===r.tangent&&e.setAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*s),4));for(var l=r.tangent.array,c=[],u=[],h=0;h<s;h++)c[h]=new THREE.Vector3,u[h]=new THREE.Vector3;var d=new THREE.Vector3,f=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector2,v=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector3,E=new THREE.Vector3,x=e.groups;0===x.length&&(x=[{start:0,count:n.length}]);h=0;for(var T=x.length;h<T;++h)for(var b=H=(C=x[h]).start,w=H+C.count;b<w;b+=3)I(n[b+0],n[b+1],n[b+2]);var _,R,M,S=new THREE.Vector3,A=new THREE.Vector3,L=new THREE.Vector3,P=new THREE.Vector3;for(h=0,T=x.length;h<T;++h){var C,H;for(b=H=(C=x[h]).start,w=H+C.count;b<w;b+=3)k(n[b+0]),k(n[b+1]),k(n[b+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function I(e,t,r){d.fromArray(i,3*e),f.fromArray(i,3*t),p.fromArray(i,3*r),m.fromArray(o,2*e),v.fromArray(o,2*t),g.fromArray(o,2*r),f.sub(d),p.sub(d),v.sub(m),g.sub(m);var n=1/(v.x*g.y-g.x*v.y);isFinite(n)&&(y.copy(f).multiplyScalar(g.y).addScaledVector(p,-v.y).multiplyScalar(n),E.copy(p).multiplyScalar(v.x).addScaledVector(f,-g.x).multiplyScalar(n),c[e].add(y),c[t].add(y),c[r].add(y),u[e].add(E),u[t].add(E),u[r].add(E))}function k(e){L.fromArray(a,3*e),P.copy(L),R=c[e],S.copy(R),S.sub(L.multiplyScalar(L.dot(R))).normalize(),A.crossVectors(P,R),M=A.dot(u[e]),_=M<0?-1:1,l[4*e]=S.x,l[4*e+1]=S.y,l[4*e+2]=S.z,l[4*e+3]=_}},mergeBufferGeometries:function(e,t){for(var r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=e[0].morphTargetsRelative,l=new THREE.BufferGeometry,c=0,u=0;u<e.length;++u){var h=e[u];if(r!==(null!==h.index))return null;for(var d in h.attributes){if(!n.has(d))return null;void 0===a[d]&&(a[d]=[]),a[d].push(h.attributes[d])}if(s!==h.morphTargetsRelative)return null;for(var d in h.morphAttributes){if(!i.has(d))return null;void 0===o[d]&&(o[d]=[]),o[d].push(h.morphAttributes[d])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(h.userData),t){var f;if(r)f=h.index.count;else{if(void 0===h.attributes.position)return null;f=h.attributes.position.count}l.addGroup(c,f,u),c+=f}}if(r){var p=0,m=[];for(u=0;u<e.length;++u){for(var v=e[u].index,g=0;g<v.count;++g)m.push(v.getX(g)+p);p+=e[u].attributes.position.count}l.setIndex(m)}for(var d in a){var y=this.mergeBufferAttributes(a[d]);if(!y)return null;l.setAttribute(d,y)}for(var d in o){var E=o[d][0].length;if(0===E)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[d]=[];for(u=0;u<E;++u){var x=[];for(g=0;g<o[d].length;++g)x.push(o[d][g][u]);var T=this.mergeBufferAttributes(x);if(!T)return null;l.morphAttributes[d].push(T)}}return l},mergeBufferAttributes:function(e){for(var t,r,n,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return null;if(void 0===n&&(n=o.normalized),n!==o.normalized)return null;i+=o.array.length}var s=new t(i),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new THREE.BufferAttribute(s,r,n)},interleaveAttributes:function(e){for(var t,r=0,n=0,i=0,a=e.length;i<a;++i){var o=e[i];if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;r+=o.array.length,n+=o.itemSize}var s=new THREE.InterleavedBuffer(new t(r),n),l=0,c=[],u=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"],d=0;for(a=e.length;d<a;d++){var f=(o=e[d]).itemSize,p=o.count,m=new THREE.InterleavedBufferAttribute(s,f,l,o.normalized);c.push(m),l+=f;for(var v=0;v<p;v++)for(var g=0;g<f;g++)m[h[g]](v,o[u[g]](v))}return c},estimateBytesUsed:function(e){var t=0;for(var r in e.attributes){var n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}var i=e.getIndex();return t+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var r={},n=e.getIndex(),i=e.getAttribute("position"),a=n?n.count:i.count,o=0,s=Object.keys(e.attributes),l={},c={},u=[],h=["getX","getY","getZ","getW"],d=0,f=s.length;d<f;d++){l[E=s[d]]=[],(w=e.morphAttributes[E])&&(c[E]=new Array(w.length).fill().map(()=>[]))}var p=Math.log10(1/t),m=Math.pow(10,p);for(d=0;d<a;d++){var v=n?n.getX(d):d,g="",y=0;for(f=s.length;y<f;y++)for(var E=s[y],x=(b=e.getAttribute(E)).itemSize,T=0;T<x;T++)g+=`${~~(b[h[T]](v)*m)},`;if(g in r)u.push(r[g]);else{for(y=0,f=s.length;y<f;y++){E=s[y];var b=e.getAttribute(E),w=e.morphAttributes[E],_=(x=b.itemSize,l[E]),R=c[E];for(T=0;T<x;T++){var M=h[T];if(_.push(b[M](v)),w)for(var S=0,A=w.length;S<A;S++)R[S].push(w[S][M](v))}}r[g]=o,u.push(o),o++}}const L=e.clone();for(d=0,f=s.length;d<f;d++){E=s[d];var P=e.getAttribute(E),C=new P.array.constructor(l[E]);b=new THREE.BufferAttribute(C,P.itemSize,P.normalized);if(L.setAttribute(E,b),E in c)for(y=0;y<c[E].length;y++){var H=e.morphAttributes[E][y],I=(C=new H.array.constructor(c[E][y]),new THREE.BufferAttribute(C,H.itemSize,H.normalized));L.morphAttributes[E][y]=I}}return L.setIndex(u),L},toTrianglesDrawMode:function(e,t){if(t===THREE.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===THREE.TriangleFanDrawMode||t===THREE.TriangleStripDrawMode){var r=e.getIndex();if(null===r){var n=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<i.count;a++)n.push(a);e.setIndex(n),r=e.getIndex()}var o=r.count-2,s=[];if(t===THREE.TriangleFanDrawMode)for(a=1;a<=o;a++)s.push(r.getX(0)),s.push(r.getX(a)),s.push(r.getX(a+1));else for(a=0;a<o;a++)a%2==0?(s.push(r.getX(a)),s.push(r.getX(a+1)),s.push(r.getX(a+2))):(s.push(r.getX(a+2)),s.push(r.getX(a+1)),s.push(r.getX(a)));s.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l.clearGroups(),l}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}}},function(e,t){THREE.VolumeRenderShader1={uniforms:{u_size:{value:new THREE.Vector3(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new THREE.Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:["\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tvarying vec3 v_position;","\t\tmat4 inversemat(mat4 m) {","\t\t\t\tfloat","\t\t\t\ta00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],","\t\t\t\ta10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],","\t\t\t\ta20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],","\t\t\t\ta30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],","\t\t\t\tb00 = a00 * a11 - a01 * a10,","\t\t\t\tb01 = a00 * a12 - a02 * a10,","\t\t\t\tb02 = a00 * a13 - a03 * a10,","\t\t\t\tb03 = a01 * a12 - a02 * a11,","\t\t\t\tb04 = a01 * a13 - a03 * a11,","\t\t\t\tb05 = a02 * a13 - a03 * a12,","\t\t\t\tb06 = a20 * a31 - a21 * a30,","\t\t\t\tb07 = a20 * a32 - a22 * a30,","\t\t\t\tb08 = a20 * a33 - a23 * a30,","\t\t\t\tb09 = a21 * a32 - a22 * a31,","\t\t\t\tb10 = a21 * a33 - a23 * a31,","\t\t\t\tb11 = a22 * a33 - a23 * a32,","\t\t\t\tdet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;","\t\treturn mat4(","\t\t\t\ta11 * b11 - a12 * b10 + a13 * b09,","\t\t\t\ta02 * b10 - a01 * b11 - a03 * b09,","\t\t\t\ta31 * b05 - a32 * b04 + a33 * b03,","\t\t\t\ta22 * b04 - a21 * b05 - a23 * b03,","\t\t\t\ta12 * b08 - a10 * b11 - a13 * b07,","\t\t\t\ta00 * b11 - a02 * b08 + a03 * b07,","\t\t\t\ta32 * b02 - a30 * b05 - a33 * b01,","\t\t\t\ta20 * b05 - a22 * b02 + a23 * b01,","\t\t\t\ta10 * b10 - a11 * b08 + a13 * b06,","\t\t\t\ta01 * b08 - a00 * b10 - a03 * b06,","\t\t\t\ta30 * b04 - a31 * b02 + a33 * b00,","\t\t\t\ta21 * b02 - a20 * b04 - a23 * b00,","\t\t\t\ta11 * b07 - a10 * b09 - a12 * b06,","\t\t\t\ta00 * b09 - a01 * b07 + a02 * b06,","\t\t\t\ta31 * b01 - a30 * b03 - a32 * b00,","\t\t\t\ta20 * b03 - a21 * b01 + a22 * b00) / det;","\t\t}","\t\tvoid main() {","\t\t\t\tmat4 viewtransformf = modelViewMatrix;","\t\t\t\tmat4 viewtransformi = inversemat(modelViewMatrix);","\t\t\t\tvec4 position4 = vec4(position, 1.0);","\t\t\t\tvec4 pos_in_cam = viewtransformf * position4;","\t\t\t\tpos_in_cam.z = -pos_in_cam.w;","\t\t\t\tv_nearpos = viewtransformi * pos_in_cam;","\t\t\t\tpos_in_cam.z = pos_in_cam.w;","\t\t\t\tv_farpos = viewtransformi * pos_in_cam;","\t\t\t\tv_position = position;","\t\t\t\tgl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;","\t\t}"].join("\n"),fragmentShader:["\t\tprecision highp float;","\t\tprecision mediump sampler3D;","\t\tuniform vec3 u_size;","\t\tuniform int u_renderstyle;","\t\tuniform float u_renderthreshold;","\t\tuniform vec2 u_clim;","\t\tuniform sampler3D u_data;","\t\tuniform sampler2D u_cmdata;","\t\tvarying vec3 v_position;","\t\tvarying vec4 v_nearpos;","\t\tvarying vec4 v_farpos;","\t\tconst int MAX_STEPS = 887;\t// 887 for 512^3, 1774 for 1024^3","\t\tconst int REFINEMENT_STEPS = 4;","\t\tconst float relative_step_size = 1.0;","\t\tconst vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);","\t\tconst vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);","\t\tconst vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);","\t\tconst float shininess = 40.0;","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","\t\tfloat sample1(vec3 texcoords);","\t\tvec4 apply_colormap(float val);","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);","\t\tvoid main() {","\t\t\t\tvec3 farpos = v_farpos.xyz / v_farpos.w;","\t\t\t\tvec3 nearpos = v_nearpos.xyz / v_nearpos.w;","\t\t\t\tvec3 view_ray = normalize(nearpos.xyz - farpos.xyz);","\t\t\t\tfloat distance = dot(nearpos - v_position, view_ray);","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.x) / view_ray.x,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.x - 0.5 - v_position.x) / view_ray.x));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.y) / view_ray.y,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.y - 0.5 - v_position.y) / view_ray.y));","\t\t\t\tdistance = max(distance, min((-0.5 - v_position.z) / view_ray.z,","\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(u_size.z - 0.5 - v_position.z) / view_ray.z));","\t\t\t\tvec3 front = v_position + view_ray * distance;","\t\t\t\tint nsteps = int(-distance / relative_step_size + 0.5);","\t\t\t\tif ( nsteps < 1 )","\t\t\t\t\t\tdiscard;","\t\t\t\tvec3 step = ((v_position - front) / u_size) / float(nsteps);","\t\t\t\tvec3 start_loc = front / u_size;","\t\t\t\tif (u_renderstyle == 0)","\t\t\t\t\t\tcast_mip(start_loc, step, nsteps, view_ray);","\t\t\t\telse if (u_renderstyle == 1)","\t\t\t\t\t\tcast_iso(start_loc, step, nsteps, view_ray);","\t\t\t\tif (gl_FragColor.a < 0.05)","\t\t\t\t\t\tdiscard;","\t\t}","\t\tfloat sample1(vec3 texcoords) {","\t\t\t\t/* Sample float value from a 3D texture. Assumes intensity data. */","\t\t\t\treturn texture(u_data, texcoords.xyz).r;","\t\t}","\t\tvec4 apply_colormap(float val) {","\t\t\t\tval = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);","\t\t\t\treturn texture2D(u_cmdata, vec2(val, 0.5));","\t\t}","\t\tvoid cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tfloat max_val = -1e6;","\t\t\t\tint max_i = 100;","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > max_val) {","\t\t\t\t\t\t\t\tmax_val = val;","\t\t\t\t\t\t\t\tmax_i = iter;","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t\t\tvec3 iloc = start_loc + step * (float(max_i) - 0.5);","\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\tmax_val = max(max_val, sample1(iloc));","\t\t\t\t\t\tiloc += istep;","\t\t\t\t}","\t\t\t\tgl_FragColor = apply_colormap(max_val);","\t\t}","\t\tvoid cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","\t\t\t\tgl_FragColor = vec4(0.0);\t// init transparent","\t\t\t\tvec4 color3 = vec4(0.0);\t// final color","\t\t\t\tvec3 dstep = 1.5 / u_size;\t// step to sample derivative","\t\t\t\tvec3 loc = start_loc;","\t\t\t\tfloat low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);","\t\t\t\tfor (int iter=0; iter<MAX_STEPS; iter++) {","\t\t\t\t\t\tif (iter >= nsteps)","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tfloat val = sample1(loc);","\t\t\t\t\t\tif (val > low_threshold) {","\t\t\t\t\t\t\t\tvec3 iloc = loc - 0.5 * step;","\t\t\t\t\t\t\t\tvec3 istep = step / float(REFINEMENT_STEPS);","\t\t\t\t\t\t\t\tfor (int i=0; i<REFINEMENT_STEPS; i++) {","\t\t\t\t\t\t\t\t\t\tval = sample1(iloc);","\t\t\t\t\t\t\t\t\t\tif (val > u_renderthreshold) {","\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = add_lighting(val, iloc, dstep, view_ray);","\t\t\t\t\t\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\t\t\tiloc += istep;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tloc += step;","\t\t\t\t}","\t\t}","\t\tvec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)","\t\t{","\t\t\t\tvec3 V = normalize(view_ray);","\t\t\t\tvec3 N;","\t\t\t\tfloat val1, val2;","\t\t\t\tval1 = sample1(loc + vec3(-step[0], 0.0, 0.0));","\t\t\t\tval2 = sample1(loc + vec3(+step[0], 0.0, 0.0));","\t\t\t\tN[0] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, -step[1], 0.0));","\t\t\t\tval2 = sample1(loc + vec3(0.0, +step[1], 0.0));","\t\t\t\tN[1] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tval1 = sample1(loc + vec3(0.0, 0.0, -step[2]));","\t\t\t\tval2 = sample1(loc + vec3(0.0, 0.0, +step[2]));","\t\t\t\tN[2] = val1 - val2;","\t\t\t\tval = max(max(val1, val2), val);","\t\t\t\tfloat gm = length(N); // gradient magnitude","\t\t\t\tN = normalize(N);","\t\t\t\tfloat Nselect = float(dot(N, V) > 0.0);","\t\t\t\tN = (2.0 * Nselect - 1.0) * N;\t// ==\tNselect * N - (1.0-Nselect)*N;","\t\t\t\tvec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tvec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);","\t\t\t\tfor (int i=0; i<1; i++)","\t\t\t\t{","\t\t\t\t\t\tvec3 L = normalize(view_ray);\t//lightDirs[i];","\t\t\t\t\t\tfloat lightEnabled = float( length(L) > 0.0 );","\t\t\t\t\t\tL = normalize(L + (1.0 - lightEnabled));","\t\t\t\t\t\tfloat lambertTerm = clamp(dot(N, L), 0.0, 1.0);","\t\t\t\t\t\tvec3 H = normalize(L+V); // Halfway vector","\t\t\t\t\t\tfloat specularTerm = pow(max(dot(H, N), 0.0), shininess);","\t\t\t\t\t\tfloat mask1 = lightEnabled;","\t\t\t\t\t\tambient_color +=\tmask1 * ambient_color;\t// * gl_LightSource[i].ambient;","\t\t\t\t\t\tdiffuse_color +=\tmask1 * lambertTerm;","\t\t\t\t\t\tspecular_color += mask1 * specularTerm * specular_color;","\t\t\t\t}","\t\t\t\tvec4 final_color;","\t\t\t\tvec4 color = apply_colormap(val);","\t\t\t\tfinal_color = color * (ambient_color + diffuse_color) + specular_color;","\t\t\t\tfinal_color.a = color.a;","\t\t\t\treturn final_color;","\t\t}"].join("\n")}},function(e,t){THREE.GodRaysDepthMaskShader={uniforms:{tInput:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tInput;","void main() {","\tgl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );","}"].join("\n")},THREE.GodRaysGenerateShader={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","\tvec2 delta = vSunPositionScreenSpace - vUv;","\tfloat dist = length( delta );","\tvec2 stepv = fStepSize * delta / dist;","\tfloat iters = dist/fStepSize;","\tvec2 uv = vUv.xy;","\tfloat col = 0.0;","\tif ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tgl_FragColor = vec4( col/TAPS_PER_PASS );","\tgl_FragColor.a = 1.0;","}"].join("\n")},THREE.GodRaysCombineShader={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","\tgl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","\tgl_FragColor.a = 1.0;","}"].join("\n")},THREE.GodRaysFakeSunShader={uniforms:{vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)},fAspect:{value:1},sunColor:{value:new THREE.Color(16772608)},bgColor:{value:new THREE.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","\tvec2 diff = vUv - vSunPositionScreenSpace;","\tdiff.x *= fAspect;","\tfloat prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","\tprop = 0.35 * pow( 1.0 - prop, 3.0 );","\tgl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","\tgl_FragColor.w = 1.0;","}"].join("\n")}},function(e,t){THREE.DragControls=function(e,t,r){var n=new THREE.Plane,i=new THREE.Raycaster,a=new THREE.Vector2,o=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Matrix4,u=[],h=null,d=null,f=this;function p(){r.addEventListener("mousemove",v,!1),r.addEventListener("mousedown",g,!1),r.addEventListener("mouseup",y,!1),r.addEventListener("mouseleave",y,!1),r.addEventListener("touchmove",E,!1),r.addEventListener("touchstart",x,!1),r.addEventListener("touchend",T,!1)}function m(){r.removeEventListener("mousemove",v,!1),r.removeEventListener("mousedown",g,!1),r.removeEventListener("mouseup",y,!1),r.removeEventListener("mouseleave",y,!1),r.removeEventListener("touchmove",E,!1),r.removeEventListener("touchstart",x,!1),r.removeEventListener("touchend",T,!1)}function v(p){if(!1!==f.enabled){p.preventDefault();var m=r.getBoundingClientRect();if(a.x=(p.clientX-m.left)/m.width*2-1,a.y=-(p.clientY-m.top)/m.height*2+1,i.setFromCamera(a,t),h&&f.enabled)return i.ray.intersectPlane(n,s)&&h.position.copy(s.sub(o).applyMatrix4(c)),void f.dispatchEvent({type:"drag",object:h});if(u.length=0,i.setFromCamera(a,t),i.intersectObjects(e,!0,u),u.length>0){var v=u[0].object;n.setFromNormalAndCoplanarPoint(t.getWorldDirection(n.normal),l.setFromMatrixPosition(v.matrixWorld)),d!==v&&(f.dispatchEvent({type:"hoveron",object:v}),r.style.cursor="pointer",d=v)}else null!==d&&(f.dispatchEvent({type:"hoveroff",object:d}),r.style.cursor="auto",d=null)}}function g(d){!1!==f.enabled&&(d.preventDefault(),u.length=0,i.setFromCamera(a,t),i.intersectObjects(e,!0,u),u.length>0&&(h=!0===f.transformGroup?e[0]:u[0].object,i.ray.intersectPlane(n,s)&&(c.getInverse(h.parent.matrixWorld),o.copy(s).sub(l.setFromMatrixPosition(h.matrixWorld))),r.style.cursor="move",f.dispatchEvent({type:"dragstart",object:h})))}function y(e){!1!==f.enabled&&(e.preventDefault(),h&&(f.dispatchEvent({type:"dragend",object:h}),h=null),r.style.cursor=d?"pointer":"auto")}function E(e){if(!1!==f.enabled){e.preventDefault(),e=e.changedTouches[0];var l=r.getBoundingClientRect();return a.x=(e.clientX-l.left)/l.width*2-1,a.y=-(e.clientY-l.top)/l.height*2+1,i.setFromCamera(a,t),h&&f.enabled?(i.ray.intersectPlane(n,s)&&h.position.copy(s.sub(o).applyMatrix4(c)),void f.dispatchEvent({type:"drag",object:h})):void 0}}function x(d){if(!1!==f.enabled){d.preventDefault(),d=d.changedTouches[0];var p=r.getBoundingClientRect();a.x=(d.clientX-p.left)/p.width*2-1,a.y=-(d.clientY-p.top)/p.height*2+1,u.length=0,i.setFromCamera(a,t),i.intersectObjects(e,!0,u),u.length>0&&(h=!0===f.transformGroup?e[0]:u[0].object,n.setFromNormalAndCoplanarPoint(t.getWorldDirection(n.normal),l.setFromMatrixPosition(h.matrixWorld)),i.ray.intersectPlane(n,s)&&(c.getInverse(h.parent.matrixWorld),o.copy(s).sub(l.setFromMatrixPosition(h.matrixWorld))),r.style.cursor="move",f.dispatchEvent({type:"dragstart",object:h}))}}function T(e){!1!==f.enabled&&(e.preventDefault(),h&&(f.dispatchEvent({type:"dragend",object:h}),h=null),r.style.cursor="auto")}p(),this.enabled=!0,this.transformGroup=!1,this.activate=p,this.deactivate=m,this.dispose=function(){m()},this.getObjects=function(){return e}},THREE.DragControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.DragControls.prototype.constructor=THREE.DragControls},function(e,t){THREE.TransformControls=function(e,t){void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),THREE.Object3D.call(this),this.visible=!1,this.domElement=t;var r=new THREE.TransformControlsGizmo;this.add(r);var n=new THREE.TransformControlsPlane;this.add(n);var i=this;U("camera",e),U("object",void 0),U("enabled",!0),U("axis",null),U("mode","translate"),U("translationSnap",null),U("rotationSnap",null),U("scaleSnap",null),U("space","world"),U("size",1),U("dragging",!1),U("showX",!0),U("showY",!0),U("showZ",!0);var a={type:"change"},o={type:"mouseDown"},s={type:"mouseUp",mode:i.mode},l={type:"objectChange"},c=new THREE.Raycaster,u=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Quaternion,f={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},p=new THREE.Vector3,m=new THREE.Vector3,v=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector3,x=0,T=new THREE.Vector3,b=new THREE.Quaternion,w=new THREE.Vector3,_=new THREE.Vector3,R=new THREE.Quaternion,M=new THREE.Quaternion,S=new THREE.Vector3,A=new THREE.Vector3,L=new THREE.Quaternion,P=new THREE.Vector3,C=new THREE.Vector3,H=new THREE.Quaternion,I=new THREE.Quaternion,k=new THREE.Vector3,N=new THREE.Vector3,O=new THREE.Vector3,F=new THREE.Quaternion,D=new THREE.Vector3;function U(e,t){var o=t;Object.defineProperty(i,e,{get:function(){return void 0!==o?o:t},set:function(t){o!==t&&(o=t,n[e]=t,r[e]=t,i.dispatchEvent({type:e+"-changed",value:t}),i.dispatchEvent(a))}}),i[e]=t,n[e]=t,r[e]=t}function z(e){if(document.pointerLockElement)return{x:0,y:0,button:e.button};var r=e.changedTouches?e.changedTouches[0]:e,n=t.getBoundingClientRect();return{x:(r.clientX-n.left)/n.width*2-1,y:-(r.clientY-n.top)/n.height*2+1,button:e.button}}function B(e){i.enabled&&i.pointerHover(z(e))}function G(e){i.enabled&&(document.addEventListener("mousemove",V,!1),i.pointerHover(z(e)),i.pointerDown(z(e)))}function V(e){i.enabled&&i.pointerMove(z(e))}function j(e){i.enabled&&(document.removeEventListener("mousemove",V,!1),i.pointerUp(z(e)))}U("worldPosition",C),U("worldPositionStart",A),U("worldQuaternion",H),U("worldQuaternionStart",L),U("cameraPosition",T),U("cameraQuaternion",b),U("pointStart",p),U("pointEnd",m),U("rotationAxis",g),U("rotationAngle",x),U("eye",N),t.addEventListener("mousedown",G,!1),t.addEventListener("touchstart",G,!1),t.addEventListener("mousemove",B,!1),t.addEventListener("touchmove",B,!1),t.addEventListener("touchmove",V,!1),document.addEventListener("mouseup",j,!1),t.addEventListener("touchend",j,!1),t.addEventListener("touchcancel",j,!1),t.addEventListener("touchleave",j,!1),this.dispose=function(){t.removeEventListener("mousedown",G),t.removeEventListener("touchstart",G),t.removeEventListener("mousemove",B),document.removeEventListener("mousemove",V),t.removeEventListener("touchmove",B),t.removeEventListener("touchmove",V),document.removeEventListener("mouseup",j),t.removeEventListener("touchend",j),t.removeEventListener("touchcancel",j),t.removeEventListener("touchleave",j),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})},this.attach=function(e){return this.object=e,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(_,R,S),this.object.matrixWorld.decompose(C,H,k),M.copy(R).inverse(),I.copy(H).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(T,b,w),N.copy(T).sub(C).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var t=c.intersectObjects(r.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){c.setFromCamera(e,this.camera);var t=c.intersectObjects([n],!0)[0]||!1;if(t){var r=this.space;if("scale"===this.mode?r="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(r="world"),"local"===r&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),O.copy(this.object.position),F.copy(this.object.quaternion),D.copy(this.object.scale),this.object.matrixWorld.decompose(A,L,P),p.copy(t.point).sub(A)}this.dragging=!0,o.mode=this.mode,this.dispatchEvent(o)}},this.pointerMove=function(e){var t=this.axis,r=this.mode,i=this.object,o=this.space;if("scale"===r?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==i&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var s=c.intersectObjects([n],!0)[0]||!1;if(!1!==s){if(m.copy(s.point).sub(A),"translate"===r)v.copy(m).sub(p),"local"===o&&"XYZ"!==t&&v.applyQuaternion(I),-1===t.indexOf("X")&&(v.x=0),-1===t.indexOf("Y")&&(v.y=0),-1===t.indexOf("Z")&&(v.z=0),"local"===o&&"XYZ"!==t?v.applyQuaternion(F).divide(S):v.applyQuaternion(M).divide(S),i.position.copy(v).add(O),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(d.copy(F).inverse()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(F)),"world"===o&&(i.parent&&i.position.add(u.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(u.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){var T=m.length()/p.length();m.dot(p)<0&&(T*=-1),h.set(T,T,T)}else u.copy(p),h.copy(m),u.applyQuaternion(I),h.applyQuaternion(I),h.divide(u),-1===t.search("X")&&(h.x=1),-1===t.search("Y")&&(h.y=1),-1===t.search("Z")&&(h.z=1);i.scale.copy(D).multiply(h),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){v.copy(m).sub(p);var b=20/C.distanceTo(u.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(g.copy(N),x=m.angleTo(p),y.copy(p).normalize(),E.copy(m).normalize(),x*=E.cross(y).dot(N)<0?1:-1):"XYZE"===t?(g.copy(v).cross(N).normalize(),x=v.dot(u.copy(g).cross(this.eye))*b):"X"!==t&&"Y"!==t&&"Z"!==t||(g.copy(f[t]),u.copy(f[t]),"local"===o&&u.applyQuaternion(H),x=v.dot(u.cross(N).normalize())*b),this.rotationSnap&&(x=Math.round(x/this.rotationSnap)*this.rotationSnap),this.rotationAngle=x,"local"===o&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(F),i.quaternion.multiply(d.setFromAxisAngle(g,x)).normalize()):(g.applyQuaternion(M),i.quaternion.copy(d.setFromAxisAngle(g,x)),i.quaternion.multiply(F).normalize())}this.dispatchEvent(a),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return i.mode},this.setMode=function(e){i.mode=e},this.setTranslationSnap=function(e){i.translationSnap=e},this.setRotationSnap=function(e){i.rotationSnap=e},this.setScaleSnap=function(e){i.scaleSnap=e},this.setSize=function(e){i.size=e},this.setSpace=function(e){i.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),r=e.clone();r.opacity=.15;var n=e.clone();n.opacity=.33;var i=e.clone();i.color.set(16711680);var a=e.clone();a.color.set(65280);var o=e.clone();o.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var c=s.clone();c.color.set(65535);var u=s.clone();u.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var d=t.clone();d.color.set(65280);var f=t.clone();f.color.set(255);var p=t.clone();p.color.set(65535);var m=t.clone();m.color.set(16711935);var v=t.clone();v.color.set(16776960);var g=t.clone();g.color.set(7895160);var y=v.clone();y.opacity=.25;var E=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),x=new THREE.BoxBufferGeometry(.125,.125,.125),T=new THREE.BufferGeometry;T.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var b,w=function(e,t){for(var r=new THREE.BufferGeometry,n=[],i=0;i<=64*t;++i)n.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return r.setAttribute("position",new THREE.Float32BufferAttribute(n,3)),r},_={X:[[new THREE.Mesh(E,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(E,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(T,h)]],Y:[[new THREE.Mesh(E,a),[0,1,0],null,null,"fwd"],[new THREE.Mesh(E,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(T,d),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(E,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(E,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(T,f),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),s.clone()),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l.clone()),[.15,.15,0]],[new THREE.Line(T,v),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(T,v),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(T,p),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(T,p),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(T,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(T,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},R={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),r)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},M={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new THREE.Line((b=new THREE.BufferGeometry,b.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),b),n),null,null,null,"helper"]],X:[[new THREE.Line(T,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(T,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(T,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},S={X:[[new THREE.Line(w(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(w(1,.5),d),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(w(1,.5),f),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(w(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(w(1,1),g),null,[0,Math.PI/2,0]]]},A={AXIS:[[new THREE.Line(T,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),r)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),r)]]},P={X:[[new THREE.Mesh(x,i),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(T,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(x,a),[0,.8,0]],[new THREE.Line(T,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(x,o),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(T,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(x,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(T,v),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(T,v),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(x,c),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(T,p),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(T,p),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(x,u),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(T,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(T,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s.clone()),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s.clone()),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s.clone()),[0,0,1.1]]]},C={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(x,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(x,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(x,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,0,1.1]]]},H={X:[[new THREE.Line(T,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(T,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(T,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I=function(e){var t=new THREE.Object3D;for(var r in e)for(var n=e[r].length;n--;){var i=e[r][n][0].clone(),a=e[r][n][1],o=e[r][n][2],s=e[r][n][3],l=e[r][n][4];i.name=r,i.tag=l,a&&i.position.set(a[0],a[1],a[2]),o&&i.rotation.set(o[0],o[1],o[2]),s&&i.scale.set(s[0],s[1],s[2]),i.updateMatrix();var c=i.geometry.clone();c.applyMatrix4(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t},k=new THREE.Vector3(0,0,0),N=new THREE.Euler,O=new THREE.Vector3(0,1,0),F=new THREE.Vector3(0,0,0),D=new THREE.Matrix4,U=new THREE.Quaternion,z=new THREE.Quaternion,B=new THREE.Quaternion,G=new THREE.Vector3(1,0,0),V=new THREE.Vector3(0,1,0),j=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=I(_)),this.add(this.gizmo.rotate=I(S)),this.add(this.gizmo.scale=I(P)),this.add(this.picker.translate=I(R)),this.add(this.picker.rotate=I(L)),this.add(this.picker.scale=I(C)),this.add(this.helper.translate=I(M)),this.add(this.helper.rotate=I(A)),this.add(this.helper.scale=I(H)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:B;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var n=0;n<r.length;n++){var i=r[n];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition);var a=this.worldPosition.distanceTo(this.cameraPosition);if(i.scale.set(1,1,1).multiplyScalar(a*this.size/7),"helper"!==i.tag){if(i.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==i.name&&"XYZX"!==i.name||Math.abs(O.copy(G).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Y"!==i.name&&"XYZY"!==i.name||Math.abs(O.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Z"!==i.name&&"XYZZ"!==i.name||Math.abs(O.copy(j).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XY"===i.name&&Math.abs(O.copy(j).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"YZ"===i.name&&Math.abs(O.copy(G).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XZ"===i.name&&Math.abs(O.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),-1!==i.name.search("X")&&(O.copy(G).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.x*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Y")&&(O.copy(V).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.y*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Z")&&(O.copy(j).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.z*=-1:"bwd"===i.tag&&(i.visible=!1))}else"rotate"===this.mode&&(z.copy(t),O.copy(this.eye).applyQuaternion(U.copy(t).inverse()),-1!==i.name.search("E")&&i.quaternion.setFromRotationMatrix(D.lookAt(this.eye,F,V)),"X"===i.name&&(U.setFromAxisAngle(G,Math.atan2(-O.y,O.z)),U.multiplyQuaternions(z,U),i.quaternion.copy(U)),"Y"===i.name&&(U.setFromAxisAngle(V,Math.atan2(O.x,O.z)),U.multiplyQuaternions(z,U),i.quaternion.copy(U)),"Z"===i.name&&(U.setFromAxisAngle(j,Math.atan2(O.y,O.x)),U.multiplyQuaternions(z,U),i.quaternion.copy(U)));i.visible=i.visible&&(-1===i.name.indexOf("X")||this.showX),i.visible=i.visible&&(-1===i.name.indexOf("Y")||this.showY),i.visible=i.visible&&(-1===i.name.indexOf("Z")||this.showZ),i.visible=i.visible&&(-1===i.name.indexOf("E")||this.showX&&this.showY&&this.showZ),i.material._opacity=i.material._opacity||i.material.opacity,i.material._color=i.material._color||i.material.color.clone(),i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled?this.axis&&(i.name===this.axis?(i.material.opacity=1,i.material.color.lerp(new THREE.Color(1,1,1),.5)):this.axis.split("").some(function(e){return i.name===e})?(i.material.opacity=1,i.material.color.lerp(new THREE.Color(1,1,1),.5)):(i.material.opacity*=.25,i.material.color.lerp(new THREE.Color(1,1,1),.5))):(i.material.opacity*=.5,i.material.color.lerp(new THREE.Color(1,1,1),.5))}else i.visible=!1,"AXIS"===i.name?(i.position.copy(this.worldPositionStart),i.visible=!!this.axis,"X"===this.axis&&(U.setFromEuler(N.set(0,0,0)),i.quaternion.copy(t).multiply(U),Math.abs(O.copy(G).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Y"===this.axis&&(U.setFromEuler(N.set(0,0,Math.PI/2)),i.quaternion.copy(t).multiply(U),Math.abs(O.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Z"===this.axis&&(U.setFromEuler(N.set(0,Math.PI/2,0)),i.quaternion.copy(t).multiply(U),Math.abs(O.copy(j).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"XYZE"===this.axis&&(U.setFromEuler(N.set(0,Math.PI/2,0)),O.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(D.lookAt(F,O,V)),i.quaternion.multiply(U),i.visible=this.dragging),"E"===this.axis&&(i.visible=!1)):"START"===i.name?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):"END"===i.name?(i.position.copy(this.worldPosition),i.visible=this.dragging):"DELTA"===i.name?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),k.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),k.applyQuaternion(this.worldQuaternionStart.clone().inverse()),i.scale.copy(k),i.visible=this.dragging):(i.quaternion.copy(t),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=-1!==this.axis.search(i.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Matrix4,s=new THREE.Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:s),r.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:s),a.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":a.copy(this.eye).cross(e),i.copy(e).cross(a);break;case"Y":a.copy(this.eye).cross(t),i.copy(t).cross(a);break;case"Z":a.copy(this.eye).cross(r),i.copy(r).cross(a);break;case"XY":i.copy(r);break;case"YZ":i.copy(e);break;case"XZ":a.copy(r),i.copy(t);break;case"XYZ":case"E":i.set(0,0,0)}break;case"rotate":default:i.set(0,0,0)}0===i.length()?this.quaternion.copy(this.cameraQuaternion):(o.lookAt(n.set(0,0,0),i,a),this.quaternion.setFromRotationMatrix(o)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0})},function(e,t){THREE.GPUComputationRenderer=function(e,t,r){this.variables=[],this.currentTextureIndex=0;var n=new THREE.Scene,i=new THREE.Camera;i.position.z=1;var a={passThruTexture:{value:null}},o=c("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",a),s=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),o);function l(r){r.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function c(e,t){t=t||{};var r=new THREE.ShaderMaterial({uniforms:t,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return l(r),r}n.add(s),this.addVariable=function(e,t,r){var n={name:e,initialValueTexture:r,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};return this.variables.push(n),n},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!r.capabilities.isWebGL2&&!r.extensions.get("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===r.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var n=0;n<this.variables.length;n++){var i=this.variables[n];i.renderTargets[0]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),i.renderTargets[1]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),this.renderTexture(i.initialValueTexture,i.renderTargets[0]),this.renderTexture(i.initialValueTexture,i.renderTargets[1]);var a=i.material,o=a.uniforms;if(null!==i.dependencies)for(var s=0;s<i.dependencies.length;s++){var l=i.dependencies[s];if(l.name!==i.name){for(var c=!1,u=0;u<this.variables.length;u++)if(l.name===this.variables[u].name){c=!0;break}if(!c)return"Variable dependency not found. Variable="+i.name+", dependency="+l.name}o[l.name]={value:null},a.fragmentShader="\nuniform sampler2D "+l.name+";\n"+a.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,r=0,n=this.variables.length;r<n;r++){var i=this.variables[r];if(null!==i.dependencies)for(var a=i.material.uniforms,o=0,s=i.dependencies.length;o<s;o++){var l=i.dependencies[o];a[l.name].value=l.renderTargets[e].texture}this.doRenderTarget(i.material,i.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=l,this.createShaderMaterial=c,this.createRenderTarget=function(r,n,i,a,o,s){return r=r||e,n=n||t,i=i||THREE.ClampToEdgeWrapping,a=a||THREE.ClampToEdgeWrapping,o=o||THREE.NearestFilter,s=s||THREE.NearestFilter,new THREE.WebGLRenderTarget(r,n,{wrapS:i,wrapT:a,minFilter:o,magFilter:s,format:THREE.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?THREE.HalfFloatType:THREE.FloatType,stencilBuffer:!1,depthBuffer:!1})},this.createTexture=function(){var r=new Float32Array(e*t*4);return new THREE.DataTexture(r,e,t,THREE.RGBAFormat,THREE.FloatType)},this.renderTexture=function(e,t){a.passThruTexture.value=e,this.doRenderTarget(o,t),a.passThruTexture.value=null},this.doRenderTarget=function(e,t){var a=r.getRenderTarget();s.material=e,r.setRenderTarget(t),r.render(n,i),s.material=o,r.setRenderTarget(a)}}},function(e,t){THREE.ImprovedNoise=function(){for(var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=0;t<256;t++)e[256+t]=e[t];function r(e){return e*e*e*(e*(6*e-15)+10)}function n(e,t,r){return t+e*(r-t)}function i(e,t,r,n){var i=15&e,a=i<8?t:r,o=i<4?r:12==i||14==i?t:n;return(0==(1&i)?a:-a)+(0==(2&i)?o:-o)}return{noise:function(t,a,o){var s=Math.floor(t),l=Math.floor(a),c=Math.floor(o),u=255&s,h=255&l,d=255&c,f=(t-=s)-1,p=(a-=l)-1,m=(o-=c)-1,v=r(t),g=r(a),y=r(o),E=e[u]+h,x=e[E]+d,T=e[E+1]+d,b=e[u+1]+h,w=e[b]+d,_=e[b+1]+d;return n(y,n(g,n(v,i(e[x],t,a,o),i(e[w],f,a,o)),n(v,i(e[T],t,p,o),i(e[_],f,p,o))),n(g,n(v,i(e[x+1],t,a,m),i(e[w+1],f,a,o-1)),n(v,i(e[T+1],t,p,m),i(e[_+1],f,p,m))))}}}},function(e,t){THREE.SimplexNoise=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]},THREE.SimplexNoise.prototype.dot=function(e,t,r){return e[0]*t+e[1]*r},THREE.SimplexNoise.prototype.dot3=function(e,t,r,n){return e[0]*t+e[1]*r+e[2]*n},THREE.SimplexNoise.prototype.dot4=function(e,t,r,n,i){return e[0]*t+e[1]*r+e[2]*n+e[3]*i},THREE.SimplexNoise.prototype.noise=function(e,t){var r,n,i=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+i),o=Math.floor(t+i),s=(3-Math.sqrt(3))/6,l=(a+o)*s,c=e-(a-l),u=t-(o-l);c>u?(r=1,n=0):(r=0,n=1);var h=c-r+s,d=u-n+s,f=c-1+2*s,p=u-1+2*s,m=255&a,v=255&o,g=this.perm[m+this.perm[v]]%12,y=this.perm[m+r+this.perm[v+n]]%12,E=this.perm[m+1+this.perm[v+1]]%12,x=.5-c*c-u*u,T=.5-h*h-d*d,b=.5-f*f-p*p;return 70*((x<0?0:(x*=x)*x*this.dot(this.grad3[g],c,u))+(T<0?0:(T*=T)*T*this.dot(this.grad3[y],h,d))+(b<0?0:(b*=b)*b*this.dot(this.grad3[E],f,p)))},THREE.SimplexNoise.prototype.noise3d=function(e,t,r){var n,i,a,o,s,l,c=(e+t+r)*(1/3),u=Math.floor(e+c),h=Math.floor(t+c),d=Math.floor(r+c),f=1/6,p=(u+h+d)*f,m=e-(u-p),v=t-(h-p),g=r-(d-p);m>=v?v>=g?(n=1,i=0,a=0,o=1,s=1,l=0):m>=g?(n=1,i=0,a=0,o=1,s=0,l=1):(n=0,i=0,a=1,o=1,s=0,l=1):v<g?(n=0,i=0,a=1,o=0,s=1,l=1):m<g?(n=0,i=1,a=0,o=0,s=1,l=1):(n=0,i=1,a=0,o=1,s=1,l=0);var y=m-n+f,E=v-i+f,x=g-a+f,T=m-o+2*f,b=v-s+2*f,w=g-l+2*f,_=m-1+.5,R=v-1+.5,M=g-1+.5,S=255&u,A=255&h,L=255&d,P=this.perm[S+this.perm[A+this.perm[L]]]%12,C=this.perm[S+n+this.perm[A+i+this.perm[L+a]]]%12,H=this.perm[S+o+this.perm[A+s+this.perm[L+l]]]%12,I=this.perm[S+1+this.perm[A+1+this.perm[L+1]]]%12,k=.6-m*m-v*v-g*g,N=.6-y*y-E*E-x*x,O=.6-T*T-b*b-w*w,F=.6-_*_-R*R-M*M;return 32*((k<0?0:(k*=k)*k*this.dot3(this.grad3[P],m,v,g))+(N<0?0:(N*=N)*N*this.dot3(this.grad3[C],y,E,x))+(O<0?0:(O*=O)*O*this.dot3(this.grad3[H],T,b,w))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[I],_,R,M)))},THREE.SimplexNoise.prototype.noise4d=function(e,t,r,n){var i,a,o,s,l,c,u,h,d,f,p,m,v=this.grad4,g=this.simplex,y=this.perm,E=(Math.sqrt(5)-1)/4,x=(5-Math.sqrt(5))/20,T=(e+t+r+n)*E,b=Math.floor(e+T),w=Math.floor(t+T),_=Math.floor(r+T),R=Math.floor(n+T),M=(b+w+_+R)*x,S=e-(b-M),A=t-(w-M),L=r-(_-M),P=n-(R-M),C=(S>A?32:0)+(S>L?16:0)+(A>L?8:0)+(S>P?4:0)+(A>P?2:0)+(L>P?1:0),H=S-(i=g[C][0]>=3?1:0)+x,I=A-(a=g[C][1]>=3?1:0)+x,k=L-(o=g[C][2]>=3?1:0)+x,N=P-(s=g[C][3]>=3?1:0)+x,O=S-(l=g[C][0]>=2?1:0)+2*x,F=A-(c=g[C][1]>=2?1:0)+2*x,D=L-(u=g[C][2]>=2?1:0)+2*x,U=P-(h=g[C][3]>=2?1:0)+2*x,z=S-(d=g[C][0]>=1?1:0)+3*x,B=A-(f=g[C][1]>=1?1:0)+3*x,G=L-(p=g[C][2]>=1?1:0)+3*x,V=P-(m=g[C][3]>=1?1:0)+3*x,j=S-1+4*x,W=A-1+4*x,X=L-1+4*x,Y=P-1+4*x,q=255&b,Z=255&w,Q=255&_,K=255&R,J=y[q+y[Z+y[Q+y[K]]]]%32,$=y[q+i+y[Z+a+y[Q+o+y[K+s]]]]%32,ee=y[q+l+y[Z+c+y[Q+u+y[K+h]]]]%32,te=y[q+d+y[Z+f+y[Q+p+y[K+m]]]]%32,re=y[q+1+y[Z+1+y[Q+1+y[K+1]]]]%32,ne=.6-S*S-A*A-L*L-P*P,ie=.6-H*H-I*I-k*k-N*N,ae=.6-O*O-F*F-D*D-U*U,oe=.6-z*z-B*B-G*G-V*V,se=.6-j*j-W*W-X*X-Y*Y;return 27*((ne<0?0:(ne*=ne)*ne*this.dot4(v[J],S,A,L,P))+(ie<0?0:(ie*=ie)*ie*this.dot4(v[$],H,I,k,N))+(ae<0?0:(ae*=ae)*ae*this.dot4(v[ee],O,F,D,U))+(oe<0?0:(oe*=oe)*oe*this.dot4(v[te],z,B,G,V))+(se<0?0:(se*=se)*se*this.dot4(v[re],j,W,X,Y)))}},function(e,t){THREE.SimplifyModifier=function(){},function(){var e=new THREE.Vector3,t=new THREE.Vector3;function r(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}function n(e,t){var r,n,i,a=t.position.distanceTo(e.position),o=0,s=[],l=e.faces.length;for(r=0;r<l;r++)(n=e.faces[r]).hasVertex(t)&&s.push(n);for(r=0;r<l;r++){var c=1;n=e.faces[r];for(var u=0;u<s.length;u++){i=s[u];var h=n.normal.dot(i.normal);c=Math.min(c,(1.001-h)/2)}o=Math.max(o,c)}return s.length<2&&(o=1),a*o+0}function i(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var r=n(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=r,e.minCost=r,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=r,r<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=r)}e.collapseCost=e.totalCost/e.costCount}function a(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){r(e.neighbors.pop().neighbors,e)}r(t,e)}function o(e,t){r(t,e),e.v1&&r(e.v1.faces,e),e.v2&&r(e.v2.faces,e),e.v3&&r(e.v3.faces,e);for(var n,i,a=[e.v1,e.v2,e.v3],o=0;o<3;o++)i=a[(o+1)%3],(n=a[o])&&i&&(n.removeIfNonNeighbor(i),i.removeIfNonNeighbor(n))}function s(e,t,r,n){if(n){var s,l=[];for(s=0;s<r.neighbors.length;s++)l.push(r.neighbors[s]);for(s=r.faces.length-1;s>=0;s--)r.faces[s].hasVertex(n)&&o(r.faces[s],t);for(s=r.faces.length-1;s>=0;s--)r.faces[s].replaceVertex(r,n);for(a(r,e),s=0;s<l.length;s++)i(l[s])}else a(r,e)}function l(e){for(var t=e[0],r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t}function c(e,t,r,n,i,a){this.a=n,this.b=i,this.c=a,this.v1=e,this.v2=t,this.v3=r,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}function u(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}c.prototype.computeNormal=function(){var r=this.v1.position,n=this.v2.position,i=this.v3.position;e.subVectors(i,n),t.subVectors(r,n),e.cross(t).normalize(),this.normal.copy(e)},c.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},c.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),r(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},u.prototype.addUniqueNeighbor=function(e){var t,r;t=this.neighbors,r=e,-1===t.indexOf(r)&&t.push(r)},u.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,r=this.faces,n=t.indexOf(e);if(-1!==n){for(var i=0;i<r.length;i++)if(r[i].hasVertex(e))return;t.splice(n,1)}},THREE.SimplifyModifier.prototype.modify=function(e,t){e.isBufferGeometry&&(e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var r,n,a,o=e.vertices,h=e.faces,d=[],f=[];for(r=0,n=o.length;r<n;r++){var p=new u(o[r],r);d.push(p)}for(r=0,n=h.length;r<n;r++){var m=(w=h[r]).a,v=w.b,g=w.c,y=new c(d[m],d[v],d[g],m,v,g);f.push(y)}for(r=0,n=d.length;r<n;r++)i(d[r]);for(var E=t;E--;){if(!(a=l(d))){console.log("THREE.SimplifyModifier: No next vertex");break}s(d,f,a,a.collapseNeighbor)}var x=new THREE.BufferGeometry,T=[],b=[];for(r=0;r<d.length;r++){p=d[r].position;T.push(p.x,p.y,p.z)}for(r=0;r<f.length;r++){var w=f[r];m=d.indexOf(w.v1),v=d.indexOf(w.v2),g=d.indexOf(w.v3);b.push(m,v,g)}return x.setAttribute("position",new THREE.Float32BufferAttribute(T,3)),x.setIndex(b),x}}()},function(e,t){THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){(e=e.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(e):e.clone()).mergeVertices();for(var t=this.subdivisions;t-- >0;)this.smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e},function(){var e=["a","b","c"];function t(e,t,r){return r[Math.min(e,t)+"_"+Math.max(e,t)]}function r(e,t,r,n,i,a){var o,s=Math.min(e,t),l=Math.max(e,t),c=s+"_"+l;c in n?o=n[c]:(o={a:r[s],b:r[l],newEdge:null,faces:[]},n[c]=o);o.faces.push(i),a[e].edges.push(o),a[t].edges.push(o)}function n(e,t,r,n,i){e.push(new THREE.Face3(t,r,n,void 0,void 0,i))}function i(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function a(e,t,r,n){e.push([t.clone(),r.clone(),n.clone()])}THREE.SubdivisionModifier.prototype.smooth=function(o){var s,l,c,u,h,d,f,p,m,v,g,y,E,x=new THREE.Vector3,T=[];s=o.vertices,l=o.faces;var b,w,_,R,M,S,A,L,P,C,H,I,k,N,O=void 0!==(c=o.faceVertexUvs)[0]&&c[0].length>0;if(O)for(var F=0;F<c.length;F++)T.push([]);for(f in function(e,t,n,i){var a,o,s;for(a=0,o=e.length;a<o;a++)n[a]={edges:[]};for(a=0,o=t.length;a<o;a++)r((s=t[a]).a,s.b,e,i,s,n),r(s.b,s.c,e,i,s,n),r(s.c,s.a,e,i,s,n)}(s,l,v=new Array(s.length),g={}),y=[],g){for(w=g[f],_=new THREE.Vector3,M=3/8,S=1/8,2!=(A=w.faces.length)&&(M=.5,S=0),_.addVectors(w.a,w.b).multiplyScalar(M),x.set(0,0,0),F=0;F<A;F++){for(R=w.faces[F],m=0;m<3&&((b=s[R[e[m]]])===w.a||b===w.b);m++);x.add(b)}x.multiplyScalar(S),_.add(x),w.newEdge=y.length,y.push(_)}for(E=[],f=0,p=s.length;f<p;f++){for(k=s[f],3==(d=(I=v[f].edges).length)?L=3/16:d>3&&(L=3/(8*d)),P=1-d*L,C=L,d<=2&&2==d&&(P=.75,C=1/8),N=k.clone().multiplyScalar(P),x.set(0,0,0),F=0;F<d;F++)b=(H=I[F]).a!==k?H.a:H.b,x.add(b);x.multiplyScalar(C),N.add(x),E.push(N)}u=E.concat(y);var D,U,z,B,G,V,j,W=E.length;h=[];var X=new THREE.Vector2,Y=new THREE.Vector2,q=new THREE.Vector2;for(f=0,p=l.length;f<p;f++)if(n(h,D=t((R=l[f]).a,R.b,g).newEdge+W,U=t(R.b,R.c,g).newEdge+W,z=t(R.c,R.a,g).newEdge+W,R.materialIndex),n(h,R.a,D,z,R.materialIndex),n(h,R.b,U,D,R.materialIndex),n(h,R.c,z,U,R.materialIndex),O)for(F=0;F<c.length;F++)G=(B=c[F][f])[0],V=B[1],j=B[2],X.set(i(G.x,V.x),i(G.y,V.y)),Y.set(i(V.x,j.x),i(V.y,j.y)),q.set(i(G.x,j.x),i(G.y,j.y)),a(T[F],X,Y,q),a(T[F],G,X,q),a(T[F],V,Y,X),a(T[F],j,q,Y);o.vertices=u,o.faces=h,O&&(o.faceVertexUvs=T)}}()},function(e,t){THREE.LegacyJSONLoader=function(){function e(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.withCredentials=!1}return Object.assign(e.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setWithCredentials(this.withCredentials),o.load(e,function(r){var n=JSON.parse(r),o=n.metadata;if(void 0!==o){var s=o.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(n,a);t(l.geometry,l.materials)},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var r=new THREE.Geometry;return function(e,t){function r(e,t){return e&1<<t}var n,i,a,o,s,l,c,u,h,d,f,p,m,v,g,y,E,x,T,b,w,_,R,M,S,A,L,P=e.faces,C=e.vertices,H=e.normals,I=e.colors,k=e.scale,N=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&N++;for(n=0;n<N;n++)t.faceVertexUvs[n]=[]}for(o=0,s=C.length;o<s;)(x=new THREE.Vector3).x=C[o++]*k,x.y=C[o++]*k,x.z=C[o++]*k,t.vertices.push(x);for(o=0,s=P.length;o<s;)if(f=r(d=P[o++],0),p=r(d,1),m=r(d,3),v=r(d,4),g=r(d,5),y=r(d,6),E=r(d,7),f){if((b=new THREE.Face3).a=P[o],b.b=P[o+1],b.c=P[o+3],(w=new THREE.Face3).a=P[o+1],w.b=P[o+2],w.c=P[o+3],o+=4,p&&(h=P[o++],b.materialIndex=h,w.materialIndex=h),a=t.faces.length,m)for(n=0;n<N;n++)for(M=e.uvs[n],t.faceVertexUvs[n][a]=[],t.faceVertexUvs[n][a+1]=[],i=0;i<4;i++)A=M[2*(u=P[o++])],L=M[2*u+1],S=new THREE.Vector2(A,L),2!==i&&t.faceVertexUvs[n][a].push(S),0!==i&&t.faceVertexUvs[n][a+1].push(S);if(v&&(c=3*P[o++],b.normal.set(H[c++],H[c++],H[c]),w.normal.copy(b.normal)),g)for(n=0;n<4;n++)c=3*P[o++],R=new THREE.Vector3(H[c++],H[c++],H[c]),2!==n&&b.vertexNormals.push(R),0!==n&&w.vertexNormals.push(R);if(y&&(_=I[l=P[o++]],b.color.setHex(_),w.color.setHex(_)),E)for(n=0;n<4;n++)_=I[l=P[o++]],2!==n&&b.vertexColors.push(new THREE.Color(_)),0!==n&&w.vertexColors.push(new THREE.Color(_));t.faces.push(b),t.faces.push(w)}else{if((T=new THREE.Face3).a=P[o++],T.b=P[o++],T.c=P[o++],p&&(h=P[o++],T.materialIndex=h),a=t.faces.length,m)for(n=0;n<N;n++)for(M=e.uvs[n],t.faceVertexUvs[n][a]=[],i=0;i<3;i++)A=M[2*(u=P[o++])],L=M[2*u+1],S=new THREE.Vector2(A,L),t.faceVertexUvs[n][a].push(S);if(v&&(c=3*P[o++],T.normal.set(H[c++],H[c++],H[c])),g)for(n=0;n<3;n++)c=3*P[o++],R=new THREE.Vector3(H[c++],H[c++],H[c]),T.vertexNormals.push(R);if(y&&(l=P[o++],T.color.setHex(I[l])),E)for(n=0;n<3;n++)l=P[o++],T.vertexColors.push(new THREE.Color(I[l]));t.faces.push(T)}}(e,r),function(e,t){var r=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,i=e.skinWeights.length;n<i;n+=r){var a=e.skinWeights[n],o=r>1?e.skinWeights[n+1]:0,s=r>2?e.skinWeights[n+2]:0,l=r>3?e.skinWeights[n+3]:0;t.skinWeights.push(new THREE.Vector4(a,o,s,l))}if(e.skinIndices)for(n=0,i=e.skinIndices.length;n<i;n+=r){var c=e.skinIndices[n],u=r>1?e.skinIndices[n+1]:0,h=r>2?e.skinIndices[n+2]:0,d=r>3?e.skinIndices[n+3]:0;t.skinIndices.push(new THREE.Vector4(c,u,h,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,r),function(e,t){var r=e.scale;if(void 0!==e.morphTargets)for(var n=0,i=e.morphTargets.length;n<i;n++){t.morphTargets[n]={},t.morphTargets[n].name=e.morphTargets[n].name,t.morphTargets[n].vertices=[];for(var a=t.morphTargets[n].vertices,o=e.morphTargets[n].vertices,s=0,l=o.length;s<l;s+=3){var c=new THREE.Vector3;c.x=o[s]*r,c.y=o[s+1]*r,c.z=o[s+2]*r,a.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=t.faces,h=e.morphColors[0].colors;for(n=0,i=u.length;n<i;n++)u[n].color.fromArray(h,3*n)}}(e,r),function(e,t){var r=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var i=0;i<n.length;i++){var a=THREE.AnimationClip.parseAnimation(n[i],t.bones);a&&r.push(a)}if(t.morphTargets){var o=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);r=r.concat(o)}r.length>0&&(t.animations=r)}(e,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:r}:{geometry:r,materials:THREE.Loader.prototype.initMaterials(e.materials,this.resourcePath||t,this.crossOrigin)}}}),e}()},function(e,t){THREE.LensFlare=function(){THREE.Group.call(this),this.type="LensFlare",this.positionScreen=new THREE.Vector3,this.flareVisible=!1;var e=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.needsUpdate=!0;var t=new THREE.DataTexture(new Uint8Array(1024),16,16,THREE.RGBAFormat);t.minFilter=THREE.NearestFilter,t.magFilter=THREE.NearestFilter,t.needsUpdate=!0;var r=THREE.LensFlare.Shader,n=new THREE.RawShaderMaterial({uniforms:r.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,depthWrite:!1}),i=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),n);i.frustumCulled=!1;var a=new THREE.Vector2,o=new THREE.Vector2,s=new THREE.Box2,l=0;this.update=function(r,n,u){if(r instanceof THREE.WebGLRenderer){var h=r.info.render.frame;if(l!==h){l=h;var d=u.w/u.z,f=.5*u.z,p=.5*u.w,m=16/u.w;a.set(m*d,m),s.min.set(u.x,u.y),s.max.set(u.x+(u.z-16),u.y+(u.w-16)),this.positionScreen.setFromMatrixPosition(this.matrixWorld),this.positionScreen.applyMatrix4(n.matrixWorldInverse),this.positionScreen.applyMatrix4(n.projectionMatrix),o.x=u.x+this.positionScreen.x*f+f-8,o.y=u.y+this.positionScreen.y*p+p-8,!0===s.containsPoint(o)?(this.flareVisible=!0,r.copyFramebufferToTexture(o,e),i.material.uniforms.renderType.value=0,i.material.uniforms.scale.value=a,i.material.uniforms.screenPosition.value=this.positionScreen,i.material.depthTest=!0,r.render(i,n),r.copyFramebufferToTexture(o,t),i.material.uniforms.renderType.value=1,i.material.uniforms.map.value=e,i.material.depthTest=!1,r.render(i,n),function(){for(var e=2*-c.positionScreen.x,t=2*-c.positionScreen.y,r=0,n=c.children.length;r<n;r++){var i=c.children[r];i.flarePosition.x=c.positionScreen.x+e*i.flareDistance,i.flarePosition.y=c.positionScreen.y+t*i.flareDistance}}()):this.flareVisible=!1}}};var c=this;this.getOcclusionMap=function(){return t},this.dispose=function(){i.material.dispose(),e.dispose(),t.dispose()}},THREE.LensFlare.prototype=Object.create(THREE.Group.prototype),THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.isLensFlare=!0,THREE.LensFlare.Shader={uniforms:{renderType:{value:0},map:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform lowp int renderType;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tif ( renderType == 0 ) {","\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","\t} else {","\t\tgl_FragColor = texture2D( map, vUV );","\t}","}"].join("\n")},THREE.LensFlareElement=function(e,t,r,n,i,a){THREE.Mesh.call(this),this.type="LensFlareElement",this.frustumCulled=!1,this.renderOrder=1/0,this.flareTexture=e,this.flareSize=t||1,this.flareDistance=r||0,this.flareBlending=i||THREE.AdditiveBlending,this.flareColor=n||new THREE.Color(16777215),this.flareOpacity=a||1,this.flarePosition=new THREE.Vector3,this.flareRotation=0,this.geometry=new THREE.PlaneBufferGeometry(2,2);var o=THREE.LensFlareElement.Shader;this.material=new THREE.RawShaderMaterial({uniforms:o.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:this.flareBlending,transparent:!0,depthWrite:!1});var s=new THREE.Vector2,l=new THREE.Vector4;this.onBeforeRender=function(e,t,r,n,i,a){var o=this.parent;if(null!==o){e.getCurrentViewport(l),o.update(e,r,l);var c=this.flareSize/l.w,u=l.w/l.z;s.set(c*u,c),this.material.uniforms.map.value=this.flareTexture,this.material.uniforms.occlusionMap.value=o.getOcclusionMap(),this.material.uniforms.opacity.value=this.flareOpacity,this.material.uniforms.color.value=this.flareColor,this.material.uniforms.scale.value=s,this.material.uniforms.rotation.value=this.flareRotation,this.material.uniforms.screenPosition.value=this.flarePosition,!1===o.flareVisible&&(this.material.uniforms.opacity.value=0)}else console.error("THREE.LensFlareElement: LensFlareElement not assigned to a LensFlare. Rendering not possible.")},this.dispose=function(){this.material.dispose()}},THREE.LensFlareElement.prototype=Object.create(THREE.Mesh.prototype),THREE.LensFlareElement.prototype.constructor=THREE.LensFlareElement,THREE.LensFlareElement.prototype.isLensFlareElement=!0,THREE.LensFlareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},opacity:{value:1},color:{value:null},scale:{value:null},rotation:{value:0},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );"," visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tvVisibility *= 1.0 - visibility.a / 9.0;","\tpos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","\tpos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= opacity * vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")}},function(e,t){THREE.PhysicsRenderer=function(e,t,r){this.checkCompatibility(r),this.renderer=r,this.size=e||128,this.resolution=new THREE.Vector2(this.size,this.size),this.rt_1=new THREE.WebGLRenderTarget(this.size,this.size,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType,stencilBuffer:!1}),this.rt_2=this.rt_1.clone(),this.rt_3=this.rt_1.clone(),this.counter=0,this.texturePass=this.createTexturePassProgram(),this.simulatePass=this.createSimulatePassProgram(t),this.boundTextures=[],this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2)),this.scene.add(this.mesh)},THREE.PhysicsRenderer.prototype.checkCompatibility=function(e){var t=e.getContext();null!==t.getExtension("OES_texture_float")?0!==t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)||this.onError("Vertex Shader Textures don't work"):this.onError("No Float Textures")},THREE.PhysicsRenderer.prototype.onError=function(e){console.log(e)},THREE.PhysicsRenderer.prototype.createDebugScene=function(){var e=new THREE.Object3D;e.position.z=0;var t,r=new THREE.PlaneBufferGeometry(100,100);return(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_1}))).position.set(-105,0,0),e.add(t),(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_2}))).position.set(0,0,0),e.add(t),(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_3}))).position.set(105,0,0),e.add(t),e},THREE.PhysicsRenderer.prototype.removeDebugScene=function(e){e.remove(this.debugScene)},THREE.PhysicsRenderer.prototype.addDebugScene=function(e){e.add(this.debugScene)},THREE.PhysicsRenderer.prototype.createTexturePassProgram=function(){return new THREE.ShaderMaterial({uniforms:{texture:{type:"t",value:null}},vertexShader:this.VSPass,fragmentShader:this.FSPass})},THREE.PhysicsRenderer.prototype.createSimulatePassProgram=function(e){var t={t_oPos:{type:"t",value:null},t_pos:{type:"t",value:null},resolution:{type:"v2",value:this.resolution}};return new THREE.ShaderMaterial({uniforms:t,vertexShader:this.VSPass,fragmentShader:e})},THREE.PhysicsRenderer.prototype.update=function(){var e=this.counter%3;0==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_1.texture,this.simulatePass.uniforms.t_pos.value=this.rt_2.texture,this.pass(this.simulatePass,this.rt_3),this.ooOutput=this.rt_1.texture,this.oOutput=this.rt_2.texture,this.output=this.rt_3.texture):1==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_2.texture,this.simulatePass.uniforms.t_pos.value=this.rt_3.texture,this.pass(this.simulatePass,this.rt_1),this.ooOutput=this.rt_2.texture,this.oOutput=this.rt_3.texture,this.output=this.rt_1.texture):2==e&&(this.simulatePass.uniforms.t_oPos.value=this.rt_3.texture,this.simulatePass.uniforms.t_pos.value=this.rt_1.texture,this.pass(this.simulatePass,this.rt_2),this.ooOutput=this.rt_3.texture,this.oOutput=this.rt_1.texture,this.output=this.rt_2.texture),this.counter++,this.bindTextures()},THREE.PhysicsRenderer.prototype.render=function(e,t,r){this.renderer.setRenderTarget(r),this.renderer.render(e,t)},THREE.PhysicsRenderer.prototype.pass=function(e,t){this.mesh.material=e,this.renderer.setRenderTarget(t),this.renderer.render(this.scene,this.camera)},THREE.PhysicsRenderer.prototype.out=function(e){this.mesh.material=e.material,this.renderer.render(this.scene,this.camera)},THREE.PhysicsRenderer.prototype.setUniforms=function(e){for(var t in e)this.simulatePass.uniforms[t]=e[t];this.simulatePass.uniforms.t_pos={type:"t",value:null},this.simulatePass.uniforms.t_oPos={type:"t",value:null},this.simulatePass.uniforms.resolution={type:"v2",value:this.resolution}},THREE.PhysicsRenderer.prototype.setUniform=function(e,t){this.simulatePass.uniforms[e]=t},THREE.PhysicsRenderer.prototype.reset=function(e){this.texture=e,this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,this.rt_1),this.pass(this.texturePass,this.rt_2),this.pass(this.texturePass,this.rt_3)},THREE.PhysicsRenderer.prototype.passTexture=function(e,t){this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,t)},THREE.PhysicsRenderer.prototype.resetRand=function(e,t,r,n){e=e||100,t=t||0,r=r||0,n=n||0;for(var i=new Float32Array(this.size*this.size*4),a=0;a<i.length;a+=4)i[a+0]=t+(Math.random()-.5)*e,i[a+1]=r+(Math.random()-.5)*e,i[a+2]=n+(Math.random()-.5)*e,i[a+3]=100;var o=new THREE.DataTexture(i,this.size,this.size,THREE.RGBAFormat,THREE.FloatType);o.minFilter=THREE.NearestFilter,o.magFilter=THREE.NearestFilter,o.needsUpdate=!0,this.reset(o)},THREE.PhysicsRenderer.prototype.addBoundTexture=function(e,t){this.boundTextures.push([e,t])},THREE.PhysicsRenderer.prototype.bindTextures=function(){for(var e=0;e<this.boundTextures.length;e++){var t=this.boundTextures[e][0],r=this.boundTextures[e][1];t.value=this[r]}},THREE.PhysicsRenderer.prototype.VSPass=["varying vec2 vUv;","void main() {","  vUv = uv;","  gl_Position = vec4( position, 1.0 );","}"].join("\n"),THREE.PhysicsRenderer.prototype.FSPass=["uniform sampler2D texture;","varying vec2 vUv;","void main() {","  vec4 c = texture2D( texture , vUv );","  gl_FragColor = c;","}"].join("\n")},function(e,t){THREE.MirrorRenderer=function(e,t,r,n){function i(e,t){return void 0!==e?e:t}THREE.Object3D.call(this),this.name="mirror_"+this.id,n=n||{},this.matrixNeedsUpdate=!0;var a=i(n.textureWidth,512),o=i(n.textureHeight,512);this.clipBias=i(n.clipBias,0),this.renderer=e,this.scene=r,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,-1),this.clipPlane=new THREE.Vector4,t instanceof THREE.PerspectiveCamera?this.camera=t:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.mesh=new THREE.Object3D,this.texture=new THREE.WebGLRenderTarget(a,o),this.tempTexture=new THREE.WebGLRenderTarget(a,o),THREE.Math.isPowerOfTwo(a)&&THREE.Math.isPowerOfTwo(o)||(this.texture.texture.generateMipmaps=!1,this.tempTexture.texture.generateMipmaps=!1),this.updateTextureMatrix(),this.render()},THREE.MirrorRenderer.prototype=Object.create(THREE.Object3D.prototype),THREE.MirrorRenderer.prototype.renderWithMirror=function(e){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var t=e.camera;e.camera=this.mirrorCamera,e.render(!0),e.material.uniforms.mirrorSampler.value=e.tempTexture.texture,this.render(),this.matrixNeedsUpdate=!0,e.material.uniforms.mirrorSampler.value=e.texture.texture,e.camera=t,e.updateTextureMatrix()},THREE.MirrorRenderer.prototype.updateTextureMatrix=function(){function e(e){return e?e<0?-1:1:0}null!=this.parent&&(this.mesh=this.parent),this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal=new THREE.Vector3(0,1,0).applyEuler(this.mesh.rotation);var t=new THREE.Vector3(0,0,1).applyEuler(this.camera.rotation);if(this.normal.dot(t)<0){var r=new THREE.Vector3(0,0,1).applyEuler(this.mesh.rotation);this.normal.reflect(r)}var n=this.mesh.position.clone().sub(this.cameraWorldPosition);n.reflect(this.normal).negate(),n.add(this.mesh.position),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var i=this.mesh.position.clone().sub(this.lookAtPosition);i.reflect(this.normal).negate(),i.add(this.mesh.position),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(n),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(i),this.mirrorCamera.aspect=this.camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mesh.position),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var a=new THREE.Vector4,o=this.mirrorCamera.projectionMatrix;a.x=(e(this.clipPlane.x)+o.elements[8])/o.elements[0],a.y=(e(this.clipPlane.y)+o.elements[9])/o.elements[5],a.z=-1,a.w=(1+o.elements[10])/o.elements[14];var s=new THREE.Vector4;s=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(a)),o.elements[2]=s.x,o.elements[6]=s.y,o.elements[10]=s.z+1-this.clipBias,o.elements[14]=s.w;var l=new THREE.Vector3;l.setFromMatrixPosition(this.camera.matrixWorld),this.eye=l},THREE.MirrorRenderer.prototype.render=function(e){if(this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0,void 0!==this.scene&&this.scene instanceof THREE.Scene){var t=void 0!==e&&e?this.tempTexture:this.texture;this.renderer.setRenderTarget(t),this.renderer.clear(),this.renderer.render(this.scene,this.mirrorCamera)}}},function(e,t){THREE.ShaderLib.ocean_sim_vertex={vertexShader:["varying vec2 vUV;","void main (void) {","vUV = position.xy * 0.5 + 0.5;","gl_Position = vec4(position, 1.0);","}"].join("\n")},THREE.ShaderLib.ocean_subtransform={uniforms:{u_input:{value:null},u_transformSize:{value:512},u_subtransformSize:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","uniform sampler2D u_input;","uniform float u_transformSize;","uniform float u_subtransformSize;","varying vec2 vUV;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","void main (void) {","#ifdef HORIZONTAL","float index = vUV.x * u_transformSize - 0.5;","#else","float index = vUV.y * u_transformSize - 0.5;","#endif","float evenIndex = floor(index / u_subtransformSize) * (u_subtransformSize * 0.5) + mod(index, u_subtransformSize * 0.5);","#ifdef HORIZONTAL","vec4 even = texture2D(u_input, vec2(evenIndex + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(evenIndex + u_transformSize * 0.5 + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","#else","vec4 even = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + 0.5) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + u_transformSize * 0.5 + 0.5) / u_transformSize).rgba;","#endif","float twiddleArgument = -2.0 * PI * (index / u_subtransformSize);","vec2 twiddle = vec2(cos(twiddleArgument), sin(twiddleArgument));","vec2 outputA = even.xy + multiplyComplex(twiddle, odd.xy);","vec2 outputB = even.zw + multiplyComplex(twiddle, odd.zw);","gl_FragColor = vec4(outputA, outputB);","}"].join("\n")},THREE.ShaderLib.ocean_initial_spectrum={uniforms:{u_wind:{value:new THREE.Vector2(10,10)},u_resolution:{value:512},u_size:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","const float CM = 0.23;","uniform vec2 u_wind;","uniform float u_resolution;","uniform float u_size;","float square (float x) {","return x * x;","}","float omega (float k) {","return sqrt(G * k * (1.0 + square(k / KM)));","}","float tanh_ (float x) {","return (1.0 - exp(-2.0 * x)) / (1.0 + exp(-2.0 * x));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 K = (2.0 * PI * vec2(n, m)) / u_size;","float k = length(K);","float l_wind = length(u_wind);","float Omega = 0.84;","float kp = G * square(Omega / l_wind);","float c = omega(k) / k;","float cp = omega(kp) / kp;","float Lpm = exp(-1.25 * square(kp / k));","float gamma = 1.7;","float sigma = 0.08 * (1.0 + 4.0 * pow(Omega, -3.0));","float Gamma = exp(-square(sqrt(k / kp) - 1.0) / 2.0 * square(sigma));","float Jp = pow(gamma, Gamma);","float Fp = Lpm * Jp * exp(-Omega / sqrt(10.0) * (sqrt(k / kp) - 1.0));","float alphap = 0.006 * sqrt(Omega);","float Bl = 0.5 * alphap * cp / c * Fp;","float z0 = 0.000037 * square(l_wind) / G * pow(l_wind / cp, 0.9);","float uStar = 0.41 * l_wind / log(10.0 / z0);","float alpham = 0.01 * ((uStar < CM) ? (1.0 + log(uStar / CM)) : (1.0 + 3.0 * log(uStar / CM)));","float Fm = exp(-0.25 * square(k / KM - 1.0));","float Bh = 0.5 * alpham * CM / c * Fm * Lpm;","float a0 = log(2.0) / 4.0;","float am = 0.13 * uStar / CM;","float Delta = tanh_(a0 + 4.0 * pow(c / cp, 2.5) + am * pow(CM / c, 2.5));","float cosPhi = dot(normalize(u_wind), normalize(K));","float S = (1.0 / (2.0 * PI)) * pow(k, -4.0) * (Bl + Bh) * (1.0 + Delta * (2.0 * cosPhi * cosPhi - 1.0));","float dk = 2.0 * PI / u_size;","float h = sqrt(S / 2.0) * dk;","if (K.x == 0.0 && K.y == 0.0) {","h = 0.0;","}","gl_FragColor = vec4(h, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_phase={uniforms:{u_phases:{value:null},u_deltaTime:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform sampler2D u_phases;","uniform float u_deltaTime;","uniform float u_resolution;","uniform float u_size;","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","float deltaTime = 1.0 / 60.0;","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","float deltaPhase = omega(length(waveVector)) * u_deltaTime;","phase = mod(phase + deltaPhase, 2.0 * PI);","gl_FragColor = vec4(phase, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_spectrum={uniforms:{u_size:{value:null},u_resolution:{value:null},u_choppiness:{value:null},u_phases:{value:null},u_initialSpectrum:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform float u_size;","uniform float u_resolution;","uniform float u_choppiness;","uniform sampler2D u_phases;","uniform sampler2D u_initialSpectrum;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","vec2 multiplyByI (vec2 z) {","return vec2(-z[1], z[0]);","}","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","vec2 phaseVector = vec2(cos(phase), sin(phase));","vec2 h0 = texture2D(u_initialSpectrum, vUV).rg;","vec2 h0Star = texture2D(u_initialSpectrum, vec2(1.0 - vUV + 1.0 / u_resolution)).rg;","h0Star.y *= -1.0;","vec2 h = multiplyComplex(h0, phaseVector) + multiplyComplex(h0Star, vec2(phaseVector.x, -phaseVector.y));","vec2 hX = -multiplyByI(h * (waveVector.x / length(waveVector))) * u_choppiness;","vec2 hZ = -multiplyByI(h * (waveVector.y / length(waveVector))) * u_choppiness;","if (waveVector.x == 0.0 && waveVector.y == 0.0) {","h = vec2(0.0);","hX = vec2(0.0);","hZ = vec2(0.0);","}","gl_FragColor = vec4(hX + multiplyByI(h), hZ);","}"].join("\n")},THREE.ShaderLib.ocean_normals={uniforms:{u_displacementMap:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","varying vec2 vUV;","uniform sampler2D u_displacementMap;","uniform float u_resolution;","uniform float u_size;","void main (void) {","float texel = 1.0 / u_resolution;","float texelSize = u_size / u_resolution;","vec3 center = texture2D(u_displacementMap, vUV).rgb;","vec3 right = vec3(texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(texel, 0.0)).rgb - center;","vec3 left = vec3(-texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(-texel, 0.0)).rgb - center;","vec3 top = vec3(0.0, 0.0, -texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, -texel)).rgb - center;","vec3 bottom = vec3(0.0, 0.0, texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, texel)).rgb - center;","vec3 topRight = cross(right, top);","vec3 topLeft = cross(top, left);","vec3 bottomLeft = cross(left, bottom);","vec3 bottomRight = cross(bottom, right);","gl_FragColor = vec4(normalize(topRight + topLeft + bottomLeft + bottomRight), 1.0);","}"].join("\n")},THREE.ShaderChunk.screenplane_pars_vertex=["const float infinite = 150000.0;","const float screenScale = 1.2;","const vec3 groundNormal = vec3( 0.0, 1.0, 0.0 );","varying vec3 vCamPosition;","vec3 interceptPlane( in vec3 source, in vec3 dir, in vec3 normal, float height )","{","\tfloat distance = ( - height - dot( normal, source ) ) / dot( normal, dir );","\tif( distance < 0.0 )","\t\treturn source + dir * distance;","\telse ","\t\treturn - ( vec3( source.x, height, source.z ) + vec3( dir.x, height, dir.z ) * infinite );","}","mat3 getRotation()","{","\treturn mat3( ","\t\tviewMatrix[0].xyz,","\t\tviewMatrix[1].xyz,","\t\tviewMatrix[2].xyz","\t);","}","vec3 getCameraPos( in mat3 rotation )","{","\treturn - viewMatrix[3].xyz * rotation;","}","vec2 getImagePlan()","{","\tfloat focal = projectionMatrix[0].x;","\tfloat aspect = projectionMatrix[1].y;","\treturn vec2( ( uv.x - 0.5 ) * screenScale * aspect, ( uv.y - 0.5 ) * screenScale * focal );","}","vec3 getCamRay( in mat3 rotation, in vec2 screenUV )","{","\treturn vec3( screenUV.x, screenUV.y, projectionMatrix[0].x ) * rotation;","}","vec3 computeProjectedPosition()","{","\tmat3 cameraRotation = getRotation();","\tvec3 camPosition = getCameraPos( cameraRotation );","\tvCamPosition = camPosition;","\tvec2 screenUV = getImagePlan();","\tvec3 ray = getCamRay( cameraRotation, screenUV );","\tvec3 finalPos = interceptPlane( camPosition, ray, groundNormal, -u_groundHeight );","\tfloat distance = length( finalPos );","\tif( distance > infinite )","\t\tfinalPos *= infinite / distance;","\treturn finalPos;","}"].join("\n"),THREE.ShaderChunk.screenplane_vertex=["vec4 screenPlaneWorldPosition = vec4( computeProjectedPosition(), 1.0 );"].join("\n"),THREE.ShaderChunk.screenplane_pars_fragment=["varying vec3 vCamPosition;"].join("\n"),THREE.ShaderChunk.oceanfft_pars_vertex=["uniform sampler2D u_displacementMap;","uniform float u_geometrySize;","uniform float u_size;"].join("\n"),THREE.ShaderChunk.oceanfft_vertex=["vec3 displacement = texture2D( u_displacementMap, worldPosition.xz * 0.002 ).rgb * ( u_geometrySize / u_size );","vec4 oceanfftWorldPosition = worldPosition + vec4( displacement, 0.0 );"].join("\n"),THREE.ShaderLib.ocean_main={uniforms:{u_displacementMap:{value:null},u_reflection:{value:null},u_normalMap:{value:null},u_geometrySize:{value:null},u_size:{value:null},u_mirrorMatrix:{value:null},u_oceanColor:{value:null},u_sunDirection:{value:null},u_exposure:{value:null},u_groundHeight:{value:null}},vertexShader:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vec4 worldPosition = screenPlaneWorldPosition;",THREE.ShaderChunk.oceanfft_vertex,"vWorldPosition = oceanfftWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * oceanfftWorldPosition;","gl_Position = projectionMatrix * viewMatrix * oceanfftWorldPosition;","}"].join("\n"),vertexShaderNoTexLookup:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vWorldPosition = screenPlaneWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * screenPlaneWorldPosition;","gl_Position = projectionMatrix * viewMatrix * screenPlaneWorldPosition;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform sampler2D u_reflection;","uniform sampler2D u_normalMap;","uniform vec3 u_oceanColor;","uniform vec3 u_sunDirection;","uniform float u_exposure;","vec3 hdr (vec3 color, float exposure) {","return 1.0 - exp(-color * exposure);","}",THREE.ShaderChunk.screenplane_pars_fragment,"void main (void) {","vec3 normal = texture2D( u_normalMap, vWorldPosition.xz * 0.002 ).rgb;","vec3 view = normalize( vCamPosition - vWorldPosition );","vec3 reflection = normalize( reflect( -u_sunDirection, normal ) );","float specularFactor = pow( max( 0.0, dot( view, reflection ) ), 500.0 ) * 20.0;","vec3 distortion = 200.0 * normal * vec3( 1.0, 0.0, 0.1 );","vec3 reflectionColor = texture2DProj( u_reflection, vReflectCoordinates.xyz + distortion ).xyz;","float distanceRatio = min( 1.0, log( 1.0 / length( vCamPosition - vWorldPosition ) * 3000.0 + 1.0 ) );","distanceRatio *= distanceRatio;","distanceRatio = distanceRatio * 0.7 + 0.3;","normal = ( distanceRatio * normal + vec3( 0.0, 1.0 - distanceRatio, 0.0 ) ) * 0.5;","normal /= length( normal );","float fresnel = pow( 1.0 - dot( normal, view ), 2.0 );","float skyFactor = ( fresnel + 0.2 ) * 10.0;","vec3 waterColor = ( 1.0 - fresnel ) * u_oceanColor;","vec3 color = ( skyFactor + specularFactor + waterColor ) * reflectionColor + waterColor * 0.5 ;","color = hdr( color, u_exposure );","gl_FragColor = vec4( color, 1.0 );","}"].join("\n")}},function(e,t,r){"use strict";window.ThreeBSP=function(){var e;return(e=function(e){this.matrix=new THREE.Matrix4,this.create(e)}).prototype.subtract=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.invert(),r.clipTo(n),n.clipTo(r),n.invert(),n.clipTo(r),n.invert(),r.build(n.allPolygons()),r.invert(),(r=new e(r)).matrix=this.matrix,r},e.prototype.union=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.clipTo(n),n.clipTo(r),n.invert(),n.clipTo(r),n.invert(),r.build(n.allPolygons()),(r=new e(r)).matrix=this.matrix,r},e.prototype.intersect=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.invert(),n.clipTo(r),n.invert(),r.clipTo(n),n.clipTo(r),r.build(n.allPolygons()),r.invert(),(r=new e(r)).matrix=this.matrix,r},e.prototype.create=function(t){if(t instanceof THREE.Geometry)this.fromGeometry(t);else if(t instanceof THREE.BufferGeometry)this.fromBufferGeometry(t);else{if(!(t instanceof THREE.Mesh)){if(t instanceof e.Node)return this.tree=t,this;throw new Error("ThreeBSP: is unable to create a BSP for the given input")}this.fromMesh(t)}},e.prototype.fromGeometry=function(t){var r,n,i,a,o,s,l,c=[];for(r=0,n=t.faces.length;r<n;r++)i=t.faces[r],o=t.faceVertexUvs[0][r],l=new e.Polygon,a=t.vertices[i.a],s=o?new THREE.Vector2(o[0].x,o[0].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[0],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.b],s=o?new THREE.Vector2(o[1].x,o[1].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[1],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.c],s=o?new THREE.Vector2(o[2].x,o[2].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[2],s)).applyMatrix4(this.matrix),l.vertices.push(a),l.calculateProperties(),c.push(l);this.tree=new e.Node(c)},e.prototype.fromIndexedBufferGeometry=function(t){var r,n,i,a,o,s,l,c,u,h,d,f,p,m=t.index.array,v=t.attributes.position.array,g=t.attributes.normal.array,y=t.attributes.uv.array,E=[];for(r=0,n=m.length;r<n;r+=3){for(o=new e.Polygon,s=0;s<3;s++)c=(l=3*(i=m[r+s]))+1,u=l+2,d=(h=2*i)+1,f=g?new THREE.Vector3(g[l],g[c],g[u]):null,p=y?new THREE.Vector2(y[h],y[d]):null,(a=new e.Vertex(v[l],v[c],v[u],f,p)).applyMatrix4(this.matrix),o.vertices.push(a);o.calculateProperties(),E.push(o)}this.tree=new e.Node(E)},e.prototype.fromNonIndexedBufferGeometry=function(t){var r,n,i,a,o,s,l=t.attributes.position.array,c=t.attributes.normal.array,u=t.attributes.uv.array,h=[];for(r=0,n=l.length;r<n;r+=9)a=new e.Polygon,o=c?new THREE.Vector3(c[r],c[r+1],c[r+2]):null,s=u?new THREE.Vector2(u[r],u[r+1]):null,(i=new e.Vertex(l[r],l[r+1],l[r+2],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=c?new THREE.Vector3(c[r+3],c[r+4],c[r+5]):null,s=u?new THREE.Vector2(u[r+2],u[r+3]):null,(i=new e.Vertex(l[r+3],l[r+4],l[r+5],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=c?new THREE.Vector3(c[r+6],c[r+7],c[r+8]):null,s=u?new THREE.Vector2(u[r+4],u[r+5]):null,(i=new e.Vertex(l[r+6],l[r+7],l[r+8])).applyMatrix4(this.matrix),a.vertices.push(i),a.calculateProperties(),h.push(a);this.tree=new e.Node(h)},e.prototype.fromBufferGeometry=function(e){null===e.index?this.fromNonIndexedBufferGeometry(e):this.fromIndexedBufferGeometry(e)},e.prototype.fromMesh=function(e){var t=e.geometry;e.updateMatrix(),this.matrix=e.matrix.clone(),this.create(t)},e.prototype.toGeometry=function(){var e,t,r,n,i,a,o,s,l,c,u=(new THREE.Matrix4).getInverse(this.matrix),h=new THREE.Geometry,d=this.tree.allPolygons(),f=d.length,p={};for(e=0;e<f;e++)for(n=(r=d[e]).vertices.length,t=2;t<n;t++)c=[],s=r.vertices[0],c.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(u),void 0!==p[s.x+","+s.y+","+s.z]?i=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),i=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=r.vertices[t-1],c.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(u),void 0!==p[s.x+","+s.y+","+s.z]?a=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),a=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=r.vertices[t],c.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(u),void 0!==p[s.x+","+s.y+","+s.z]?o=p[s.x+","+s.y+","+s.z]:(h.vertices.push(s),o=p[s.x+","+s.y+","+s.z]=h.vertices.length-1),l=new THREE.Face3(i,a,o,new THREE.Vector3(r.normal.x,r.normal.y,r.normal.z)),h.faces.push(l),h.faceVertexUvs[0].push(c);return h},e.prototype.toBufferGeometry=function(){var e,t,r,n,i,a,o,s,l=(new THREE.Matrix4).getInverse(this.matrix),c=new THREE.BufferGeometry,u=[],h=[],d=[],f=[],p=this.tree.allPolygons(),m=p.length,v={},g=0;for(e=0;e<m;e++)for(n=(r=p[e]).vertices.length,t=2;t<n;t++)[],(s=r.vertices[0]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==v[s.x+","+s.y+","+s.z]?i=v[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),i=g,d.push(r.normal.x,r.normal.y,r.normal.z),g++),(s=r.vertices[t-1]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==v[s.x+","+s.y+","+s.z]?a=v[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),a=g,d.push(r.normal.x,r.normal.y,r.normal.z),g++),(s=r.vertices[t]).clone().applyMatrix4(l),f.push(s.uv.x,s.uv.y),void 0!==v[s.x+","+s.y+","+s.z]?o=v[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),o=g,d.push(r.normal.x,r.normal.y,r.normal.z),g++),u.push(i,a,o);return c.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(f),2)),c.setAttribute("position",new THREE.BufferAttribute(new Float32Array(h),3)),c.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(d),3)),c.setIndex(new THREE.BufferAttribute(new Uint32Array(u),1)),c},e.prototype.toMesh=function(e){var t=this.toGeometry(),r=new THREE.Mesh(t,e);return r.position.setFromMatrixPosition(this.matrix),r.rotation.setFromRotationMatrix(this.matrix),r},(e.Polygon=function(e,t,r){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=void 0}).prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],r=this.vertices[2];return this.normal=t.clone().subtract(e).cross(r.clone().subtract(e)).normalize(),this.w=this.normal.clone().dot(e),this},e.Polygon.prototype.clone=function(){var t,r,n=new e.Polygon;for(t=0,r=this.vertices.length;t<r;t++)n.vertices.push(this.vertices[t].clone());return n.calculateProperties(),n},e.Polygon.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this},e.Polygon.prototype.classifyVertex=function(e){var t=this.normal.dot(e)-this.w;return t<-1e-5?2:t>1e-5?1:0},e.Polygon.prototype.classifySide=function(e){var t,r,n,i=0,a=0,o=e.vertices.length;for(t=0;t<o;t++)r=e.vertices[t],1===(n=this.classifyVertex(r))?i++:2===n&&a++;return i>0&&0===a?1:0===i&&a>0?2:0===i&&0===a?0:3},e.Polygon.prototype.splitPolygon=function(t,r,n,i,a){var o=this.classifySide(t);if(0===o)(this.normal.dot(t.normal)>0?r:n).push(t);else if(1===o)i.push(t);else if(2===o)a.push(t);else{var s,l,c,u,h,d,f,p,m,v=[],g=[];for(l=0,s=t.vertices.length;l<s;l++)c=(l+1)%s,d=t.vertices[l],f=t.vertices[c],u=this.classifyVertex(d),h=this.classifyVertex(f),2!=u&&v.push(d),1!=u&&g.push(d),3==(u|h)&&(p=(this.w-this.normal.dot(d))/this.normal.dot(f.clone().subtract(d)),m=d.interpolate(f,p),v.push(m),g.push(m));v.length>=3&&i.push(new e.Polygon(v).calculateProperties()),g.length>=3&&a.push(new e.Polygon(g).calculateProperties())}},(e.Vertex=function(e,t,r,n,i){this.x=e,this.y=t,this.z=r,this.normal=n||new THREE.Vector3,this.uv=i||new THREE.Vector2}).prototype.clone=function(){return new e.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())},e.Vertex.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},e.Vertex.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.Vertex.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.Vertex.prototype.cross=function(e){var t=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-r*e.x,this},e.Vertex.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},e.Vertex.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.Vertex.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this},e.Vertex.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},e.Vertex.prototype.applyMatrix4=function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this},(e.Node=function(t){var r,n,i=[],a=[];if(this.polygons=[],this.front=this.back=void 0,t instanceof Array&&0!==t.length){for(this.divider=t[0].clone(),r=0,n=t.length;r<n;r++)this.divider.splitPolygon(t[r],this.polygons,this.polygons,i,a);i.length>0&&(this.front=new e.Node(i)),a.length>0&&(this.back=new e.Node(a))}}).isConvex=function(e){var t,r;for(t=0;t<e.length;t++)for(r=0;r<e.length;r++)if(t!==r&&2!==e[t].classifySide(e[r]))return!1;return!0},e.Node.prototype.build=function(t){var r,n,i=[],a=[];for(this.divider||(this.divider=t[0].clone()),r=0,n=t.length;r<n;r++)this.divider.splitPolygon(t[r],this.polygons,this.polygons,i,a);i.length>0&&(this.front||(this.front=new e.Node),this.front.build(i)),a.length>0&&(this.back||(this.back=new e.Node),this.back.build(a))},e.Node.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.Node.prototype.clone=function(){var t=new e.Node;return t.divider=this.divider.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t},e.Node.prototype.invert=function(){var e,t,r;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),r=this.front,this.front=this.back,this.back=r,this},e.Node.prototype.clipPolygons=function(e){var t,r,n,i;if(!this.divider)return e.slice();for(n=[],i=[],t=0,r=e.length;t<r;t++)this.divider.splitPolygon(e[t],n,i,n,i);return this.front&&(n=this.front.clipPolygons(n)),i=this.back?this.back.clipPolygons(i):[],n.concat(i)},e.Node.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e}()},function(e,t){const r=/\bvoid\s+main\s*\(\s*\)\s*{/g;function n(e){return e.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(e,t){let r=THREE.ShaderChunk[t];return r?n(r):e})}const i=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}return e};let a=0;const o=Date.now(),s=new WeakMap;function l(e,t){return"uniforms"===e?void 0:t}THREE.createDerivedMaterial=function(e,t){const c=function(e){return JSON.stringify(e,l)}(t);let u=s.get(e);if(u||(u=Object.create(null),s.set(e,u)),u[c])return u[c].clone();const h=++a,d=`_derivedShaders${h}`,f=`_onBeforeCompile${h}`;let p,m;function v(a){e.onBeforeCompile.call(this,a);const{vertex:s,fragment:l}=this[d]||(this[d]={vertex:{},fragment:{}});if(s.source!==a.vertexShader||l.source!==a.fragmentShader){const e=function({vertexShader:e,fragmentShader:t},i,a){let{vertexDefs:o,vertexTransform:s,vertexMainIntro:l,fragmentDefs:c,fragmentDiffuseTransform:u,fragmentMainIntro:h,fragmentColorTransform:d,timeUniform:f}=i;if(f){const e=`\nuniform float ${f};\n`;o=(o||"")+e,c=(c||"")+e}(o||s||l)&&(s&&(e=n(e),o=`\n        ${o||""}\n        void vertexTransform_${a}(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n          ${s}\n        }\n      `,e=e.replace(/\b(position|normal|uv)\b/g,(e,t,r,n)=>/\battribute\s+vec3\s+$/.test(n.substr(0,r))?t:`_${t}_${a}`),l=`\n        vec3 _position_${a} = vec3(position);\n        vec3 _normal_${a} = vec3(normal);\n        vec2 _uv_${a} = vec2(uv);\n        vertexTransform_${a}(_position_${a}, _normal_${a}, _uv_${a});\n        ${l||""}\n      `),e=e.replace(r,`${o||""}\n\n$&\n\n${l||""}`));(c||u||h||d)&&(t=n(t),u&&(c=`\n        ${c||""}\n        void fragmentDiffuseTransform_${a}(inout vec3 diffuse) {\n          ${u}\n        }\n      `,t=t.replace(/\b(diffuse)\b/g,(e,t,r,n)=>/\buniform\s+vec3\s+$/.test(n.substr(0,r))?t:`_${t}_${a}`),h=`\n        vec3 _diffuse_${a} = diffuse;\n        fragmentDiffuseTransform_${a}(_diffuse_${a});\n        ${h||""}\n      `),t=t.replace(r,`\n      ${c||""}\n      void threejsMain_${a}() {\n      ${h||""}\n    `),t+=`\n      void main() {\n        threejsMain_${a}();\n        ${d||""}\n      }\n    `);return{vertexShader:e,fragmentShader:t}}(a,t,h);s.source=a.vertexShader,s.result=e.vertexShader,l.source=a.fragmentShader,l.result=e.fragmentShader}a.vertexShader=s.result,a.fragmentShader=l.result,i(a.uniforms,this.uniforms),t.timeUniform&&(a.uniforms[t.timeUniform]={get value(){return Date.now()-o}}),this[f]&&this[f](a)}function g(){e.constructor.apply(this,arguments),this._listeners=void 0}g.prototype=Object.create(e,{constructor:{value:g},isDerivedMaterial:{value:!0},baseMaterial:{value:e},onBeforeCompile:{get:()=>v,set(e){this[f]=e}},copy:{value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(this.extensions=t.extensions,this.defines=i({},t.defines),this.uniforms=THREE.UniformsUtils.clone(t.uniforms)),this}},getDepthMaterial:{value:function(){let r=this._depthMaterial;return r||(m||((m=createDerivedMaterial(e.isDerivedMaterial?e.getDepthMaterial():new THREE.MeshDepthMaterial({depthPacking:THREE.RGBADepthPacking}),t)).defines.IS_DEPTH_MATERIAL=""),r=this._depthMaterial=m.clone()),r}},getDistanceMaterial:{value:function(){let r=this._distanceMaterial;return r||(p||((p=createDerivedMaterial(e.isDerivedMaterial?e.getDistanceMaterial():new THREE.MeshDistanceMaterial,t)).defines.IS_DISTANCE_MATERIAL=""),r=this._distanceMaterial=p.clone()),r}},dispose:{value(){const{_depthMaterial:t,_distanceMaterial:r}=this;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}});const y=new g;return y.copy(e),y.uniforms=i(THREE.UniformsUtils.clone(e.uniforms||{}),t.uniforms),y.defines=i({},e.defines,t.defines),y.defines.DERIVED_MATERIAL=h,y.extensions=i({},e.extensions,t.extensions),u[c]=y,y.clone()};const c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};THREE.getShadersForMaterial=function(e){let t=c[e.type];return t?THREE.ShaderLib[t]:e},THREE.getShaderUniformTypes=function(e){let t,r=/\buniform\s+(int|float|vec[234])\s+([A-Za-z_][\w]*)/g,n=Object.create(null);for(;null!==(t=r.exec(e));)n[t[2]]=t[1];return n}},function(e,t){THREE.OrthographicTrackballControls=function(e,t){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=!0,a=n.NONE,o=n.NONE,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector2,h=new THREE.Vector2,d=0,f=0,p=new THREE.Vector2,m=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var v={type:"change"},g={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var E,x,T,b,w,_,R=(E=new THREE.Vector2,function(e,t){return E.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),E}),M=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(i,a){n.set((i-.5*r.screen.width-r.screen.left)/r.radius,(.5*r.screen.height+r.screen.top-a)/r.radius,0);var o=n.length();return r.noRoll?o<Math.SQRT1_2?n.z=Math.sqrt(1-o*o):n.z=.5/o:o>1?n.normalize():n.z=Math.sqrt(1-o*o),s.copy(r.object.position).sub(r.target),e.copy(r.object.up).setLength(n.y),e.add(t.copy(r.object.up).cross(s).setLength(n.x)),e.add(s.setLength(n.z)),e}}();function S(e){!1!==r.enabled&&(window.removeEventListener("keydown",S),o=a,a===n.NONE&&(e.keyCode!==r.keys[n.ROTATE]||r.noRotate?e.keyCode!==r.keys[n.ZOOM]||r.noZoom?e.keyCode!==r.keys[n.PAN]||r.noPan||(a=n.PAN):a=n.ZOOM:a=n.ROTATE))}function A(e){!1!==r.enabled&&(a=o,window.addEventListener("keydown",S,!1))}function L(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a===n.NONE&&(a=e.button),a!==n.ROTATE||r.noRotate?a!==n.ZOOM||r.noZoom?a!==n.PAN||r.noPan||(p.copy(R(e.pageX,e.pageY)),m.copy(p)):(u.copy(R(e.pageX,e.pageY)),h.copy(u)):(l.copy(M(e.pageX,e.pageY)),c.copy(l)),document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",C,!1),r.dispatchEvent(g))}function P(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a!==n.ROTATE||r.noRotate?a!==n.ZOOM||r.noZoom?a!==n.PAN||r.noPan||m.copy(R(e.pageX,e.pageY)):h.copy(R(e.pageX,e.pageY)):c.copy(M(e.pageX,e.pageY)))}function C(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a=n.NONE,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",C),r.dispatchEvent(y))}function H(e){if(!1!==r.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),u.y+=.01*t,r.dispatchEvent(g),r.dispatchEvent(y)}}function I(e){if(!1!==r.enabled){switch(e.touches.length){case 1:a=n.TOUCH_ROTATE,l.copy(M(e.touches[0].pageX,e.touches[0].pageY)),c.copy(l);break;case 2:a=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;f=d=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;p.copy(R(o,s)),m.copy(p);break;default:a=n.NONE}r.dispatchEvent(g)}}function k(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:c.copy(M(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;f=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;m.copy(R(o,s));break;default:a=n.NONE}}function N(e){if(!1!==r.enabled){switch(e.touches.length){case 1:c.copy(M(e.touches[0].pageX,e.touches[0].pageY)),l.copy(c);break;case 2:d=f=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;m.copy(R(t,i)),p.copy(m)}a=n.NONE,r.dispatchEvent(y)}}function O(e){e.preventDefault()}this.rotateCamera=(x=new THREE.Vector3,T=new THREE.Quaternion,function(){var e=Math.acos(l.dot(c)/l.length()/c.length());e&&(x.crossVectors(l,c).normalize(),e*=r.rotateSpeed,T.setFromAxisAngle(x,-e),s.applyQuaternion(T),r.object.up.applyQuaternion(T),c.applyQuaternion(T),r.staticMoving?l.copy(c):(T.setFromAxisAngle(x,e*(r.dynamicDampingFactor-1)),l.applyQuaternion(T)),i=!0)}),this.zoomCamera=function(){if(a===n.TOUCH_ZOOM_PAN){var e=f/d;d=f,r.object.zoom*=e,i=!0}else{e=1+(h.y-u.y)*r.zoomSpeed;Math.abs(e-1)>1e-6&&e>0&&(r.object.zoom/=e,r.staticMoving?u.copy(h):u.y+=(h.y-u.y)*this.dynamicDampingFactor,i=!0)}},this.panCamera=(b=new THREE.Vector2,w=new THREE.Vector3,_=new THREE.Vector3,function(){if(b.copy(m).sub(p),b.lengthSq()){var e=(r.object.right-r.object.left)/r.object.zoom,t=(r.object.top-r.object.bottom)/r.object.zoom;b.x*=e*r.panSpeed,b.y*=t*r.panSpeed,_.copy(s).cross(r.object.up).setLength(b.x),_.add(w.copy(r.object.up).setLength(b.y)),r.object.position.add(_),r.target.add(_),r.staticMoving?p.copy(m):p.add(b.subVectors(m,p).multiplyScalar(r.dynamicDampingFactor)),i=!0}}),this.update=function(){s.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||(r.zoomCamera(),i&&r.object.updateProjectionMatrix()),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,s),r.object.lookAt(r.target),i&&(r.dispatchEvent(v),i=!1)},this.reset=function(){a=n.NONE,o=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),s.subVectors(r.object.position,r.target),r.object.left=r.left0,r.object.right=r.right0,r.object.top=r.top0,r.object.bottom=r.bottom0,r.object.lookAt(r.target),r.dispatchEvent(v),i=!1},this.disableEvents=function(){this.domElement.removeEventListener("contextmenu",O,!1),this.domElement.removeEventListener("mousedown",L,!1),this.domElement.removeEventListener("wheel",H,!1),this.domElement.removeEventListener("MozMousePixelScroll",H,!1),this.domElement.removeEventListener("touchstart",I,!1),this.domElement.removeEventListener("touchend",N,!1),this.domElement.removeEventListener("touchmove",k,!1),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",C,!1),window.removeEventListener("keydown",S,!1),window.removeEventListener("keyup",A,!1)},this.dispose=this.disableEvents,this.enableEvents=function(){this.domElement.addEventListener("contextmenu",O,!1),this.domElement.addEventListener("mousedown",L,!1),this.domElement.addEventListener("wheel",H,!1),this.domElement.addEventListener("MozMousePixelScroll",H,!1),this.domElement.addEventListener("touchstart",I,!1),this.domElement.addEventListener("touchend",N,!1),this.domElement.addEventListener("touchmove",k,!1),window.addEventListener("keydown",S,!1),window.addEventListener("keyup",A,!1)},this.enableEvents(),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&f())}function f(){if(!u){var e=s(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),1!==c.length||u||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";r.r(t);var n=r(6);window.THREE=n,r(14),r(15),r(16),r(17),r(18),r(19),r(20),r(21),r(22),r(23),r(24),r(25),r(26),r(27),r(28),r(29),r(30),r(31),r(32),r(33),r(34),r(35),r(36),r(41),r(42),r(43),r(44),r(45),r(46),r(47),r(48),r(49),r(50),r(51),r(52),r(53),r(54),r(55),r(56),r(57),r(58),r(59),r(60),r(61),r(62),r(63),r(64),r(65),r(66),r(67),r(68),r(69),r(70),r(71),r(72),r(73),r(74),r(75),r(76),r(77),r(78),r(79),r(80),r(81),r(82),r(83),r(84),r(85),r(86),r(87),r(88),r(89),r(90),r(91),r(92),r(93),r(94),r(95);var i,a,o,s,l,c,u,h,d,f,p,m,v,g,y,E={tabIndices:{viewWorks:"1",gameWorks:"1",natureWorks:"1",sketcher:"4"},zIndices:{viewWorks:"0",natureWorks:"0",sketcher:"2",colorSelector:"3",matcaps:"4"},renderer:null,scene:null,camera:null,appWorks:null,shaders:null,sunLight:null,TEXTURE_MAPS:["map","matcap","alphaMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","specularMap","envMap","lightMap","aoMap","emissiveMap","gradientMap"],WORLD_SIZE:1e3,GRID_SPACING:5,GROUND_HEIGHT:0,WATER_HEIGHT:0,WATER_COLOR:7695,OCEAN_COLOR:139053,FOG_COLOR:14014425,SUN_COLOR:16777215},x=r(9);E.clock=new THREE.Clock,E.getDeltaTime=function(){return E.clock.getDelta()},E.getCurrentTime=function(){return E.clock.getElapsedTime()},E.humanFileSize=function(e,t,r,n,i){return(t=Math,r=t.log,1e3,i=r(e)/r(1e3)|0,e/t.pow(1e3,i)).toFixed(2)+" "+(i?"KMGTPEZY"[--i]+"B":"Bytes")},E.isDeviceMobile=function(){var e=!1;return/Mobi|Android|webOS|Tablet|iPad|iPhone|iPod|Windows Phone|BlackBerry|BB10|Opera Mini/i.test(navigator.userAgent)&&(e=!0),e},E.isDeviceLandscape=function(){return 90===window.orientation||-90===window.orientation},E.isDeviceTouch=function(){return"ontouchend"in window},E.isDeviceWindowsOS=function(){return navigator.platform.toUpperCase().indexOf("WIN32")>=0},E.isDeviceMacOS=function(){return navigator.platform.toUpperCase().indexOf("MAC")>=0},E.isDeviceiOS=function(){return/iPad|iPhone|iPod/g.test(navigator.userAgent)&&!window.MSStream},E.isWebGL1Available=function(){var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))},E.isWebGL2Available=function(){var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))},E.isWebGL1=function(){var e=E.appWorks.renderer.getContext();return void 0!==e&&e instanceof window.WebGLRenderingContext},E.isWebGL2=function(){var e=E.appWorks.renderer.getContext();return void 0!==e&&e instanceof window.WebGL2RenderingContext},E.getWebGLInfo=function(){var e=[],t="WebGL1: "+(E.isWebGL1Available()?"available":"unavailable");e.push(t);var r="WebGL2: "+(E.isWebGL2Available()?"available":"unavailable");e.push(r);var n=E.appWorks.renderer.getContext().getSupportedExtensions();return e=e.concat(n)},E.isWebGLExtensionAvailable=function(e){return E.appWorks.renderer.getContext().getSupportedExtensions().indexOf(e)>=0},Number.prototype.format=function(){return this.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},String.prototype.trunc=function(e,t){if(this.length<=e)return(" "+this).slice(1);var r=this.substr(0,e);return(t?r.substr(0,r.lastIndexOf(" ")+1):r)+"..."},Array.prototype.clone=function(){return this.map(e=>Array.isArray(e)?e.clone():e)},Array.prototype.remove=function(e,t){var r=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,r)},Array.prototype.sum=function(){return this.reduce(function(e,t){return e+Number(t)},0)},Array.prototype.average=function(){return this.sum()/(this.length||1)},Array.prototype.mean=function(){return this.sum()/(this.length||1)},Array.prototype.median=function(){var e=this.slice(0).sort((e,t)=>e-t),t=e.length/2;return t%1?e[t-.5]:(e[t-1]+e[t])/2},Array.prototype.variance=function(){var e=this.mean();return this.map(t=>Math.pow(t-e,2)).mean()},Array.prototype.std=function(){return Math.sqrt(this.variance())},Array.prototype.zscores=function(){var e=this.mean(),t=this.std();return this.map(r=>(r-e)/t)},Array.prototype.range=function(){return this.max()-this.min()},Array.prototype.zero=function(e){for(var t=0;t<e;t++)this[t]=0;return this},Array.prototype.scale=function(e){return this.map(t=>t*e)},Array.prototype.add=function(e){return this.map((t,r)=>t+e[r])},Array.prototype.sub=function(e){return this.map((t,r)=>t-e[r])},Array.prototype.mul=function(e){return this.map((t,r)=>t*e[r])},Array.prototype.div=function(e){return this.map((t,r)=>t/e[r])},Array.prototype.dot=function(e){return this.map((t,r)=>t*e[r]).reduce((e,t)=>e+t)},Array.prototype.norm2=function(){return Math.sqrt(this.map((e,t)=>e*e).reduce((e,t)=>e+t))},Array.prototype.transpose=function(){var e=this;return e[0].map(function(t,r){return e.map(function(e,t){return e[r]})})},Array.prototype.mmul=function(e){return this.map(function(t,r){return e.transpose().map(function(e,r){return t.dot(e)})})},Array.prototype.vmul=function(e){return this.map(function(t,r){return t.dot(e)})},Array.prototype.sortNumbers=function(e){return"ascending"===(e=e||"ascending")?this.sort((e,t)=>e-t):"descending"===e&&this.sort((e,t)=>t-e),this},Array.prototype.minX=function(){return this.reduce((e,t)=>t.x<e?t.x:e,this[0].x)},Array.prototype.maxX=function(){return this.reduce((e,t)=>t.x>e?t.x:e,this[0].x)},Array.prototype.minY=function(){return this.reduce((e,t)=>t.y<e?t.y:e,this[0].y)},Array.prototype.maxY=function(){return this.reduce((e,t)=>t.y>e?t.y:e,this[0].y)},Array.prototype.minZ=function(){return this.reduce((e,t)=>t.z<e?t.z:e,this[0].z)},Array.prototype.maxZ=function(){return this.reduce((e,t)=>t.z>e?t.z:e,this[0].z)},Array.prototype.min=function(){return this.reduce((e,t)=>t<e?t:e,this[0])},Array.prototype.max=function(){return this.reduce((e,t)=>t>e?t:e,this[0])},Array.prototype.householder=function(){function e(e,t=(e=>e)){return Array.from(Array(e),(e,r)=>t(r))}function t(e,t=(e=>e)){return e.reduce((e,r,n)=>e+t(r,n),0)}const r=Math.sqrt(this.length),n=Array.from(this);console.assert(Number.isInteger(r));const i=(e,t)=>t*r+e;for(let a=0;a<r-2;a++){if(Math.abs(n[i(a,a+1)])<Number.EPSILON)continue;const o=e(r,e=>e<=a?0:n[i(a,e)]),s=Math.sign(o[a+1])*Math.hypot(...o);o[a+1]+=s;const l=Math.sqrt(2*s*o[a+1]),c=o.map(e=>e/l),u=e(r,e=>t(c,(t,r)=>t*n[i(r,e)])),h=e(r,e=>t(c,(t,r)=>t*n[i(e,r)])),d=t(u,(e,t)=>e*c[t]),f=t(h,(e,t)=>e*c[t]),p=u.map((e,t)=>2*(e-d*c[t])),m=h.map((e,t)=>2*(e-f*c[t]));for(let e=0;e<r;e++)for(let t=0;t<r;t++)n[i(t,e)]-=c[e]*m[t]+c[t]*p[e]}return n},Array.prototype.qr=function(){function e(e,t=(e=>e)){return e.reduce((e,r,n)=>e+t(r,n),0)}const t=Math.sqrt(this.length),r=Array.from(this);console.assert(Number.isInteger(t));const n=(e,r)=>r*t+e;let i=t;for(;i>=2;){if(Math.abs(r[n(i-2,i-1)])<Number.EPSILON){i--;continue}const t=r[n(i-1,i-1)],a=r[n(i-2,i-1)],o=r[n(i-1,i-2)],s=r[n(i-2,i-2)],l=t*s,c=t*s-a*o,u=Math.sqrt(l*l-4*c)||0,h=(l+u)/2,d=(l-u)/2,f=t-(Math.abs(h)<Math.abs(d)?h:d);for(let e=0;e<i;e++)r[n(e,e)]-=f;const p=(e,t)=>t*i+e,m=Array(i*i).fill(0);for(let e=0;e<i;e++)m[p(e,e)]=1;for(let e=0;e<i-1;e++){const t=r[n(e,e)],a=r[n(e,e+1)],o=Math.hypot(t,a),s=o<Number.EPSILON?0:t/o,l=o<Number.EPSILON?0:a/o;r[n(e,e)]=o,r[n(e,e+1)]=0;for(let t=e+1;t<i;t++){const i=r[n(t,e)],a=r[n(t,e+1)];r[n(t,e)]=i*s+a*l,r[n(t,e+1)]=a*s-i*l}for(let t=0;t<i;t++){const r=m[p(e,t)],n=m[p(e+1,t)];m[p(e,t)]=r*s+n*l,m[p(e+1,t)]=n*s-r*l}}for(let t=0;t<i;t++){const a=Array.from(Array(i-t),(e,i)=>r[n(t+i,t)]);for(let o=0;o<i;o++)r[n(o,t)]=e(a,(e,r)=>e*m[p(o,r+t)])}for(let e=0;e<i;e++)r[n(e,e)]+=f}return r},Array.prototype.eigenvalues=function(){const e=this.householder().qr(),t=Math.sqrt(e.length);return function(e,t=(e=>e)){return Array.from(Array(e),(e,r)=>t(r))}(t,r=>e[r*t+r])},E.concatTypedArrays=function(e,...t){const r=new e(t.reduce((e,t)=>e+t.length,0));return t.reduce((e,t)=>(r.set(t,e),e+t.length),0),r},E.fromTypedArray=function(e){return[].slice.call(e)},E.fillArray=function(e,t){for(var r=[],n=t;n--;)r[n]=e;return r},E.flattenArray=function(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?E.flattenArray(t):t)},[])},E.flattenVector2s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y)}return t},E.flattenVector3s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z)}return t},E.flattenVector4s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z,i.w)}return t},E.mergeArray3=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],a.z=e[o][2],void 0===n[r=Math.round(a.x*t)+"_"+Math.round(a.y*t)+"_"+Math.round(a.z*t)]&&(n[r]=o,i.push([e[o][0],e[o][1],e[o][2]]));return i.slice(0)},E.mergeArray2=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],void 0===n[r=Math.round(a.x*t)+"_"+Math.round(a.y*t)]&&(n[r]=o,i.push([e[o][0],e[o][1]]));return i.slice(0)},E.mergeArray=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n={},i=[],a={},o=0,s=e.length;o<s;o++)a.x=e[o],void 0===n[r=Math.round(a.x*t)]&&(n[r]=o,i.push(e[o]));return i.slice(0)},E.mergeVertices=function(e,t){t=void 0!==t?t:4,t=Math.pow(10,t);for(var r,n,i={},a=0,o=e.length;a<o;a++)r=e[a],void 0===i[n=Math.round(r.x*t)+"_"+Math.round(r.y*t)+"_"+Math.round(r.z*t)]&&(i[n]=a,this.push(e[a]));return e.length-this.length},THREE.Color.prototype.getHSV=function(e){void 0===e&&(console.warn("THREE.Color: .getHSV() target is now required"),e={h:0,s:0,v:0});var t,r,n=this.r,i=this.g,a=this.b,o=Math.max(n,i,a),s=Math.min(n,i,a),l=o,c=o-s;if(r=0===o?0:c/o,o===s)t=0;else{switch(o){case n:t=(i-a)/c+(i<a?6:0);break;case i:t=(a-n)/c+2;break;case a:t=(n-i)/c+4}t/=6}return e.h=t,e.s=r,e.v=l,e},THREE.Color.prototype.setHSV=function(e,t,r){var n,i,a,o=Math.floor(6*e),s=6*e-o,l=r*(1-t),c=r*(1-s*t),u=r*(1-(1-s)*t);switch(o%6){case 0:n=r,i=u,a=l;break;case 1:n=c,i=r,a=l;break;case 2:n=l,i=r,a=u;break;case 3:n=l,i=c,a=r;break;case 4:n=u,i=l,a=r;break;case 5:n=r,i=l,a=c}return this.r=n,this.g=i,this.b=a,this},THREE.Color.prototype.getHSI=function(e){void 0===e&&(console.warn("THREE.Color: .getHSI() target is now required"),e={h:0,s:0,i:0});var t,r,n=this.r,i=this.g,a=this.b,o=(n+i+a)/3;if(n===i&&i===a)t=0,r=0;else{var s=.5*(n-i+n-a)/Math.sqrt((n-i)*(n-i)+(n-a)*(i-a));if(s>1&&(s=1),s<-1&&(s=-1),(t=Math.acos(s))<0)return void console.warn("THREE.Color.getHSI(): hue < 0");a>i&&(t=2*Math.PI-t),t/=2*Math.PI,r=1-Math.min(n,i,a)/o}return e.h=t,e.s=r,e.i=o,e},THREE.Color.prototype.setHSI=function(e,t,r){if(t>1&&(t=1),r>1&&(r=1),0===t)this.r=this.g=this.b=r;else{var n,i,a,o=Math.PI/3;if((e*=2*Math.PI)>=0&&e<2*o)a=r*(1-t),i=3*r-((n=r*(1+t*Math.cos(e)/Math.cos(o-e)))+a);else if(e>=2*o&&e<4*o)e-=2*o,a=3*r-((n=r*(1-t))+(i=r*(1+t*Math.cos(e)/Math.cos(o-e))));else{if(!(e>=4*o&&e<6*o))return void console.warn("THREE.Color.setHSI: hue out of range");e-=4*o,i=r*(1-t),n=3*r-((a=r*(1+t*Math.cos(e)/Math.cos(o-e)))+i)}if(n<0||i<0||a<0)return void console.warn("THREE.Color.setHSI: r < 0, g < 0 or b < 0");this.r=Math.min(Math.max(n,0),1),this.g=Math.min(Math.max(i,0),1),this.b=Math.min(Math.max(a,0),1)}},THREE.Color.prototype.getLAB=function(e){void 0===e&&(console.warn("THREE.Color: .getLAB() target is now required"),e={l:0,a:0,b:0});var t,r,n,i=this.r,a=this.g,o=this.b;return r=(.2126*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.7152*(a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92)+.0722*(o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92))/1,n=(.0193*i+.1192*a+.9505*o)/1.08883,t=(t=(.4124*i+.3576*a+.1805*o)/.95047)>.008856?Math.pow(t,1/3):7.787*t+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,e.l=116*r-16,e.a=500*(t-r),e.b=200*(r-n),e.l=e.l/100,e.a=(e.a+128)/256,e.b=(e.b+128)/256,e},THREE.Color.prototype.setLAB=function(e,t,r){var n,i,a=((e*=100)+16)/116,o=(t=256*t-128)/500+a,s=a-(r=256*r-128)/200;i=-.9689*(o=.95047*(o*o*o>.008856?o*o*o:(o-16/116)/7.787))+1.8758*(a=1*(a*a*a>.008856?a*a*a:(a-16/116)/7.787))+.0415*(s=1.08883*(s*s*s>.008856?s*s*s:(s-16/116)/7.787)),r=.0557*o+-.204*a+1.057*s,n=(n=3.2406*o+-1.5372*a+-.4986*s)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,this.r=Math.max(0,Math.min(1,n)),this.g=Math.max(0,Math.min(1,i)),this.b=Math.max(0,Math.min(1,r))},E.toHexValue=function(e,t){return t?"0x"+E.toHexValue(e).toString(16):new THREE.Color(e).getHex()},E.toHexStyle=function(e){return"#"+new THREE.Color(e).getHexString()},E.clamp=function(e,t,r){return Math.max(t,Math.min(r,e))},E.mix=function(e,t,r){return e*(1-r)+t*r},E.lerp=function(e,t,r){return e*(1-r)+t*r},E.smoothstep=function(e,t,r){return r<=e?0:r>=t?1:(r=(r-e)/(t-e))*r*(3-2*r)},E.randInt=function(e,t){return e+Math.floor(Math.random()*(t-e+1))},E.randFloat=function(e,t){return e+Math.random()*(t-e)},E.randFloatSpread=function(e,t){return e+t*(Math.random()-.5)},E.linearRand=function(e,t){return E.randFloat(e,t)},E.gaussRand=function(e,t){var r,n,i;do{r=(n=E.randFloat(-1,1))*n+(i=E.randFloat(-1,1))*i}while(r>1);return i*t*t*Math.sqrt(-2*Math.log(r)/r)+e},E.diskRand=(i=new THREE.Vector2,function(e){var t;do{i.x=E.randFloat(-e,e),i.y=E.randFloat(-e,e),t=i.length()}while(t>e);return i}),E.ballRand=function(){var e=new THREE.Vector3;return function(t){var r;do{e.x=E.randFloat(-t,t),e.y=E.randFloat(-t,t),e.z=E.randFloat(-t,t),r=e.length()}while(r>t);return e}}(),E.circularRand=function(){var e=new THREE.Vector2;return function(t){var r=E.randFloat(0,6.283185307179586);return e.x=t*Math.cos(r),e.y=t*Math.sin(r),e}}(),E.sphericalRand=function(){var e=new THREE.Vector3;return function(t){var r=E.randFloat(-1,1),n=E.randFloat(0,6.283185307179586),i=Math.sqrt(1-r*r),a=i*Math.cos(n),o=i*Math.sin(n);return e.x=a*t,e.y=o*t,e.z=r*t,e}}(),E.createMathRandom=function(e){return(e=>()=>((e=Math.imul(741103597,e))>>>0)/2**32)(function(e){for(var t=0,r=1779033703^e.length;t<e.length;t++)r=(r=Math.imul(r^e.charCodeAt(t),3432918353))<<13|r>>>19;return function(){return r=Math.imul(r^r>>>16,2246822507),r=Math.imul(r^r>>>13,3266489909),(r^=r>>>16)>>>0}}(e.toString())())},E.createRandFloat=function(e){var t=void 0!==e?E.createMathRandom(e):Math.random;return function(e,r){return e+t()*(r-e)}},E.createFbmNoise=function(e){var t=void 0!==(e=e||{}).octaves?e.octaves:4,r=void 0!==e.persistence?e.persistence:.5;switch(void 0!==e.noiseType?e.noiseType:"simplex3d"){case"perlin3d":var n=(new THREE.ImprovedNoise).noise;break;default:var i=new THREE.SimplexNoise;n=i.noise3d.bind(i)}for(var a=new Array(t),o=new Array(t),s=0,l=0;l<t;l++)a[l]=Math.pow(r,l),o[l]=Math.pow(2,l),s+=a[l];return s=1/s,function(e,r,i){for(var o=0,l=0;l<t;l++){var c=1<<l;o+=a[l]*n(e*c,r*c,i*c)}return o*s}},E.triggerWindowResize=function(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}},E.isCtrlKeyDown=function(e){return E.isDeviceMacOS()?e.metaKey:e.ctrlKey},E.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},E.createImageDropZone=function(e,t){return null==e&&((e=document.createElement("img")).style.width="50px",e.style.height="50px",e.style.border="1px solid white"),e.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},!1),e.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation();var r=new FileReader;r.addEventListener("load",function(e){var r=new Image;r.onload=function(){t(r)},r.src=e.currentTarget.result},!1),r.readAsDataURL(e.dataTransfer.files[0])},!1),e},E.setDraggable=function(e){var t=0,r=0,n=0,i=0,a=e.children[0];function o(e){(e=e||window.event).preventDefault(),n=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(a){(a=a||window.event).preventDefault(),t=n-a.clientX,r=i-a.clientY,n=a.clientX,i=a.clientY,e.style.top=e.offsetTop-r+"px",e.style.left=e.offsetLeft-t+"px"}function l(){document.onmouseup=null,document.onmousemove=null}a?a.onmousedown=o:e.onmousedown=o},E.createProgressbar=function(){if(!(e=document.getElementById("progress-box"))){var e;(e=document.createElement("div")).id="progress-box",e.innerHTML='\n        <div>\n            <div>Loading...</div>\n            <div class="progress">\n                <div id="progressbar"></div>\n            </div>\n        </div>\n    ',document.body.appendChild(e);var t=document.createElement("style");t.id="progress-style",t.innerHTML="\n        #progress-box {\n            position: absolute;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n            font-size: x-large;\n            font-family: sans-serif;\n        }\n        #progress-box>div>div {\n            padding: 2px;\n        }\n        .progress {\n            width: 50vw;\n            border: 1px solid black;\n        }\n        #progressbar {\n            width: 0;\n            transition: width ease-out .5s;\n            height: 1em;\n            background-color: #888;\n            background-image: linear-gradient(\n                -45deg, \n                rgba(255, 255, 255, .5) 25%, \n                transparent 25%, \n                transparent 50%, \n                rgba(255, 255, 255, .5) 50%, \n                rgba(255, 255, 255, .5) 75%, \n                transparent 75%, \n                transparent\n            );\n            background-size: 50px 50px;\n            animation: progressanim 2s linear infinite;\n        }\n    ",document.head.appendChild(t)}},E.getProgressbar=function(){return document.getElementById("progressbar")},E.updateProgressbar=function(e,t,r){void 0===r&&(r=E.getProgressbar()),r.style.width=`${e/t*100|0}%`},E.hideProgressbar=function(){document.getElementById("progress-box").style.display="none"},E.showProgressbar=function(){document.getElementById("progress-box").style.display=""},E.errorProgressbar=function(e){console.warn(e)},E.removeProgressbar=function(){var e=document.getElementById("progress-box");void 0!==e&&document.body.removeChild(e);var t=document.getElementById("progress-style");void 0!==t&&document.head.removeChild(t)},E.getDistancePerPixel=function(){var e=E.appWorks.camera;return e.position.length()*Math.tan(e.fov/2*THREE.Math.DEG2RAD)*2*e.aspect/E.appWorks.width},E.getMouseScreenCoords=(a=new THREE.Vector2,function(e){return e.changedTouches?(a.x=e.changedTouches[0].clientX,a.y=e.changedTouches[0].clientY):(a.x=e.clientX,a.y=e.clientY),a}),E.toggleLightHelpers=function(e){E.appWorks.sceneHelpers.children.forEach(function(t){(t instanceof THREE.PointLightHelper||t instanceof THREE.SpotLightHelper||t instanceof THREE.DirectionalLightHelper||t instanceof THREE.HemisphereLightHelper)&&(t.visible=void 0!==e?e:!t.visible)})},E.createSpritesHUD=function(e,t,r,n,i){var a;a=e.isTexture?new THREE.SpriteMaterial({map:e,transparent:!0,depthTest:!1}):!0===e.isSpriteMaterial?e:new THREE.SpriteMaterial({color:16777215,transparent:!0,depthTest:!1});var o=new THREE.Sprite(a);o.center.set(.5,.5),o.scale.set(n,i,1),o.name="spritesHUD";var s=E.appWorks.cameraHUD;return o.position.x=s.left+n/2+t,o.position.y=s.bottom+i/2+r,o},E.createTextHUD=function(e,t,r,n,i,a){!1===Array.isArray(e)&&(e=[e]);t=t||0,r=r||0;var o,s=-1;e.forEach((e,t)=>{e.length>s&&(s=e.length,o=t)});var l=document.createElement("canvas"),c=l.getContext("2d");c.font="Normal 20px Arial",l.width=c.measureText(e[o]).width,c.font="Normal 20px Arial";var u=1.2*c.measureText("M").width;l.height=u*e.length*1.2;n=n||l.width,i=i||l.height;var h=new THREE.CanvasTexture(c.canvas),d=new THREE.MeshBasicMaterial({map:h,transparent:!0,depthTest:!1}),f=new THREE.PlaneBufferGeometry(n,i),p=new THREE.Mesh(f,d);p.name="textHUD";var m=E.appWorks.cameraHUD;p.position.x=m.left+n/2+t,p.position.y=m.bottom+i/2+r,!0===a&&(p.userData.context2D=c,p.userData.texts=e,p.userData.lineHeight=u),c.font="Normal 20px Arial",c.textAlign="left",c.fillStyle="rgba(255,255,255,1.0)",c.clear();r=u;return e.forEach(e=>{c.fillText(e,0,r),r+=u}),h.needsUpdate=!0,p},E.createRenderTargetHUD=function(e,t,r,n,i,a){t=t||0,r=r||0,n=n||E.appWorks.width,i=i||E.appWorks.height;var o=e.clone(),s=new THREE.Scene;s.add(o),s.add(E.createHemisphereLight()),s.background=E.appWorks.scene.background;var l=E.appWorks.camera.clone();E.fitCameraToObject(o,l);var c=new THREE.WebGLRenderTarget(E.appWorks.width,E.appWorks.height),u=E.appWorks.renderer;u.setRenderTarget(c),u.render(s,l);var h=new THREE.MeshBasicMaterial({map:c.texture}),d=new THREE.PlaneBufferGeometry(n,i),f=new THREE.Mesh(d,h);f.name="renderTargetHUD";var p=E.appWorks.cameraHUD;return f.position.x=p.left+n/2+t,f.position.y=p.bottom+i/2+r,!0===a&&(f.userData.renderTarget=c,f.userData.rtScene=s,f.userData.rtCamera=l),f},THREE.AmbientLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.PointLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.SpotLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.DirectionalLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.HemisphereLight.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.PerspectiveCamera.prototype.getMousePosition=function(e,t,r,n){n=void 0!==n&&n;void 0===r&&(r=new THREE.Vector3);var i=Math.tan(.5*this.fov*THREE.Math.DEG2RAD)/this.zoom,a=E.lerp(this.near,this.far,t),o=a*i,s=this.aspect*o;return r.set(e.x*s,e.y*o,-a),!0===n&&this.localToWorld(r),r},THREE.Object3D.prototype.getColorDepthRT=(o=window.innerWidth,s=window.innerHeight,l=new THREE.WebGLRenderTarget(o,s,{stencilBuffer:!1,depthBuffer:!0,depthTexture:new THREE.DepthTexture}),c=new THREE.WebGLRenderTarget(o,s,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,type:THREE.FloatType}),u=new THREE.Scene,h=new THREE.OrthographicCamera(-1,1,1,-1,0,1),d=new THREE.ShaderMaterial({uniforms:{cameraNear:{value:null},cameraFar:{value:null},tDiffuse:{value:null},tDepth:{value:null}},vertexShader:"\n            varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n            }\n        ",fragmentShader:"\n            #include <packing>\n            varying vec2 vUv;\n            uniform sampler2D tDiffuse;\n            uniform sampler2D tDepth;\n            uniform float cameraNear;\n            uniform float cameraFar;\n            \n            float getOrthographicDepth( sampler2D depthTex, vec2 uv ) {\n            #ifdef RAYMARCH\n                return texture2D( depthTex, uv ).r;\n            #else\n                float fragCoordZ = texture2D( depthTex, uv ).r;\n                float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n                return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n            #endif\n            }\n            void main() {\n                gl_FragColor.rgb = texture2D( tDiffuse, vUv ).rgb;\n                gl_FragColor.a = getOrthographicDepth( tDepth, vUv );\n            }\n        "}),f=new THREE.PlaneBufferGeometry(2,2),u.add(new THREE.Mesh(f,d)),function(e){var t=E.appWorks,r=t.renderer;if(!r.extensions.get("WEBGL_depth_texture"))return alert("WEBGL_depth_texture: not supported in WebGL2..."),null;this.isRaymarch&&(d.defines={RAYMARCH:""});var n=t.scene;e=void 0!==e?e:t.camera,n.traverse(e=>{e.isLight||0!==e.children.length||(e.visible=!1)}),this.visible=!0,r.setRenderTarget(l),r.clear(),r.render(n,e);var i=d.uniforms;return i.cameraNear.value=e.near,i.cameraFar.value=e.far,i.tDiffuse.value=l.texture,i.tDepth.value=l.depthTexture,r.setRenderTarget(c),r.clear(),r.render(u,h),c}),THREE.Object3D.prototype.readColorDepthRTCube=function(){var e=new THREE.Vector3,t=[];t.push(new THREE.Vector3(-1,0,0)),t.push(new THREE.Vector3(1,0,0)),t.push(new THREE.Vector3(0,-1,0)),t.push(new THREE.Vector3(0,1,0)),t.push(new THREE.Vector3(0,0,-1)),t.push(new THREE.Vector3(0,0,1));var r=new THREE.PerspectiveCamera;return function(n,i){var a=E.appWorks.renderer;if(a.extensions.get("WEBGL_depth_texture")){r.copy(E.appWorks.camera),E.fitCameraToObject(this,r,!1);for(var o=Math.tan(.5*r.fov*THREE.Math.DEG2RAD)/r.zoom,s=.5*E.getObjectSize(this)/o*1.25,l={x:0,y:0},c=E.appWorks.dom.getBoundingClientRect(),u=new Float32Array(c.width*c.height*4),h=0;h<t.length;h++){r.position.subVectors(this.position,t[h].multiplyScalar(s)),r.lookAt(this.position);var d=this.getColorDepthRT(r);a.readRenderTargetPixels(d,0,0,c.width,c.height,u);for(var f=0,p=0;p<c.height;p++){l.y=2/(c.height-1)*p-1;for(var m=0;m<c.width;m++)l.x=2/(c.width-1)*m-1,u[f+3]<.99&&(r.getMousePosition(l,u[f+3],e,!0),n.push(e.x,e.y,e.z),i.push(u[f],u[f+1],u[f+2])),f+=4}}}else alert("WEBGL_depth_texture: not supported...")}}(),THREE.Object3D.prototype.readColorDepthRT=function(e,t){var r=E.appWorks.renderer,n=E.appWorks.camera;if(r.extensions.get("WEBGL_depth_texture")){var i={x:0,y:0},a=new THREE.Vector3,o=E.appWorks.dom.getBoundingClientRect(),s=new Float32Array(o.width*o.height*4),l=this.getColorDepthRT(n);r.readRenderTargetPixels(l,0,0,o.width,o.height,s);for(var c=0,u=0;u<o.height;u++){i.y=2/(o.height-1)*u-1;for(var h=0;h<o.width;h++)i.x=2/(o.width-1)*h-1,s[c+3]<.99&&(n.getMousePosition(i,s[c+3],a,!0),e.push(a.x,a.y,a.z),t.push(s[c],s[c+1],s[c+2])),c+=4}}else alert("WEBGL_depth_texture: not supported...")},THREE.Object3D.prototype.clonedToPoints=function(e,t){e=void 0!==e?e:.05;var r=[],n=[];(t=void 0===t||t)?this.readColorDepthRTCube(r,n):this.readColorDepthRT(r,n);var i=new THREE.BufferGeometry;i.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),i.setAttribute("color",new THREE.Float32BufferAttribute(n,3));var a=new THREE.PointsMaterial({size:e,vertexColors:THREE.VertexColors}),o=new THREE.Points(i,a);return o.name="clonedToPoints",o},THREE.Object3D.prototype.clonedToVoxels=function(e,t){e=void 0!==e?e:200;var r=[],n=[];(t=void 0===t||t)?this.readColorDepthRTCube(r,n):this.readColorDepthRT(r,n);var i,a,o,s,l,c,u,h,d,f=E.computeBoundingBox(this),p=f.getSize(new THREE.Vector3);s=l=c=Math.max(p.x,p.y,p.z)/e,i=f.min.x,a=f.min.y,o=f.min.z;for(var m,v={},g=[],y=[],x=0,T=r.length;x<T;x+=3)void 0===v[m=(u=~~((r[x]-i)/s))+"_"+(h=~~((r[x+1]-a)/l))+"_"+(d=~~((r[x+2]-o)/c))]&&(v[m]=!0,g.push(i+(u+.5)*s,a+(h+.5)*l,o+(d+.5)*c),y.push(n[x],n[x+1],n[x+2]));var b=E.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[s,l,c]},material:{type:"MeshBasicMaterial"}}),w=E.createInstancedMeshes(b,{positions:g,colors:y});return w.name="clonedToVoxels",w},THREE.Object3D.prototype.rayIntersect=function(e,t){var r=E.appWorks,n=r.renderer,i=r.camera,a=r.raycaster;if(n.extensions.get("WEBGL_depth_texture")){e=void 0!==e?e:r.mouseUpPosition;var o=new THREE.Vector2,s=r.dom.getBoundingClientRect();o.x=(.5*e.x+.5)*s.width,o.y=(.5*e.y+.5)*s.height;var l=this.getColorDepthRT(),c=new Float32Array(4);n.readRenderTargetPixels(l,o.x,o.y,1,1,c);var u=new THREE.Vector3;i.getMousePosition(e,c[3],u);var h=u.length();a.ray.at(h,u),t.push({distance:h,point:u,object:this})}else alert("WEBGL_depth_texture: not supported...")},THREE.Object3D.prototype.getObjectsByProperty=function(e,t,r,n){void 0===n&&(n=[]);var i=this[e];void 0!==i&&i[t]===r&&n.push(this);for(var a=0,o=this.children.length;a<o;a++){this.children[a].getObjectsByProperty(e,t,r,n)}return n},THREE.Object3D.prototype.getObjectsByType=function(e,t){void 0===t&&(t=[]),this.type===e&&t.push(this);for(var r=0,n=this.children.length;r<n;r++){this.children[r].getObjectsByType(e,t)}return t},THREE.BufferGeometryUtils.mergeInstancedBufferAttribute=function(e){for(var t,r,n,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return null;if(void 0===n&&(n=o.normalized),n!==o.normalized)return null;i+=o.array.length}var s=new t(i),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new THREE.InstancedBufferAttribute(s,r,n)},E.getObjectName=function(e,t){t=void 0!==t?t:"";if(Array.isArray(e)){for(var r=[],n=0;n<e.length;n++)r.push(""===e[n].name?t:e[n].name);return r.join(", ").trunc(20)}return(void 0===e.name?t:e.name).trunc(20)},E.getObjectSize=(p=new THREE.Vector3,function(e){return E.computeBoundingBox(e).getSize(p),Math.max(p.x,p.y,p.z)}),E.resizeObject=function(e,t){if(t){var r=E.getObjectSize(e);e.scale.setScalar(t/r)}},E.transformObject=function(e,t,r,n){t&&e.position.set(t.x,t.y,t.z),r&&e.rotation.set(r.x,r.y,r.z),n&&e.scale.set(n.x,n.y,n.z),e.updateMatrix()},E.copyTransform=function(e,t){var r=t.position,n=t.rotation,i=t.scale;E.transformObject(e,r,n,i)},E.cloneObject=function(e){return void 0!==e.userData.type?new E[e.userData.type](e):e.clone()},E.traverseMaterials=function(e,t){e.traverse(e=>{if(!e.isMesh)return;(Array.isArray(e.material)?e.material:[e.material]).forEach(t)})},E.updateMaterialMapEncoding=function(e,t){t=t||THREE.sRGBEncoding,E.traverseMaterials(e,e=>{e.map&&(e.map.encoding=t),e.emissiveMap&&(e.emissiveMap.encoding=t),(e.map||e.emissiveMap)&&(e.needsUpdate=!0)})},E.underWaterBackground=function(){void 0!==E.appWorks.underWaterPass&&(E.appWorks.underWaterPass.enabled=!0),E.appWorks.createSceneBackground("underWater"),E.scene.fog||E.appWorks.createSceneFog({type:"exp2",color:594516,density:.004}),E.renderer.toneMappingExposure=.7},E.filmGrainBackground=function(){var e=E.appWorks.width,t=E.appWorks.height,r={aspect:E.camera.aspect,aspectCorrection:!0,grainScale:1.5/Math.min(e,t),color1:16777215,color2:3487029,noiseAlpha:.75};(new THREE.TextureLoader).load("images/wallpaper/arctic.jpg",function(e){E.imageProcessing(e,"FilmGrainShader",r,function(e){E.scene.background=e})})},E.redColors=(m=[16752762,16416882,15308410,15761536,13458524,14423100,11674146,16711680,9109504,8388608,16737095,16729344,14381203],function(e){return m[e%m.length]}),E.greenColors=(v=[8190976,8388352,3329330,65280,2263842,32768,25600,11403055,10145074,65407,64154,9498256,10025880,9419919,3978097,2142890,3050327,526336,5597999,7048739],function(e){return v[e%v.length]}),E.blueColors=(g=[4744096,2839678,2832470,1383252,128,1388926,1383309,160,8386,16834,2446535,1403335,2842846,2049532,2844140,3174143,1411583,6723839,3914239],function(e){return g[e%g.length]}),E.randomColors=function(e){if((e=e||{}).colors)return e.colors;var t,r,n,i=void 0!==e.numInstances?Math.floor(e.numInstances):1,a=void 0!==e.colorMode?e.colorMode:"none",o=new THREE.Color,s=[];if("0"===a)for(var l=0;l<i;l++)t=Math.random(),r=Math.random(),n=Math.random(),o.setHSL(t,r,n),s.push(o.r,o.g,o.b);else if("1"===a)for(l=0;l<i;l++)t=Math.random(),r=.5,n=.5,o.setHSL(t,r,n),s.push(o.r,o.g,o.b);else if("2"===a)for(l=0;l<i;l++)t=Math.random(),r=1,n=.5,o.setHSL(t,r,n),s.push(o.r,o.g,o.b);else if("reds"===a)for(l=0;l<i;l++)o.setHex(E.redColors(l)),s.push(o.r,o.g,o.b);else if("greens"===a)for(l=0;l<i;l++)o.setHex(E.greenColors(l)),s.push(o.r,o.g,o.b);else if("blues"===a)for(l=0;l<i;l++)o.setHex(E.blueColors(l)),s.push(o.r,o.g,o.b);return s},E.cameraAutoView=function(e){if((e=e||{}).isWorking)return"stop"!==y;if("circle"===(y=e.viewMode||"circle")){var t=e.radius||20,r=new THREE.CircleBufferGeometry(t,32),n=new THREE.Mesh(r);n.name="cameraPath",n.visible=!1,E.add(n),n.add(E.camera),n.update=function(){this.rotation.y+=.003}}else if("stop"===y){var i=E.camera.parent;i&&"cameraPath"===i.name&&(i.remove(E.camera),E.camera.parent=null)}},E.fitCameraToObject=function(e,t,r){if(e){t=void 0!==t?t:E.appWorks.camera,r=void 0===r||r;var n=new THREE.Vector3,i=new THREE.Vector3,a=E.computeBoundingBox(e);a.getSize(i);var o=e.position.clone();!0===r?(a.getCenter(n),o.sub(n),n.set(0,0,0)):n.copy(o);var s=t.fov*THREE.Math.DEG2RAD,l=Math.max(i.x,i.y,i.z),c=Math.abs(l/2/Math.tan(s/2));if(c*=1.25,t===E.appWorks.camera){var u=E.appWorks.controls;u instanceof THREE.OrbitControls?(u.reset(),u.maxDistance=100*c,u.saveState()):u instanceof THREE.TrackballControls&&(u.reset(),u.maxDistance=100*c)}var h=t.position.clone();h.normalize().multiplyScalar(c),t.lookAt(n);var d=c/100,f=100*c;if(E.appWorks.history&&t===E.appWorks.camera){var p=[];r&&p.push(new E.SetPositionCommand(e,o)),p.push(new E.SetPositionCommand(t,h)),p.push(new E.SetValueCommand(t,"near",d)),p.push(new E.SetValueCommand(t,"far",f)),E.appWorks.multiCmds(p)}else r&&e.position.copy(o),t.position.copy(h),t.near=d,t.far=f;t.updateProjectionMatrix()}},E.welcomeObject=function(e){if(e.traverse(function(e){e.isMesh&&(e.frustumCulled=!1,e.castShadow=!0,e.receiveShadow=!0)}),"natureWorks"===E.appWorks.appName)E.fitCameraToObject(e);else if("viewWorks"===E.appWorks.appName&&(E.resizeObject(e,1),E.fitCameraToObject(e),E.appWorks.selectObject=e,void 0===E.appWorks.showroom)){var t=E.createShowroom(e);E.appWorks.showroom=t,E.add(t)}},E.nextShowroom=function(e,t){if("background"===t){(n=e.getObjectByName("raymarch"))&&e.remove(n),i=((i=e.activeBackground)+1)%e.backgrounds.length,e.activeBackground=i;var r=e.backgrounds[i];r.isMesh?(E.scene.background=null,e.add(r)):E.scene.background=r}if("floor"===t){var n,i;(n=e.getObjectByName("floor"))&&e.remove(n),i=((i=e.activeFloor)+1)%e.floors.length,e.activeFloor=i;var a=e.floors[i];e.add(a)}},E.createShowroom=function(e){var t=new THREE.Object3D;t.name="showroom",t.activeBackground=-1,t.backgrounds=[];var r=["arctic","burlesque","denim","mercury","neo","origin","rouge","slate"];r.forEach(e=>{var r=(new THREE.TextureLoader).load("images/wallpaper/"+e+".jpg");t.backgrounds.push(E.createBackground(r))}),(r=["blueSky","cloud","galaxy","lake","bridge","park"]).forEach(e=>{t.backgrounds.push(E.createBackground(e))}),(r=["cloudsFS","cellsFS","fogFS","sunsetFS"]).forEach(e=>{var r=E.createBackground(e);r.name="raymarch",t.backgrounds.push(r)}),t.backgrounds.push(E.createBackground(12632256)),t.activeFloor=-1,t.floors=[];var n=new THREE.TextureLoader,i=E.computeBoundingBox(e),a=i.min.y,o=i.getSize(new THREE.Vector3),s=4*(o=Math.max(o.x,o.y,o.z));function l(e,t){t=t||8;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}(d=E.createAcrylicCircle(s)).rotation.x=-Math.PI/2,d.position.y=a,d.name="floor",t.floors.push(d);var c=[];c.push({map:n.load("images/rock/crackRockDiffuse.jpg",l),normalMap:n.load("images/rock/crackRockNormal.jpg",l),aoMap:n.load("images/rock/crackRockAO.jpg",l)}),c.push({color:11184810,roughness:1,metalness:0,map:n.load("images/pbr/wallA.png",l),normalMap:n.load("images/pbr/wallN.png",l),aoMap:n.load("images/pbr/wallAO.png",l),roughnessMap:n.load("images/pbr/wallR.png",l)}),c.push({roughness:1,metalness:0,map:n.load("images/pbr/bathroomtileA.png",l),normalMap:n.load("images/pbr/bathroomtileN.png",l),aoMap:n.load("images/pbr/bathroomtileAO.png",l),roughnessMap:n.load("images/pbr/bathroomtileR.png",l)}),c.push({roughness:1,metalness:0,map:n.load("images/pbr/charcoalA.png",l),normalMap:n.load("images/pbr/charcoalN.png",l),roughnessMap:n.load("images/pbr/charcoalR.png",l)}),c.push({color:11184810,roughness:1,metalness:0,map:n.load("images/pbr/grassA.png",l),normalMap:n.load("images/pbr/grassN.png",l),aoMap:n.load("images/pbr/grassAO.png",l),roughnessMap:n.load("images/pbr/grassR.png",l)}),c.push({color:8947848,roughness:.5,metalness:.5,map:n.load("images/pbr/rustIronA.png",e=>l(e,2)),normalMap:n.load("images/pbr/rustIronN.png",e=>l(e,2)),aoMap:n.load("images/pbr/rustIronAO.png",e=>l(e,2)),roughnessMap:n.load("images/pbr/rustIronR.png",e=>l(e,2)),metalnessMap:n.load("images/pbr/rustIronM.png",e=>l(e,2))});for(var u=new THREE.CircleBufferGeometry(s,64),h=0;h<c.length;h++){var d,f=new THREE.MeshStandardMaterial(c[h]);(d=new THREE.Mesh(u,f)).receiveShadow=!0,d.rotation.x=-Math.PI/2,d.position.y=a,d.name="floor",t.floors.push(d)}E.nextShowroom(t,"background"),E.nextShowroom(t,"floor"),E.add(E.createHemisphereLight());var p=E.createDirectionalLight({shadowCameraSize:.5*s});return p.position.set(0,.75*s,.5*s),E.add(p),t},E.manhatten2D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},E.manhatten3D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2)},E.createKdTree=function(e,t,r){if(!isTypedArray(e)){var n=e[0];isArray(n)?e=E.flattenArray(e):n instanceof THREE.Vector2?e=E.flattenVector2s(e):n instanceof THREE.Vector3?e=E.flattenVector3s(e):n instanceof THREE.Vector4&&(e=E.flattenVector4s(e)),e=new Float32Array(e)}r=r||2===t?E.manhatten2D:E.manhatten3D;return new THREE.TypedArrayUtils.Kdtree(e,r,t)},E.getKdTreeNearest=function(e,t,r,n){for(var i=e.nearest(t,r,n),a=[],o=0,s=i.length;o<s;o++){var l=i[o],c={};c.position=l[0].obj,c.index=l[0].pos,c.distance=l[1],a.push(c)}return a},E.OctreeHelper=function(e,t){if(!e instanceof x.PointOctree)return null;var r=(t=t||{}).leaves||!1,n=t.color||16777215,i=[],a=[];if(r){a=E.getLeafOctants(e,!0)}else{var o=t.topLevel||0,s=t.bottomLevel||e.getDepth();a=E.getOctantsByLevels(e,o,s)}a.forEach(function(e){var t=new THREE.Box3(e.min,e.max),r=new THREE.Box3Helper(t);r.updateMatrixWorld(!0),r.geometry.applyMatrix(r.matrixWorld),i.push(r.geometry)});var l=THREE.BufferGeometryUtils.mergeBufferGeometries(i),c=new THREE.LineBasicMaterial({color:n});THREE.LineSegments.call(this,l,c),this.name="octreeHelper",i.forEach(function(e){e.dispose()})},E.OctreeHelper.prototype=Object.create(THREE.LineSegments.prototype),E.OctreeHelper.prototype.constructor=E.OctreeHelper,E.getOctantsByLevels=function(e,t,r){for(var n=[];t<=r;){var i=e.findOctantsByLevel(t)[Symbol.iterator]();if(i)for(var a=i.next();!a.done;)n.push(a.value),a=i.next();t++}return n},E.getLeafOctants=function(e,t){var r=[],n=e.leaves(),i=n.next();if(t=t||!0)for(;!i.done;)i.value.points&&r.push(i.value),i=n.next();else for(;!i.done;)r.push(i.value),i=n.next();return r},CanvasRenderingContext2D.prototype.clear=function(e){e&&(this.beginPath(),this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),e&&this.restore()},CanvasRenderingContext2D.prototype.circle=function(e,t,r){return this.beginPath(),this.moveTo(e+r,t),this.arc(e,t,r,0,2*Math.PI),this},CanvasRenderingContext2D.prototype.fillCircle=function(e,t,r,n){return n&&(this.fillStyle=n),this.circle(e,t,r).fill(),this},CanvasRenderingContext2D.prototype.strokeCircle=function(e,t,r,n){return n&&(this.strokeStyle=n),this.circle(e,t,r).stroke(),this},CanvasRenderingContext2D.prototype.roundRect=function(e,t,r,n,i){var a={tl:0,tr:0,bl:0,br:0};if("object"==typeof i)for(var o in i)a[o]=i[o];if("number"==typeof i)for(var o in a)a[o]=i;return this.beginPath(),this.moveTo(e+a.tl,t),this.lineTo(e+r-a.tr,t),this.quadraticCurveTo(e+r,t,e+r,t+a.tr),this.lineTo(e+r,t+n-a.br),this.quadraticCurveTo(e+r,t+n,e+r-a.br,t+n),this.lineTo(e+a.bl,t+n),this.quadraticCurveTo(e,t+n,e,t+n-a.bl),this.lineTo(e,t+a.tl),this.quadraticCurveTo(e,t,e+a.tl,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillRoundRect=function(e,t,r,n,i,a){return a&&(this.fillStyle=a),this.roundRect(e,t,r,n,i).fill(),this},CanvasRenderingContext2D.prototype.strokeRoundRect=function(e,t,r,n,i,a){return a&&(this.strokeStyle=a),this.roundRect(e,t,r,n,i).stroke(),this},CanvasRenderingContext2D.prototype.polygon=function(e,t){t>0&&(e=function(e,t){function r(e,t,r,n,i,a){var o=Math.sqrt(Math.pow(r-e,2)+Math.pow(n-t,2)),s=a?i/o:(o-i)/o;return[e+s*(r-e),t+s*(n-t)]}var n,i,a,o,s,l,c,u,h=e.length,d=new Array(h);for(i=0;i<h;i++)(n=i-1)<0&&(n=h-1),(a=i+1)==h&&(a=0),o=e[n],s=e[i],l=e[a],c=r(o[0],o[1],s[0],s[1],t,!1),u=r(s[0],s[1],l[0],l[1],t,!0),d[i]=[c[0],c[1],s[0],s[1],u[0],u[1]];return d}(e,t)),this.beginPath();for(var r=0,n=e.length;r<n;r++){var i=e[r];0==r?this.moveTo(i[0],i[1]):this.lineTo(i[0],i[1]),t>0&&this.quadraticCurveTo(i[2],i[3],i[4],i[5])}return this.closePath(),this},CanvasRenderingContext2D.prototype.fillPolygon=function(e,t,r){return r&&(this.fillStyle=r),this.polygon(e,t).fill(),this},CanvasRenderingContext2D.prototype.strokePolygon=function(e,t,r){return r&&(this.strokeStyle=r),this.polygon(e,t).stroke(),this},CanvasRenderingContext2D.prototype.speechBubble=function(e,t,r,n,i,a,o,s){e=e||0,r=r||1,n=n||1,i=i||.2*n,a=a||e+r/2,s=s||i;var l,c,u,h=e+r,d=(t=t||0)+n;return(o=o||t+n+i)<t||o>t+n?(l=Math.min(Math.max(e+i,a-s/2),h-i-s),c=Math.min(Math.max(e+i+s,a+s/2),h-i)):(l=Math.min(Math.max(t+i,o-s/2),d-i-s),c=Math.min(Math.max(t+i+s,o+s/2),d-i)),o<t&&(u=2),o>t&&(u=3),a<e&&o>=t&&o<=d&&(u=0),a>e&&o>=t&&o<=d&&(u=1),a>=e&&a<=h&&o>=t&&o<=d&&(u=-1),this.beginPath(),this.moveTo(e+i,t),2==u?(this.lineTo(l,t),this.lineTo(a,o),this.lineTo(c,t),this.lineTo(h-i,t)):this.lineTo(h-i,t),this.quadraticCurveTo(h,t,h,t+i),1==u?(this.lineTo(h,l),this.lineTo(a,o),this.lineTo(h,c),this.lineTo(h,d-i)):this.lineTo(h,d-i),this.quadraticCurveTo(h,d,h-i,d),3==u?(this.lineTo(c,d),this.lineTo(a,o),this.lineTo(l,d),this.lineTo(e+i,d)):this.lineTo(e+i,d),this.quadraticCurveTo(e,d,e,d-i),0==u?(this.lineTo(e,c),this.lineTo(a,o),this.lineTo(e,l),this.lineTo(e,t+i)):this.lineTo(e,t+i),this.quadraticCurveTo(e,t,e+i,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillSpeechBubble=function(e,t,r,n,i,a,o,s,l){return l&&(this.fillStyle=l),this.speechBubble(e,t,r,n,i,a,o,s).fill(),this},CanvasRenderingContext2D.prototype.strokeSpeechBubble=function(e,t,r,n,i,a,o,s,l){return l&&(this.strokeStyle=l),this.speechBubble(e,t,r,n,i,a,o,s).stroke(),this},E.createFaceVertexUVs=function(e){!e instanceof THREE.Geometry||(e.faceVertexUvs[0]=[],e.faces.forEach(function(t){var r=["x","y","z"].sort(function(e,r){return Math.abs(t.normal[e])>Math.abs(t.normal[r])}),n=e.vertices[t.a],i=e.vertices[t.b],a=e.vertices[t.c];e.faceVertexUvs[0].push([new THREE.Vector2(n[r[0]],n[r[1]]),new THREE.Vector2(i[r[0]],i[r[1]]),new THREE.Vector2(a[r[0]],a[r[1]])])}),e.uvsNeedUpdate=!0)},E.loadObject3D=function(e){const t=["position","rotation","quaternion","scale"];var r=Array.isArray(e)?e:[e];return r.forEach(e=>{void 0===e.object?e.object={type:"Mesh"}:void 0===e.object.type&&(e.object.type="Mesh")}),function(r){const o=[];return r.forEach(e=>{o.push(function(e){var t=e.object;if(e.url){const t=[n(e.url)];return Promise.all(t).then(t=>(t[0].name=e.url,t[0]))}if("Sprite"===t.type){const t=[a(e.material)];return Promise.all(t).then(e=>new THREE.Sprite(e[0]))}if("Points"===t.type||"Mesh"===t.type||"SkinnedMesh"===t.type||"Line"===t.type||"LineLoop"===t.type||"LineSegments"===t.type){const r=[i(e.geometry),a(e.material)];return Promise.all(r).then(e=>new THREE[t.type](e[0],e[1]))}return Promise.resolve(void 0)}(e))}),Promise.all(o).then(n=>(n.forEach((e,n)=>{var i=r[n].object;Object.keys(i).map(r=>{"type"===r||(-1!==t.indexOf(r)?e[r].fromArray(i[r]):e[r]="userData"===r?JSON.parse(JSON.stringify(i[r])):"customDepthMaterial"===r||"customDistanceMaterial"===r?i[r].clone():i[r])})}),Array.isArray(e)?Promise.resolve(n):Promise.resolve(n[0])))}(r);function n(e){return e?new Promise(t=>{(new THREE.ObjectLoader).load(e,t)}):Promise.resolve(void 0)}function i(e){if(e){if(e instanceof THREE.BufferGeometry||e instanceof THREE.Geometry)return Promise.resolve(e);if(e.parameters)return new Promise(t=>{t(new THREE[e.type](...e.parameters))});if(e.attributes){var t=new THREE.BufferGeometry;return Object.keys(e.attributes).map(r=>{t.setAttribute(r,new THREE.Float32BufferAttribute(e.attributes[r],3))}),e.index&&t.setIndex(e.index),Promise.resolve(t)}return Promise.resolve(void 0)}return Promise.resolve(void 0)}function a(e){if(e){var t;const r={},n=Object.keys(e).map(n=>{if("type"===n)t=e[n];else{if(-1!==E.TEXTURE_MAPS.indexOf(n))return function(e){if(!e)return Promise.resolve(null);return e.isTexture?Promise.resolve(e):"string"==typeof e?new Promise(t=>{(new THREE.TextureLoader).load(e,t)}):Promise.resolve(void 0)}(e[n]).then(e=>{r[n]=e});r[n]=e[n]}});return Promise.all(n).then(()=>new THREE[t](r))}return Promise.resolve(void 0)}};var T=function(){var e=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),t=[new Uint8Array([]),new Uint8Array([0,8,3]),new Uint8Array([0,1,9]),new Uint8Array([1,8,3,9,8,1]),new Uint8Array([1,2,10]),new Uint8Array([0,8,3,1,2,10]),new Uint8Array([9,2,10,0,2,9]),new Uint8Array([2,8,3,2,10,8,10,9,8]),new Uint8Array([3,11,2]),new Uint8Array([0,11,2,8,11,0]),new Uint8Array([1,9,0,2,3,11]),new Uint8Array([1,11,2,1,9,11,9,8,11]),new Uint8Array([3,10,1,11,10,3]),new Uint8Array([0,10,1,0,8,10,8,11,10]),new Uint8Array([3,9,0,3,11,9,11,10,9]),new Uint8Array([9,8,10,10,8,11]),new Uint8Array([4,7,8]),new Uint8Array([4,3,0,7,3,4]),new Uint8Array([0,1,9,8,4,7]),new Uint8Array([4,1,9,4,7,1,7,3,1]),new Uint8Array([1,2,10,8,4,7]),new Uint8Array([3,4,7,3,0,4,1,2,10]),new Uint8Array([9,2,10,9,0,2,8,4,7]),new Uint8Array([2,10,9,2,9,7,2,7,3,7,9,4]),new Uint8Array([8,4,7,3,11,2]),new Uint8Array([11,4,7,11,2,4,2,0,4]),new Uint8Array([9,0,1,8,4,7,2,3,11]),new Uint8Array([4,7,11,9,4,11,9,11,2,9,2,1]),new Uint8Array([3,10,1,3,11,10,7,8,4]),new Uint8Array([1,11,10,1,4,11,1,0,4,7,11,4]),new Uint8Array([4,7,8,9,0,11,9,11,10,11,0,3]),new Uint8Array([4,7,11,4,11,9,9,11,10]),new Uint8Array([9,5,4]),new Uint8Array([9,5,4,0,8,3]),new Uint8Array([0,5,4,1,5,0]),new Uint8Array([8,5,4,8,3,5,3,1,5]),new Uint8Array([1,2,10,9,5,4]),new Uint8Array([3,0,8,1,2,10,4,9,5]),new Uint8Array([5,2,10,5,4,2,4,0,2]),new Uint8Array([2,10,5,3,2,5,3,5,4,3,4,8]),new Uint8Array([9,5,4,2,3,11]),new Uint8Array([0,11,2,0,8,11,4,9,5]),new Uint8Array([0,5,4,0,1,5,2,3,11]),new Uint8Array([2,1,5,2,5,8,2,8,11,4,8,5]),new Uint8Array([10,3,11,10,1,3,9,5,4]),new Uint8Array([4,9,5,0,8,1,8,10,1,8,11,10]),new Uint8Array([5,4,0,5,0,11,5,11,10,11,0,3]),new Uint8Array([5,4,8,5,8,10,10,8,11]),new Uint8Array([9,7,8,5,7,9]),new Uint8Array([9,3,0,9,5,3,5,7,3]),new Uint8Array([0,7,8,0,1,7,1,5,7]),new Uint8Array([1,5,3,3,5,7]),new Uint8Array([9,7,8,9,5,7,10,1,2]),new Uint8Array([10,1,2,9,5,0,5,3,0,5,7,3]),new Uint8Array([8,0,2,8,2,5,8,5,7,10,5,2]),new Uint8Array([2,10,5,2,5,3,3,5,7]),new Uint8Array([7,9,5,7,8,9,3,11,2]),new Uint8Array([9,5,7,9,7,2,9,2,0,2,7,11]),new Uint8Array([2,3,11,0,1,8,1,7,8,1,5,7]),new Uint8Array([11,2,1,11,1,7,7,1,5]),new Uint8Array([9,5,8,8,5,7,10,1,3,10,3,11]),new Uint8Array([5,7,0,5,0,9,7,11,0,1,0,10,11,10,0]),new Uint8Array([11,10,0,11,0,3,10,5,0,8,0,7,5,7,0]),new Uint8Array([11,10,5,7,11,5]),new Uint8Array([10,6,5]),new Uint8Array([0,8,3,5,10,6]),new Uint8Array([9,0,1,5,10,6]),new Uint8Array([1,8,3,1,9,8,5,10,6]),new Uint8Array([1,6,5,2,6,1]),new Uint8Array([1,6,5,1,2,6,3,0,8]),new Uint8Array([9,6,5,9,0,6,0,2,6]),new Uint8Array([5,9,8,5,8,2,5,2,6,3,2,8]),new Uint8Array([2,3,11,10,6,5]),new Uint8Array([11,0,8,11,2,0,10,6,5]),new Uint8Array([0,1,9,2,3,11,5,10,6]),new Uint8Array([5,10,6,1,9,2,9,11,2,9,8,11]),new Uint8Array([6,3,11,6,5,3,5,1,3]),new Uint8Array([0,8,11,0,11,5,0,5,1,5,11,6]),new Uint8Array([3,11,6,0,3,6,0,6,5,0,5,9]),new Uint8Array([6,5,9,6,9,11,11,9,8]),new Uint8Array([5,10,6,4,7,8]),new Uint8Array([4,3,0,4,7,3,6,5,10]),new Uint8Array([1,9,0,5,10,6,8,4,7]),new Uint8Array([10,6,5,1,9,7,1,7,3,7,9,4]),new Uint8Array([6,1,2,6,5,1,4,7,8]),new Uint8Array([1,2,5,5,2,6,3,0,4,3,4,7]),new Uint8Array([8,4,7,9,0,5,0,6,5,0,2,6]),new Uint8Array([7,3,9,7,9,4,3,2,9,5,9,6,2,6,9]),new Uint8Array([3,11,2,7,8,4,10,6,5]),new Uint8Array([5,10,6,4,7,2,4,2,0,2,7,11]),new Uint8Array([0,1,9,4,7,8,2,3,11,5,10,6]),new Uint8Array([9,2,1,9,11,2,9,4,11,7,11,4,5,10,6]),new Uint8Array([8,4,7,3,11,5,3,5,1,5,11,6]),new Uint8Array([5,1,11,5,11,6,1,0,11,7,11,4,0,4,11]),new Uint8Array([0,5,9,0,6,5,0,3,6,11,6,3,8,4,7]),new Uint8Array([6,5,9,6,9,11,4,7,9,7,11,9]),new Uint8Array([10,4,9,6,4,10]),new Uint8Array([4,10,6,4,9,10,0,8,3]),new Uint8Array([10,0,1,10,6,0,6,4,0]),new Uint8Array([8,3,1,8,1,6,8,6,4,6,1,10]),new Uint8Array([1,4,9,1,2,4,2,6,4]),new Uint8Array([3,0,8,1,2,9,2,4,9,2,6,4]),new Uint8Array([0,2,4,4,2,6]),new Uint8Array([8,3,2,8,2,4,4,2,6]),new Uint8Array([10,4,9,10,6,4,11,2,3]),new Uint8Array([0,8,2,2,8,11,4,9,10,4,10,6]),new Uint8Array([3,11,2,0,1,6,0,6,4,6,1,10]),new Uint8Array([6,4,1,6,1,10,4,8,1,2,1,11,8,11,1]),new Uint8Array([9,6,4,9,3,6,9,1,3,11,6,3]),new Uint8Array([8,11,1,8,1,0,11,6,1,9,1,4,6,4,1]),new Uint8Array([3,11,6,3,6,0,0,6,4]),new Uint8Array([6,4,8,11,6,8]),new Uint8Array([7,10,6,7,8,10,8,9,10]),new Uint8Array([0,7,3,0,10,7,0,9,10,6,7,10]),new Uint8Array([10,6,7,1,10,7,1,7,8,1,8,0]),new Uint8Array([10,6,7,10,7,1,1,7,3]),new Uint8Array([1,2,6,1,6,8,1,8,9,8,6,7]),new Uint8Array([2,6,9,2,9,1,6,7,9,0,9,3,7,3,9]),new Uint8Array([7,8,0,7,0,6,6,0,2]),new Uint8Array([7,3,2,6,7,2]),new Uint8Array([2,3,11,10,6,8,10,8,9,8,6,7]),new Uint8Array([2,0,7,2,7,11,0,9,7,6,7,10,9,10,7]),new Uint8Array([1,8,0,1,7,8,1,10,7,6,7,10,2,3,11]),new Uint8Array([11,2,1,11,1,7,10,6,1,6,7,1]),new Uint8Array([8,9,6,8,6,7,9,1,6,11,6,3,1,3,6]),new Uint8Array([0,9,1,11,6,7]),new Uint8Array([7,8,0,7,0,6,3,11,0,11,6,0]),new Uint8Array([7,11,6]),new Uint8Array([7,6,11]),new Uint8Array([3,0,8,11,7,6]),new Uint8Array([0,1,9,11,7,6]),new Uint8Array([8,1,9,8,3,1,11,7,6]),new Uint8Array([10,1,2,6,11,7]),new Uint8Array([1,2,10,3,0,8,6,11,7]),new Uint8Array([2,9,0,2,10,9,6,11,7]),new Uint8Array([6,11,7,2,10,3,10,8,3,10,9,8]),new Uint8Array([7,2,3,6,2,7]),new Uint8Array([7,0,8,7,6,0,6,2,0]),new Uint8Array([2,7,6,2,3,7,0,1,9]),new Uint8Array([1,6,2,1,8,6,1,9,8,8,7,6]),new Uint8Array([10,7,6,10,1,7,1,3,7]),new Uint8Array([10,7,6,1,7,10,1,8,7,1,0,8]),new Uint8Array([0,3,7,0,7,10,0,10,9,6,10,7]),new Uint8Array([7,6,10,7,10,8,8,10,9]),new Uint8Array([6,8,4,11,8,6]),new Uint8Array([3,6,11,3,0,6,0,4,6]),new Uint8Array([8,6,11,8,4,6,9,0,1]),new Uint8Array([9,4,6,9,6,3,9,3,1,11,3,6]),new Uint8Array([6,8,4,6,11,8,2,10,1]),new Uint8Array([1,2,10,3,0,11,0,6,11,0,4,6]),new Uint8Array([4,11,8,4,6,11,0,2,9,2,10,9]),new Uint8Array([10,9,3,10,3,2,9,4,3,11,3,6,4,6,3]),new Uint8Array([8,2,3,8,4,2,4,6,2]),new Uint8Array([0,4,2,4,6,2]),new Uint8Array([1,9,0,2,3,4,2,4,6,4,3,8]),new Uint8Array([1,9,4,1,4,2,2,4,6]),new Uint8Array([8,1,3,8,6,1,8,4,6,6,10,1]),new Uint8Array([10,1,0,10,0,6,6,0,4]),new Uint8Array([4,6,3,4,3,8,6,10,3,0,3,9,10,9,3]),new Uint8Array([10,9,4,6,10,4]),new Uint8Array([4,9,5,7,6,11]),new Uint8Array([0,8,3,4,9,5,11,7,6]),new Uint8Array([5,0,1,5,4,0,7,6,11]),new Uint8Array([11,7,6,8,3,4,3,5,4,3,1,5]),new Uint8Array([9,5,4,10,1,2,7,6,11]),new Uint8Array([6,11,7,1,2,10,0,8,3,4,9,5]),new Uint8Array([7,6,11,5,4,10,4,2,10,4,0,2]),new Uint8Array([3,4,8,3,5,4,3,2,5,10,5,2,11,7,6]),new Uint8Array([7,2,3,7,6,2,5,4,9]),new Uint8Array([9,5,4,0,8,6,0,6,2,6,8,7]),new Uint8Array([3,6,2,3,7,6,1,5,0,5,4,0]),new Uint8Array([6,2,8,6,8,7,2,1,8,4,8,5,1,5,8]),new Uint8Array([9,5,4,10,1,6,1,7,6,1,3,7]),new Uint8Array([1,6,10,1,7,6,1,0,7,8,7,0,9,5,4]),new Uint8Array([4,0,10,4,10,5,0,3,10,6,10,7,3,7,10]),new Uint8Array([7,6,10,7,10,8,5,4,10,4,8,10]),new Uint8Array([6,9,5,6,11,9,11,8,9]),new Uint8Array([3,6,11,0,6,3,0,5,6,0,9,5]),new Uint8Array([0,11,8,0,5,11,0,1,5,5,6,11]),new Uint8Array([6,11,3,6,3,5,5,3,1]),new Uint8Array([1,2,10,9,5,11,9,11,8,11,5,6]),new Uint8Array([0,11,3,0,6,11,0,9,6,5,6,9,1,2,10]),new Uint8Array([11,8,5,11,5,6,8,0,5,10,5,2,0,2,5]),new Uint8Array([6,11,3,6,3,5,2,10,3,10,5,3]),new Uint8Array([5,8,9,5,2,8,5,6,2,3,8,2]),new Uint8Array([9,5,6,9,6,0,0,6,2]),new Uint8Array([1,5,8,1,8,0,5,6,8,3,8,2,6,2,8]),new Uint8Array([1,5,6,2,1,6]),new Uint8Array([1,3,6,1,6,10,3,8,6,5,6,9,8,9,6]),new Uint8Array([10,1,0,10,0,6,9,5,0,5,6,0]),new Uint8Array([0,3,8,5,6,10]),new Uint8Array([10,5,6]),new Uint8Array([11,5,10,7,5,11]),new Uint8Array([11,5,10,11,7,5,8,3,0]),new Uint8Array([5,11,7,5,10,11,1,9,0]),new Uint8Array([10,7,5,10,11,7,9,8,1,8,3,1]),new Uint8Array([11,1,2,11,7,1,7,5,1]),new Uint8Array([0,8,3,1,2,7,1,7,5,7,2,11]),new Uint8Array([9,7,5,9,2,7,9,0,2,2,11,7]),new Uint8Array([7,5,2,7,2,11,5,9,2,3,2,8,9,8,2]),new Uint8Array([2,5,10,2,3,5,3,7,5]),new Uint8Array([8,2,0,8,5,2,8,7,5,10,2,5]),new Uint8Array([9,0,1,5,10,3,5,3,7,3,10,2]),new Uint8Array([9,8,2,9,2,1,8,7,2,10,2,5,7,5,2]),new Uint8Array([1,3,5,3,7,5]),new Uint8Array([0,8,7,0,7,1,1,7,5]),new Uint8Array([9,0,3,9,3,5,5,3,7]),new Uint8Array([9,8,7,5,9,7]),new Uint8Array([5,8,4,5,10,8,10,11,8]),new Uint8Array([5,0,4,5,11,0,5,10,11,11,3,0]),new Uint8Array([0,1,9,8,4,10,8,10,11,10,4,5]),new Uint8Array([10,11,4,10,4,5,11,3,4,9,4,1,3,1,4]),new Uint8Array([2,5,1,2,8,5,2,11,8,4,5,8]),new Uint8Array([0,4,11,0,11,3,4,5,11,2,11,1,5,1,11]),new Uint8Array([0,2,5,0,5,9,2,11,5,4,5,8,11,8,5]),new Uint8Array([9,4,5,2,11,3]),new Uint8Array([2,5,10,3,5,2,3,4,5,3,8,4]),new Uint8Array([5,10,2,5,2,4,4,2,0]),new Uint8Array([3,10,2,3,5,10,3,8,5,4,5,8,0,1,9]),new Uint8Array([5,10,2,5,2,4,1,9,2,9,4,2]),new Uint8Array([8,4,5,8,5,3,3,5,1]),new Uint8Array([0,4,5,1,0,5]),new Uint8Array([8,4,5,8,5,3,9,0,5,0,3,5]),new Uint8Array([9,4,5]),new Uint8Array([4,11,7,4,9,11,9,10,11]),new Uint8Array([0,8,3,4,9,7,9,11,7,9,10,11]),new Uint8Array([1,10,11,1,11,4,1,4,0,7,4,11]),new Uint8Array([3,1,4,3,4,8,1,10,4,7,4,11,10,11,4]),new Uint8Array([4,11,7,9,11,4,9,2,11,9,1,2]),new Uint8Array([9,7,4,9,11,7,9,1,11,2,11,1,0,8,3]),new Uint8Array([11,7,4,11,4,2,2,4,0]),new Uint8Array([11,7,4,11,4,2,8,3,4,3,2,4]),new Uint8Array([2,9,10,2,7,9,2,3,7,7,4,9]),new Uint8Array([9,10,7,9,7,4,10,2,7,8,7,0,2,0,7]),new Uint8Array([3,7,10,3,10,2,7,4,10,1,10,0,4,0,10]),new Uint8Array([1,10,2,8,7,4]),new Uint8Array([4,9,1,4,1,7,7,1,3]),new Uint8Array([4,9,1,4,1,7,0,8,1,8,7,1]),new Uint8Array([4,0,3,7,4,3]),new Uint8Array([4,8,7]),new Uint8Array([9,10,8,10,11,8]),new Uint8Array([3,0,9,3,9,11,11,9,10]),new Uint8Array([0,1,10,0,10,8,8,10,11]),new Uint8Array([3,1,10,11,3,10]),new Uint8Array([1,2,11,1,11,9,9,11,8]),new Uint8Array([3,0,9,3,9,11,1,2,9,2,11,9]),new Uint8Array([0,2,11,8,0,11]),new Uint8Array([3,2,11]),new Uint8Array([2,3,8,2,8,10,10,8,9]),new Uint8Array([9,10,2,0,9,2]),new Uint8Array([2,3,8,2,8,10,0,1,8,1,10,8]),new Uint8Array([1,10,2]),new Uint8Array([1,3,8,9,1,8]),new Uint8Array([0,9,1]),new Uint8Array([0,3,8]),new Uint8Array([])],r=[new Uint8Array([0,0,0]),new Uint8Array([1,0,0]),new Uint8Array([1,1,0]),new Uint8Array([0,1,0]),new Uint8Array([0,0,1]),new Uint8Array([1,0,1]),new Uint8Array([1,1,1]),new Uint8Array([0,1,1])],n=[new Uint8Array([0,1]),new Uint8Array([1,2]),new Uint8Array([2,3]),new Uint8Array([3,0]),new Uint8Array([4,5]),new Uint8Array([5,6]),new Uint8Array([6,7]),new Uint8Array([7,4]),new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7])],i=[new Uint8Array([0,0,0]),new Uint8Array([1,0,0]),new Uint8Array([1,1,0]),new Uint8Array([0,1,0]),new Uint8Array([0,0,1]),new Uint8Array([1,0,1]),new Uint8Array([1,1,1]),new Uint8Array([0,1,1])],a=[new Uint8Array([0,2,3,7]),new Uint8Array([0,6,2,7]),new Uint8Array([0,4,6,7]),new Uint8Array([0,6,1,2]),new Uint8Array([0,1,6,4]),new Uint8Array([5,6,1,4])],o=new Int32Array(24),s=new Int32Array(256);!function(){for(var e=0,t=0;t<8;++t)for(var r=1;r<=4;r<<=1){var n=t^r;t<=n&&(o[e++]=t,o[e++]=n)}for(t=0;t<256;++t){var i=0;for(r=0;r<24;r+=2){i|=!!(t&1<<o[r])!==!!(t&1<<o[r+1])?1<<(r>>1):0}s[t]=i}}();var l=new Array(4096);!function(){for(var e=0;e<l.length;++e)l[e]=0}();var c=[],u=function(e,t,r){var n=0;return n+=e[0],n+=c[1]*e[1],r[n+=c[2]*e[2]]};return{marchingCubes:function(i,a,o,s){s=s||0,c=[1,i[0],i[0]*i[1]],o||(o=[[0,0,0],i]);for(var l=[0,0,0],h=[0,0,0],d=0;d<3;++d)l[d]=(o[1][d]-o[0][d])/i[d],h[d]=o[0][d];var f=[],p=[],m=0,v=new Array(8),g=new Array(12),y=[0,0,0];for(y[2]=0;y[2]<i[2]-1;++y[2],m+=i[0])for(y[1]=0;y[1]<i[1]-1;++y[1],++m)for(y[0]=0;y[0]<i[0]-1;++y[0],++m){var E=0;if("function"==typeof a)for(d=0;d<8;++d){var x=r[d],T=a(l[0]*(y[0]+x[0])+h[0],l[1]*(y[1]+x[1])+h[1],l[2]*(y[2]+x[2])+h[2])-s;v[d]=T,E|=T>0?1<<d:0}else for(d=0;d<8;++d){x=r[d],T=u([y[0]+x[0],y[1]+x[1],y[2]+x[2]],0,a)-s;v[d]=T,E|=T>0?1<<d:0}var b=e[E];if(0!==b){for(d=0;d<12;++d)if(0!=(b&1<<d)){g[d]=f.length;var w=[0,0,0],_=n[d],R=r[_[0]],M=r[_[1]],S=v[_[0]],A=S-v[_[1]],L=0;Math.abs(A)>1e-6&&(L=S/A);for(var P=0;P<3;++P)w[P]=l[P]*(y[P]+R[P]+L*(M[P]-R[P]))+h[P];f.push(w)}var C=t[E];for(d=0;d<C.length;d+=3)p.push([g[C[d]],g[C[d+1]],g[C[d+2]]])}}return{vertices:f,faces:p}},marchingTetrahedra:function(e,t,r,n){n=n||0,c=[1,e[0],e[0]*e[1]],r||(r=[[0,0,0],e]);for(var o=[0,0,0],s=[0,0,0],l=0;l<3;++l)o[l]=(r[1][l]-r[0][l])/e[l],s[l]=r[0][l];var h=[],d=[],f=0,p=new Float32Array(8),m=[0,0,0];function v(e,t){var r=p[e],n=p[t],a=i[e],l=i[t],c=[m[0],m[1],m[2]],u=r-n;Math.abs(u)>1e-6&&(u=r/u);for(var d=0;d<3;++d)c[d]=o[d]*(c[d]+a[d]+u*(l[d]-a[d]))+s[d];return h.push(c),h.length-1}for(m[2]=0;m[2]<e[2]-1;++m[2],f+=e[0])for(m[1]=0;m[1]<e[1]-1;++m[1],++f)for(m[0]=0;m[0]<e[0]-1;++m[0],++f){if("function"==typeof t)for(l=0;l<8;++l){var g=i[l];p[l]=t(o[0]*(m[0]+g[0])+s[0],o[1]*(m[1]+g[1])+s[1],o[2]*(m[2]+g[2])+s[2])-n}else for(l=0;l<8;++l){g=i[l];p[l]=u([m[0]+g[0],m[1]+g[1],m[2]+g[2]],0,t)-n}for(l=0;l<a.length;++l){var y=a[l],E=0;switch(p[y[0]]<0&&(E|=1),p[y[1]]<0&&(E|=2),p[y[2]]<0&&(E|=4),p[y[3]]<0&&(E|=8),E){case 0:case 15:break;case 14:d.push([v(y[0],y[1]),v(y[0],y[3]),v(y[0],y[2])]);break;case 1:d.push([v(y[0],y[1]),v(y[0],y[2]),v(y[0],y[3])]);break;case 13:d.push([v(y[1],y[0]),v(y[1],y[2]),v(y[1],y[3])]);break;case 2:d.push([v(y[1],y[0]),v(y[1],y[3]),v(y[1],y[2])]);break;case 12:d.push([v(y[1],y[2]),v(y[1],y[3]),v(y[0],y[3]),v(y[0],y[2])]);break;case 3:d.push([v(y[1],y[2]),v(y[0],y[2]),v(y[0],y[3]),v(y[1],y[3])]);break;case 4:d.push([v(y[2],y[0]),v(y[2],y[1]),v(y[2],y[3])]);break;case 11:d.push([v(y[2],y[0]),v(y[2],y[3]),v(y[2],y[1])]);break;case 5:d.push([v(y[0],y[1]),v(y[1],y[2]),v(y[2],y[3]),v(y[0],y[3])]);break;case 10:d.push([v(y[0],y[1]),v(y[0],y[3]),v(y[2],y[3]),v(y[1],y[2])]);break;case 6:d.push([v(y[2],y[3]),v(y[0],y[2]),v(y[0],y[1]),v(y[1],y[3])]);break;case 9:d.push([v(y[2],y[3]),v(y[1],y[3]),v(y[0],y[1]),v(y[0],y[2])]);break;case 7:d.push([v(y[3],y[0]),v(y[3],y[1]),v(y[3],y[2])]);break;case 8:d.push([v(y[3],y[0]),v(y[3],y[2]),v(y[3],y[1])])}}}return{vertices:h,faces:d}},surfaceNets:function(e,t,r,n){n=n||0,c=[1,e[0],e[0]*e[1]],r||(r=[[0,0,0],e]);for(var i=[0,0,0],a=[0,0,0],h=0;h<3;++h)i[h]=(r[1][h]-r[0][h])/e[h],a[h]=r[0][h];var d=[],f=[],p=[0,0,0],m=[1,e[0]+1,(e[0]+1)*(e[1]+1)],v=[0,0,0,0,0,0,0,0],g=1;if(2*m[2]>l.length){var y=l.length;for(l.length=2*m[2];y<l.length;)l[y++]=0}for(p[2]=0;p[2]<e[2]-1;++p[2],e[0],g^=1,m[2]=-m[2]){var E=1+(e[0]+1)*(1+g*(e[1]+1));for(p[1]=0;p[1]<e[1]-1;++p[1],0,E+=2)for(p[0]=0;p[0]<e[0]-1;++p[0],0,++E){var x=0,T=0;if("function"==typeof t)for(var b=0;b<2;++b)for(var w=0;w<2;++w)for(h=0;h<2;++h,++T){var _=t(i[0]*(p[0]+h)+a[0],i[1]*(p[1]+w)+a[1],i[2]*(p[2]+b)+a[2])-n;v[T]=_,x|=_<0?1<<T:0}else for(b=0;b<2;++b)for(w=0;w<2;++w)for(h=0;h<2;++h,++T){_=u([p[0]+h,p[1]+w,p[2]+b],0,t)-n;v[T]=_,x|=_<0?1<<T:0}if(0!==x&&255!==x){var R=s[x],M=[0,0,0],S=0;for(h=0;h<12;++h)if(R&1<<h){++S;var A=o[h<<1],L=o[1+(h<<1)],P=v[A],C=P-v[L];if(Math.abs(C)>1e-6){C=P/C;for(w=0,b=1;w<3;++w,b<<=1){var H=A&b,I=L&b;M[w]+=H!==I?H?1-C:C:H?1:0}}}var k=1/S;for(h=0;h<3;++h)M[h]=i[h]*(p[h]+k*M[h])+a[h];l[E]=d.length,d.push(M);for(h=0;h<3;++h)if(R&1<<h){var N=(h+1)%3,O=(h+2)%3;if(0!==p[N]&&0!==p[O]){var F=m[N],D=m[O];1&x?(f.push([l[E],l[E-F],l[E-D]]),f.push([l[E-D],l[E-F],l[E-F-D]])):(f.push([l[E],l[E-D],l[E-F]]),f.push([l[E-F],l[E-D],l[E-F-D]]))}}}}}return{vertices:d,faces:f}}}},b=r(4),w=r.n(b),_=r(10);E.IsosurfaceGeometry=function(e,t,r,n,i){t=t||[[-1,-1,-1],[1,1,1]],i=i||"surfaceNets",n=n||0;if("number"==typeof(e=e||32)){v=t[1][0]-t[0][0],g=t[1][1]-t[0][1],y=t[1][2]-t[0][2];var a=Math.max(v,g,y)/e;(e=[])[0]=Math.max(~~(v/a),4),e[1]=Math.max(~~(g/a),4),e[2]=Math.max(~~(y/a),4)}THREE.Geometry.call(this);var o,s,l,c=new T;switch(i){case"surfaceNets":o=c.surfaceNets(e,r,t,n);break;case"marchingCubes":o=c.marchingCubes(e,r,t,n);break;case"marchingTetrahedra":o=c.marchingTetrahedra(e,r,t,n)}for(var u=0;u<o.vertices.length;++u)s=o.vertices[u],this.vertices.push(new THREE.Vector3(s[0],s[1],s[2]));for(u=0;u<o.faces.length;++u)3===(l=o.faces[u]).length?this.faces.push(new THREE.Face3(l[0],l[1],l[2])):4===l.length&&(this.faces.push(new THREE.Face3(l[0],l[1],l[2])),this.faces.push(new THREE.Face3(l[0],l[2],l[3])));if(this.mergeVertices(),"function"==typeof r){for(var h,d,f,p,m=.001,v=new THREE.Vector3(m,0,0),g=new THREE.Vector3(0,m,0),y=new THREE.Vector3(0,0,m),x=new THREE.Vector3,b=[],w=(u=0,this.vertices.length);u<w;u++)s=this.vertices[u],h=_(x.addVectors(s,v))-_(x.subVectors(s,v)),d=_(x.addVectors(s,g))-_(x.subVectors(s,g)),f=_(x.addVectors(s,y))-_(x.subVectors(s,y)),p=new THREE.Vector3(h,d,f).normalize(),b.push(p);for(u=0,w=this.faces.length;u<w;u++)(l=this.faces[u]).vertexNormals=[b[l.a],b[l.b],b[l.c]];function _(e){return r(e.x,e.y,e.z)}}else this.computeVertexNormals();E.createFaceVertexUVs(this)},E.IsosurfaceGeometry.prototype=Object.create(THREE.Geometry.prototype),E.IsosurfaceGeometry.prototype.constructor=E.IsosurfaceGeometry,E.DelaunayBufferGeometry=function(e,t){t=(t||"xz").toLowerCase();THREE.BufferGeometry.call(this);var r=null;"xz"===t?r=w.a.from(e.map(e=>[e.x,e.z])):"xy"===t?r=w.a.from(e.map(e=>[e.x,e.y])):"yz"===t&&(r=w.a.from(e.map(e=>[e.y,e.z])));var n=new Uint16Array(r.triangles);this.setIndex(new THREE.BufferAttribute(n,1)),this.setFromPoints(e),this.computeVertexNormals()},E.DelaunayBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),E.DelaunayBufferGeometry.prototype.constructor=E.DelaunayBufferGeometry,E.ConstrainedDelaunayBufferGeometry=function(e,t,r){t=t||[],r=r||[];THREE.BufferGeometry.call(this);var n=0;e.forEach(function(e){e.id=n++});var i=new _.SweepContext(e);t.length>0&&(t.forEach(function(e){e.forEach(function(e){e.id=n++})}),i.addHoles(t)),r.length>0&&(r.forEach(function(e){e.id=n++}),i.addPoints(r)),i.triangulate();var a=i.getTriangles(),o=[];a.forEach(function(e){e.getPoints().forEach(function(e){o.push(e.id)})}),this.setIndex(new THREE.Uint16BufferAttribute(o,1));var s=e.concat(t,r);s=E.flattenArray(s),this.setFromPoints(s),this.computeVertexNormals()},E.ConstrainedDelaunayBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),E.ConstrainedDelaunayBufferGeometry.prototype.constructor=E.ConstrainedDelaunayBufferGeometry,E.simplifyGeometry=function(e,t){t=t||.5;if(e.isGeometry||e.isBufferGeometry){e=E.toGeometry(e);var r=Math.floor(e.vertices.length*t);return(e=(new THREE.SimplifyModifier).modify(e,r)).computeVertexNormals(),e}},E.subdivideGeometry=function(e,t){t=t||1;if(e.isGeometry||e.isBufferGeometry)return e=new THREE.SubdivisionModifier(t).modify(e)},E.RingGeometry=function(e,t,r,n,i,a){THREE.Geometry.call(this),this.type="JamieRingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var o,s,l=[],c=e,u=(t-e)/(n=void 0!==n?Math.max(1,n):1);for(o=0;o<n+1;o++){for(s=0;s<r+1;s++){var h=new THREE.Vector3,d=i+s/r*a;h.x=c*Math.cos(d),h.z=c*Math.sin(d),this.vertices.push(h),l.push(new THREE.Vector2(s/r,o/n))}c+=u}var f=new THREE.Vector3(1,0,0);for(o=0;o<n;o++){var p=o*(r+1);for(s=0;s<r;s++){var m=d=s+p,v=d+r+1,g=d+r+2;this.faces.push(new THREE.Face3(m,v,g,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[v].clone(),l[g].clone()]),m=d,v=d+r+2,g=d+1,this.faces.push(new THREE.Face3(m,v,g,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[v].clone(),l[g].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},E.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),E.RingGeometry.prototype.constructor=E.RingGeometry,E.computeChildVertexFaceAmount=function(e){var t=0,r=0,n=0;return e.traverse(function(e){if(t++,e.isMesh){var i=1;e instanceof E.InstancedMesh&&(i=e.numInstances);var a=e.geometry;a.isGeometry?(r+=a.vertices.length,n+=a.faces.length):a.isBufferGeometry&&(r+=a.attributes.position.count*i,null!==a.index?n+=a.index.count/3*i:n+=a.attributes.position.count/3*i)}}),{objects:t,vertices:r,faces:n}},E.computeMassProperties=function(e){var t=0,r=0;return e.traverse(function(e){if(e.isMesh){var i=function(e){var t=0,r=0,i=new THREE.Triangle,a=e.geometry;if(a.isGeometry){if(a.faces.length<1)return{area:0,volume:0};var o=a.vertices;a.faces.forEach(function(e){t+=i.set(o[e.a],o[e.b],o[e.c]).getArea(),r+=n(o[e.a],o[e.b],o[e.c])})}else if(a.isBufferGeometry){var s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3;if(a.index){if(a.index.count<3)return{area:0,volume:0};for(var u,h,d,f=a.attributes.position.array,p=a.index.array,m=0,v=a.index.count;m<v;m+=3)u=p[m+0],h=p[m+1],d=p[m+2],s.set(f[3*u],f[3*u+1],f[3*u+2]),l.set(f[3*h],f[3*h+1],f[3*h+2]),c.set(f[3*d],f[3*d+1],f[3*d+2]),t+=i.set(s,l,c).getArea(),r+=n(s,l,c)}else{if(a.attributes.position.count<3)return{area:0,volume:0};for(var f=a.attributes.position.array,g=3*a.attributes.position.count,m=0;m<g;m+=9)s.set(f[m+0],f[m+1],f[m+2]),l.set(f[m+3],f[m+4],f[m+5]),c.set(f[m+6],f[m+7],f[m+8]),t+=i.set(s,l,c).getArea(),r+=n(s,l,c)}}if(e instanceof E.InstancedMesh){var y=e.numInstances;return{area:t*y,volume:r*y}}return{area:t,volume:r}}(e);t+=i.area,r+=i.volume}}),{area:t,volume:r};function n(e,t,r){return(-(r.x*t.y*e.z)+t.x*r.y*e.z+r.x*e.y*t.z-e.x*r.y*t.z-t.x*e.y*r.z+e.x*t.y*r.z)/6}},E.computeBoundingBox=function(e){return(new THREE.Box3).setFromObject(e)},E.computeBoundingSphere=function(){var e,t,r,n=new THREE.Vector3;function i(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,r=o.length;t<r;t++)n.copy(o[t]),n.applyMatrix4(i.matrixWorld),e.push(n.clone())}else if(a.isBufferGeometry){var s;if(void 0!==(s=a.attributes.instancePosition?a.attributes.instancePosition:a.attributes.position))for(t=0,r=s.count;t<r;t++)n.fromBufferAttribute(s,t),n.applyMatrix4(i.matrixWorld),e.push(n.clone())}}return function(t){return e=[],t.updateMatrixWorld(!0),t.traverse(i),e.length>0?(new THREE.Sphere).setFromPoints(e):void 0}}(),E.isEmptyGeometry=function(e){return!(e.isGeometry&&e.vertices.length>0)&&!(e.isBufferGeometry&&e.attributes.position.count>0)},E.translateGeometry=function(e,t){if(t.isVector3){var r=(new THREE.Matrix4).makeTranslation(t.x,t.y,t.z);e.applyMatrix(r)}},E.rotateGeometry=function(e,t,r){if(0!==r){var n=new THREE.Matrix4;switch(t.toLowerCase()){case"x":n.makeRotationX(r);break;case"y":n.makeRotationY(r);break;case"z":n.makeRotationZ(r);break;default:return}e.applyMatrix(n)}},E.toNonIndexedBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry?t=(new THREE.BufferGeometry).fromGeometry(e):e instanceof THREE.BufferGeometry&&null!==e.index&&(t=e.toNonIndexed()),t},E.toBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry&&(t=(new THREE.BufferGeometry).fromGeometry(e)),t},E.toGeometry=function(e){return e instanceof THREE.BufferGeometry&&(e=(new THREE.Geometry).fromBufferGeometry(e)).mergeVertices(),e},E.rectangularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",r=void 0!==e.width?e.width:1,n=void 0!==e.height?e.height:1,i=void 0!==e.numWidth?Math.floor(e.numWidth):1,a=void 0!==e.numHeight?Math.floor(e.numHeight):1,o=[];function s(e,t,r,n,i,a,s){var l,c,u,h,d=a<=1?1:n/(a-1),f=s<=1?1:i/(s-1),p=a<=1?0:n/2,m=s<=1?0:i/2,v=new THREE.Vector3;for(c=0;c<s;c++)for(h=c*f-m,l=0;l<a;l++)u=l*d-p,v[e]=u,v[t]=h,v[r]=0,o.push(v.x,v.y,v.z)}return"x"===t?s("y","z",t,r,n,i,a):"y"===t?s("z","x",t,r,n,i,a):"z"===t&&s("x","y",t,r,n,i,a),o},E.circularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",r=void 0!==e.radiusStart?e.radiusStart:1,n=void 0!==e.radiusLength?e.radiusLength:r+1,i=void 0!==e.numRadius?Math.floor(e.numRadius):1,a=void 0!==e.angleStart?e.angleStart:0,o=void 0!==e.angleLength?e.angleLength:2*Math.PI,s=void 0!==e.numAngle?Math.floor(e.numAngle):4,l=[];function c(e,t,c){var u,h,d,f,p=i<=1?1:n/(i-1),m=s<=1?1:o/(s-1);o===2*Math.PI&&(m=o/s);var v=new THREE.Vector3;for(u=0;u<i;u++)for(d=u*p+r,h=0;h<s;h++)f=h*m+a,v[e]=d*Math.cos(f),v[t]=d*Math.sin(f),v[c]=0,l.push(v.x,v.y,v.z)}return"x"===t?c("y","z",t):"y"===t?c("z","x",t):"z"===t&&c("x","y",t),l},E.structuredPositions=function(e){return(e=e||{}).positions?e.positions:"rectangular"===e.pattern?E.rectangularPositions(e):"circular"===e.pattern?E.circularPositions(e):[]},E.scatteredPositions=function(e){if((e=e||{}).positions)return{positions:e.positions,rotations:e.rotations,scales:e.scales};for(var t,r,n,i=void 0!==e.seed?E.createRandFloat(e.seed):E.randFloat,a=.5*E.WORLD_SIZE,o=e.pmin||[-a,-a,-a],s=e.pmax||[a,a,a],l=e.rmin||[0,0,0],c=e.rmax||[0,0,0],u=e.smin||[1,1,1],h=e.smax||[1,1,1],d=void 0!==e.numInstances?Math.floor(e.numInstances):1,f=[],p=[],m=[],v=0;v<d;v++)t=i(o[0],s[0]),r=i(o[1],s[1]),n=i(o[2],s[2]),f.push(t,r,n),t=i(l[0],c[0]),r=i(l[1],c[1]),n=i(l[2],c[2]),p.push(t,r,n),t=i(u[0],h[0]),r=i(u[1],h[1]),n=i(u[2],h[2]),m.push(t,r,n);return{positions:f,rotations:p,scales:m}},E.createNoiseHeightGeometry=function(e,t,r,n,i){e=e||500,t=t||500;var a=(i=i||50)/88,o=function(e,t){for(var r=e*t,n=1,i=Math.random(),a=new Uint8Array(r),o=new THREE.ImprovedNoise,s=0;s<4;s++){for(var l=0;l<r;l++){var c=l%e,u=~~(l/e);a[l]+=Math.abs(o.noise(c/n,u/n,i)*n)}n*=5}return a}(r=r||256,n=n||256),s=new THREE.PlaneBufferGeometry(e,t,r-1,n-1);s.rotateX(-Math.PI/2);for(var l=s.attributes.position.array,c=0,u=0,h=l.length/3;c<h;c++,u+=3)l[u+1]=o[c]*a;return s.computeVertexNormals(),s},E.ShaderChunk={},E.ShaderChunk.mod289="float mod289(float x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }",E.ShaderChunk.permute="float permute(float x) { return mod289(((x*34.0)+1.0)*x); }\nvec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }\nvec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }",E.ShaderChunk.snoise2="float snoise(vec2 v) { const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);vec2 i  = floor(v + dot(v, C.yy) );vec2 x0 = v -   i + dot(i, C.xx);vec2 i1;i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);vec4 x12 = x0.xyxy + C.xxzz;x12.xy -= i1;i = mod289(i);vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0) );vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);m = m*m; m = m*m ;vec3 x = 2.0 * fract(p * C.www) - 1.0;vec3 h = abs(x) - 0.5;vec3 ox = floor(x + 0.5);vec3 a0 = x - ox;m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );vec3 g;g.x  = a0.x  * x0.x  + h.x  * x0.y;g.yz = a0.yz * x12.xz + h.yz * x12.yw;return 130.0 * dot(m, g); }",E.ShaderChunk.taylorInvSqrt="float taylorInvSqrt(float r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }",E.ShaderChunk.snoise3="float snoise(vec3 v) { const vec2 C = vec2(1.0/6.0, 1.0/3.0);const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);vec3 i = floor(v + dot(v, C.yyy));vec3 x0 = v - i + dot(i, C.xxx);vec3 g = step(x0.yzx, x0.xyz);vec3 l = 1.0 - g;vec3 i1 = min(g.xyz, l.zxy);vec3 i2 = max(g.xyz, l.zxy);vec3 x1 = x0 - i1 + C.xxx;vec3 x2 = x0 - i2 + C.yyy;vec3 x3 = x0 - D.yyy;i = mod289(i);vec4 p = permute( permute( permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));float n_ = 0.142857142857;vec3 ns = n_ * D.wyz - D.xzx;vec4 j = p - 49.0 * floor(p * ns.z * ns.z);vec4 x_ = floor(j * ns.z);vec4 y_ = floor(j - 7.0 * x_);vec4 x = x_ *ns.x + ns.yyyy;vec4 y = y_ *ns.x + ns.yyyy;vec4 h = 1.0 - abs(x) - abs(y);vec4 b0 = vec4( x.xy, y.xy );vec4 b1 = vec4( x.zw, y.zw );vec4 s0 = floor(b0)*2.0 + 1.0;vec4 s1 = floor(b1)*2.0 + 1.0;vec4 sh = -step(h, vec4(0.0));vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;vec3 p0 = vec3(a0.xy,h.x);vec3 p1 = vec3(a0.zw,h.y);vec3 p2 = vec3(a1.xy,h.z);vec3 p3 = vec3(a1.zw,h.w);vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));p0 *= norm.x;p1 *= norm.y;p2 *= norm.z;p3 *= norm.w;vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);m = m * m;return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3))); }",E.ShaderChunk.grad4="vec4 grad4(float j, vec4 ip) { const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);vec4 p,s;p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;p.w = 1.5 - dot(abs(p.xyz), ones.xyz);s = vec4(lessThan(p, vec4(0.0)));p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;return p; }",E.ShaderChunk.snoise4="float snoise(vec4 v) { const vec4 C = vec4(0.138196601125011, 0.276393202250021, 0.414589803375032, -0.447213595499958);vec4 i  = floor(v + dot(v, vec4(0.309016994374947451)));vec4 x0 = v -   i + dot(i, C.xxxx);vec4 i0;vec3 isX = step( x0.yzw, x0.xxx );vec3 isYZ = step( x0.zww, x0.yyz );i0.x = isX.x + isX.y + isX.z;i0.yzw = 1.0 - isX;i0.y += isYZ.x + isYZ.y;i0.zw += 1.0 - isYZ.xy;i0.z += isYZ.z;i0.w += 1.0 - isYZ.z;vec4 i3 = clamp( i0, 0.0, 1.0 );vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );vec4 x1 = x0 - i1 + C.xxxx;vec4 x2 = x0 - i2 + C.yyyy;vec4 x3 = x0 - i3 + C.zzzz;vec4 x4 = x0 + C.wwww;i = mod289(i);float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);vec4 j1 = permute( permute( permute( permute (i.w + vec4(i1.w, i2.w, i3.w, 1.0 )) + i.z + vec4(i1.z, i2.z, i3.z, 1.0 )) + i.y + vec4(i1.y, i2.y, i3.y, 1.0 )) + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;vec4 p0 = grad4(j0,   ip);vec4 p1 = grad4(j1.x, ip);vec4 p2 = grad4(j1.y, ip);vec4 p3 = grad4(j1.z, ip);vec4 p4 = grad4(j1.w, ip);vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));p0 *= norm.x;p1 *= norm.y;p2 *= norm.z;p3 *= norm.w;p4 *= taylorInvSqrt(dot(p4,p4));vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);m0 = m0 * m0;m1 = m1 * m1;return 49.0 * (dot(m0*m0, vec3(dot(p0, x0), dot(p1, x1), dot(p2, x2))) + dot(m1*m1, vec2(dot(p3, x3), dot(p4, x4)))); }",E.ShaderChunk.fade2="vec2 fade(vec2 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}",E.ShaderChunk.cnoise2="float cnoise(vec2 P){vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);Pi = mod289(Pi);vec4 ix = Pi.xzxz;vec4 iy = Pi.yyww;vec4 fx = Pf.xzxz;vec4 fy = Pf.yyww;vec4 i = permute(permute(ix) + iy);vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0;vec4 gy = abs(gx) - 0.5;vec4 tx = floor(gx + 0.5);gx = gx - tx;vec2 g00 = vec2(gx.x,gy.x);vec2 g10 = vec2(gx.y,gy.y);vec2 g01 = vec2(gx.z,gy.z);vec2 g11 = vec2(gx.w,gy.w);vec4 norm = 1.79284291400159 - 0.85373472095314 * vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));g00 *= norm.x;g01 *= norm.y;g10 *= norm.z;g11 *= norm.w;float n00 = dot(g00, vec2(fx.x, fy.x));float n10 = dot(g10, vec2(fx.y, fy.y));float n01 = dot(g01, vec2(fx.z, fy.z));float n11 = dot(g11, vec2(fx.w, fy.w));vec2 fade_xy = fade(Pf.xy);vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);float n_xy = mix(n_x.x, n_x.y, fade_xy.y);return 2.3 * n_xy; }",E.ShaderChunk.fade3="vec3 fade(vec3 t) { return t*t*t*(t*(t*6.0-15.0)+10.0); }",E.ShaderChunk.cnoise3="float cnoise(vec3 P) { vec3 Pi0 = floor(P);vec3 Pi1 = Pi0 + vec3(1.0);Pi0 = mod289(Pi0);Pi1 = mod289(Pi1);vec3 Pf0 = fract(P);vec3 Pf1 = Pf0 - vec3(1.0);vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);vec4 iy = vec4(Pi0.yy, Pi1.yy);vec4 iz0 = Pi0.zzzz;vec4 iz1 = Pi1.zzzz;vec4 ixy = permute(permute(ix) + iy);vec4 ixy0 = permute(ixy + iz0);vec4 ixy1 = permute(ixy + iz1);vec4 gx0 = ixy0 * (1.0 / 7.0);vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;gx0 = fract(gx0);vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);vec4 sz0 = step(gz0, vec4(0.0));gx0 -= sz0 * (step(0.0, gx0) - 0.5);gy0 -= sz0 * (step(0.0, gy0) - 0.5);vec4 gx1 = ixy1 * (1.0 / 7.0);vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;gx1 = fract(gx1);vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);vec4 sz1 = step(gz1, vec4(0.0));gx1 -= sz1 * (step(0.0, gx1) - 0.5);gy1 -= sz1 * (step(0.0, gy1) - 0.5);vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));g000 *= norm0.x;g010 *= norm0.y;g100 *= norm0.z;g110 *= norm0.w;vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));g001 *= norm1.x;g011 *= norm1.y;g101 *= norm1.z;g111 *= norm1.w;float n000 = dot(g000, Pf0);float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));float n111 = dot(g111, Pf1);vec3 fade_xyz = fade(Pf0);vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);return 2.2 * n_xyz;}",E.ShaderChunk.pnoise3="float pnoise(vec3 P, vec3 rep) { vec3 Pi0 = mod(floor(P), rep);vec3 Pi1 = mod(Pi0 + vec3(1.0), rep);Pi0 = mod289(Pi0);Pi1 = mod289(Pi1);vec3 Pf0 = fract(P);vec3 Pf1 = Pf0 - vec3(1.0);vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);vec4 iy = vec4(Pi0.yy, Pi1.yy);vec4 iz0 = Pi0.zzzz;vec4 iz1 = Pi1.zzzz;vec4 ixy = permute(permute(ix) + iy);vec4 ixy0 = permute(ixy + iz0);vec4 ixy1 = permute(ixy + iz1);vec4 gx0 = ixy0 * (1.0 / 7.0);vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;gx0 = fract(gx0);vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);vec4 sz0 = step(gz0, vec4(0.0));gx0 -= sz0 * (step(0.0, gx0) - 0.5);gy0 -= sz0 * (step(0.0, gy0) - 0.5);vec4 gx1 = ixy1 * (1.0 / 7.0);vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;gx1 = fract(gx1);vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);vec4 sz1 = step(gz1, vec4(0.0));gx1 -= sz1 * (step(0.0, gx1) - 0.5);gy1 -= sz1 * (step(0.0, gy1) - 0.5);vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));g000 *= norm0.x;g010 *= norm0.y;g100 *= norm0.z;g110 *= norm0.w;vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));g001 *= norm1.x;g011 *= norm1.y;g101 *= norm1.z;g111 *= norm1.w;float n000 = dot(g000, Pf0);float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));float n111 = dot(g111, Pf1);vec3 fade_xyz = fade(Pf0);vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);return 2.2 * n_xyz;}",E.ShaderChunk.random="float random(vec2 p) { return fract(sin(mod(dot(p.xy, vec2(12.9898, 78.233)), 3.14))*43758.5453123); }",E.ShaderChunk.hash="float hash(float x) { return fract(sin(x) * 1e4); }\nfloat hash(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }",E.ShaderChunk.noise2="float noise(vec2 p) { vec2 i = floor(p);vec2 f = fract(p);float a = hash(i);float b = hash(i + vec2(1.0, 0.0));float c = hash(i + vec2(0.0, 1.0));float d = hash(i + vec2(1.0, 1.0));vec2 u = f*f*(3.0 - 2.0*f);return mix(a, b, u.x) + (c - a)*u.y*(1.0 - u.x) + (d - b)*u.x*u.y; }",E.ShaderChunk.noise3="float noise(vec3 x) { const vec3 step = vec3(110, 241, 171);vec3 i = floor(x);vec3 f = fract(x);float n = dot(i, step);vec3 u = f * f * (3.0 - 2.0 * f);return mix(mix(mix( hash(n + dot(step, vec3(0, 0, 0))), hash(n + dot(step, vec3(1, 0, 0))), u.x),mix( hash(n + dot(step, vec3(0, 1, 0))), hash(n + dot(step, vec3(1, 1, 0))), u.x), u.y),mix(mix( hash(n + dot(step, vec3(0, 0, 1))), hash(n + dot(step, vec3(1, 0, 1))), u.x),mix( hash(n + dot(step, vec3(0, 1, 1))), hash(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);}",E.ShaderChunk.fbm2="float fbm(vec2 p) { const int NUM_OCTAVES = 5;float v = 0.0;float a = 0.5;vec2 shift = vec2(100.0);mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.5));for (int i = 0; i < NUM_OCTAVES; ++i) {v += a * noise(p);p = rot * p * 2.0 + shift;a *= 0.5;}return v; }",E.ShaderChunk.fbm3="float fbm(vec3 x) { const int NUM_OCTAVES = 5;float v = 0.0;float a = 0.5;vec3 shift = vec3(100.0);for (int i = 0; i < NUM_OCTAVES; ++i) {v += a * noise(x);x = x * 2.0 + shift;a *= 0.5;}return v; }",E.ShaderChunk.fbm2IQ="float fbmIQ(vec2 p){ const mat2 m2 = mat2(0.8,-0.6,0.6,0.8);float f = 0.0;f += 0.5000*noise( p ); p = m2*p*2.02;f += 0.2500*noise( p ); p = m2*p*2.03;f += 0.1250*noise( p ); p = m2*p*2.01;f += 0.0625*noise( p );return f/0.9375; }",E.ShaderChunk.clipToScreenPos="\nvec2 clipToScreenPos( vec4 clipPos ) {\n    vec2 ndcPos = clipPos.xy / clipPos.w; // ndc = [-1,1]\n    vec2 screenPos = ndcPos * 0.5 + 0.5;  // screenPos = [0,1]\n    return screenPos;\n}",E.ShaderChunk.caustics="\nvec3 caustics( vec2 uv, float density, vec3 baseColor )\n// density: larger -> higher frequent (1.0 ~ 16.0)\n{\n    const int MAX_ITER = 10;\n    const float inten = 0.005; // light intensity: larger -> brighter (range = 0.015 ~ 0.055)\n    const float speed = 1.5;   // water speed: larger -> slower (range = 0.1 ~ 1.5)\n    const float speed2 = 3.0;  // water speed: larger -> faster (range = 0.0 ~ 10.0)\n    const float freq = 0.8;    // water ripples (range = 0.5 ~ 1.0(= oil))\n    const float xflow = 0.0;   // flow speed in x direction (range = -10 ~ +10)\n    const float zflow = 0.0;   // flow speed in z direction (range = -10 ~ +10)\n    float c = 1.5;             // global brightness: larger -> darker (default = 1.0, range = 0.0 ~ 5.0)\n    vec2 p = mod( uv * PI2*density, PI2*density ) - 250.0;\n    vec2 i = p;\n    for( int n = 0; n < MAX_ITER; n++ ) {\n        float t = time * (1.0 - (3.0 / (float(n) + speed)));\n        i = p + vec2( cos(t - i.x * freq) + sin(t + i.y * freq) + (time * xflow), sin(t - i.y * freq) + cos(t + i.x * freq) + (time * zflow) );\n        c += 1.0 / length( vec2( p.x / (sin(i.x + t * speed2) / inten), p.y / (cos(i.y + t * speed2) / inten) ) );\n    }\n    c /= float( MAX_ITER );\n    c = 1.17 - pow( c, 1.4 );\n    vec3 color = vec3( pow( abs(c), 8.0 ) );\n    color = saturate( baseColor + color );\n    return color;\n}",E.ToonShader={uniforms:{uDirLightPos:{value:new THREE.Vector3},uDirLightColor:{value:new THREE.Color(16777215)},uMaterialColor:{value:new THREE.Color(16777215)},uKd:{value:.97},uBorder:{value:.4}},vertexShader:["varying vec3 vNormal;","varying vec3 vViewPosition;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","}"].join("\n"),fragmentShader:["uniform vec3 uMaterialColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform float uKd;","uniform float uBorder;","varying vec3 vNormal;","varying vec3 vViewPosition;","void main() {","vec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );","vec3 lVector = normalize( lDirection.xyz );","vec3 normal = normalize( vNormal );","float diffuse = dot( normal, lVector );","if ( diffuse > 0.6 ) { diffuse = 1.0; }","else if ( diffuse > -0.2 ) { diffuse = 0.7; }","else { diffuse = 0.3; }","gl_FragColor = vec4( uKd * uMaterialColor * uDirLightColor * diffuse, 1.0 );","}"].join("\n")},E.SkyShader={uniforms:{turbidity:{value:10},rayleigh:{value:2},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},luminance:{value:1},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},E.SkyDomeShader={uniforms:{topColor:{value:new THREE.Color(30719)},bottomColor:{value:new THREE.Color(16777215)},offset:{value:33},exponent:{value:.6}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4(position, 1.0);","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","varying vec3 vWorldPosition;","void main() {","float h = normalize(vWorldPosition + offset).y;","gl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h, 0.0), exponent), 0.0)), 1.0);","}"].join("\n")},E.CloudDomeShader={uniforms:{noiseTex:{value:null},time:{value:1},sharp:{value:.9},cover:{value:.5},clouds:{value:1},depth:{value:0}},vertexShader:["uniform sampler2D noiseTex;","uniform float time;","varying vec2 vUv;","void main()","{","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform float depth;","uniform float sharp;","uniform float cover;","uniform float clouds;","uniform sampler2D noiseTex;","varying vec2 vUv;","vec3 noise3(vec2 p) {","\treturn texture2D(noiseTex, p).xyz;","}","vec3 fNoise(vec2 uv) {","\tvec3 f = vec3(0.0);","\tfloat scale = 1.;","\tfor (int i=0; i<5; i++) {","\t\tscale *= 2.0;","\t\tf += noise3(uv * scale) / scale;","\t}","\treturn f;","}","void main(void)","{","\tvec2 uv = vUv;","\tvec3 ff1 = fNoise(uv * 0.01 + time * 0.00015 * vec2(-1.0, 1.0));","\tvec3 ff2 = fNoise(uv * 0.1 + time * 0.0005 * vec2(1.0, 1.0));","\tfloat t = ff1.x * 0.9 + ff1.y * 0.15;","\tt = t * 0.99 + ff2.x * 0.01;","\tfloat o = clamp ( length(uv * 2.0 - vec2(1., 1.)), 0.0, 1.0 );","\to =  1.0 - o * o * o * o;","\to -= (1.0 - t) * 0.95;","\tt = max(t - (1.0 - cover), 0.0);","\tt = 1.0 - pow(1.0 - sharp, t);","\tt = min(t * 1.9, 1.0);","\tif (depth > 0.0) {","\t\tif (o < 0.4 && t < 0.8) discard;","\t\tgl_FragColor = vec4(gl_FragCoord.z, 1.0, 1.0, 1.0);","\t}","\telse {","\t\tgl_FragColor = vec4(t, t, t, o);","\t}","}"].join("\n")},E.RainDropShader={uniforms:{time:{value:0}},vertexShader:["precision highp float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float time;","attribute vec3 position;","attribute vec3 offset;","void main(void) {","vec3 translate = vec3(position.x, position.y - time, position.z);","gl_Position = projectionMatrix * modelViewMatrix * vec4(translate + offset, 1.0);","}"].join("\n"),fragmentShader:["precision highp float;","uniform float time;","void main(void) {","gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","}"].join("\n")},E.RainRippleShader={uniforms:{time:{value:0}},vertexShader:["precision highp float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","attribute vec3 position;","attribute vec3 offset;","varying vec3 vPosition;","varying vec3 vOffset;","void main(void) {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position.x + offset.x, 0.0, position.z + offset.z, 1.0);","vPosition = position;","vOffset = offset;","}"].join("\n"),fragmentShader:["precision highp float;","uniform float time;","varying vec3 vPosition;","varying vec3 vOffset;","void main(void) {","float a = abs(0.04 * time * vOffset.y - length(vPosition));","float b = 0.004 / a;","float c = step(0.9, b);","gl_FragColor = vec4(1.0, 1.0, 1.0, c);","}"].join("\n")},E.SmokeShader={uniforms:{time:{value:0},size:{value:3},smokeTex:{value:null},lifetime:{value:10},projection:{value:0}},vertexShader:["attribute float shift;","uniform float time;","uniform float size;","uniform float lifetime;","uniform float projection;","varying float progress;","float cubicOut( float t ) {","float f = t - 1.0;","return f * f * f + 1.0;","}","void main () {","progress = fract( time * 2.0 / lifetime + shift );","float eased = cubicOut( progress );","vec3 pos = vec3( position.x * eased, position.y * eased, position.z * eased  );","gl_Position = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );","gl_PointSize = ( projection * size ) / gl_Position.w;","}"].join("\n"),fragmentShader:["uniform sampler2D smokeTex;","varying float progress;","void main() {","vec3 color = vec3( 1.0 );","gl_FragColor = texture2D( smokeTex, gl_PointCoord ) * vec4( color, 0.3 * ( 1.0 - progress ) );","}"].join("\n")},E.VolumeFireShader={uniforms:{fireNoise:{value:null},fireProfile:{value:null},time:{value:1}},vertexShader:["attribute vec3 tex;","varying vec3 texOut;","void main ( void ) {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );","texOut = tex;","}"].join("\n"),fragmentShader:["uniform sampler2D fireNoise;","uniform sampler2D fireProfile;","uniform float time;","varying vec3 texOut;","const float modulus = 61.0;  // Value used in pregenerated noise texture.","const float magnatude = 1.3;","const int octives = 4;","const float lacunarity = 2.0;","const float gain = 0.5;","vec2 mBBS( vec2 val, float modulus ) {","val = mod( val, modulus ); // For numerical consistancy.","return mod(val * val, modulus);","}","float mnoise ( vec3 pos ) {","float intArg = floor( pos.z );","float fracArg = fract( pos.z );","vec2 hash = mBBS( intArg * 3.0 + vec2( 0.0, 3.0 ), modulus );","vec4 g = vec4 (","texture2D( fireNoise, vec2( pos.x, pos.y + hash.x ) / modulus ).xy,","texture2D( fireNoise, vec2( pos.x, pos.y + hash.y ) / modulus ).xy) * 2.0 - 1.0;","return mix(","g.x + g.y * fracArg,","g.z + g.w * ( fracArg - 1.0 ),","smoothstep( 0.0, 1.0, fracArg )",");","}","float turbulence( vec3 pos ) {","float sum  = 0.0;","float freq = 1.0;","float amp  = 1.0;","for ( int i = 0; i < 4; i++ ) {","sum += abs( mnoise( pos * freq ) ) * amp;","freq *= lacunarity;","amp *= gain;","}","return sum;","}","vec4 sampleFire( vec3 loc, vec4 scale ) {","loc.xz = loc.xz * 2.0 - 1.0;","vec2 st = vec2( sqrt( dot( loc.xz, loc.xz ) ), loc.y );","loc.y -= time * scale.w; // Scrolling noise upwards over time.","loc *= scale.xyz; // Scaling noise space.","float offset = sqrt( st.y ) * magnatude * turbulence( loc );","st.y += offset;","if ( st.y > 1.0 ) {","return vec4( 0.0, 0.0, 0.0, 1.0 );","}","vec4 result = texture2D( fireProfile, st );","if ( st.y < 0.1 ) {","result *= st.y / 0.1;","}","return result;","}","void main( void ) {","vec3 color = sampleFire( texOut, vec4( 1.0, 2.0, 1.0, 0.5 ) ).xyz;","gl_FragColor = vec4( color * 1.5, 1.0 );","}"].join("\n")},E.FireParticlesShader={uniforms:{color:{value:null},strength:{value:0},texture:{value:null},time:{value:0},heightOfNearPlane:{value:0}},vertexShader:["attribute float randam;","attribute float sprite;","uniform float time;","uniform float strength;","uniform float heightOfNearPlane;","varying float vSprite;","varying float vOpacity;","float PI = 3.14;","float quadraticIn( float t ) {","float tt = t * t;","return tt * tt;","}","void main() {","float progress = fract( time + ( 2.0 * randam - 1.0 ) );","float progressNeg = 1.0 - progress;","float ease = quadraticIn( progress );","float influence = sin( PI * ease );","vec3 newPosition = position * vec3( 1.0, ease, 1.0 );","gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","gl_PointSize = ( heightOfNearPlane * strength ) / gl_Position.w;","vOpacity = min( influence * 4.0, 1.0 ) * progressNeg;","vSprite = sprite;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D texture;","varying float vSprite;","varying float vOpacity;","float ONE_SPRITE_ROW_LENGTH = 0.25;","void main() {","vec2 texCoord = vec2(","gl_PointCoord.x * ONE_SPRITE_ROW_LENGTH + vSprite,","gl_PointCoord.y",");","gl_FragColor = vec4( texture2D( texture, vec2( texCoord ) ).xyz * color * vOpacity, 1.0 );","}"].join("\n")},E.GPUParticlesShader={uniforms:{uTime:{value:0},uScale:{value:1},tNoise:{value:null},tSprite:{value:null}},vertexShader:["uniform float uTime;","uniform float uScale;","uniform sampler2D tNoise;","attribute vec3 positionStart;","attribute float startTime;","attribute vec3 velocity;","attribute float turbulence;","attribute vec3 color;","attribute float size;","attribute float lifeTime;","varying vec4 vColor;","varying float lifeLeft;","void main() {","\tvColor = vec4( color, 1.0 );","\tvec3 newPosition;","\tvec3 v;","\tfloat timeElapsed = uTime - startTime;","\tlifeLeft = 1.0 - ( timeElapsed / lifeTime );","\tgl_PointSize = ( uScale * size ) * lifeLeft;","\tfloat velLength = length( velocity );","\tv.x = ( velocity.x - 0.5 ) * 3.0 * velLength;","\tv.y = ( velocity.y - 0.5 ) * 3.0 * velLength;","\tv.z = ( velocity.z - 0.5 ) * 3.0 * velLength;","\tnewPosition = positionStart + ( v * 10.0 ) * timeElapsed;","\tvec3 noise = texture2D( tNoise, vec2( newPosition.x * 0.015 + ( uTime * 0.05 ), newPosition.y * 0.02 + ( uTime * 0.015 ) ) ).rgb;","\tvec3 noiseVel = ( noise.rgb - 0.5 ) * 60.0 * velLength;","\tnewPosition = mix( newPosition, newPosition + vec3( noiseVel * turbulence ), ( timeElapsed / lifeTime ) );","\tif( v.y > 0.0 && v.y < 0.05 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( v.x < - 1.45 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( timeElapsed > 0.0 ) {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","\t} else {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\t\tlifeLeft = 0.0;","\t\tgl_PointSize = 0.0;","\t}","}"].join("\n"),fragmentShader:["float scaleLinear( float value, vec2 valueDomain ) {","\treturn ( value - valueDomain.x ) / ( valueDomain.y - valueDomain.x );","}","float scaleLinear( float value, vec2 valueDomain, vec2 valueRange ) {","\treturn mix( valueRange.x, valueRange.y, scaleLinear( value, valueDomain ) );","}","varying vec4 vColor;","varying float lifeLeft;","uniform sampler2D tSprite;","void main() {","\tfloat alpha = 0.0;","\tif( lifeLeft > 0.995 ) {","\t\talpha = scaleLinear( lifeLeft, vec2( 1.0, 0.995 ), vec2( 0.0, 1.0 ) );","\t} else {","\t\talpha = lifeLeft * 0.75;","\t}","\tvec4 tex = texture2D( tSprite, gl_PointCoord );","\tgl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );","}"].join("\n")},E.WaterShader={uniforms:{tReflectionMap:{value:null},tRefractionMap:{value:null},tNormalMap:{value:null},textureMatrix:{value:null},time:{value:0},alpha:{value:.7},reflectivity:{value:.02},noiseScale:{value:1},distortionScale:{value:.5},waterColor:{value:null},sunColor:{value:null},sunDirection:{value:null},tHeightMap:{value:null},terrainHeight:{value:0},terrainBottom:{value:0},tFoam:{value:null},tShore:{value:null},foamRanges:{value:new THREE.Vector2},foamIntensity:{value:0},shoreRange:{value:0},shoreColor:{value:new THREE.Color}},vertexShader:"\n\t\t#include <fog_pars_vertex>\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n        varying vec4 vWaterPosition;\n\t\tvoid main() {\n\t\t    vUv = uv;\n\t\t    vCoord = textureMatrix * vec4( position, 1.0 );\n\t\t    vWaterPosition = modelMatrix * vec4( position, 1.0 );\n\t\t    vec4 mvPosition = viewMatrix * vWaterPosition; // used in fog_vertex\n            gl_Position = projectionMatrix * mvPosition;\n\t\t    #include <fog_vertex>\n\t\t}\n\t",fragmentShader:`\n\t\t#include <common>\n\t\t#include <fog_pars_fragment>\n\t\tuniform sampler2D tReflectionMap;\n\t\tuniform sampler2D tRefractionMap;\n\t\tuniform sampler2D tNormalMap;\n\t\tuniform float time;\n\t\tuniform float alpha;\n\t\tuniform float reflectivity;\n\t\tuniform float noiseScale;\n\t\tuniform float distortionScale;\n\t\tuniform vec3 waterColor;\n\t\tuniform vec3 sunColor;\n        uniform vec3 sunDirection;\n    #ifdef USE_HEIGHTMAP\n        uniform sampler2D tHeightMap;\n        uniform float terrainHeight; // height size of terrain\n        uniform float terrainBottom; // bottom y coord of terrain\n        uniform sampler2D tFoam;\n        uniform sampler2D tShore;\n        uniform vec2 foamRanges; // x = range for shore foam, y = range for near shore foam\n        uniform float foamIntensity;\n        uniform float shoreRange;\n        uniform vec3 shoreColor;\n    #endif\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n        varying vec4 vWaterPosition;\n        vec4 getNoise( vec2 uv )\n        {\n\t\t    vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n\t\t    vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n\t\t    vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n\t\t    vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n\t\t    vec4 noise = texture2D( tNormalMap, uv0 ) +\n\t\t    \ttexture2D( tNormalMap, uv1 ) +\n\t\t    \ttexture2D( tNormalMap, uv2 ) +\n\t\t    \ttexture2D( tNormalMap, uv3 );\n\t\t    return noise * 0.5 - 1.0;\n\t\t}\n        void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor )\n        {\n\t\t    vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n\t\t    float direction = max( 0.0, dot( eyeDirection, reflection ) );\n\t\t    specularColor += pow( direction, shiny ) * sunColor * spec;\n\t\t    diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n        }\n    #ifdef USE_HEIGHTMAP\n        float getWaterDepth( vec2 uv, float waterY )\n        {\n            float h = texture2D( tHeightMap, uv ).x * terrainHeight;\n            return waterY - (terrainBottom + h);\n        }\n        vec3 depthRefraction( float waterDepth, vec3 waterPos, vec3 refractColor )\n        {\n            // const vec3 deepWaterColor = vec3(0.031, 0.101, 0.349);\n            const vec3 deepWaterColor = vec3(0.0, 0.007, 0.121);\n            const float waterClarity = 0.25;\n            const float visibility = 10.0;\n\n            // (cf) waterExtinction: (r,g,b) die out at water depth = (4.5(m), 75(m), 300(m))\n            // (cf) Assumed max_depth of water (in this scene) = 600 (m)\n            float extinctScale = (waterPos.y - terrainBottom) / 600.0;\n            vec3 waterExtinction = vec3(4.5, 75.0, 300.0) * extinctScale;\n\n            float eyeToWater = length( cameraPosition - waterPos );\n            float eyeToBottom = cameraPosition.y - terrainBottom;\n            float viewWaterDepth = eyeToWater * waterDepth / (eyeToBottom - waterDepth);\n\n            float accDepth = viewWaterDepth * waterClarity; // accumulated water depth\n            float accDepthExp = saturate( accDepth / (2.5 * visibility) );\n            // accDepthExp *= (1.0 - accDepthExp) * accDepthExp * accDepthExp + 1.0; // out cubic\n\n            float shoreRange = max( foamRanges.x, foamRanges.y ) * 2.0;\n            vec3 waterColorS = mix( shoreColor, waterColor, saturate(waterDepth/shoreRange) );\n            vec3 waterColorD = mix( waterColorS, deepWaterColor, saturate(waterDepth/waterExtinction) );\n\n            refractColor = mix( refractColor, waterColorS * waterColorD, saturate(accDepth/visibility) );\n            refractColor = mix( refractColor, deepWaterColor, accDepthExp );\n            refractColor = mix( refractColor, deepWaterColor * waterColorD, saturate(waterDepth/waterExtinction) );\n            return refractColor;\n        }\n        float foamColor( sampler2D tex, vec2 uv, vec2 uv2, vec2 ranges, vec2 factors, float waterDepth, float baseColor )\n        {\n            float f1 = texture2D(tex, uv).r;\n            float f2 = texture2D(tex, uv2).r;\n            return mix( f1*factors.x + f2*factors.y, baseColor, smoothstep(ranges.x, ranges.y, waterDepth) );\n        }\n        float foamValue( float waterDepth, vec3 waterPos )\n        {\n            const float foamSpeed = 10.0;\n            const vec2 foamNoise = vec2(0.37, 0.5); // (shore,outer)\n            const vec2 noiseSpeed = vec2(-0.3, 0.05); // (shore,outer)\n            const vec2 foamTiling = vec2(2.0, 0.5);\n\n            float s = sin(time*0.01 + waterPos.x);\n            vec2 uv = waterPos.xz + foamSpeed + s * 0.05;\n            s = sin(time*0.01 + waterPos.z);\n            vec2 uv2 = (waterPos.xz + foamSpeed*1.5 + s * 0.05) * 0.5;\n            vec2 uv3 = uv * foamTiling.x;\n            vec2 uv4 = (waterPos.xz + foamSpeed*1.5*(-0.3) + s * 0.05) * 0.5 * foamTiling.y;\n            uv *= foamTiling.y;\n            uv2 *= foamTiling.y;\n\n            vec2 ranges = foamRanges;\n            ranges.x += rand( waterPos.xz + noiseSpeed.x ) * foamNoise.x;\n            ranges.y += rand( waterPos.xz + noiseSpeed.y ) * foamNoise.y;\n            ranges = clamp(ranges, 0.0, 10.0);\n\n            float foamEdge = max( ranges.x, ranges.y );\n            float deepFoam = foamColor( tFoam, uv, uv2, vec2(ranges.x, foamEdge), vec2(1.0, 0.5), waterDepth, 0.0 );\n            float foam = foamColor( tShore, uv3*0.25, uv4, vec2(0.0, ranges.x), vec2(0.75, 1.5), waterDepth, deepFoam );\n            return foam;\n        }\n    #endif\n    #ifdef USE_CAUSTICS\n        ${E.ShaderChunk.caustics}\n    #endif\n        void main()\n        {\n\t\t    vec4 noise = getNoise( vWaterPosition.xz * noiseScale );\n            vec3 waterNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n            vec3 waterToEye = cameraPosition - vWaterPosition.xyz;\n            vec3 eyeDirection = normalize( waterToEye );\n\n            // fresnel\n            float dotNV = max( dot( eyeDirection, waterNormal ), 0.0 );\n            // float fresnel = mix( 1.0 - dotNV, 1.0, reflectivity ); // reflectance\n            float fresnel = mix( 0.1*(1.0 - dotNV), 1.0, reflectivity ); // reflectance\n\n            // sun light\n\t\t    vec3 diffuseLight = vec3(0.0);\n            vec3 specularLight = vec3(0.0);\n            sunLight( waterNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\n            // diffuse\n            vec3 diffuseColor = saturate( diffuseLight * waterColor );\n\n            // (pure) reflection & refraction\n\t\t    vec3 coord = vCoord.xyz / vCoord.w;\n\t\t    vec2 uv = coord.xy + coord.z * waterNormal.xz * 0.05 * distortionScale;\n            vec3 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) ).rgb;\n            vec3 refractColor = texture2D( tRefractionMap, uv ).rgb;\n\n            // set reflectColor = refractColor when looking up in the water\n            reflectColor = mix( refractColor, reflectColor, step(0.0, eyeDirection.y) );\n\n        #ifdef USE_HEIGHTMAP\n            // water depth\n            float waterDepth = getWaterDepth( vUv, vWaterPosition.y );\n\n            // refract based on water depth\n            vec3 refractColorD = depthRefraction( waterDepth, vWaterPosition.xyz, refractColor );\n\n            // foam\n            float foam = foamValue( waterDepth, vWaterPosition.xyz );\n            foam *= foamIntensity;\n\n            // shoreFade\n            float shoreFade = 0.2;\n            shoreFade = saturate( waterDepth * shoreFade );\n\n            // refraction\n            refractColor = mix( refractColor, reflectColor, fresnel * saturate( waterDepth / (foamRanges.x * 0.4) ) );\n            refractColor = mix( refractColor, shoreColor, 0.30 * shoreFade );\n\n            // final color\n            vec3 color = mix( refractColorD, reflectColor, fresnel );\n            color = saturate( diffuseColor + color + max( specularLight, foam * sunColor ) );\n            color = mix( refractColor + specularLight*shoreFade, color, shoreFade );\n        #else\n            vec3 color = mix( diffuseColor + refractColor, specularLight + reflectColor, fresnel );\n        #endif\n\n        #ifdef USE_CAUSTICS\n            color += caustics( vUv, 8.0, vec3(0.0) ) * 0.5;\n        #endif\n\n            gl_FragColor = vec4( color, alpha );\n\n\t\t    #include <tonemapping_fragment>\n\t\t    #include <fog_fragment>\n\t\t}\n\t`},E.WaterFlowShader={uniforms:{tReflectionMap:{value:null},tRefractionMap:{value:null},tNormalMap0:{value:null},tNormalMap1:{value:null},textureMatrix:{value:null},config:{value:new THREE.Vector3},time:{value:0},alpha:{value:.7},reflectivity:{value:.02},noiseScale:{value:1},distortionScale:{value:.5},waterColor:{value:null},sunColor:{value:null},sunDirection:{value:null}},vertexShader:"\n\t\t#include <fog_pars_vertex>\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vWaterPosition;\n\t\tvoid main() {\n\t\t    vUv = uv;\n\t\t    vCoord = textureMatrix * vec4( position, 1.0 );\n\t\t    vWaterPosition = modelMatrix * vec4( position, 1.0 );\n\t\t    vec4 mvPosition = viewMatrix * vWaterPosition; // used in fog_vertex\n\t\t    gl_Position = projectionMatrix * mvPosition;\n\t\t    #include <fog_vertex>\n\t\t}\n\t",fragmentShader:"\n\t\t#include <common>\n\t\t#include <fog_pars_fragment>\n\t\tuniform sampler2D tReflectionMap;\n\t\tuniform sampler2D tRefractionMap;\n\t\tuniform sampler2D tNormalMap0;\n\t\tuniform sampler2D tNormalMap1;\n\t\tuniform vec3 config;\n\t\t#ifdef USE_FLOWMAP\n\t\t    uniform sampler2D tFlowMap;\n\t\t#else\n\t\t    uniform vec2 flowDirection;\n\t\t#endif\n\t\tuniform float time;\n\t\tuniform float alpha;\n\t\tuniform float reflectivity;\n\t\tuniform float noiseScale;\n\t\tuniform float distortionScale;\n\t\tuniform vec3 waterColor;\n\t\tuniform vec3 sunColor;\n\t\tuniform vec3 sunDirection;\n\t\tvarying vec4 vCoord;\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vWaterPosition;\n\t\tvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n\t\t    vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n\t\t    float direction = max( 0.0, dot( eyeDirection, reflection ) );\n\t\t    specularColor += pow( direction, shiny ) * sunColor * spec;\n\t\t    diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n\t\t}\n\t\tvoid main() {\n\t\t    float flowMapOffset0 = config.x;\n\t\t    float flowMapOffset1 = config.y;\n\t\t    float halfCycle = config.z;\n\t\t    vec3 waterToEye = cameraPosition - vWaterPosition.xyz;\n\t\t    vec3 eyeDirection = normalize( waterToEye );\n\t\t    vec2 flow;\n\t\t    #ifdef USE_FLOWMAP\n\t\t    \tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;\n\t\t    #else\n\t\t    \tflow = flowDirection;\n\t\t    #endif\n\t\t    flow.x *= - 1.0;\n\t\t    vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * noiseScale ) + flow * flowMapOffset0 );\n\t\t    vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * noiseScale ) + flow * flowMapOffset1 );\n\t\t    float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n\t\t    vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n\t\t    vec3 waterNormal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n\t\t    vec3 diffuseLight = vec3(0.0);\n\t\t    vec3 specularLight = vec3(0.0);\n\t\t    sunLight( waterNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\t\t    float dotNV = max( dot( eyeDirection, waterNormal ), 0.0 );\n\t\t    float reflectance = mix( 1.0 - dotNV, 1.0, reflectivity ); // fresnel\n\t\t    vec3 coord = vCoord.xyz / vCoord.w;\n\t\t    vec2 uv = coord.xy + coord.z * waterNormal.xz * 0.05 * distortionScale;\n\t\t    vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );\n\t\t    vec4 refractColor = texture2D( tRefractionMap, uv );\n\t\t    vec3 reflected = reflectColor.rgb + specularLight;\n\t\t    vec3 refracted = refractColor.rgb + diffuseLight * waterColor;\n\t\t    vec3 color = mix( refracted, reflected, reflectance );\n\t\t    gl_FragColor = vec4( color, alpha );\n\t\t    #include <tonemapping_fragment>\n\t\t    #include <fog_fragment>\n\t\t}\n\t"},E.NoiseShader={uniforms:{scale:{value:10}},vertexShader:["varying vec3 vPosition;","varying vec2 vUv;","void main() {","vPosition = normalize(position);","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);","}"].join("\n"),fragmentShader:["varying vec3 vPosition;","varying vec2 vUv;","uniform float scale;",E.ShaderChunk.mod289,E.ShaderChunk.permute,E.ShaderChunk.taylorInvSqrt,E.ShaderChunk.snoise3,"void main() {","float n = snoise(vPosition * scale);","n = n*0.5 + 0.5;","gl_FragColor = vec4(n, n, n, 1.0);","}"].join("\n")},E.TerrainHeightShader={uniforms:{landscape:{value:5},scale:{value:new THREE.Vector2(1.5,1.5)},offset:{value:new THREE.Vector2(0,0)}},vertexShader:["uniform vec2 scale;","uniform vec2 offset;","varying vec2 vUv;","void main( void ) {","vUv = uv * scale + offset;","gl_Position = projectionMatrix * (modelViewMatrix * vec4( position, 1.0 ));","}"].join("\n"),fragmentShader:["uniform int landscape;","varying vec2 vUv;",E.ShaderChunk.hash,E.ShaderChunk.noise2,E.ShaderChunk.mod289,E.ShaderChunk.permute,E.ShaderChunk.snoise2,E.ShaderChunk.fbm2IQ,"#define BADLAND_TERRAIN\t\t0\t// used for bandland terrains","#define MOUNTAIN_TERRAIN\t\t1\t// used for mountainous terrains","#define DOME_TERRAIN\t\t\t2\t// used for dome-shaped terrains","#define RIDGE_TERRAIN\t\t\t3\t// used for sharp-shaped terrains","#define DESIGN_TERRAIN\t\t\t4\t// used for user-defined terrains","#define GIANT_TERRAIN\t\t\t5\t// used for giant terrains","#define TRIANGLE_TERRAIN\t\t6\t// used for triangle terrains","float badlandTerrain(vec2 p){","const int octaves = 5;","float flatten = 1.0;","mat2 m2 = mat2(0.8,-0.6,0.6,0.8);","float a = 0.0;","float b = 0.5;","float d = 0.0;","for(int i=0; i<octaves; i++)","{","float n = snoise(p);","d += n;","a += b*n/(1.0+d*d);","b *= 0.5;","p = m2*(p*2.0);","}","return pow(a, flatten);","}","float mountainTerrain(vec2 p){","const int octaves = 5;","float flatten = 2.0;","float v = 0.0;","float a = 0.5;","vec2 shift = vec2(100.0);","for(int i=0; i<octaves; i++)","{","v += a * snoise(p);","p = p * 2.0 + shift;","a *= 0.5;","}","return pow(v*0.5 + 0.5, flatten);","}","float domeTerrain(vec2 p){","const int octaves = 2;","float flatten = 1.5;","float v = 0.0;","float a = 0.5;","vec2 shift = vec2(100.0);","for(int i=0; i<octaves; i++)","{","v += a * abs( snoise(p) );","p = p * 2.0 + shift;","a *= 0.5;","}","return pow(v, flatten);","}","float ridgeTerrain(vec2 p){","const int octaves = 5;","float flatten = 2.0;","float v = 0.0;","float a = 0.5;","vec2 shift = vec2(100.0);","for(int i=0; i<octaves; i++)","{","float n = 1.0 - abs( snoise(p) );","v += a * (n*n);","p = p * 2.0 + shift;","a *= 0.5;","}","return pow(v, flatten);","}","float designTerrain(vec2 p){","float ridgeTerrain = ridgeTerrain(p*9.0);","float flatTerrain = mountainTerrain(p*2.0);","float ctrlTerrain = domeTerrain(p);","ctrlTerrain += 0.25 * ctrlTerrain;","float e = ctrlTerrain / 100.0;","const float b = 0.5;","const float off = 0.05;","return mix( flatTerrain, ridgeTerrain, smoothstep(b-off, b+off, e) );","}","float giantTerrain(vec2 p){","mat2 m2 = mat2(1.3623, 1.7531, -1.7131, 1.4623);","const int octaves = 5;","float flatten = 2.0;","vec2 pos = p*5.0;","float w = fbmIQ(pos*0.25)*0.75+0.25;","w = 2.0 * w * w;","float f = 0.0;","for(int i = 0; i < octaves; i++){","f += w * fbmIQ(pos);","w = -w * 0.5;","pos = m2 * pos;","}","float ff = fbmIQ(pos*0.002);","f += pow(abs(ff), 10.0);","return pow(f, flatten);","}","float tri(float x){ return abs(fract(x)-0.5); }","float triXY(vec2 p){ return tri(p.x+tri((p.y-0.25)*1.5)) + tri(p.y-tri((p.x+0.5)*1.5)); }","float triSmooth(float x){ return 0.25+0.25*cos((x)*6.2831853); }","float triSmoothXY(vec2 p){ return triSmooth(p.x+triSmooth((p.y-0.25)*1.5)) + triSmooth(p.y-triSmooth((p.x+0.5)*1.5)); }","float smoothCurve(float x) {","x = max((x - 0.3)/0.7, 0.0);","return x*x*(3.0 - 2.0*x);","}","float triangleTerrain(vec2 p){","p *= 2.0;","float h = triSmoothXY( p/2.0 )*0.66 + triSmoothXY( p/1.0 )*0.34;","h = smoothCurve( h )*0.75 + triXY( p/1.0 )*0.15 + triXY( p*4.0 )*0.1;","return h * 0.75;","}","float terrain( int type, vec2 p ){","float h = 0.0;","p *= 3.0;","if( type == BADLAND_TERRAIN ) h = badlandTerrain(p);","else if( type == MOUNTAIN_TERRAIN ) h = mountainTerrain(p);","else if( type == DOME_TERRAIN ) h = domeTerrain(p);","else if( type == RIDGE_TERRAIN ) h = ridgeTerrain(p);","else if( type == DESIGN_TERRAIN ) h = designTerrain(p);","else if( type == GIANT_TERRAIN ) h = giantTerrain(p);","else if( type == TRIANGLE_TERRAIN ) h = triangleTerrain(p);","return h;","}","void main(){","float h = terrain( landscape, vUv );","gl_FragColor = vec4( h, h, h, 1.0 );","}"].join("\n")},E.TerrainNormalShader={uniforms:{tHeight:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tHeight;","varying vec2 vUv;","float terrainHeight( in sampler2D tex, in vec2 uv ) {","return texture2D( tex, uv ).x;","}","vec3 terrainNormal( in sampler2D tex, in vec3 p, in float tol ) {","vec2 eps = vec2( 0.002*tol, 0.0 );","return normalize( vec3(","terrainHeight(tex, p.xz-eps.xy) - terrainHeight(tex, p.xz+eps.xy),","2.0*eps.x,","terrainHeight(tex, p.xz-eps.yx) - terrainHeight(tex, p.xz+eps.yx)));","}","void main() {","vec3 normal = terrainNormal( tHeight, vec3( vUv.x, 0.0, vUv.y ), 1.0 );","gl_FragColor = vec4( 0.5*normal.xzy + 0.5, 1.0 );","}"].join("\n")},E.CurlNoiseParticleShader={uniforms:{time:{value:0},tPosition:{value:null},color1:{value:null},color2:{value:null},opacity:{value:.75},sizeBase:{value:0},sizeExtra:{value:9.9},hardness:{value:.16},emitPos:{value:new THREE.Vector3(0,0,0)},emitVec:{value:new THREE.Vector3(0,1,0)}},vertexShader:["varying float vColor;","varying float vAlpha;","uniform sampler2D tPosition;","uniform float opacity;","uniform float sizeBase;","uniform float sizeExtra;","uniform vec3 emitPos;","uniform vec3 emitVec;",E.ShaderChunk.random,"void main() {","float emitLength = length(emitVec);","vec3 emitDir = emitVec / emitLength;","vec3 pos = texture2D( tPosition, uv ).xyz;","float t = dot(emitDir, pos - emitPos);","if( t < 0.0 ) { pos = pos - t*emitDir; t = 0.0; }","vec3 tpos = emitPos + t*emitDir;","vec3 rvec = pos - tpos;","float r = (1.0 - cos(smoothstep(0.0, 0.2*emitLength, t) * 3.141592654)) * 0.5;","pos = pos + (r-1.0) * rvec;","vColor = random(uv + vec2(23.0, 31.22));","gl_Position = projectionMatrix * viewMatrix  * vec4( pos, 1.0 );","vAlpha = smoothstep(0.8*emitLength + 0.2*emitLength*random(uv + 1.0), 0.7*emitLength, t);","vAlpha *= clamp(1000.0 / gl_Position.z, 0.0, 1.0) * opacity;","gl_PointSize = (sizeBase + random(uv) * sizeExtra) * (500.0 / gl_Position.z);","}"].join("\n"),fragmentShader:["varying float vColor;","varying float vAlpha;","uniform vec3 color1;","uniform vec3 color2;","uniform float hardness;","uniform float time;","void main() {","float d = length(gl_PointCoord.xy - .5) * 2.0;","if( d > 1.0 ) discard;","float c = 1.0 - smoothstep(hardness, 1.0, d);","gl_FragColor = vec4(mix(color1, color2, vColor) * c, 1.0) * vAlpha;","}"].join("\n")},E.CurlNoiseCopyShader={uniforms:{resolution:{value:null},texture:{value:null}},vertexShader:["void main() {","gl_Position = vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 resolution;","uniform sampler2D texture;","void main() {","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 color = texture2D( texture, uv ).xyz;","gl_FragColor = vec4( color, 1.0 );","}"].join("\n")},E.CurlNoiseVelocityShader={uniforms:{time:{value:0},tPosition:{value:null},resolution:{value:null},speed:{value:1},emitPos:{value:new THREE.Vector3(0,0,0)},emitVec:{value:new THREE.Vector3(1,0,0)}},vertexShader:["void main() {","gl_Position = vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 resolution;","uniform sampler2D tPosition;","uniform float speed;","uniform vec3 emitPos;","uniform vec3 emitVec;",E.ShaderChunk.mod289,E.ShaderChunk.permute,E.ShaderChunk.taylorInvSqrt,E.ShaderChunk.snoise3,E.ShaderChunk.random,"vec3 snoiseVec3( vec3 x ){","float s  = snoise(vec3( x ));","float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));","float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));","vec3 c = vec3( s , s1 , s2 );","return c;","}","vec3 curlNoise( vec3 p ){","const float e = .1;","vec3 dx = vec3( e   , 0.0 , 0.0 );","vec3 dy = vec3( 0.0 , e   , 0.0 );","vec3 dz = vec3( 0.0 , 0.0 , e   );","vec3 p_x0 = snoiseVec3( p - dx );","vec3 p_x1 = snoiseVec3( p + dx );","vec3 p_y0 = snoiseVec3( p - dy );","vec3 p_y1 = snoiseVec3( p + dy );","vec3 p_z0 = snoiseVec3( p - dz );","vec3 p_z1 = snoiseVec3( p + dz );","float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;","float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;","float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;","const float divisor = 1.0 / ( 2.0 * e );","return normalize( vec3( x , y , z ) * divisor );","}","void main() {","float emitLength = length(emitVec);","vec3 emitDir = emitVec / emitLength;","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 position = texture2D( tPosition, uv ).xyz;","vec3 velocity = curlNoise(position * 0.02) * 0.1;","float t = dot(emitDir, position - emitPos);","float v = pow(smoothstep(0.0, emitLength, t), 2.0);","v = 0.05 + v * (0.2 + random(uv) * 0.2);","v = clamp(v, 0.01, 5.0);","velocity += emitDir * v;","velocity *= speed;","gl_FragColor = vec4( velocity, 1.0 );","}"].join("\n")},E.CurlNoiseVelocity4dShader={uniforms:{time:{value:0},tPosition:{value:null},resolution:{value:null},speed:{value:1},emitPos:{value:new THREE.Vector3(0,0,0)},emitVec:{value:new THREE.Vector3(1,0,0)}},vertexShader:["void main() {","gl_Position = vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 resolution;","uniform sampler2D tPosition;","uniform float time;","uniform float speed;","uniform vec3 emitPos;","uniform vec3 emitVec;",E.ShaderChunk.mod289,E.ShaderChunk.permute,E.ShaderChunk.taylorInvSqrt,E.ShaderChunk.grad4,E.ShaderChunk.snoise4,E.ShaderChunk.random,"vec4 snoiseVec4( vec4 x ){","float s  = snoise(vec4( x ));","float s1 = snoise(vec4( x.y - 19.1 , x.z + 33.4 , x.w + 47.2 , x.x + 12.2 ));","float s2 = snoise(vec4( x.z + 74.2 , x.w - 124.5 , x.x + 99.4 , x.y - 123.2 ));","float s3 = snoise(vec4( x.w + 21.2 , x.x - 52.5 , x.y + 60.4 , x.z + 42.2 ));","vec4 c = vec4( s , s1 , s2 , s3 );","return c;","}","vec4 curlNoise( vec4 p ){","const float e = .1;","vec4 dx = vec4( e   , 0.0 , 0.0 , 0.0 );","vec4 dy = vec4( 0.0 , e   , 0.0 , 0.0 );","vec4 dz = vec4( 0.0 , 0.0 , e   , 0.0 );","vec4 dw = vec4( 0.0 , 0.0 , 0.0 , e  );","vec4 p_x0 = snoiseVec4( p - dx );","vec4 p_x1 = snoiseVec4( p + dx );","vec4 p_y0 = snoiseVec4( p - dy );","vec4 p_y1 = snoiseVec4( p + dy );","vec4 p_z0 = snoiseVec4( p - dz );","vec4 p_z1 = snoiseVec4( p + dz );","vec4 p_w0 = snoiseVec4( p - dw );","vec4 p_w1 = snoiseVec4( p + dw );","float x = p_y1.z - p_y0.z - p_z1.w + p_z0.w + p_w0.y - p_w1.y;","float y = p_z1.w - p_z0.w - p_w1.x + p_w0.x + p_x0.z - p_x1.z;","float z = p_w1.x - p_w0.x - p_x1.y + p_x0.y + p_y0.w - p_y1.w;","float w = p_x1.y - p_x0.y - p_y1.z + p_y0.z + p_z0.x - p_y1.x;","const float divisor = 1.0 / ( 2.0 * e );","return normalize( vec4( x , y , z, w ) * divisor );","}","void main() {","float emitLength = length(emitVec);","vec3 emitDir = emitVec / emitLength;","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 position = texture2D( tPosition, uv ).xyz;","vec3 velocity = curlNoise(vec4(position * 0.02, time * 0.001 * speed)).xyz * 0.1;","float t = dot(emitDir, position - emitPos);","float l = pow(smoothstep(0.0, emitLength, t), 2.0);","l = 0.05 + l * (0.2 + random(uv) * 0.2);","l = clamp(l, 0.01, 5.0);","velocity += emitDir * l;","velocity *= speed;","gl_FragColor = vec4( velocity, 1.0 );","}"].join("\n")},E.CurlNoisePositionShader={uniforms:{delta:{value:0},tPosition:{value:null},tVelocity:{value:null},resolution:{value:null},spread:{value:.1},emitPos:{value:new THREE.Vector3(0,0,0)},emitVec:{value:new THREE.Vector3(1,0,0)}},vertexShader:["void main() {","gl_Position = vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 resolution;","uniform sampler2D tVelocity;","uniform sampler2D tPosition;","uniform float delta;","uniform vec3 emitPos;","uniform vec3 emitVec;","uniform float spread;",E.ShaderChunk.random,"void main() {","float emitLength = length(emitVec);","vec3 emitDir = emitVec / emitLength;","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 position = texture2D( tPosition, uv ).xyz;","vec3 velocity = texture2D( tVelocity, uv ).xyz;","position += velocity * delta * 1.0;","float t = dot(emitDir, position - emitPos);","if(t > emitLength) {","position = emitPos;","position.x += emitLength*spread*(random(uv + vec2(21.3, 63.21))-0.5);","position.y += emitLength*spread*(random(uv + vec2(32.3, 734.21))-0.5);","position.z += emitLength*spread*(random(uv + vec2(127.3, 31.21))-0.5);","}","gl_FragColor = vec4( position, 1.0 );","}"].join("\n")},E.ShaderChunk.fishAnimation=["#define twoPI 6.28318530718","vec3 fishAnimation( vec3 position )","{","float wave_factor = 0.0001;","float twist_factor = 0.0001;","float bend_factor = 0.1;","float speed_factor = 1.0 + 3.0 * smoothstep( 20.0, 0.1, fishLength );","float curTime = time * speed_factor + fishSpeed;","vec3 new_pos = position;","vec3 tmp_pos = position;","float head_z = fishLength/2.0;","float tail_z = -fishLength/2.0;","float z = position.z;","z = (z - head_z) / (tail_z - head_z);","z = smoothstep( 0.0, 1.0, z );","float wave_ang = cos( (curTime - z) * twoPI ) * wave_factor * z;","new_pos.x += wave_ang;","float twist_ang = cos( (curTime - z) * twoPI ) * twist_factor;","float twist_cos = cos( twist_ang );","float twist_sin = sin( twist_ang );","tmp_pos.x = new_pos.x * twist_cos - new_pos.y * twist_sin;","tmp_pos.y = new_pos.x * twist_sin + new_pos.y * twist_cos;","new_pos = tmp_pos;","float bend_ang = cos( (curTime - z) * twoPI ) * bend_factor * z;","float bend_cos = cos( bend_ang );","float bend_sin = sin( bend_ang );","tmp_pos.x = new_pos.x * bend_cos - new_pos.z * bend_sin;","tmp_pos.z = new_pos.x * bend_sin + new_pos.z * bend_cos;","new_pos = tmp_pos;","return new_pos;","}"].join("\n"),E.BoidsPositionShader={uniforms:{time:{value:0},delta:{value:0},bounds:{value:new THREE.Vector3(1e3,1e3,1e3)},central:{value:new THREE.Vector3(0,0,0)}},fragmentShader:["uniform float time;","uniform float delta;","uniform vec3 bounds;","uniform vec3 central;","void main() {","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec4 tmpPos = texture2D( tPosition, uv );","vec3 position = tmpPos.xyz;","vec3 velocity = texture2D( tVelocity, uv ).xyz;","float phase = tmpPos.w;","phase = mod( ( phase + delta +","length( velocity ) * delta * 6.0 ), 62.83 );","vec3 fragPos = position + velocity * delta * 15.0;","vec3 minBound = central - bounds * 0.5;","vec3 maxBound = central + bounds * 0.5;","fragPos = clamp( fragPos, minBound, maxBound );","gl_FragColor = vec4( fragPos, phase );","}"].join("\n")},E.BoidsVelocityShader={uniforms:{time:{value:0},delta:{value:0},seperationDistance:{value:20},alignmentDistance:{value:20},cohesionDistance:{value:20},bounds:{value:new THREE.Vector3(1e3,1e3,1e3)},central:{value:new THREE.Vector3(0,0,0)},speedLimit:{value:9},predator:{value:new THREE.Vector3}},fragmentShader:["uniform float time;","uniform float delta;","uniform float seperationDistance;","uniform float alignmentDistance;","uniform float cohesionDistance;","uniform vec3 bounds;","uniform vec3 central;","uniform float speedLimit;","uniform vec3 predator;","const float width = resolution.x;","const float height = resolution.y;","const float PI = 3.141592653589793;","const float PI_2 = PI * 2.0;","float zoneRadius = 40.0;","float zoneRadiusSquared = 1600.0;","float separationThresh = 0.45;","float alignmentThresh = 0.65;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","zoneRadius = seperationDistance + alignmentDistance + cohesionDistance;","separationThresh = seperationDistance / zoneRadius;","alignmentThresh = ( seperationDistance + alignmentDistance ) / zoneRadius;","zoneRadiusSquared = zoneRadius * zoneRadius;","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 birdPosition, birdVelocity;","vec3 selfPosition = texture2D( tPosition, uv ).xyz;","vec3 selfVelocity = texture2D( tVelocity, uv ).xyz;","float dist;","vec3 dir;","float distSquared;","float seperationSquared = seperationDistance * seperationDistance;","float cohesionSquared = cohesionDistance * cohesionDistance;","float f;","float percent;","vec3 velocity = selfVelocity;","float limit = speedLimit;","dir = predator * bounds - selfPosition;","dist = length( dir );","distSquared = dist * dist;","float preyRadius = 50.0;","float preyRadiusSq = preyRadius * preyRadius;","if (dist < preyRadius) {","f = ( distSquared / preyRadiusSq - 1.0 ) * delta * 10.0;","velocity += normalize( dir ) * f;","limit = min( limit*3.0, limit+5.0 );","}","dir = selfPosition - central;","dist = length( dir );","velocity -= normalize( dir ) * delta * 5.0;","for( float y = 0.0; y < height; y++ )","{","for( float x = 0.0; x < width; x++)","{","vec2 ref = vec2( x + 0.5, y + 0.5 ) / resolution.xy;","birdPosition = texture2D( tPosition, ref ).xyz;","dir = birdPosition - selfPosition;","dist = length(dir);","if (dist < 0.0001) continue;","distSquared = dist * dist;","if (distSquared > zoneRadiusSquared ) continue;","percent = distSquared / zoneRadiusSquared;","if ( percent < separationThresh ) { // low","f = (separationThresh / percent - 1.0) * delta;","velocity -= normalize(dir) * f;","} else if ( percent < alignmentThresh ) { // high","float threshDelta = alignmentThresh - separationThresh;","float adjustedPercent = ( percent - separationThresh ) / threshDelta;","birdVelocity = texture2D( tVelocity, ref ).xyz;","f = ( 0.5 - cos( adjustedPercent * PI_2 ) * 0.5 + 0.5 ) * delta;","velocity += normalize(birdVelocity) * f;","} else {","float threshDelta = 1.0 - alignmentThresh;","float adjustedPercent = ( percent - alignmentThresh ) / threshDelta;","f = ( 0.5 - ( cos( adjustedPercent * PI_2 ) * -0.5 + 0.5 ) ) * delta;","velocity += normalize(dir) * f;","}","}","}","if ( length( velocity ) > limit ) {","velocity = normalize( velocity ) * limit;","}","gl_FragColor = vec4( velocity, 1.0 );","}"].join("\n")},E.BoidsDrawShader={uniforms:{time:{value:0},boidType:{value:0},boidLength:{value:0},color:{value:new THREE.Color(16777215)},tDiffuse:{value:new THREE.Texture},tSpecular:{value:new THREE.Texture},tPosition:{value:new THREE.Texture},tVelocity:{value:new THREE.Texture}},vertexShader:["#define twoPI 6.28318530718","attribute vec2 boidSite;","attribute vec3 boidColor;","attribute float boidVertex;","uniform int boidType;","uniform float boidLength;","uniform sampler2D tPosition;","uniform sampler2D tVelocity;","uniform float time;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vColor;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,E.ShaderChunk.random,"vec3 fishAnimation( vec3 pos )","{","float r = random( boidSite );","float h = r - 0.5;","float wave_factor = 0.4;","float twist_factor = 0.3 * h;","float bend_factor = 0.2 * h;","float speed_factor = length( texture2D( tVelocity, boidSite ).xyz );","speed_factor = log(speed_factor + 1.0) * 3.0;","speed_factor = clamp( speed_factor, 1.0, 3.0 );","float curTime = time * speed_factor;","vec3 new_pos = pos;","vec3 tmp_pos = pos;","float head_z = boidLength/2.0;","float tail_z = -boidLength/2.0;","float z = pos.z;","z = (z - head_z) / (tail_z - head_z);","z = smoothstep( 0.0, 1.0, z );","float wave_ang = sin( (curTime - z) * twoPI ) * wave_factor * z;","new_pos.x += wave_ang;","float twist_ang = sin( (curTime - z) * twoPI ) * twist_factor;","float twist_cos = cos( twist_ang );","float twist_sin = sin( twist_ang );","tmp_pos.x = new_pos.x * twist_cos - new_pos.y * twist_sin;","tmp_pos.y = new_pos.x * twist_sin + new_pos.y * twist_cos;","new_pos = tmp_pos;","float bend_ang = sin( (curTime) * twoPI ) * bend_factor * z;","float bend_cos = cos( bend_ang );","float bend_sin = sin( bend_ang );","tmp_pos.x = new_pos.x * bend_cos - new_pos.z * bend_sin;","tmp_pos.z = new_pos.x * bend_sin + new_pos.z * bend_cos;","new_pos = tmp_pos;","return new_pos;","}","void main() {","vec4 tmpPos = texture2D( tPosition, boidSite );","vec3 pos = tmpPos.xyz;","vec3 velocity = normalize(texture2D( tVelocity, boidSite ).xyz);","vec3 newPosition = position;","if( boidType == 0 ) {","if ( boidVertex == 4.0 || boidVertex == 7.0 ) {","newPosition.y = sin( tmpPos.w ) * 5.0;","}","}","else {","newPosition = fishAnimation( position );","}","newPosition = mat3( modelMatrix ) * newPosition;","velocity.z *= -1.0;","float xz = length( velocity.xz );","float xyz = 1.0;","float x = sqrt( 1.0 - velocity.y * velocity.y );","float cosry = velocity.x / xz;","float sinry = velocity.z / xz;","float cosrz = x / xyz;","float sinrz = velocity.y / xyz;","mat3 maty =  mat3(","cosry, 0.0, -sinry,","0.0  , 1.0, 0.0   ,","sinry, 0.0, cosry ",");","mat3 matz =  mat3(","cosrz , sinrz, 0.0,","-sinrz, cosrz, 0.0,","0.0   , 0.0  , 1.0 ",");","newPosition = maty * matz * newPosition;","newPosition += pos;","vec4 worldPosition = vec4( newPosition, 1.0 );","vec4 mvPosition = viewMatrix  * worldPosition;","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vUv = uv;","vNormal = normalize( normalMatrix * normal );","vColor = vec4( boidColor, 1.0 );",THREE.ShaderChunk.shadowmap_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragmentShader:["uniform int boidType;","uniform vec3 color;","uniform sampler2D tDiffuse;","uniform sampler2D tSpecular;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vColor;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 fragColor = vec3( 0.0 );","vec3 totalLd = vec3( 0.0 );","vec3 totalLs = vec3( 0.0 );","vec3 N = normalize( vNormal );","vec3 V = normalize( vViewPosition );","float shininess = 32.0;","vec3 specularTex = texture2D( tSpecular, vUv ).rgb;","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 L = pointLights[ i ].position + vViewPosition.xyz;","float atten = calcLightAttenuation( length( L ), pointLights[ i ].distance, pointLights[ i ].decay );","L = normalize( L );","vec3 H = normalize( L + V );","float NoH = max( dot( N, H ), 0.0 );","float diffWt = max( dot( N, L ), 0.0 );","float specWt = specularTex.r * max( pow( NoH, shininess ), 0.0 );","totalLd += atten * pointLights[ i ].color * diffWt;","totalLs += atten * pointLights[ i ].color * specWt * diffWt;","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 Lc = directionalLights[ i ].color;","vec3 L = directionalLights[ i ].direction;","vec3 H = normalize( L + V );","float NoH = max( dot( N, H ), 0.0 );","float NoL = max( dot( N, L ), 0.0 );","totalLd += Lc * NoL;","totalLs += Lc * NoL * specularTex * max( pow( NoH, shininess ), 0.0 );","}","#endif","#if NUM_HEMI_LIGHTS > 0","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 L = hemisphereLights[ i ].direction;","vec3 gndLc = hemisphereLights[ i ].groundColor;","vec3 skyLc = hemisphereLights[ i ].skyColor;","float NoL = dot( N, L );","float diffWt = 0.5 * NoL + 0.5;","totalLd += mix( gndLc, skyLc, diffWt );","float specWt = 0.0;","vec3 skyH = normalize( L + V );","float skyNoH = 0.5 * dot( N, skyH ) + 0.5;","specWt += specularTex.r * max( pow( skyNoH, shininess ), 0.0 );","vec3 gndH = normalize( -L + V );","float gndNoH = 0.5 * dot( N, gndH ) + 0.5;","specWt += specularTex.r * max( pow( gndNoH, shininess ), 0.0 );","totalLs += mix( gndLc, skyLc, diffWt ) * specWt * diffWt;","}","#endif","vec4 albedo = vec4( 1.0 );","if( boidType == 0 ) {","albedo = vec4( mix( color, vColor.rgb, 0.8 ), 1.0 );","fragColor = albedo.rgb;","}","if( boidType == 1 ) {","albedo.rgb = color * texture2D( tDiffuse, vUv ).rgb;","fragColor = albedo.rgb * ( totalLd + ambientLightColor + totalLs );","}","gl_FragColor = vec4( fragColor, albedo.a );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},E.UnderWaterShader={uniforms:{tDiffuse:{value:null},time:{value:0},distort_speed:{value:5e-4},distortion:{value:.04},centerX:{value:.5},centerY:{value:.5}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float time;","uniform float distort_speed;","uniform float distortion;","uniform float centerX;","uniform float centerY;","varying vec2 vUv;","void main() {","vec2 p = vUv;","vec2 center_coord;","float distance_to_center;","float projected_distance_to_center;","float distort_degree;","center_coord.x = p.x - centerX;","center_coord.y = p.y - centerY;","distance_to_center = sqrt(center_coord.x * center_coord.x + center_coord.y * center_coord.y);","distort_degree = abs( mod(distort_speed* time, distortion) - (distortion / 2.0)) + 1.0;","projected_distance_to_center = pow(1.0, distort_degree - 1.0) * pow(distance_to_center/1.0, distort_degree);","p.x = projected_distance_to_center * center_coord.x/ distance_to_center + centerX;","p.y = projected_distance_to_center * center_coord.y/ distance_to_center + centerY;","vec4 color = texture2D(tDiffuse, p);","gl_FragColor = color;","}"].join("\n")},E.ParticleEngineShader={uniforms:{texture:{value:null}},vertexShader:["attribute vec3  customColor;","attribute float customOpacity;","attribute float customSize;","attribute float customAngle;","attribute float customVisible;","varying vec4  vColor;","varying float vAngle;","void main()","{","if ( customVisible > 0.5 )","vColor = vec4( customColor, customOpacity );","else","vColor = vec4(0.0, 0.0, 0.0, 0.0);","vAngle = customAngle;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = customSize * ( 300.0 / length( mvPosition.xyz ) );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","varying vec4 vColor;","varying float vAngle;","void main()","{","gl_FragColor = vColor;","float c = cos(vAngle);","float s = sin(vAngle);","vec2 rotatedUV = vec2(c * (gl_PointCoord.x - 0.5) + s * (gl_PointCoord.y - 0.5) + 0.5,","c * (gl_PointCoord.y - 0.5) - s * (gl_PointCoord.x - 0.5) + 0.5);","vec4 rotatedTexture = texture2D( texture,  rotatedUV );","gl_FragColor = gl_FragColor * rotatedTexture;","}"].join("\n")},E.TerrainLODShader={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{diffuse:{value:new THREE.Color(16777215)},specular:{value:new THREE.Color(16777215)},shininess:{value:30},opacity:{value:1},enableDiffuse1:{value:!0},enableDiffuse2:{value:!0},enableSpecular:{value:!1},tDiffuse1:{value:null},tDiffuse2:{value:null},tSpecular:{value:null},uvRepeatOverlay:{value:new THREE.Vector2(1,1)},uvOffset:{value:new THREE.Vector2(0,0)},worldWidth:{value:1024},tileResolution:{value:64},edgeMorph:{value:0},globalOffset:{value:null},tileOffset:{value:null},heightMap:{value:null},tileScale:{value:64},maxHeight:{value:100},winterSnow:{value:!1},summerGreen:{value:!1}}]),vertexShader:["uniform float worldWidth;","uniform float tileResolution;","uniform vec3 globalOffset;","uniform vec2 tileOffset;","uniform sampler2D heightMap;","uniform float tileScale;","uniform float maxHeight;","varying float vMorphFactor;","varying vec3 vPosition;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,"float getHeight(vec3 p) {","float lod = 1.0;","vec2 st = p.xy / worldWidth;","float h = 1024.0 * texture2DLod(heightMap, st, lod).a;","h += 64.0 * texture2DLod(heightMap, 16.0 * st, lod).a;","h += 4.0 * texture2DLod(heightMap, 256.0 * st, lod).a;","return h / 1092.0 * maxHeight;","}","#define EGDE_MORPH_TOP    1","#define EGDE_MORPH_LEFT   2","#define EGDE_MORPH_BOTTOM 4","#define EGDE_MORPH_RIGHT  8","#define MORPH_REGION      0.3","uniform int edgeMorph;","bool edgePresent(int edge) {","int e = edgeMorph / edge;","return 2 * ( e / 2 ) != e;","}","float calculateMorph(vec3 p) {","float morphFactor = 0.0;","if( edgePresent(EGDE_MORPH_TOP) && p.y >= 1.0 - MORPH_REGION ) {","float m = 1.0 - clamp((1.0 - p.y) / MORPH_REGION, 0.0, 1.0);","morphFactor = max(m, morphFactor);","}","if( edgePresent(EGDE_MORPH_LEFT) && p.x <= MORPH_REGION ) {","float m = 1.0 - clamp(p.x / MORPH_REGION, 0.0, 1.0);","morphFactor = max(m, morphFactor);","}","if( edgePresent(EGDE_MORPH_BOTTOM) && p.y <= MORPH_REGION ) {","float m = 1.0 - clamp(p.y / MORPH_REGION, 0.0, 1.0);","morphFactor = max(m, morphFactor);","}","if( edgePresent(EGDE_MORPH_RIGHT) && p.x >= 1.0 - MORPH_REGION ) {","float m = 1.0 - clamp((1.0 - p.x) / MORPH_REGION, 0.0, 1.0);","morphFactor = max(m, morphFactor);","}","return morphFactor;","}","void main() {","vMorphFactor = calculateMorph(position);","vPosition = tileScale * position + vec3(tileOffset, 0.0) + globalOffset;","float grid = tileScale / tileResolution;","vPosition = floor(vPosition / grid) * grid;","if( vMorphFactor > 0.0 ) {","grid = 2.0 * grid;","vec3 position2 = floor(vPosition / grid) * grid;","vPosition = mix(vPosition, position2, vMorphFactor);","}","vPosition = vPosition + normal * getHeight(vPosition);","vec4 mvPosition =  modelViewMatrix * vec4( vPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vUv = uv;","vPosition.xyz = vPosition.yzx;","vViewPosition.xyz = -mvPosition.yzx;","#if defined (USE_SHADOWMAP)","vec4 worldPosition = modelMatrix * vec4( vPosition, 1.0 );","#endif",THREE.ShaderChunk.shadowmap_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tSpecular;","uniform vec2 uvRepeatOverlay;","uniform vec2 uvOffset;","uniform float worldWidth;","uniform sampler2D heightMap;","uniform float maxHeight;","uniform bool winterSnow;","uniform bool summerGreen;","varying float vMorphFactor;","varying vec3 vPosition;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"float getHeight(vec3 p) {","vec2 st = p.zx / worldWidth;","float h = 1024.0 * texture2D(heightMap, st).a;","h += 64.0 * texture2D(heightMap, 16.0 * st).a;","h += 4.0 * texture2D(heightMap, 256.0 * st).a;","return h / 1092.0 * maxHeight;","}","vec3 getNormal() {","float height = getHeight( vPosition );","vec3 p = vec3( vPosition.x, height, vPosition.z );","vec3 dPositiondx = dFdx(p);","vec3 dPositiondy = dFdy(p);","return normalize(cross(dPositiondx, dPositiondy));","}","float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 && cutoffDistance > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), 2.0 );","}","return 1.0;","}","void main() {","vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uvRepeatOverlay * vUv + uvOffset;","vec3 viewPosition = normalize( vViewPosition );","vec3 normal = getNormal();","vec3 outgoingLight = vec3( 0.0 );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - getHeight( vPosition ) / worldWidth );","} else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","if( winterSnow )","{","vec3 snowColor = vec3( 0.93, 0.97, 1.0 );","float snowStick = dot( vec3( 0.0, 1.0, 0.0 ), normal );","snowStick = pow( snowStick, 3.0 );","snowStick = step( 0.2, snowStick );","diffuseColor.xyz = mix( diffuseColor.xyz, snowColor, snowStick );","}","if( summerGreen )","{","vec3 water = vec3( 0.0, 0.12, 0.06 );","vec3 grass = vec3( 0.07, 0.43, 0.08 );","vec3 rock = vec3( 0.31, 0.11, 0.09 );","float grassStick = dot( vec3( 0.0, 1.0, 0.0 ), normal );","float stickExponent = 1.2 + 1.8 * float( winterSnow );","grassStick = pow( grassStick, stickExponent );","float minVal = 0.2 + 0.1 * float( winterSnow );","grassStick = step( minVal, grassStick );","vec3 waterGrass = mix( water, grass, smoothstep( 7.0, 14.0, vPosition.y ) );","vec3 rockWaterGrass = mix( rock, waterGrass, 0.5 );","diffuseColor.xyz = mix( diffuseColor.xyz, rockWaterGrass, grassStick );","}","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLights[ i ].direction;","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","float mistAmount = clamp( 1.0 - vPosition.y / 15.0, 0.0, 1.0 );","mistAmount = pow( mistAmount, 5.4 );","vec3 mistColor = vec3( 0.835, 0.843, 0.850 );","outgoingLight = mix( outgoingLight, mistColor, mistAmount );","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},E.GrayScaleShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float gray = dot( texel.rgb, vec3(0.299, 0.587, 0.114) );","gl_FragColor = vec4( gray, gray, gray, texel.a );","}"].join("\n")},E.LuminanceShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float luma = dot( texel.rgb, vec3(0.2125, 0.7154, 0.0721) );","gl_FragColor = vec4( luma, luma, luma, texel.a );","}"].join("\n")},E.InvertImageShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = vec3(1.0) - texel.rgb;","gl_FragColor.a = texel.a;","}"].join("\n")},E.BrightnessShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 black = vec3(0.0);","gl_FragColor.rgb = mix( black, texel.rgb, 2.0 );","gl_FragColor.a = texel.a;","}"].join("\n")},E.SaturationShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float luma = dot( texel.rgb, vec3(0.2125, 0.7154, 0.0721) );","gl_FragColor.rgb = mix( vec3(luma), texel.rgb, 0.5 );","gl_FragColor.a = texel.a;","}"].join("\n")},E.ContrastShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mix( vec3(0.5), texel.rgb, 2.0 );","gl_FragColor.a = texel.a;","}"].join("\n")},E.DitheringShader={uniforms:{tDiffuse:{value:null},tNoise:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNoise;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float grayscale = length( texel.rgb * vec3(0.2126, 0.7152, 0.0722) );","vec3 ditherPixel = texture2D( tNoise, vec2( mod( gl_FragCoord.xy / vec2(8.0), 1.0) ) ).xyz;","float ditherGrayscale = ( ditherPixel.x + ditherPixel.y + ditherPixel.z ) / 3.0;","ditherGrayscale -= 0.5;","float ditheredResult = grayscale + ditherGrayscale;","float bit = (ditheredResult >= 0.5) ? 1.0 : 0.0;","gl_FragColor.rgb = vec3( bit );","gl_FragColor.a = texel.a;","}"].join("\n")},E.GaussianBlurShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/512,1/512)},strength:{value:3.5},horizontalPass:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","uniform float strength;","uniform int horizontalPass;","varying vec2 vUv;","void main() {","const float pi = 3.14159265;","const float numBlurPixelsPerSide = 16.0;","vec2 texOffset = resolution;","vec2 blurMultiplyVec = 0 < horizontalPass ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","vec3 incrementalGaussian;","incrementalGaussian.x = 1.0 / (sqrt(2.0 * pi) * strength);","incrementalGaussian.y = exp(-0.5 / (strength * strength));","incrementalGaussian.z = incrementalGaussian.y * incrementalGaussian.y;","vec4 avgValue = vec4(0.0, 0.0, 0.0, 0.0);","float coefficientSum = 0.0;","avgValue += texture2D( tDiffuse, vUv ) * incrementalGaussian.x;","coefficientSum += incrementalGaussian.x;","incrementalGaussian.xy *= incrementalGaussian.yz;","for (float i = 1.0; i <= numBlurPixelsPerSide; i++) {","avgValue += texture2D( tDiffuse, vUv - i * texOffset * blurMultiplyVec ) * incrementalGaussian.x;","avgValue += texture2D( tDiffuse, vUv + i * texOffset * blurMultiplyVec ) * incrementalGaussian.x;","coefficientSum += 2.0 * incrementalGaussian.x;","incrementalGaussian.xy *= incrementalGaussian.yz;","}","gl_FragColor = avgValue / coefficientSum;","}"].join("\n")},E.EdgeDetectionShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/512,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + resolution * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n")},E.EdgeDetection2Shader={defines:{EDGE_FUNC:"edge"},uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/512,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","const mat3 sobelKernelX = mat3(1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0);","const mat3 sobelKernelY = mat3(-1.0, -2.0, -1.0, 0.0, 0.0, 0.0, 1.0, 2.0, 1.0);","float convolve(mat3 kernel, mat3 image) {","float result = 0.0;","for (int i = 0; i < 3; i++) {","for (int j = 0; j < 3; j++) {","result += kernel[i][j]*image[i][j];","}","}","return result;","}","float convolveComponent(mat3 kernelX, mat3 kernelY, mat3 image) {","vec2 result;","result.x = convolve(kernelX, image);","result.y = convolve(kernelY, image);","return clamp(length(result), 0.0, 255.0);","}","vec4 colorEdge(float stepx, float stepy, vec2 center, mat3 kernelX, mat3 kernelY) {","vec4 colors[9];","colors[0] = texture2D(tDiffuse,center + vec2(-stepx,stepy));","colors[1] = texture2D(tDiffuse,center + vec2(0,stepy));","colors[2] = texture2D(tDiffuse,center + vec2(stepx,stepy));","colors[3] = texture2D(tDiffuse,center + vec2(-stepx,0));","colors[4] = texture2D(tDiffuse,center);","colors[5] = texture2D(tDiffuse,center + vec2(stepx,0));","colors[6] = texture2D(tDiffuse,center + vec2(-stepx,-stepy));","colors[7] = texture2D(tDiffuse,center + vec2(0,-stepy));","colors[8] = texture2D(tDiffuse,center + vec2(stepx,-stepy));","mat3 imageR, imageG, imageB, imageA;","for (int i = 0; i < 3; i++) {","for (int j = 0; j < 3; j++) {","imageR[i][j] = colors[i*3+j].r;","imageG[i][j] = colors[i*3+j].g;","imageB[i][j] = colors[i*3+j].b;","imageA[i][j] = colors[i*3+j].a;","}","}","vec4 color;","color.r = convolveComponent(kernelX, kernelY, imageR);","color.g = convolveComponent(kernelX, kernelY, imageG);","color.b = convolveComponent(kernelX, kernelY, imageB);","color.a = convolveComponent(kernelX, kernelY, imageA);","return color;","}","vec4 edge(float stepx, float stepy, vec2 center, mat3 kernelX, mat3 kernelY){","mat3 image = mat3(length(texture2D(tDiffuse,center + vec2(-stepx,stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(0,stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(stepx,stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(-stepx,0)).rgb),","length(texture2D(tDiffuse,center).rgb),","length(texture2D(tDiffuse,center + vec2(stepx,0)).rgb),","length(texture2D(tDiffuse,center + vec2(-stepx,-stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(0,-stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(stepx,-stepy)).rgb));","vec2 result;","result.x = convolve(kernelX, image);","result.y = convolve(kernelY, image);","float color = clamp(length(result), 0.0, 255.0);","return vec4(color);","}","vec4 trueColorEdge(float stepx, float stepy, vec2 center, mat3 kernelX, mat3 kernelY) {","vec4 edgeVal = edge(stepx, stepy, center, kernelX, kernelY);","return edgeVal * texture2D(tDiffuse,center);","}","void main(void)","{","vec4 texel = texture2D( tDiffuse, vUv );","vec4 result = EDGE_FUNC( resolution.x, resolution.y, vUv, sobelKernelX, sobelKernelY );","gl_FragColor = vec4( result.rgb, texel.a );","}"].join("\n")},E.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float offset;","uniform float darkness;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},E.FilmGrainShader={uniforms:{tDiffuse:{value:null},aspectCorrection:{value:!1},aspect:{value:1},grainScale:{value:.005},grainTime:{value:0},noiseAlpha:{value:.25},offset:{value:new THREE.Vector2(0,0)},scale:{value:new THREE.Vector2(1,1)},smoothEdge:{value:new THREE.Vector2(0,1)},color1:{value:new THREE.Color(16777215)},color2:{value:new THREE.Color(2635844)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:[E.ShaderChunk.mod289,E.ShaderChunk.permute,E.ShaderChunk.taylorInvSqrt,E.ShaderChunk.snoise3,E.ShaderChunk.fade3,E.ShaderChunk.pnoise3,"float grain(vec2 texCoord, vec2 resolution, float frame, float multiplier) {","vec2 mult = texCoord * resolution;","float offset = snoise(vec3(mult / multiplier, frame));","float n1 = pnoise(vec3(mult, offset), vec3(1.0/texCoord * resolution, 1.0));","return n1 / 2.0 + 0.5;","}","float grain(vec2 texCoord, vec2 resolution, float frame) {","return grain(texCoord, resolution, frame, 2.5);","}","float grain(vec2 texCoord, vec2 resolution) {","return grain(texCoord, resolution, 0.0);","}","vec3 blendSoftLight(vec3 base, vec3 blend) {","return mix(","sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend),","2.0 * base * blend + base * base * (1.0 - 2.0 * blend),","step(base, vec3(0.5))",");","}","uniform sampler2D tDiffuse;","uniform vec3 color1;","uniform vec3 color2;","uniform float aspect;","uniform vec2 offset;","uniform vec2 scale;","uniform float noiseAlpha;","uniform bool aspectCorrection;","uniform float grainScale;","uniform float grainTime;","uniform vec2 smoothEdge;","varying vec2 vUv;","void main() {","vec2 q = vec2(vUv - 0.5);","if( aspectCorrection ) {","q.x *= aspect;","}","q /= scale;","q -= offset;","float dst = length(q);","dst = smoothstep(smoothEdge.x, smoothEdge.y, dst);","vec3 color12 = mix(color1, color2, dst);","vec3 color3 = texture2D(tDiffuse, vUv).rgb;","vec3 color = mix(color12, color3, 0.75);","if( noiseAlpha > 0.0 && grainScale > 0.0 ) {","float gSize = 1.0 / grainScale;","float g = grain(vUv, vec2(gSize * aspect, gSize), grainTime);","vec3 noiseColor = blendSoftLight(color, vec3(g));","gl_FragColor.rgb = mix(color, noiseColor, noiseAlpha);","} else {","gl_FragColor.rgb = color;","}","gl_FragColor.a = 1.0;","}"].join("\n")},E.BackgroundShader={uniforms:{devicePixelRatio:{value:window.devicePixelRatio},time:{value:0},resolution:{value:null},textureMaps:{value:[]}},vertexShader:"void main(){ gl_Position = vec4(position, 1.0); }",cloudsFS:"        // include.glsl\n        #define gl_FragCoord (gl_FragCoord / devicePixelRatio)\n        uniform float devicePixelRatio;\n        uniform float time;\n        uniform vec2 resolution;\n        uniform sampler2D textureMaps[4];\n        //\n        #define iChannel0 textureMaps[0]\n        # define T texture2D(iChannel0, fract((s*p.zw + ceil(s*p.x)) / 200.0)).y / (s += s) * 4.0\n        const vec3 skyColor = vec3(0.360, 0.650, 0.792); // 0x5ca6ca\n        const vec3 cloudColor = vec3(0.2, 0.301, 0.501); // 0x334d80\n        const vec3 lightColor = vec3(1.0); // 0xffffff\n        const float speed = 1.0;\n        void mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n            vec4 p, d = vec4(0.8, 0, fragCoord / resolution.y - 0.65);\n            vec3 out1 = skyColor - d.w; // sky gradient\n            float s, f, t = 200.0 + sin(dot(fragCoord, fragCoord));\n            const float MAX_ITER = 100.0;\n            for (float i = 1.0; i <= MAX_ITER; i += 1.0) {\n            t -= 2.0; if (t < 0.0) { break; } // march step\n            p = 0.05 * t * d;\n            p.xz += time * 0.50000 * speed; // movement through space\n            p.x += sin(time * 0.25 * speed) * 0.25;\n            s = 2.0;\n            f = p.w + 1.0-T-T-T-T;\n            if (f < 0.0) {\n                vec3 cloudShading = mix(lightColor, cloudColor, -f);\n                out1 = mix(out1, cloudShading, -f * 0.4);\n            }\n            }\n            fragColor = vec4(out1, 1.0);\n        }\n        void main() {\n            gl_FragDepth = 1.0;\n            mainImage( gl_FragColor, gl_FragCoord.xy );\n        }\n    ",cellsFS:"        // include.glsl\n        #define gl_FragCoord (gl_FragCoord / devicePixelRatio)\n        uniform float devicePixelRatio;\n        uniform float time;\n        uniform vec2 resolution;\n        uniform sampler2D textureMaps[4];\n        //\n        const vec3 color1 = vec3(0, 0.549, 0.549);\n        const vec3 color2 = vec3(0.949, 0.905, 0.207);\n        const float size = 1.5;\n        float length2(vec2 p) { return dot(p, p); }\n        float noise(vec2 p){\n            return fract(sin(fract(sin(p.x) * (43.13311)) + p.y) * 31.0011);\n        }\n        float worley(vec2 p) {\n            float d = 1e30;\n            for (int xo = -1; xo <= 1; ++xo) {\n                for (int yo = -1; yo <= 1; ++yo) {\n                    vec2 tp = floor(p) + vec2(xo, yo);\n                    d = min(d, length2(p - tp - vec2(noise(tp))));\n                }\n            }\n            vec2 uv = gl_FragCoord.xy / resolution.xy;\n            float timeOffset =  0.15 * sin(time * 2.0 + 10.0*(uv.x - uv.y));\n            return 3.0*exp(-4.0*abs(2.0*d - 1.0 + timeOffset));\n        }\n        float fworley(vec2 p) {\n            return sqrt(sqrt(sqrt(\n            1.1 * // light\n            worley(p*5. + .3 + time*.0525) *\n            sqrt(worley(p * 50. / size + 0.3 + time * -0.15)) *\n            sqrt(sqrt(worley(p * -10. + 9.3))))));\n        }\n        void main() {\n            vec2 uv = gl_FragCoord.xy / resolution.xy;\n            float t = fworley(uv * resolution.xy / 1500.0);\n            t *= exp(-length2(abs(0.7*uv - 1.0)));\n            float tExp = pow(t, 0.5 - t);\n            vec3 c1 = color1 * (1.0 - t);\n            vec3 c2 = color2 * tExp;\n            gl_FragColor = vec4(pow(t, 1.0 - t) * (c1 + c2), 1.0);\n            gl_FragDepth = 1.0;\n        }\n    ",fogFS:"        // include.glsl\n        #define gl_FragCoord (gl_FragCoord / devicePixelRatio)\n        uniform float devicePixelRatio;\n        uniform float time;\n        uniform vec2 resolution;\n        uniform sampler2D textureMaps[4];\n        //\n        const vec3 baseColor = vec3(1.0, 0.921, 0.921);\n        const vec3 lowlightColor = vec3(0.176, 0.0, 1.0);\n        const vec3 midtoneColor = vec3(1.0, 0.121, 0.0);\n        const vec3 highlightColor = vec3(1.0, 0.764, 0.0);\n        const float blurFactor = 0.21;//0.6;\n        const float zoom = 1.0;\n        float random (in vec2 uv) {\n            return fract(sin(dot(uv.xy,vec2(12.9898,78.233)))*43758.5453123);\n        }\n        float noise (in vec2 uv) {\n            vec2 i = floor(uv);\n            vec2 f = fract(uv);\n            // Four corners in 2D of a tile\n            float a = random(i);\n            float b = random(i + vec2(1.0, 0.0));\n            float c = random(i + vec2(0.0, 1.0));\n            float d = random(i + vec2(1.0, 1.0));\n            vec2 u = f * f * (3.0 - 2.0 * f);\n            return mix(a, b, u.x) +\n                    (c - a)* u.y * (1.0 - u.x) +\n                    (d - b) * u.x * u.y;\n        }\n        #define NUM_OCTAVES 6\n        float fbm( in vec2 uv ) {\n            float v = 0.0;\n            float a = blurFactor;\n            vec2 shift = vec2(100.0);\n            // Rotate to reduce axial bias\n            mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\n            for (int i = 0; i < NUM_OCTAVES; ++i) {\n                v += a * noise(uv);\n                uv = rot * uv * 2.0 + shift;\n                a *= (1. - blurFactor);\n            }\n            return v;\n        }\n        void main() {\n            vec2 st = gl_FragCoord.xy / resolution.xy*3.;\n            st.x *= 0.7 * resolution.x / resolution.y ; // Still keep it more landscape than square\n            st *= zoom;\n            // st += st * abs(sin(time*0.1)*3.0);\n            vec3 color = vec3(0.0);\n            vec2 q = vec2(0.);\n            q.x = fbm( st + 0.00*time);\n            q.y = fbm( st + vec2(1.0));\n            vec2 dir = vec2(0.15,0.126);\n            vec2 r = vec2(0.);\n            r.x = fbm( st + 1.0*q + vec2(1.7,9.2)+ dir.x*time );\n            r.y = fbm( st + 1.0*q + vec2(8.3,2.8)+ dir.y*time);\n            float f = fbm(st+r);\n            color = mix(baseColor, lowlightColor, clamp((f*f)*4.0,0.0,1.0));\n            color = mix(color, midtoneColor, clamp(length(q),0.0,1.0));\n            color = mix(color, highlightColor, clamp(length(r.x),0.0,1.0));\n            vec3 finalColor = mix(baseColor, color, f*f*f+.6*f*f+.5*f);\n            gl_FragColor = vec4(finalColor,1.0);\n            gl_FragDepth = 1.0;\n        }\n    ",sunsetFS:"        // include.glsl\n        #define gl_FragCoord (gl_FragCoord / devicePixelRatio)\n        uniform float devicePixelRatio;\n        uniform float time;\n        uniform vec2 resolution;\n        uniform sampler2D textureMaps[4];\n        //\n        float rand(float x) { return fract(sin(x) * 71523.5413291); }\n        float rand(vec2 x) { return rand(dot(x, vec2(13.4251, 15.5128))); }\n        float noise(vec2 x)\n        {\n            vec2 i = floor(x);\n            vec2 f = x - i;\n            f *= f*(3.-2.*f);\n            return mix(mix(rand(i), rand(i+vec2(1,0)), f.x), mix(rand(i+vec2(0,1)), rand(i+vec2(1,1)), f.x), f.y);\n        }\n        float fbm(vec2 x)\n        {\n            float r = 0.0, s = 1.0, w = 1.0;\n            for (int i=0; i<5; i++) {\n                s *= 2.0;\n                w *= 0.5;\n                r += w * noise(s * x);\n            }\n            return r;\n        }\n        float cloud(vec2 uv, float scalex, float scaley, float density, float sharpness, float speed)\n        {\n            return pow(saturate(fbm(vec2(scalex,scaley)*(uv+vec2(speed,0)*time))-(1.0-density)), 1.0-sharpness);\n        }\n        vec3 render(vec2 uv)\n        {\n            // sky\n            vec3 color = mix(vec3(1.0,0.831,0.650), vec3(0.8,0.921,1.0), uv.y);\n            // sun\n            vec2 spos = uv - vec2(0.1, 0.4);\n            float sun = exp(-20.*dot(spos,spos));\n            vec3 scol = vec3(1.0,0.607,0.4) * sun * 0.7;\n            color += scol;\n            // clouds\n            vec3 cl1 = mix(vec3(0.592,0.541,0.6), vec3(0.650,0.749,0.878),uv.y);\n            float d1 = mix(0.9,0.1,pow(uv.y, 0.7));\n            color = mix(color, cl1, cloud(uv,2.,8.,d1,0.4,0.04));\n            color = mix(color, vec3(0.9), 8.*cloud(uv,14.,18.,0.9,0.75,0.02) * cloud(uv,2.,5.,0.6,0.15,0.01)*uv.y);\n            color = mix(color, vec3(0.8), 5.*cloud(uv,12.,15.,0.9,0.75,0.03) * cloud(uv,2.,8.,0.5,0.0,0.02)*uv.y);\n            // post\n            color *= vec3(1.0,0.93,0.81)*1.04;\n            color = mix(0.75*vec3(1.0,0.803,0.631), color, smoothstep(-0.1,0.3,uv.y));\n            color = pow(color,vec3(1.3));\n            return color;\n        }\n        void main() {\n            vec2 uv = gl_FragCoord.xy / resolution.xy;\n            uv.x -= 0.5;\n            uv.x *= resolution.x / resolution.y;\n            gl_FragColor = vec4(render(uv), 1.0);\n            gl_FragDepth = 1.0;\n        }\n    "},E.GodRaysPass=function(e,t,r,n){THREE.Pass.call(this),this.scene=e,this.camera=t,this.width=r||512,this.height=n||512;var i=t.far;this.sunPosition=new THREE.Vector3(0,.5*i,-i),this.materialDepth=new THREE.MeshDepthMaterial,this.scene2=new THREE.Scene,this.camera2=new THREE.OrthographicCamera(-.5,.5,.5,-.5,-i,i),this.camera2.position.z=i/100,this.scene2.add(this.camera2);var a={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.rtTextureColors=new THREE.WebGLRenderTarget(r,n,a),this.rtTextureDepth=new THREE.WebGLRenderTarget(r,n,a),this.rtTextureDepthMask=new THREE.WebGLRenderTarget(r,n,a),this.rtResolutionMultiplier=.25;var o=r*this.rtResolutionMultiplier,s=n*this.rtResolutionMultiplier;this.rtTextureGodRays1=new THREE.WebGLRenderTarget(o,s,a),this.rtTextureGodRays2=new THREE.WebGLRenderTarget(o,s,a),void 0!==THREE.GodRaysDepthMaskShader&&void 0!==THREE.GodRaysGenerateShader&&void 0!==THREE.GodRaysCombineShader&&void 0!==THREE.GodRaysFakeSunShader||console.error("JAMIE.GodRaysPass: The pass relies on GodRaysShader.js.");var l=THREE.GodRaysDepthMaskShader;this.godrayMaskUniforms=THREE.UniformsUtils.clone(l.uniforms),this.materialGodraysDepthMask=new THREE.ShaderMaterial({uniforms:this.godrayMaskUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader});var c=THREE.GodRaysGenerateShader;this.godrayGenUniforms=THREE.UniformsUtils.clone(c.uniforms),this.materialGodraysGenerate=new THREE.ShaderMaterial({uniforms:this.godrayGenUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader});var u=THREE.GodRaysCombineShader;this.godrayCombineUniforms=THREE.UniformsUtils.clone(u.uniforms),this.materialGodraysCombine=new THREE.ShaderMaterial({uniforms:this.godrayCombineUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader});var h=THREE.GodRaysFakeSunShader;this.godraysFakeSunUniforms=THREE.UniformsUtils.clone(h.uniforms),this.materialGodraysFakeSun=new THREE.ShaderMaterial({uniforms:this.godraysFakeSunUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}),this.godraysFakeSunUniforms.fAspect.value=this.camera.aspect,this.godraysFakeSunUniforms.bgColor.value.setHex(0),this.godraysFakeSunUniforms.sunColor.value.setHex(E.SUN_COLOR),this.godrayCombineUniforms.fGodRayIntensity.value=.5;var d=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),this.materialGodraysGenerate);d.position.z=-.99*t.far,this.scene2.add(d)},E.GodRaysPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:E.GodRaysPass,dispose:function(){this.rtTextureColors.dispose(),this.rtTextureDepth.dispose(),this.rtTextureDepthMask.dispose(),this.rtTextureGodRays1.dispose(),this.rtTextureGodRays2.dispose(),this.materialGodraysDepthMask.dispose(),this.materialGodraysGenerate.dispose(),this.materialGodraysCombine.dispose(),this.materialGodraysFakeSun.dispose(),this.quad.geometry.dispose(),this.materialDepth.dispose()},setSize:function(e,t){this.rtTextureColors.setSize(e,t),this.rtTextureDepth.setSize(e,t),this.rtTextureDepthMask.setSize(e,t);var r=e*this.rtResolutionMultiplier,n=t*this.rtResolutionMultiplier;this.rtTextureGodRays1.setSize(r,n),this.rtTextureGodRays2.setSize(r,n)},render:function(e,t,r,n,i){var a=this.scene,o=this.camera,s=this.width,l=this.height,c=this.sunPosition,u=new THREE.Vector3;u.copy(c).project(o),u.x=(u.x+1)/2,u.y=(u.y+1)/2,this.godrayGenUniforms.vSunPositionScreenSpace.value.x=u.x,this.godrayGenUniforms.vSunPositionScreenSpace.value.y=u.y,this.godraysFakeSunUniforms.vSunPositionScreenSpace.value.x=u.x,this.godraysFakeSunUniforms.vSunPositionScreenSpace.value.y=u.y,e.setRenderTarget(this.rtTextureColors),e.clear(!0,!0,!1);var h=.74*l,d=.74*l;u.x*=s,u.y*=l,e.setScissor(u.x-d/2,u.y-h/2,d,h),e.setScissorTest(!0),this.godraysFakeSunUniforms.fAspect.value=this.camera.aspect,this.scene2.overrideMaterial=this.materialGodraysFakeSun,this.rendererRender(e,this.scene2,this.camera2,this.rtTextureColors),e.setScissorTest(!1),a.overrideMaterial=null,this.rendererRender(e,a,o,this.rtTextureColors),a.overrideMaterial=this.materialDepth,this.rendererRender(e,a,o,this.rtTextureDepth,!0),this.godrayMaskUniforms.tInput.value=this.rtTextureDepth.texture,this.scene2.overrideMaterial=this.materialGodraysDepthMask,this.rendererRender(e,this.scene2,this.camera2,this.rtTextureDepthMask);this.filterGodRays(e,this.rtTextureDepthMask.texture,this.rtTextureGodRays2,this.getStepSize(.4,4,1)),this.filterGodRays(e,this.rtTextureGodRays2.texture,this.rtTextureGodRays1,this.getStepSize(.4,4,2)),this.filterGodRays(e,this.rtTextureGodRays1.texture,this.rtTextureGodRays2,this.getStepSize(.4,4,3)),this.godrayCombineUniforms.tColors.value=this.rtTextureColors.texture,this.godrayCombineUniforms.tGodRays.value=this.rtTextureGodRays2.texture,this.scene2.overrideMaterial=this.materialGodraysCombine,this.rendererRender(e,this.scene2,this.camera2,this.renderToScreen?null:t),this.scene2.overrideMaterial=null},getStepSize:function(e,t,r){return e*Math.pow(t,-r)},filterGodRays:function(e,t,r,n){this.godrayGenUniforms.fStepSize.value=n,this.godrayGenUniforms.tInput.value=t,this.scene2.overrideMaterial=this.materialGodraysGenerate,this.rendererRender(e,this.scene2,this.camera2,r),this.scene2.overrideMaterial=null},rendererRender:function(e,t,r,n,i){e.setRenderTarget(n),i&&e.clear(),e.render(t,r)}});var R,M,S,A,L,P,C,H,I,k,N=r(5);E.img2pixels=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height)},E.pixels2img=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width,t.height=e.height,r.putImageData(e,0,0);var n=new Image;return n.src=t.toDataURL(),n.width=e.width,n.height=e.height,n},E.tex2pixels=function(e){return E.img2pixels(e.image)},E.pixels2tex=function(e){var t=E.pixels2img(e),r=new THREE.Texture(t);return r.needsUpdate=!0,r},E.canvas2tex=function(e){return new THREE.CanvasTexture(e)},E.img2url=function(e){return THREE.ImageUtils.getDataURL(e)},E.imgload2url=function(e,t){(new THREE.TextureLoader).load(e,function(e){var r=E.img2url(e.image);t&&t(r)})},E.imgload2pixels=function(e,t){(new THREE.TextureLoader).load(e,function(e){var r=E.img2pixels(e.image);t&&t(r)})},E.pixels2saveas=function(e,t,r){r=void 0!==r&&r;var n=document.createElement("canvas"),i=n.getContext("2d");n.width=e.width,n.height=e.height,!1===r?i.putImageData(e,0,0):(i.putImageData(e,0,0),i.scale(1,-1),i.translate(0,-e.height),i.drawImage(n,0,0),i.setTransform(1,0,0,1,0,0)),n.toBlob(function(e){Object(N.saveAs)(e,t)})},E.url2img=function(e,t){var r=new Image;r.src=e,r.onload=function(){t&&t(r)}},E.url2saveas=function(e,t){var r=document.createElement("a");document.body.appendChild(r),r.download=t,r.href=e,r.target="_blank",r.click(),document.body.removeChild(r)},E.pixels2canvas=function(e,t){t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0)},E.dipPixelColor=function(e,t,r,n){if(void 0===n){a=4*(t+r*e.width);return{r:(i=e.data)[a],g:i[a+1],b:i[a+2],a:i[a+3]}}var i,a=4*(t+r*e.width);(i=e.data)[a]=n[0],i[a+1]=n[1],i[a+2]=n[2],i[a+3]=n[3]},E.dipGemm=function(e,t){let r=[];return r[0]=e[0]*t[0]+e[1]*t[3]+e[2]*t[6],r[1]=e[0]*t[1]+e[1]*t[4]+e[2]*t[7],r[2]=e[0]*t[2]+e[1]*t[5]+e[2]*t[8],r[3]=e[3]*t[0]+e[4]*t[3]+e[5]*t[6],r[4]=e[3]*t[1]+e[4]*t[4]+e[5]*t[7],r[5]=e[3]*t[2]+e[4]*t[5]+e[5]*t[8],r[6]=e[6]*t[0]+e[7]*t[3]+e[8]*t[6],r[7]=e[6]*t[1]+e[7]*t[4]+e[8]*t[7],r[8]=e[6]*t[2]+e[7]*t[5]+e[8]*t[8],r},E.dipGemv=function(e,t){let r=[];for(let n=0;n<3;n++){r[n]=0;let i=3*n;for(let a=0;a<3;a++)r[n]+=e[i+a]*t[a]}return r},E.dipInverseMatrix=(R=new THREE.Matrix3,M=new THREE.Matrix3,function(e){var t=[];return M.set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]),R.getInverse(M),R.transposeIntoArray(t),t}),E.dipInverseAffine=function(e){let t=1/(e[0]*e[4]-e[1]*e[3]),r=-t,n=[];return n[0]=e[4]*t,n[1]=e[1]*r,n[2]=(e[2]*e[4]-e[1]*e[5])*r,n[3]=e[3]*r,n[4]=e[0]*t,n[5]=(e[2]*e[3]-e[0]*e[5])*t,n[6]=0,n[7]=0,n[8]=1,n},E.dipCvtColor=function(e,t){var r,n,i,a=new THREE.Color,o=e.data;switch(t){case"rgb2hsl":!function(e){let t={h:0,s:0,l:0};for(let o=0,s=e.length;o<s;o+=4)r=e[o]/255,n=e[o+1]/255,i=e[o+2]/255,a.setRGB(r,n,i),a.getHSL(t),e[o]=Math.round(255*t.h),e[o+1]=Math.round(255*t.s),e[o+2]=Math.round(255*t.l)}(o);break;case"hsl2rgb":!function(e){let t,r,n;for(let i=0,o=e.length;i<o;i+=4)t=e[i]/255,r=e[i+1]/255,n=e[i+2]/255,a.setHSL(t,r,n),e[i]=Math.round(255*a.r),e[i+1]=Math.round(255*a.g),e[i+2]=Math.round(255*a.b)}(o);break;case"rgb2hsv":!function(e){let t={h:0,s:0,v:0};for(let o=0,s=e.length;o<s;o+=4)r=e[o]/255,n=e[o+1]/255,i=e[o+2]/255,a.setRGB(r,n,i),a.getHSV(t),e[o]=Math.round(255*t.h),e[o+1]=Math.round(255*t.s),e[o+2]=Math.round(255*t.v)}(o);break;case"hsv2rgb":!function(e){let t,r,n;for(let i=0,o=e.length;i<o;i+=4)t=e[i]/255,r=e[i+1]/255,n=e[i+2]/255,a.setHSV(t,r,n),e[i]=Math.round(255*a.r),e[i+1]=Math.round(255*a.g),e[i+2]=Math.round(255*a.b)}(o);break;case"rgb2hsi":!function(e){let t={h:0,s:0,i:0};for(let o=0,s=e.length;o<s;o+=4)r=e[o]/255,n=e[o+1]/255,i=e[o+2]/255,a.setRGB(r,n,i),a.getHSI(t),e[o]=Math.round(255*t.h),e[o+1]=Math.round(255*t.s),e[o+2]=Math.round(255*t.i)}(o);break;case"hsi2rgb":!function(e){let t,r,n;for(let i=0,o=e.length;i<o;i+=4)t=e[i]/255,r=e[i+1]/255,n=e[i+2]/255,a.setHSI(t,r,n),e[i]=Math.round(255*a.r),e[i+1]=Math.round(255*a.g),e[i+2]=Math.round(255*a.b)}(o);break;case"rgb2lab":!function(e){let t={l:0,a:0,b:0};for(let o=0,s=e.length;o<s;o+=4)r=e[o]/255,n=e[o+1]/255,i=e[o+2]/255,a.setRGB(r,n,i),a.getLAB(t),e[o]=Math.round(255*t.l),e[o+1]=Math.round(255*t.a),e[o+2]=Math.round(255*t.b)}(o);break;case"lab2rgb":!function(e){let t,r,n;for(let i=0,o=e.length;i<o;i+=4)t=e[i]/255,r=e[i+1]/255,n=e[i+2]/255,a.setLAB(t,r,n),e[i]=Math.round(255*a.r),e[i+1]=Math.round(255*a.g),e[i+2]=Math.round(255*a.b)}(o)}},E.dipCopy=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.putImageData(e,0,0),r.getImageData(0,0,t.width,t.height)},E.dipNew=function(e,t){return document.createElement("canvas").getContext("2d").createImageData(e,t)},E.dipSplit=function(e){for(var t=[],r=[],n=[],i=[],a=e.data,o=0,s=a.length;o<s;o+=4)t.push(a[o]),r.push(a[o+1]),n.push(a[o+2]),i.push(a[o+3]);var l=e.width,c=e.height;return[{data:t,width:l,height:c},{data:r,width:l,height:c},{data:n,width:l,height:c},{data:i,width:l,height:c}]},E.dipMerge=function(e,t,r,n,i){if(void 0!==i&&void 0!==i.data)for(var a=i.width*i.height,o=e.data,s=t.data,l=r.data,c=n.data,u=i.data,h=0,d=0;d<a;d++,h+=4)u[h]=o[d],u[h+1]=s[d],u[h+2]=l[d],u[h+3]=c[d];else console.warn("JAMIE.dipMerge: pixels.data must be Uint8ClampedArray()")},E.dipConvolve=function(e,t,r){r=!1===r?0:1;for(var n=Math.round(Math.sqrt(t.length)),i=Math.floor(n/2),a=e.data,o=e.width,s=e.height,l=E.dipNew(o,s),c=l.data,u=0;u<s;u++)for(var h=0;h<o;h++){for(var d=4*(u*o+h),f=0,p=0,m=0,v=0,g=0;g<n;g++)for(var y=0;y<n;y++){var x=4*(Math.min(s-1,Math.max(0,u+g-i))*o+Math.min(o-1,Math.max(0,h+y-i))),T=t[g*n+y];f+=a[x]*T,p+=a[x+1]*T,m+=a[x+2]*T,v+=a[x+3]*T}c[d]=f,c[d+1]=p,c[d+2]=m,c[d+3]=v+r*(255-v)}return l},E.verticalConvolve=function(e,t,r){r=!1===r?0:1;for(var n=t.length,i=Math.floor(n/2),a=e.data,o=e.width,s=e.height,l=E.dipNew(o,s),c=l.data,u=0;u<s;u++)for(var h=0;h<o;h++){for(var d=4*(u*o+h),f=0,p=0,m=0,v=0,g=0;g<n;g++){var y=4*(Math.min(s-1,Math.max(0,u+g-i))*o+h),x=t[g];f+=a[y]*x,p+=a[y+1]*x,m+=a[y+2]*x,v+=a[y+3]*x}c[d]=f,c[d+1]=p,c[d+2]=m,c[d+3]=v+r*(255-v)}return l},E.horizontalConvolve=function(e,t,r){r=!1===r?0:1;for(var n=t.length,i=Math.floor(n/2),a=e.data,o=e.width,s=e.height,l=E.dipNew(o,s),c=l.data,u=0;u<s;u++)for(var h=0;h<o;h++){for(var d=4*(u*o+h),f=0,p=0,m=0,v=0,g=0;g<n;g++){var y=4*(u*o+Math.min(o-1,Math.max(0,h+g-i))),x=t[g];f+=a[y]*x,p+=a[y+1]*x,m+=a[y+2]*x,v+=a[y+3]*x}c[d]=f,c[d+1]=p,c[d+2]=m,c[d+3]=v+r*(255-v)}return l},E.separableConvolve=function(e,t,r,n){return E.horizontalConvolve(E.verticalConvolve(e,r,n),t,n)},E.dipGradient=function(e,t){for(var r=e.data,n=t.data,i=e.width,a=e.height,o=[],s=[],l=0,c=r.length;l<c;l+=4)o.push(Math.sqrt(Math.pow(r[l],2)+Math.pow(n[l],2))),o.push(Math.sqrt(Math.pow(r[l+1],2)+Math.pow(n[l+1],2))),o.push(Math.sqrt(Math.pow(r[l+2],2)+Math.pow(n[l+2],2))),o.push(255),s.push(Math.atan2(n[l],r[l])),s.push(Math.atan2(n[l+1],r[l+1])),s.push(Math.atan2(n[l+2],r[l+2])),s.push(255);return{width:i,height:a,magnitudes:o,directions:s}},E.dipHistogram=function(e){for(var t=E.img2pixels(e),r=new Array(257).join("0").split(""),n={r:r.map(Number),g:r.map(Number),b:r.map(Number)},i=0;i<t.data.length;i+=4)n.r[t.data[i]]++,n.g[t.data[i+1]]++,n.b[t.data[i+2]]++;return n},E.dipNonMaxSuppression=function(e,t){for(var r=Math.round(Math.sqrt(25)),n=Math.floor(r/2),i=e.data,a=e.width,o=e.height,s=E.dipNew(a,o),l=s.data,c=0;c<o;c++)for(var u=0;u<a;u++){for(var h=4*(c*a+u),d=i[h],f=i[h+1],p=i[h+2],m=0;m<r;m++)for(var v=0;v<r;v++){var g=c+m-n,y=u+v-n;if(g>=0&&g<o&&y>=0&&y<a){var x=4*(g*a+y),T=Math.atan2(g-c,y-u);d=i[x]*Math.abs(Math.cos(t[h]-T))>d?0:d,f=i[x+1]*Math.abs(Math.cos(t[h+1]-T))>f?0:f,p=i[x+2]*Math.abs(Math.cos(t[h+2]-T))>p?0:p}}l[h]=2*d,l[h+1]=2*f,l[h+2]=2*p,l[h+3]=255}return s},E.dipGaussianBlur1=function(e,t){var r=e.width,n=e.height,i=e.data,a=i.slice();return function(e,t,r,n,i){var a=function(e,t){var r=Math.sqrt(12*e*e/t+1),n=Math.floor(r);n%2==0&&n--;for(var i=n+2,a=(12*e*e-t*n*n-4*t*n-3*t)/(-4*n-4),o=Math.round(a),s=[],l=0;l<t;l++)s.push(l<o?n:i);return s}(i,3);o(e,t,r,n,(a[0]-1)/2),o(t,e,r,n,(a[1]-1)/2),o(e,t,r,n,(a[2]-1)/2)}(i,a,r,n,t),{width:r,height:n,data:a};function o(e,t,r,n,i){for(var a=0;a<e.length;a++)t[a]=e[a];!function(e,t,r,n,i){for(var a=1/(i+i+1),o=0;o<n;o++){for(var s=o*r,l=s,c=s+i,u=e[s],h=e[s+r-1],d=(i+1)*u,f=0;f<i;f++)d+=e[s+f];for(var f=0;f<=i;f++)d+=e[c++]-u,t[s++]=Math.round(d*a);for(var f=i+1;f<r-i;f++)d+=e[c++]-e[l++],t[s++]=Math.round(d*a);for(var f=r-i;f<r;f++)d+=h-e[l++],t[s++]=Math.round(d*a)}}(t,e,r,n,i),function(e,t,r,n,i){for(var a=1/(i+i+1),o=0;o<r;o++){for(var s=o,l=s,c=s+i*r,u=e[s],h=e[s+r*(n-1)],d=(i+1)*u,f=0;f<i;f++)d+=e[s+f*r];for(var f=0;f<=i;f++)d+=e[c]-u,t[s]=Math.round(d*a),c+=r,s+=r;for(var f=i+1;f<n-i;f++)d+=e[c]-e[l],t[s]=Math.round(d*a),l+=r,c+=r,s+=r;for(var f=n-i;f<n;f++)d+=h-e[l],t[s]=Math.round(d*a),l+=r,s+=r}}(e,t,r,n,i)}},E.dipGaussianBlur4=function(e,t){for(var r=[],n=[],i=[],a=[],o=e.width,s=e.height,l=e.data,c=0,u=l.length;c<u;c+=4)r.push(l[c]),n.push(l[c+1]),i.push(l[c+2]),a.push(l[c+3]);var h={width:o,height:s};h.data=r,r=(h=E.dipGaussianBlur1(h,t)).data,h.data=n,n=(h=E.dipGaussianBlur1(h,t)).data,h.data=i,i=(h=E.dipGaussianBlur1(h,t)).data,h.data=a,a=(h=E.dipGaussianBlur1(h,t)).data;for(var d=E.dipNew(o,s),f=d.data,p=(c=0,0);c<u;c+=4,p++)f[c]=r[p],f[c+1]=n[p],f[c+2]=i[p],f[c+3]=a[p];return d},E.dipGaussianBlurd=function(e,t){if((t=Math.abs(t))<=1)return Filters.identity(e);for(var r=t/2,n=Math.ceil(t)+(1-Math.ceil(t)%2),i=new Array(n),a=(r+.5)/3,o=a*a,s=1/Math.sqrt(2*Math.PI*o),l=-1/(2*a*a),c=0,u=Math.floor(n/2),h=0;h<n;h++){var d=h-u,f=s*Math.exp(d*d*l);i[h]=f,c+=f}for(h=0;h<i.length;h++)i[h]/=c;return E.separableConvolve(e,i,i,!1)},E.dipGaussianBlur=function(e,t){if(!t||t<=0)return null;var r=e.width,n=e.height,i=E.dipCopy(e),a=new Uint32Array(i.data.buffer),o=[],s=[],l=function(e){var t,r,n,i,a,o;e<.5&&(e=.5);var s=Math.exp(.527076)/e,l=Math.exp(-s),c=Math.exp(-2*s),u=(1-l)*(1-l)/(1+2*s*l-c);return[t=u,r=u*(s-1)*l,n=u*(s+1)*l,i=-u*c,a=2*l,o=-c,(t+r)/(1-a-o),(n+i)/(1-a-o)]}(t);return c(a,o,s,l,r,n),c(o,a,s,l,n,r),i;function c(e,t,r,n,i,a){var o,s,l,c,u,h,d,f,p,m,v,g,y,E,x,T,b,w,_,R,M,S,A,L,P,C,H,I,k,N;for(P=0;P<a;P++){for(A=P,L=0,l=(o=e[S=P*i])>>8&255,c=o>>16&255,u=o>>24&255,E=w=(s=255&o)*n[6],x=_=l*n[6],T=R=c*n[6],b=M=u*n[6],H=n[0],I=n[1],k=n[4],N=n[5],C=0;C<i;C++)m=(h=255&(o=e[S]))*H+s*I+E*k+w*N,v=(d=o>>8&255)*H+l*I+x*k+_*N,g=(f=o>>16&255)*H+c*I+T*k+R*N,y=(p=o>>24&255)*H+u*I+b*k+M*N,w=E,_=x,R=T,M=b,E=m,x=v,T=g,b=y,s=h,l=d,c=f,u=p,r[L]=E,r[L+1]=x,r[L+2]=T,r[L+3]=b,L+=4,S++;for(L-=4,A+=a*(i-1),l=(o=e[--S])>>8&255,c=o>>16&255,u=o>>24&255,E=w=(s=255&o)*n[7],x=_=l*n[7],T=R=c*n[7],b=M=u*n[7],h=s,d=l,f=c,p=u,H=n[2],I=n[3],C=i-1;C>=0;C--)m=h*H+s*I+E*k+w*N,v=d*H+l*I+x*k+_*N,g=f*H+c*I+T*k+R*N,y=p*H+u*I+b*k+M*N,w=E,_=x,R=T,M=b,E=m,x=v,T=g,b=y,s=h,l=d,c=f,u=p,h=255&(o=e[S]),d=o>>8&255,f=o>>16&255,p=o>>24&255,o=(r[L]+E<<0)+(r[L+1]+x<<8)+(r[L+2]+T<<16)+(r[L+3]+b<<24),t[A]=o,S--,L-=4,A-=a}}},E.dipGaussianFilter=function(e,t){if(5===(t=t||3))var r=[1/(n=256),4/n,6/n,4/n,1/n,4/n,16/n,24/n,16/n,4/n,6/n,24/n,36/n,24/n,6/n,4/n,16/n,24/n,16/n,4/n,1/n,4/n,6/n,4/n,1/n];else{var n;r=[1/(n=16),2/n,1/n,2/n,4/n,2/n,1/n,2/n,1/n]}return E.dipConvolve(e,r)},E.dipBoxFilter=function(e,t){if(5===(t=t||3))var r=new Array(25).fill(.04);else r=new Array(9).fill(1/9);return E.dipConvolve(e,r)},E.dipMedianBlur=function(e,t){t=t||!1;for(var r=Math.floor(1.5),n=e.data,i=e.width,a=e.height,o=E.dipNew(i,a),s=o.data,l=0;l<a;l++)for(var c=0;c<i;c++){for(var u=4*(l*i+c),h=[],d=[],f=[],p=0;p<3;p++)for(var m=0;m<3;m++){var v=l+p-r,g=c+m-r;if(v>=0&&v<a&&g>=0&&g<i){var y=4*(v*i+g);h.push(n[y]),t||(d.push(n[y+1]),f.push(n[y+2]))}}s[u]=h.median(),t?(s[u+1]=s[u],s[u+2]=s[u]):(s[u+1]=d.median(),s[u+2]=f.median()),s[u+3]=255}return o},E.dipMedianBlurs=function(e,t,r){r=r||1;for(var n=e,i=0;i<r;i++)n=E.dipMedianBlur(n,t);return n},E.dipBilateral1=function(e,t,r,n){r=r||15;for(var i=t=t||9,a=t,o=[],s=~~(i/2),l=~~(a/2),c=2*(n=n||75)*n,u=0;u<a;u++)for(var h=0;h<i;h++){let e=h-s,t=u-l,r=e*e+t*t;o[h+u*i]=Math.exp(-r/c)}var d,f,p=e.data,m=e.width,v=e.height,g=E.dipNew(m,v),y=g.data,x=2*r*r;for(u=0;u<v;u++)for(h=0;h<m;h++){let e=h+u*m,t=p[e];d=0,f=0;for(var T=0;T<a;T++)for(var b=0;b<i;b++){let e=h+b-s,r=u+T-l;if(e>=0&&e<m&&r>=0&&r<v){let n=e+r*m,a=t-p[n],s=Math.exp(-a*a/x),l=o[b+i*T]*s;d+=l,f+=l*p[n]}}d=Math.max(1e-5,d),y[e]=f/d}return g},E.dipBilateralRGBi=function(e,t,r,n){r=r||15;for(var i=t=t||9,a=t,o=[],s=~~(i/2),l=~~(a/2),c=2*(n=n||75)*n,u=0;u<a;u++)for(var h=0;h<i;h++){let e=h-s,t=u-l,r=e*e+t*t;o[h+u*i]=Math.exp(-r/c)}for(var d=e.data,f=e.width,p=e.height,m=E.dipNew(f,p),v=m.data,g=2*r*r,y=0,x=[],T=[],b=0,w=d.length;b<w;b+=4)T.push(.2126*d[b]+.7152*d[b+1]+.0722*d[b+2]);for(u=0;u<p;u++)for(h=0;h<f;h++){let e=h+u*f,t=4*e,r=T[e];y=0,x[0]=x[1]=x[2]=0;for(var _=0;_<a;_++)for(b=0;b<i;b++){let e=h+b-s,t=u+_-l;if(e>=0&&e<f&&t>=0&&t<p){let n=e+t*f,a=4*n,s=r-T[n],l=Math.exp(-s*s/g),c=o[b+i*_]*l;y+=c,x[0]+=c*d[a],x[1]+=c*d[a+1],x[2]+=c*d[a+2]}}y=Math.max(1e-5,y),v[t]=x[0]/y,v[t+1]=x[1]/y,v[t+2]=x[2]/y,v[t+3]=255}return m},E.dipBilateralRGBd=function(e,t,r,n){r=r||75;for(var i=t=t||9,a=t,o=[],s=~~(i/2),l=~~(a/2),c=2*(n=n||75)*n,u=0;u<a;u++)for(var h=0;h<i;h++){let e=h-s,t=u-l,r=e*e+t*t;o[h+u*i]=Math.exp(-r/c)}var d=e.data,f=e.width,p=e.height,m=E.dipNew(f,p),v=m.data,g=2*r*r,y=0,x=[],T=[],b=[];for(u=0;u<p;u++)for(h=0;h<f;h++){let e=4*(h+u*f);T[0]=d[e],T[1]=d[e+1],T[2]=d[e+2],y=0,x[0]=x[1]=x[2]=0;for(var w=0;w<a;w++)for(var _=0;_<i;_++){let e=h+_-s,t=u+w-l;if(e>=0&&e<f&&t>=0&&t<p){let r=4*(e+t*f);b[0]=d[r],b[1]=d[r+1],b[2]=d[r+2];let n=0;n+=Math.abs(T[0]-b[0]),n+=Math.abs(T[1]-b[1]),n+=Math.abs(T[2]-b[2]);let a=Math.exp(-n*n/g),s=o[_+i*w]*a;y+=s,x[0]+=s*b[0],x[1]+=s*b[1],x[2]+=s*b[2]}}y=Math.max(1e-5,y),v[e]=x[0]/y,v[e+1]=x[1]/y,v[e+2]=x[2]/y,v[e+3]=255}return m},E.dipBilateralLAB=function(e,t,r,n){var i=E.dipCopy(e);E.dipCvtColor(i,"rgb2lab");var[a,o,s,l]=E.dipSplit(i);return a=E.dipBilateral1(a,t,r,n),E.dipMerge(a,o,s,l,i),E.dipCvtColor(i,"lab2rgb"),i},E.dipBilateral=function(e,t,r,n,i){var a;if(i=void 0!==i?i.toLowerCase():"lab",e.data.length===e.width*e.height)return E.dipBilateral1(e,t,r,n);switch(i){case"rgbi":a=E.dipBilateralRGBi(e,t,r,n);break;case"rgbd":a=E.dipBilateralRGBd(e,t,r,n);break;case"lab":default:a=E.dipBilateralLAB(e,t,r,n)}return a},E.dipHighpass=function(e){return E.dipConvolve(e,[-1,-1,-1,-1,8,-1,-1,-1,-1])},E.dipLaplacian=function(e){return E.dipConvolve(e,[0,-1,0,-1,4,-1,0,-1,0])},E.dipCanny=function(e){var t=E.dipGaussianFilter(e,5),r=E.dipSobelX(t),n=E.dipSobelY(t),i=E.dipGradient(r,n),a=E.dipLaplacian(t);return t=E.dipNonMaxSuppression(a,i.directions),E.dipThresholding(t,8),t},E.dipPrewittY=function(e){var t=[1/3,1/3,1/3,0,0,0,-1/3,-1/3,-1/3];return E.dipConvolve(e,t)},E.dipPrewittX=function(e){var t=[-1/3,0,1/3,-1/3,0,1/3,-1/3,0,1/3];return E.dipConvolve(e,t)},E.dipRobertsY=function(e){return E.dipConvolve(e,[-1,-2,-1,0,0,0,1,2,1])},E.dipRobertsX=function(e){return E.dipConvolve(e,[-1,0,1,-2,0,2,-1,0,1])},E.dipSobelY=function(e){var t=[.25,.5,.25,0,0,0,-.25,-.5,-.25];return E.dipConvolve(e,t)},E.dipSobelX=function(e){var t=[.25,0,-.25,.5,0,-.5,.25,0,-.25];return E.dipConvolve(e,t)},E.dipScharrY=function(e){var t=[3/16,.625,3/16,0,0,0,-3/16,-.625,-3/16];return E.dipConvolve(e,t)},E.dipScharrX=function(e){var t=[3/16,0,-3/16,.625,0,-.625,3/16,0,-3/16];return E.dipConvolve(e,t)},E.dipSharpen=function(e){return E.dipConvolve(e,[0,-1,0,-1,5,-1,0,-1,0])},E.dipEmboss=function(e,t,r){var n=[-1,0,0,0,0,0,0,0,1];void 0!==r&&(n=n.map(e=>e*r));var i=E.dipConvolve(e,n);return!0===t&&E.dipAddConstant(i,128),i},E.dipAddConstant=function(e,t){let r=e.data;for(var n=0,i=r.length;n<i;n+=4)r[n]+=t,r[n+1]+=t,r[n+2]+=t},E.dipConvertTo=function(e,t,r){t=t||1,r=r||0;for(var n=[],i=0;i<256;i++)n[i]=i*t+r;let a=e.data;for(var o=0,s=a.length;o<s;o+=4)a[o]=n[a[o]],a[o+1]=n[a[o+1]],a[o+2]=n[a[o+2]]},E.dipGammaCorrection=function(e,t){for(var r=[],n=0;n<256;n++)r[n]=Math.round(255*Math.pow(n/255,t));let i=e.data;for(var a=0,o=i.length;a<o;a+=4)i[a]=r[i[a]],i[a+1]=r[i[a+1]],i[a+2]=r[i[a+2]]},E.dipAdaptiveGamma1=function(e){e.data=e.data.map(e=>e/255);let t=e.data,r=t.mean(),n=t.std();let i=r<.5?"d":"b",a=4*n<=1/3?"lc"+i:"hc"+i;if("lcd"===a||"lcb"===a)var o=-Math.log2(n);else o=Math.exp((1-(r+n))/2);for(var s=.5-r<=0?0:1,l=Math.pow(r,o),c=0,u=t.length;c<u;c++){let e,r=Math.pow(t[c],o);if("lcb"===a)e=r;else if("lcd"===a)e=r/(r+(1-r)*l);else{e=1/(1+s*(r+(1-r)*l-1))*r}t[c]=Math.round(255*e)}},E.dipAdaptiveGamma=function(e,t){if("hsv"===(t=t||"hsv")){E.dipCvtColor(e,"rgb2hsv");var[r,n,i,a]=E.dipSplit(e);E.dipAdaptiveGamma1(i),E.dipMerge(r,n,i,a,e),E.dipCvtColor(e,"hsv2rgb")}else if("lab"===t){E.dipCvtColor(e,"rgb2lab");var[o,a,s,l]=E.dipSplit(e);E.dipAdaptiveGamma1(o),E.dipMerge(o,a,s,l,e),E.dipCvtColor(e,"lab2rgb")}},E.dipLuminance=function(e){for(var t=e.data,r=0,n=t.length;r<n;r+=4){var i=.2126*t[r]+.7152*t[r+1]+.0722*t[r+2];t[r]=i,t[r+1]=i,t[r+2]=i}},E.dipGrayscale=function(e){for(var t=e.data,r=0,n=t.length;r<n;r+=4){var i=.3*t[r]+.59*t[r+1]+.11*t[r+2];t[r]=i,t[r+1]=i,t[r+2]=i}},E.dipInvert=function(e){for(var t=e.data,r=0,n=t.length;r<n;r+=4)t[r]=255-t[r],t[r+1]=255-t[r+1],t[r+2]=255-t[r+2]},E.dipMirror=function(e){for(var t=[],r=4*e.width,n=e.data,i=0;i<e.height;i++)for(var a=i*r,o=e.width/2,s=0;s<o;s++){var l=4*s,c=l+a,u=r-l-4+a;t[0]=n[c],t[1]=n[c+1],t[2]=n[c+2],t[3]=n[c+3],n[c]=n[u],n[c+1]=n[u+1],n[c+2]=n[u+2],n[c+3]=n[u+3],n[u]=t[0],n[u+1]=t[1],n[u+2]=t[2],n[u+3]=t[3]}},E.dipRed=function(e){for(var t=e.data,r=0,n=t.length;r<n;r+=4)t[r+1]=0,t[r+2]=0},E.dipGreen=function(e){for(var t=e.data,r=0,n=t.length;r<n;r+=4)t[r]=0,t[r+2]=0},E.dipBlue=function(e){for(var t=e.data,r=0,n=t.length;r<n;r+=4)t[r]=0,t[r+1]=0},E.dipSaturation=function(e){for(var t=e.data,r=0,n=t.length;r<n;r+=4){var i=t[r],a=t[r+1],o=t[r+2];t[r]=2.31366*i+-1.15596*a+-.1558*o,t[r+1]=-.58634*i+(2.9-1.15596)*a+-.1558*o,t[r+2]=-.58634*i+-1.15596*a+(2.9-.1558)*o}},E.dipSepia=function(e){for(var t=e.data,r=0,n=t.length;r<n;r+=4){var i=.3*t[r]+.59*t[r+1]+.11*t[r+2];t[r]=i+40,t[r+1]=i+20,t[r+2]=i-20}},E.dipThresholding=function(e,t){t=t||128;for(var r=e.data,n=0,i=r.length;n<i;n+=4){var a=.2126*r[n]+.7152*r[n+1]+.0722*r[n+2];a=a>t?255:0,r[n]=a,r[n+1]=a,r[n+2]=a}},E.dipBrightness=function(e,t){for(var r=e.data,n=0,i=r.length;n<i;n+=4)r[n]+=t,r[n+1]+=t,r[n+2]+=t},E.dipEqzHistogram1=(S=new Uint32Array(256),A=new Uint32Array(256),function(e){S.fill(0);for(var t=e.data,r=0,n=t.length;r<n;r++)S[t[r]]+=1;var i=0;for(r=0;r<256;r++)i+=S[r],A[r]=i;var a=255/(e.width*e.height-A[0]);for(r=0;r<256;r++)A[r]=Math.round((A[r]-A[0])*a);for(r=0,n=t.length;r<n;r++)t[r]=A[t[r]]}),E.dipEqzHistogramRGB=(L=new Uint32Array(256),P=new Uint32Array(256),C=new Uint32Array(256),H=new Uint32Array(256),I=new Uint32Array(256),k=new Uint32Array(256),function(e){L.fill(0),P.fill(0),C.fill(0);for(var t=e.data,r=0,n=t.length;r<n;r+=4)L[t[r]]+=1,P[t[r+1]]+=1,C[t[r+2]]+=1;var i=0,a=0,o=0;for(r=0;r<256;r++)i+=L[r],H[r]=i,a+=P[r],I[r]=a,o+=C[r],k[r]=o;var s=e.width*e.height,l=255/(s-H[0]),c=255/(s-I[0]),u=255/(s-k[0]);for(r=0;r<256;r++)H[r]=Math.round((H[r]-H[0])*l),I[r]=Math.round((I[r]-I[0])*c),k[r]=Math.round((k[r]-k[0])*u);for(r=0,n=t.length;r<n;r+=4)t[r]=H[t[r]],t[r+1]=I[t[r+1]],t[r+2]=k[t[r+2]]}),E.dipEqzHistogramHSV=function(e){for(var t,r,n,i,a,o=new THREE.Color,s={h:0,s:0,v:0},l=[],c=[],u=[],h=e.data,d=e.width,f=e.height,p=0,m=h.length;p<m;p+=4)t=h[p]/255,r=h[p+1]/255,n=h[p+2]/255,o.setRGB(t,r,n),o.getHSV(s),l.push(s.h),c.push(s.s),u.push(Math.round(255*s.v));var v={data:u,width:d,height:f};E.dipEqzHistogram1(v);for(var g=d*f,y=(p=0,0);y<g;y++,p+=4)f=l[y],i=c[y],a=u[y]/255,o.setHSV(f,i,a),h[p]=Math.round(255*o.r),h[p+1]=Math.round(255*o.g),h[p+2]=Math.round(255*o.b)},E.dipEqzHistogramAVG=function(){var e=new Uint32Array(256),t=new Uint32Array(256);return function(r){e.fill(0);for(var n=r.data,i=0,a=n.length;i<a;i+=4)e[n[i]]+=1,e[n[i+1]]+=1,e[n[i+2]]+=1;for(i=0;i<256;i++)e[i]/=3;var o=0;for(i=0;i<256;i++)o+=e[i],t[i]=o;var s=255/(r.width*r.height-t[0]);for(i=0;i<256;i++)t[i]=Math.round((t[i]-t[0])*s);for(i=0,a=n.length;i<a;i+=4)n[i]=t[n[i]],n[i+1]=t[n[i+1]],n[i+2]=t[n[i+2]]}}(),E.dipEqzHistogram=function(e,t){if(t=void 0!==t?t.toLowerCase():"hsv",e.data.length===e.width*e.height)return E.dipEqzHistogram1(e),e;switch(t){case"rgb":E.dipEqzHistogramRGB(e);break;case"hsv":E.dipEqzHistogramHSV(e);break;case"avg":E.dipEqzHistogramAVG(e);break;default:E.dipEqzHistogramHSV(e)}return e},E.dipCLAHE1=function(e,t){for(var r=[t=t||64,t],n=e.width,i=e.height,a=e.data,o=Math.ceil(n/r[0]),s=Math.ceil(i/r[1]),l=new Array(s),c=0;c<s;c++)l[c]=new Array(o);var u=[1/r[0],1/r[1]],h=r[0]*r[1];for(c=0;c<s;c++)for(var d=c*r[1],f=d+r[1],p=0;p<o;p++){var m=p*r[0],v=H(a,m,d,m+r[0],f,256,n,i);l[c][p]=C(v,256,h,.1),l[c][p].forEach((e,t)=>l[c][p][t]=255*e)}for(var g=[],y=0;y<i;y++)for(var E=0;E<n;E++){var x=Math.floor(a[y*n+E]),T=E*u[0]-.5,b=y*u[1]-.5,w=Math.max(Math.floor(T),0),_=Math.min(w+1,o-1),R=Math.max(Math.floor(b),0),M=Math.min(R+1,s-1),S=T-w,A=b-R,L=(1-S)*(1-A)*l[R][w][x]+(1-S)*A*l[M][w][x]+S*(1-A)*l[R][_][x]+S*A*l[M][_][x];g.push(L)}var P=n*i;for(c=0;c<P;c++)a[c]=g[c];function C(e,t,r,n){for(var i=0,a=0;a<t;a++)e[a]=e[a]/r,e[a]>n&&(i=i+e[a]-n,e[a]=n);var o=i/t,s=[];s[0]=e[0]+o;for(a=1;a<t;a++)s[a]=s[a-1]+e[a]+o;return s}function H(e,t,r,n,i,a,o,s){for(var l=[],c=0;c<a;c++)l[c]=0;for(var u=r;u<i;u++)for(var h=t;h<n;h++){var d;d=h>=o&&u<s?u*o+(o-1):u>=s&&h<o?(s-1)*o+h:u>=s&&h>=o?s*o-1:u*o+h,l[Math.floor(e[d])]++}return l}},E.dipCLAHEALPHA=function(e,t){for(var r=e.width,n=e.height,i=e.data,a=[],o=0,s=i.length;o<s;o+=4)a.push((i[o]+i[o+1]+i[o+2])/3);var l={data:a,width:r,height:n};E.dipCLAHE1(l,t);var c=0;for(o=0,s=i.length;o<s;o+=4,c++)i[o+3]=Math.round(2.5*(255-a[c]))},E.dipCLAHELAB=function(e,t){for(var r,n,i,a,o=new THREE.Color,s={l:0,a:0,b:0},l=[],c=[],u=[],h=e.data,d=e.width,f=e.height,p=0,m=h.length;p<m;p+=4)r=h[p]/255,n=h[p+1]/255,a=h[p+2]/255,o.setRGB(r,n,a),o.getLAB(s),l.push(Math.round(255*s.l)),c.push(s.a),u.push(s.b);var v={data:l,width:d,height:f};E.dipCLAHE1(v,t);for(var g=d*f,y=(p=0,0);y<g;y++,p+=4)m=l[y]/255,i=c[y],a=u[y],o.setLAB(m,i,a),h[p]=Math.round(255*o.r),h[p+1]=Math.round(255*o.g),h[p+2]=Math.round(255*o.b)},E.dipCLAHE=function(e,t,r){if(r=void 0!==r?r.toLowerCase():"lab",e.data.length===e.width*e.height)return E.dipCLAHE1(e,t),e;switch(r){case"alpha":E.dipCLAHEALPHA(e,t);break;case"lab":default:E.dipCLAHELAB(e,t)}return e},E.dipNearestIntp=function(e,t,r){let n=e.width,i=e.height,a=e.data,o=a.length===n*i?1:4,s=((t=E.clamp(~~(t+.5),0,n))+(r=E.clamp(~~(r+.5),0,i))*n)*o;return 1===o?[a[s]]:[a[s],a[s+1],a[s+2],a[s+3]]},E.dipLinearIntp=function(e,t,r){let n=e.data,i=e.width,a=e.height,o=n.length===i*a?1:4,s=E.clamp(~~t,0,i),l=E.clamp(~~(t+1),0,i),c=E.clamp(~~r,0,a),u=E.clamp(~~(r+1),0,a),h=(l-t)*(u-r),d=(t-s)*(u-r),f=(l-t)*(r-c),p=(t-s)*(r-c),m=(s+c*i)*o,v=(l+c*i)*o,g=(s+u*i)*o,y=(l+u*i)*o;if(1===o){return[h*n[m]+d*n[v]+f*n[g]+p*n[y]]}return[h*n[m]+d*n[v]+f*n[g]+p*n[y],h*n[m+1]+d*n[v+1]+f*n[g+1]+p*n[y+1],h*n[m+2]+d*n[v+2]+f*n[g+2]+p*n[y+2],h*n[m+3]+d*n[v+3]+f*n[g+3]+p*n[y+3]]},E.dipInterpolate=function(e,t,r,n){return"nearest"===(n=n||"linear")?E.dipNearestIntp(e,t,r):"linear"===n?E.dipLinearIntp(e,t,r):void 0},E.dipTrilinearIntp=function(e,t,r,n,i){i=i||1;let a,o,s,l,c=e.data,u=e.width,h=e.height,d=e.depth,f=u*h,p=E.clamp(~~t,0,u),m=E.clamp(~~(t+1),0,u),v=E.clamp(~~r,0,h),g=E.clamp(~~(r+1),0,h),y=E.clamp(~~n,0,d),x=E.clamp(~~(n+1),0,d),T=(m-t)*(g-r)*(x-n),b=(t-p)*(g-r)*(x-n),w=(m-t)*(r-v)*(x-n),_=(t-p)*(r-v)*(x-n),R=(m-t)*(g-r)*(n-y),M=(t-p)*(g-r)*(n-y),S=(m-t)*(r-v)*(n-y),A=(t-p)*(r-v)*(n-y),L=(p+v*u+y*f)*i,P=(m+v*u+y*f)*i,C=(p+g*u+y*f)*i,H=(m+g*u+y*f)*i,I=(p+v*u+x*f)*i,k=(m+v*u+x*f)*i,N=(p+g*u+x*f)*i,O=(m+g*u+x*f)*i;return i>0&&(a=T*c[L]+b*c[P]+w*c[C]+_*c[H]+R*c[I]+M*c[k]+S*c[N]+A*c[O]),i>1&&(o=T*c[L+1]+b*c[P+1]+w*c[C+1]+_*c[H+1]+R*c[I+1]+M*c[k+1]+S*c[N+1]+A*c[O+1]),i>2&&(s=T*c[L+2]+b*c[P+2]+w*c[C+2]+_*c[H+2]+R*c[I+2]+M*c[k+2]+S*c[N+2]+A*c[O+2]),i>3&&(l=T*c[L+3]+b*c[P+3]+w*c[C+3]+_*c[H+3]+R*c[I+3]+M*c[k+3]+S*c[N+3]+A*c[O+3]),1===i?a:2===i?[a,o]:3===i?[a,o,s]:4===i?[a,o,s,l]:void 0},E.dipAffineTransform=function(e,t){let r=e.width,n=e.height,i=E.dipNew(r,n),a=i.data,o=E.dipInverseAffineMatrix(t);for(let t=0;t<n;t++){let n=t*r;for(let i=0;i<r;i++){let r=[i,t,1],s=E.dipGemv(o,r),l=E.dipInterpolate(e,s[0],s[1]),c=4*(n+i);a[c]=l[0],a[c+1]=l[1],a[c+2]=l[2],a[c+3]=l[3]}}return i},E.dipAffineTransforms=function(e,t,r,n,i,a,o,s,l){t=t||0,r=r||0,n=n||0,i=i||0,a=a||0,"deg"===o&&(a*=THREE.Math.DEG2RAD),s=s||1,l=l||1;let c=e.width,u=e.height,h=E.dipNew(c,u),d=h.data,f=Math.cos(a),p=Math.sin(a),m=1/s,v=1/l;for(let a=0;a<u;a++){let o=a*c;for(let s=0;s<c;s++){let l=m*(f*(s-n)+p*(a-i))+n-t,c=v*(-p*(s-n)+f*(a-i))+i-r,u=E.dipInterpolate(e,l,c),h=4*(o+s);d[h]=u[0],d[h+1]=u[1],d[h+2]=u[2],d[h+3]=u[3]}}return h},E.dipAffineTranslate=function(e,t,r){return E.dipAffineTransforms(e,t,r)},E.dipAffineRotate=function(e,t,r,n,i){return E.dipAffineTransforms(e,0,0,t,r,n,i)},E.dipAffineScale=function(e,t,r,n,i){return E.dipAffineTransforms(e,0,0,t,r,0,0,n,i)},E.dipAffineSkew=function(e,t,r,n,i,a){t=t||0,r=r||0,n=n||0,i=i||0,"deg"===a&&(n*=THREE.Math.DEG2RAD,i*=THREE.Math.DEG2RAD);let o,s=[1,Math.tan(n),0,Math.tan(i),1,0,0,0,1],l=[1,0,t,0,1,r,0,0,1],c=[1,0,-t,0,1,-r,0,0,1];return o=E.dipGemm(l,s),o=E.dipGemm(o,c),E.dipAffineTransform(e,o)},E.dipAffineTriangle=function(e,t,r){let n,i,a,o,s,l,c,u,h,d,f,p;!0===Array.isArray(t)?(n=t[0],c=r[0],i=t[1],u=r[1],a=t[2],h=r[2],o=t[3],d=r[3],s=t[4],f=r[4],l=t[5],p=r[5]):(n=t[0].x,c=r[0].x,i=t[0].y,u=r[0].y,a=t[1].x,h=r[1].x,o=t[1].y,d=r[1].y,s=t[2].x,f=r[2].x,l=t[2].y,p=r[2].y);let m=[n-s,a-s,s,i-l,o-l,l,0,0,1],v=[c-f,h-f,f,u-p,d-p,p,0,0,1],g=E.dipInverseAffineMatrix(m),y=E.dipGemm(v,g);return E.dipAffineTransform(e,y)},E.dipResize=function(e,t,r,n){let i=t,a=r,o=E.dipNew(i,a),s=o.data,l=t/e.width,c=r/e.height;for(let t=0;t<a;t++){let r=t*i,a=t/c;for(let t=0;t<i;t++){let i=t/l,o=E.dipInterpolate(e,i,a,n),c=4*(r+t);s[c]=o[0],s[c+1]=o[1],s[c+2]=o[2],s[c+3]=o[3]}}return o},E.dipHarrisCorners=function(e,t,r,n){function i(e,t){let r=e*e+t*t;return.266*Math.exp(-r/4.5)}t=t||.04,r=r||2,n=n||80;for(var a=e.data,o=e.height,s=e.width,l=0,c=a.length;l<c;l+=4){let e=.2126*a[l]+.7152*a[l+1]+.0722*a[l+2];a[l]=e,a[l+1]=e,a[l+2]=e}var u=4*s,h=4*(s-1),d=o-1,f=[],p=[];for(l=0,c=a.length;l<c;l+=4){let e=l%u,t=~~(l/u);f.push(e>0&&e<h?a[l+4]-a[l-4]:0),p.push(t>0&&t<d?a[l+u]-a[l-u]:0)}for(var m,v,g,y,E,x,T,b,w=[],_=0,R=-r;R<=r;R++)for(l=-r;l<=r;l++){let e=i(l,R);_+=e,w.push(e)}w=w.map(e=>e/_);for(var M,S=[],A=0;A<o;A++)for(var L=0;L<s;L++){m=v=g=y=0,M=0;for(R=-r;R<=r;R++)for(l=-r;l<=r;l++){if(x=A+R,(E=L+l)>=0&&E<s&&x>=0&&x<o){T=f[E+x*s],b=p[E+x*s],m+=w[M]*T*T,y+=w[M]*b*b;let e=w[M]*T*b;v+=e,g+=e}M++}S.push(m*y-v*g-t*Math.pow(m+y,2))}var P=S.min(),C=S.max(),H=[];M=0;for(l=0,c=a.length;l<c;l+=4){if(THREE.Math.mapLinear(S[M],P,C,0,255)>n){let e=M%s,t=~~(M/s);H.push({x:e,y:t})}M++}return H},E.SiftFeature=function(){this.x=0,this.y=0,this.scl=0,this.ori=0,this.d=0,this.descr=new Array(128).fill(0),this.ddata_r=0,this.ddata_c=0,this.ddata_intvl=0,this.ddata_subintvl=0,this.ddata_octv=0,this.ddata_scl_octv=0},Object.assign(E.SiftFeature.prototype,{isSiftFeature:!0,copy:function(e){this.x=e.x,this.y=e.y,this.scl=e.scl,this.ori=e.ori,this.d=e.d,this.descr=e.descr.slice(0,e.d),this.ddata_r=e.ddata_r,this.ddata_c=e.ddata_c,this.ddata_intvl=e.ddata_intvl,this.ddata_subintvl=e.ddata_subintvl,this.ddata_octv=e.ddata_octv,this.ddata_scl_octv=e.ddata_scl_octv},dispose:function(){}}),E.SIFT={INTVLS:3,SIGMA:1.6,CONTR_THR:.04,CURV_THR:10,IMG_DBL:!0,DESCR_WIDTH:4,DESCR_HIST_BINS:8,INIT_SIGMA:.5,IMG_BORDER:2,MAX_INTERP_STEPS:5,ORI_HIST_BINS:36,ORI_SIG_FCTR:1.5,ORI_RADIUS:4.5,ORI_SMOOTH_PASSES:2,ORI_PEAK_RATIO:.8,DESCR_SCL_FCTR:3,DESCR_MAG_THR:.2,INT_DESCR_FCTR:512},E.Sift=function(e,t,r,n,i,a,o){this.octvs=0,this.intvls=e||E.SIFT.INTVLS,this.sigma=t||E.SIFT.SIGMA,this.contr_thr=r||E.SIFT.CONTR_THR,this.curv_thr=n||E.SIFT.CURV_THR,this.img_dbl=i||E.SIFT.IMG_DBL,this.descr_width=a||E.SIFT.DESCR_WIDTH,this.descr_hist_bins=o||E.SIFT.DESCR_HIST_BINS,this.gauss_pyr=null,this.dog_pyr=null,this.gaussPyrIncrSig=new Array(this.intvls+3),this.precompute_incremental_sigmas(),this.orientationHistogram=new Array(E.SIFT.ORI_HIST_BINS),this.alloc_descr_hist()},Object.assign(E.Sift.prototype,{isSift:!0,copy:function(e){if(this.intvls=e.intvls,this.sigma=e.sigma,this.contr_thr=e.contr_thr,this.curv_thr=e.curv_thr,this.img_dbl=e.img_dbl,this.descr_width=e.descr_width,this.descr_hist_bins=e.descr_hist_bins,this.octvs>0){var t=this.intvls,r=t+3,n=t+2,i=this.gauss_pyr,a=this.dog_pyr,o=e.gauss_pyr,s=e.dog_pyr;this.alloc_gauss_pyr(),this.alloc_dog_pyr();for(var l=0;l<this.octvs;l++){for(var c=0;c<r;c++)i[l][c]=E.dipCopy(o[l][c]);for(c=0;c<n;c++)a[l][c]=E.dipCopy(s[l][c])}}this.gaussPyrIncrSig=new Array(this.intvls+3),this.precompute_incremental_sigmas(),this.orientationHistogram=new Array(E.SIFT.ORI_HIST_BINS),this.alloc_descr_hist()},dispose:function(){this.release_pyr(this.gauss_pyr,this.intvls+3),this.release_pyr(this.dog_pyr,this.intvls+2),this.release_descr_hist(),this.gaussPyrIncrSig=null,this.orientationHistogram=null},recommendedOctaves:function(e){return 4},extractFeatures:function(e){if(!e.data||0===e.data.length)return console.warn("Input image is empty."),null;var t=this.create_init_img(e);0===this.octvs&&(this.octvs=this.recommendedOctaves(t)),null!=this.gauss_pyr&&null!=this.dog_pyr||(this.alloc_gauss_pyr(),this.alloc_dog_pyr()),this.build_gauss_pyr(t),this.build_dog_pyr();var r=this.scale_space_extrema();return this.calc_feature_scales(r),this.img_dbl&&this.adjust_for_img_dbl(r),this.calc_feature_oris(r),this.compute_descriptors(r),r},draw_features:function(e,t){var r=document.createElement("canvas"),n=r.getContext("2d");r.width=t.width,r.height=t.height,n.putImageData(t,0,0);return e.forEach(e=>{n.strokeCircle(e.x,e.y,1*e.scl,"red")}),r},create_init_img:function(e){var t=this.convert_to_gray(e),r=E.SIFT.INIT_SIGMA;if(this.img_dbl){var n=Math.sqrt(this.sigma*this.sigma-r*r*4),i=E.dipResize(t,2*e.width,2*e.height,"linear");return t=E.dipGaussianBlur(i,n)}n=Math.sqrt(this.sigma*this.sigma-r*r);return t=E.dipGaussianBlur(t,n)},convert_to_gray:function(e){var t=E.dipCopy(e);return E.dipGrayscale(t),t},build_gauss_pyr:function(e){for(var t=this.intvls,r=t+3,n=this.gauss_pyr,i=this.gaussPyrIncrSig,a=0;a<this.octvs;a++){n[a][0]=0===a?E.dipCopy(e):E.dipResize(n[a-1][t],Math.round(n[a-1][t].width/2),Math.round(n[a-1][t].height/2),"nearest");for(var o=1;o<r;o++)n[a][o]=E.dipGaussianBlur(n[a][o-1],i[o])}},build_dog_pyr:function(){for(var e=this.intvls+2,t=this.gauss_pyr,r=this.dog_pyr,n=0;n<this.octvs;n++)for(var i=0;i<e;i++)r[n][i]=E.dipNew(t[n][i].width,t[n][i].height),a(t[n][i+1],t[n][i],r[n][i]);function a(e,t,r){for(var n,i=r.data,a=e.data,o=t.data,s=0,l=i.length;s<l;s+=4)i[n=s]=a[n]-o[n],i[n=s+1]=a[n]-o[n],i[n=s+2]=a[n]-o[n],i[n=s+3]=255}},get_image_value:function(e,t,r){return E.dipPixelColor(e,r,t).r/255},scale_space_extrema:function(){for(var e=this.intvls,t=this.dog_pyr,r=this.get_image_value,n=E.SIFT.IMG_BORDER,i=[],a=.5*this.contr_thr/e,o=0;o<this.octvs;o++)for(var s=1;s<=e;s++)for(var l=n;l<t[o][0].height-n;l++)for(var c=n;c<t[o][0].width-n;c++){var u=r(t[o][s],l,c);if(Math.abs(u)>a&&this.is_extremum(t,o,s,l,c)){var h=this.interp_extremum(t,o,s,l,c);h&&(this.is_too_edge_like(t[h.ddata_octv][h.ddata_intvl],h.ddata_r,h.ddata_c)?h.dispose():i.push(h))}}return i},is_extremum:function(e,t,r,n,i){for(var a=this.get_image_value,o=a(e[t][r],n,i),s=0,l=0,c=-1;c<=1;c++)for(var u=-1;u<=1;u++)for(var h=-1;h<=1;h++){var d=a(e[t][r+c],n+u,i+h);o<d&&s++,o>d&&l++}return 26===s||26===l},interp_extremum:function(e,t,r,n,i){for(var a,o,s,l=this.intvls,c=E.SIFT.IMG_BORDER,u=E.SIFT.MAX_INTERP_STEPS,h=0;h<u&&([s,o,a]=this.interp_step(e,t,r,n,i),!(Math.abs(a)<.5&&Math.abs(o)<.5&&Math.abs(s)<.5));){if(i+=Math.round(s),n+=Math.round(o),(r+=Math.round(a))<1||r>l||i<c||n<c||i>=e[t][0].width-c||n>=e[t][0].height-c)return null;h++}if(h>=u)return null;var d=this.interp_contr(e,t,r,n,i,a,o,s);if(Math.abs(d)<this.contr_thr/l)return null;var f=new E.SiftFeature;return f.x=(i+s)*Math.pow(2,t),f.y=(n+o)*Math.pow(2,t),f.ddata_r=n,f.ddata_c=i,f.ddata_octv=t,f.ddata_intvl=r,f.ddata_subintvl=a,f},interp_step:function(e,t,r,n,i){var a=this.deriv_3D(e,t,r,n,i),o=this.hessian_3D(e,t,r,n,i),s=E.dipInverseMatrix(o);return a=a.scale(-1),E.dipGemv(s,a)},deriv_3D:function(e,t,r,n,i){var a=this.get_image_value;return[(a(e[t][r],n,i+1)-a(e[t][r],n,i-1))/2,(a(e[t][r],n+1,i)-a(e[t][r],n-1,i))/2,(a(e[t][r+1],n,i)-a(e[t][r-1],n,i))/2]},hessian_3D:function(e,t,r,n,i){var a=this.get_image_value,o=a(e[t][r],n,i),s=a(e[t][r],n,i+1)+a(e[t][r],n,i-1)-2*o,l=a(e[t][r],n+1,i)+a(e[t][r],n-1,i)-2*o,c=a(e[t][r+1],n,i)+a(e[t][r-1],n,i)-2*o,u=(a(e[t][r],n+1,i+1)-a(e[t][r],n+1,i-1)-a(e[t][r],n-1,i+1)+a(e[t][r],n-1,i-1))/4,h=(a(e[t][r+1],n,i+1)-a(e[t][r+1],n,i-1)-a(e[t][r-1],n,i+1)+a(e[t][r-1],n,i-1))/4,d=(a(e[t][r+1],n+1,i)-a(e[t][r+1],n-1,i)-a(e[t][r-1],n+1,i)+a(e[t][r-1],n-1,i))/4;return[s,u,h,u,l,d,h,d,c]},interp_contr:function(e,t,r,n,i,a,o,s){var l=[s,o,a],c=this.deriv_3D(e,t,r,n,i).dot(l);return(0,this.get_image_value)(e[t][r],n,i)+.5*c},is_too_edge_like:function(e,t,r){var n=this.get_image_value,i=n(e,t,r),a=n(e,t,r+1)+n(e,t,r-1)-2*i,o=n(e,t+1,r)+n(e,t-1,r)-2*i,s=(n(e,t+1,r+1)-n(e,t+1,r-1)-n(e,t-1,r+1)+n(e,t-1,r-1))/4,l=a+o,c=a*o-s*s;return c<=0||!(l*l/c<(this.curv_thr+1)*(this.curv_thr+1)/this.curv_thr)},calc_feature_scales:function(e){for(var t=this.intvls,r=this.sigma,n=0,i=e.length;n<i;n++){var a=e[n],o=a.ddata_intvl+a.ddata_subintvl;a.scl=r*Math.pow(2,a.ddata_octv+o/t),a.ddata_scl_octv=r*Math.pow(2,o/t)}},adjust_for_img_dbl:function(e){for(var t=0,r=e.length;t<r;t++){var n=e[t];n.x/=2,n.y/=2,n.scl/=2}},calc_feature_oris:function(e){for(var t=E.SIFT.ORI_SIG_FCTR,r=E.SIFT.ORI_RADIUS,n=E.SIFT.ORI_SMOOTH_PASSES,i=E.SIFT.ORI_PEAK_RATIO,a=e.length,o=this.gauss_pyr,s=0;s<a;s++){var l=e[s];this.compute_ori_hist(o[l.ddata_octv][l.ddata_intvl],l.ddata_r,l.ddata_c,Math.round(r*l.ddata_scl_octv),t*l.ddata_scl_octv);for(var c=0;c<n;c++)this.smooth_ori_hist();var u=this.dominant_ori();this.add_good_ori_features(e,u*i,l),l.dispose()}e.remove(0,a-1)},compute_ori_hist:function(e,t,r,n,i){var a={},o=2*Math.PI,s=E.SIFT.ORI_HIST_BINS,l=new Array(s).fill(0);this.orientationHistogram=l;for(var c=2*i*i,u=-n;u<=n;u++)for(var h=-n;h<=n;h++)if(this.calc_grad_mag_ori(e,t+u,r+h,a)){var d=a.mag,f=a.ori,p=Math.exp(-(u*u+h*h)/c),m=Math.round(s*(f+Math.PI)/o);l[m=m<s?m:0]+=p*d}},calc_grad_mag_ori:function(e,t,r,n){if(t>0&&t<e.height-1&&r>0&&r<e.width-1){var i=this.get_image_value,a=i(e,t,r+1)-i(e,t,r-1),o=i(e,t-1,r)-i(e,t+1,r);return n.mag=Math.sqrt(a*a+o*o),n.ori=Math.atan2(o,a),!0}return!1},smooth_ori_hist:function(){for(var e=E.SIFT.ORI_HIST_BINS,t=this.orientationHistogram,r=t[0],n=t[e-1],i=0;i<e;i++){var a=t[i];t[i]=.25*n+.5*t[i]+.25*(i+1===e?r:t[i+1]),n=a}},dominant_ori:function(){for(var e=E.SIFT.ORI_HIST_BINS,t=this.orientationHistogram,r=t[0],n=1;n<e;n++)t[n]>r&&(r=t[n]);return r},interp_hist_peak:function(e,t,r){return.5*(e-r)/(e-2*t+r)},add_good_ori_features:function(e,t,r){for(var n=E.SIFT.ORI_HIST_BINS,i=this.orientationHistogram,a=2*Math.PI,o=0;o<n;o++){var s=0===o?n-1:o-1,l=(o+1)%n;if(i[o]>i[s]&&i[o]>i[l]&&i[o]>=t){var c=o+this.interp_hist_peak(i[s],i[o],i[l]);c=c<0?n+c:c>=n?c-n:c;var u=new E.SiftFeature;u.copy(r),u.ori=a*c/n-Math.PI,e.push(u)}}},compute_descriptors:function(e){for(var t=this.gauss_pyr,r=0,n=e.length;r<n;r++){var i=e[r];this.descr_hist(t[i.ddata_octv][i.ddata_intvl],i.ddata_r,i.ddata_c,i.ori,i.ddata_scl_octv),this.hist_to_descr(i)}},descr_hist:function(e,t,r,n,i){for(var a=E.SIFT.DESCR_SCL_FCTR,o=this.descr_width,s=this.descr_hist_bins,l={},c=2*Math.PI,u=Math.cos(n),h=Math.sin(n),d=s/c,f=o*o*.5,p=a*i,m=Math.floor(p*Math.sqrt(2)*(o+1)*.5+.5),v=-m;v<=m;v++)for(var g=-m;g<=m;g++){var y=(g*u-v*h)/p,x=(g*h+v*u)/p,T=x+o/2-.5,b=y+o/2-.5;if(T>-1&&T<o&&b>-1&&b<o&&this.calc_grad_mag_ori(e,t+v,r+g,l)){var w=l.mag,_=l.ori;for(_-=n;_<0;)_+=c;for(;_>=c;)_-=c;var R=_*d,M=Math.exp(-(y*y+x*x)/f);this.interp_desc_hist_entry(T,b,R,w*M)}}},interp_desc_hist_entry:function(e,t,r,n){for(var i=Math.floor(e),a=Math.floor(t),o=Math.floor(r),s=e-i,l=t-a,c=r-o,u=this.descr_width,h=this.descr_hist_bins,d=this.descriptorHistogram,f=0;f<=1;f++){var p=i+f;if(p>=0&&p<u)for(var m=n*(0===f?1-s:s),v=d[p],g=0;g<=1;g++){var y=a+g;if(y>=0&&y<u)for(var E=m*(0===g?1-l:l),x=v[y],T=0;T<=1;T++){var b=E*(0===T?1-c:c);x[(o+T)%h]+=b}}}},hist_to_descr:function(e){for(var t=E.SIFT.DESCR_MAG_THR,r=E.SIFT.INT_DESCR_FCTR,n=this.descr_width,i=this.descr_hist_bins,a=this.descriptorHistogram,o=0,s=0;s<n;s++)for(var l=0;l<n;l++)for(var c=0;c<i;c++)e.descr[o++]=a[s][l][c];e.d=o,this.normalize_descr(e);for(var u=0;u<o;u++)e.descr[u]>t&&(e.descr[u]=t);this.normalize_descr(e);for(u=0;u<o;u++){var h=Math.floor(r*e.descr[u]);e.descr[u]=Math.min(255,h)}},normalize_descr:function(e){for(var t=0,r=e.d,n=0;n<r;n++){var i=e.descr[n];t+=i*i}var a=1/Math.sqrt(t);for(n=0;n<r;n++)e.descr[n]*=a},release_descr_hist:function(){descriptorHistogram=null},release_pyr:function(e,t){null},alloc_gauss_pyr:function(){for(var e=this.intvls+3,t=new Array(this.octvs),r=0;r<this.octvs;r++)t[r]=new Array(e);this.gauss_pyr=t},alloc_dog_pyr:function(){for(var e=this.intvls+2,t=new Array(this.octvs),r=0;r<this.octvs;r++)t[r]=new Array(e);this.dog_pyr=t},precompute_incremental_sigmas:function(){var e=this.intvls,t=Math.pow(2,1/e),r=this.gaussPyrIncrSig;r[0]=this.sigma,r[1]=this.sigma*Math.sqrt(t*t-1);for(var n=2;n<e+3;n++)r[n]=r[n-1]*t},alloc_descr_hist:function(){var e=this.descr_width,t=this.descr_hist_bins,r=new Array(e);this.descriptorHistogram=r;for(var n=0;n<e;n++){r[n]=new Array(e);for(var i=0;i<e;i++)r[n][i]=new Array(t).fill(0)}}}),E.imageProcessing=function(e,t,r,n){r=r||{};new Promise(function(e){"DitheringShader"===t?(new THREE.TextureLoader).load("images/noise8.png",function(t){e(t)}):e(1)}).then(function(i){var a=e,o=a.image.width,s=a.image.height,l=E[t],c=new THREE.ShaderPass(l,"not_used");switch(c.uniforms.tDiffuse.value=a,t){case"DitheringShader":c.uniforms.tNoise.value=i;break;case"GaussianBlurShader":c.uniforms.resolution.value.set(1/o,1/s),c.uniforms.strength.value=r.strength||3.5,c.uniforms.horizontalPass.value=0;break;case"EdgeDetectionShader":c.uniforms.resolution.value.set(1/o,1/s);break;case"EdgeDetection2Shader":c.uniforms.resolution.value.set(1/o,1/s),c.material.defines.EDGE_FUNC=r.edgeFunc||"edge";break;case"VignetteShader":c.uniforms.offset.value=r.offset||1,c.uniforms.darkness.value=r.darkness||1;break;case"FilmGrainShader":c.uniforms.aspectCorrection.value=r.aspectCorrection||!1,c.uniforms.aspect.value=r.aspect||1,c.uniforms.grainScale.value=r.grainScale||.005,c.uniforms.grainTime.value=r.grainTime||0,c.uniforms.noiseAlpha.value=r.noiseAlpha||.25,c.uniforms.offset.value.copy(r.offset||new THREE.Vector2(0,0)),c.uniforms.scale.value.copy(r.scale||new THREE.Vector2(1,1)),c.uniforms.smoothEdge.value.copy(r.smoothEdge||new THREE.Vector2(0,1)),c.uniforms.color1.value.copy(new THREE.Color(r.color1||16777215)),c.uniforms.color2.value.copy(new THREE.Color(r.color2||2635844))}var u=new THREE.EffectComposer(E.renderer);if(u.addPass(c),"GaussianBlurShader"===t){var h=E[t],d=new THREE.ShaderPass(h,"tDiffuse");d.uniforms.resolution.value.copy(c.uniforms.resolution.value),d.uniforms.strength.value=c.uniforms.strength.value,d.uniforms.horizontalPass.value=1,u.addPass(d)}if(u.setSize(o,s),u.render(),n){var f=new Image(o,s);f.onload=function(){var e=new THREE.Texture(f);e.needsUpdate=!0,n&&n(e)};var p=E.renderer.domElement.toDataURL();f.src=p}})},E.imageFileProcessing=function(e,t,r){(new THREE.TextureLoader).load(e,function(e){var n=e.image.width,i=e.image.height;E.imageProcessing(e,t,r,function(e){var t=void 0===r.showImage||r.showImage,a=void 0===r.saveImage||r.saveImage;if(t&&E.add(E.createPrimitive({geometry:{type:"PlaneBufferGeometry",parameters:[10,10]},material:{type:"MeshBasicMaterial",map:e}})),a){var o=E.renderer.getContext(),s=new Uint8Array(n*i*4);o.readPixels(0,0,n,i,o.RGBA,o.UNSIGNED_BYTE,s);var l=new ImageData(new Uint8ClampedArray(s),n,i),c=document.createElement("canvas"),u=c.getContext("2d");c.width=l.width,c.height=l.height,u.putImageData(l,0,0),u.scale(1,-1),u.translate(0,-l.height),u.drawImage(c,0,0),u.setTransform(1,0,0,1,0,0),c.toBlob(function(e){Object(N.saveAs)(e,"image.png")})}})})},E.screenCapture=function(e,t){e=void 0!==e?e:"capture.png",t=void 0===t||t;var r=E.appWorks.renderer;if(r.preserveDrawingBuffer=!0,E.appWorks.composer?E.appWorks.composer.render():E.appWorks.renderScene(),!0===t)r.domElement.toBlob(function(t){Object(N.saveAs)(t,e)});else{var n=e.split(".").pop().toLowerCase();"jpg"===n&&(n="jpeg");var i=r.domElement.toDataURL("image/"+n);E.url2saveas(i,e)}r.preserveDrawingBuffer=!1};var O=r(7);THREE.ShaderChunk.begin_vertex=["#ifndef INSTANCE_TRANSFORM","vec3 transformed = vec3( position );","#else","#ifndef INSTANCE_MATRIX","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","vec3 transformed = ( _instanceMatrix * vec4( position , 1. )).xyz;","#endif"].join("\n"),THREE.ShaderChunk.color_fragment=["#ifdef USE_COLOR","diffuseColor.rgb *= vColor;","#endif","#if defined(INSTANCE_COLOR)","diffuseColor.rgb *= vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_pars_fragment=["#ifdef USE_COLOR","varying vec3 vColor;","#endif","#if defined( INSTANCE_COLOR )","varying vec3 vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_vertex=["#ifdef USE_COLOR","vColor.xyz = color.xyz;","#endif","#if defined( INSTANCE_COLOR ) && defined( INSTANCE_TRANSFORM )","vInstanceColor = instanceColor;","#endif"].join("\n"),THREE.ShaderChunk.defaultnormal_vertex=["#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","#ifndef INSTANCE_TRANSFORM","vec3 transformedNormal = normalMatrix * objectNormal;","#else","#ifndef INSTANCE_MATRIX ","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","#ifndef INSTANCE_UNIFORM","vec3 transformedNormal =  transposeMat3( inversemat( mat3( modelViewMatrix * _instanceMatrix ) ) ) * objectNormal ;","#else","vec3 transformedNormal = ( modelViewMatrix * _instanceMatrix * vec4( objectNormal , 0.0 ) ).xyz;","#endif","#endif"].join("\n"),THREE.ShaderChunk.uv_pars_vertex=["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )","varying vec2 vUv;","uniform mat3 uvTransform;","#endif","#ifdef INSTANCE_TRANSFORM","mat3 inversemat(mat3 m) {","float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];","float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];","float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];","float b01 = a22 * a11 - a12 * a21;","float b11 = -a22 * a10 + a12 * a20;","float b21 = a21 * a10 - a11 * a20;","float det = a00 * b01 + a01 * b11 + a02 * b21;","return mat3(b01, (-a22 * a01 + a02 * a21), ( a12 * a01 - a02 * a11),","b11, ( a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),","b21, (-a21 * a00 + a01 * a20), ( a11 * a00 - a01 * a10)) / det;","}","attribute vec3 instancePosition;","attribute vec4 instanceQuaternion;","attribute vec3 instanceScale;","#if defined( INSTANCE_COLOR )","attribute vec3 instanceColor;","varying vec3 vInstanceColor;","#endif","mat4 getInstanceMatrix(){","vec4 q = instanceQuaternion;","vec3 s = instanceScale;","vec3 v = instancePosition;","vec3 q2 = q.xyz + q.xyz;","vec3 a = q.xxx * q2.xyz;","vec3 b = q.yyz * q2.yzz;","vec3 c = q.www * q2.xyz;","vec3 r0 = vec3( 1.0 - (b.x + b.z) , a.y + c.z , a.z - c.y ) * s.xxx;","vec3 r1 = vec3( a.y - c.z , 1.0 - (a.x + b.z) , b.y + c.x ) * s.yyy;","vec3 r2 = vec3( a.z + c.y , b.y - c.x , 1.0 - (a.x + b.x) ) * s.zzz;","return mat4(","r0 , 0.0,","r1 , 0.0,","r2 , 0.0,","v  , 1.0",");","}","#endif"].join("\n"),E.DEPTH_MATERIAL=new THREE.MeshDepthMaterial,E.DEPTH_MATERIAL.depthPacking=THREE.RGBADepthPacking,E.DEPTH_MATERIAL.clipping=!0,E.DEPTH_MATERIAL.defines={INSTANCE_TRANSFORM:""},E.DISTANCE_MATERIAL=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:"",INSTANCE_TRANSFORM:""},uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.distanceRGBA.uniforms),vertexShader:THREE.ShaderLib.distanceRGBA.vertexShader,fragmentShader:THREE.ShaderLib.distanceRGBA.fragmentShader,clipping:!0}),E.InstancedMesh=function(e,t,r,n,i,a){void 0!==arguments[0]&&arguments[0].isObject3D?this.fromObject(arguments[0]):this.create(e,t,r,n,i,a),this.isJamieInstancedMesh=!0,this.userData.type="InstancedMesh"},E.InstancedMesh.prototype=Object.create(THREE.Mesh.prototype),E.InstancedMesh.prototype.constructor=E.InstancedMesh,E.InstancedMesh.prototype.create=function(e,t,r,n,i,a){THREE.Mesh.call(this,(new THREE.InstancedBufferGeometry).copy(e)),this.numInstances=void 0!==r?r:1,this.dynamic=void 0!==n&&n,this.colors=void 0!==i&&i,this.uniformScale=void 0===a||a,this._setAttributes(),this.material=t.clone(),this.customDepthMaterial=E.DEPTH_MATERIAL,this.customDistanceMaterial=E.DISTANCE_MATERIAL,this.frustumCulled=!1,this.name="instancedMesh";var o=this.userData;o.numInstances=this.numInstances,o.dynamic=this.dynamic,o.colors=this.colors,o.uniformScale=this.uniformScale},Object.defineProperties(E.InstancedMesh.prototype,{material:{set:function(e){(e=e.clone()).defines?(e.defines.INSTANCE_TRANSFORM="",this.uniformScale?e.defines.INSTANCE_UNIFORM="":delete e.defines.INSTANCE_UNIFORM,this.colors?e.defines.INSTANCE_COLOR="":delete e.defines.INSTANCE_COLOR):(e.defines={INSTANCE_TRANSFORM:""},this.uniformScale&&(e.defines.INSTANCE_UNIFORM=""),this.colors&&(e.defines.INSTANCE_COLOR="")),this._material=e},get:function(){return this._material}},numInstances:{set:function(e){this._numInstances=e},get:function(){return this._numInstances}},geometry:{set:function(e){this._geometry=e},get:function(){return this._geometry}}}),E.InstancedMesh.prototype.setPositionAt=function(e,t){this.geometry.attributes.instancePosition.setXYZ(e,t.x,t.y,t.z)},E.InstancedMesh.prototype.setQuaternionAt=function(e,t){this.geometry.attributes.instanceQuaternion.setXYZW(e,t.x,t.y,t.z,t.w)},E.InstancedMesh.prototype.setScaleAt=function(e,t){this.geometry.attributes.instanceScale.setXYZ(e,t.x,t.y,t.z)},E.InstancedMesh.prototype.setColorAt=function(e,t){this.colors?this.geometry.attributes.instanceColor.setXYZ(e,Math.floor(255*t.r),Math.floor(255*t.g),Math.floor(255*t.b)):console.warn("JAMIE.InstancedMesh: color not enabled")},E.InstancedMesh.prototype.getPositionAt=function(e,t){var r=this.geometry.attributes.instancePosition.array;return e*=3,t?t.set(r[e++],r[e++],r[e]):new THREE.Vector3(r[e++],r[e++],r[e])},E.InstancedMesh.prototype.getQuaternionAt=function(e,t){var r=this.geometry.attributes.instanceQuaternion.array;return e<<=2,t?t.set(r[e++],r[e++],r[e++],r[e]):new THREE.Quaternion(r[e++],r[e++],r[e++],r[e])},E.InstancedMesh.prototype.getScaleAt=function(e,t){var r=this.geometry.attributes.instanceScale.array;return e*=3,t?t.set(r[e++],r[e++],r[e]):new THREE.Vector3(r[e++],r[e++],r[e])},E.InstancedMesh.prototype.getColorAt=function(e,t){if(!this.colors)return console.warn("JAMIE.InstancedMesh: color not enabled"),!1;var r=this.geometry.attributes.instanceColor.array;return e*=3,t?t.setRGB(r[e++]*(1/255),r[e++]*(1/255),r[e]*(1/255)):new THREE.Vector3(r[e++],r[e++],r[e]).multiplyScalar(1/255)},E.InstancedMesh.prototype.needsUpdate=function(e){switch(e){case"position":this.geometry.attributes.instancePosition.needsUpdate=!0;break;case"quaternion":this.geometry.attributes.instanceQuaternion.needsUpdate=!0;break;case"scale":this.geometry.attributes.instanceScale.needsUpdate=!0;break;case"colors":this.geometry.attributes.instanceColor.needsUpdate=!0;break;default:this.geometry.attributes.instancePosition.needsUpdate=!0,this.geometry.attributes.instanceQuaternion.needsUpdate=!0,this.geometry.attributes.instanceScale.needsUpdate=!0,this.colors&&(this.geometry.attributes.instanceColor.needsUpdate=!0)}},E.InstancedMesh.prototype._setAttributes=function(){this.geometry.setAttribute("instancePosition",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0)),this.geometry.setAttribute("instanceQuaternion",new THREE.InstancedBufferAttribute(new Float32Array(4*this.numInstances),4,!0)),this.geometry.setAttribute("instanceScale",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0));var e=!0===this.dynamic?THREE.DynamicDrawUsage:THREE.StaticDrawUsage;this.geometry.attributes.instancePosition.usage=e,this.geometry.attributes.instanceQuaternion.usage=e,this.geometry.attributes.instanceScale.usage=e,this.colors&&(this.geometry.setAttribute("instanceColor",new THREE.InstancedBufferAttribute(new Uint8Array(3*this.numInstances),3,!0)),this.geometry.attributes.instanceColor.normalized=!0,this.geometry.attributes.instanceColor.usage=e)},E.InstancedMesh.prototype.fromObject=function(e){var t=e.geometry.clone();delete t.attributes.instanceColor,delete t.attributes.instancePosition,delete t.attributes.instanceQuaternion,delete t.attributes.instanceScale;var r=e.userData;this.create(t,e.material,r.numInstances,r.dynamic,r.colors,r.uniformScale);var n=this.geometry.attributes,i=e.geometry.attributes;n.instancePosition.copy(i.instancePosition),n.instanceQuaternion.copy(i.instanceQuaternion),n.instanceScale.copy(i.instanceScale),i.instanceColor&&n.instanceColor.copy(i.instanceColor)},E.InstancedMesh.prototype.toJSON=function(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)},E.InstancedMesh.prototype.clone=function(){var e=new E.InstancedMesh(this);return E.copyTransform(e,this),e},E.InstancedMesh.prototype.split=function(e){for(var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3,a=new THREE.Color,o=this.material,s=this.geometry.attributes,l=s.instancePosition,c=s.instanceQuaternion,u=s.instanceScale,h=s.instanceColor,d=l.count,f=0;f<d;f++){r.fromArray(l.array,3*f),n.fromArray(c.array,4*f),i.fromArray(u.array,3*f);var p=new THREE.BufferGeometry;for(var m in s){var v=s[m];!0!==v.isInstancedBufferAttribute&&p.setAttribute(m,v.clone())}var g=o;h&&(a.fromArray(h.array,3*f),a.multiplyScalar(1/255),(g=o.clone()).color.copy(a));var y=new THREE.Mesh(p,g);y.position.copy(r),y.quaternion.copy(n),y.scale.copy(i),t.push(y)}e&&e(t)},E.InstancedMesh.prototype.increaseInstances=function(e){!1===Array.isArray(e)&&(e=[e]);var t=this.geometry.attributes;for(var r in t){var n=t[r];if(!0===n.isInstancedBufferAttribute){var i=[];i.push(n),e.forEach(e=>{i.push(e.geometry.attributes[r])}),t[r]=THREE.BufferGeometryUtils.mergeInstancedBufferAttribute(i),t[r].needsUpdate=!0}}e.forEach(e=>{this.numInstances+=e.geometry.attributes.instancePosition.count}),this.userData.numInstances=this.numInstances},E.createStructuredMesh=function(e,t){t=t||{};var r=E.toNonIndexedBufferGeometry(e.geometry),n=e.material,i=E.structuredPositions(t),a=i.length/3;if(0!==a){t.numInstances=a;var o=E.randomColors(t);o&&0!==o.length||(o=void 0);var s=new E.InstancedMesh(r,n,a,!1,!!o,!0);s.name="structuredMesh",s.frustumCulled=!1,E.copyTransform(s,e);for(var l=new THREE.Vector3,c=new THREE.Quaternion(0,0,0,1),u=new THREE.Vector3(1,1,1),h=new THREE.Color,d=0,f=0;d<a;d++,f+=3)l.fromArray(i,f),s.setPositionAt(d,l),s.setQuaternionAt(d,c),s.setScaleAt(d,u),void 0!==o&&(h.fromArray(o,f),s.setColorAt(d,h));return s}},E.createScatteredMesh=function(e,t){t=t||{};var r=E.toNonIndexedBufferGeometry(e.geometry),n=e.material,i=E.scatteredPositions(t),a=i.positions,o=i.rotations,s=i.scales,l=a.length/3;if(0!==l){var c=E.randomColors(t);c&&0!==c.length||(c=void 0);var u=new E.InstancedMesh(r,n,l,!1,!!c,!0);u.name="scatteredMesh",u.frustumCulled=!1,E.copyTransform(u,e);for(var h=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Euler,p=new THREE.Quaternion(0,0,0,1),m=new THREE.Vector3(1,1,1),v=new THREE.Color,g=0,y=0;g<l;g++,y+=3)h.fromArray(a,y),void 0!==o&&(d.fromArray(o,y),f.setFromVector3(d),p.setFromEuler(f)),void 0!==s&&m.fromArray(s,y),u.setPositionAt(g,h),u.setQuaternionAt(g,p),u.setScaleAt(g,m),void 0!==c&&(v.fromArray(c,y),u.setColorAt(g,v));return u}},E.createInstancedMeshes=function(e,t){t=t||{};!1===Array.isArray(e)&&(e=[e]);for(var r,n=[],i=0,a=e.length;i<a;i++)r=void 0!==t.pattern?E.createStructuredMesh(e[i],t):E.createScatteredMesh(e[i],t),n.push(r);return 1===n.length?n[0]:n},E.createInstancedObject=function(e,t){if(void 0===t.seed&&(t.seed=e.id),!0===e.isMesh)return E.createInstancedMeshes(e,t);var r=new THREE.Object3D;r.name=e.name;for(var n=e.children,i=0,a=n.length;i<a;i++){var o=E.createInstancedObject(n[i],t);r.add(o)}return E.copyTransform(r,e),r},E.CSGBoolean=function(e,t,r){t=t||"union";var n=new ThreeBSP(e),i=new ThreeBSP(r);"union"===t||"+"===t?n=n.union(i):"intersect"===t||"*"===t?n=n.intersect(i):"subtract"!==t&&"-"!==t||(n=n.subtract(i));var a=null;return e instanceof THREE.Mesh?a=n.toMesh(null):e instanceof THREE.BufferGeometry?a=n.toNonIndexedBufferGeometry():e instanceof THREE.Geometry&&(a=n.toGeometry()),a},E.union=function(e,t){return E.CSGBoolean(e,"+",t)},E.intersect=function(e,t){return E.CSGBoolean(e,"*",t)},E.subtract=function(e,t){return E.CSGBoolean(e,"-",t)},E.createWireframe=function(e,t,r){var n;t=void 0!==t?t:0,r=void 0!==r&&r;(i=e.material).polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=1,i.needsUpdate=!0,n=r?new THREE.EdgesGeometry(e.geometry):new THREE.WireframeGeometry(e.geometry);var i=new THREE.LineBasicMaterial({color:t,linewidth:2});return new THREE.LineSegments(n,i)},E.createVertexPoints=function(e,t,r,n){var i=E.getObjectSize(e);t=t||i/100,r=r||16777215,n=n||!0;return new THREE.Points(e.geometry,new THREE.PointsMaterial({map:(new THREE.TextureLoader).load("images/sprites/ball.png"),size:t,color:r,depthTest:n,transparent:!0}))},E.TextSprite=function(e,t){t=t||{};var r={};r.string=e||"",r.height=t.textHeight||.5,r.widthScale=t.textWidthScale||1,r.color=t.textColor||"#ffffff",r.align=t.textAlign||"center",r.baseline=t.textBaseline||"middle",this.text=r;var n={};n.style=t.fontStyle||"normal",n.variant=t.fontVariant||"normal",n.weight=t.fontWeight||"normal",n.size=t.fontSize||"64px",n.family=t.fontFamily||"Karla, sans-serif",this.font=n;var i=document.createElement("canvas");i.height=parseInt(n.size),i.width=i.height*r.string.length;var a=i.getContext("2d");a.font=n.style+" "+n.variant+" "+n.weight+" "+n.size+" "+n.family,a.textAlign=r.align,a.textBaseline=r.baseline,a.fillStyle=E.toHexStyle(r.color),a.fillText(r.string,i.width/2,i.height/2),this.ctx=a;var o=new THREE.CanvasTexture(this.ctx.canvas),s=new THREE.SpriteMaterial({color:16777215,map:o});THREE.Sprite.call(this,s),this.type="TextSprite";var l=r.height*r.string.length*r.widthScale;this.scale.set(l,r.height,1)},E.TextSprite.prototype=Object.assign(Object.create(THREE.Sprite.prototype),{constructor:E.TextSprite,isTextSprite:!0,copy:function(e){return THREE.Sprite.prototype.copy.call(this,e),this.text=JSON.parse(JSON.stringify(e.text)),this.font=JSON.parse(JSON.stringify(e.font)),this.ctx.drawImage(e.ctx.canvas,0,0),this},clone:function(){return new this.constructor(this.text.string).copy(this)},updateText:function(e){var t=this.ctx.canvas,r=this.ctx,n=this.text,i=this.font;n.string=e||"",t.height=parseInt(i.size),t.width=t.height*n.string.length,r.font=i.style+" "+i.variant+" "+i.weight+" "+i.size+" "+i.family,r.textAlign=n.align,r.textBaseline=n.baseline,r.fillStyle=E.toHexStyle(n.color),r.fillText(n.string,t.width/2,t.height/2);var a=n.height*n.string.length*n.widthScale;this.scale.set(a,n.height,1),this.material.map.needsUpdate=!0}}),E.createTextSprite=function(e,t){return new E.TextSprite(e,t)},E.addTextMesh=function(e,t){e=e||"text",(t=t||{}).position=t.position||{x:0,y:0,z:0},t.color=t.color||16777215,t.height=t.height||1,t.thickRatio=t.thickRatio||.25,t.alignment=t.alignment||1,t.rotSpeed=t.rotSpeed||0,t.fontFile=t.fontFile||"fonts/gentilis_regular.typeface.json",(new THREE.FontLoader).load(t.fontFile,function(r){var n=new THREE.MeshPhongMaterial({color:t.color,specular:t.color}),i=new THREE.TextBufferGeometry(e,{font:r,size:100,height:100*t.thickRatio,curveSegments:12,bevelEnabled:!0,bevelThickness:2,bevelSize:5,bevelSegments:3});i.computeBoundingBox();var a=(i.boundingBox.max.x-i.boundingBox.min.x)*t.alignment/2,o=(new THREE.Matrix4).makeTranslation(-a,0,0);i.applyMatrix(o);var s=new THREE.Mesh(i,n);s.scale.setScalar(t.height/100),s.position.set(t.position.x,t.position.y,t.position.z),s.castShadow=!0,s.receiveShadow=!0,s.name=e,0!==t.rotSpeed&&(s.update=function(e,r){this.rotation.y+=t.rotSpeed*e}),E.add(s)})},E.createPrimitive=function(e){var t=new THREE[e.geometry.type](...e.geometry.parameters),r=e.material.type;delete e.material.type;var n=new THREE[r](e.material);e.material.type=n.type;var i=new THREE.Mesh(t,n),a=t.type.replace("Buffer","").replace("Geometry",""),o=n.type.replace("Mesh","").replace("Material","");return i.name=a+o,i.frustumCulled=!1,i.castShadow=!0,i.receiveShadow=!0,i},E.createCheckerboard=function(e,t){e=void 0!==e?e:100,t=void 0!==t?t:5;var r=(new THREE.TextureLoader).load("images/grid2x2.png",r=>{r.wrapS=THREE.RepeatWrapping,r.wrapT=THREE.RepeatWrapping,r.repeat.set(e/(2*t),e/(2*t))}),n=E.createPrimitive({geometry:{type:"PlaneBufferGeometry",parameters:[e,e]},material:{type:"MeshPhongMaterial",map:r}});return n.rotation.x=-Math.PI/2,n},E.tweenObject=function(e,t,r){var n=void 0!==(r=r||{}).duration?r.duration:1e3,i=new O.Tween(e).to(t,n);return void 0!==r.easing&&i.easing(r.easing),void 0!==r.interpolation&&i.interpolation(r.interpolation),void 0!==r.repeat&&i.repeat(r.repeat),void 0!==r.repeatDelay&&i.repeatDelay(r.repeatDelay),!0===r.yoyo&&i.yoyo(r.yoyo),void 0!==r.update&&i.onUpdate(e=>{r.update(e)}),void 0!==r.complete&&i.onComplete(e=>{r.complete(e)}),void 0!==r.start?i.start(r.start+(r.delay||0)):void 0!==r.delay&&i.delay(r.delay),i},E.tweenObjects=function(e,t,r){var n=new O.Group,i=r.delay,a=r.delay||0;return e.forEach((e,i)=>{void 0!==r.objectDelay&&(r.delay=a+i*r.objectDelay),n.add(E.tweenObject(e,t[i],r))}),r.delay=i,n},E.GridLOD=function(e){THREE.Object3D.apply(this),this.previousLodResolution=0,this.create(e,!1),this.name="gridLOD",this.frustumCulled=!1},E.GridLOD.prototype=Object.create(THREE.Object3D.prototype),E.GridLOD.prototype.constructor=Object.create(E.GridLOD),E.GridLOD.prototype.controlLODParameters=function(e,t){function r(e,t){return void 0!==e?e:t}void 0===e&&(e={}),(t=r(t,!1))?(this.lodResolution=r(e.resolution,this.lodResolution),this.lodLevels=r(e.levels,this.lodLevels),this.lodScale=r(e.scale,this.lodScale),this.lodMorphingLevels=r(e.morphingLevels,this.lodMorphingLevels),this.lodMaterial=r(e.material,this.lodMaterial)):(this.lodResolution=r(e.resolution,64),this.lodLevels=r(e.levels,8),this.lodScale=r(e.scale,1),this.lodMorphingLevels=r(e.morphingLevels,2),this.lodMaterial=r(e.material,void 0)),this.lodLevels=Math.max(1,Math.round(this.lodLevels)),this.lodScale=Math.max(1,this.lodScale),this.lodResolution=Math.max(1,this.lodResolution),this.lodResolution=Math.pow(2,Math.round(Math.log2(this.lodResolution))),this.lodMorphingLevels=Math.max(0,Math.min(2,Math.round(this.lodMorphingLevels))),this.previousLodResolution=this.lodResolution},E.GridLOD.prototype.createLODMaterial=function(){var e=E.GridLODShader,t=THREE.UniformsUtils.clone(e.uniforms);return t.u_resolution={value:this.lodResolution},t.u_level={value:this.lodLevels},t.u_scale={value:this.lodScale},t.u_morphingLevels={value:this.lodMorphingLevels},t.u_usePlaneParameters={value:0},t.u_planeUp={value:new THREE.Vector3(0,1,0)},t.u_planeAt={value:new THREE.Vector3(0,0,1)},t.u_planePoint={value:new THREE.Vector3(0,0,0)},t.u_planeDistance={value:0},new THREE.ShaderMaterial({uniforms:t,vertexShader:e.buildVertexShader("lod"),fragmentShader:e.fragmentShader,side:THREE.DoubleSide,wireframe:!1})},E.GridLOD.prototype.create=function(e,t){var r=this.previousLodResolution;if(this.controlLODParameters(e,t),!1===t&&(this.lodMaterial=this.createLODMaterial()),r!==this.lodResolution){for(this.gridGeometry=this.createLODGeometry(this.lodResolution),this.gridOutsideGeometry=this.createLODGeometry(this.lodResolution,!0);this.children.length>0;)this.remove(this.children[0]);this.lodMaterial.uniforms.u_resolution.value=this.lodResolution;for(var n=this.lodScale,i=0;i<this.lodLevels;i++){var a=0===i?this.gridGeometry:this.gridOutsideGeometry;this.add(this.createLODMesh(a,this.lodMaterial,n,i)),n*=2}}},E.GridLOD.prototype.createLODMesh=function(e,t,r,n){var i=t.clone();return i.uniforms.u_scale.value=r,i.uniforms.u_level.value=n,new THREE.Mesh(e,i)},E.GridLOD.prototype.createLODGeometry=function(e,t){function r(e,t){return void 0!==e?e:t}e=r(e,64),t=r(t,!1);var n=new THREE.BufferGeometry,i=Math.round(.5*e),a=(e+2)*(e+2)*2,o=new Float32Array(3*((e+3)*(e+3))),s=new(o.length/3>65535?Uint32Array:Uint16Array)(3*a);n.setIndex(new THREE.BufferAttribute(s,1)),n.setAttribute("position",new THREE.BufferAttribute(o,3));for(var l=0,c=-i-1;c<=i+1;c++)for(var u=-i-1;u<=i+1;u++)o[l]=c/e,o[l+1]=0,o[l+2]=u/e,l+=3;l=0;var h=e+3,d=e/4,f=3*d;for(c=0;c<=e+1;c++){var p=c,m=c+1,v=c>d&&c<=f;for(u=0;u<=e+1;u++){var g=u+1;if(!(t&&v&&(u>d&&u<=f))){var y=h*p+g,E=h*m+g,x=h*m+u,T=h*p+u;s[l]=y,s[l+1]=E,s[l+2]=T,s[l+3]=T,s[l+4]=E,s[l+5]=x,l+=6}}}return n},E.GridLOD.prototype.setLODScale=function(e){this.lodScale=e,this.controlLODParameters({},!0);var t=this.lodScale;this.children.forEach(e=>{e.material.uniforms.u_scale.value=t,t*=2})},E.GridLOD.prototype.setMorphingLevels=function(e){this.lodMorphingLevels=e,this.controlLODParameters({},!0),e=this.lodMorphingLevels,this.children.forEach(t=>{t.material.uniforms.u_morphingLevels.value=e})},E.GridLOD.prototype.setMaterialValue=function(e,t){this.lodMaterial[e]=t,this.children.forEach(r=>{r.material[e]=t})},E.GridLOD.prototype.setUniformValue=function(e,t){this.lodMaterial.uniforms[e].value=t,this.children.forEach(r=>{r.material.uniforms[e].value=t})},E.GridLOD.prototype.getUniformValue=function(e){return this.lodMaterial.uniforms[e].value},E.GridLOD.prototype.createParentCamera=function(){return this.parent instanceof THREE.PerspectiveCamera?this.parent:(this.parent=E.camera.clone(),this.parent.add(this),this.parent)},E.GridLOD.prototype.update=function(e,t){!0===this.getUniformValue("u_animate")&&this.setUniformValue("u_time",t)},E.createGridLOD=function(e,t,r,n){return new E.GridLOD({resolution:e,levels:t,scale:r,morphingLevels:n})},E.TerrainLOD=function(e,t,r,n,i){void 0!==arguments[0]&&arguments[0].isObject3D?this.fromObject(arguments[0]):this.create(e,t,r,n,i),this.userData.type="TerrainLOD"},E.TerrainLOD.prototype=Object.create(THREE.Object3D.prototype),E.TerrainLOD.prototype.constructor=E.TerrainLOD,E.TerrainLOD.prototype.create=function(e,t,r,n,i){THREE.Object3D.call(this),this.name="terrainLOD",this.frustumCulled=!1;var a=0,o=1,s=2,l=4,c=8,u=new THREE.TextureLoader;this.diffuse1=u.load("images/terrain/rockyTerrainGrass.jpg"),this.diffuse2=u.load("images/terrain/rockyTerrainDirt.jpg"),this.diffuse1.wrapS=this.diffuse1.wrapT=THREE.RepeatWrapping,this.diffuse2.wrapS=this.diffuse2.wrapT=THREE.RepeatWrapping;var h=this.userData;h.landscape=void 0!==e?e:"GIANT",h.worldWidth=void 0!==t?t:1024,h.levels=void 0!==r?r:4,h.resolution=void 0!==n?n:64,h.maxHeight=void 0!==i?i:.1*E.WORLD_SIZE,h.globalOffset=new THREE.Vector3(0,0,0),this.heightMap=this.getHeightMap(h.worldWidth,h.landscape),this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,h.resolution,h.resolution),this.tileGeometry.translate(.5,.5,0);var d=h.worldWidth/Math.pow(2,h.levels);this.createTile(-d,-d,d,a),this.createTile(-d,0,d,a),this.createTile(0,0,d,a),this.createTile(0,-d,d,a);for(var f=d;f<h.worldWidth;f*=2)this.createTile(-2*f,-2*f,f,l|s),this.createTile(-2*f,-f,f,s),this.createTile(-2*f,0,f,s),this.createTile(-2*f,f,f,o|s),this.createTile(-f,-2*f,f,l),this.createTile(-f,f,f,o),this.createTile(0,-2*f,f,l),this.createTile(0,f,f,o),this.createTile(f,-2*f,f,l|c),this.createTile(f,-f,f,c),this.createTile(f,0,f,c),this.createTile(f,f,f,o|c)},E.TerrainLOD.prototype.createTile=function(e,t,r,n){var i=this.createTileMaterial(new THREE.Vector2(e,t),r,n),a=new THREE.Mesh(this.tileGeometry,i);a.rotation.x=-Math.PI/2,a.frustumCulled=!1,a.castShadow=!1,a.receiveShadow=!0,this.add(a)},E.TerrainLOD.prototype.createTileMaterial=function(e,t,r){var n=this.userData,i=E.TerrainLODShader,a=THREE.UniformsUtils.clone(i.uniforms);a.tDiffuse1.value=this.diffuse1,a.tDiffuse2.value=this.diffuse2,a.worldWidth.value=parseFloat(n.worldWidth),a.tileResolution.value=parseFloat(n.resolution),a.edgeMorph.value=r,a.globalOffset.value=n.globalOffset,a.tileOffset.value=e,a.heightMap.value=this.heightMap,a.tileScale.value=parseFloat(t),a.maxHeight.value=n.maxHeight,a.winterSnow.value=!1,a.summerGreen.value=!1;var o={};E.isWebGL2()&&(o.texture2DLod="textureLod");var s=new THREE.ShaderMaterial({defines:o,uniforms:a,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,lights:!0,fog:void 0!==E.scene.fog});return s.extensions={derivatives:!0,shaderTextureLOD:!0},s},E.TerrainLOD.prototype.getHeightMap=function(e,t){var r,n,i,a,o,s,l=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Matrix3;r.elements=[.8,-.6,0,.6,.8,0,0,0,0];var n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0,s=0;s<5;s++){var l=Math.abs(t(n.x,n.y));i+=a*l/(1+(o+=l)*o*o),a*=.5,n.multiplyScalar(2).applyMatrix3(r)}return Math.pow(i,1)}}(),c=(r=new THREE.SimplexNoise,n=r.noise.bind(r),i=new THREE.Vector3(100,100,0),a=new THREE.Vector3,function(e){a.copy(e);for(var t=0,r=.5,o=0;o<5;o++)t+=r*Math.abs(n(a.x,a.y)),a.multiplyScalar(2).add(i),r*=.5;return Math.pow(.5*t+.5,2)}),u=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Vector3(100,100,0),n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0;o<2;o++)i+=a*Math.abs(t(n.x,n.y)),n.multiplyScalar(2).add(r),a*=.5;return Math.pow(i,1.5)}}(),h=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Vector3(100,100,0),n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0;o<5;o++){var s=1-Math.abs(t(n.x,n.y));i+=a*(s*s),n.multiplyScalar(2).add(r),a*=.5}return Math.pow(i,2)}}(),d=function(){var e=new THREE.Vector3;return function(t){var r=h(e.copy(t).multiplyScalar(9)),n=c(e.copy(t).multiplyScalar(2)),i=u(e.copy(t)),a=(i+=.25*i)/100;return E.mix(n,r,E.smoothstep(.45,.55,a))}}(),f=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Matrix3,n=new THREE.Matrix3;r.elements=[.8,-.6,0,.6,.8,0,0,0,0],n.elements=[1.3623,1.7531,0,-1.7131,1.4623,0,0,0,0];var i=new THREE.Vector3,a=new THREE.Vector3;function o(e){i.copy(e);var n=0;return n+=.5*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.02).applyMatrix3(r),n+=.25*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.03).applyMatrix3(r),n+=.125*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.01).applyMatrix3(r),(n+=.0625*Math.abs(t(i.x,i.y)))/.9375}return function(e){i.copy(e).multiplyScalar(5),a.copy(i).multiplyScalar(.25);var t=.75*o(a)+.25;t*=2*t;for(var r=0,s=0;s<5;s++)r+=t*o(i),t=.5*-t,i.applyMatrix3(n);a.copy(i).multiplyScalar(.002);var l=o(a);return r+=Math.pow(Math.abs(l),10),Math.pow(r,2)}}(),p=function(){function e(e){return Math.abs(function(e){return e-parseInt(e)}(e)-.5)}function t(t){return e(t.x+e(1.5*(t.y-.25)))+e(t.y-e(1.5*(t.x+.5)))}function r(e){return.25+.25*Math.cos(6.2831853*e)}function n(e){return r(e.x+r(1.5*(e.y-.25)))+r(e.y-r(1.5*(e.x+.5)))}var i=new THREE.Vector3,a=new THREE.Vector3;return function(e){i.copy(e).multiplyScalar(2);var r=.66*n(a.copy(i).divideScalar(2))+.34*n(a.copy(i));return.75*(r=.75*function(e){return(e=Math.max((e-.3)/.7,0))*e*(3-2*e)}(r)+.15*t(a.copy(i))+.1*t(a.copy(i).multiplyScalar(4)))}}(),m=(o=E.createFbmNoise({octaves:4,persistence:.5,noiseType:"simplex3d"}),function(e){return Math.abs(o(e.x,e.y,1))}),v=function(){var e=new THREE.ImprovedNoise,t=new THREE.Vector3;return function(r){t.copy(r);for(var n=0,i=.5,a=0;a<4;a++)n+=i*Math.abs(e.noise(t.x,t.y,0))*2.5,t.multiplyScalar(2),i*=.5;return Math.pow(n,2)}}();e=void 0!==e?e:1024;switch(t=void 0!==t?t:"GIANT"){case"BADLAND":s=l;break;case"MOUNTAIN":s=c;break;case"DOME":s=u;break;case"RIDGE":s=h;break;case"DESIGN":s=d;break;case"GIANT":s=f;break;case"TRIANGLE":s=p;break;case"GREAT":s=m;break;case"HUGE":s=v;break;default:s=f}var g=0,y=256,x=new THREE.Vector3,T=new Uint8Array(e*e);"GIANT"===t&&(y=512);for(var b=0;b<e;b++)for(var w=0;w<e;w++)x.x=w/y,x.y=b/y,T[g++]=256*s(x);var _=new THREE.DataTexture(T,e,e,THREE.AlphaFormat);return _.wrapS=THREE.MirroredRepeatWrapping,_.wrapT=THREE.MirroredRepeatWrapping,_.magFilter=THREE.NearestFilter,_.minFilter=THREE.NearestFilter,_.generateMipmaps=!0,_.needsUpdate=!0,_},E.TerrainLOD.prototype.fromObject=function(e){var t=e.userData;this.create(t.landscape,t.worldWidth,t.levels,t.resolution,t.maxHeight)},E.TerrainLOD.prototype.toJSON=function(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)},E.TerrainLOD.prototype.clone=function(){var e=new E.TerrainLOD(this);return E.copyTransform(e,this),e},E.TerrainLOD.prototype.updateVisible=function(e){E.appWorks.setValue(this,"visible",e)},E.TerrainLOD.prototype.updateResolution=function(e){this.userData.resolution=e,this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,e,e);var t=new THREE.Matrix4;t.makeTranslation(.5,.5,0),this.tileGeometry.applyMatrix(t),this.children.forEach(t=>{t.material.uniforms.tileResolution=parseFloat(e)})},E.TerrainLOD.prototype.updateMaxHeight=function(e){this.userData.maxHeight=e,this.children.forEach(t=>{t.material.uniforms.maxHeight=e})},E.createTerrainLOD=function(e,t,r,n,i){return new E.TerrainLOD(e,t,r,n,i)},E.createHeightMapTerrain=function(e,t){var r=void 0!==t.highZoneFile?t.highZoneFile:"images/terrain/rockyTerrainGrass.jpg",n=void 0!==t.lowZoneFile?t.lowZoneFile:"images/terrain/rockyTerrainDirt.jpg",i=void 0!==t.worldWidth?t.worldWidth:1024,a=void 0!==t.resolution?t.resolution:1024,o=void 0!==t.tileOffset?t.tileOffset:new THREE.Vector2(0,0),s=void 0!==t.tileScale?t.tileScale:i,l=void 0!==t.maxHeight?t.maxHeight:.05*E.WORLD_SIZE,c=new THREE.PlaneBufferGeometry(1,1,a,a);c.translate(.5,.5,0);var u=function(t,i,a,o,s){var l=new THREE.TextureLoader,c=l.load(e);c.magFilter=THREE.LinearFilter,c.minFilter=THREE.LinearMipMapLinearFilter,c.generateMipmaps=!0,c.needsUpdate=!0;var u=l.load(r),h=l.load(n),d=E.TerrainLODShader,f=THREE.UniformsUtils.clone(d.uniforms);f.tDiffuse1.value=u,f.tDiffuse2.value=h,f.worldWidth.value=parseFloat(t),f.tileResolution.value=parseFloat(i),f.edgeMorph.value=0,f.globalOffset.value=new THREE.Vector3(0,0,0),f.tileOffset.value=a,f.heightMap.value=c,f.tileScale.value=parseFloat(o),f.maxHeight.value=s,f.winterSnow.value=!1,f.summerGreen.value=!0;var p={};E.isWebGL2()?p.texture2DLodEXT="textureLod":p.texture2DLodEXT="texture2DLod";var m=new THREE.ShaderMaterial({defines:p,uniforms:f,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,lights:!0,fog:void 0!==E.scene.fog});return m.extensions={derivatives:!0,shaderTextureLOD:!0},m}(i,a,o,s,l),h=new THREE.Mesh(c,u);return h.rotation.x=-Math.PI/2,h.position.x-=i/2,h.position.z+=i/2,h.frustumCulled=!1,h.castShadow=!1,h.receiveShadow=!0,h.name="heightMapTerrain",h};var F,D,U,z=r(11),B=r(12),G=r(13);E.DesignWorks=function(e){var t,r=this;e=e||{};if(this.appName=e.appName||"designWorks",this.dom=document.createElement("div"),this.dom.id=this.appName,this.dom.className="appWorks",this.dom.tabIndex=E.tabIndices[this.dom.id],this.dom.style.position="absolute",this.width=e.width||window.innerWidth,this.height=e.height||window.innerHeight,this.widthRatio=this.width/window.innerWidth,this.heightRatio=this.height/window.innerHeight,this.signals=null,!0===e.signals){var n=z.Signal;this.signals={startPlayer:new n,stopPlayer:new n,appWorksCleared:new n,autoSaveStarted:new n,autoSaveFinished:new n,themeChanged:new n,transformModeChanged:new n,snapChanged:new n,spaceChanged:new n,sceneBackgroundChanged:new n,sceneFogChanged:new n,sceneGraphChanged:new n,cameraChanged:new n,geometryChanged:new n,objectSelected:new n,objectFocused:new n,objectsSelected:new n,objectAdded:new n,objectChanged:new n,objectRemoved:new n,helperAdded:new n,helperChanged:new n,helperRemoved:new n,materialChanged:new n,windowResize:new n,axesHelperChanged:new n,gridHelperChanged:new n,initSidebar:new n,historyChanged:new n},(t=r.signals).startPlayer.add(function(){r.history.historyDisabled=!0}),t.stopPlayer.add(function(){r.history.historyDisabled=!1}),t.themeChanged.add(function(){}),t.sceneBackgroundChanged.add(function(e){r.config.setSettings("background",e)}),t.sceneFogChanged.add(function(e){r.createSceneFog(e),b()}),t.gridHelperChanged.add(function(e,t,n){E.dispose(r.gridHelper),r.gridHelper=x(e,t,n),r.sceneHelpers.add(r.gridHelper),b()}),t.geometryChanged.add(function(e){b()}),t.materialChanged.add(function(e){b()}),t.objectAdded.add(function(e){var t=r.selectables;e.traverse(function(e){t.push(e)})}),t.objectRemoved.add(function(e){r.transformControls&&r.transformControls.object===e&&r.transformControls.detach();var t=r.selectables;e.traverse(function(e){t.splice(t.indexOf(e),1)})}),t.objectChanged.add(function(e){e instanceof THREE.PerspectiveCamera&&e.updateProjectionMatrix(),!e.helper||e.helper instanceof THREE.SkeletonHelper||(e.helper.update(),t.helperChanged.dispatch(e.helper)),b()}),t.objectsSelected.add(function(e){if(Array.isArray(e)){if(1===e.length){var t=e[0];if(null===t.parent)return;var n=r.transformControls.enabled;r.transformControls.detach(),r.transformControls.attach(t),r.transformControls.visible=n,r.transformControls.enabled=n}if(r.outlinePass.enabled){var i=r.outlinePass;i.selectedObjects=[],e.forEach(function(e){e.traverse(function(e){0===e.children.length&&i.selectedObjects.push(e)})})}}}),t.objectFocused.add(function(e){var t=new THREE.Vector3;e&&t.copy(e.position),r.controls instanceof THREE.OrbitControls||r.controls instanceof THREE.TrackballControls?(r.controls.target.copy(t),r.controls.update()):r.controls instanceof THREE.FirstPersonControls&&(r.controls.lookAt(t),r.controls.update(E.getDeltaTime()))}),t.helperAdded.add(function(e){var t=e.getObjectByName("picker");r.selectables.push(t)}),t.helperChanged.add(function(e){var t=e.light;t&&(e.visible=t.visible)}),t.helperRemoved.add(function(e){var t=r.selectables,n=e.getObjectByName("picker");t.splice(t.indexOf(n),1)}),t.cameraChanged.add(function(e){e&&(r.config.setSettings("cameraFov",e.fov),r.config.setSettings("cameraNear",e.near),r.config.setSettings("cameraFar",e.far)),b()}),t.historyChanged.add(function(){var e=r.history;e.undos.length,e.redos.length}),t.appWorksCleared.add(function(){r.select(null),r.focus(),b()}),t.autoSaveStarted.add(function(){}),t.autoSaveFinished.add(function(){}),t.transformModeChanged.add(function(e){r.transformControls.setMode(e)}),t.snapChanged.add(function(e){r.transformControls.setTranslationSnap(e)}),t.spaceChanged.add(function(e){r.transformControls.setSpace(e)}),t.windowResize.add(function(){w(),b()})}if(this.config=null,!0===e.config&&(this.config=new E.Config(this.appName),this.config.initDatabase(function(){var e;function t(){!1!==r.config.getSettings("autosave")&&(clearTimeout(e),e=setTimeout(function(){r.signals.autoSaveStarted.dispatch(),e=setTimeout(function(){r.config.setDatabase(r.toJSON()),r.signals.autoSaveFinished.dispatch()},100)},1e3))}r.config.getDatabase(function(e){void 0!==e&&r.fromJSON(e)});var n=r.signals;n.geometryChanged.add(t),n.materialChanged.add(t),n.objectAdded.add(t),n.objectChanged.add(t),n.objectRemoved.add(t),n.sceneBackgroundChanged.add(t),n.sceneFogChanged.add(t),n.sceneGraphChanged.add(t),n.historyChanged.add(t)})),this.history=null,!0===e.history&&(this.history=new E.History(this)),2===e.glVersion&&E.isWebGL2Available()){var i=document.createElement("canvas"),a=i.getContext("webgl2");this.renderer=new THREE.WebGLRenderer({canvas:i,context:a,alpha:!0,powerPreference:"high-performance"})}else this.renderer=new THREE.WebGLRenderer({alpha:!0,powerPreference:"high-performance"});this.renderer.autoClear=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.outputEncoding=THREE.sRGBEncoding,this.renderer.gammaFactor=2.2,this.renderer.toneMapping=THREE.LinearToneMapping,this.renderer.toneMappingExposure=1,this.dom.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.scene.name="scene",this.scene.appName=this.appName,this.createSceneFog=function(e){this.scene.fog=E.createFog(e)},this.createSceneFog(e.fog),this.createSceneBackground=function(e){e=void 0!==e?e:this.config?this.config.getSettings("background"):null;this.scene.background&&this.scene.background.dispose&&this.scene.background.dispose(),this.scene.background=E.createBackground(e)},this.createSceneBackground(e.background);var o,s,l,c,u,h,d,f,p,m=e.cameraFov||this.config?this.config.getSettings("cameraFov"):50,v=e.cameraNear||this.config?this.config.getSettings("cameraNear"):.01,g=e.cameraFar||this.config?this.config.getSettings("cameraFar"):1e4,y=e.cameraPosition||this.config?this.config.getSettings("cameraPosition"):[0,0,50];function x(e,t,n){e=e||r.config?r.config.getSettings("gridHelperSize"):500,t=t||r.config?r.config.getSettings("gridHelperSpacing"):5,n=n||r.config?r.config.getSettings("gridHelperColor"):4210752;e=~~(e/t),e*=t;var i=new THREE.GridHelper(e,e/t,16729156,n);i.position.y=0,i.name="gridHelper";for(var a=.05*t,o=e/2,s=[],l=-o;l<=o;l+=t)s.push(l.toFixed(2));return s.forEach(function(e){var t=E.createTextSprite(e,{textHeight:a,fontWeight:"bold"}),r=t.clone();t.position.set(parseFloat(e),a/2,0),r.position.set(0,a/2,parseFloat(e)),i.add(t),i.add(r)}),i}function T(){requestAnimationFrame(T),function(){var e=E.getDeltaTime(),t=E.getCurrentTime();r.stats&&r.stats.update();r.animation.update(e),r.scene.traverse(function(r){r.update&&r.update(e,t)}),r.sceneHUD&&r.sceneHUD.traverse(function(r){r.update&&r.update(e,t)});var n=r.controls;n.enabled&&(n instanceof THREE.OrbitControls?!0!==n.autoRotate&&!0!==n.enableDamping||n.update():n instanceof THREE.TrackballControls?n.update():n instanceof THREE.FirstPersonControls?n.update(e):!0===n.isTPSCameraControl&&n.update(e))}(),b()}function b(){r.effect?(r.renderer.setRenderTarget(null),r.effect.render(r.scene,r.camera)):r.composer?r.composer.render():"medicalWorks"===!r.appName&&r.renderer.render(r.scene,r.camera)}function w(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);r.width=r.widthRatio*e,r.height=r.heightRatio*t,r.camera.aspect=r.width/r.height,r.camera.updateProjectionMatrix(),function(){if(!r.sceneHUD||!r.cameraHUD)return;var e=r.cameraHUD,t=e.right,n=e.top,i=r.width/2,a=r.height/2;e.left=-i,e.right=i,e.top=a,e.bottom=-a,e.updateProjectionMatrix(),r.sceneHUD.children.forEach(e=>{var r=e.position;r.x*=1+(i-t)/Math.abs(r.x),r.y*=1+(a-n)/Math.abs(r.y)})}(),r.FXAAShader.enabled&&r.FXAAShader.uniforms.resolution.value.set(1/r.width,1/r.height),r.renderer.setSize(r.width,r.height),r.composer&&r.composer.setSize(r.width,r.height),r.effect&&r.effect.setSize(r.width,r.height),r.controls.enabled&&(r.controls instanceof THREE.OrbitControls||r.controls.handleResize()),r.scene.getObjectsByType("FireParticles").forEach(function(e){e.setNearPlaneHeight()})}function _(e){var t=r.dom.getBoundingClientRect(),n=E.getMouseScreenCoords(e);return n.x=(n.x-t.left)/t.width*2-1,n.y=-(n.y-t.top)/t.height*2+1,n}function R(e,t){return r.raycaster.setFromCamera(e,r.camera),r.raycaster.intersectObjects(t,!0)}function M(){var e=r.getIntersectObject(r.xinfo);e&&("picker"===e.name?r.select(e.userData.object):event.ctrlKey?r.select(e,"multiple"):event.altKey?r.select(e,"ancestor"):r.select(e),b())}function S(e){r.mouseUpPosition.copy(_(e)),M(),document.removeEventListener("mouseup",S,!1)}function A(e){e.preventDefault(),f&&(clearTimeout(f),p=!1),r.mouseUpPosition.copy(_(e)),M(),document.removeEventListener("touchend",A,!1)}function L(e){r.mouseUpPosition.copy(r.mouseDownPosition),P(e)}function P(e){r.guiContextMenu&&(r.getIntersectObject()&&r.guiContextMenu.toggle(e))}function C(e){switch(r.appName){case"viewWorks":!function(e){switch(e.stopPropagation(),e.keyCode){case 8:e.preventDefault();case 27:r.controls.enabled=!0;break;case 49:E.nextShowroom(r.showroom,"background");break;case 50:E.nextShowroom(r.showroom,"floor");break;case 79:if(r.animation&&r.selectObject){var t=r.selectObject.activeAction;t.paused=!t.paused}break;case 80:r.animation&&r.selectObject&&r.playNextAction(r.selectObject)}}(e);break;case"gameWorks":!function(e){switch(e.keyCode){case 66:E.demoApplication();break;case 191:E.gamePlay()}}(e);break;case"natureWorks":!function(e){122!==e.keyCode&&e.preventDefault();e.stopPropagation();var t=E.isCtrlKeyDown(e);if(t&&90===e.keyCode)return void r.undo();if(t&&89===e.keyCode)return void r.redo();switch(e.keyCode){case 8:e.preventDefault();case 46:var n=r.selectObject;n&&n.parent&&r.remove(n);break;case 18:break;case 27:r.controls.enabled=!0;break;case 49:E.filmGrainBackground();break;case 50:break;case 66:E.demoApplication();break;case 67:r.controls instanceof THREE.OrbitControls?r.controls=E.createCameraControls("FirstPersonControls"):r.controls instanceof THREE.FirstPersonControls&&(r.controls=E.createCameraControls("OrbitControls"));break;case 70:E.demoLoadFiles();break;case 72:E.add(E.createHemisphereLight());break;case 73:var i=E.cameraAutoView({isWorking:!0});i?E.cameraAutoView({viewMode:"stop"}):E.cameraAutoView({viewMode:"circle"});break;case 76:E.toggleLightHelpers();break;case 77:void 0!==r.sound&&(r.sound.playing()?r.sound.pause():r.sound.play());break;case 78:E.add(E.createSky()),E.add(E.createSunLight());break;case 79:if(r.animation&&r.selectObject){var a=r.selectObject.activeAction;a.paused=!a.paused}break;case 80:r.animation&&r.selectObject&&r.playNextAction(r.selectObject);break;case 86:E.demoRaymarchToPoints();break;case 112:r.appGUI&&r.appGUI.toggle(r.guiSceneGraph.dom);break;case 113:r.appGUI&&r.appGUI.toggle();break;case 114:r.dragControls.enabled=!r.dragControls.enabled;break;case 115:r.transformControls.visible=!r.transformControls.visible,r.transformControls.enabled=!r.transformControls.enabled;break;case 116:r.guiSidebar&&r.guiSidebar.select(r.guiStrings.getKey("menubar/edit/scene"),"inclusive");break;case 117:E.screenCapture();break;case 118:break;case 119:r.selectObject&&r.focus(r.selectObject);break;case 120:r.config.clearSettings(),console.log('>> clear the "window.localStorage"...');break;case 121:r.config.clearDatabase(),console.log('>> clear the "window.indexedDB"...');break;case 191:E.gamePlay();break;case 81:r.transformControls.setSpace("local"===r.transformControls.space?"world":"local");break;case 17:r.transformControls.setTranslationSnap(r.config.getSettings("translationSnap")),r.transformControls.setRotationSnap(THREE.Math.degToRad(r.config.getSettings("rotationSnap")));break;case 87:r.transformControls.setMode("translate");break;case 69:r.transformControls.setMode("rotate");break;case 82:r.transformControls.setMode("scale");break;case 187:case 107:r.transformControls.setSize(r.transformControls.size+.1);break;case 189:case 109:r.transformControls.setSize(Math.max(r.transformControls.size-.1,.1));break;case 88:r.transformControls.showX=!r.transformControls.showX;break;case 89:r.transformControls.showY=!r.transformControls.showY;break;case 90:r.transformControls.showZ=!r.transformControls.showZ;break;case 32:r.transformControls.visible=!r.transformControls.visible,r.transformControls.enabled=!r.transformControls.enabled}}(e);break;case"medicalWorks":E.MedicalKeyboard(e)}}this.defaultCamera=new THREE.PerspectiveCamera(m,this.width/this.height,v,g),this.defaultCamera.position.set(y[0],y[1],y[2]),this.defaultCamera.lookAt(this.scene.position),this.defaultCamera.name="camera",this.camera=this.defaultCamera.clone(),this.controls=E.createCameraControls(e.controlsType,this.camera,this.renderer.domElement),this.animation=new E.Animation(this.scene),this.playAction=function(e,t,r){this.animation.playAction(e,t,r)},this.playNextAction=function(e){this.animation.playNextAction(e)},this.stopAction=function(e,t){this.animation.stopAction(e,t)},this.stats=null,!0!==e.stats||E.isDeviceMobile()||(this.stats=new B,this.stats.dom.style.cssText="position:absolute; bottom:0px; right:0px",this.dom.appendChild(this.stats.dom)),this.raycaster=new THREE.Raycaster,this.selectObject=null,this.selectObjects=[],this.selectables=[],this.mouseMovePosition=new THREE.Vector2,this.mouseDownPosition=new THREE.Vector2,this.mouseUpPosition=new THREE.Vector2,this.mouseDoubleClickPosition=new THREE.Vector2,this.playAudio=function(e){this.sound&&this.sound.unload(),this.sound=E.playAudio(e)},this.playAudio(e.audioFiles),this.sceneHelpers=new THREE.Scene,this.gridHelper=x(),this.gridHelper.visible=e.gridVisible||!1,this.sceneHelpers.add(this.gridHelper),this.sceneHUD=null,this.cameraHUD=null,!0===e.hud&&(this.sceneHUD=new THREE.Scene,this.cameraHUD=new THREE.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,100.1),this.cameraHUD.position.z=50.1),function(e){var e=e||{};r.composer=new THREE.EffectComposer(r.renderer),r.composer.setSize(r.width,r.height),r.renderPass=new THREE.RenderPass(r.scene,r.camera),r.renderPass.clear=!0,r.renderPass.clearDepth=!1,r.composer.addPass(r.renderPass),r.sceneHelpers&&(r.renderPass2=new THREE.RenderPass(r.sceneHelpers,r.camera),r.renderPass2.clear=!1,r.renderPass2.clearDepth=!1,r.composer.addPass(r.renderPass2));r.sceneHUD&&(r.renderPass3=new THREE.RenderPass(r.sceneHUD,r.cameraHUD),r.renderPass3.clear=!1,r.renderPass3.clearDepth=!1,r.composer.addPass(r.renderPass3));void 0!==e.bleachEnabled&&(r.bleachShader=new THREE.ShaderPass(THREE.BleachBypassShader),r.bleachShader.enabled=e.bleachEnabled,r.composer.addPass(r.bleachShader));void 0!==e.bloomEnabled&&(r.bloomPass=new THREE.UnrealBloomPass(new THREE.Vector2(r.width,r.height),2.5,.45,.88),r.bloomPass.enabled=e.bloomEnabled,r.composer.addPass(r.bloomPass));void 0!==e.dotScreenEnabled&&(r.dotScreenShader=new THREE.ShaderPass(THREE.DotScreenShader),r.dotScreenShader.uniforms.scale.value=4,r.dotScreenShader.enabled=e.dotScreenEnabled,r.composer.addPass(r.dotScreenShader));void 0!==e.glitchEnabled&&(r.glitchPass=new THREE.GlitchPass(0),r.glitchPass.enabled=e.glitchEnabled,r.composer.addPass(r.glitchPass));void 0!==e.sepiaEnabled&&(r.sepiaShader=new THREE.ShaderPass(THREE.SepiaShader),r.sepiaShader.enabled=e.sepiaEnabled,r.composer.addPass(r.sepiaShader));if(void 0!==e.outlineEnabled){r.outlinePass=new THREE.OutlinePass(new THREE.Vector2(r.width,r.height),r.scene,r.camera),r.outlinePass.enabled=e.outlineEnabled,r.composer.addPass(r.outlinePass);var t=new THREE.TextureLoader;t.load("images/tri_pattern.jpg",function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,r.outlinePass.patternTexture=e})}e.FXAAEnabled=!0,void 0!==e.FXAAEnabled&&(r.FXAAShader=new THREE.ShaderPass(THREE.FXAAShader),r.FXAAShader.uniforms.resolution.value.set(1/r.width,1/r.height),r.FXAAShader.enabled=e.FXAAEnabled,r.composer.addPass(r.FXAAShader));void 0!==e.ssaoEnabled&&(r.ssaoPass=new THREE.SSAOPass(r.scene,r.camera,r.width,r.height),r.ssaoPass.enabled=e.ssaoEnabled,r.composer.addPass(r.ssaoPass));void 0!==e.godRaysEnabled&&(r.godRaysPass=new E.GodRaysPass(r.scene,r.camera,r.width,r.height),r.godRaysPass.enabled=e.godRaysEnabled,r.composer.addPass(r.godRaysPass));void 0!==e.bokehEnabled&&(r.bokehPass=new THREE.BokehPass(r.scene,r.camera,{width:r.width,height:r.height,vignetting:1}),r.bokehPass.enabled=e.bokehEnabled,r.composer.addPass(r.bokehPass));void 0!==e.vignetteEnabled&&(r.vignetteShader=new THREE.ShaderPass(THREE.VignetteShader),r.vignetteShader.enabled=e.vignetteEnabled,r.composer.addPass(r.vignetteShader));r.gammaCorrection=new THREE.ShaderPass(THREE.GammaCorrectionShader),r.composer.addPass(r.gammaCorrection)}(e),this.cameraEffect=function(e){this.effect=E.createCameraEffect(e,this.renderer),this.effect?this.effect.setSize(this.width,this.height):this.renderer.setSize(this.width,this.height)},this.cameraEffect(e.effectType),this.fileExplorer=null,!0===e.fileExplorer&&(this.fileExplorer=new E.FileExplorer(this)),this.dragControls=null,!0===e.dragControls&&(this.dragControls=(o=this.scene.children,s=this.camera,l=this.renderer,c=null,(u=new THREE.DragControls(o,s,l.domElement)).enabled=!1,u.addEventListener("dragstart",function(e){if(this.enabled){var t=e.object;c=t.position.clone(),r.controls.enabled=!1,r.select(t)}}),u.addEventListener("dragend",function(e){if(this.enabled){var t=e.object;void 0!==t&&(c.equals(t.position)||r.setPosition(t,t.position,c)),r.controls.enabled=!0}}),u)),this.transformControls=null,!0===e.transformControls&&(this.transformControls=function(e,t){var n=null,i=null,a=null,o=new THREE.TransformControls(e,t.domElement);return o.visible=!0,o.enabled=!0,o.addEventListener("change",function(){var e=o.object;e&&e.helper&&!e.helper instanceof THREE.SkeletonHelper&&e.helper.update()}),o.addEventListener("mouseDown",function(){var e=o.object;n=e.position.clone(),i=e.rotation.clone(),a=e.scale.clone(),r.controls.enabled=!1}),o.addEventListener("mouseUp",function(){var e=o.object;if(void 0!==e)switch(o.getMode()){case"translate":n.equals(e.position)||r.setPosition(e,e.position,n);break;case"rotate":i.equals(e.rotation)||r.setRotation(e,e.rotation,i);break;case"scale":a.equals(e.scale)||r.setScale(e,e.scale,a)}r.controls.enabled=!0}),o}(this.camera,this.renderer),this.transformControls.setSize(.5),this.sceneHelpers.add(this.transformControls)),window.addEventListener("orientationchange",function(){[r.widthRatio,r.heightRatio]=[r.heightRatio,r.widthRatio]},!1),window.addEventListener("resize",w,!1),this.dom.addEventListener("click",function(e){r.dom.focus()},!1),this.dom.addEventListener("dblclick",function(e){r.mouseDoubleClickPosition.copy(_(e));var t=r.getIntersectObject("mouseDoubleClick");t&&r.focus(t)},!1),this.dom.addEventListener("mousemove",function(e){r.mouseMovePosition.copy(_(e)),r.bokehPass&&r.bokehPass.enabled&&r.bokehPass.mouse.copy(r.mouseMovePosition)},!1),this.dom.addEventListener("mousedown",function(e){r.mouseDownPosition.copy(_(e)),document.addEventListener("mouseup",S,!1)},!1),this.dom.addEventListener("touchmove",function(e){e.preventDefault(),f&&clearTimeout(f);r.mouseMovePosition.copy(_(e)),r.bokehPass&&r.bokehPass.enabled&&r.bokehPass.mouse.copy(r.mouseMovePosition)},!0),this.dom.addEventListener("touchstart",function(e){r.guiContextMenu&&r.guiContextMenu.setDisplay("none");if(e.preventDefault(),p)return;f=setTimeout(L,500,e),p=!0,r.mouseDownPosition.copy(_(e)),document.addEventListener("touchend",A,!1)},!1),this.dom.addEventListener("keydown",C,!1),this.dom.addEventListener("keyup",function(e){switch(r.appName){case"natureWorks":!function(e){switch(e.preventDefault(),e.stopPropagation(),e.keyCode){case 17:r.transformControls.setTranslationSnap(null),r.transformControls.setRotationSnap(null),r.controls.enabled=!0}}(e)}},!1),this.dom.addEventListener("contextmenu",P,!1),this.renderScene=function(){T()},this.onKeyDown=function(e){C(e)},this.getBoundingBox=function(){return E.computeBoundingBox(this.scene)},this.getMousePosition=function(e){return _(e)},this.getIntersectObject=function(e){if("string"==typeof e){var t;if("mouseDown"===e)t=this.mouseDownPosition;else if("mouseUp"===e)t=this.mouseUpPosition;else{if("mouseDoubleClick"!==e)return null;t=this.mouseDoubleClickPosition}return(r=R(t,this.selectables)).length>0?r[0].object:null}var r;return this.mouseDownPosition.equals(this.mouseUpPosition)&&(r=R(this.mouseUpPosition,this.selectables)).length>0?(void 0!==e&&(e.object=r[0].object,e.distance=r[0].distance,e.point=r[0].point,e.uv=r[0].uv),r[0].object):null},this.select=function(e,t){if(e){var n=e;if("ancestor"===t)e.traverseAncestors(function(e){e.parent===r.scene&&(n=e)}),this.selectObjects=[n];else if("multiple"===t){var i=this.selectObjects.indexOf(n);-1===i?this.selectObjects.push(n):this.selectObjects.splice(i,1)}else this.selectObjects=[n];this.selectObject=n,this.signals.objectSelected.dispatch(n),this.signals.objectsSelected.dispatch(this.selectObjects)}else this.selectObject=null,this.selectObjects=[],this.signals.objectSelected.dispatch(null),this.signals.objectsSelected.dispatch(this.selectObjects)},this.selectById=function(e,t){e!==this.camera.id?this.select(this.scene.getObjectById(e,!0),t):this.select(this.camera,t)},this.selectByUuid=function(e,t){this.scene.traverse(function(r){r.uuid===e&&this.select(r,t)})},this.deselect=function(){this.selectObject=null},this.focus=function(e){this.signals.objectFocused.dispatch(e)},this.focusById=function(e){this.focus(this.scene.getObjectById(e,!0))},this.objectByUuid=function(e){return this.scene.getObjectByProperty("uuid",e)},this.addObject=function(e){e.traverse(function(e){r.addHelper(e)}),this.scene.add(e),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch()},this.removeObject=function(e){null!==e.parent&&(e.traverse(function(e){r.removeHelper(e)}),e.parent.remove(e),this.signals.objectRemoved.dispatch(e),this.signals.sceneGraphChanged.dispatch())},this.addHelper=(h=new THREE.SphereBufferGeometry(2,4,2),d=new THREE.MeshBasicMaterial({color:16711680,visible:!1}),function(e){if(!E.isDeviceMobile()){var t;if(e instanceof THREE.Camera)(t=new THREE.CameraHelper(e)).name="cameraHelper";else if(e instanceof THREE.PointLight)(t=new THREE.PointLightHelper(e,1)).name="pointLightHelper";else if(e instanceof THREE.DirectionalLight)(t=new THREE.DirectionalLightHelper(e,1)).name="directionalLightHelper","SunLight"===e.userData.type&&(t.visible=!1);else if(e instanceof THREE.SpotLight)(t=new THREE.SpotLightHelper(e)).name="spotLightHelper";else if(e instanceof THREE.HemisphereLight)(t=new THREE.HemisphereLightHelper(e,1)).name="hemisphereLightHelper";else{if(!(e instanceof THREE.SkinnedMesh))return;(t=new THREE.SkeletonHelper(e)).name="skeletonHelper"}var r=new THREE.Mesh(h,d);r.name="picker",r.userData.object=e,t.add(r),e.helper=t,this.sceneHelpers.add(t),this.signals.helperAdded.dispatch(t)}}),this.removeHelper=function(e){var t=e.helper;void 0!==t&&(t.parent.remove(t),this.signals.helperRemoved.dispatch(t))},this.getObjectMaterial=function(e,t){var r=void 0;return e&&(r=e.material,Array.isArray(r)&&(r=r[t])),r},this.setObjectMaterial=function(e,t,r){Array.isArray(e.material)?e.material[t]=r:e.material=r},this.clear=function(){this.history&&this.history.clear(),this.config&&this.config.clearDatabase(),this.camera.copy(this.defaultCamera);for(var e=this.scene.children;e.length>0;)this.removeObject(e[0]);this.deselect(),this.signals.appWorksCleared.dispatch(),this.signals.windowResize.dispatch()},this.fromJSON=function(e){var t=new THREE.ObjectLoader;if(void 0!==e.scene){var r=t.parse(e.camera);this.camera.copy(r),this.camera.aspect=this.defaultCamera.aspect,this.camera.updateProjectionMatrix(),this.history.fromJSON(e.history),this.setScene(t.parse(e.scene))}else this.setScene(t.parse(e))},this.toJSON=function(){return{metadata:{},camera:this.camera.toJSON(),scene:this.scene.toJSON(),history:this.history.toJSON()}},this.execute=function(e,t){this.history.execute(e,t)},this.undo=function(){this.history.undo()},this.redo=function(){this.history.redo()},this.add=function(e){this.execute(new E.AddObjectCommand(e))},this.remove=function(e){this.execute(new E.RemoveObjectCommand(e))},this.replace=function(e,t){var r=[];r.push(new E.RemoveObjectCommand(e)),r.push(new E.AddObjectCommand(t)),this.multiCmds(r)},this.move=function(e,t,r){e.parent?this.execute(new E.MoveObjectCommand(e,t,r)):Alert("The object cannot be moved to the new parent")},this.moveTo=function(e,t,r){this.add(e),this.move(e,t,r)},this.setPosition=function(e,t,r){this.execute(new E.SetPositionCommand(e,t,r))},this.setRotation=function(e,t,r){this.execute(new E.SetRotationCommand(e,t,r))},this.setScale=function(e,t,r){this.execute(new E.SetScaleCommand(e,t,r))},this.setGeometry=function(e,t){this.execute(new E.SetGeometryCommand(e,t))},this.setGeometryValue=function(e,t,r){this.execute(new E.SetGeometryValueCommand(e,t,r))},this.setMaterial=function(e,t,r){this.execute(new E.SetMaterialCommand(e,t,r))},this.setMaterialValue=function(e,t,r,n){this.execute(new E.SetMaterialValueCommand(e,t,r,n))},this.setMaterialColor=function(e,t,r,n){this.execute(new E.SetMaterialColorCommand(e,t,r,n))},this.setMaterialMap=function(e,t,r,n){this.execute(new E.SetMaterialMapCommand(e,t,r,n))},this.setUuid=function(e,t){this.execute(new E.SetUuidCommand(e,t))},this.setValue=function(e,t,r){this.execute(new E.SetValueCommand(e,t,r))},this.setColor=function(e,t,r){this.execute(new E.SetColorCommand(e,t,r))},this.setScene=function(e){this.execute(new E.SetSceneCommand(e))},this.multiCmds=function(e){this.execute(new E.MultiCmdsCommand(e))},E.renderer=this.renderer,E.scene=this.scene,E.camera=this.camera,E.appWorks=this,"viewWorks"===this.appName?E.viewWorksInfo():"medicalWorks"===this.appName&&E.demoMedicalWorkSpace()},E.viewWorksInfo=function(){var e=document.createElement("div");e.id="infoButton",e.innerHTML='        <img src="images/info.png" border="0" />\n    ',e.style.cssText="        text-align: left;\n        margin: 0 0 0 0;\n        z-index: 13;\n        position: absolute;\n        display: block;\n        padding: 8px;\n    ",e.addEventListener("click",function(e){var t=document.getElementById("infoPanel").style;t.display="block"==t.display?"none":"block"}),document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.createElement("div");t.id="infoPanel",t.innerHTML='        <b>ViewWorks - 3D model viewer</b>\n        <p>\n        To view your 3D models,<br>\n        <b>drag & drop the model file(s) onto the browser.</b><br><br>\n        Supported file formats<br>\n        JSON, OBJ(+MTL), STL, PLY, DAE(COLLADA),<br>\n        GLTF, GLB, AMF, 3MF, WRL(VRML), FBX,<br>\n        3DS, DRC, KMZ, MD2, SVG, VTK<br>\n        </p>\n        (C) <a href="https://www.nova-graphix.com/" target="_blank" style="color: #ffa500; text-decoration: none;">NovaGraphix, Co.</a>, 2018.\n    ',t.style.cssText="        text-align: left;\n        font-family: 'Karla', sans-serif;\n        font-size: 80%;\n        margin: 0.5em 0em 0em 0.4em;\n        z-index: 12;\n        position: absolute;\n        display: none;\n        color: #fff;\n        background: #121212;\n        opacity: 0.8;\n        border-radius: 20px;\n        padding: 32px;\n    ",document.getElementById("novaGraphix").parentNode.appendChild(t)},E.createBackground=function(e){if(!e)return null;if(e.isTexture)return e.encoding=THREE.sRGBEncoding,e;if("number"==typeof e)return new THREE.Color(e);if("string"==typeof e)return"FS"===e.substr(-2,2)?function(e){var t=new THREE.Vector2;E.renderer.getSize(t);var r=E.BackgroundShader;(s=THREE.UniformsUtils.clone(r.uniforms)).resolution.value=t;var n=r.vertexShader,i=r[e],a=E.isWebGL1()?{gl_FragDepth:"gl_FragDepthEXT"}:{},o=new THREE.ShaderMaterial({defines:a,uniforms:s,vertexShader:n,fragmentShader:i});if("cloudsFS"===e){var s=o.uniforms,l=new THREE.TextureLoader,c=l.load("images/raymarch/rgbaNoise256.png",function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping});s.textureMaps.value.push(c)}o.extensions={derivatives:!0,fragDepth:!0,drawBuffers:!0,shaderTextureLOD:!0};var u=new THREE.PlaneBufferGeometry(2,2);return(e=new THREE.Mesh(u,o)).name="backgroundMesh",e.frustumCulled=!1,e.update=function(e,r){E.renderer.getSize(t);var n=this.material.uniforms;n.time.value=r,n.resolution.value=t},e}(e):function(e){var t=".jpg",r="images/background/"+e+"/";switch(e){case"cloud":case"galaxy":case"redSky":case"smallLake":t=".png";break;default:t=".jpg"}var n=["posx"+t,"negx"+t,"posy"+t,"negy"+t,"posz"+t,"negz"+t],i=(new THREE.CubeTextureLoader).setPath(r).load(n);return i.format=THREE.RGBFormat,i.encoding=THREE.sRGBEncoding,i}(e)},E.createBackgroundPMREM=function(e,t){t=void 0!==t?t:E.appWorks.renderer;return new THREE.PMREMGenerator(t).fromCubemap(e).texture},E.createFog=function(e){var t=void 0!==(e=e||{}).color?e.color:E.FOG_COLOR;if("linear"===e.type){var r=void 0!==e.near?e.near:this.camera.near,n=void 0!==e.far?e.far:this.camera.far;return new THREE.Fog(t,r,n)}if("exp2"===e.type){var i=void 0!==e.density?e.density:.001;return new THREE.FogExp2(t,i)}return null},E.createCameraControls=function(e,t,r){var n;e=void 0!==e?e:"OrbitControls",t=void 0!==t?t:E.appWorks.camera,r=void 0!==r?r:E.appWorks.renderer.domElement;return E.appWorks&&E.appWorks.controls&&E.appWorks.controls.dispose(),"TrackballControls"===e?((n=new THREE.TrackballControls(t,r)).rotateSpeed=5,n.zoomSpeed=5,n.panSpeed=2,n.staticMoving=!1,n.dynamicDampingFactor=.2,n.enabled=!0):"FirstPersonControls"===e?((n=new THREE.FirstPersonControls(t,r)).movementSpeed=100,n.lookSpeed=.05,n.lookVertical=!0,n.activeLook=!0,n.constrainVertical=!0,n.verticalMin=1.1,n.verticalMax=2.2,n.enabled=!0):((n=new THREE.OrbitControls(t,r)).enablePan=!0,n.enableZoom=!0,n.enableDamping=!0,n.screenSpacePanning=!0,n.dampingFactor=.5,n.panSpeed=1,n.rotateSpeed=1,n.enabled=!0),n},E.playAudio=function(e,t){if(!(Array.isArray(e)&&e.length>0))return null;var r=new G.Howl({src:[e[0]],autoplay:!0,loop:!0,volume:.5,onend:function(){e.shift(),e.length>0&&E.playAudio(e)}});return r.play(),r},E.createCameraEffect=function(e,t){e=void 0!==e?e:"NoEffect",t=void 0!==t?t:E.appWorks.renderer;return"AnaglyphEffect"===e?new THREE.AnaglyphEffect(t):"StereoEffect"===e?new THREE.StereoEffect(t):"ParallaxBarrierEffect"===e?new THREE.ParallaxBarrierEffect(t):null},E.Animation=function(e){e=void 0!==e?e:E.scene;this.mixer=new THREE.AnimationMixer(e),this.update=function(e){this.mixer.update(e)},this.addAnimation=function(e,t){t.length>0&&(e.animations=t)},this.createActions=function(e){var t={},r=e.animations;if(void 0!==r){for(var n of r)t[n.name]=this.mixer.clipAction(n,e),e.activeAction||(e.activeAction=t[n.name]);return t}},this.playAction=function(e,t,r){if(e.animations&&0!==e.animations.length){var n=(r=r||{}).duration||1,i=r.loopMode||THREE.LoopRepeat,a=r.repetitions||1/0,o=r.combine||"crossFade";e=void 0!==e?e:E.appWorks.selectObject,t=void 0!==t?t:e.animations[0];if("crossFade"==o){var s=e.activeAction,l=this.mixer.clipAction(t,e);return l?(l.enabled=!0,l.setLoop(i,a),s?(s.enabled=!0,s.crossFadeTo(l,n).play()):l.play(),e.activeAction=l,l):void 0}if("overlap"===o){var c=this.mixer.clipAction(t,e);return c.play(),e.activeAction=c,c}}},this.playNextAction=function(e){var t=(e=void 0!==e?e:E.appWorks.selectObject).animations;if(void 0!==t){var r=-1;if(e.activeAction){var n=e.activeAction.getClip();r=t.indexOf(n)}var i=t[r=~~((r+1)%t.length)];e.activeAction=this.playAction(e,i),console.log('>> playAction: "'+i.name+'"')}},this.stopAction=function(e,t){if(e&&t)(r=this.mixer.clipAction(t,e)).enabled=!0,r.stop();else if(e&&!t){var r;(r=e.activeAction)&&(r.enabled=!0,r.stop())}},this.stopAllActions=function(){this.mixer.stopAllAction()}},E.createAmbientLight=function(e){var t=(e=e||{}).color||16777215,r=e.intensity||.2,n=new THREE.AmbientLight(t,r);return n.name="ambientLight",n},E.createPointLight=function(e){var t=(e=e||{}).color||16777215,r=e.intensity||1,n=e.distance||0,i=e.decay||2,a=e.near||.01,o=e.far||.2*E.camera.far,s=new THREE.PointLight(t,r,n,i);return s.castShadow=!0,s.shadow.camera.near=a,s.shadow.camera.far=o,s.shadow.mapSize.width=2048,s.shadow.mapSize.height=2048,s.shadow.radius=1.5,s.name="pointLight",s},E.createSpotLight=function(e){var t=(e=e||{}).color||16777215,r=e.intensity||1,n=e.distance||0,i=e.angle||.1*Math.PI,a=e.penumbra||.05,o=e.decay||2,s=e.near||.01,l=e.far||.2*E.camera.far,c=e.target,u=new THREE.SpotLight(t,r,n,i,a,o);return u.castShadow=!0,u.shadow.camera.near=s,u.shadow.camera.far=l,u.shadow.mapSize.width=2048,u.shadow.mapSize.height=2048,u.shadow.radius=1.5,u.name="spotLight",c&&c.isObject3D&&(u.target=c,E.scene.getObjectById(c.id)||E.add(c)),u},E.createDirectionalLight=function(e){var t=(e=e||{}).color||16777215,r=e.intensity||1,n=e.target,i=e.shadowCameraSize||.2*E.camera.far,a=new THREE.DirectionalLight(t,r);return a.castShadow=!0,a.shadow.camera.top=i,a.shadow.camera.bottom=-i,a.shadow.camera.left=-i,a.shadow.camera.right=i,a.shadow.camera.near=.01,a.shadow.camera.far=2.5*i,a.shadow.mapSize.width=2048,a.shadow.mapSize.height=2048,a.shadow.radius=1.5,a.shadow.bias=1e-4,a.name="directionalLight",n&&n.isObject3D&&(a.target=n,E.scene.getObjectById(n.id)||E.add(n)),a},E.createHemisphereLight=function(e){var t=(e=e||{}).skyColor||(new THREE.Color).setHSL(.6,1,.6),r=e.groundColor||(new THREE.Color).setHSL(.095,1,.75),n=e.intensity||1,i=new THREE.HemisphereLight(t,r,n);return i.name="hemisphereLight",i},E.createThreePointLights=function(){var e,t=new THREE.Object3D;return t.name="threePointLights",(e=E.createAmbientLight({color:1052688})).name="ambient_light",t.add(e),(e=E.createDirectionalLight({color:16777215,intensity:.225})).position.set(26,10,30),e.name="back_light",t.add(e),(e=E.createDirectionalLight({color:16777215,intensity:.375})).position.set(-20,-10,0),e.name="key_light",t.add(e),(e=E.createDirectionalLight({color:16777215,intensity:.75})).position.set(30,30,20),e.name="fill_light",t.add(e),t},E.createSunsetLights=function(){var e,t=new THREE.Object3D;return t.name="sunsetLights",(e=E.createAmbientLight({color:526344})).name="ambient_light",t.add(e),(e=E.createDirectionalLight({color:1644912,intensity:1})).name="midnightblue_light",e.position.set(50,10,0),t.add(e),(e=E.createDirectionalLight({color:9109504,intensity:1.5})).name="darkred_light",e.position.set(0,10,0),t.add(e),t},E.createThreeSpotLights=function(e,t){t=t||{},e=void 0!==e?e:100;var r=new THREE.Object3D;r.name="threeSpotLights";var n=2*Math.PI,i=Math.PI/3,a=Math.PI/6,o=Math.cos(a),s=Math.sin(a),l=.6*e,c=E.createSpotLight();c.position.set(0,l,e),r.add(c),t.target&&(c.target=t.target),!0===t.rotate&&(c.update=function(t,r){var i=.1*r%n;c.position.x=e*Math.sin(i),c.position.z=e*Math.cos(i)});var u=E.createSpotLight();u.position.set(-e*o,l,-e*s),r.add(u),t.target&&(u.target=t.target),!0===t.rotate&&(u.update=function(t,r){var a=.1*r%n;u.position.x=e*-Math.sin(a+i),u.position.z=e*-Math.cos(a+i)});var h=E.createSpotLight();return h.position.set(e*o,l,-e*s),r.add(h),t.target&&(h.target=t.target),!0===t.rotate&&(h.update=function(t,r){var i=.1*r%n;h.position.x=e*Math.cos(i+a),h.position.z=e*-Math.sin(i+a)}),r},E.createPointLightFlare=(F=new THREE.TextureLoader,D=F.load("images/lensflare/lensflare0.png"),U=F.load("images/lensflare/lensflare3.png"),function(e){var t=(e=e||{}).flareSize||700,r=E.createPointLight(e);r.name="pointLightFlare";var n=new THREE.LensFlare;return n.name="lensFlare",n.add(new THREE.LensFlareElement(D,t,0,r.color)),n.add(new THREE.LensFlareElement(U,60,.6)),n.add(new THREE.LensFlareElement(U,70,.7)),n.add(new THREE.LensFlareElement(U,120,.9)),n.add(new THREE.LensFlareElement(U,70,1)),r.add(n),r});var V=r(0);E.loadJSON=function(e){function t(t,r){var n,i=new THREE.LegacyJSONLoader(e.manager).parse(t,r),a=i.geometry;if(a instanceof THREE.Geometry&&(a.morphTargets.length>0||a.skinIndices.length>0)){a=E.toNonIndexedBufferGeometry(i.geometry);var o=i.geometry.animations;o&&(a.animations=o)}var s=i.materials;if(function(e,t){var r=THREE.NoColors;if(e instanceof THREE.Geometry){var n=!1,i=!1;e.faces[0].vertexColors.length>0&&(n=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),r=n?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(r=THREE.VertexColors);t.forEach(function(e){e.vertexColors=r})}(a,s),a instanceof THREE.BufferGeometry&&a.attributes.skinIndex){n=new THREE.SkinnedMesh(a,s);for(var l=[],c=t.bones,u=0,h=c.length;u<h;u++){var d=(new THREE.Vector3).fromArray(c[u].pos),f=(new THREE.Quaternion).fromArray(c[u].rotq),p=new THREE.Bone;p.position.copy(d),p.quaternion.copy(f),p.name=c[u].name,l.push(p)}var m=new THREE.Skeleton(l);n.bind(m)}else n=new THREE.Mesh(a,s);return a.animations&&(s.forEach(function(e){e.morphTargets=!0}),a.animations.length>0&&(n.animations=a.animations)),n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,n}function r(r,n){var i;switch(void 0===r.metadata&&(r.metadata={type:"Geometry"}),void 0===r.metadata.type&&(r.metadata.type="Geometry"),void 0!==r.metadata.formatVersion&&(r.metadata.version=r.metadata.formatVersion),r.metadata.type.toLowerCase()){case"buffergeometry":i=function(t){var r=new THREE.BufferGeometryLoader(e.manager).parse(t);return mesh=new THREE.Mesh(r),mesh.castShadow=!0,mesh.receiveShadow=!0,mesh.name=e.url,mesh}(r);break;case"geometry":i=t(r,n);break;case"object":i=function(t,r){var n=new THREE.ObjectLoader(e.manager);n.setPath(r),n.setResourcePath(r);var i=n.parse(t);return i instanceof THREE.Scene?(E.appWorks.setScene(i),i.name=e.url):(i.castShadow=!0,i.receiveShadow=!0,i.name=e.url),i}(r,n)}e.callback&&e.callback(i)}var n=e.basePath||"models/";new THREE.FileLoader(e.manager).load(e.url,function(e){r(JSON.parse(e),n)})},E.loadOBJ=function(e){var t=e.obj||null,r=e.mtl||null,n=e.basePath||"";function i(t,r,n){var i=new THREE.OBJLoader(e.manager);i.setPath(t),n&&i.setMaterials(n),i.load(r,function(n){n.traverse(function(e){e instanceof THREE.Mesh&&(e.castShadow=!0,e.receiveShadow=!0)}),n.name=t+r,e.callback&&e.callback(n)},function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}},function(e){console.log("OBJLoader: error happened")})}if(r){var a=new THREE.MTLLoader(e.manager);a.setPath(n),a.load(r,function(e){e.preload(),i(n,t,e)})}else i(n,t)},E.loadSTL=function(e){new THREE.STLLoader(e.manager).load(e.url,function(t){!function(t){var r;r=t.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var n=new THREE.Mesh(t,r);n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,e.callback&&e.callback(n)}(t)})},E.loadPLY=function(e){new THREE.PLYLoader(e.manager).load(e.url,function(t){!function(t){t.computeVertexNormals();var r=new THREE.Mesh(t,new THREE.MeshStandardMaterial);r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)})},E.loadDAE=function(e){new THREE.ColladaLoader(e.manager).load(e.url,function(t){!function(t){var r=t.scene;t.animations.length>0&&(r.animations=t.animations),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)})},E.loadGLB=function(e){var t=new THREE.GLTFLoader(e.manager);t.setCrossOrigin("anonymous");var r=new THREE.DRACOLoader(e.manager);r.setDecoderPath("js/draco/"),t.setDRACOLoader(r),t.load(e.url,function(t){!function(t){var r=t.scene||t.scenes[0],n=t.animations||[],i=E.scene.background;i&&i.isCubeTexture&&r.traverse(function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)}),n.length>0&&(r.animations=n),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)},void 0,function(e){console.error(e)})},E.loadGLTF=function(e){new THREE.GLTFLoader(e.manager).load(e.url,function(t){!function(t){var r=t.scene||t.scenes[0],n=t.animations||[],i=E.scene.background;i&&i.isCubeTexture&&r.traverse(function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)}),n.length>0&&(r.animations=n),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)},void 0,function(e){console.error(e)})},E.loadAMF=function(e){new THREE.AMFLoader(e.manager).load(e.url,function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)})},E.load3MF=function(e){var t=new THREE.ThreeMFLoader(e.manager);t.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),t.load(e.url,function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)})},E.loadWRL=function(e){new THREE.VRMLLoader(e.manager).load(e.url,function(t){!function(t){t.traverse(function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))}),t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)})},E.loadFBX=function(e){var t=new THREE.FBXLoader(e.manager),r=e.basePath||"";t.setPath(r),t.setResourcePath(r),t.load(e.url,function(t){!function(t){var r=t;r.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)})},E.loadMedical=function(e){var t=new E.MedicalLoader,r=e.basePath||"";t.setPath(r),t.load(e.url,function(t){!function(t){let r=new E.MedicalVolume(t);Array.isArray(e.url)&&e.url.length>0?r.name=e.url[0]:r.name="medicalVolume";let n=new E.LookupTables;n.lut="default",r.lutTexture=n.texture,r.lut=!0;let i=t.worldCenter();E.appWorks.camera.lookAt(i),E.appWorks.controls.target.copy(i),e.callback&&e.callback(r)}(t)})},E.Loader=function(){var e=this;function t(e,t){t.length>0&&(e.animations=t)}function r(e){E.add(e),E.welcomeObject(e)}function n(e){E.appWorks.setScene(e)}function i(t){switch(void 0===t.metadata&&(t.metadata={type:"Geometry"}),void 0===t.metadata.type&&(t.metadata.type="Geometry"),void 0!==t.metadata.formatVersion&&(t.metadata.version=t.metadata.formatVersion),t.metadata.type.toLowerCase()){case"buffergeometry":var i=(a=new THREE.BufferGeometryLoader).parse(t);r(new THREE.Mesh(i));break;case"geometry":console.error('Loader: "Geometry" is no longer supported.');break;case"object":var a;(a=new THREE.ObjectLoader).setResourcePath(e.texturePath),a.parse(t,function(e){e.isScene?n(e):r(e)});break;case"app":E.appWorks.fromJSON(t)}}this.texturePath="",this.loadItemList=function(t){E.LoaderUtils.getFilesFromItemList(t,function(t,r){e.loadFiles(t,r)})},this.loadFiles=function(t,r){if(t.length>0){r=r||E.LoaderUtils.createFilesMap(t);var n=new THREE.LoadingManager;n.onStart=()=>{E.createProgressbar()},n.onProgress=(e,t,r)=>{E.updateProgressbar(t,r)},n.onLoad=()=>{E.hideProgressbar()},n.onError=e=>{E.errorProgressbar("There was an error loading "+e)},n.setURLModifier(function(e){var t=r[e];return t?(console.log("Loading",e),URL.createObjectURL(t)):e});for(var i=0;i<t.length;i++)e.loadFile(t[i],n)}},this.loadFile=function(e,a){var o=e.name,s=o.split(".").pop().toLowerCase(),l=new FileReader;switch(l.addEventListener("progress",function(e){var t="("+Math.floor(e.total/1e3).format()+" KB)",r=Math.floor(e.loaded/e.total*100)+"%";console.log("Loading",o,t,r)}),s){case"3ds":l.addEventListener("load",function(e){var t=new THREE.TDSLoader(a).parse(e.target.result);t.name=o,r(t)},!1),l.readAsArrayBuffer(e);break;case"3mf":l.addEventListener("load",function(e){var t=new THREE.ThreeMFLoader;t.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension);var n=t.parse(e.target.result);n.name=o,r(n)},!1),l.readAsArrayBuffer(e);break;case"amf":l.addEventListener("load",function(e){var t=(new THREE.AMFLoader).parse(e.target.result);t.name=o,r(t)},!1),l.readAsArrayBuffer(e);break;case"dae":l.addEventListener("load",function(e){var n=e.target.result,i=new THREE.ColladaLoader(a).parse(n);i.scene.name=o,t(i.scene,i.animations),r(i.scene)},!1),l.readAsText(e);break;case"drc":l.addEventListener("load",function(e){var t=e.target.result,n=new THREE.DRACOLoader;n.setDecoderPath("js/draco/"),n.decodeDracoFile(t,function(e){e.center(),e.computeVertexNormals();var t=new THREE.MeshStandardMaterial,n=new THREE.Mesh(e,t);n.name=o,r(n)})},!1),l.readAsArrayBuffer(e);break;case"fbx":l.addEventListener("load",function(e){var n=e.target.result,i=new THREE.FBXLoader(a).parse(n);i.name=o,t(i,i.animations),r(i)},!1),l.readAsArrayBuffer(e);break;case"glb":l.addEventListener("load",function(e){var n=e.target.result,i=new THREE.DRACOLoader;i.setDecoderPath("js/draco/");var a=new THREE.GLTFLoader;a.setDRACOLoader(i),a.parse(n,"",function(e){var n=e.scene;n.name=o,t(n,e.animations),r(n)})},!1),l.readAsArrayBuffer(e);break;case"gltf":l.addEventListener("load",function(e){var n,i=e.target.result;!function(e){var t;if("string"==typeof e)t=e;else{var r=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4));if("glTF"===r){var n=new DataView(e).getUint32(4,!0);return n<2}t=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var i=JSON.parse(t);return null!=i.asset&&i.asset.version[0]<2}(i)?n=new THREE.GLTFLoader(a):alert("Import of glTF asset not possible. Only versions >= 2.0 are supported. Please try to upgrade the file to glTF 2.0 using glTF-Pipeline."),n.parse(i,"",function(e){var n=e.scene;n.name=o,t(n,e.animations),r(n)})},!1),l.readAsArrayBuffer(e);break;case"js":case"json":case"3geo":case"3mat":case"3obj":case"3scn":l.addEventListener("load",function(e){var t,r=e.target.result;if(-1!==r.indexOf("postMessage")){var n=new Blob([r],{type:"text/javascript"}),a=URL.createObjectURL(n),o=new Worker(a);return o.onmessage=function(e){e.data.metadata={version:2},i(e.data)},void o.postMessage(Date.now())}try{t=JSON.parse(r)}catch(e){return void alert(e)}i(t)},!1),l.readAsText(e);break;case"kmz":l.addEventListener("load",function(e){var t=(new THREE.KMZLoader).parse(e.target.result);t.scene.name=o,r(t.scene)},!1),l.readAsArrayBuffer(e);break;case"md2":l.addEventListener("load",function(e){var n=e.target.result,i=(new THREE.MD2Loader).parse(n),a=new THREE.MeshStandardMaterial({morphTargets:!0,morphNormals:!0}),s=new THREE.Mesh(i,a);s.mixer=new THREE.AnimationMixer(s),s.name=o,t(s,i.animations),r(s)},!1),l.readAsArrayBuffer(e);break;case"obj":l.addEventListener("load",function(e){var t=e.target.result,n=(new THREE.OBJLoader).parse(t);n.name=o,r(n)},!1),l.readAsText(e);break;case"ply":l.addEventListener("load",function(t){var n=t.target.result,i=(new THREE.PLYLoader).parse(n);i.sourceType="ply",i.sourceFile=e.name;var a=new THREE.MeshStandardMaterial,s=new THREE.Mesh(i,a);s.name=o,r(s)},!1),l.readAsArrayBuffer(e);break;case"stl":l.addEventListener("load",function(t){var n,i=t.target.result,a=(new THREE.STLLoader).parse(i);a.sourceType="stl",a.sourceFile=e.name,n=a.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var s=new THREE.Mesh(a,n);s.name=o,r(s)},!1),void 0!==l.readAsBinaryString?l.readAsBinaryString(e):l.readAsArrayBuffer(e);break;case"svg":l.addEventListener("load",function(e){var t=e.target.result,n=(new THREE.SVGLoader).parse(t).paths,i=new THREE.Group;i.scale.multiplyScalar(.1),i.scale.y*=-1;for(var a=0;a<n.length;a++)for(var s=n[a],l=new THREE.MeshBasicMaterial({color:s.color,depthWrite:!1}),c=s.toShapes(!0),u=0;u<c.length;u++){var h=c[u],d=new THREE.ShapeBufferGeometry(h),f=new THREE.Mesh(d,l);i.add(f)}i.name=o,r(i)},!1),l.readAsText(e);break;case"vtk":l.addEventListener("load",function(t){var n=t.target.result,i=(new THREE.VTKLoader).parse(n);i.sourceType="vtk",i.sourceFile=e.name;var a=new THREE.MeshStandardMaterial,s=new THREE.Mesh(i,a);s.name=o,r(s)},!1),l.readAsText(e);break;case"wrl":l.addEventListener("load",function(e){var t=e.target.result,r=(new THREE.VRMLLoader).parse(t);r.traverse(function(e){e.isMesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))}),r.name=o,n(r)},!1),l.readAsText(e);break;case"zip":l.addEventListener("load",function(e){!function(e){var n=new V(e);if(n.files["model.obj"]&&n.files["materials.mtl"]){var i=(new THREE.MTLLoader).parse(n.file("materials.mtl").asText()),a=(new THREE.OBJLoader).setMaterials(i).parse(n.file("model.obj").asText());r(a)}n.filter(function(e,i){var a=new THREE.LoadingManager;a.onStart=()=>{E.createProgressbar()},a.onProgress=(e,t,r)=>{E.updateProgressbar(t,r)},a.onLoad=()=>{E.hideProgressbar()},a.onError=e=>{E.errorProgressbar("There was an error loading "+e)},a.setURLModifier(function(e){var t=n.files[e];if(t){console.log("Loading",e);var r=new Blob([t.asArrayBuffer()],{type:"application/octet-stream"});return URL.createObjectURL(r)}return e});var o=i.name.split(".").pop().toLowerCase();switch(o){case"fbx":var s=new THREE.FBXLoader(a),l=s.parse(i.asArrayBuffer());r(l);break;case"glb":var s=new THREE.GLTFLoader;s.parse(i.asArrayBuffer(),"",function(e){var n=e.scene;t(n,e.animations),r(n)});break;case"gltf":var s=new THREE.GLTFLoader(a);s.parse(i.asText(),"",function(e){var n=e.scene;t(n,e.animations),r(n)})}})}(e.target.result)},!1),l.readAsBinaryString(e)}}},E.LoaderUtils={createFilesMap:function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];t[n.name]=n}return t},getFilesFromItemList:function(e,t){var r=0,n=0,i=[],a={};function o(){++r===n&&t(i,a)}function s(e){e.isDirectory?e.createReader().readEntries(function(e){for(var t=0;t<e.length;t++)s(e[t]);o()}):e.isFile&&e.file(function(t){i.push(t),a[e.fullPath.substr(1)]=t,o()});n++}for(var l=0;l<e.length;l++)s(e[l].webkitGetAsEntry())}},E.Loader2=function(){var e=this;this.fromFiles=function(e,t){if(e[0].name.match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i))return void this._loadMedicalFiles(t);const r=new Map;e.forEach(e=>r.set(e.name,e)),this.loadFiles(r)},this.fromEvent=function(t){if(t.dataTransfer.files[0].name.match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i))return void this._loadMedicalFiles(t);let r;if(t.dataTransfer.items)r=[].slice.call(t.dataTransfer.items).map(e=>e.webkitGetAsEntry());else if(1===(t.dataTransfer.files||[]).length){const e=t.dataTransfer.files[0];return"application/zip"===e.type?void alert("zip file: not supported"):void this.loadFiles(new Map([[e.name,e]]))}r||alert("Required drag & drop is not supported in this browser."),1===r.length&&r[0].name.match(/\.zip$/)?alert("zip file: not supported"):function t(r,n){const i=n.pop();if(!i)return void e.loadFiles(r);if(i.isFile)i.file(e=>{r.set(i.fullPath,e),t(r,n)},()=>console.error("Could not load file: %s",i.fullPath));else if(i.isDirectory){const e=i.createReader(),a=i=>{i.length?(n=n.concat(i),e.readEntries(a)):t(r,n)};e.readEntries(a)}else console.warn("Unknown asset type: "+i.fullPath),t(r,n)}(new Map,r)},this.loadFiles=function(t){for(var r of t.values())console.log("Loading:",r.name,"("+E.humanFileSize(r.size)+")");var n;let i,a;var o=[];Array.from(t).forEach(([e,t])=>{t.name.match(/\.(js|json|obj|stl|ply|dae|gltf|glb|amf|3mf|wrl|fbx|md2|vtk)$/i)?(i=t,a=e.replace(t.name,""),n=t.name.split(".").pop().toLowerCase()):t.name.match(/\.(png|jpg|gif)$/i)&&o.push(t)}),i||console.warn("No asset found.");const s="string"==typeof i?i:URL.createObjectURL(i),l=THREE.LoaderUtils.extractUrlBase(s);return new Promise((r,c)=>{const u=[],h=new THREE.LoadingManager;switch(h.onStart=()=>{E.createProgressbar()},h.onProgress=(e,t,r)=>{E.updateProgressbar(t,r)},h.onLoad=()=>{E.hideProgressbar()},h.onError=e=>{E.errorProgressbar("There was an error loading "+e)},h.setURLModifier((e,r)=>{const n=a+e.replace(l,"").replace(/^(\.?\/)/,"");if(t.has(n)){const e=t.get(n),r=URL.createObjectURL(e);return u.push(r),r}return(r||"")+e}),n){case"js":case"json":!function(t,n){function a(e,t,r){var n,i=new THREE.LegacyJSONLoader(t),a=i.parse(e,r),o=a.geometry;if(o instanceof THREE.Geometry&&(o.morphTargets.length>0||o.skinIndices.length>0)){o=E.toNonIndexedBufferGeometry(a.geometry);var s=a.geometry.animations;s&&(o.animations=s)}var l=a.materials;if(function(e,t){var r=THREE.NoColors;if(e instanceof THREE.Geometry){var n=!1,i=!1;e.faces[0].vertexColors.length>0&&(n=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),r=n?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(r=THREE.VertexColors);t.forEach(function(e){e.vertexColors=r})}(o,l),o instanceof THREE.BufferGeometry&&o.attributes.skinIndex){n=new THREE.SkinnedMesh(o,l);for(var c=[],u=e.bones,h=0,d=u.length;h<d;h++){var p=(new THREE.Vector3).fromArray(u[h].pos),m=(new THREE.Quaternion).fromArray(u[h].rotq),v=new THREE.Bone;v.position.copy(p),v.quaternion.copy(m),v.name=u[h].name,c.push(v)}var g=new THREE.Skeleton(c);n.bind(g)}else n=new THREE.Mesh(o,l);return o.animations&&(l.forEach(function(e){e.morphTargets=!0}),o.animations.length>0&&(n.animations=o.animations)),f(n),n}function o(e,t,r){switch(void 0===e.metadata&&(e.metadata={type:"Geometry"}),void 0===e.metadata.type&&(e.metadata.type="Geometry"),void 0!==e.metadata.formatVersion&&(e.metadata.version=e.metadata.formatVersion),e.metadata.type.toLowerCase()){case"buffergeometry":(function(e,t){var r=new THREE.BufferGeometryLoader(t).parse(e);return mesh=new THREE.Mesh(r),f(mesh),mesh})(e,t);break;case"geometry":a(e,t,r);break;case"object":(function(e,t,r){var n=new THREE.ObjectLoader(t);n.setPath(r),n.setResourcePath(r);var a=n.parse(e);a instanceof THREE.Scene?(E.appWorks.setScene(a),a.name=i.name):"natureWorks"===E.appWorks.appName&&a.children.length>0?a.children.forEach(function(e){E.add(E.cloneObject(e))}):f(a);return a})(e,t,r)}}new THREE.FileLoader(n).load(t,t=>{var i=JSON.parse(t);o(i,n,e.basePath),u.forEach(URL.revokeObjectURL),r(t)},d,c)}(s,h);break;case"obj":!function(e,n){var i;for(var a of t.values())if(a.name.match(/\.(mtl|MTL)$/)){i=a;break}function o(t){var i=new THREE.OBJLoader(n);t&&i.setMaterials(t),i.load(e,e=>{f(e),u.forEach(URL.revokeObjectURL),r(e)},d,c)}!function(e){if(void 0!==e){const i=URL.createObjectURL(e);var t=new THREE.MTLLoader(n);t.load(i,e=>{e.preload(),o(e),r(e)},d,c)}else o()}(i)}(s,h);break;case"stl":!function(e,t){new THREE.STLLoader(t).load(e,e=>{var t;t=e.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var n=new THREE.Mesh(e,t);f(n),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;case"ply":!function(e,t){new THREE.PLYLoader(t).load(e,e=>{e.computeVertexNormals();var t=new THREE.Mesh(e,new THREE.MeshStandardMaterial);f(t),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;case"dae":!function(e,t){new THREE.ColladaLoader(t).load(e,e=>{var t=e.scene;e.animations.length>0&&(t.animations=e.animations),f(t),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;case"gltf":case"glb":!function(e,t){const n=new THREE.GLTFLoader(t);n.setCrossOrigin("anonymous");const i=new THREE.DRACOLoader(t);i.setDecoderPath("js/draco/"),n.setDRACOLoader(i),n.load(e,e=>{var t=e.scene||e.scenes[0],n=e.animations||[],i=E.scene.background;i&&i.isCubeTexture&&t.traverse(function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)}),n.length>0&&(t.animations=n),f(t),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;case"amf":!function(e,t){new THREE.AMFLoader(t).load(e,e=>{f(e),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;case"3mf":!function(e,t){var n=new THREE.ThreeMFLoader(t);n.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),n.load(e,e=>{f(e),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;case"wrl":!function(e,t){new THREE.VRMLLoader(t).load(e,e=>{e.traverse(function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))}),f(e),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;case"fbx":!function(e,t){new THREE.FBXLoader(t).load(e,e=>{e.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),f(e),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;case"md2":!function(e,t){new THREE.MD2Loader(t).load(e,e=>{var t=null;1===o.length&&(t=(new THREE.TextureLoader).load(URL.createObjectURL(o[0])));var n=new THREE.MeshStandardMaterial({map:t,morphTargets:!0,morphNormals:!0}),i=new THREE.Mesh(e,n);i.mixer=new THREE.AnimationMixer(i),function(e,t){t.length>0&&(e.animations=t)}(i,e.animations),f(i),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;case"vtk":!function(e,t){new THREE.VTKLoader(t).load(e,e=>{e.center(),void 0===e.attributes.normal&&e.computeVertexNormals();var t=new THREE.MeshStandardMaterial,n=new THREE.Mesh(e,t);f(n),u.forEach(URL.revokeObjectURL),r(e)},d,c)}(s,h);break;default:alert("Unsupported file format ("+n+").")}function d(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}}function f(e){e.name=i.name,E.add(e),E.welcomeObject(e)}})},this._loadMedicalFiles=function(e){E.MedicalLoadFiles(e,e=>{E.removeMedicalWorkspace(),E.createMedicalWorkspace(e,"quadWorkspace")})}},E.Saver=function(){var e=document.createElement("a");this.saveFile=function(t){var r,n=t.split(".").pop().toLowerCase();switch("natureWorks"===appWorks.appName?((r=new THREE.Object3D).name=appWorks.appName,appWorks.scene.children.forEach(function(e){r.add(E.cloneObject(e))})):r=appWorks.scene,n){case"json":!function(e,t){var t=t||"object.json",r=e.toJSON();try{r=(r=JSON.stringify(r,i,"\t")).replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){r=JSON.stringify(r)}a(r,t)}(r,t);break;case"obj":!function(e,t){var t=t||"model.obj";a((new THREE.OBJExporter).parse(e),t)}(r,t);break;case"dae":!function(e,t){var t=t||"scene.dae";(new THREE.ColladaExporter).parse(e,function(e){a(e.data,t)})}(r,t);break;case"glb":!function(e,t){var t=t||"scene.glb";(new THREE.GLTFExporter).parse(e,function(e){o(e,t)},{binary:!0,forceIndices:!0,forcePowerOfTwoTextures:!0})}(r,t);break;case"gltf":!function(e,t){var t=t||"scene.gltf";(new THREE.GLTFExporter).parse(e,function(e){a(JSON.stringify(e,null,2),t)})}(r,t);break;case"stl":!function(e,t,r){var t=t||"model.stl",n=new THREE.STLExporter;!0===r?a(n.parse(e),t):o(n.parse(e,{binary:!0}),t)}(r,t);break;case"ply":!function(e,t){var t=t||"model.ply";a((new THREE.PLYExporter).parse(e),t)}(r,t);break;default:alert('The file type "'+n+'" is not supported.')}function i(e,t){return"number"==typeof t?parseFloat(t.toFixed(6)):t}function a(e,t){s(new Blob([e],{type:"text/plain"}),t)}function o(e,t){s(new Blob([e],{type:"application/octet-stream"}),t)}function s(t,r){e.href=URL.createObjectURL(t),e.download=r||"data.json",e.dispatchEvent(new MouseEvent("click"))}}},E.FileExplorer=function(e){e=e||E.appWorks;var t=this;this.basePath="models/",this.openFile=function(){this.fileInput.click()},this.saveAsFile=function(e){this.fileOutput.fileExtension=e,this.fileOutput.click()},this.saver=new E.Saver,this.fileOutput=document.createElement("div"),this.fileOutput.addEventListener("click",function(){var e=t.fileOutput.fileExtension;t.saver.saveFile("model."+e)}),this.loader=new E.Loader,this.loader2=new E.Loader2;var r=document.createElement("input");r.type="file",r.multiple=!0,r.style.display="none",this.fileInput=r,r.addEventListener("change",function(e){for(var n,i=[].slice.call(r.files),a=0;a<i.length;a++)if((n=i[a].name).match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i)||n.match(/\.(obj|mtl|md2|vtk)$/i))return void t.loader2.fromFiles(i,e);t.loader.loadFiles(r.files)});var n=e.dom;n.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),n.classList.add("dragover")}),n.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation(),n.classList.remove("dragover")}),n.addEventListener("drop",function(e){if(e.preventDefault(),"text/plain"!==e.dataTransfer.types[0]){for(var r,n=e.dataTransfer.files,i=0;i<n.length;i++)if((r=n[i].name).match(/\.(nii|dcm|dic|dicom|ima|mhd|nrrd|mgh|mgz|gz)$/i)||r.match(/\.(obj|mtl|md2|vtk)$/i))return void t.loader2.fromEvent(e);e.dataTransfer.items?t.loader.loadItemList(e.dataTransfer.items):t.loader.loadFiles(e.dataTransfer.files)}},!1)},E.HGTLoader=function(){this.loadTile=function(e,t,r){var n=this,i=new THREE.TextureLoader;i.crossOrigin=!0;i.load("https://maps.googleapis.com/maps/api/staticmap?center="+e+","+t+"&zoom="+r+"&size=512x512&scale=2&maptype=satellite&key=AIzaSyA1qxvvl1sFBFLj5rx4cXHJ_1soxQ_GMpw",function(i){var a=new THREE.PlaneBufferGeometry(20,20,128,128),o=new THREE.MeshPhongMaterial({map:i,shading:THREE.SmoothShading});n.heightMapping(a,e,t,r);var s=new THREE.Mesh(a,o);s.rotation.x=-Math.PI/2,s.frustumCulled=!1,s.castShadow=!1,s.receiveShadow=!0,s.name="SRTM.hgt",E.add(s)})},this.heightMapping=function(e,t,r,n){var i=e.attributes.position,a=Math.sqrt(i.count),o=i.array,s=20/(Math.abs(40075160*Math.cos(t*(Math.PI/180)))/Math.pow(2,n-1)),l=360/Math.pow(2,n-1),c=Math.abs(360*Math.cos(t*(Math.PI/180))/Math.pow(2,n-1)),u=t-c/2,h=t+c/2;console.log(u);var d=r-l/2,f=r+l/2;console.log(l),console.log(c);var p=Math.abs(Math.floor(1201*l)),m=Math.abs(Math.floor(1201*c));console.log(p,m);var v=a/p,g=a/m;console.log(g,v);var y,E,x=1200-Math.abs(1200*(h-Math.floor(h))),T=Math.abs(1200*(d-Math.floor(d))),b=1200-Math.abs(1200*(u-Math.floor(u))),w=Math.abs(1200*(f-Math.floor(f)));console.log(x,T);for(var _=Math.floor(h);_>=Math.floor(u);_--)for(var R=Math.floor(d);R<=Math.floor(f);R++){y=_>0?"N"+Math.abs(Math.floor(_)):"S"+Math.abs(Math.floor(_)),E=R>0?R<100?"E0"+Math.abs(Math.floor(R)):"E"+Math.abs(Math.floor(R)):R>=-99?"W0"+Math.abs(Math.floor(R)):"W"+Math.abs(Math.floor(R));var M=0,S=0,A=1200,L=1200;_==Math.floor(u)&&(A=b),_==Math.floor(h)&&(M=x),R==Math.floor(d)&&(S=T),R==Math.floor(f)&&(L=w);var P=Math.floor(h)-_,C=R-Math.floor(d),H=0;P>0&&(H=1201-x+1201*(P-1));var I=0;C>0&&(I=1201-T+1201*(C-1));var k=new XMLHttpRequest;k.start_row=M,k.start_column=S,k.end_row=A,k.end_column=L,k.passed_rows=H,k.passed_columns=I;var N=Math.round(H/m*a),O=Math.round((H+A-M)/m*a);O=Math.min(O,500);var F=Math.round(I/p*a),D=Math.round((I+L-S)/p*a);D=Math.min(D,500),k.filename="models/hgt/"+y+E+".hgt",k.start_i=N,k.end_i=O,k.start_j=F,k.end_j=D,k.open("GET","models/hgt/"+y+E+".hgt",!0),k.responseType="arraybuffer",k.onload=function(t){var r=this.response;if(2884802==r.byteLength){new Int16Array(r);var n=new DataView(r),l=0,c=0;console.log(this.filename),console.log(this.start_row,this.start_column),console.log("Vertex rows:",this.start_i,this.end_i),console.log("Vertex columns:",this.start_j,this.end_j),console.log("Passed rows/columns:",this.passed_rows,this.passed_columns);for(var u=this.start_i;u<=this.end_i;u++){l=u/g;for(var h=this.start_j;h<=this.end_j;h++){c=h/v;var d=0,f=0;l>=this.passed_rows&&(d=(x+l)%1201),c>=this.passed_columns&&(f=(T+c)%1201),f=Math.min(1200,f),d=Math.min(1200,d);var p,m,y,E,b=f-Math.round(f),w=d-Math.round(d);d=Math.round(d),f=Math.round(f),u==this.start_i&&console.log("Start vertex row "+this.start_i+" at file row "+d),h==this.start_j&&console.log("Start vertex column "+this.start_j+" at file column "+f),u==this.end_i&&console.log("End vertex row "+this.end_i+" at file row "+d),h==this.end_j&&console.log("End vertex column "+this.end_j+" at file column "+f),p=Math.floor(1201*d+f),m=f<1200?Math.floor(1201*d+f+1):Math.floor(1201*d+f),y=d<1200?Math.floor(1201*(d+1)+f):Math.floor(1201*d+f),E=d<1200&&f<1200?Math.floor(1201*(d+1)+f+1):Math.floor(1201*d+f);var _=n.getInt16(2*p,!1),R=n.getInt16(2*m,!1),M=(1-b)*(1-w)*_+(1-b)*w*n.getInt16(2*y,!1)+b*(1-w)*R+b*w*n.getInt16(2*E,!1);o[3*(u*a+h)+2]=M*s}}i.needsUpdate=!0,e.computeVertexNormals()}},k.send(null)}}},E.createBirdBasic=function(e,t){e=e||10,t=t||4;var r=new THREE.BufferGeometry,n=.4*e,i=.6*e,a=.5*i,o=new Float32Array([0,-0,-n,0,.08*e,-n,0,0,i,0,0,-a,-t,0,0,0,0,a,0,0,a,t,0,0,0,0,-a]);r.setAttribute("position",new THREE.BufferAttribute(o,3));var s=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide}),l=new THREE.Mesh(r,s);return l.castShadow=!0,l.receiveShadow=!0,l.name="birdBasic",l},E.createEyeball=function(e){e=e||5;var t=new THREE.Mesh(new THREE.SphereBufferGeometry(e,32,16),new THREE.ShaderMaterial({uniforms:{eyeTex:{value:(new THREE.TextureLoader).load("images/eye.jpg")}},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normal;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D eyeTex;","varying vec3 vNormal;","void main() {","vec2 uv = normalize( vNormal ).xy * 0.5 + 0.5;","vec3 color = texture2D( eyeTex, uv ).rgb;","if ( vNormal.z < - 0.85 ) color = vec3( 0.777, 0.74, 0.74 ); // back of eye","gl_FragColor = vec4( color, 1.0 );","}"].join("\n")}));return t.castShadow=!0,t.receiveShadow=!0,t.name="eyeball",t},E.createLowPolyTree=function(e,t,r){function n(e,t,r,n,i){for(var a,o,s=new THREE.Vector3,l=e[0].clone(),c=0;c<t;c++)s=e[c+(a=r*t+1)].clone(),l.y=s.y,o=s.sub(l),i?c%2==0?(o.normalize().multiplyScalar(n/6),e[c+a].add(o)):(o.normalize().multiplyScalar(n),e[c+a].add(o),e[c+a].y=e[c+a+t].y+.05):c%2!=0?(o.normalize().multiplyScalar(n/6),e[c+a].add(o)):(o.normalize().multiplyScalar(n),e[c+a].add(o),e[c+a].y=e[c+a+t].y+.05)}function i(e,t,r){for(var n,i,a=new THREE.Vector3,o=e[0].clone(),s=0;s<t;s++)a=e[s+(n=r*t+1)].clone(),o.y=a.y,(i=a.sub(o)).normalize().multiplyScalar(.06),e[s+n].sub(i)}e=e||10,t=t||.4;var a=r=r||16,o=E.randFloat(.05,.2),s=new THREE.ConeGeometry(.5,1,a,6),l=new THREE.MeshStandardMaterial({color:3407667,flatShading:!0});n(s.vertices,a,0,o),i(s.vertices,a,1),n(s.vertices,a,2,1.1*o,!0),i(s.vertices,a,3),n(s.vertices,a,4,1.2*o),i(s.vertices,a,5);var c=new THREE.Mesh(s,l);c.castShadow=!0,c.receiveShadow=!1,c.position.y=.5+t,c.rotation.y=E.randFloat(0,Math.PI);var u=t+.01,h=new THREE.CylinderGeometry(.1,.1,u),d=new THREE.MeshStandardMaterial({color:8939059,flatShading:!0}),f=new THREE.Mesh(h,d);f.position.y=u/2;var p=new THREE.Object3D;return p.add(f),p.add(c),p.scale.setScalar(e/(1+t)),p.castShadow=!0,p.receiveShadow=!1,p.name="lowPolyTree",p},E.createProcCity=function(){(a=new THREE.BoxGeometry(1,1,1)).applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));for(var e=new THREE.Mesh(a),t=new THREE.Color(16777215),r=new THREE.Color(3158096),n=new THREE.Geometry,i=0;i<2e4;i++){e.position.x=~~E.randFloat(-1e3,1e3),e.position.z=~~E.randFloat(-1e3,1e3),e.rotation.y=Math.random()*Math.PI*2,e.scale.x=E.randFloat(2,10),e.scale.y=E.randFloat(1.5,5*e.scale.x),e.scale.z=e.scale.x;for(var a,o=1-Math.random(),s=new THREE.Color(o+.1*Math.random(),o,o+.1*Math.random()),l=s.clone().multiply(t),c=s.clone().multiply(r),u=(new THREE.Color(16711680),0),h=(a=e.geometry).faces.length;u<h;u++)0===u||1===u||8===u||9===u?a.faces[u].vertexColors=[l,l,l]:2===u||3===u||10===u||11===u?a.faces[u].vertexColors=[c,c,c]:4===u||5===u?a.faces[u].vertexColors=[s,s,s]:6!==u&&7!==u||(a.faces[u].vertexColors=[s,s,s]);n.mergeMesh(e)}var d=new THREE.Texture(function(){var e=document.createElement("canvas");e.width=32,e.height=64,(i=e.getContext("2d")).fillStyle="#ffffff",i.fillRect(0,0,32,64);for(var t=2;t<64;t+=2)for(var r=0;r<32;r+=2){var n=Math.floor(64*Math.random());i.fillStyle="rgb("+[n,n,n].join(",")+")",i.fillRect(r,t,2,1)}var i,a=document.createElement("canvas");return a.width=512,a.height=1024,(i=a.getContext("2d")).imageSmoothingEnabled=!1,i.webkitImageSmoothingEnabled=!1,i.mozImageSmoothingEnabled=!1,i.drawImage(e,0,0,a.width,a.height),a}());d.anisotropy=E.renderer.capabilities.getMaxAnisotropy(),d.needsUpdate=!0;var f=new THREE.MeshLambertMaterial({map:d,vertexColors:THREE.VertexColors});return new THREE.Mesh(n,f)},E.createAcrylicPlane=function(e,t){var r=E.scene.background;r instanceof THREE.Texture||(r=null);e=void 0!==e?e:100,t=void 0!==t?t:100;var n=new THREE.Object3D;n.name="planeAcryl";var i=new THREE.PlaneBufferGeometry(e,t),a=new THREE.Mesh(i,new THREE.MeshStandardMaterial({color:12632256,map:r,transparent:!0,opacity:.7}));a.position.z=0,a.receiveShadow=!0,n.add(a);var o=new THREE.Reflector(i,{clipBias:.003,textureWidth:~~(E.appWorks.width*window.devicePixelRatio),textureHeight:~~(E.appWorks.height*window.devicePixelRatio),color:7829367,recursion:1});return o.position.z=-Math.min(.001*e,2),n.add(o),n},E.createAcrylicCircle=function(e){var t=E.scene.background;t instanceof THREE.Texture||(t=null);e=void 0!==e?e:50;var r=new THREE.Object3D;r.name="circleAcryl";var n=new THREE.CircleBufferGeometry(e,64),i=new THREE.Mesh(n,new THREE.MeshStandardMaterial({color:12632256,map:t,transparent:!0,opacity:.7}));i.position.z=0,i.receiveShadow=!0,r.add(i);var a=new THREE.Reflector(n,{clipBias:.003,textureWidth:~~(E.appWorks.width*window.devicePixelRatio),textureHeight:~~(E.appWorks.height*window.devicePixelRatio),color:7829367,recursion:1});return a.position.z=-Math.min(.001*e,2),r.add(a),r},E.createMirrorPlane=function(e,t){e=void 0!==e?e:100,t=void 0!==t?t:100;var r=new THREE.PlaneBufferGeometry(e,t);return new THREE.Reflector(r,{clipBias:.003,textureWidth:~~(E.appWorks.width*window.devicePixelRatio),textureHeight:~~(E.appWorks.height*window.devicePixelRatio),color:7829367,recursion:1})},E.createMirrorCircle=function(e){e=void 0!==e?e:50;var t=new THREE.CircleBufferGeometry(e,64);return new THREE.Reflector(t,{clipBias:.003,textureWidth:~~(E.appWorks.width*window.devicePixelRatio),textureHeight:~~(E.appWorks.height*window.devicePixelRatio),color:7829367,recursion:1})},E.createArenaRow=function(e){for(var t=(e=e||{}).radius||.5,r=e.nCluster||30,n=e.conesPerSection||5,i=e.heightMin||.1,a=e.heightMax||.15,o=e.radiusMin||.04,s=e.radiusMax||.04,l=2*Math.PI,c=new THREE.Object3D,u=new THREE.MeshPhongMaterial({color:"teal"}),h=0;h<r;h++)for(var d=h/r*l,f=0;f<n;f++){var p=THREE.Math.randFloatSpread(2/r)*l,m=THREE.Math.randFloat(i,a),v=THREE.Math.randFloat(o,s),g=new THREE.CylinderGeometry(0,v,m),y=new THREE.Mesh(g,u);y.position.y=m/2,y.position.x=t*Math.cos(d+p),y.position.z=t*Math.sin(d+p),c.add(y)}return c},E.createViewWorks=function(e,t){return E.viewWorks=new E.DesignWorks({appName:"viewWorks",width:e||window.innerWidth,height:t||window.innerHeight,glVersion:2,background:(new THREE.TextureLoader).load("images/wallpaper/arctic.jpg"),controlsType:"OrbitControls",FXAAEnabled:!0,fileExplorer:!0}),E.viewWorks.renderScene(),E.viewWorks},E.createGameWorks=function(e,t){return E.gameWorks=new E.DesignWorks({appName:"gameWorks",width:e||window.innerWidth,height:t||window.innerHeight,glVersion:2,hud:!0}),E.gameWorks.renderScene(),E.gameWorks},E.createNatureWorks=function(e,t){return E.natureWorks=new E.DesignWorks({appName:"natureWorks",width:e||window.innerWidth,height:t||window.innerHeight,signals:!0,config:!0,history:!0,glVersion:1,fog:{type:"exp2"},controlsType:"OrbitControls",stats:!0,audioFiles:void 0,gridVisible:!1,hud:!0,bleachEnabled:!1,bloomEnabled:!1,dotScreenEnabled:!1,glitchEnabled:!1,sepiaEnabled:!1,outlineEnabled:!1,FXAAEnabled:!0,ssaoEnabled:!1,godRaysEnabled:!1,bokehEnabled:!1,vignetteEnabled:!1,effectType:void 0,fileExplorer:!0,dragControls:!0,transformControls:!0}),E.natureWorks.renderScene(),E.natureWorks},E.createMedicalWorks=function(e,t){return E.medicalWorks=new E.DesignWorks({appName:"medicalWorks",width:e||window.innerWidth,height:t||window.innerHeight,signals:!0,glVersion:1,stats:!0,fileExplorer:!0}),E.medicalWorks.renderScene(),E.medicalWorks},E.add=function(e){E.updateMaterialMapEncoding(e,THREE.sRGBEncoding),E.appWorks.history?E.appWorks.add(e):E.scene.add(e)},E.remove=function(e){e&&(E.appWorks.history?E.appWorks.remove(e):e.parent&&e.parent.remove(e))},E.dispose=function(e){e&&(e.parent&&e.parent.remove(e),e.traverse(function(e){var t=e.geometry;t&&t.dispose();var r=e.material;r&&(Array.isArray(r)?r:[r]).forEach(function(e){Object.keys(e).forEach(t=>{e[t]&&"function"==typeof e[t].dispose&&e[t].dispose()}),e.dispose()})}))},E.removeHTMLElement=function(e){for("string"==typeof e&&(e=document.getElementById(e)),e.parentNode&&e.parentNode.removeChild(e);e.firstChild;)e.removeChild(e.firstChild)},window.URL=window.URL||window.webkitURL,window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,window.JAMIE=E}]);