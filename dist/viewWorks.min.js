!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=93)}([function(e,t,r){
/*! chevrotain - v4.6.0 */
"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=18)}([function(e,t,r){"use strict";function n(e){return e&&0===e.length}function i(e){return null==e?[]:Object.keys(e)}function a(e){for(var t=[],r=Object.keys(e),n=0;n<r.length;n++)t.push(e[r[n]]);return t}function o(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t.call(null,e[r],r);else{if(!v(e))throw Error("non exhaustive match");var n=i(e);for(r=0;r<n.length;r++){var a=n[r],o=e[a];t.call(null,o,a)}}}function s(e){return void 0===e}function l(e,t){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r}function c(e,t){return l(e,function(e){return!t(e)})}function u(e,t){return!!v(e)&&e.hasOwnProperty(t)}function h(e,t){return void 0!==f(e,function(e){return e===t})}function d(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}function p(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}function f(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(t.call(null,n))return n}}function m(e,t,r){for(var n=Array.isArray(e),o=n?e:a(e),s=n?[]:i(e),l=r,c=0;c<o.length;c++)l=t.call(null,l,o[c],n?c:s[c]);return l}function v(e){return e instanceof Object}function g(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++){var a=t[n];if(!s(a))for(var o=i(a),l=0;l<o.length;l++){var c=o[l];u(e,c)||(e[c]=a[c])}}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.isEmpty=n,t.keys=i,t.values=a,t.mapValues=function(e,t){for(var r=[],n=i(e),a=0;a<n.length;a++){var o=n[a];r.push(t.call(null,e[o],o))}return r},t.map=function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(t.call(null,e[n],n));return r},t.flatten=function e(t){for(var r=[],n=0;n<t.length;n++){var i=t[n];Array.isArray(i)?r=r.concat(e(i)):r.push(i)}return r},t.first=function(e){return n(e)?void 0:e[0]},t.last=function(e){var t=e&&e.length;return t?e[t-1]:void 0},t.forEach=o,t.isString=function(e){return"string"==typeof e},t.isUndefined=s,t.isFunction=function(e){return e instanceof Function},t.drop=function(e,t){return void 0===t&&(t=1),e.slice(t,e.length)},t.dropRight=function(e,t){return void 0===t&&(t=1),e.slice(0,e.length-t)},t.filter=l,t.reject=c,t.pick=function(e,t){for(var r=Object.keys(e),n={},i=0;i<r.length;i++){var a=r[i],o=e[a];t(o)&&(n[a]=o)}return n},t.has=u,t.contains=h,t.cloneArr=d,t.cloneObj=p,t.find=f,t.findAll=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];t.call(null,i)&&r.push(i)}return r},t.reduce=m,t.compact=function(e){return c(e,function(e){return null==e})},t.uniq=function(e,t){void 0===t&&(t=function(e){return e});var r=[];return m(e,function(e,n){var i=t(n);return h(r,i)?e:(r.push(i),e.concat(n))},[])},t.partial=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=[null].concat(t);return Function.bind.apply(e,n)},t.isArray=function(e){return Array.isArray(e)},t.isRegExp=function(e){return e instanceof RegExp},t.isObject=v,t.every=function(e,t){for(var r=0;r<e.length;r++)if(!t(e[r],r))return!1;return!0},t.difference=function(e,t){return c(e,function(e){return h(t,e)})},t.some=function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return!0;return!1},t.indexOf=function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1},t.sortBy=function(e,t){var r=d(e);return r.sort(function(e,r){return t(e)-t(r)}),r},t.zipObject=function(e,t){if(e.length!==t.length)throw Error("can't zipObject with different number of keys and values!");for(var r={},n=0;n<e.length;n++)r[e[n]]=t[n];return r},t.assign=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++)for(var a=t[n],o=i(a),s=0;s<o.length;s++){var l=o[s];e[l]=a[l]}return e},t.assignNoOverwrite=g,t.defaults=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return g.apply(null,[{}].concat(e))},t.groupBy=function(e,t){var r={};return o(e,function(e){var n=t(e),i=r[n];i?i.push(e):r[n]=[e]}),r},t.merge=function(e,t){for(var r=p(e),n=i(t),a=0;a<n.length;a++){var o=n[a],s=t[o];r[o]=s}return r},t.NOOP=function(){},t.IDENTITY=function(e){return e},t.packArray=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push(void 0!==n?n:void 0)}return t},t.PRINT_ERROR=function(e){console&&console.error&&console.error("Error: "+e)},t.PRINT_WARNING=function(e){console&&console.warn&&console.warn("Warning: "+e)},t.isES2015MapSupported=function(){return"function"==typeof Map},t.applyMixins=function(e,t){t.forEach(function(t){var r=t.prototype;Object.getOwnPropertyNames(r).forEach(function(n){if("constructor"!==n){var i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(e.prototype,n,i):e.prototype[n]=t.prototype[n]}})})},t.toFastProperties=function(e){function t(){}t.prototype=e;var r=new t;function n(){return typeof r.bar}return n(),n(),e}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(2),s=function(){function e(e){this.definition=e}return e.prototype.accept=function(e){e.visit(this),a.forEach(this.definition,function(t){t.accept(e)})},e}();t.AbstractProduction=s;var l=function(e){function t(t){var r=e.call(this,[])||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.accept=function(e){e.visit(this)},t}(s);t.NonTerminal=l;var c=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.orgText="",a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Rule=c;var u=function(e){function t(t){var r=e.call(this,t.definition)||this;return a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Flat=u;var h=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Option=h;var d=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.RepetitionMandatory=d;var p=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.RepetitionMandatoryWithSeparator=p;var f=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Repetition=f;var m=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.RepetitionWithSeparator=m;var v=function(e){function t(t){var r=e.call(this,t.definition)||this;return r.idx=1,a.assign(r,a.pick(t,function(e){return void 0!==e})),r}return i(t,e),t}(s);t.Alternation=v;var g=function(){function e(e){this.idx=1,a.assign(this,a.pick(e,function(e){return void 0!==e}))}return e.prototype.accept=function(e){e.visit(this)},e}();function y(e){function t(e){return a.map(e,y)}if(e instanceof l)return{type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};if(e instanceof u)return{type:"Flat",definition:t(e.definition)};if(e instanceof h)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof d)return{type:"RepetitionMandatory",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof p)return{type:"RepetitionMandatoryWithSeparator",name:e.name,idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof m)return{type:"RepetitionWithSeparator",name:e.name,idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof f)return{type:"Repetition",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof v)return{type:"Alternation",name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof g){var r={type:"Terminal",name:o.tokenName(e.terminalType),label:o.tokenLabel(e.terminalType),idx:e.idx},n=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(r.pattern=a.isRegExp(n)?n.source:n),r}if(e instanceof c)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}t.Terminal=g,t.serializeGrammar=function(e){return a.map(e,y)},t.serializeProduction=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(15),o=r(7);function s(e){return n.isString(e.LABEL)&&""!==e.LABEL}function l(e){return n.isObject(e)&&e.hasOwnProperty("tokenName")&&n.isString(e.tokenName)?e.tokenName:i.functionName(e)}t.tokenLabel=function(e){return s(e)?e.LABEL:l(e)},t.hasTokenLabel=s,t.tokenName=l;var c="parent",u="categories",h="label",d="group",p="push_mode",f="pop_mode",m="longer_alt",v="line_breaks",g="start_chars_hint";function y(e){return function(e){var t=e.name,r=e.pattern,a={};if(i.defineNameProp(a,t)||(a.tokenName=t),n.isUndefined(r)||(a.PATTERN=r),n.has(e,c))throw"The parent property is no longer supported.\nSee: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.";return n.has(e,u)&&(a.CATEGORIES=e[u]),o.augmentTokenTypes([a]),n.has(e,h)&&(a.LABEL=e[h]),n.has(e,d)&&(a.GROUP=e[d]),n.has(e,f)&&(a.POP_MODE=e[f]),n.has(e,p)&&(a.PUSH_MODE=e[p]),n.has(e,m)&&(a.LONGER_ALT=e[m]),n.has(e,v)&&(a.LINE_BREAKS=e[v]),n.has(e,g)&&(a.START_CHARS_HINT=e[g]),a}(e)}t.createToken=y,t.EOF=y({name:"EOF",pattern:a.Lexer.NA}),o.augmentTokenTypes([t.EOF]),t.createTokenInstance=function(e,t,r,n,i,a,o,s){return{image:t,startOffset:r,endOffset:n,startLine:i,endLine:a,startColumn:o,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},t.tokenMatcher=function(e,t){return o.tokenStructuredMatcher(e,t)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),o=r(0),s=r(26),l=r(2),c=r(23),u=r(16),h=r(10),d=r(24),p=r(25),f=r(31),m=r(32),v=r(34),g=r(35),y=r(36),E=r(37),x=r(38);t.END_OF_FILE=l.createTokenInstance(l.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(t.END_OF_FILE),t.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:h.defaultParserErrorProvider,serializedGrammar:null}),t.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.INVALID_NESTED_RULE_NAME=10]="INVALID_NESTED_RULE_NAME",e[e.DUPLICATE_NESTED_NAME=11]="DUPLICATE_NESTED_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=12]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=13]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=14]="TOO_MANY_ALTS"}(t.ParserDefinitionErrorType||(t.ParserDefinitionErrorType={})),t.EMPTY_ALT=function(e){return void 0===e&&(e=void 0),function(){return e}};var b=function(){function e(e,r){void 0===r&&(r=t.DEFAULT_PARSER_CONFIG),this.ignoredIssues=t.DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1,this.initErrorHandler(r),this.initLexerAdapter(),this.initLooksAhead(r),this.initRecognizerEngine(e,r),this.initRecoverable(r),this.initTreeBuilder(r),this.initContentAssist(),this.ignoredIssues=o.has(r,"ignoredIssues")?r.ignoredIssues:t.DEFAULT_PARSER_CONFIG.ignoredIssues,o.toFastProperties(this)}return e.performSelfAnalysis=function(e){e.performSelfAnalysis()},e.prototype.performSelfAnalysis=function(){var t,r=this;this.selfAnalysisDone=!0;var n=a.classNameFromInstance(this),i=this.gastProductionsCache;if(this.serializedGrammar){var l=c.deserializeGrammar(this.serializedGrammar,this.tokensMap);o.forEach(l,function(e){r.gastProductionsCache.put(e.name,e)})}var p=d.resolveGrammar({rules:i.values()});if(this.definitionErrors.push.apply(this.definitionErrors,p),o.isEmpty(p)){var f=d.validateGrammar({rules:i.values(),maxLookahead:this.maxLookahead,tokenTypes:o.values(this.tokensMap),ignoredIssues:this.ignoredIssues,errMsgProvider:h.defaultGrammarValidatorErrorProvider,grammarName:n});this.definitionErrors.push.apply(this.definitionErrors,f)}if(o.isEmpty(this.definitionErrors)){var m=s.computeAllProdsFollows(i.values());this.resyncFollows=m}var v=u.analyzeCst(i.values(),this.fullRuleNameToShort);if(this.allRuleNames=v.allRuleNames,!e.DEFER_DEFINITION_ERRORS_HANDLING&&!o.isEmpty(this.definitionErrors))throw t=o.map(this.definitionErrors,function(e){return e.message}),new Error("Parser Definition Errors detected:\n "+t.join("\n-------------------------------\n"))},e.DEFER_DEFINITION_ERRORS_HANDLING=!1,e}();t.Parser=b,o.applyMixins(b,[p.Recoverable,f.LooksAhead,m.TreeBuilder,v.LexerAdapter,y.RecognizerEngine,g.RecognizerApi,E.ErrorHandler,x.ContentAssist]);var T=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!0,e.call(this,r,i)||this}return i(r,e),r}(b);t.CstParser=T;var w=function(e){function r(r,n){void 0===n&&(n=t.DEFAULT_PARSER_CONFIG);var i=o.cloneObj(n);return i.outputCst=!1,e.call(this,r,i)||this}return i(r,e),r}(b);t.EmbeddedActionsParser=w},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.classNameFromInstance=function(e){return o(e.constructor)};var i=/^\s*function\s*(\S*)\s*\(/,a="name";function o(e){var t=e.name;return t||e.toString().match(i)[1]}t.functionName=o,t.defineNameProp=function(e,t){var r=Object.getOwnPropertyDescriptor(e,a);return!(!n.isUndefined(r)&&!r.configurable||(Object.defineProperty(e,a,{enumerable:!1,configurable:!0,writable:!1,value:t}),0))};var s=function(){function e(){this._state={}}return e.prototype.keys=function(){return n.keys(this._state)},e.prototype.values=function(){return n.values(this._state)},e.prototype.put=function(e,t){this._state[e]=t},e.prototype.putAll=function(e){this._state=n.assign(this._state,e._state)},e.prototype.get=function(e){return this._state[e]},e.prototype.containsKey=function(e){return n.has(this._state,e)},e.prototype.clear=function(){this._state={}},e}();t.HashTable=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){function e(){}return e.prototype.visit=function(e){if(e instanceof n.NonTerminal)return this.visitNonTerminal(e);if(e instanceof n.Flat)return this.visitFlat(e);if(e instanceof n.Option)return this.visitOption(e);if(e instanceof n.RepetitionMandatory)return this.visitRepetitionMandatory(e);if(e instanceof n.RepetitionMandatoryWithSeparator)return this.visitRepetitionMandatoryWithSeparator(e);if(e instanceof n.RepetitionWithSeparator)return this.visitRepetitionWithSeparator(e);if(e instanceof n.Repetition)return this.visitRepetition(e);if(e instanceof n.Alternation)return this.visitAlternation(e);if(e instanceof n.Terminal)return this.visitTerminal(e);if(e instanceof n.Rule)return this.visitRule(e);throw Error("non exhaustive match")},e.prototype.visitNonTerminal=function(e){},e.prototype.visitFlat=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}();t.GAstVisitor=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i="MismatchedTokenException",a="NoViableAltException",o="EarlyExitException",s="NotAllInputParsedException",l=[i,a,o,s];function c(e,t,r){this.name=i,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function u(e,t,r){this.name=a,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}function h(e,t){this.name=s,this.message=e,this.token=t,this.resyncedTokens=[]}function d(e,t,r){this.name=o,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}Object.freeze(l),t.isRecognitionException=function(e){return n.contains(l,e.name)},t.MismatchedTokenException=c,c.prototype=Error.prototype,t.NoViableAltException=u,u.prototype=Error.prototype,t.NotAllInputParsedException=h,h.prototype=Error.prototype,t.EarlyExitException=d,d.prototype=Error.prototype},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(2);function o(e){for(var t=n.cloneArr(e),r=e,i=!0;i;){r=n.compact(n.flatten(n.map(r,function(e){return e.CATEGORIES})));var a=n.difference(r,t);t=t.concat(a),n.isEmpty(a)?i=!1:r=a}return t}function s(e){n.forEach(e,function(e){h(e)||(t.tokenIdxToClass.put(t.tokenShortNameIdx,e),e.tokenTypeIdx=t.tokenShortNameIdx++),d(e)&&!n.isArray(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),d(e)||(e.CATEGORIES=[]),p(e)||(e.categoryMatches=[]),f(e)||(e.categoryMatchesMap={}),m(e)||(e.tokenName=a.tokenName(e))})}function l(e){n.forEach(e,function(e){e.categoryMatches=[],n.forEach(e.categoryMatchesMap,function(r,n){e.categoryMatches.push(t.tokenIdxToClass.get(n).tokenTypeIdx)})})}function c(e){n.forEach(e,function(e){u([],e)})}function u(e,t){n.forEach(e,function(e){t.categoryMatchesMap[e.tokenTypeIdx]=!0}),n.forEach(t.CATEGORIES,function(r){var i=e.concat(t);n.contains(i,r)||u(i,r)})}function h(e){return n.has(e,"tokenTypeIdx")}function d(e){return n.has(e,"CATEGORIES")}function p(e){return n.has(e,"categoryMatches")}function f(e){return n.has(e,"categoryMatchesMap")}function m(e){return n.has(e,"tokenName")}t.tokenStructuredMatcher=function(e,t){var r=e.tokenTypeIdx;return r===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[r]},t.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},t.tokenShortNameIdx=1,t.tokenIdxToClass=new i.HashTable,t.augmentTokenTypes=function(e){var t=o(e);s(t),c(t),l(t),n.forEach(t,function(e){e.isParent=e.categoryMatches.length>0})},t.expandCategories=o,t.assignTokenDefaultProps=s,t.assignCategoriesTokensProp=l,t.assignCategoriesMapProp=c,t.singleAssignCategoriesToksMap=u,t.hasShortKeyProperty=h,t.hasCategoriesProperty=d,t.hasExtendingTokensTypesProperty=p,t.hasExtendingTokensTypesMapProperty=f,t.hasTokenNameProperty=m,t.isTokenType=function(e){return n.has(e,"tokenTypeIdx")}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(1),s=r(5),l=r(2);t.isSequenceProd=function(e){return e instanceof o.Flat||e instanceof o.Option||e instanceof o.Repetition||e instanceof o.RepetitionMandatory||e instanceof o.RepetitionMandatoryWithSeparator||e instanceof o.RepetitionWithSeparator||e instanceof o.Terminal||e instanceof o.Rule},t.isOptionalProd=function e(t,r){return void 0===r&&(r=[]),!!(t instanceof o.Option||t instanceof o.Repetition||t instanceof o.RepetitionWithSeparator)||(t instanceof o.Alternation?a.some(t.definition,function(t){return e(t,r)}):!(t instanceof o.NonTerminal&&a.contains(r,t))&&t instanceof o.AbstractProduction&&(t instanceof o.NonTerminal&&r.push(t),a.every(t.definition,function(t){return e(t,r)})))},t.isBranchingProd=function(e){return e instanceof o.Alternation},t.getProductionDslName=function(e){if(e instanceof o.NonTerminal)return"SUBRULE";if(e instanceof o.Option)return"OPTION";if(e instanceof o.Alternation)return"OR";if(e instanceof o.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof o.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof o.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof o.Repetition)return"MANY";if(e instanceof o.Terminal)return"CONSUME";throw Error("non exhaustive match")};var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return i(t,e),t.prototype.visitTerminal=function(e){var t=l.tokenName(e.terminalType)+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+"Terminal";a.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitOption=function(e){this.dslMethods.option.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},t.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},t.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},t}(s.GAstVisitor);t.DslMethodsCollectorVisitor=c},function(e,t,r){"use strict";function n(e,t,r){return r|t|e}Object.defineProperty(t,"__esModule",{value:!0}),t.BITS_FOR_METHOD_IDX=4,t.BITS_FOR_OCCURRENCE_IDX=4,t.BITS_FOR_RULE_IDX=24,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_METHOD_IDX,t.OPTION_IDX=2<<t.BITS_FOR_METHOD_IDX,t.MANY_IDX=3<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_METHOD_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_METHOD_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_METHOD_IDX,t.getKeyForAutomaticLookahead=n;var i=32-t.BITS_FOR_ALT_IDX;t.getKeyForAltIndex=function(e,t,r,a){var o=a+1<<i;return n(e,t,r)|o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(0),o=r(1),s=r(8),l=r(11),c=r(17),u=r(3);t.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,r=e.actual;return e.previous,e.ruleName,"Expecting "+(n.hasTokenLabel(t)?"--\x3e "+n.tokenLabel(t)+" <--":"token of type --\x3e "+n.tokenName(t)+" <--")+" but found --\x3e '"+r.image+"' <--"},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;return e.ruleName,"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,r=e.actual,i=(e.previous,e.customUserDescription),o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");if(i)return"Expecting: "+i+o;var s=a.reduce(t,function(e,t){return e.concat(t)},[]),l=a.map(s,function(e){return"["+a.map(e,function(e){return n.tokenLabel(e)}).join(", ")+"]"});return"Expecting: one of these possible Token sequences:\n"+a.map(l,function(e,t){return"  "+(t+1)+". "+e}).join("\n")+o},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,r=e.actual,i=e.customUserDescription,o=(e.ruleName,"\nbut found: '"+a.first(r).image+"'");return i?"Expecting: "+i+o:"Expecting: expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+a.map(t,function(e){return"["+a.map(e,function(e){return n.tokenLabel(e)}).join(",")+"]"}).join(" ,")+">"+o}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var r,i=e.name,l=a.first(t),c=l.idx,u=s.getProductionDslName(l),h=(r=l)instanceof o.Terminal?n.tokenName(r.terminalType):r instanceof o.NonTerminal?r.nonTerminalName:"",d="->"+u+"<- with numerical suffix: ->"+c+"<-\n                  "+(h?"and argument: ->"+h+"<-":"")+"\n                  appears more than once ("+t.length+" times) in the top level rule: ->"+i+"<-.\n                  "+(0===c?"Also note that numerical suffix 0 means "+u+" without any suffix.":"")+"\n                  To fix this make sure each usage of "+u+" "+(h?"with the argument: ->"+h+"<-":"")+"\n                  in the rule ->"+i+"<- has a different occurrence index (0-5), as that combination acts as a unique\n                  position key in the grammar, which is needed by the parsing engine.\n                  \n                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ";return d=(d=d.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildInvalidNestedRuleNameError:function(e,t){return"Invalid nested rule name: ->"+t.name+"<- inside rule: ->"+e.name+"<-\nit must match the pattern: ->"+l.validNestedRuleName.toString()+"<-.\nNote that this means a nested rule name must start with the '$'(dollar) sign."},buildDuplicateNestedRuleNameError:function(e,t){return"Duplicate nested rule name: ->"+a.first(t).name+"<- inside rule: ->"+e.name+"<-\nA nested name must be unique in the scope of a top level grammar rule."},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+e.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=a.map(e.prefixPath,function(e){return n.tokenLabel(e)}).join(", "),r=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\nhttps://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=a.map(e.prefixPath,function(e){return n.tokenLabel(e)}).join(", "),r=0===e.alternation.idx?"":e.alternation.idx,i="Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> in <OR"+r+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+t+"> may appears as a prefix path in all these alternatives.\n",o=c.VERSION.replace(/\./g,"_");return i=i+"To Resolve this, try one of of the following: \n1. Refactor your grammar to be LL(K) for the current value of k (by default k="+u.DEFAULT_PARSER_CONFIG.maxLookahead+"})\n2. Increase the value of K for your grammar by providing a larger 'maxLookahead' value in the parser's config\n3. This issue can be ignored (if you know what you are doing...), see https://sap.github.io/chevrotain/documentation/"+o+"/interfaces/iparserconfig.html#ignoredissues for more details\n"},buildEmptyRepetitionError:function(e){var t=s.getProductionDslName(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <"+t+"> within Rule <"+e.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(e){return"Invalid Grammar Token name: ->"+n.tokenName(e.tokenType)+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <"+(e.emptyChoiceIdx+1)+"> in <OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n<OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\n has "+(e.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(e){var t=e.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+t+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n "+t+" --\x3e "+i.map(e.leftRecursionPath,function(e){return e.name}).concat([t]).join(" --\x3e ")+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(e){return"Invalid grammar rule name: ->"+e.topLevelRule.name+"<- it must match the pattern: ->"+e.expectedPattern.toString()+"<-"},buildDuplicateRuleNameError:function(e){return"Duplicate definition, rule: ->"+(e.topLevelRule instanceof o.Rule?e.topLevelRule.name:e.topLevelRule)+"<- is already defined in the grammar: ->"+e.grammarName+"<-"}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(0),s=r(3),l=r(8),c=r(2),u=r(12),h=r(16),d=r(13),p=r(1),f=r(5);function m(e){return l.getProductionDslName(e)+"_#_"+e.idx+"_#_"+v(e)}function v(e){return e instanceof p.Terminal?c.tokenName(e.terminalType):e instanceof p.NonTerminal?e.nonTerminalName:""}t.validateGrammar=function(e,t,r,n,i,u){var d=a.map(e,function(e){return function(e,t){var r=new g;e.accept(r);var n=r.allProductions,i=a.groupBy(n,m),o=a.pick(i,function(e){return e.length>1});return a.map(a.values(o),function(r){var n=a.first(r),i=t.buildDuplicateFoundError(e,r),o=l.getProductionDslName(n),c={message:i,type:s.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:o,occurrence:n.idx},u=v(n);return u&&(c.parameter=u),c})}(e,i)}),p=a.map(e,function(e){return T(e,e,i)}),f=[],w=[],_=[];o.every(p,o.isEmpty)&&(f=o.map(e,function(e){return R(e,i)}),w=o.map(e,function(e){return M(e,t,n,i)}),_=P(e,t,i));var S=function(e,t,r){var n=[],i=o.map(t,function(e){return c.tokenName(e)});return o.forEach(e,function(e){var t=e.name;if(o.contains(i,t)){var a=r.buildNamespaceConflictError(e);n.push({message:a,type:s.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}}),n}(e,r,i),L=a.map(r,function(e){return x(e,i)}),C=function(e,t){var r=[];return o.forEach(e,function(e){var n=new h.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.map(n.result,function(e){return e.orgProd});r.push(o.map(i,function(r){return E(e,r,t)}))}),o.flatten(r)}(e,i),H=function(e,t){var r=[];return o.forEach(e,function(e){var n=new h.NamedDSLMethodsCollectorVisitor("");e.accept(n);var i=o.groupBy(n.result,function(e){return e.name}),a=o.pick(i,function(e){return e.length>1});o.forEach(o.values(a),function(n){var i=o.map(n,function(e){return e.orgProd}),a=t.buildDuplicateNestedRuleNameError(e,i);r.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:e.name})})}),r}(e,i),I=o.map(e,function(e){return A(e,i)}),k=o.map(e,function(e){return y(e,i)}),O=o.map(e,function(t){return b(t,e,u,i)});return a.flatten(d.concat(L,C,H,_,p,f,w,S,I,k,O))},t.identifyProductionForDuplicates=m;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},t.prototype.visitOption=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t.prototype.visitAlternation=function(e){this.allProductions.push(e)},t.prototype.visitTerminal=function(e){this.allProductions.push(e)},t}(f.GAstVisitor);function y(e,r){var n=[],i=e.name;return i.match(t.validTermsPattern)||n.push({message:r.buildInvalidRuleNameError({topLevelRule:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:i}),n}function E(e,r,n){var i,a=[];return r.name.match(t.validNestedRuleName)||(i=n.buildInvalidNestedRuleNameError(e,r),a.push({message:i,type:s.ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:e.name})),a}function x(e,r){var n=[];return c.tokenName(e).match(t.validTermsPattern)||n.push({message:r.buildTokenNameError({tokenType:e,expectedPattern:t.validTermsPattern}),type:s.ParserDefinitionErrorType.INVALID_TOKEN_NAME}),n}function b(e,t,r,n){var i=[];if(o.reduce(t,function(t,r){return r.name===e.name?t+1:t},0)>1){var a=n.buildDuplicateRuleNameError({topLevelRule:e,grammarName:r});i.push({message:a,type:s.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function T(e,t,r,n){void 0===n&&(n=[]);var i=[],o=w(t.definition);if(a.isEmpty(o))return[];var l=e.name;a.contains(o,e)&&i.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:n}),type:s.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:l});var c=a.difference(o,n.concat([e])),u=a.map(c,function(t){var i=a.cloneArr(n);return i.push(t),T(e,t,r,i)});return i.concat(a.flatten(u))}function w(e){var t=[];if(a.isEmpty(e))return t;var r=a.first(e);if(r instanceof p.NonTerminal)t.push(r.referencedRule);else if(r instanceof p.Flat||r instanceof p.Option||r instanceof p.RepetitionMandatory||r instanceof p.RepetitionMandatoryWithSeparator||r instanceof p.RepetitionWithSeparator||r instanceof p.Repetition)t=t.concat(w(r.definition));else if(r instanceof p.Alternation)t=a.flatten(a.map(r.definition,function(e){return w(e.definition)}));else if(!(r instanceof p.Terminal))throw Error("non exhaustive match");var n=l.isOptionalProd(r),i=e.length>1;if(n&&i){var o=a.drop(e);return t.concat(w(o))}return t}t.OccurrenceValidationCollector=g,t.validTermsPattern=/^[a-zA-Z_]\w*$/,t.validNestedRuleName=new RegExp(t.validTermsPattern.source.replace("^","^\\$")),t.validateRuleName=y,t.validateNestedRuleName=E,t.validateTokenName=x,t.validateRuleDoesNotAlreadyExist=b,t.validateRuleIsOverridden=function(e,t,r){var n,i=[];return a.contains(t,e)||(n="Invalid rule override, rule: ->"+e+"<- cannot be overridden in the grammar: ->"+r+"<-as it is not defined in any of the super grammars ",i.push({message:n,type:s.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),i},t.validateNoLeftRecursion=T,t.getFirstNoneTerminal=w;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alternations=[],t}return i(t,e),t.prototype.visitAlternation=function(e){this.alternations.push(e)},t}(f.GAstVisitor);function R(e,t){var r=new _;e.accept(r);var n=r.alternations;return a.reduce(n,function(r,n){var i=a.dropRight(n.definition),o=a.map(i,function(r,i){var o=d.nextPossibleTokensAfter([r],[],null,1);return a.isEmpty(o)?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:n,emptyChoiceIdx:i}),type:s.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:n.idx,alternative:i+1}:null});return r.concat(a.compact(o))},[])}function M(e,t,r,n){var i=new _;e.accept(i);var c=i.alternations,h=r[e.name];return h&&(c=o.reject(c,function(e){return h[l.getProductionDslName(e)+(0===e.idx?"":e.idx)]})),a.reduce(c,function(r,i){var l=i.idx,c=u.getLookaheadPathsForOr(l,e,t),h=function(e,t,r,n){var i=[],l=o.reduce(e,function(t,r,n){return o.forEach(r,function(r){var a=[n];o.forEach(e,function(e,t){n!==t&&u.containsPath(e,r)&&a.push(t)}),a.length>1&&!u.containsPath(i,r)&&(i.push(r),t.push({alts:a,path:r}))}),t},[]);return a.map(l,function(e){var i=o.map(e.alts,function(e){return e+1}),a=n.buildAlternationAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path});return{message:a,type:s.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:t.idx,alternatives:[e.alts]}})}(c,i,e,n),d=L(c,i,e,n);return r.concat(h,d)},[])}t.validateEmptyOrAlternative=R,t.validateAmbiguousAlternationAlternatives=M;var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return i(t,e),t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t}(f.GAstVisitor);function A(e,t){var r=new _;e.accept(r);var n=r.alternations;return a.reduce(n,function(r,n){return n.definition.length>255&&r.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:n}),type:s.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:n.idx}),r},[])}function P(e,t,r){var n=[];return o.forEach(e,function(e){var i=new S;e.accept(i);var a=i.allProductions;o.forEach(a,function(i){var a=u.getProdType(i),l=i.idx,c=u.getLookaheadPathsForOptionalProd(l,e,a,t)[0];if(o.isEmpty(o.flatten(c))){var h=r.buildEmptyRepetitionError({topLevelRule:e,repetition:i});n.push({message:h,type:s.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}})}),n}function L(e,t,r,n){var i=[],a=o.reduce(e,function(e,t,r){var n=o.map(t,function(e){return{idx:r,path:e}});return e.concat(n)},[]);return o.forEach(a,function(e){var l=e.idx,c=e.path,h=o.findAll(a,function(e){return e.idx<l&&u.isStrictPrefixOfPath(e.path,c)}),d=o.map(h,function(e){var i=[e.idx+1,l+1],a=0===t.idx?"":t.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:s.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:a,alternatives:i}});i=i.concat(d)}),i}t.RepetionCollector=S,t.validateTooManyAlts=A,t.validateSomeNonEmptyLookaheadPath=P,t.checkPrefixAlternativesAmbiguities=L},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a,o=r(0),s=r(13),l=r(14),c=r(7),u=r(1),h=r(5);!function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"}(a=t.PROD_TYPE||(t.PROD_TYPE={})),t.getProdType=function(e){if(e instanceof u.Option)return a.OPTION;if(e instanceof u.Repetition)return a.REPETITION;if(e instanceof u.RepetitionMandatory)return a.REPETITION_MANDATORY;if(e instanceof u.RepetitionMandatoryWithSeparator)return a.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof u.RepetitionWithSeparator)return a.REPETITION_WITH_SEPARATOR;if(e instanceof u.Alternation)return a.ALTERNATION;throw Error("non exhaustive match")},t.buildLookaheadFuncForOr=function(e,t,r,n,i,a){var o=m(e,t,r);return a(o,n,y(o)?c.tokenStructuredMatcherNoCategories:c.tokenStructuredMatcher,i)},t.buildLookaheadFuncForOptionalProd=function(e,t,r,n,i,a){var o=v(e,t,i,r),s=y(o)?c.tokenStructuredMatcherNoCategories:c.tokenStructuredMatcher;return a(o[0],s,n)},t.buildAlternativesLookAheadFunc=function(e,t,r,n){var i=e.length,a=o.every(e,function(e){return o.every(e,function(e){return 1===e.length})});if(t)return function(t){for(var n=o.map(t,function(e){return e.GATE}),a=0;a<i;a++){var s=e[a],l=s.length,c=n[a];if(void 0===c||!1!==c.call(this))e:for(var u=0;u<l;u++){for(var h=s[u],d=h.length,p=0;p<d;p++){var f=this.LA(p+1);if(!1===r(f,h[p]))continue e}return a}}};if(a&&!n){var s=o.map(e,function(e){return o.flatten(e)}),l=o.reduce(s,function(e,t,r){return o.forEach(t,function(t){o.has(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=r),o.forEach(t.categoryMatches,function(t){o.has(e,t)||(e[t]=r)})}),e},[]);return function(){var e=this.LA(1);return l[e.tokenTypeIdx]}}return function(){for(var t=0;t<i;t++){var n=e[t],a=n.length;e:for(var o=0;o<a;o++){for(var s=n[o],l=s.length,c=0;c<l;c++){var u=this.LA(c+1);if(!1===r(u,s[c]))continue e}return t}}}},t.buildSingleAlternativeLookaheadFunction=function(e,t,r){var n=o.every(e,function(e){return 1===e.length}),i=e.length;if(n&&!r){var a=o.flatten(e);if(1===a.length&&o.isEmpty(a[0].categoryMatches)){var s=a[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}var l=o.reduce(a,function(e,t,r){return e[t.tokenTypeIdx]=!0,o.forEach(t.categoryMatches,function(t){e[t]=!0}),e},[]);return function(){var e=this.LA(1);return!0===l[e.tokenTypeIdx]}}return function(){e:for(var r=0;r<i;r++){for(var n=e[r],a=n.length,o=0;o<a;o++){var s=this.LA(o+1);if(!1===t(s,n[o]))continue e}return!0}return!1}};var d=function(e){function t(t,r,n){var i=e.call(this)||this;return i.topProd=t,i.targetOccurrence=r,i.targetProdType=n,i}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},t.prototype.checkIsTarget=function(e,t,r,n){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=r.concat(n),!0)},t.prototype.walkOption=function(t,r,n){this.checkIsTarget(t,a.OPTION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOne=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkAtLeastOneSep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkMany=function(t,r,n){this.checkIsTarget(t,a.REPETITION,r,n)||e.prototype.walkOption.call(this,t,r,n)},t.prototype.walkManySep=function(t,r,n){this.checkIsTarget(t,a.REPETITION_WITH_SEPARATOR,r,n)||e.prototype.walkOption.call(this,t,r,n)},t}(l.RestWalker),p=function(e){function t(t,r){var n=e.call(this)||this;return n.targetOccurrence=t,n.targetProdType=r,n.result=[],n}return i(t,e),t.prototype.checkIsTarget=function(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.result=e.definition)},t.prototype.visitOption=function(e){this.checkIsTarget(e,a.OPTION)},t.prototype.visitRepetition=function(e){this.checkIsTarget(e,a.REPETITION)},t.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_MANDATORY_WITH_SEPARATOR)},t.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,a.REPETITION_WITH_SEPARATOR)},t.prototype.visitAlternation=function(e){this.checkIsTarget(e,a.ALTERNATION)},t}(h.GAstVisitor);function f(e,t){function r(e,t){return o.reduce(e,function(e,r,n){if(n!==t){var i=o.map(r,function(e){return e.partialPath});return e.concat(i)}return e},[])}function n(e,t){return void 0===o.find(e,function(e){return o.every(t,function(t,r){return n=t,i=e[r],n===i||n&&i&&(n.categoryMatchesMap[i.tokenTypeIdx]||i.categoryMatchesMap[n.tokenTypeIdx]);var n,i})})}function i(e){for(var t=[],r=0;r<e;r++)t.push([]);return t}for(var a=o.map(e,function(e){return s.possiblePathsFrom([e],1)}),l=i(a.length),c=a,u=1;u<=t;u++){var h=c;c=i(h.length);for(var d=0;d<h.length;d++)for(var p=h[d],f=r(h,d),m=0;m<p.length;m++){var v=p[m].partialPath,y=p[m].suffixDef;if(n(f,v)||o.isEmpty(y)||v.length===t){var E=l[d];g(E,v)||E.push(v)}else{var x=s.possiblePathsFrom(y,u+1,v);c[d]=c[d].concat(x)}}}return l}function m(e,t,r){var n=new p(e,a.ALTERNATION);return t.accept(n),f(n.result,r)}function v(e,t,r,n){var i=new p(e,r);t.accept(i);var a=i.result,o=new d(t,e,r).startWalking();return f([new u.Flat({definition:a}),new u.Flat({definition:o})],n)}function g(e,t){return void 0!==o.find(e,function(e){return t.length===e.length&&o.every(t,function(t,r){return t===e[r]||e[r].categoryMatchesMap[t.tokenTypeIdx]})})}function y(e){return o.every(e,function(e){return o.every(e,function(e){return o.every(e,function(e){return o.isEmpty(e.categoryMatches)})})})}t.lookAheadSequenceFromAlternatives=f,t.getLookaheadPathsForOr=m,t.getLookaheadPathsForOptionalProd=v,t.containsPath=g,t.isStrictPrefixOfPath=function(e,t){return e.length<t.length&&o.every(e,function(e,r){var n=t[r];return e===n||n.categoryMatchesMap[e.tokenTypeIdx]})},t.areTokenCategoriesNotUsed=y},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(0),s=r(2),l=r(21),c=r(1),u=function(e){function t(t,r){var n=e.call(this)||this;return n.topProd=t,n.path=r,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}return i(t,e),t.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=o.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=o.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},t.prototype.walk=function(t,r){void 0===r&&(r=[]),this.found||e.prototype.walk.call(this,t,r)},t.prototype.walkProdRef=function(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var n=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,n)}},t.prototype.updateExpectedNext=function(){o.isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},t}(a.RestWalker);t.AbstractNextPossibleTokensWalker=u;var h=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.path=r,n.nextTerminalName="",n.nextTerminalOccurrence=0,n.nextTerminalName=s.tokenName(n.path.lastTok),n.nextTerminalOccurrence=n.path.lastTokOccurrence,n}return i(t,e),t.prototype.walkTerminal=function(e,t,r){if(this.isAtEndOfPath&&s.tokenName(e.terminalType)===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var n=t.concat(r),i=new c.Flat({definition:n});this.possibleTokTypes=l.first(i),this.found=!0}},t}(u);t.NextAfterTokenWalker=h;var d=function(e){function t(t,r){var n=e.call(this)||this;return n.topRule=t,n.occurrence=r,n.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},n}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topRule),this.result},t}(a.RestWalker);t.AbstractNextTerminalAfterProductionWalker=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkMany=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkMany.call(this,t,r,n)},t}(d);t.NextTerminalAfterManyWalker=p;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkManySep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkManySep.call(this,t,r,n)},t}(d);t.NextTerminalAfterManySepWalker=f;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOne=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOne.call(this,t,r,n)},t}(d);t.NextTerminalAfterAtLeastOneWalker=m;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.walkAtLeastOneSep=function(t,r,n){if(t.idx===this.occurrence){var i=o.first(r.concat(n));this.result.isEndOfRule=void 0===i,i instanceof c.Terminal&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,r,n)},t}(d);function g(e,t,r,n){var i=o.cloneArr(r);i.push(e.name);var a=o.cloneArr(n);return a.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:a}}t.NextTerminalAfterAtLeastOneSepWalker=v,t.possiblePathsFrom=function e(t,r,n){void 0===n&&(n=[]),n=o.cloneArr(n);var i=[],a=0;function s(s){var l=e(s.concat(o.drop(t,a+1)),r,n);return i.concat(l)}for(;n.length<r&&a<t.length;){var l=t[a];if(l instanceof c.Flat)return s(l.definition);if(l instanceof c.NonTerminal)return s(l.definition);if(l instanceof c.Option)i=s(l.definition);else{if(l instanceof c.RepetitionMandatory)return s(u=l.definition.concat([new c.Repetition({definition:l.definition})]));if(l instanceof c.RepetitionMandatoryWithSeparator)return s(u=[new c.Flat({definition:l.definition}),new c.Repetition({definition:[new c.Terminal({terminalType:l.separator})].concat(l.definition)})]);if(l instanceof c.RepetitionWithSeparator){var u=l.definition.concat([new c.Repetition({definition:[new c.Terminal({terminalType:l.separator})].concat(l.definition)})]);i=s(u)}else if(l instanceof c.Repetition)u=l.definition.concat([new c.Repetition({definition:l.definition})]),i=s(u);else{if(l instanceof c.Alternation)return o.forEach(l.definition,function(e){i=s(e.definition)}),i;if(!(l instanceof c.Terminal))throw Error("non exhaustive match");n.push(l.terminalType)}}a++}return i.push({partialPath:n,suffixDef:o.drop(t,a)}),i},t.nextPossibleTokensAfter=function(e,t,r,n){var i=["EXIT_NONE_TERMINAL"],a=!1,s=t.length,l=s-n-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!o.isEmpty(h);){var d=h.pop();if("EXIT_ALTERNATIVE"!==d){var p=d.def,f=d.idx,m=d.ruleStack,v=d.occurrenceStack;if(!o.isEmpty(p)){var y=p[0];if("EXIT_NONE_TERMINAL"===y){var E={idx:f,def:o.drop(p),ruleStack:o.dropRight(m),occurrenceStack:o.dropRight(v)};h.push(E)}else if(y instanceof c.Terminal)if(f<s-1){var x=f+1;r(t[x],y.terminalType)&&(E={idx:x,def:o.drop(p),ruleStack:m,occurrenceStack:v},h.push(E))}else{if(f!==s-1)throw Error("non exhaustive match");u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:m,occurrenceStack:v}),a=!0}else if(y instanceof c.NonTerminal){var b=o.cloneArr(m);b.push(y.nonTerminalName);var T=o.cloneArr(v);T.push(y.idx),E={idx:f,def:y.definition.concat(i,o.drop(p)),ruleStack:b,occurrenceStack:T},h.push(E)}else if(y instanceof c.Option){var w={idx:f,def:o.drop(p),ruleStack:m,occurrenceStack:v};h.push(w),h.push("EXIT_ALTERNATIVE");var _={idx:f,def:y.definition.concat(o.drop(p)),ruleStack:m,occurrenceStack:v};h.push(_)}else if(y instanceof c.RepetitionMandatory){var R=new c.Repetition({definition:y.definition,idx:y.idx});E={idx:f,def:y.definition.concat([R],o.drop(p)),ruleStack:m,occurrenceStack:v},h.push(E)}else if(y instanceof c.RepetitionMandatoryWithSeparator){var M=new c.Terminal({terminalType:y.separator});R=new c.Repetition({definition:[M].concat(y.definition),idx:y.idx}),E={idx:f,def:y.definition.concat([R],o.drop(p)),ruleStack:m,occurrenceStack:v},h.push(E)}else if(y instanceof c.RepetitionWithSeparator){w={idx:f,def:o.drop(p),ruleStack:m,occurrenceStack:v},h.push(w),h.push("EXIT_ALTERNATIVE"),M=new c.Terminal({terminalType:y.separator});var S=new c.Repetition({definition:[M].concat(y.definition),idx:y.idx});_={idx:f,def:y.definition.concat([S],o.drop(p)),ruleStack:m,occurrenceStack:v},h.push(_)}else if(y instanceof c.Repetition)w={idx:f,def:o.drop(p),ruleStack:m,occurrenceStack:v},h.push(w),h.push("EXIT_ALTERNATIVE"),S=new c.Repetition({definition:y.definition,idx:y.idx}),_={idx:f,def:y.definition.concat([S],o.drop(p)),ruleStack:m,occurrenceStack:v},h.push(_);else if(y instanceof c.Alternation)for(var A=y.definition.length-1;A>=0;A--){var P={idx:f,def:y.definition[A].definition.concat(o.drop(p)),ruleStack:m,occurrenceStack:v};h.push(P),h.push("EXIT_ALTERNATIVE")}else if(y instanceof c.Flat)h.push({idx:f,def:y.definition.concat(o.drop(p)),ruleStack:m,occurrenceStack:v});else{if(!(y instanceof c.Rule))throw Error("non exhaustive match");h.push(g(y,f,m,v))}}}else a&&o.last(h).idx<=l&&h.pop()}return u}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=function(){function e(){}return e.prototype.walk=function(e,t){var r=this;void 0===t&&(t=[]),n.forEach(e.definition,function(a,o){var s=n.drop(e.definition,o+1);if(a instanceof i.NonTerminal)r.walkProdRef(a,s,t);else if(a instanceof i.Terminal)r.walkTerminal(a,s,t);else if(a instanceof i.Flat)r.walkFlat(a,s,t);else if(a instanceof i.Option)r.walkOption(a,s,t);else if(a instanceof i.RepetitionMandatory)r.walkAtLeastOne(a,s,t);else if(a instanceof i.RepetitionMandatoryWithSeparator)r.walkAtLeastOneSep(a,s,t);else if(a instanceof i.RepetitionWithSeparator)r.walkManySep(a,s,t);else if(a instanceof i.Repetition)r.walkMany(a,s,t);else{if(!(a instanceof i.Alternation))throw Error("non exhaustive match");r.walkOr(a,s,t)}})},e.prototype.walkTerminal=function(e,t,r){},e.prototype.walkProdRef=function(e,t,r){},e.prototype.walkFlat=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkOption=function(e,t,r){var n=t.concat(r);this.walk(e,n)},e.prototype.walkAtLeastOne=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkAtLeastOneSep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkMany=function(e,t,r){var n=[new i.Option({definition:e.definition})].concat(t,r);this.walk(e,n)},e.prototype.walkManySep=function(e,t,r){var n=o(e,t,r);this.walk(e,n)},e.prototype.walkOr=function(e,t,r){var a=this,o=t.concat(r);n.forEach(e.definition,function(e){var t=new i.Flat({definition:[e]});a.walk(t,o)})},e}();function o(e,t,r){return[new i.Option({definition:[new i.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}t.RestWalker=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(27),i=r(0),a=r(7),o=r(20);!function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"}(t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}));var s={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:o.defaultLexerErrorProvider};Object.freeze(s);var l=function(){function e(e,t){var r=this;if(void 0===t&&(t=s),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"==typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");if(this.config=i.merge(s,t),this.config.lineTerminatorsPattern===s.lineTerminatorsPattern)this.config.lineTerminatorsPattern=n.LineTerminatorOptimizedTester;else if(this.config.lineTerminatorCharacters===s.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking);var o,l=!0;i.isArray(e)?((o={modes:{}}).modes[n.DEFAULT_MODE]=i.cloneArr(e),o[n.DEFAULT_MODE]=n.DEFAULT_MODE):(l=!1,o=i.cloneObj(e)),this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(n.performRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(n.performWarningRuntimeChecks(o,this.trackStartLines,this.config.lineTerminatorCharacters)),o.modes=o.modes?o.modes:{},i.forEach(o.modes,function(e,t){o.modes[t]=i.reject(e,function(e){return i.isUndefined(e)})});var c=i.keys(o.modes);if(i.forEach(o.modes,function(e,o){if(r.modes.push(o),r.lexerDefinitionErrors=r.lexerDefinitionErrors.concat(n.validatePatterns(e,c)),i.isEmpty(r.lexerDefinitionErrors)){a.augmentTokenTypes(e);var s=n.analyzeTokenTypes(e,{lineTerminatorCharacters:r.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode});r.patternIdxToConfig[o]=s.patternIdxToConfig,r.charCodeToPatternIdxToConfig[o]=s.charCodeToPatternIdxToConfig,r.emptyGroups=i.merge(r.emptyGroups,s.emptyGroups),r.hasCustom=s.hasCustom||r.hasCustom,r.canModeBeOptimized[o]=s.canBeOptimized}}),this.defaultMode=o.defaultMode,!i.isEmpty(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){var u=i.map(this.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+u)}if(i.forEach(this.lexerDefinitionWarning,function(e){i.PRINT_WARNING(e.message)}),n.SUPPORT_STICKY?(this.chopInput=i.IDENTITY,this.match=this.matchWithTest):(this.updateLastIndex=i.NOOP,this.match=this.matchWithExec),l&&(this.handleModes=i.NOOP),!1===this.trackStartLines&&(this.computeNewColumn=i.IDENTITY),!1===this.trackEndLines&&(this.updateTokenEndLineColumnLocation=i.NOOP),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else{if(!/onlyOffset/i.test(this.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+this.config.positionTracking+'"');this.createTokenInstance=this.createOffsetOnlyToken}this.hasCustom?this.addToken=this.addTokenUsingPush:this.addToken=this.addTokenUsingMemberAccess;var h=i.reduce(this.canModeBeOptimized,function(e,t,r){return!1===t&&e.push(r),e},[]);if(t.ensureOptimizations&&!i.isEmpty(h))throw Error("Lexer Modes: < "+h.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')}return e.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),!i.isEmpty(this.lexerDefinitionErrors)){var r=i.map(this.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+r)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,t){var r,a,o,s,l,c,u,h,d,p,f,m,v=this,g=e,y=g.length,E=0,x=0,b=this.hasCustom?0:Math.floor(e.length/10),T=new Array(b),w=[],_=this.trackStartLines?1:void 0,R=this.trackStartLines?1:void 0,M=n.cloneEmptyGroups(this.emptyGroups),S=this.trackStartLines,A=this.config.lineTerminatorsPattern,P=0,L=[],C=[],H=[],I=[];Object.freeze(I);var k,O=void 0,N=function(e){if(1===H.length&&void 0===e.tokenType.PUSH_MODE){var t=v.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);w.push({offset:e.startOffset,line:void 0!==e.startLine?e.startLine:void 0,column:void 0!==e.startColumn?e.startColumn:void 0,length:e.image.length,message:t})}else{H.pop();var r=i.last(H);L=v.patternIdxToConfig[r],C=v.charCodeToPatternIdxToConfig[r],P=L.length;var n=v.canModeBeOptimized[r]&&!1===v.config.safeMode;O=C&&n?function(e){var t=C[e];return void 0===t?I:t}:function(){return L}}};function F(e){H.push(e),C=this.charCodeToPatternIdxToConfig[e],L=this.patternIdxToConfig[e],P=L.length,P=L.length;var t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;O=C&&t?function(e){var t=C[e];return void 0===t?I:t}:function(){return L}}for(F.call(this,t);E<y;){l=null;var D=g.charCodeAt(E),z=O(D),U=z.length;for(r=0;r<U;r++){var B=(k=z[r]).pattern;if(!1!==(K=k.short)?D===K&&(l=B):!0===k.isCustom?l=null!==(m=B.exec(g,E,T,M))?m[0]:m:(this.updateLastIndex(B,E),l=this.match(B,e,E)),null!==l){if(void 0!==(s=k.longerAlt)){var G=L[s],V=G.pattern;!0===G.isCustom?o=null!==(m=V.exec(g,E,T,M))?m[0]:m:(this.updateLastIndex(V,E),o=this.match(V,e,E)),o&&o.length>l.length&&(l=o,k=G)}break}}if(null!==l){if(c=l.length,void 0!==(u=k.group)&&(h=k.tokenTypeIdx,d=this.createTokenInstance(l,E,h,k.tokenType,_,R,c),!1===u?x=this.addToken(T,x,d):M[u].push(d)),e=this.chopInput(e,c),E+=c,R=this.computeNewColumn(R,c),!0===S&&!0===k.canLineTerminator){var j=0,W=void 0,X=void 0;A.lastIndex=0;do{!0===(W=A.test(l))&&(X=A.lastIndex-1,j++)}while(W);0!==j&&(_+=j,R=c-X,this.updateTokenEndLineColumnLocation(d,u,X,j,_,R,c))}this.handleModes(k,N,F,d)}else{for(var Y=E,q=_,Q=R,Z=!1;!Z&&E<y;)for(g.charCodeAt(E),e=this.chopInput(e,1),E++,a=0;a<P;a++){var K,J=L[a];if(B=J.pattern,!1!==(K=J.short)?g.charCodeAt(E)===K&&(Z=!0):!0===J.isCustom?Z=null!==B.exec(g,E,T,M):(this.updateLastIndex(B,E),Z=null!==B.exec(e)),!0===Z)break}p=E-Y,f=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(g,Y,p,q,Q),w.push({offset:Y,line:q,column:Q,length:p,message:f})}}return this.hasCustom||(T.length=x),{tokens:T,groups:M,errors:w}},e.prototype.handleModes=function(e,t,r,n){if(!0===e.pop){var i=e.push;t(n),void 0!==i&&r.call(this,i)}else void 0!==e.push&&r.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,r,n,i,a,o){var s,l;void 0!==t&&(l=(s=r===o-1)?-1:0,1===n&&!0===s||(e.endLine=i+l,e.endColumn=a-1-l))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},e.prototype.createOffsetOnlyToken=function(e,t,r,n){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:n}},e.prototype.createStartOnlyToken=function(e,t,r,n,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:r,tokenType:n}},e.prototype.createFullToken=function(e,t,r,n,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:n}},e.prototype.addToken=function(e,t,r){return 666},e.prototype.addTokenUsingPush=function(e,t,r){return e.push(r),t},e.prototype.addTokenUsingMemberAccess=function(e,t,r){return e[t]=r,++t},e.prototype.match=function(e,t,r){return null},e.prototype.matchWithTest=function(e,t,r){return!0===e.test(t)?t.substring(r,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var r=e.exec(t);return null!==r?r[0]:r},e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",e.NA=/NOT_APPLICABLE/,e}();t.Lexer=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),o=r(4),s=r(9),l=r(1),c=r(5);t.addTerminalToCst=function(e,t,r){void 0===e.children[r]?e.children[r]=[t]:e.children[r].push(t)},t.addNoneTerminalToCst=function(e,t,r){void 0===e.children[t]?e.children[t]=[r]:e.children[t].push(r)};var u=function(e){function t(t){var r=e.call(this)||this;return r.result=[],r.ruleIdx=t,r}return i(t,e),t.prototype.collectNamedDSLMethod=function(e,t,r){if(!a.isUndefined(e.name)){var n=void 0;if(e instanceof l.Option||e instanceof l.Repetition||e instanceof l.RepetitionMandatory||e instanceof l.Alternation)n=new t({definition:e.definition,idx:e.idx});else{if(!(e instanceof l.RepetitionMandatoryWithSeparator||e instanceof l.RepetitionWithSeparator))throw Error("non exhaustive match");n=new t({definition:e.definition,idx:e.idx,separator:e.separator})}var i=[n],o=s.getKeyForAutomaticLookahead(this.ruleIdx,r,e.idx);this.result.push({def:i,key:o,name:e.name,orgProd:e})}},t.prototype.visitOption=function(e){this.collectNamedDSLMethod(e,l.Option,s.OPTION_IDX)},t.prototype.visitRepetition=function(e){this.collectNamedDSLMethod(e,l.Repetition,s.MANY_IDX)},t.prototype.visitRepetitionMandatory=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatory,s.AT_LEAST_ONE_IDX)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionMandatoryWithSeparator,s.AT_LEAST_ONE_SEP_IDX)},t.prototype.visitRepetitionWithSeparator=function(e){this.collectNamedDSLMethod(e,l.RepetitionWithSeparator,s.MANY_SEP_IDX)},t.prototype.visitAlternation=function(e){var t=this;this.collectNamedDSLMethod(e,l.Alternation,s.OR_IDX);var r=e.definition.length>1;a.forEach(e.definition,function(n,i){if(!a.isUndefined(n.name)){var o=n.definition;o=r?[new l.Option({definition:n.definition})]:n.definition;var c=s.getKeyForAltIndex(t.ruleIdx,s.OR_IDX,e.idx,i);t.result.push({def:o,key:c,name:n.name,orgProd:n})}})},t}(c.GAstVisitor);t.NamedDSLMethodsCollectorVisitor=u,t.analyzeCst=function(e,t){var r={dictDef:new o.HashTable,allRuleNames:[]};return a.forEach(e,function(e){var n=t.get(e.name);r.allRuleNames.push(e.name);var i=new u(n);e.accept(i),a.forEach(i.result,function(t){t.def,t.key;var n=t.name;r.allRuleNames.push(e.name+n)})}),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION="4.6.0"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(15),a=r(2),o=r(6),s=r(17),l=r(10),c=r(39),u=r(5),h=r(1),d=r(24),p=r(40),f=r(20),m={};m.VERSION=s.VERSION,m.Parser=n.Parser,m.CstParser=n.CstParser,m.EmbeddedActionsParser=n.EmbeddedActionsParser,m.ParserDefinitionErrorType=n.ParserDefinitionErrorType,m.Lexer=i.Lexer,m.LexerDefinitionErrorType=i.LexerDefinitionErrorType,m.EOF=a.EOF,m.tokenName=a.tokenName,m.tokenLabel=a.tokenLabel,m.tokenMatcher=a.tokenMatcher,m.createToken=a.createToken,m.createTokenInstance=a.createTokenInstance,m.EMPTY_ALT=n.EMPTY_ALT,m.defaultParserErrorProvider=l.defaultParserErrorProvider,m.isRecognitionException=o.isRecognitionException,m.EarlyExitException=o.EarlyExitException,m.MismatchedTokenException=o.MismatchedTokenException,m.NotAllInputParsedException=o.NotAllInputParsedException,m.NoViableAltException=o.NoViableAltException,m.defaultLexerErrorProvider=f.defaultLexerErrorProvider,m.Flat=h.Flat,m.Repetition=h.Repetition,m.RepetitionWithSeparator=h.RepetitionWithSeparator,m.RepetitionMandatory=h.RepetitionMandatory,m.RepetitionMandatoryWithSeparator=h.RepetitionMandatoryWithSeparator,m.Option=h.Option,m.Alternation=h.Alternation,m.NonTerminal=h.NonTerminal,m.Terminal=h.Terminal,m.Rule=h.Rule,m.GAstVisitor=u.GAstVisitor,m.serializeGrammar=h.serializeGrammar,m.serializeProduction=h.serializeProduction,m.resolveGrammar=d.resolveGrammar,m.defaultGrammarResolverErrorProvider=l.defaultGrammarResolverErrorProvider,m.validateGrammar=d.validateGrammar,m.defaultGrammarValidatorErrorProvider=l.defaultGrammarValidatorErrorProvider,m.assignOccurrenceIndices=d.assignOccurrenceIndices,m.clearCache=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")},m.createSyntaxDiagramsCode=c.createSyntaxDiagramsCode,m.generateParserFactory=p.generateParserFactory,m.generateParserModule=p.generateParserModule,e.exports=m},function(e,t,r){var n,i,a;"undefined"!=typeof self&&self,i=[],void 0===(a="function"==typeof(n=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");for(var r={type:"Flags",global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":s(r,"global");break;case"i":s(r,"ignoreCase");break;case"m":s(r,"multiLine");break;case"u":s(r,"unicode");break;case"y":s(r,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t}},e.prototype.disjunction=function(){var e=[];for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e}},e.prototype.alternative=function(){for(var e=[];this.isTerm();)e.push(this.term());return{type:"Alternative",value:e}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case"^":return{type:"StartAnchor"};case"$":return{type:"EndAnchor"};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary"};case"B":return{type:"NonWordBoundary"}}throw Error("Invalid Assertion Escape");case"(":var e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}l(e);var t=this.disjunction();return this.consumeChar(")"),{type:e,value:t}}!function(){throw Error("Internal Error - Should never get here!")}()},e.prototype.quantifier=function(e){var t;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":var r=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:r,atMost:r};break;case",":var n;this.isDigit()?(n=this.integerIncludingZero(),t={atLeast:r,atMost:n}):t={atLeast:r,atMost:1/0},this.consumeChar("}")}if(!0===e&&void 0===t)return;l(t)}if(!0!==e||void 0!==t)return l(t),"?"===this.peekChar(0)?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t},e.prototype.atom=function(){var e;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}return void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),l(e),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[a("\n"),a("\r"),a("\u2028"),a("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var e=this.positiveInteger();return{type:"GroupBackReference",value:e}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case"d":e=c;break;case"D":e=c,t=!0;break;case"s":e=h;break;case"S":e=h,t=!0;break;case"w":e=u;break;case"W":e=u,t=!0}return l(e),{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=a("\f");break;case"n":e=a("\n");break;case"r":e=a("\r");break;case"t":e=a("\t");break;case"v":e=a("\v")}return l(e),{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");var t=e.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:t}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:a("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var e=this.popChar();return{type:"Character",value:a(e)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var e=this.popChar();return{type:"Character",value:a(e)}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){var r=this.classAtom(),n="Character"===r.type;if(n&&this.isRangeDash()){this.consumeChar("-");var i=this.classAtom(),s="Character"===i.type;if(s){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else o(r.value,e),e.push(a("-")),o(i.value,e)}else o(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:a("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++}var t=this.disjunction();this.consumeChar(")");var r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r},e.prototype.positiveInteger=function(){var e=this.popChar();if(!1===i.test(e))throw Error("Expecting a positive integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(!1===n.test(e))throw Error("Expecting an integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:a(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},e.prototype.isDigit=function(){return n.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(void 0===e&&(e=0),this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(e){return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var t="",n=0;n<e;n++){var i=this.popChar();if(!1===r.test(i))throw Error("Expecting a HexDecimal digits");t+=i}var a=parseInt(t,16);return{type:"Character",value:a}},e.prototype.peekChar=function(e){return void 0===e&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++};var t,r=/[0-9a-fA-F]/,n=/[0-9]/,i=/[1-9]/;function a(e){return e.charCodeAt(0)}function o(e,t){void 0!==e.length?e.forEach(function(e){t.push(e)}):t.push(e)}function s(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t]=!0}function l(e){if(void 0===e)throw Error("Internal Error - Should never get here!")}var c=[];for(t=a("0");t<=a("9");t++)c.push(t);var u=[a("_")].concat(c);for(t=a("a");t<=a("z");t++)u.push(t);for(t=a("A");t<=a("Z");t++)u.push(t);var h=[a(" "),a("\f"),a("\n"),a("\r"),a("\t"),a("\v"),a("\t"),a(""),a(""),a(""),a(""),a(""),a(""),a(""),a(""),a(""),a(""),a(""),a(""),a(""),a("\u2028"),a("\u2029"),a(""),a(""),a(""),a("\ufeff")];function d(){}return d.prototype.visitChildren=function(e){for(var t in e){var r=e[t];e.hasOwnProperty(t)&&(void 0!==r.type?this.visit(r):Array.isArray(r)&&r.forEach(function(e){this.visit(e)},this))}},d.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)},d.prototype.visitPattern=function(e){},d.prototype.visitFlags=function(e){},d.prototype.visitDisjunction=function(e){},d.prototype.visitAlternative=function(e){},d.prototype.visitStartAnchor=function(e){},d.prototype.visitEndAnchor=function(e){},d.prototype.visitWordBoundary=function(e){},d.prototype.visitNonWordBoundary=function(e){},d.prototype.visitLookahead=function(e){},d.prototype.visitNegativeLookahead=function(e){},d.prototype.visitCharacter=function(e){},d.prototype.visitSet=function(e){},d.prototype.visitGroup=function(e){},d.prototype.visitGroupBackReference=function(e){},d.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:d,VERSION:"0.4.0"}})?n.apply(t,i):n)||(e.exports=a)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->"+e.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(e,t,r,n,i){return"unexpected character: ->"+e.charAt(t)+"<- at offset: "+t+", skipped "+r+" characters."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),a=r(8);function o(e){if(e instanceof i.NonTerminal)return o(e.referencedRule);if(e instanceof i.Terminal)return c(e);if(a.isSequenceProd(e))return s(e);if(a.isBranchingProd(e))return l(e);throw Error("non exhaustive match")}function s(e){for(var t,r=[],i=e.definition,s=0,l=i.length>s,c=!0;l&&c;)t=i[s],c=a.isOptionalProd(t),r=r.concat(o(t)),s+=1,l=i.length>s;return n.uniq(r)}function l(e){var t=n.map(e.definition,function(e){return o(e)});return n.uniq(n.flatten(t))}function c(e){return[e.terminalType]}t.first=o,t.firstForSequence=s,t.firstForBranching=l,t.firstForTerminal=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IN="_~IN~_"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(29),a=r(0),o=r(1);!function(e){e[e.OPTION=0]="OPTION",e[e.OR=1]="OR",e[e.MANY=2]="MANY",e[e.MANY_SEP=3]="MANY_SEP",e[e.AT_LEAST_ONE=4]="AT_LEAST_ONE",e[e.AT_LEAST_ONE_SEP=5]="AT_LEAST_ONE_SEP",e[e.REF=6]="REF",e[e.TERMINAL=7]="TERMINAL",e[e.FLAT=8]="FLAT"}(n=t.ProdType||(t.ProdType={}));var s=/(?:\s*{\s*NAME\s*:\s*["'`]([\w$]*)["'`])?/,l=new RegExp(s.source.replace("{","").replace(")?","\\s*,)?")),c=/\.\s*CONSUME(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,u=new RegExp(c.source,"g"),h=/\.\s*SUBRULE(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,d=new RegExp(h.source,"g"),p=/\.\s*OPTION(\d+)?\s*\(/,f=new RegExp(p.source+s.source),m=new RegExp(p.source,"g"),v=/\.\s*MANY(\d+)?\s*\(/,g=new RegExp(v.source+s.source),y=new RegExp(v.source,"g"),E=/\s*SEP\s*:\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,x=new RegExp(/\.\s*MANY_SEP(\d+)?\s*\(\s*{/.source+l.source+E.source),b=new RegExp(x.source,"g"),T=new RegExp(/\.\s*AT_LEAST_ONE_SEP(\d+)?\s*\(\s*{/.source+l.source+E.source),w=new RegExp(T.source,"g"),_=/\.\s*AT_LEAST_ONE(\d+)?\s*\(/,R=new RegExp(_.source+s.source),M=new RegExp(_.source,"g"),S=/\.\s*OR(\d+)?\s*\(/,A=new RegExp(S.source+s.source),P=new RegExp(S.source,"g"),L=new RegExp(l.source+/\s*(ALT)\s*:/.source),C=new RegExp(L.source,"g");function H(e,r,i){switch(e.type){case n.AT_LEAST_ONE:return function(e,t,r){return I(R,new o.RepetitionMandatory({definition:[]}),e,t,r)}(e,r,i);case n.AT_LEAST_ONE_SEP:return function(e,t,r){return k(e,t,o.RepetitionMandatoryWithSeparator,T,r)}(e,r,i);case n.MANY_SEP:return function(e,t,r){return k(e,t,o.RepetitionWithSeparator,x,r)}(e,r,i);case n.MANY:return function(e,t,r){return I(g,new o.Repetition({definition:[]}),e,t,r)}(e,r,i);case n.OPTION:return function(e,t,r){return I(f,new o.Option({definition:[]}),e,t,r)}(e,r,i);case n.OR:return function(e,t,r){return I(A,new o.Alternation({definition:[]}),e,t,r)}(e,r,i);case n.FLAT:return function(e,t,r){var n=new o.Flat({definition:[]}),i=L.exec(e.text)[1];return a.isUndefined(i)||(n.name=i),O(n,e.range,t,r)}(e,r,i);case n.REF:return function(e){var t=h.exec(e.text),r=void 0===t[1]?0:parseInt(t[1],10),n=t[2];return new o.NonTerminal({nonTerminalName:n,idx:r})}(e);case n.TERMINAL:return function(e,r){var n=c.exec(e.text),i=void 0===n[1]?0:parseInt(n[1],10),a=n[2],s=t.terminalNameToConstructor[a];if(!s)throw Error("Terminal Token name: <"+a+"> not found in rule: <"+r+">  \n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#TERMINAL_NAME_NOT_FOUND\n\tFor Further details.");return new o.Terminal({terminalType:s,idx:i})}(e,i);default:throw Error("non exhaustive match")}}function I(e,t,r,n,i){var o=e.exec(r.text),s=void 0===o[1];t.idx=s?0:parseInt(o[1],10);var l=o[2];return a.isUndefined(l)||(t.name=l),O(t,r.range,n,i)}function k(e,r,n,i,o){var s=i.exec(e.text),l=void 0===s[1]?0:parseInt(s[1],10),c=s[3],u=t.terminalNameToConstructor[c];if(!u)throw Error("Separator Terminal Token name: "+c+" not found");var h=new n({definition:[],separator:u,idx:l}),d=s[2];return a.isUndefined(d)||(h.name=d),O(h,e.range,r,o)}function O(e,t,r,n){var i=N(t,r),o=a.sortBy(i,function(e){return e.range.start}),s=[];return a.forEach(o,function(e){s.push(H(e,r,n))}),e.definition=s,e}function N(e,t){return a.filter(t,function(r){var n=e.strictlyContainsRange(r.range),i=a.every(t,function(t){var n=t.range.strictlyContainsRange(r.range),i=t.range.isStrictlyContainedInRange(e);return!(n&&i)});return n&&i})}t.terminalNameToConstructor={},t.buildTopProduction=function(e,r,n){t.terminalNameToConstructor=n;var a=j(V(B("  "+e)));return function(e,t,r,n){return O(new o.Rule({name:e,definition:[],orgText:n}),t,r,e)}(r,new i.Range(0,e.length+2),a,e)},t.buildProdGast=H,t.getDirectlyContainedRanges=N;var F=/\/\/.*/g,D=/\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\//g,z=/(NAME\s*:\s*)?"([^\\"]|\\([bfnrtv"\\\/]|u[0-9a-fA-F]{4}))*"/g,U=/(NAME\s*:\s*)?'([^\\']|\\([bfnrtv'\\\/]|u[0-9a-fA-F]{4}))*'/g;function B(e){return e.replace(F,"").replace(D,"")}function G(e,t){return void 0!==t?e:""}function V(e){return e.replace(z,G).replace(U,G)}function j(e){var t=W(e),r=X(e),n=Y(e),i=q(e),a=Q(e),o=Z(e),s=K(e),l=J(e);return[].concat(t,r,n,i,a,o,s,l)}function W(e){return re(e,n.TERMINAL,u)}function X(e){return re(e,n.REF,d)}function Y(e){return ne(e,n.AT_LEAST_ONE,M)}function q(e){return ne(e,n.AT_LEAST_ONE_SEP,w)}function Q(e){return ne(e,n.MANY,y)}function Z(e){return ne(e,n.MANY_SEP,b)}function K(e){return ne(e,n.OPTION,m)}function J(e){var t=ne(e,n.OR,P),r=te(t);return t.concat(r)}t.removeComments=B,t.removeStringLiterals=V,t.createRanges=j,t.createTerminalRanges=W,t.createRefsRanges=X,t.createAtLeastOneRanges=Y,t.createAtLeastOneSepRanges=q,t.createManyRanges=Q,t.createManySepRanges=Z,t.createOptionRanges=K,t.createOrRanges=J;var $=a.partial(ae,"{","}"),ee=a.partial(ae,"(",")");function te(e){var t=[];return a.forEach(e,function(e){var r=ie(e.text,n.FLAT,C,$),i=e.range.start;a.forEach(r,function(e){e.range.start+=i,e.range.end+=i}),t=t.concat(r)}),a.uniq(t,function(e){return e.type+"~"+e.range.start+"~"+e.range.end+"~"+e.text})}function re(e,t,r){for(var n,a=[];n=r.exec(e);){var o=n.index,s=r.lastIndex,l=new i.Range(o,s),c=n[0];a.push({range:l,text:c,type:t})}return a}function ne(e,t,r){return ie(e,t,r,ee)}function ie(e,t,r,n){for(var a,o=[];a=r.exec(e);){var s=a.index,l=n(s+a[0].length,e),c=new i.Range(s,l),u=e.substr(s,l-s+1);o.push({range:c,text:u,type:t})}return o}function ae(e,t,r,n){for(var i=[1],o=-1;!a.isEmpty(i)&&o+r<n.length;){o++;var s=n.charAt(r+o);s===e?i.push(1):s===t&&i.pop()}if(a.isEmpty(i))return o+r;throw new Error("INVALID INPUT TEXT, UNTERMINATED PARENTHESIS")}function oe(e,t){return a.map(e,function(e){return se(e,t)})}function se(e,t){switch(e.type){case"NonTerminal":return new o.NonTerminal({nonTerminalName:e.name,idx:e.idx});case"Flat":return new o.Flat({name:e.name,definition:oe(e.definition,t)});case"Option":return new o.Option({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatory":return new o.RepetitionMandatory({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"RepetitionMandatoryWithSeparator":return new o.RepetitionMandatoryWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"RepetitionWithSeparator":return new o.RepetitionWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:oe(e.definition,t)});case"Repetition":return new o.Repetition({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Alternation":return new o.Alternation({name:e.name,idx:e.idx,definition:oe(e.definition,t)});case"Terminal":return new o.Terminal({terminalType:t[e.name],idx:e.idx});case"Rule":return new o.Rule({name:e.name,orgText:e.orgText,definition:oe(e.definition,t)})}}t.createOrPartRanges=te,t.findClosingOffset=ae,t.deserializeGrammar=oe,t.deserializeProduction=se},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(4),a=r(30),o=r(11),s=r(10),l=r(8);t.resolveGrammar=function(e){e=n.defaults(e,{errMsgProvider:s.defaultGrammarResolverErrorProvider});var t=new i.HashTable;return n.forEach(e.rules,function(e){t.put(e.name,e)}),a.resolveGrammar(t,e.errMsgProvider)},t.validateGrammar=function(e){return e=n.defaults(e,{errMsgProvider:s.defaultGrammarValidatorErrorProvider,ignoredIssues:{}}),o.validateGrammar(e.rules,e.maxLookahead,e.tokenTypes,e.ignoredIssues,e.errMsgProvider,e.grammarName)},t.assignOccurrenceIndices=function(e){n.forEach(e.rules,function(e){var t=new l.DslMethodsCollectorVisitor;e.accept(t),n.forEach(t.dslMethods,function(e){n.forEach(e,function(e,t){e.idx=t+1})})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),a=r(6),o=r(22),s=r(4),l=r(3);function c(e){this.name=t.IN_RULE_RECOVERY_EXCEPTION,this.message=e}t.EOF_FOLLOW_KEY={},t.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",t.InRuleRecoveryException=c,c.prototype=Error.prototype;var u=function(){function e(){}return e.prototype.initRecoverable=function(e){this.firstAfterRepMap=new s.HashTable,this.resyncFollows=new s.HashTable,this.recoveryEnabled=i.has(e,"recoveryEnabled")?e.recoveryEnabled:l.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=h)},e.prototype.getTokenToInsert=function(e){var t=n.createTokenInstance(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t},e.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},e.prototype.tryInRepetitionRecovery=function(e,t,r,n){for(var o=this,s=this.findReSyncTokenType(),l=this.exportLexerState(),c=[],u=!1,h=this.LA(1),d=this.LA(1),p=function(){var e=o.LA(0),t=o.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:h,previous:e,ruleName:o.getCurrRuleFullName()}),r=new a.MismatchedTokenException(t,h,o.LA(0));r.resyncedTokens=i.dropRight(c),o.SAVE_ERROR(r)};!u;){if(this.tokenMatcher(d,n))return void p();if(r.call(this))return p(),void e.apply(this,t);this.tokenMatcher(d,s)?u=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,c))}this.importLexerState(l)},e.prototype.shouldInRepetitionRecoveryBeTried=function(e,t){return void 0!==e&&void 0!==t&&!this.tokenMatcher(this.LA(1),e)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t))},e.prototype.getFollowsForInRuleRecovery=function(e,t){var r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)},e.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new c("sad sad panda")},e.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},e.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e))return!1;if(i.isEmpty(t))return!1;var n=this.LA(1);return void 0!==i.find(t,function(e){return r.tokenMatcher(n,e)})},e.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},e.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return i.contains(r,e)},e.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var n=t.tokenType;if(i.contains(e,n))return n;t=this.LA(r),r++}},e.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return t.EOF_FOLLOW_KEY;var e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}},e.prototype.buildFullFollowKeyStack=function(){var e=this,r=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(r=i.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.RULE_STACK[t]}),n=i.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.RULE_OCCURRENCE_STACK[t]})),i.map(r,function(i,a){return 0===a?t.EOF_FOLLOW_KEY:{ruleName:e.shortRuleNameToFullName(i),idxInCallingRule:n[a],inRule:e.shortRuleNameToFullName(r[a-1])}})},e.prototype.flattenFollowSet=function(){var e=this,t=i.map(this.buildFullFollowKeyStack(),function(t){return e.getFollowSetFromFollowKey(t)});return i.flatten(t)},e.prototype.getFollowSetFromFollowKey=function(e){if(e===t.EOF_FOLLOW_KEY)return[n.EOF];var r=e.ruleName+e.idxInCallingRule+o.IN+e.inRule;return this.resyncFollows.get(r)},e.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,n.EOF)||t.push(e),t},e.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);!1===this.tokenMatcher(r,e);)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return i.dropRight(t)},e.prototype.attemptInRepetitionRecovery=function(e,t,r,n,i,a){},e.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},e.prototype.getHumanReadableRuleStack=function(){var e=this;return i.isEmpty(this.LAST_EXPLICIT_RULE_STACK)?i.map(this.RULE_STACK,function(t){return e.shortRuleNameToFullName(t)}):i.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])})},e}();function h(e,t,r,i,a,o){var s=this.getKeyForAutomaticLookahead(i,a),l=this.firstAfterRepMap.get(s);if(void 0===l){var c=this.getCurrRuleFullName();l=new o(this.getGAstProductions().get(c),a).startWalking(),this.firstAfterRepMap.put(s,l)}var u=l.token,h=l.occurrence,d=l.isEndOfRule;1===this.RULE_STACK.length&&d&&void 0===u&&(u=n.EOF,h=1),this.shouldInRepetitionRecoveryBeTried(u,h)&&this.tryInRepetitionRecovery(e,t,r,u)}t.Recoverable=u,t.attemptInRepetitionRecovery=h},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(14),o=r(4),s=r(21),l=r(0),c=r(22),u=r(2),h=r(1),d=function(e){function t(t){var r=e.call(this)||this;return r.topProd=t,r.follows=new o.HashTable,r}return i(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},t.prototype.walkTerminal=function(e,t,r){},t.prototype.walkProdRef=function(e,t,r){var n=p(e.referencedRule,e.idx)+this.topProd.name,i=t.concat(r),a=new h.Flat({definition:i}),o=s.first(a);this.follows.put(n,o)},t}(a.RestWalker);function p(e,t){return e.name+t+c.IN}t.ResyncFollowsWalker=d,t.computeAllProdsFollows=function(e){var t=new o.HashTable;return l.forEach(e,function(e){var r=new d(e).startWalking();t.putAll(r)}),t},t.buildBetweenProdsFollowPrefix=p,t.buildInProdFollowPrefix=function(e){return u.tokenName(e.terminalType)+e.idx+c.IN}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(2),s=r(15),l=r(0),c=r(28),u=new a.RegExpParser,h="PATTERN";function d(e){var t=l.filter(e,function(e){return!l.has(e,h)});return{errors:l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- missing static 'PATTERN' property",type:s.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}}),valid:l.difference(e,t)}}function p(e){var t=l.filter(e,function(e){var t=e[h];return!(l.isRegExp(t)||l.isFunction(t)||l.has(t,"exec")||l.isString(t))});return{errors:l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:s.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}}),valid:l.difference(e,t)}}t.DEFAULT_MODE="defaultMode",t.MODES="modes",t.SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky,t.disableSticky=function(){t.SUPPORT_STICKY=!1},t.enableSticky=function(){t.SUPPORT_STICKY=!0},t.analyzeTokenTypes=function(e,r){r=l.defaults(r,{useSticky:t.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"]});var n=l.reject(e,function(e){return e[h]===s.Lexer.NA}),i=!1,a=l.map(n,function(e){var t=e[h];if(l.isRegExp(t)){var n=t.source;return 1===n.length&&"^"!==n&&"$"!==n&&"."!==n?n:2!==n.length||"\\"!==n[0]||l.contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],n[1])?r.useSticky?R(t):_(t):n[1]}if(l.isFunction(t))return i=!0,{exec:t};if(l.has(t,"exec"))return i=!0,t;if("string"==typeof t){if(1===t.length)return t;var a=t.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),o=new RegExp(a);return r.useSticky?R(o):_(o)}throw Error("non exhaustive match")}),u=l.map(n,function(e){return e.tokenTypeIdx}),d=l.map(n,function(e){var t=e.GROUP;if(t!==s.Lexer.SKIPPED){if(l.isString(t))return t;if(l.isUndefined(t))return!1;throw Error("non exhaustive match")}}),p=l.map(n,function(e){var t=e.LONGER_ALT;if(t)return l.indexOf(n,t)}),f=l.map(n,function(e){return e.PUSH_MODE}),m=l.map(n,function(e){return l.has(e,"POP_MODE")}),v=L(r.lineTerminatorCharacters),g=l.map(n,function(e){return!1});"onlyOffset"!==r.positionTracking&&(g=l.map(n,function(e){return l.has(e,"LINE_BREAKS")?e.LINE_BREAKS:!1===A(e,v)?c.canMatchCharCode(v,e.PATTERN):void 0}));var y=l.map(n,M),E=l.map(a,S),x=l.reduce(n,function(e,t){var r=t.GROUP;return l.isString(r)&&r!==s.Lexer.SKIPPED&&(e[r]=[]),e},{}),b=l.map(a,function(e,t){return{pattern:a[t],longerAlt:p[t],canLineTerminator:g[t],isCustom:y[t],short:E[t],group:d[t],push:f[t],pop:m[t],tokenTypeIdx:u[t],tokenType:n[t]}});function T(e,t,r){void 0===e[t]&&(e[t]=[]),e[t].push(r)}var w=!0,P=[];return r.safeMode||(P=l.reduce(n,function(e,t,n){if("string"==typeof t.PATTERN){var i=t.PATTERN.charCodeAt(0);T(e,i,b[n])}else if(l.isArray(t.START_CHARS_HINT))l.forEach(t.START_CHARS_HINT,function(t){var r="string"==typeof t?t.charCodeAt(0):t;T(e,r,b[n])});else if(l.isRegExp(t.PATTERN))if(t.PATTERN.unicode)w=!1,r.ensureOptimizations&&l.PRINT_ERROR(c.failedOptimizationPrefixMsg+"\tUnable to analyze < "+t.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var a=c.getStartCodes(t.PATTERN,r.ensureOptimizations);l.isEmpty(a)&&(w=!1),l.forEach(a,function(t){T(e,t,b[n])})}else r.ensureOptimizations&&l.PRINT_ERROR(c.failedOptimizationPrefixMsg+"\tTokenType: <"+o.tokenName(t)+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),w=!1;return e},[])),w&&P.length<65536&&(P=l.packArray(P)),{emptyGroups:x,patternIdxToConfig:b,charCodeToPatternIdxToConfig:P,hasCustom:i,canBeOptimized:w}},t.validatePatterns=function(e,t){var r=[],n=d(e);r=r.concat(n.errors);var i=p(n.valid),a=i.valid;return r=(r=(r=(r=(r=r.concat(i.errors)).concat(function(e){var t=[],r=l.filter(e,function(e){return l.isRegExp(e[h])});return t=(t=(t=(t=(t=t.concat(m(r))).concat(y(r))).concat(E(r))).concat(x(r))).concat(v(r))}(a))).concat(b(a))).concat(T(a,t))).concat(w(a))},t.findMissingPatterns=d,t.findInvalidPatterns=p;var f=/[^\\][\$]/;function m(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitEndAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=l.filter(e,function(e){var r=e[h];try{var n=u.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return f.test(r.source)}});return l.map(r,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}})}function v(e){var t=l.filter(e,function(e){return e[h].test("")});return l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' must not match an empty string",type:s.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}})}t.findEndOfInputAnchor=m,t.findEmptyMatchRegExps=v;var g=/[^\\[][\^]|^\^/;function y(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return i(t,e),t.prototype.visitStartAnchor=function(e){this.found=!0},t}(a.BaseRegExpVisitor),r=l.filter(e,function(e){var r=e[h];try{var n=u.pattern(r.toString()),i=new t;return i.visit(n),i.found}catch(e){return g.test(r.source)}});return l.map(r,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+o.tokenName(e)+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:s.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}})}function E(e){var t=l.filter(e,function(e){var t=e[h];return t instanceof RegExp&&(t.multiline||t.global)});return l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:s.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}})}function x(e){var t=[],r=l.map(e,function(r){return l.reduce(e,function(e,n){return r.PATTERN.source!==n.PATTERN.source||l.contains(t,n)||n.PATTERN===s.Lexer.NA?e:(t.push(n),e.push(n),e)},[])});r=l.compact(r);var n=l.filter(r,function(e){return e.length>1});return l.map(n,function(e){var t=l.map(e,function(e){return o.tokenName(e)});return{message:"The same RegExp pattern ->"+l.first(e).PATTERN+"<-has been used in all of the following Token Types: "+t.join(", ")+" <-",type:s.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}})}function b(e){var t=l.filter(e,function(e){if(!l.has(e,"GROUP"))return!1;var t=e.GROUP;return t!==s.Lexer.SKIPPED&&t!==s.Lexer.NA&&!l.isString(t)});return l.map(t,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:s.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}})}function T(e,t){var r=l.filter(e,function(e){return void 0!==e.PUSH_MODE&&!l.contains(t,e.PUSH_MODE)});return l.map(r,function(e){return{message:"Token Type: ->"+o.tokenName(e)+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+e.PUSH_MODE+"<-which does not exist",type:s.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}})}function w(e){var t=[],r=l.reduce(e,function(e,t,r){var n,i=t.PATTERN;return i===s.Lexer.NA?e:(l.isString(i)?e.push({str:i,idx:r,tokenType:t}):l.isRegExp(i)&&(n=i,void 0===l.find([".","\\","[","]","|","^","$","(",")","?","*","+","{"],function(e){return-1!==n.source.indexOf(e)}))&&e.push({str:i.source,idx:r,tokenType:t}),e)},[]);return l.forEach(e,function(e,n){l.forEach(r,function(r){var i=r.str,a=r.idx,c=r.tokenType;if(n<a&&function(e,t){if(l.isRegExp(t)){var r=t.exec(e);return null!==r&&0===r.index}if(l.isFunction(t))return t(e,0,[],{});if(l.has(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}(i,e.PATTERN)){var u="Token: ->"+o.tokenName(c)+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+o.tokenName(e)+"<-in the lexer's definition.\nSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE";t.push({message:u,type:s.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,c]})}})}),t}function _(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:"+e.source+")",t)}function R(e){var t=e.ignoreCase?"iy":"y";return new RegExp(""+e.source,t)}function M(e){var t=e.PATTERN;if(l.isRegExp(t))return!1;if(l.isFunction(t))return!0;if(l.has(t,"exec"))return!0;if(l.isString(t))return!1;throw Error("non exhaustive match")}function S(e){return!(!l.isString(e)||1!==e.length)&&e.charCodeAt(0)}function A(e,t){if(l.has(e,"LINE_BREAKS"))return!1;if(l.isRegExp(e.PATTERN)){try{c.canMatchCharCode(t,e.PATTERN)}catch(e){return{issue:s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}if(l.isString(e.PATTERN))return!1;if(M(e))return{issue:s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function P(e,t){if(t.issue===s.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+e.name+"> Token Type\n\t Root cause: "+t.errMsg+".\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===s.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+e.name+"> Token Type\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function L(e){return l.map(e,function(e){return l.isString(e)&&e.length>0?e.charCodeAt(0):e})}t.findStartOfInputAnchor=y,t.findUnsupportedFlags=E,t.findDuplicatePatterns=x,t.findInvalidGroupType=b,t.findModesThatDoNotExist=T,t.findUnreachablePatterns=w,t.addStartOfInput=_,t.addStickyFlag=R,t.performRuntimeChecks=function(e,r,n){var i=[];return l.has(e,t.DEFAULT_MODE)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.DEFAULT_MODE+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),l.has(e,t.MODES)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+t.MODES+"> property in its definition\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),l.has(e,t.MODES)&&l.has(e,t.DEFAULT_MODE)&&!l.has(e.modes,e.defaultMode)&&i.push({message:"A MultiMode Lexer cannot be initialized with a "+t.DEFAULT_MODE+": <"+e.defaultMode+">which does not exist\n",type:s.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),l.has(e,t.MODES)&&l.forEach(e.modes,function(e,t){l.forEach(e,function(e,r){l.isUndefined(e)&&i.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+t+"> at index: <"+r+">\n",type:s.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),i},t.performWarningRuntimeChecks=function(e,t,r){var n=[],i=!1,a=l.compact(l.flatten(l.mapValues(e.modes,function(e){return e}))),o=l.reject(a,function(e){return e[h]===s.Lexer.NA}),u=L(r);return t&&l.forEach(o,function(e){var t=A(e,u);if(!1!==t){var r={message:P(e,t),type:t.issue,tokenType:e};n.push(r)}else l.has(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(i=!0):c.canMatchCharCode(u,e.PATTERN)&&(i=!0)}),t&&!i&&n.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:s.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),n},t.cloneEmptyGroups=function(e){var t={},r=l.keys(e);return l.forEach(r,function(r){var n=e[r];if(!l.isArray(n))throw Error("non exhaustive match");t[r]=[]}),t},t.isCustomPattern=M,t.isShortPattern=S,t.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,r=this.lastIndex;r<t;r++){var n=e.charCodeAt(r);if(10===n)return this.lastIndex=r+1,!0;if(13===n)return 10===e.charCodeAt(r+1)?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0},t.buildLineBreakIssueMessage=P},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(19),o=r(0),s=new a.RegExpParser,l="Complement Sets are not supported for first char optimization";function c(e){switch(e.type){case"Disjunction":return o.flatten(o.map(e.value,c));case"Alternative":for(var t=[],r=e.value,n=0;n<r.length;n++){var i=r[n];if(!o.contains(["GroupBackReference","Lookahead","NegativeLookahead","StartAnchor","EndAnchor","WordBoundary","NonWordBoundary"],i.type)){var a=i;switch(a.type){case"Character":t.push(a.value);break;case"Set":if(!0===a.complement)throw Error(l);o.forEach(a.value,function(e){if("number"==typeof e)t.push(e);else for(var r=e,n=r.from;n<=r.to;n++)t.push(n)});break;case"Group":var s=c(a.value);o.forEach(s,function(e){return t.push(e)});break;default:throw Error("Non Exhaustive Match")}var u=void 0!==a.quantifier&&0===a.quantifier.atLeast;if("Group"===a.type&&!1===d(a)||"Group"!==a.type&&!1===u)break}}return t;default:throw Error("non exhaustive match!")}}function u(e){var t=[];return o.forEach(e,function(e){t.push(e);var r=String.fromCharCode(e);r.toUpperCase()!==r?t.push(r.toUpperCase().charCodeAt(0)):r.toLowerCase()!==r&&t.push(r.toLowerCase().charCodeAt(0))}),t}function h(e,t){return o.find(e.value,function(e){if("number"==typeof e)return o.contains(t,e);var r=e;return void 0!==o.find(t,function(e){return r.from<=e&&e<=r.to})})}function d(e){return!(!e.quantifier||0!==e.quantifier.atLeast)||!!e.value&&(o.isArray(e.value)?o.every(e.value,d):d(e.value))}t.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',t.getStartCodes=function(e,r){void 0===r&&(r=!1);try{var n=s.pattern(e.toString()),i=c(n.value);return n.flags.ignoreCase&&(i=u(i)),i}catch(n){if(n.message===l)r&&o.PRINT_WARNING(t.failedOptimizationPrefixMsg+"\tUnable to optimize: < "+e.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var h="";r&&(h="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),o.PRINT_ERROR(t.failedOptimizationPrefixMsg+"\n\tFailed parsing: < "+e.toString()+" >\n\tUsing the regexp-to-ast library version: "+a.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+h)}}return[]},t.firstChar=c,t.applyIgnoreCase=u;var p=function(e){function t(t){var r=e.call(this)||this;return r.targetCharCodes=t,r.found=!1,r}return i(t,e),t.prototype.visitChildren=function(t){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}e.prototype.visitChildren.call(this,t)},t.prototype.visitCharacter=function(e){o.contains(this.targetCharCodes,e.value)&&(this.found=!0)},t.prototype.visitSet=function(e){e.complement?void 0===h(e,this.targetCharCodes)&&(this.found=!0):void 0!==h(e,this.targetCharCodes)&&(this.found=!0)},t}(a.BaseRegExpVisitor);t.canMatchCharCode=function(e,t){if(t instanceof RegExp){var r=s.pattern(t.toString()),n=new p(e);return n.visit(r),n.found}return void 0!==o.find(t,function(t){return o.contains(e,t.charCodeAt(0))})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){if(this.start=e,this.end=t,!i(e,t))throw new Error("INVALID RANGE")}return e.prototype.contains=function(e){return this.start<=e&&this.end>=e},e.prototype.containsRange=function(e){return this.start<=e.start&&this.end>=e.end},e.prototype.isContainedInRange=function(e){return e.containsRange(this)},e.prototype.strictlyContainsRange=function(e){return this.start<e.start&&this.end>e.end},e.prototype.isStrictlyContainedInRange=function(e){return e.strictlyContainsRange(this)},e}();function i(e,t){return!(e<0||t<e)}t.Range=n,t.isValidRange=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var a=r(3),o=r(0),s=r(5);t.resolveGrammar=function(e,t){var r=new l(e,t);return r.resolveRefs(),r.errors};var l=function(e){function t(t,r){var n=e.call(this)||this;return n.nameToTopRule=t,n.errMsgProvider=r,n.errors=[],n}return i(t,e),t.prototype.resolveRefs=function(){var e=this;o.forEach(this.nameToTopRule.values(),function(t){e.currTopLevel=t,t.accept(e)})},t.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule.get(e.nonTerminalName);if(t)e.referencedRule=t;else{var r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:a.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},t}(s.GAstVisitor);t.GastRefResolverVisitor=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(0),a=r(3),o=r(9),s=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=i.has(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:a.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=i.has(e,"maxLookahead")?e.maxLookahead:a.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=i.isES2015MapSupported()?new Map:[],i.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.lookAheadBuilderForOptional=function(e,t,r){return n.buildSingleAlternativeLookaheadFunction(e,t,r)},e.prototype.lookAheadBuilderForAlternatives=function(e,t,r,i){return n.buildAlternativesLookAheadFunc(e,t,r,i)},e.prototype.getKeyForAutomaticLookahead=function(e,t){var r=this.getLastExplicitRuleShortName();return o.getKeyForAutomaticLookahead(r,e,t)},e.prototype.getLookaheadFuncForOr=function(e,t){var r=this.getKeyForAutomaticLookahead(o.OR_IDX,e),a=this.getLaFuncFromCache(r);if(void 0===a){var s=this.getCurrRuleFullName(),l=this.getGAstProductions().get(s),c=i.some(t,function(e){return i.isFunction(e.GATE)});return a=n.buildLookaheadFuncForOr(e,l,this.maxLookahead,c,this.dynamicTokensEnabled,this.lookAheadBuilderForAlternatives),this.setLaFuncCache(r,a),a}return a},e.prototype.getLookaheadFuncForOption=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.OPTION)},e.prototype.getLookaheadFuncForMany=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION)},e.prototype.getLookaheadFuncForManySep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_WITH_SEPARATOR)},e.prototype.getLookaheadFuncForAtLeastOne=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY)},e.prototype.getLookaheadFuncForAtLeastOneSep=function(e,t){return this.getLookaheadFuncFor(e,t,this.maxLookahead,n.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.getLookaheadFuncFor=function(e,t,r,i){var a=this.getLaFuncFromCache(e);if(void 0===a){var o=this.getCurrRuleFullName(),s=this.getGAstProductions().get(o);return a=n.buildLookaheadFuncForOptionalProd(t,s,r,this.dynamicTokensEnabled,i,this.lookAheadBuilderForOptional),this.setLaFuncCache(e,a),a}return a},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}();t.LooksAhead=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(16),i=r(0),a=r(33),o=r(9),s=r(3),l=function(){function e(){}return e.prototype.initTreeBuilder=function(e){this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=i.has(e,"outputCst")?e.outputCst:s.DEFAULT_PARSER_CONFIG.outputCst,this.outputCst||(this.cstInvocationStateUpdate=i.NOOP,this.cstFinallyStateUpdate=i.NOOP,this.cstPostTerminal=i.NOOP,this.cstPostNonTerminal=i.NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst)},e.prototype.cstNestedInvocationStateUpdate=function(e,t){this.CST_STACK.push({name:e,fullName:this.shortRuleNameToFull.get(this.getLastExplicitRuleShortName())+e,children:{}})},e.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1),this.CST_STACK.push({name:e,children:{}})},e.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},e.prototype.cstNestedFinallyStateUpdate=function(){this.CST_STACK.pop()},e.prototype.cstPostTerminal=function(e,t){var r=this.CST_STACK[this.CST_STACK.length-1];n.addTerminalToCst(r,t,e)},e.prototype.cstPostNonTerminal=function(e,t){n.addNoneTerminalToCst(this.CST_STACK[this.CST_STACK.length-1],t,e)},e.prototype.getBaseCstVisitorConstructor=function(){if(i.isUndefined(this.baseCstVisitorConstructor)){var e=a.createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(i.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var e=a.createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.nestedRuleBeforeClause=function(e,t){var r;return void 0!==e.NAME?(r=e.NAME,this.nestedRuleInvocationStateUpdate(r,t),r):void 0},e.prototype.nestedAltBeforeClause=function(e,t,r,n){var i,a=this.getLastExplicitRuleShortName(),s=o.getKeyForAltIndex(a,r,t,n);return void 0!==e.NAME?(i=e.NAME,this.nestedRuleInvocationStateUpdate(i,s),{shortName:s,nestedName:i}):void 0},e.prototype.nestedRuleFinallyClause=function(e,t){var r=this.CST_STACK,i=r[r.length-1];this.nestedRuleFinallyStateUpdate();var a=r[r.length-1];n.addNoneTerminalToCst(a,t,i)},e.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},e.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},e.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},e.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},e.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},e}();t.TreeBuilder=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(0),a=r(4),o=r(11);function s(e,t){for(var r=i.keys(e),n=r.length,a=0;a<n;a++)for(var o=e[r[a]],s=o.length,l=0;l<s;l++){var c=o[l];void 0===c.tokenTypeIdx&&(void 0!==c.fullName?this[c.fullName](c.children,t):this[c.name](c.children,t))}}function l(e,t){var r=c(e,t),n=h(e,t);return r.concat(n)}function c(e,t){var r=i.map(t,function(t){if(!i.isFunction(e[t]))return{msg:"Missing visitor method: <"+t+"> on "+a.functionName(e.constructor)+" CST Visitor.",type:n.MISSING_METHOD,methodName:t}});return i.compact(r)}t.defaultVisit=s,t.createBaseSemanticVisitorConstructor=function(e,t){var r=function(){};return a.defineNameProp(r,e+"BaseSemantics"),(r.prototype={visit:function(e,t){if(i.isArray(e)&&(e=e[0]),!i.isUndefined(e))return void 0!==e.fullName?this[e.fullName](e.children,t):this[e.name](e.children,t)},validateVisitor:function(){var e=l(this,t);if(!i.isEmpty(e)){var r=i.map(e,function(e){return e.msg});throw Error("Errors Detected in CST Visitor <"+a.functionName(this.constructor)+">:\n\t"+r.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=r,r._RULE_NAMES=t,r},t.createBaseVisitorConstructorWithDefaults=function(e,t,r){var n=function(){};a.defineNameProp(n,e+"BaseSemanticsWithDefaults");var o=Object.create(r.prototype);return i.forEach(t,function(e){o[e]=s}),(n.prototype=o).constructor=n,n},function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"}(n=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={})),t.validateVisitor=l,t.validateMissingCstMethods=c;var u=["constructor","visit","validateVisitor"];function h(e,t){var r=[];for(var s in e)o.validTermsPattern.test(s)&&i.isFunction(e[s])&&!i.contains(u,s)&&!i.contains(t,s)&&r.push({msg:"Redundant visitor method: <"+s+"> on "+a.functionName(e.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\nFor utility methods on visitor classes use methods names that do not match /"+o.validTermsPattern.source+"/.",type:n.REDUNDANT_METHOD,methodName:s});return r}t.validateRedundantMethods=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,"input",{get:function(){return this.tokVector},set:function(e){this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):n.END_OF_FILE},e.prototype.LA=function(e){return this.currIdx+e<0||this.tokVectorLength<=this.currIdx+e?n.END_OF_FILE:this.tokVector[this.currIdx+e]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}();t.LexerAdapter=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(6),a=r(3),o=r(10),s=r(23),l=r(11),c=r(1),u=function(){function e(){}return e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,t,r){if(void 0===r&&(r=a.DEFAULT_RULE_CONFIG),n.contains(this.definedRulesNames,e)){var i={message:o.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:a.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}if(this.definedRulesNames.push(e),!this.gastProductionsCache.containsKey(e)&&!this.serializedGrammar){var l=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,l)}var c=this.defineRule(e,t,r);return this[e]=c,c},e.prototype.OVERRIDE_RULE=function(e,t,r){void 0===r&&(r=a.DEFAULT_RULE_CONFIG);var n=[];if(n=n.concat(l.validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,n),!this.serializedGrammar){var i=s.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,i)}var o=this.defineRule(e,t,r);return this[e]=o,o},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(i.isRecognitionException(e))return!1;throw e}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return c.serializeGrammar(this.gastProductionsCache.values())},e}();t.RecognizerApi=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(9),a=r(6),o=r(12),s=r(13),l=r(3),c=r(25),u=r(2),h=r(7),d=r(4),p=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,t){if(this.className=d.classNameFromInstance(this),this.shortRuleNameToFull=new d.HashTable,this.fullRuleNameToShort=new d.HashTable,this.ruleShortNameIdx=256,this.tokenMatcher=h.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache=new d.HashTable,this.serializedGrammar=n.has(t,"serializedGrammar")?t.serializedGrammar:l.DEFAULT_PARSER_CONFIG.serializedGrammar,n.isArray(e)){if(n.isEmpty(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(n.isArray(e))this.tokensMap=n.reduce(e,function(e,t){return e[u.tokenName(t)]=t,e},{});else if(n.has(e,"modes")&&n.every(n.flatten(n.values(e.modes)),h.isTokenType)){var r=n.flatten(n.values(e.modes)),i=n.uniq(r);this.tokensMap=n.reduce(i,function(e,t){return e[u.tokenName(t)]=t,e},{})}else{if(!n.isObject(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=n.cloneObj(e)}this.tokensMap.EOF=u.EOF;var a=n.every(n.values(e),function(e){return n.isEmpty(e.categoryMatches)});this.tokenMatcher=a?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,h.augmentTokenTypes(n.values(this.tokensMap))},e.prototype.defineRule=function(e,t,r){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var o,s=n.has(r,"resyncEnabled")?r.resyncEnabled:l.DEFAULT_RULE_CONFIG.resyncEnabled,c=n.has(r,"recoveryValueFunc")?r.recoveryValueFunc:l.DEFAULT_RULE_CONFIG.recoveryValueFunc,u=this.ruleShortNameIdx<<i.BITS_FOR_METHOD_IDX+i.BITS_FOR_OCCURRENCE_IDX;return this.ruleShortNameIdx++,this.shortRuleNameToFull.put(u,e),this.fullRuleNameToShort.put(e,u),(o=function(r,n){return void 0===r&&(r=0),this.ruleInvocationStateUpdate(u,e,r),function(e){try{return!0===this.outputCst?(t.apply(this,e),this.CST_STACK[this.CST_STACK.length-1]):t.apply(this,e)}catch(e){var r=1===this.RULE_STACK.length,n=s&&!this.isBackTracking()&&this.recoveryEnabled;if(a.isRecognitionException(e)){if(n){var i,o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))return e.resyncedTokens=this.reSyncTo(o),this.outputCst?((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,i):c();throw this.outputCst&&((i=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,e.partialCstResult=i),e}if(r)return this.moveToTerminatedState(),c();throw e}throw e}finally{this.ruleFinallyStateUpdate()}}.call(this,n)}).ruleName=e,o},e.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t),n=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OPTION_IDX,t);return this.optionInternalLogic(e,t,r)},e.prototype.optionInternalLogic=function(e,t,r){var n,i,a=this,o=this.getLookaheadFuncForOption(r,t);if(void 0!==e.DEF){if(n=e.DEF,void 0!==(i=e.GATE)){var s=o;o=function(){return i.call(a)&&s.call(a)}}}else n=e;if(!0===o.call(this))return n.call(this)},e.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_IDX,e);this.atLeastOneInternalLogic(e,t,r)},e.prototype.atLeastOneInternalLogic=function(e,t,r){var n,a,l=this,c=this.getLookaheadFuncForAtLeastOne(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var u=c;c=function(){return a.call(l)&&u.call(l)}}}else n=t;if(!0!==c.call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var h=this.doSingleRepetition(n);!0===c.call(this)&&!0===h;)h=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],c,i.AT_LEAST_ONE_IDX,e,s.NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,l=t.SEP;if(!0!==this.getLookaheadFuncForAtLeastOneSep(r,e).call(this))throw this.raiseEarlyExitException(e,o.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);a.call(this);for(var c=function(){return n.tokenMatcher(n.LA(1),l)};!0===this.tokenMatcher(this.LA(1),l);)this.CONSUME(l),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,l,c,a,s.NextTerminalAfterAtLeastOneSepWalker],c,i.AT_LEAST_ONE_SEP_IDX,e,s.NextTerminalAfterAtLeastOneSepWalker)},e.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_IDX,e);return this.manyInternalLogic(e,t,r)},e.prototype.manyInternalLogic=function(e,t,r){var n,a,o=this,l=this.getLookaheadFuncForMany(r,e);if(void 0!==t.DEF){if(n=t.DEF,void 0!==(a=t.GATE)){var c=l;l=function(){return a.call(o)&&c.call(o)}}}else n=t;for(var u=!0;!0===l.call(this)&&!0===u;)u=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],l,i.MANY_IDX,e,s.NextTerminalAfterManyWalker)},e.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e),n=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{void 0!==n&&this.nestedRuleFinallyClause(r,n)}},e.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(i.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,r)},e.prototype.manySepFirstInternalLogic=function(e,t,r){var n=this,a=t.DEF,o=t.SEP;if(!0===this.getLookaheadFuncForManySep(r,e).call(this)){a.call(this);for(var l=function(){return n.tokenMatcher(n.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),a.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,l,a,s.NextTerminalAfterManySepWalker],l,i.MANY_SEP_IDX,e,s.NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,r,n,a){for(;r();)this.CONSUME(t),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,n,a],r,i.AT_LEAST_ONE_SEP_IDX,e,a)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternalNoCst=function(e,t){var r=n.isArray(e)?e:e.DEF,i=this.getLookaheadFuncForOr(t,r).call(this,r);if(void 0!==i)return r[i].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},e.prototype.orInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(i.OR_IDX,t),a=this.nestedRuleBeforeClause(e,r);try{var o=n.isArray(e)?e:e.DEF,s=this.getLookaheadFuncForOr(t,o).call(this,o);if(void 0!==s){var l=o[s],c=this.nestedAltBeforeClause(l,t,i.OR_IDX,s);try{return l.ALT.call(this)}finally{void 0!==c&&this.nestedRuleFinallyClause(c.shortName,c.nestedName)}}this.raiseNoAltException(t,e.ERR_MSG)}finally{void 0!==a&&this.nestedRuleFinallyClause(r,a)}},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new a.NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,r){var n;try{var i=void 0!==r?r.ARGS:void 0;return n=e.call(this,t,i),this.cstPostNonTerminal(n,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),n}catch(t){throw a.isRecognitionException(t)&&void 0!==t.partialCstResult&&(this.cstPostNonTerminal(t.partialCstResult,void 0!==r&&void 0!==r.LABEL?r.LABEL:e.ruleName),delete t.partialCstResult),t}},e.prototype.consumeInternal=function(e,t,r){var n;try{var i=this.LA(1);if(!0!==this.tokenMatcher(i,e)){var o=void 0,s=this.LA(0);throw o=void 0!==r&&r.ERR_MSG?r.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:i,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new a.MismatchedTokenException(o,i,s))}this.consumeToken(),n=i}catch(r){if(!this.recoveryEnabled||"MismatchedTokenException"!==r.name||this.isBackTracking())throw r;var l=this.getFollowsForInRuleRecovery(e,t);try{n=this.tryInRuleRecovery(e,l)}catch(e){throw e.name===c.IN_RULE_RECOVERY_EXCEPTION?r:e}}return this.cstPostTerminal(void 0!==r&&void 0!==r.LABEL?r.LABEL:e.tokenName,n),n},e.prototype.saveRecogState=function(){var e=this.errors,t=n.cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return!n.isEmpty(this.isBackTrackingStack)},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull.get(e)},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull.get(e)},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),u.EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}();t.RecognizerEngine=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=r(0),a=r(12),o=r(3),s=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=i.defaults(e.errorMessageProvider,o.DEFAULT_PARSER_CONFIG.errorMessageProvider)},e.prototype.SAVE_ERROR=function(e){if(n.isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:i.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(e.prototype,"errors",{get:function(){return i.cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,t,r){for(var i=this.getCurrRuleFullName(),o=this.getGAstProductions().get(i),s=a.getLookaheadPathsForOptionalProd(e,o,t,this.maxLookahead)[0],l=[],c=1;c<this.maxLookahead;c++)l.push(this.LA(c));var u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:s,actual:l,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new n.EarlyExitException(u,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,t){for(var r=this.getCurrRuleFullName(),i=this.getGAstProductions().get(r),o=a.getLookaheadPathsForOr(e,i,this.maxLookahead),s=[],l=1;l<=this.maxLookahead;l++)s.push(this.LA(l));var c=this.LA(0),u=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:o,actual:s,previous:c,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new n.NoViableAltException(u,this.LA(1),c))},e}();t.ErrorHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(13),i=r(0),a=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,t){var r=this.gastProductionsCache.get(e);if(i.isUndefined(r))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return n.nextPossibleTokensAfter([r],t,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var t=i.first(e.ruleStack),r=this.getGAstProductions().get(t);return new n.NextAfterTokenWalker(r,e).startWalking()},e}();t.ContentAssist=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(17);t.createSyntaxDiagramsCode=function(e,t){var r=void 0===t?{}:t,i=r.resourceBase,a=void 0===i?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/":i,o=r.css;return"\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n\n<link rel='stylesheet' href='"+(void 0===o?"https://unpkg.com/chevrotain@"+n.VERSION+"/diagrams/diagrams.css":o)+"'>\n\n<script src='"+a+"vendor/railroad-diagrams.js'><\/script>\n<script src='"+a+"src/diagrams_builder.js'><\/script>\n<script src='"+a+"src/diagrams_behavior.js'><\/script>\n<script src='"+a+'src/main.js\'><\/script>\n\n<div id="diagrams" align="center"></div>    \n\n<script>\n    window.serializedGrammar = '+JSON.stringify(e,null,"  ")+';\n<\/script>\n\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(41);t.generateParserFactory=function(e){var t=n.genWrapperFunction({name:e.name,rules:e.rules}),i=new Function("tokenVocabulary","config","chevrotain",t);return function(t){return i(e.tokenVocabulary,t,r(18))}},t.generateParserModule=function(e){return n.genUmdModule({name:e.name,rules:e.rules})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),a=r(1),o="\n";function s(e){return"\nfunction "+e.name+"(tokenVocabulary, config) {\n    // invoke super constructor\n    // No support for embedded actions currently, so we can 'hardcode'\n    // The use of CstParser.\n    chevrotain.CstParser.call(this, tokenVocabulary, config)\n\n    const $ = this\n\n    "+l(e.rules)+"\n\n    // very important to call this after all the rules have been defined.\n    // otherwise the parser may not work correctly as it will lack information\n    // derived during the self analysis phase.\n    this.performSelfAnalysis(this)\n}\n\n// inheritance as implemented in javascript in the previous decade... :(\n"+e.name+".prototype = Object.create(chevrotain.CstParser.prototype)\n"+e.name+".prototype.constructor = "+e.name+"    \n    "}function l(e){return n.map(e,function(e){return c(e,1)}).join("\n")}function c(e,t){var r=g(t,'$.RULE("'+e.name+'", function() {')+o;return r+=v(e.definition,t+1),r+=g(t+1,"})")+o}function u(e,t){var r=i.tokenName(e.terminalType);return g(t,"$.CONSUME"+e.idx+"(this.tokensMap."+r+")"+o)}function h(e,t){return g(t,"$.SUBRULE"+e.idx+"($."+e.nonTerminalName+")"+o)}function d(e,t){var r=g(t,"$.OR"+e.idx+"([")+o;return r+=n.map(e.definition,function(e){return p(e,t+1)}).join(","+o),r+=o+g(t,"])"+o)}function p(e,t){var r=g(t,"{")+o;return e.name&&(r+=g(t+1,'NAME: "'+e.name+'",')+o),r+=g(t+1,"ALT: function() {")+o,r+=v(e.definition,t+1),r+=g(t+1,"}")+o,r+=g(t,"}")}function f(e,t,r){var n=g(r,"$."+(e+t.idx)+"(");return t.name||t.separator?(n+="{"+o,t.name&&(n+=g(r+1,'NAME: "'+t.name+'"')+","+o),t.separator&&(n+=g(r+1,"SEP: this.tokensMap."+i.tokenName(t.separator))+","+o),n+="DEF: "+m(t.definition,r+2)+o,n+=g(r,"}")+o):n+=m(t.definition,r+1),n+=g(r,")")+o}function m(e,t){var r="function() {"+o;return r+=v(e,t),r+=g(t,"}")+o}function v(e,t){var r="";return n.forEach(e,function(e){r+=function(e,t){if(e instanceof a.NonTerminal)return h(e,t);if(e instanceof a.Option)return f("OPTION",e,t);if(e instanceof a.RepetitionMandatory)return f("AT_LEAST_ONE",e,t);if(e instanceof a.RepetitionMandatoryWithSeparator)return f("AT_LEAST_ONE_SEP",e,t);if(e instanceof a.RepetitionWithSeparator)return f("MANY_SEP",e,t);if(e instanceof a.Repetition)return f("MANY",e,t);if(e instanceof a.Alternation)return d(e,t);if(e instanceof a.Terminal)return u(e,t);if(e instanceof a.Flat)return v(e.definition,t);throw Error("non exhaustive match")}(e,t+1)}),r}function g(e,t){return Array(4*e+1).join(" ")+t}t.genUmdModule=function(e){return"\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['chevrotain'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('chevrotain'));\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory(root.b);\n    }\n}(typeof self !== 'undefined' ? self : this, function (chevrotain) {\n\n"+s(e)+"\n    \nreturn {\n    "+e.name+": "+e.name+" \n}\n}));\n"},t.genWrapperFunction=function(e){return"    \n"+s(e)+"\nreturn new "+e.name+"(tokenVocabulary, config)    \n"},t.genClass=s,t.genAllRules=l,t.genRule=c,t.genTerminal=u,t.genNonTerminal=h,t.genAlternation=d,t.genSingleAlt=p}])},function(e,t,r){!function(e){"use strict";function t(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners,n=r[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,r=t[e.type];if(void 0!==r){e.target=this;for(var n=r.slice(0),i=0,a=n.length;i<a;i++)n[i].call(this,e)}}}});var r,n,i,a="106",o=0,s=1,l=2,c=1,u=2,h=0,d=1,p=2,f=0,m=1,v=2,g=0,y=1,E=2,x=3,b=4,T=5,w=100,_=101,R=102,M=103,S=104,A=200,P=201,L=202,C=203,H=204,I=205,k=206,O=207,N=208,F=209,D=210,z=0,U=1,B=2,G=3,V=4,j=5,W=6,X=7,Y=0,q=1,Q=2,Z=0,K=1,J=2,$=3,ee=4,te=5,re=301,ne=302,ie=303,ae=304,oe=305,se=306,le=307,ce=1e3,ue=1001,he=1002,de=1003,pe=1004,fe=1005,me=1006,ve=1007,ge=1008,ye=1009,Ee=1010,xe=1011,be=1012,Te=1013,we=1014,_e=1015,Re=1016,Me=1017,Se=1018,Ae=1019,Pe=1020,Le=1021,Ce=1022,He=1023,Ie=1024,ke=1025,Oe=He,Ne=1026,Fe=1027,De=1028,ze=33776,Ue=33777,Be=33778,Ge=33779,Ve=35840,je=35841,We=35842,Xe=35843,Ye=36196,qe=37808,Qe=37809,Ze=37810,Ke=37811,Je=37812,$e=37813,et=37814,tt=37815,rt=37816,nt=37817,it=37818,at=37819,ot=37820,st=37821,lt=2201,ct=2400,ut=0,ht=1,dt=2,pt=3e3,ft=3001,mt=3007,vt=3002,gt=3004,yt=3005,Et=3006,xt=3200,bt=3201,Tt=0,wt=1,_t={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,a=e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255];return a.toUpperCase()}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*_t.DEG2RAD},radToDeg:function(e){return e*_t.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Rt(e,t){this.x=e||0,this.y=t||0}function Mt(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==n?n:1}function St(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function At(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Rt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Rt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*n+e.x,this.y=i*n+a*r+e.y,this}}),Object.assign(Mt,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,i,a,o){var s=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(u!==f||s!==h||l!==d||c!==p){var m=1-o,v=s*h+l*d+c*p+u*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var E=Math.sqrt(y),x=Math.atan2(E,v*g);m=Math.sin(m*x)/E,o=Math.sin(o*x)/E}var b=o*g;if(s=s*m+h*b,l=l*m+d*b,c=c*m+p*b,u=u*m+f*b,m===1-o){var T=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=T,l*=T,c*=T,u*=T}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(Mt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Mt.prototype,{isQuaternion:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z,a=e.order,o=Math.cos,s=Math.sin,l=o(r/2),c=o(n/2),u=o(i/2),h=s(r/2),d=s(n/2),p=s(i/2);return"XYZ"===a?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"YXZ"===a?(this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"ZXY"===a?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p):"ZYX"===a?(this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p):"YZX"===a?(this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p):"XZY"===a&&(this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(u-l)*t,this._y=(a-c)*t,this._z=(o-i)*t):n>s&&n>h?(t=2*Math.sqrt(1+n-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+c)/t):s>h?(t=2*Math.sqrt(1+s-n-h),this._w=(a-c)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-n-s),this._w=(o-i)/t,this._x=(a+c)/t,this._y=(l+u)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=e.dot(t)+1;return r<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(_t.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;var n=Math.min(1,t/r);return this.slerp(e,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=r*c+a*o+n*l-i*s,this._y=n*c+a*s+i*o-r*l,this._z=i*c+a*l+r*s-n*o,this._w=a*c-r*o-n*s-i*l,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,a=this._w,o=a*e._w+r*e._x+n*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=n,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*r+t*this._x,this._y=l*n+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),u=Math.atan2(c,o),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(St.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:(i=new Mt,function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(i.setFromEuler(e))}),applyAxisAngle:function(){var e=new Mt;return function(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements,a=1/(i[3]*t+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*t+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*t+i[6]*r+i[10]*n+i[14])*a,this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*n-o*r,c=s*r+o*t-i*n,u=s*n+i*r-a*t,h=-i*t-a*r-o*n;return this.x=l*s+h*-i+c*-o-u*-a,this.y=c*s+h*-a+u*-i-l*-o,this.z=u*s+h*-o+l*-a-c*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:(n=new St,function(e){return n.copy(this).projectOnVector(e),this.sub(n)}),reflect:function(){var e=new St;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(_t.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(At.prototype,{isMatrix3:!0,set:function(e,t,r,n,i,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=n,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=r,c[7]=a,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new St;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],p=r[8],f=n[0],m=n[3],v=n[6],g=n[1],y=n[4],E=n[7],x=n[2],b=n[5],T=n[8];return i[0]=a*f+o*g+s*x,i[3]=a*m+o*y+s*b,i[6]=a*v+o*E+s*T,i[1]=l*f+c*g+u*x,i[4]=l*m+c*y+u*b,i[7]=l*v+c*E+u*T,i[2]=h*f+d*g+p*x,i[5]=h*m+d*y+p*b,i[8]=h*v+d*E+p*T,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-r*i*c+r*o*s+n*i*l-n*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=d*l-c*h,f=c*u-d*s,m=h*s-l*u,v=i*p+a*f+o*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=p*y,n[1]=(o*h-d*a)*y,n[2]=(c*a-o*l)*y,n[3]=f*y,n[4]=(d*i-o*u)*y,n[5]=(o*s-c*i)*y,n[6]=m*y,n[7]=(a*u-h*i)*y,n[8]=(l*i-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,n,i,a,o){var s=Math.cos(i),l=Math.sin(i);this.set(r*s,r*l,-r*(s*a+l*o)+a+e,-n*l,n*s,-n*(-l*a+s*o)+o+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],l=n[4],c=n[7];return n[0]=t*i+r*s,n[3]=t*a+r*l,n[6]=t*o+r*c,n[1]=-r*i+t*s,n[4]=-r*a+t*l,n[7]=-r*o+t*c,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var Pt,Lt,Ct,Ht,It,kt,Ot,Nt,Ft,Dt,zt={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===r&&(r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),r.width=e.width,r.height=e.height;var n=r.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=r}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Ut=0;function Bt(e,t,r,n,i,a,o,s,l,c){Object.defineProperty(this,"id",{value:Ut++}),this.uuid=_t.generateUUID(),this.name="",this.image=void 0!==e?e:Bt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Bt.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:ue,this.wrapT=void 0!==n?n:ue,this.magFilter=void 0!==i?i:me,this.minFilter=void 0!==a?a:ge,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:He,this.type=void 0!==s?s:ye,this.offset=new Rt(0,0),this.repeat=new Rt(1,1),this.center=new Rt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new At,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:pt,this.version=0,this.onUpdate=null}function Gt(e,t,r,n){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==n?n:1}function Vt(e,t,r){this.width=e,this.height=t,this.scissor=new Gt(0,0,e,t),this.scissorTest=!1,this.viewport=new Gt(0,0,e,t),r=r||{},this.texture=new Bt(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:me,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function jt(e,t,r){Vt.call(this,e,t,r),this.samples=4}function Wt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Xt(e,t,r,n){this._x=e||0,this._y=t||0,this._z=r||0,this._order=n||Xt.DefaultOrder}function Yt(){this.mask=1}Bt.DEFAULT_IMAGE=void 0,Bt.DEFAULT_MAPPING=300,Bt.prototype=Object.assign(Object.create(t.prototype),{constructor:Bt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(this.isDataTexture){var i=document.createElement("canvas"),a=i.getContext("2d");n=a.getImageData(0,0,n.width,n.height)}if(void 0===n.uuid&&(n.uuid=_t.generateUUID()),!t&&void 0===e.images[n.uuid]){var o;if(Array.isArray(n)){o=[];for(var s=0,l=n.length;s<l;s++)o.push(zt.getDataURL(n[s]))}else o=zt.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:o}}r.image=n.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ce:e.x=e.x-Math.floor(e.x);break;case ue:e.x=e.x<0?0:1;break;case he:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ce:e.y=e.y-Math.floor(e.y);break;case ue:e.y=e.y<0?0:1;break;case he:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Bt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(Gt.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(Gt.prototype,{isVector4:!0,set:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,n,i,a=e.elements,o=a[0],s=a[4],l=a[8],c=a[1],u=a[5],h=a[9],d=a[2],p=a[6],f=a[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(o+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,v=(u+1)/2,g=(f+1)/2,y=(s+c)/4,E=(l+d)/4,x=(h+p)/4;return m>v&&m>g?m<.01?(r=0,n=.707106781,i=.707106781):(r=Math.sqrt(m),n=y/r,i=E/r):v>g?v<.01?(r=.707106781,n=0,i=.707106781):(n=Math.sqrt(v),r=y/n,i=x/n):g<.01?(r=.707106781,n=.707106781,i=0):(i=Math.sqrt(g),r=E/i,n=x/i),this.set(r,n,i,t),this}var b=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-s)*(c-s));return Math.abs(b)<.001&&(b=1),this.x=(p-h)/b,this.y=(l-d)/b,this.z=(c-s)/b,this.w=Math.acos((o+u+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return void 0===Ft&&(Ft=new Gt,Dt=new Gt),Ft.set(e,e,e,e),Dt.set(t,t,t,t),this.clamp(Ft,Dt)},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Vt.prototype=Object.assign(Object.create(t.prototype),{constructor:Vt,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),jt.prototype=Object.assign(Object.create(Vt.prototype),{constructor:jt,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Vt.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(Wt.prototype,{isMatrix4:!0,set:function(e,t,r,n,i,a,o,s,l,c,u,h,d,p,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Wt).fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var e=new St;return function(t){var r=this.elements,n=t.elements,i=1/e.setFromMatrixColumn(t,0).length(),a=1/e.setFromMatrixColumn(t,1).length(),o=1/e.setFromMatrixColumn(t,2).length();return r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[3]=0,r[4]=n[4]*a,r[5]=n[5]*a,r[6]=n[6]*a,r[7]=0,r[8]=n[8]*o,r[9]=n[9]*o,r[10]=n[10]*o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){var h=a*c,d=a*u,p=o*c,f=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-o*s,t[2]=f-h*l,t[6]=p+d*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*c,v=s*u,g=l*c,y=l*u;t[0]=m+y*o,t[4]=g*o-v,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=v*o-g,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){var m=s*c,v=s*u,g=l*c,y=l*u;t[0]=m-y*o,t[4]=-a*u,t[8]=g+v*o,t[1]=v+g*o,t[5]=a*c,t[9]=y-m*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var h=a*c,d=a*u,p=o*c,f=o*u;t[0]=s*c,t[4]=p*l-d,t[8]=h*l+f,t[1]=s*u,t[5]=f*l+h,t[9]=d*l-p,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var E=a*s,x=a*l,b=o*s,T=o*l;t[0]=s*c,t[4]=T-E*u,t[8]=b*u+x,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=x*u+b,t[10]=E-T*u}else if("XZY"===e.order){var E=a*s,x=a*l,b=o*s,T=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=E*u+T,t[5]=a*c,t[9]=x*u-b,t[2]=b*u-x,t[6]=o*c,t[10]=T*u+E}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:(Ot=new St(0,0,0),Nt=new St(1,1,1),function(e){return this.compose(Ot,e,Nt)}),lookAt:(Ht=new St,It=new St,kt=new St,function(e,t,r){var n=this.elements;return kt.subVectors(e,t),0===kt.lengthSq()&&(kt.z=1),kt.normalize(),Ht.crossVectors(r,kt),0===Ht.lengthSq()&&(1===Math.abs(r.z)?kt.x+=1e-4:kt.z+=1e-4,kt.normalize(),Ht.crossVectors(r,kt)),Ht.normalize(),It.crossVectors(kt,Ht),n[0]=Ht.x,n[4]=It.x,n[8]=kt.x,n[1]=Ht.y,n[5]=It.y,n[9]=kt.y,n[2]=Ht.z,n[6]=It.z,n[10]=kt.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],c=r[1],u=r[5],h=r[9],d=r[13],p=r[2],f=r[6],m=r[10],v=r[14],g=r[3],y=r[7],E=r[11],x=r[15],b=n[0],T=n[4],w=n[8],_=n[12],R=n[1],M=n[5],S=n[9],A=n[13],P=n[2],L=n[6],C=n[10],H=n[14],I=n[3],k=n[7],O=n[11],N=n[15];return i[0]=a*b+o*R+s*P+l*I,i[4]=a*T+o*M+s*L+l*k,i[8]=a*w+o*S+s*C+l*O,i[12]=a*_+o*A+s*H+l*N,i[1]=c*b+u*R+h*P+d*I,i[5]=c*T+u*M+h*L+d*k,i[9]=c*w+u*S+h*C+d*O,i[13]=c*_+u*A+h*H+d*N,i[2]=p*b+f*R+m*P+v*I,i[6]=p*T+f*M+m*L+v*k,i[10]=p*w+f*S+m*C+v*O,i[14]=p*_+f*A+m*H+v*N,i[3]=g*b+y*R+E*P+x*I,i[7]=g*T+y*M+E*L+x*k,i[11]=g*w+y*S+E*C+x*O,i[15]=g*_+y*A+E*H+x*N,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new St;return function(t){for(var r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],p=e[3],f=e[7],m=e[11],v=e[15];return p*(+i*s*u-n*l*u-i*o*h+r*l*h+n*o*d-r*s*d)+f*(+t*s*d-t*l*h+i*a*h-n*a*d+n*l*c-i*s*c)+m*(+t*l*u-t*o*d-i*a*u+r*a*d+i*o*c-r*l*c)+v*(-n*o*c-t*s*u+t*o*h+n*a*u-r*a*h+r*s*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,r){var n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this},getInverse:function(e,t){var r=this.elements,n=e.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],E=n[15],x=p*y*h-g*f*h+g*u*m-c*y*m-p*u*E+c*f*E,b=v*f*h-d*y*h-v*u*m+l*y*m+d*u*E-l*f*E,T=d*g*h-v*p*h+v*c*m-l*g*m-d*c*E+l*p*E,w=v*p*u-d*g*u-v*c*f+l*g*f+d*c*y-l*p*y,_=i*x+a*b+o*T+s*w;if(0===_){var R="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(R);return console.warn(R),this.identity()}var M=1/_;return r[0]=x*M,r[1]=(g*f*s-p*y*s-g*o*m+a*y*m+p*o*E-a*f*E)*M,r[2]=(c*y*s-g*u*s+g*o*h-a*y*h-c*o*E+a*u*E)*M,r[3]=(p*u*s-c*f*s-p*o*h+a*f*h+c*o*m-a*u*m)*M,r[4]=b*M,r[5]=(d*y*s-v*f*s+v*o*m-i*y*m-d*o*E+i*f*E)*M,r[6]=(v*u*s-l*y*s-v*o*h+i*y*h+l*o*E-i*u*E)*M,r[7]=(l*f*s-d*u*s+d*o*h-i*f*h-l*o*m+i*u*m)*M,r[8]=T*M,r[9]=(v*p*s-d*g*s-v*a*m+i*g*m+d*a*E-i*p*E)*M,r[10]=(l*g*s-v*c*s+v*a*h-i*g*h-l*a*E+i*c*E)*M,r[11]=(d*c*s-l*p*s-d*a*h+i*p*h+l*a*m-i*c*m)*M,r[12]=w*M,r[13]=(d*g*o-v*p*o+v*a*f-i*g*f-d*a*y+i*p*y)*M,r[14]=(v*c*o-l*g*o-v*a*u+i*g*u+l*a*y-i*c*y)*M,r[15]=(l*p*o-d*c*o+d*a*u-i*p*u-l*a*f+i*c*f)*M,this},scale:function(e){var t=this.elements,r=e.x,n=e.y,i=e.z;return t[0]*=r,t[4]*=n,t[8]*=i,t[1]*=r,t[5]*=n,t[9]*=i,t[2]*=r,t[6]*=n,t[10]*=i,t[3]*=r,t[7]*=n,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),n=Math.sin(t),i=1-r,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,c*o+r,c*s-n*a,0,l*s-n*o,c*s+n*a,i*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var n=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,h=i*l,d=i*c,p=i*u,f=a*c,m=a*u,v=o*u,g=s*l,y=s*c,E=s*u,x=r.x,b=r.y,T=r.z;return n[0]=(1-(f+v))*x,n[1]=(d+E)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-E)*b,n[5]=(1-(h+v))*b,n[6]=(m+g)*b,n[7]=0,n[8]=(p+y)*T,n[9]=(m-g)*T,n[10]=(1-(h+f))*T,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:(Lt=new St,Ct=new Wt,function(e,t,r){var n=this.elements,i=Lt.set(n[0],n[1],n[2]).length(),a=Lt.set(n[4],n[5],n[6]).length(),o=Lt.set(n[8],n[9],n[10]).length(),s=this.determinant();s<0&&(i=-i),e.x=n[12],e.y=n[13],e.z=n[14],Ct.copy(this);var l=1/i,c=1/a,u=1/o;return Ct.elements[0]*=l,Ct.elements[1]*=l,Ct.elements[2]*=l,Ct.elements[4]*=c,Ct.elements[5]*=c,Ct.elements[6]*=c,Ct.elements[8]*=u,Ct.elements[9]*=u,Ct.elements[10]*=u,t.setFromRotationMatrix(Ct),r.x=i,r.y=a,r.z=o,this}),makePerspective:function(e,t,r,n,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),l=2*i/(r-n),c=(t+e)/(t-e),u=(r+n)/(r-n),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,r,n,i,a){var o=this.elements,s=1/(t-e),l=1/(r-n),c=1/(a-i),u=(t+e)*s,h=(r+n)*l,d=(a+i)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Xt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Xt.DefaultOrder="XYZ",Object.defineProperties(Xt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(Xt.prototype,{isEuler:!0,set:function(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var n=_t.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],d=i[6],p=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===t?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(){var e=new Wt;return function(t,r,n){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(Pt=new Mt,function(e){return Pt.setFromEuler(this),this.setFromQuaternion(Pt,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new St(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Yt.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var qt,Qt,Zt,Kt,Jt,$t,er,tr,rr,nr,ir,ar,or,sr,lr,cr,ur,hr,dr,pr,fr=0;function mr(){Object.defineProperty(this,"id",{value:fr++}),this.uuid=_t.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=mr.DefaultUp.clone();var e=new St,t=new Xt,r=new Mt,n=new St(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Wt},normalMatrix:{value:new At}}),this.matrix=new Wt,this.matrixWorld=new Wt,this.matrixAutoUpdate=mr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Yt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function vr(){mr.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function gr(e,t){this.min=void 0!==e?e:new St(1/0,1/0,1/0),this.max=void 0!==t?t:new St(-1/0,-1/0,-1/0)}function yr(e,t){this.center=void 0!==e?e:new St,this.radius=void 0!==t?t:0}function Er(e,t){this.origin=void 0!==e?e:new St,this.direction=void 0!==t?t:new St}function xr(e,t,r){this.a=void 0!==e?e:new St,this.b=void 0!==t?t:new St,this.c=void 0!==r?r:new St}mr.DefaultUp=new St(0,1,0),mr.DefaultMatrixAutoUpdate=!0,mr.prototype=Object.assign(Object.create(t.prototype),{constructor:mr,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(pr=new Mt,function(e,t){return pr.setFromAxisAngle(e,t),this.quaternion.multiply(pr),this}),rotateOnWorldAxis:function(){var e=new Mt;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new St(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new St(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new St(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new St;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new St(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new St(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new St(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(dr=new Wt,function(e){return e.applyMatrix4(dr.getInverse(this.matrixWorld))}),lookAt:function(){var e=new Mt,t=new Wt,r=new St,n=new St;return function(i,a,o){i.isVector3?r.copy(i):r.set(i,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?t.lookAt(n,r,this.up):t.lookAt(r,n,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent({type:"removed"})),this},attach:(hr=new Wt,function(e){return this.updateWorldMatrix(!0,!1),hr.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),hr.multiply(e.parent.matrixWorld)),e.applyMatrix(hr),e.updateWorldMatrix(!1,!1),this.add(e),this}),getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r],a=i.getObjectByProperty(e,t);if(void 0!==a)return a}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new St),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(cr=new St,ur=new St,function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Mt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(cr,e,ur),e}),getWorldScale:function(){var e=new St,t=new Mt;return function(r){return void 0===r&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),r=new St),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new St),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var n=this.children,i=0,a=n.length;i<a;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==ut&&(n.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){n.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var c=o[s];i(e.shapes,c)}else i(e.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var u=[],s=0,l=this.material.length;s<l;s++)u.push(i(e.materials,this.material[s]));n.material=u}else n.material=i(e.materials,this.material);if(this.children.length>0){n.children=[];for(var s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(e).object)}if(t){var h=m(e.geometries),d=m(e.materials),p=m(e.textures),f=m(e.images),o=m(e.shapes);h.length>0&&(r.geometries=h),d.length>0&&(r.materials=d),p.length>0&&(r.textures=p),f.length>0&&(r.images=f),o.length>0&&(r.shapes=o)}return r.object=n,r;function m(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var n=e.children[r];this.add(n.clone())}return this}}),vr.prototype=Object.assign(Object.create(mr.prototype),{constructor:vr,isScene:!0,copy:function(e,t){return mr.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(gr.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,r,n),this.max.set(i,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new St;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new St),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new St),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,r,n=new St;function i(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,r=o.length;t<r;t++)n.copy(o[t]),n.applyMatrix4(i.matrixWorld),e.expandByPoint(n)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(t=0,r=s.count;t<r;t++)n.fromBufferAttribute(s,t).applyMatrix4(i.matrixWorld),e.expandByPoint(n)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(i),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new St),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:(lr=new St,function(e){return this.clampPoint(e.center,lr),lr.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function(e){var t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(){var e=new St,t=new St,r=new St,n=new St,i=new St,a=new St,o=new St,s=new St,l=new St,c=new St;function u(n){var i,a;for(i=0,a=n.length-3;i<=a;i+=3){o.fromArray(n,i);var s=l.x*Math.abs(o.x)+l.y*Math.abs(o.y)+l.z*Math.abs(o.z),c=e.dot(o),u=t.dot(o),h=r.dot(o);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>s)return!1}return!0}return function(o){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),e.subVectors(o.a,s),t.subVectors(o.b,s),r.subVectors(o.c,s),n.subVectors(t,e),i.subVectors(r,t),a.subVectors(e,r);var h=[0,-n.z,n.y,0,-i.z,i.y,0,-a.z,a.y,n.z,0,-n.x,i.z,0,-i.x,a.z,0,-a.x,-n.y,n.x,0,-i.y,i.x,0,-a.y,a.x,0];return!!u(h)&&!!u(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(n,i),u(h=[c.x,c.y,c.z]))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new St),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new St;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new St;return function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(sr=[new St,new St,new St,new St,new St,new St,new St,new St],function(e){return this.isEmpty()?this:(sr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),sr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),sr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),sr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),sr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),sr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),sr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),sr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(sr),this)}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(yr.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(or=new gr,function(e,t){var r=this.center;void 0!==t?r.copy(t):or.setFromPoints(e).getCenter(r);for(var n=0,i=0,a=e.length;i<a;i++)n=Math.max(n,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(n),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new St),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new gr),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(Er.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new St),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new St;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new St),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new St;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:(nr=new St,ir=new St,ar=new St,function(e,t,r,n){nr.copy(e).add(t).multiplyScalar(.5),ir.copy(t).sub(e).normalize(),ar.copy(this.origin).sub(nr);var i,a,o,s,l=.5*e.distanceTo(t),c=-this.direction.dot(ir),u=ar.dot(this.direction),h=-ar.dot(ir),d=ar.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(a=c*u-h,s=l*p,(i=c*h-u)>=0)if(a>=-s)if(a<=s){var f=1/p;o=(i*=f)*(i+c*(a*=f)+2*u)+a*(c*i+a+2*h)+d}else a=l,i=Math.max(0,-(c*a+u)),o=-i*i+a*(a+2*h)+d;else a=-l,i=Math.max(0,-(c*a+u)),o=-i*i+a*(a+2*h)+d;else a<=-s?(i=Math.max(0,-(-c*l+u)),a=i>0?-l:Math.min(Math.max(-l,-h),l),o=-i*i+a*(a+2*h)+d):a<=s?(i=0,a=Math.min(Math.max(-l,-h),l),o=a*(a+2*h)+d):(i=Math.max(0,-(c*l+u)),a=i>0?l:Math.min(Math.max(-l,-h),l),o=-i*i+a*(a+2*h)+d);else a=c>0?-l:l,i=Math.max(0,-(c*a+u)),o=-i*i+a*(a+2*h)+d;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(ir).multiplyScalar(a).add(nr),o}),intersectSphere:function(){var e=new St;return function(t,r){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),i=e.dot(e)-n*n,a=t.radius*t.radius;if(i>a)return null;var o=Math.sqrt(a-i),s=n-o,l=n+o;return s<0&&l<0?null:s<0?this.at(l,r):this.at(s,r)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var r=e.normal.dot(this.direction);return r*t<0},intersectBox:function(e,t){var r,n,i,a,o,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),r>a||i>n?null:((i>r||r!=r)&&(r=i),(a<n||n!=n)&&(n=a),u>=0?(o=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),r>s||o>n?null:((o>r||r!=r)&&(r=o),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,t)))},intersectsBox:(rr=new St,function(e){return null!==this.intersectBox(e,rr)}),intersectTriangle:function(){var e=new St,t=new St,r=new St,n=new St;return function(i,a,o,s,l){t.subVectors(a,i),r.subVectors(o,i),n.crossVectors(t,r);var c,u=this.direction.dot(n);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,i);var h=c*this.direction.dot(r.crossVectors(e,r));if(h<0)return null;var d=c*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>u)return null;var p=-c*e.dot(n);return p<0?null:this.at(p/u,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(xr,{getNormal:(tr=new St,function(e,t,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new St),n.subVectors(r,t),tr.subVectors(e,t),n.cross(tr);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)}),getBarycoord:function(){var e=new St,t=new St,r=new St;return function(n,i,a,o,s){e.subVectors(o,i),t.subVectors(a,i),r.subVectors(n,i);var l=e.dot(e),c=e.dot(t),u=e.dot(r),h=t.dot(t),d=t.dot(r),p=l*h-c*c;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new St),0===p)return s.set(-2,-1,-1);var f=1/p,m=(h*u-c*d)*f,v=(l*d-c*u)*f;return s.set(1-m-v,v,m)}}(),containsPoint:function(){var e=new St;return function(t,r,n,i){return xr.getBarycoord(t,r,n,i,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:(er=new St,function(e,t,r,n,i,a,o,s){return this.getBarycoord(e,t,r,n,er),s.set(0,0),s.addScaledVector(i,er.x),s.addScaledVector(a,er.y),s.addScaledVector(o,er.z),s}),isFrontFacing:function(){var e=new St,t=new St;return function(r,n,i,a){return e.subVectors(i,n),t.subVectors(r,n),e.cross(t).dot(a)<0}}()}),Object.assign(xr.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,n){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new St,t=new St;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new St),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return xr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new St),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return xr.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,r,n,i){return xr.getUV(e,this.a,this.b,this.c,t,r,n,i)},containsPoint:function(e){return xr.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return xr.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:(qt=new St,Qt=new St,Zt=new St,Kt=new St,Jt=new St,$t=new St,function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new St);var r,n,i=this.a,a=this.b,o=this.c;qt.subVectors(a,i),Qt.subVectors(o,i),Kt.subVectors(e,i);var s=qt.dot(Kt),l=Qt.dot(Kt);if(s<=0&&l<=0)return t.copy(i);Jt.subVectors(e,a);var c=qt.dot(Jt),u=Qt.dot(Jt);if(c>=0&&u<=c)return t.copy(a);var h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return r=s/(s-c),t.copy(i).addScaledVector(qt,r);$t.subVectors(e,o);var d=qt.dot($t),p=Qt.dot($t);if(p>=0&&d<=p)return t.copy(o);var f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return n=l/(l-p),t.copy(i).addScaledVector(Qt,n);var m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Zt.subVectors(o,a),n=(u-c)/(u-c+(d-p)),t.copy(a).addScaledVector(Zt,n);var v=1/(m+f+h);return r=f*v,n=h*v,t.copy(i).addScaledVector(qt,r).addScaledVector(Qt,n)}),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var br,Tr,wr,_r={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Rr(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function Mr(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function Sr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ar(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function Pr(e,t,r,n,i,a){this.a=e,this.b=t,this.c=r,this.normal=n&&n.isVector3?n:new St,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new Rr,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}Object.assign(Rr.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(e=_t.euclideanModulo(e,1),t=_t.clamp(t,0,1),r=_t.clamp(r,0,1),0===t)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+t):r+t-r*t,i=2*r-n;this.r=Mr(i,n,e+1/3),this.g=Mr(i,n,e),this.b=Mr(i,n,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n,i=r[1],a=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(o,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=r[1],u=c.length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(e&&e.length>0){var c=_r[e];void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var r=t>0?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=Sr(e.r),this.g=Sr(e.g),this.b=Sr(e.b),this},copyLinearToSRGB:function(e){return this.r=Ar(e.r),this.g=Ar(e.g),this.b=Ar(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,n=this.r,i=this.g,a=this.b,o=Math.max(n,i,a),s=Math.min(n,i,a),l=(s+o)/2;if(s===o)t=0,r=0;else{var c=o-s;switch(r=l<=.5?c/(o+s):c/(2-o-s),o){case n:t=(i-a)/c+(i<a?6:0);break;case i:t=(a-n)/c+2;break;case a:t=(n-i)/c+4}t/=6}return e.h=t,e.s=r,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(wr={},function(e,t,r){return this.getHSL(wr),wr.h+=e,wr.s+=t,wr.l+=r,this.setHSL(wr.h,wr.s,wr.l),this}),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:(br={h:0,s:0,l:0},Tr={h:0,s:0,l:0},function(e,t){this.getHSL(br),e.getHSL(Tr);var r=_t.lerp(br.h,Tr.h,t),n=_t.lerp(br.s,Tr.s,t),i=_t.lerp(br.l,Tr.l,t);return this.setHSL(r,n,i),this}),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(Pr.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Lr=0;function Cr(){Object.defineProperty(this,"id",{value:Lr++}),this.uuid=_t.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=y,this.side=h,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=f,this.opacity=1,this.transparent=!1,this.blendSrc=H,this.blendDst=I,this.blendEquation=w,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=G,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function Hr(e){Cr.call(this),this.type="MeshBasicMaterial",this.color=new Rr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Ir(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function kr(e,t,r){Ir.call(this,new Int8Array(e),t,r)}function Or(e,t,r){Ir.call(this,new Uint8Array(e),t,r)}function Nr(e,t,r){Ir.call(this,new Uint8ClampedArray(e),t,r)}function Fr(e,t,r){Ir.call(this,new Int16Array(e),t,r)}function Dr(e,t,r){Ir.call(this,new Uint16Array(e),t,r)}function zr(e,t,r){Ir.call(this,new Int32Array(e),t,r)}function Ur(e,t,r){Ir.call(this,new Uint32Array(e),t,r)}function Br(e,t,r){Ir.call(this,new Float32Array(e),t,r)}function Gr(e,t,r){Ir.call(this,new Float64Array(e),t,r)}function Vr(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function jr(e){if(0===e.length)return-1/0;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}Cr.prototype=Object.assign(Object.create(t.prototype),{constructor:Cr,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r)if("shading"!==t){var n=this[t];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){var t=[];for(var r in e){var n=e[r];delete n.metadata,t.push(n)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==y&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==h&&(r.side=this.side),this.vertexColors!==f&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){var i=n(e.textures),a=n(e.images);i.length>0&&(r.textures=i),a.length>0&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Hr.prototype=Object.create(Cr.prototype),Hr.prototype.constructor=Hr,Hr.prototype.isMeshBasicMaterial=!0,Hr.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.defineProperty(Ir.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ir.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new Rr),t[r++]=a.r,t[r++]=a.g,t[r++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new Rt),t[r++]=a.x,t[r++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new St),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var a=e[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new Gt),t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),kr.prototype=Object.create(Ir.prototype),kr.prototype.constructor=kr,Or.prototype=Object.create(Ir.prototype),Or.prototype.constructor=Or,Nr.prototype=Object.create(Ir.prototype),Nr.prototype.constructor=Nr,Fr.prototype=Object.create(Ir.prototype),Fr.prototype.constructor=Fr,Dr.prototype=Object.create(Ir.prototype),Dr.prototype.constructor=Dr,zr.prototype=Object.create(Ir.prototype),zr.prototype.constructor=zr,Ur.prototype=Object.create(Ir.prototype),Ur.prototype.constructor=Ur,Br.prototype=Object.create(Ir.prototype),Br.prototype.constructor=Br,Gr.prototype=Object.create(Ir.prototype),Gr.prototype.constructor=Gr,Object.assign(Vr.prototype,{computeGroups:function(e){for(var t,r=[],n=void 0,i=e.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==n&&(n=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,r.push(t)),t={start:3*a,materialIndex:n})}void 0!==t&&(t.count=3*a-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,n=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var u,h=e.morphNormals,d=h.length;if(d>0){u=[];for(var c=0;c<d;c++)u[c]={name:h[c].name,data:[]};this.morphTargets.normal=u}var p=e.skinIndices,f=e.skinWeights,m=p.length===n.length,v=f.length===n.length;n.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var c=0;c<r.length;c++){var g=r[c];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var E=g.normal;this.normals.push(E,E,E)}var x=g.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var b=g.color;this.colors.push(b,b,b)}if(!0===a){var T=i[0][c];void 0!==T?this.uvs.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Rt,new Rt,new Rt))}if(!0===o){var T=i[1][c];void 0!==T?this.uvs2.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Rt,new Rt,new Rt))}for(var w=0;w<l;w++){var _=s[w].vertices;t[w].data.push(_[g.a],_[g.b],_[g.c])}for(var w=0;w<d;w++){var R=h[w].vertexNormals[c];u[w].data.push(R.a,R.b,R.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var Wr,Xr,Yr=1;function qr(){Object.defineProperty(this,"id",{value:Yr+=2}),this.uuid=_t.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function Qr(e,t){mr.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new qr,this.material=void 0!==t?t:new Hr({color:16777215*Math.random()}),this.drawMode=ut,this.updateMorphTargets()}qr.prototype=Object.assign(Object.create(t.prototype),{constructor:qr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(jr(e)>65535?Ur:Dr)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new Ir(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var n=(new At).getNormalMatrix(e);n.applyToBufferAttribute(r),r.needsUpdate=!0}var i=this.attributes.tangent;if(void 0!==i){var n=(new At).getNormalMatrix(e);n.applyToBufferAttribute(i),i.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new Wt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Wt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Wt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Wt;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Wt;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:(Xr=new mr,function(e){Xr.lookAt(e),Xr.updateMatrix(),this.applyMatrix(Xr.matrix)}),center:(Wr=new St,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wr).negate(),this.translate(Wr.x,Wr.y,Wr.z),this}),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new Br(3*t.vertices.length,3),n=new Br(3*t.colors.length,3);if(this.addAttribute("position",r.copyVector3sArray(t.vertices)),this.addAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new Br(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Br(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Vr).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new Ir(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var r=new Float32Array(3*e.normals.length);this.addAttribute("normal",new Ir(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var n=new Float32Array(3*e.colors.length);this.addAttribute("color",new Ir(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new Ir(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new Ir(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],c=0,u=l.length;c<u;c++){var h=l[c],d=new Br(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var p=new Br(4*e.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Br(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){var e=new gr;return function(){null===this.boundingBox&&(this.boundingBox=new gr);var t=this.attributes.position,r=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),r)for(var n=0,i=r.length;n<i;n++){var a=r[n];e.setFromBufferAttribute(a),this.boundingBox.expandByPoint(e.min),this.boundingBox.expandByPoint(e.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var e=new gr,t=new gr,r=new St;return function(){null===this.boundingSphere&&(this.boundingSphere=new yr);var n=this.attributes.position,i=this.morphAttributes.position;if(n){var a=this.boundingSphere.center;if(e.setFromBufferAttribute(n),i)for(var o=0,s=i.length;o<s;o++){var l=i[o];t.setFromBufferAttribute(l),e.expandByPoint(t.min),e.expandByPoint(t.max)}e.getCenter(a);for(var c=0,o=0,s=n.count;o<s;o++)r.fromBufferAttribute(n,o),c=Math.max(c,a.distanceToSquared(r));if(i)for(var o=0,s=i.length;o<s;o++)for(var l=i[o],u=0,h=l.count;u<h;u++)r.fromBufferAttribute(l,u),c=Math.max(c,a.distanceToSquared(r));this.boundingSphere.radius=Math.sqrt(c),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new Ir(new Float32Array(r.length),3));else for(var n=t.normal.array,i=0,a=n.length;i<a;i++)n[i]=0;var o,s,l,c=t.normal.array,u=new St,h=new St,d=new St,p=new St,f=new St;if(e)for(var m=e.array,i=0,a=e.count;i<a;i+=3)o=3*m[i+0],s=3*m[i+1],l=3*m[i+2],u.fromArray(r,o),h.fromArray(r,s),d.fromArray(r,l),p.subVectors(d,h),f.subVectors(u,h),p.cross(f),c[o]+=p.x,c[o+1]+=p.y,c[o+2]+=p.z,c[s]+=p.x,c[s+1]+=p.y,c[s+2]+=p.z,c[l]+=p.x,c[l+1]+=p.y,c[l+2]+=p.z;else for(var i=0,a=r.length;i<a;i+=9)u.fromArray(r,i),h.fromArray(r,i+3),d.fromArray(r,i+6),p.subVectors(d,h),f.subVectors(u,h),p.cross(f),c[i]=p.x,c[i+1]=p.y,c[i+2]=p.z,c[i+3]=p.x,c[i+4]=p.y,c[i+5]=p.z,c[i+6]=p.x,c[i+7]=p.y,c[i+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==e.attributes[n])for(var i=r[n],a=i.array,o=e.attributes[n],s=o.array,l=o.itemSize*t,c=Math.min(s.length,a.length-l),u=0,h=l;u<c;u++,h++)a[h]=s[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new St;return function(){for(var t=this.attributes.normal,r=0,n=t.count;r<n;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){function e(e,t){for(var r=e.array,n=e.itemSize,i=new r.constructor(t.length*n),a=0,o=0,s=0,l=t.length;s<l;s++){a=t[s]*n;for(var c=0;c<n;c++)i[o++]=r[a++]}return new Ir(i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new qr,r=this.index.array,n=this.attributes;for(var i in n){var a=n[i],o=e(a,r);t.addAttribute(i,o)}var s=this.morphAttributes;for(i in s){for(var l=[],c=s[i],u=0,h=c.length;u<h;u++){var a=c[u],o=e(a,r);l.push(o)}t.morphAttributes[i]=l}for(var d=this.groups,u=0,p=d.length;u<p;u++){var f=d[u];t.addGroup(f.start,f.count,f.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var n=this.index;null!==n&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var i=this.attributes;for(var r in i){var a=i[r],o=a.toJSON();""!==a.name&&(o.name=a.name),e.data.attributes[r]=o}var s={},l=!1;for(var r in this.morphAttributes){for(var c=this.morphAttributes[r],u=[],h=0,d=c.length;h<d;h++){var a=c[h],o=a.toJSON();""!==a.name&&(o.name=a.name),u.push(o)}u.length>0&&(s[r]=u,l=!0)}l&&(e.data.morphAttributes=s);var p=this.groups;p.length>0&&(e.data.groups=JSON.parse(JSON.stringify(p)));var f=this.boundingSphere;return null!==f&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e},clone:function(){return(new qr).copy(this)},copy:function(e){var t,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var a=e.attributes;for(t in a){var o=a[t];this.addAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(r=0,n=c.length;r<n;r++)l.push(c[r].clone());this.morphAttributes[t]=l}var u=e.groups;for(r=0,n=u.length;r<n;r++){var h=u[r];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Qr.prototype=Object.assign(Object.create(mr.prototype),{constructor:Qr,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return mr.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){var e=new Wt,t=new Er,r=new yr,n=new St,i=new St,a=new St,o=new St,s=new St,l=new St,c=new St,u=new St,h=new St,f=new Rt,m=new Rt,v=new Rt,g=new St,y=new St;function E(e,t,r,n,i,a,o,s){if(null===(t.side===d?n.intersectTriangle(o,a,i,!0,s):n.intersectTriangle(i,a,o,t.side!==p,s)))return null;y.copy(s),y.applyMatrix4(e.matrixWorld);var l=r.ray.origin.distanceTo(y);return l<r.near||l>r.far?null:{distance:l,point:y.clone(),object:e}}function x(e,t,r,d,p,y,x,b,T,w){n.fromBufferAttribute(p,b),i.fromBufferAttribute(p,T),a.fromBufferAttribute(p,w);var _=e.morphTargetInfluences;if(t.morphTargets&&y&&_){c.set(0,0,0),u.set(0,0,0),h.set(0,0,0);for(var R=0,M=y.length;R<M;R++){var S=_[R],A=y[R];0!==S&&(o.fromBufferAttribute(A,b),s.fromBufferAttribute(A,T),l.fromBufferAttribute(A,w),c.addScaledVector(o.sub(n),S),u.addScaledVector(s.sub(i),S),h.addScaledVector(l.sub(a),S))}n.add(c),i.add(u),a.add(h)}var P=E(e,t,r,d,n,i,a,g);if(P){x&&(f.fromBufferAttribute(x,b),m.fromBufferAttribute(x,T),v.fromBufferAttribute(x,w),P.uv=xr.getUV(g,n,i,a,f,m,v,new Rt));var L=new Pr(b,T,w);xr.getNormal(n,i,a,L.normal),P.face=L}return P}return function(n,i){var a,o=this.geometry,s=this.material,l=this.matrixWorld;if(void 0!==s&&(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(l),!1!==n.ray.intersectsSphere(r)&&(e.getInverse(l),t.copy(n.ray).applyMatrix4(e),null===o.boundingBox||!1!==t.intersectsBox(o.boundingBox))))if(o.isBufferGeometry){var c,u,h,d,p,y,b,T,w,_,R,M=o.index,S=o.attributes.position,A=o.morphAttributes.position,P=o.attributes.uv,L=o.groups,C=o.drawRange;if(null!==M)if(Array.isArray(s))for(d=0,y=L.length;d<y;d++)for(T=L[d],w=s[T.materialIndex],_=Math.max(T.start,C.start),R=Math.min(T.start+T.count,C.start+C.count),p=_,b=R;p<b;p+=3)c=M.getX(p),u=M.getX(p+1),h=M.getX(p+2),(a=x(this,w,n,t,S,A,P,c,u,h))&&(a.faceIndex=Math.floor(p/3),a.face.materialIndex=T.materialIndex,i.push(a));else for(_=Math.max(0,C.start),R=Math.min(M.count,C.start+C.count),d=_,y=R;d<y;d+=3)c=M.getX(d),u=M.getX(d+1),h=M.getX(d+2),(a=x(this,s,n,t,S,A,P,c,u,h))&&(a.faceIndex=Math.floor(d/3),i.push(a));else if(void 0!==S)if(Array.isArray(s))for(d=0,y=L.length;d<y;d++)for(T=L[d],w=s[T.materialIndex],_=Math.max(T.start,C.start),R=Math.min(T.start+T.count,C.start+C.count),p=_,b=R;p<b;p+=3)(a=x(this,w,n,t,S,A,P,c=p,u=p+1,h=p+2))&&(a.faceIndex=Math.floor(p/3),a.face.materialIndex=T.materialIndex,i.push(a));else for(_=Math.max(0,C.start),R=Math.min(S.count,C.start+C.count),d=_,y=R;d<y;d+=3)(a=x(this,s,n,t,S,A,P,c=d,u=d+1,h=d+2))&&(a.faceIndex=Math.floor(d/3),i.push(a))}else if(o.isGeometry){var H,I,k,O,N=Array.isArray(s),F=o.vertices,D=o.faces,z=o.faceVertexUvs[0];z.length>0&&(O=z);for(var U=0,B=D.length;U<B;U++){var G=D[U],V=N?s[G.materialIndex]:s;if(void 0!==V&&(H=F[G.a],I=F[G.b],k=F[G.c],a=E(this,V,n,t,H,I,k,g))){if(O&&O[U]){var j=O[U];f.copy(j[0]),m.copy(j[1]),v.copy(j[2]),a.uv=xr.getUV(g,H,I,k,f,m,v,new Rt)}a.face=G,a.faceIndex=U,i.push(a)}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Zr=0;function Kr(){Object.defineProperty(this,"id",{value:Zr+=2}),this.uuid=_t.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Jr(e,t,r,n,i,a){Kr.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:a},this.fromBufferGeometry(new $r(e,t,r,n,i,a)),this.mergeVertices()}function $r(e,t,r,n,i,a){qr.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:a};var o=this;e=e||1,t=t||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1,a=Math.floor(a)||1;var s=[],l=[],c=[],u=[],h=0,d=0;function p(e,t,r,n,i,a,p,f,m,v,g){var y,E,x=a/m,b=p/v,T=a/2,w=p/2,_=f/2,R=m+1,M=v+1,S=0,A=0,P=new St;for(E=0;E<M;E++){var L=E*b-w;for(y=0;y<R;y++){var C=y*x-T;P[e]=C*n,P[t]=L*i,P[r]=_,l.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[r]=f>0?1:-1,c.push(P.x,P.y,P.z),u.push(y/m),u.push(1-E/v),S+=1}}for(E=0;E<v;E++)for(y=0;y<m;y++){var H=h+y+R*E,I=h+y+R*(E+1),k=h+(y+1)+R*(E+1),O=h+(y+1)+R*E;s.push(H,I,O),s.push(I,k,O),A+=6}o.addGroup(d,A,g),d+=A,h+=S}p("z","y","x",-1,-1,r,t,e,a,i,0),p("z","y","x",1,-1,r,t,-e,a,i,1),p("x","z","y",1,1,e,r,t,n,a,2),p("x","z","y",1,-1,e,r,-t,n,a,3),p("x","y","z",1,-1,e,t,r,n,i,4),p("x","y","z",-1,-1,e,t,-r,n,i,5),this.setIndex(s),this.addAttribute("position",new Br(l,3)),this.addAttribute("normal",new Br(c,3)),this.addAttribute("uv",new Br(u,2))}function en(e){var t={};for(var r in e)for(var n in t[r]={},e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}return t}function tn(e){for(var t={},r=0;r<e.length;r++){var n=en(e[r]);for(var i in n)t[i]=n[i]}return t}Kr.prototype=Object.assign(Object.create(t.prototype),{constructor:Kr,isGeometry:!0,applyMatrix:function(e){for(var t=(new At).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++){var i=this.vertices[r];i.applyMatrix4(e)}for(var r=0,n=this.faces.length;r<n;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;o<s;o++)a.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new Wt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Wt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Wt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Wt;return function(t,r,n){return e.makeTranslation(t,r,n),this.applyMatrix(e),this}}(),scale:function(){var e=new Wt;return function(t,r,n){return e.makeScale(t,r,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new mr;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,r=null!==e.index?e.index.array:void 0,n=e.attributes,i=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,o=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=0;c<i.length;c+=3)t.vertices.push((new St).fromArray(i,c)),void 0!==o&&t.colors.push((new Rr).fromArray(o,c));function u(e,r,n,i){var c=void 0===o?[]:[t.colors[e].clone(),t.colors[r].clone(),t.colors[n].clone()],u=void 0===a?[]:[(new St).fromArray(a,3*e),(new St).fromArray(a,3*r),(new St).fromArray(a,3*n)],h=new Pr(e,r,n,u,c,i);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new Rt).fromArray(s,2*e),(new Rt).fromArray(s,2*r),(new Rt).fromArray(s,2*n)]),void 0!==l&&t.faceVertexUvs[1].push([(new Rt).fromArray(l,2*e),(new Rt).fromArray(l,2*r),(new Rt).fromArray(l,2*n)])}var h=e.groups;if(h.length>0)for(var c=0;c<h.length;c++)for(var d=h[c],p=d.start,f=d.count,m=p,v=p+f;m<v;m+=3)void 0!==r?u(r[m],r[m+1],r[m+2],d.materialIndex):u(m,m+1,m+2,d.materialIndex);else if(void 0!==r)for(var c=0;c<r.length;c+=3)u(r[c],r[c+1],r[c+2]);else for(var c=0;c<i.length/3;c+=3)u(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new St;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=0===t?1:1/t,n=new Wt;return n.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var e=new St,t=new St,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,r,n,i,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)o[t]=new St;if(e){var s,l,c,u=new St,h=new St;for(n=0,i=this.faces.length;n<i;n++)a=this.faces[n],s=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),o[a.a].add(u),o[a.b].add(u),o[a.c].add(u)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)a=this.faces[n],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,r=this.vertices.length;t<r;t++)o[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var d=(a=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(o[a.a]),d[1].copy(o[a.b]),d[2].copy(o[a.c])):(d[0]=o[a.a].clone(),d[1]=o[a.b].clone(),d[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var n=(r=this.faces[e]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var a=new Kr;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new St,c={a:new St,b:new St,c:new St},o.push(l),s.push(c)}var l,c,u=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],l=u.faceNormals[r],c=u.vertexNormals[r],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new gr),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new yr),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],h=this.colors,d=e.colors;void 0===r&&(r=0),void 0!==t&&(n=(new At).getNormalMatrix(t));for(var p=0,f=o.length;p<f;p++){var m=o[p],v=m.clone();void 0!==t&&v.applyMatrix4(t),a.push(v)}for(var p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var g,y,E,x=l[p],b=x.vertexNormals,T=x.vertexColors;(g=new Pr(x.a+i,x.b+i,x.c+i)).normal.copy(x.normal),void 0!==n&&g.normal.applyMatrix3(n).normalize();for(var w=0,_=b.length;w<_;w++)y=b[w].clone(),void 0!==n&&y.applyMatrix3(n).normalize(),g.vertexNormals.push(y);g.color.copy(x.color);for(var w=0,_=T.length;w<_;w++)E=T[w],g.vertexColors.push(E.clone());g.materialIndex=x.materialIndex+r,s.push(g)}for(p=0,f=u.length;p<f;p++){var R=u[p],M=[];if(void 0!==R){for(var w=0,_=R.length;w<_;w++)M.push(R[w].clone());c.push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,n,i,a,o,s,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)e=this.vertices[r],t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h),void 0===l[t]?(l[t]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[t]];var d=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],a=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(a[p]===a[(p+1)%3]){d.push(r);break}}for(r=d.length-1;r>=0;r--){var f=d[r];for(this.faces.splice(f,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new St(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(n=[]),o&&o.length===t&&(i=[]);for(var r=0;r<t;r++){var s=e[r]._id;n&&n.push(a[s]),i&&i.push(o[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var r in t)void 0!==t[r]&&(e[r]=t[r]);return e}for(var n=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}for(var o=[],s=[],l={},c=[],u={},h=[],d={},i=0;i<this.faces.length;i++){var p=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,E=0;if(E=w(E,0,0),E=w(E,1,!0),E=w(E,2,!1),E=w(E,3,f),E=w(E,4,m),E=w(E,5,v),E=w(E,6,g),E=w(E,7,y),o.push(E),o.push(p.a,p.b,p.c),o.push(p.materialIndex),f){var x=this.faceVertexUvs[0][i];o.push(M(x[0]),M(x[1]),M(x[2]))}if(m&&o.push(_(p.normal)),v){var b=p.vertexNormals;o.push(_(b[0]),_(b[1]),_(b[2]))}if(g&&o.push(R(p.color)),y){var T=p.vertexColors;o.push(R(T[0]),R(T[1]),R(T[2]))}}function w(e,t,r){return r?e|1<<t:e&~(1<<t)}function _(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function R(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]?u[t]:(u[t]=c.length,c.push(e.getHex()),u[t])}function M(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/2,h.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=n,e.data.normals=s,c.length>0&&(e.data.colors=c),h.length>0&&(e.data.uvs=[h]),e.data.faces=o,e},clone:function(){return(new Kr).copy(this)},copy:function(e){var t,r,n,i,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,r=s.length;t<r;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,r=l.length;t<r;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,r=c.length;t<r;t++)this.faces.push(c[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=u.length;n<i;n++){var h=u[n],d=[];for(a=0,o=h.length;a<o;a++){var p=h[a];d.push(p.clone())}this.faceVertexUvs[t].push(d)}}var f=e.morphTargets;for(t=0,r=f.length;t<r;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],n=0,i=f[t].vertices.length;n<i;n++)m.vertices.push(f[t].vertices[n].clone());if(void 0!==f[t].normals)for(m.normals=[],n=0,i=f[t].normals.length;n<i;n++)m.normals.push(f[t].normals[n].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,r=v.length;t<r;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],n=0,i=v[t].vertexNormals.length;n<i;n++){var y=v[t].vertexNormals[n],E={};E.a=y.a.clone(),E.b=y.b.clone(),E.c=y.c.clone(),g.vertexNormals.push(E)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],n=0,i=v[t].faceNormals.length;n<i;n++)g.faceNormals.push(v[t].faceNormals[n].clone());this.morphNormals.push(g)}var x=e.skinWeights;for(t=0,r=x.length;t<r;t++)this.skinWeights.push(x[t].clone());var b=e.skinIndices;for(t=0,r=b.length;t<r;t++)this.skinIndices.push(b[t].clone());var T=e.lineDistances;for(t=0,r=T.length;t<r;t++)this.lineDistances.push(T[t]);var w=e.boundingBox;null!==w&&(this.boundingBox=w.clone());var _=e.boundingSphere;return null!==_&&(this.boundingSphere=_.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Jr.prototype=Object.create(Kr.prototype),Jr.prototype.constructor=Jr,$r.prototype=Object.create(qr.prototype),$r.prototype.constructor=$r;var rn={clone:en,merge:tn},nn="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",an="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function on(e){Cr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=nn,this.fragmentShader=an,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function sn(){mr.call(this),this.type="Camera",this.matrixWorldInverse=new Wt,this.projectionMatrix=new Wt,this.projectionMatrixInverse=new Wt}function ln(e,t,r,n){sn.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}on.prototype=Object.create(Cr.prototype),on.prototype.constructor=on,on.prototype.isShaderMaterial=!0,on.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=en(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},on.prototype.toJSON=function(e){var t=Cr.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var n=this.uniforms[r],i=n.value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t},sn.prototype=Object.assign(Object.create(mr.prototype),{constructor:sn,isCamera:!0,copy:function(e,t){return mr.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new St),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){mr.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ln.prototype=Object.assign(Object.create(sn.prototype),{constructor:ln,isPerspectiveCamera:!0,copy:function(e,t){return sn.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*_t.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*_t.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*_t.RAD2DEG*Math.atan(Math.tan(.5*_t.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*_t.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*n/o,t-=a.offsetY*r/s,n*=a.width/o,r*=a.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var cn,un,hn=90,dn=1;function pn(e,t,r,n){mr.call(this),this.type="CubeCamera";var i=new ln(hn,dn,e,t);i.up.set(0,-1,0),i.lookAt(new St(1,0,0)),this.add(i);var a=new ln(hn,dn,e,t);a.up.set(0,-1,0),a.lookAt(new St(-1,0,0)),this.add(a);var o=new ln(hn,dn,e,t);o.up.set(0,0,1),o.lookAt(new St(0,1,0)),this.add(o);var s=new ln(hn,dn,e,t);s.up.set(0,0,-1),s.lookAt(new St(0,-1,0)),this.add(s);var l=new ln(hn,dn,e,t);l.up.set(0,-1,0),l.lookAt(new St(0,0,1)),this.add(l);var c=new ln(hn,dn,e,t);c.up.set(0,-1,0),c.lookAt(new St(0,0,-1)),this.add(c),n=n||{format:Ce,magFilter:me,minFilter:me},this.renderTarget=new fn(r,r,n),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=e.getRenderTarget(),n=this.renderTarget,u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=u,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(r)},this.clear=function(e,t,r,n){for(var i=e.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)e.setRenderTarget(a,o),e.clear(t,r,n);e.setRenderTarget(i)}}function fn(e,t,r){Vt.call(this,e,t,r)}function mn(e,t,r,n,i,a,o,s,l,c,u,h){Bt.call(this,null,a,o,s,l,c,n,i,u,h),this.image={data:e,width:t,height:r},this.magFilter=void 0!==l?l:de,this.minFilter=void 0!==c?c:de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function vn(e,t){this.normal=void 0!==e?e:new St(1,0,0),this.constant=void 0!==t?t:0}function gn(e,t,r,n,i,a){this.planes=[void 0!==e?e:new vn,void 0!==t?t:new vn,void 0!==r?r:new vn,void 0!==n?n:new vn,void 0!==i?i:new vn,void 0!==a?a:new vn]}pn.prototype=Object.create(mr.prototype),pn.prototype.constructor=pn,fn.prototype=Object.create(Vt.prototype),fn.prototype.constructor=fn,fn.prototype.isWebGLRenderTargetCube=!0,fn.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new vr,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new on({type:"CubemapFromEquirect",uniforms:en(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:d,blending:g});i.uniforms.tEquirect.value=t;var a=new Qr(new $r(5,5,5),i);r.add(a);var o=new pn(1,10,1);return o.renderTarget=this,o.renderTarget.texture.name="CubeCameraTexture",o.update(e,r),a.geometry.dispose(),a.material.dispose(),this},mn.prototype=Object.create(Bt.prototype),mn.prototype.constructor=mn,mn.prototype.isDataTexture=!0,Object.assign(vn.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new St,t=new St;return function(r,n,i){var a=e.subVectors(i,n).cross(t.subVectors(r,n)).normalize();return this.setFromNormalAndCoplanarPoint(a,r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new St),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new St;return function(t,r){void 0===r&&(console.warn("THREE.Plane: .intersectLine() target is now required"),r=new St);var n=t.delta(e),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/i;return a<0||a>1?void 0:r.copy(n).multiplyScalar(a).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new St),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new St,t=new At;return function(r,n){var i=n||t.getNormalMatrix(r),a=this.coplanarPoint(e).applyMatrix4(r),o=this.normal.applyMatrix3(i).normalize();return this.constant=-a.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(gn.prototype,{set:function(e,t,r,n,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(o-n,u-s,f-h,y-m).normalize(),t[1].setComponents(o+n,u+s,f+h,y+m).normalize(),t[2].setComponents(o+i,u+l,f+d,y+v).normalize(),t[3].setComponents(o-i,u-l,f-d,y-v).normalize(),t[4].setComponents(o-a,u-c,f-p,y-g).normalize(),t[5].setComponents(o+a,u+c,f+p,y+g).normalize(),this},intersectsObject:(un=new yr,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),un.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(un)}),intersectsSprite:function(){var e=new yr;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,n=-e.radius,i=0;i<6;i++){var a=t[i].distanceToPoint(r);if(a<n)return!1}return!0},intersectsBox:(cn=new St,function(e){for(var t=this.planes,r=0;r<6;r++){var n=t[r];if(cn.x=n.normal.x>0?e.max.x:e.min.x,cn.y=n.normal.y>0?e.max.y:e.min.y,cn.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(cn)<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var yn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\t#ifdef USE_TANGENT\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy = normalScale * mapN.xy;\n\t\t\tnormal = normalize( vTBN * mapN );\n\t\t#else\n\t\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t\t#endif\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},En={common:{diffuse:{value:new Rr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new At},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Rt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Rr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new At}},sprite:{diffuse:{value:new Rr(15658734)},opacity:{value:1},center:{value:new Rt(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new At}}},xn={basic:{uniforms:tn([En.common,En.specularmap,En.envmap,En.aomap,En.lightmap,En.fog]),vertexShader:yn.meshbasic_vert,fragmentShader:yn.meshbasic_frag},lambert:{uniforms:tn([En.common,En.specularmap,En.envmap,En.aomap,En.lightmap,En.emissivemap,En.fog,En.lights,{emissive:{value:new Rr(0)}}]),vertexShader:yn.meshlambert_vert,fragmentShader:yn.meshlambert_frag},phong:{uniforms:tn([En.common,En.specularmap,En.envmap,En.aomap,En.lightmap,En.emissivemap,En.bumpmap,En.normalmap,En.displacementmap,En.gradientmap,En.fog,En.lights,{emissive:{value:new Rr(0)},specular:{value:new Rr(1118481)},shininess:{value:30}}]),vertexShader:yn.meshphong_vert,fragmentShader:yn.meshphong_frag},standard:{uniforms:tn([En.common,En.envmap,En.aomap,En.lightmap,En.emissivemap,En.bumpmap,En.normalmap,En.displacementmap,En.roughnessmap,En.metalnessmap,En.fog,En.lights,{emissive:{value:new Rr(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:yn.meshphysical_vert,fragmentShader:yn.meshphysical_frag},matcap:{uniforms:tn([En.common,En.bumpmap,En.normalmap,En.displacementmap,En.fog,{matcap:{value:null}}]),vertexShader:yn.meshmatcap_vert,fragmentShader:yn.meshmatcap_frag},points:{uniforms:tn([En.points,En.fog]),vertexShader:yn.points_vert,fragmentShader:yn.points_frag},dashed:{uniforms:tn([En.common,En.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yn.linedashed_vert,fragmentShader:yn.linedashed_frag},depth:{uniforms:tn([En.common,En.displacementmap]),vertexShader:yn.depth_vert,fragmentShader:yn.depth_frag},normal:{uniforms:tn([En.common,En.bumpmap,En.normalmap,En.displacementmap,{opacity:{value:1}}]),vertexShader:yn.normal_vert,fragmentShader:yn.normal_frag},sprite:{uniforms:tn([En.sprite,En.fog]),vertexShader:yn.sprite_vert,fragmentShader:yn.sprite_frag},background:{uniforms:{uvTransform:{value:new At},t2D:{value:null}},vertexShader:yn.background_vert,fragmentShader:yn.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yn.cube_vert,fragmentShader:yn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yn.equirect_vert,fragmentShader:yn.equirect_frag},distanceRGBA:{uniforms:tn([En.common,En.displacementmap,{referencePosition:{value:new St},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yn.distanceRGBA_vert,fragmentShader:yn.distanceRGBA_frag},shadow:{uniforms:tn([En.lights,En.fog,{color:{value:new Rr(0)},opacity:{value:1}}]),vertexShader:yn.shadow_vert,fragmentShader:yn.shadow_frag}};function bn(){var e=null,t=!1,r=null;function n(i,a){!1!==t&&(r(i,a),e.requestAnimationFrame(n))}return{start:function(){!0!==t&&null!==r&&(e.requestAnimationFrame(n),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function Tn(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var n=t.get(r);n&&(e.deleteBuffer(n.buffer),t.delete(r))},update:function(r,n){r.isInterleavedBufferAttribute&&(r=r.data);var i=t.get(r);void 0===i?t.set(r,function(t,r){var n=t.array,i=t.dynamic?35048:35044,a=e.createBuffer();e.bindBuffer(r,a),e.bufferData(r,n,i),t.onUploadCallback();var o=5126;return n instanceof Float32Array?o=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?o=5123:n instanceof Int16Array?o=5122:n instanceof Uint32Array?o=5125:n instanceof Int32Array?o=5124:n instanceof Int8Array?o=5120:n instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(r,n)):i.version<r.version&&(function(t,r,n){var i=r.array,a=r.updateRange;e.bindBuffer(n,t),!1===r.dynamic?e.bufferData(n,i,35044):-1===a.count?e.bufferSubData(n,0,i):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(n,a.offset*i.BYTES_PER_ELEMENT,i.subarray(a.offset,a.offset+a.count)),a.count=-1)}(i.buffer,r,n),i.version=r.version)}}}function wn(e,t,r,n){Kr.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new _n(e,t,r,n)),this.mergeVertices()}function _n(e,t,r,n){qr.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};var i,a,o=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(r)||1,c=Math.floor(n)||1,u=l+1,h=c+1,d=e/l,p=t/c,f=[],m=[],v=[],g=[];for(a=0;a<h;a++){var y=a*p-s;for(i=0;i<u;i++){var E=i*d-o;m.push(E,-y,0),v.push(0,0,1),g.push(i/l),g.push(1-a/c)}}for(a=0;a<c;a++)for(i=0;i<l;i++){var x=i+u*a,b=i+u*(a+1),T=i+1+u*(a+1),w=i+1+u*a;f.push(x,b,w),f.push(b,T,w)}this.setIndex(f),this.addAttribute("position",new Br(m,3)),this.addAttribute("normal",new Br(v,3)),this.addAttribute("uv",new Br(g,2))}function Rn(e,t,r,n){var i,a,o=new Rr(0),s=0,l=null,c=0;function u(e,r){t.buffers.color.setClear(e.r,e.g,e.b,r,n)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),u(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){u(o,s=e)},render:function(t,n,p,f){var m=n.background,v=e.vr,g=v.getSession&&v.getSession();if(g&&"additive"===g.environmentBlendMode&&(m=null),null===m?(u(o,s),l=null,c=0):m&&m.isColor&&(u(m,1),f=!0,l=null,c=0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLRenderTargetCube)){void 0===a&&((a=new Qr(new $r(1,1,1),new on({type:"BackgroundCubeMaterial",uniforms:en(xn.cube.uniforms),vertexShader:xn.cube.vertexShader,fragmentShader:xn.cube.fragmentShader,side:d,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),r.update(a));var y=m.isWebGLRenderTargetCube?m.texture:m;a.material.uniforms.tCube.value=y,a.material.uniforms.tFlip.value=m.isWebGLRenderTargetCube?1:-1,l===m&&c===y.version||(a.material.needsUpdate=!0,l=m,c=y.version),t.unshift(a,a.geometry,a.material,0,0,null)}else m&&m.isTexture&&(void 0===i&&((i=new Qr(new _n(2,2),new on({type:"BackgroundMaterial",uniforms:en(xn.background.uniforms),vertexShader:xn.background.vertexShader,fragmentShader:xn.background.fragmentShader,side:h,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),i.material.uniforms.uvTransform.value.copy(m.matrix),l===m&&c===m.version||(i.material.needsUpdate=!0,l=m,c=m.version),t.unshift(i,i.geometry,i.material,0,0,null))}}}function Mn(e,t,r,n){var i;this.setMode=function(e){i=e},this.render=function(t,n){e.drawArrays(i,t,n),r.update(n,i)},this.renderInstances=function(a,o,s){var l;if(n.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[n.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](i,o,s,a.maxInstancedCount),r.update(s,i,a.maxInstancedCount)}}function Sn(e,t,r){var n;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,o=void 0!==r.precision?r.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===r.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=u>0,y=a||!!t.get("OES_texture_float"),E=g&&y,x=a?e.getParameter(36183):0;return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=t.get("EXT_texture_filter_anisotropic");return n=null!==r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:E,maxSamples:x}}function An(){var e=this,t=null,r=0,n=!1,i=!1,a=new vn,o=new At,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(t,r,n,i){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=s.value,!0!==i||null===c){var u=n+4*l,h=r.matrixWorldInverse;o.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var d=0,p=n;d!==l;++d,p+=4)a.copy(t[d]).applyMatrix4(h,o),a.normal.toArray(c,p),c[p+3]=a.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=l,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,a){var o=0!==e.length||i||0!==r||n;return n=i,t=c(e,a,0),r=e.length,o},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,l()},this.setState=function(e,a,o,u,h,d){if(!n||null===e||0===e.length||i&&!o)i?c(null):l();else{var p=i?0:r,f=4*p,m=h.clippingState||null;s.value=m,m=c(e,u,f,d);for(var v=0;v!==f;++v)m[v]=t[v];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=p}}}function Pn(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];var n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=n,n}}}function Ln(e,t,r){var n={},i={};function a(e){var o=e.target,s=n[o.id];for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);o.removeEventListener("dispose",a),delete n[o.id];var c=i[s.id];c&&(t.remove(c),delete i[s.id]),r.memory.geometries--}return{get:function(e,t){var i=n[t.id];return i||(t.addEventListener("dispose",a),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new qr).setFromObject(e)),i=t._bufferGeometry),n[t.id]=i,r.memory.geometries++,i)},update:function(e){var r=e.index,n=e.attributes;for(var i in null!==r&&t.update(r,34963),n)t.update(n[i],34962);var a=e.morphAttributes;for(var i in a)for(var o=a[i],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var r=i[e.id];if(r)return r;var n=[],a=e.index,o=e.attributes;if(null!==a)for(var s=a.array,l=0,c=s.length;l<c;l+=3){var u=s[l+0],h=s[l+1],d=s[l+2];n.push(u,h,h,d,d,u)}else for(var s=o.position.array,l=0,c=s.length/3-1;l<c;l+=3){var u=l+0,h=l+1,d=l+2;n.push(u,h,h,d,d,u)}return r=new(jr(n)>65535?Ur:Dr)(n,1),t.update(r,34963),i[e.id]=r,r}}}function Cn(e,t,r,n){var i,a,o;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,n){e.drawElements(i,n,a,t*o),r.update(n,i)},this.renderInstances=function(s,l,c){if(n.isWebGL2)u=e;else{var u=t.get("ANGLE_instanced_arrays");if(null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}u[n.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](i,c,a,l*o,s.maxInstancedCount),r.update(c,i,s.maxInstancedCount)}}function Hn(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,r,n){switch(n=n||1,t.calls++,r){case 4:t.triangles+=n*(e/3);break;case 5:case 6:t.triangles+=n*(e-2);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function In(e,t){return Math.abs(t[1])-Math.abs(e[1])}function kn(e){var t={},r=new Float32Array(8);return{update:function(n,i,a,o){var s=n.morphTargetInfluences,l=s.length,c=t[i.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];t[i.id]=c}for(var h=a.morphTargets&&i.morphAttributes.position,d=a.morphNormals&&i.morphAttributes.normal,u=0;u<l;u++){var p=c[u];0!==p[1]&&(h&&i.removeAttribute("morphTarget"+u),d&&i.removeAttribute("morphNormal"+u))}for(var u=0;u<l;u++){var p=c[u];p[0]=u,p[1]=s[u]}c.sort(In);for(var u=0;u<8;u++){var p=c[u];if(p){var f=p[0],m=p[1];if(m){h&&i.addAttribute("morphTarget"+u,h[f]),d&&i.addAttribute("morphNormal"+u,d[f]),r[u]=m;continue}}r[u]=0}o.getUniforms().setValue(e,"morphTargetInfluences",r)}}}function On(e,t){var r={};return{update:function(n){var i=t.render.frame,a=n.geometry,o=e.get(n,a);return r[o.id]!==i&&(a.isGeometry&&o.updateFromObject(n),e.update(o),r[o.id]=i),o},dispose:function(){r={}}}}function Nn(e,t,r,n,i,a,o,s,l,c){e=void 0!==e?e:[],t=void 0!==t?t:re,o=void 0!==o?o:Ce,Bt.call(this,e,t,r,n,i,a,o,s,l,c),this.flipY=!1}function Fn(e,t,r,n){Bt.call(this,null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=de,this.minFilter=de,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1}function Dn(e,t,r,n){Bt.call(this,null),this.image={data:e,width:t,height:r,depth:n},this.magFilter=de,this.minFilter=de,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1}xn.physical={uniforms:tn([xn.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:yn.meshphysical_vert,fragmentShader:yn.meshphysical_frag},wn.prototype=Object.create(Kr.prototype),wn.prototype.constructor=wn,_n.prototype=Object.create(qr.prototype),_n.prototype.constructor=_n,Nn.prototype=Object.create(Bt.prototype),Nn.prototype.constructor=Nn,Nn.prototype.isCubeTexture=!0,Object.defineProperty(Nn.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Fn.prototype=Object.create(Bt.prototype),Fn.prototype.constructor=Fn,Fn.prototype.isDataTexture2DArray=!0,Dn.prototype=Object.create(Bt.prototype),Dn.prototype.constructor=Dn,Dn.prototype.isDataTexture3D=!0;var zn=new Bt,Un=new Fn,Bn=new Dn,Gn=new Nn,Vn=[],jn=[],Wn=new Float32Array(16),Xn=new Float32Array(9),Yn=new Float32Array(4);function qn(e,t,r){var n=e[0];if(n<=0||n>0)return e;var i=t*r,a=Vn[i];if(void 0===a&&(a=new Float32Array(i),Vn[i]=a),0!==t){n.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=r,e[o].toArray(a,s)}return a}function Qn(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Zn(e,t){for(var r=0,n=t.length;r<n;r++)e[r]=t[r]}function Kn(e,t){var r=jn[t];void 0===r&&(r=new Int32Array(t),jn[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocateTextureUnit();return r}function Jn(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function $n(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(Qn(r,t))return;e.uniform2fv(this.addr,t),Zn(r,t)}}function ei(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(Qn(r,t))return;e.uniform3fv(this.addr,t),Zn(r,t)}}function ti(e,t){var r=this.cache;if(void 0!==t.x)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(Qn(r,t))return;e.uniform4fv(this.addr,t),Zn(r,t)}}function ri(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Qn(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),Zn(r,t)}else{if(Qn(r,n))return;Yn.set(n),e.uniformMatrix2fv(this.addr,!1,Yn),Zn(r,n)}}function ni(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Qn(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),Zn(r,t)}else{if(Qn(r,n))return;Xn.set(n),e.uniformMatrix3fv(this.addr,!1,Xn),Zn(r,n)}}function ii(e,t){var r=this.cache,n=t.elements;if(void 0===n){if(Qn(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),Zn(r,t)}else{if(Qn(r,n))return;Wn.set(n),e.uniformMatrix4fv(this.addr,!1,Wn),Zn(r,n)}}function ai(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(t||zn,i)}function oi(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(t||Un,i)}function si(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(t||Bn,i)}function li(e,t,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(t||Gn,i)}function ci(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function ui(e,t){var r=this.cache;Qn(r,t)||(e.uniform2iv(this.addr,t),Zn(r,t))}function hi(e,t){var r=this.cache;Qn(r,t)||(e.uniform3iv(this.addr,t),Zn(r,t))}function di(e,t){var r=this.cache;Qn(r,t)||(e.uniform4iv(this.addr,t),Zn(r,t))}function pi(e,t){e.uniform1fv(this.addr,t)}function fi(e,t){e.uniform1iv(this.addr,t)}function mi(e,t){e.uniform2iv(this.addr,t)}function vi(e,t){e.uniform3iv(this.addr,t)}function gi(e,t){e.uniform4iv(this.addr,t)}function yi(e,t){var r=qn(t,this.size,2);e.uniform2fv(this.addr,r)}function Ei(e,t){var r=qn(t,this.size,3);e.uniform3fv(this.addr,r)}function xi(e,t){var r=qn(t,this.size,4);e.uniform4fv(this.addr,r)}function bi(e,t){var r=qn(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function Ti(e,t){var r=qn(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function wi(e,t){var r=qn(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function _i(e,t,r){var n=t.length,i=Kn(r,n);e.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTexture2D(t[a]||zn,i[a])}function Ri(e,t,r){var n=t.length,i=Kn(r,n);e.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTextureCube(t[a]||Gn,i[a])}function Mi(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Jn;case 35664:return $n;case 35665:return ei;case 35666:return ti;case 35674:return ri;case 35675:return ni;case 35676:return ii;case 35678:case 36198:return ai;case 35679:return si;case 35680:return li;case 36289:return oi;case 5124:case 35670:return ci;case 35667:case 35671:return ui;case 35668:case 35672:return hi;case 35669:case 35673:return di}}(t.type)}function Si(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return pi;case 35664:return yi;case 35665:return Ei;case 35666:return xi;case 35674:return bi;case 35675:return Ti;case 35676:return wi;case 35678:return _i;case 35680:return Ri;case 5124:case 35670:return fi;case 35667:case 35671:return mi;case 35668:case 35672:return vi;case 35669:case 35673:return gi}}(t.type)}function Ai(e){this.id=e,this.seq=[],this.map={}}Si.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Zn(t,e)},Ai.prototype.setValue=function(e,t,r){for(var n=this.seq,i=0,a=n.length;i!==a;++i){var o=n[i];o.setValue(e,t[o.id],r)}};var Pi=/([\w\d_]+)(\])?(\[|\.)?/g;function Li(e,t){e.seq.push(t),e.map[t.id]=t}function Ci(e,t,r){var n=e.name,i=n.length;for(Pi.lastIndex=0;;){var a=Pi.exec(n),o=Pi.lastIndex,s=a[1],l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===i){Li(r,void 0===c?new Mi(s,e,t):new Si(s,e,t));break}var u=r.map,h=u[s];void 0===h&&(h=new Ai(s),Li(r,h)),r=h}}function Hi(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,35718),n=0;n<r;++n){var i=e.getActiveUniform(t,n),a=e.getUniformLocation(t,i.name);Ci(i,a,this)}}function Ii(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),n}Hi.prototype.setValue=function(e,t,r,n){var i=this.map[t];void 0!==i&&i.setValue(e,r,n)},Hi.prototype.setOptional=function(e,t,r){var n=t[r];void 0!==n&&this.setValue(e,r,n)},Hi.upload=function(e,t,r,n){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=r[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,n)}},Hi.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var a=e[n];a.id in t&&r.push(a)}return r};var ki=0;function Oi(e){switch(e){case pt:return["Linear","( value )"];case ft:return["sRGB","( value )"];case vt:return["RGBE","( value )"];case gt:return["RGBM","( value, 7.0 )"];case yt:return["RGBM","( value, 16.0 )"];case Et:return["RGBD","( value, 256.0 )"];case mt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function Ni(e,t,r){var n=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(n&&""===i)return"";var a=e.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+i+function(e){for(var t=e.split("\n"),r=0;r<t.length;r++)t[r]=r+1+": "+t[r];return t.join("\n")}(a)}function Fi(e,t){var r=Oi(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function Di(e,t){var r;switch(t){case K:r="Linear";break;case J:r="Reinhard";break;case $:r="Uncharted2";break;case ee:r="OptimizedCineon";break;case te:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function zi(e){return""!==e}function Ui(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Bi(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function Gi(e){return e.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(e,t){var r=yn[t];if(void 0===r)throw new Error("Can not resolve #include <"+t+">");return Gi(r)})}function Vi(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,r,n){for(var i="",a=parseInt(t);a<parseInt(r);a++)i+=n.replace(/\[ i \]/g,"[ "+a+" ]");return i})}function ji(e,t,r,n,i,a,o){var s=e.context,l=n.defines,h=i.vertexShader,d=i.fragmentShader,p="SHADOWMAP_TYPE_BASIC";a.shadowMapType===c?p="SHADOWMAP_TYPE_PCF":a.shadowMapType===u&&(p="SHADOWMAP_TYPE_PCF_SOFT");var f="ENVMAP_TYPE_CUBE",m="ENVMAP_MODE_REFLECTION",v="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(n.envMap.mapping){case re:case ne:f="ENVMAP_TYPE_CUBE";break;case se:case le:f="ENVMAP_TYPE_CUBE_UV";break;case ie:case ae:f="ENVMAP_TYPE_EQUIREC";break;case oe:f="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case ne:case ae:m="ENVMAP_MODE_REFRACTION"}switch(n.combine){case Y:v="ENVMAP_BLENDING_MULTIPLY";break;case q:v="ENVMAP_BLENDING_MIX";break;case Q:v="ENVMAP_BLENDING_ADD"}}var g,y,E,x,b,T=e.gammaFactor>0?e.gammaFactor:1,w=o.isWebGL2?"":function(e,t,r){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(zi).join("\n")}(n.extensions,a,t),_=function(e){var t=[];for(var r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(l),R=s.createProgram();if(n.isRawShaderMaterial?((g=[_].filter(zi).join("\n")).length>0&&(g+="\n"),(y=[w,_].filter(zi).join("\n")).length>0&&(y+="\n")):(g=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,_,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+T,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(zi).join("\n"),y=[w,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+i.name,_,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+T,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.envMap?"#define "+m:"",a.envMap?"#define "+v:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+p:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==Z?"#define TONE_MAPPING":"",a.toneMapping!==Z?yn.tonemapping_pars_fragment:"",a.toneMapping!==Z?Di("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?yn.encodings_pars_fragment:"",a.mapEncoding?Fi("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?Fi("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?Fi("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?Fi("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(E="linearToOutputTexel",x=a.outputEncoding,b=Oi(x),"vec4 "+E+"( vec4 value ) { return LinearTo"+b[0]+b[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(zi).join("\n")),h=Bi(h=Ui(h=Gi(h),a),a),d=Bi(d=Ui(d=Gi(d),a),a),h=Vi(h),d=Vi(d),o.isWebGL2&&!n.isRawShaderMaterial){var M=!1,S=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==h.match(S)&&null!==d.match(S)&&(M=!0,h=h.replace(S,""),d=d.replace(S,"")),g=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#version 300 es\n","#define varying in",M?"":"out highp vec4 pc_fragColor;",M?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y}var A,P,L=g+h,C=y+d,H=Ii(s,35633,L),I=Ii(s,35632,C);if(s.attachShader(R,H),s.attachShader(R,I),void 0!==n.index0AttributeName?s.bindAttribLocation(R,0,n.index0AttributeName):!0===a.morphTargets&&s.bindAttribLocation(R,0,"position"),s.linkProgram(R),e.debug.checkShaderErrors){var k=s.getProgramInfoLog(R).trim(),O=s.getShaderInfoLog(H).trim(),N=s.getShaderInfoLog(I).trim(),F=!0,D=!0;if(!1===s.getProgramParameter(R,35714)){F=!1;var z=Ni(s,H,"vertex"),U=Ni(s,I,"fragment");console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(R,35715),"gl.getProgramInfoLog",k,z,U)}else""!==k?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",k):""!==O&&""!==N||(D=!1);D&&(this.diagnostics={runnable:F,material:n,programLog:k,vertexShader:{log:O,prefix:g},fragmentShader:{log:N,prefix:y}})}return s.deleteShader(H),s.deleteShader(I),this.getUniforms=function(){return void 0===A&&(A=new Hi(s,R)),A},this.getAttributes=function(){return void 0===P&&(P=function(e,t){for(var r={},n=e.getProgramParameter(t,35721),i=0;i<n;i++){var a=e.getActiveAttrib(t,i),o=a.name;r[o]=e.getAttribLocation(t,o)}return r}(s,R)),P},this.destroy=function(){s.deleteProgram(R),this.program=void 0},this.name=i.name,this.id=ki++,this.code=r,this.usedTimes=1,this.program=R,this.vertexShader=H,this.fragmentShader=I,this}function Wi(e,t,r){var n=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},a=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function o(e,t){var r;return e?e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding):r=pt,r===pt&&t&&(r=mt),r}this.getParameters=function(t,n,a,s,l,c,u){var h=i[t.type],f=u.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(r.floatVertexTextures)return 1024;var n=r.maxVertexUniforms,i=Math.floor((n-20)/4),a=Math.min(i,t.length);return a<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+a+"."),0):a}(u):0,m=r.precision;null!==t.precision&&(m=r.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",m,"instead.");var v=e.getRenderTarget(),g={shaderID:h,precision:m,supportsVertexTextures:r.vertexTextures,outputEncoding:o(v?v.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:o(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:o(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:o(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===se||t.envMap.mapping===le),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:o(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===wt,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:r.logarithmicDepthBuffer,skinning:t.skinning&&f>0,maxBones:f,useVertexTexture:r.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.receiveShadow&&a.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===p,flipSided:t.side===d,depthPacking:void 0!==t.depthPacking&&t.depthPacking};return g},this.getProgramCode=function(t,r){var n=[];if(r.shaderID?n.push(r.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);for(var o=0;o<a.length;o++)n.push(r[a[o]]);return n.push(t.onBeforeCompile.toString()),n.push(e.gammaOutput),n.push(e.gammaFactor),n.join()},this.acquireProgram=function(i,a,o,s){for(var l,c=0,u=n.length;c<u;c++){var h=n[c];if(h.code===s){++(l=h).usedTimes;break}}return void 0===l&&(l=new ji(e,t,s,i,a,o,r),n.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function Xi(){var e=new WeakMap;return{get:function(t){var r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,n){e.get(t)[r]=n},dispose:function(){e=new WeakMap}}}function Yi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function qi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Qi(){var e=[],t=0,r=[],n=[],i={id:-1};function a(r,n,a,o,s,l){var c=e[t];return void 0===c?(c={id:r.id,object:r,geometry:n,material:a,program:a.program||i,groupOrder:o,renderOrder:r.renderOrder,z:s,group:l},e[t]=c):(c.id=r.id,c.object=r,c.geometry=n,c.material=a,c.program=a.program||i,c.groupOrder=o,c.renderOrder=r.renderOrder,c.z=s,c.group=l),t++,c}return{opaque:r,transparent:n,init:function(){t=0,r.length=0,n.length=0},push:function(e,t,i,o,s,l){var c=a(e,t,i,o,s,l);(!0===i.transparent?n:r).push(c)},unshift:function(e,t,i,o,s,l){var c=a(e,t,i,o,s,l);(!0===i.transparent?n:r).unshift(c)},sort:function(){r.length>1&&r.sort(Yi),n.length>1&&n.sort(qi)}}}function Zi(){var e={};function t(r){var n=r.target;n.removeEventListener("dispose",t),delete e[n.id]}return{get:function(r,n){var i,a=e[r.id];return void 0===a?(i=new Qi,e[r.id]={},e[r.id][n.id]=i,r.addEventListener("dispose",t)):void 0===(i=a[n.id])&&(i=new Qi,a[n.id]=i),i},dispose:function(){e={}}}}function Ki(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var r;switch(t.type){case"DirectionalLight":r={direction:new St,color:new Rr,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Rt};break;case"SpotLight":r={position:new St,direction:new St,color:new Rr,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Rt};break;case"PointLight":r={position:new St,color:new Rr,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Rt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new St,skyColor:new Rr,groundColor:new Rr};break;case"RectAreaLight":r={color:new Rr,position:new St,halfWidth:new St,halfHeight:new St}}return e[t.id]=r,r}}}var Ji=0;function $i(){for(var e=new Ki,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},r=0;r<9;r++)t.probe.push(new St);var n=new St,i=new Wt,a=new Wt;return{setup:function(r,o,s){for(var l=0,c=0,u=0,h=0;h<9;h++)t.probe[h].set(0,0,0);for(var d=0,p=0,f=0,m=0,v=0,g=s.matrixWorldInverse,h=0,y=r.length;h<y;h++){var E=r[h],x=E.color,b=E.intensity,T=E.distance,w=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)l+=x.r*b,c+=x.g*b,u+=x.b*b;else if(E.isLightProbe)for(var _=0;_<9;_++)t.probe[_].addScaledVector(E.sh.coefficients[_],b);else if(E.isDirectionalLight){var R=e.get(E);if(R.color.copy(E.color).multiplyScalar(E.intensity),R.direction.setFromMatrixPosition(E.matrixWorld),n.setFromMatrixPosition(E.target.matrixWorld),R.direction.sub(n),R.direction.transformDirection(g),R.shadow=E.castShadow,E.castShadow){var M=E.shadow;R.shadowBias=M.bias,R.shadowRadius=M.radius,R.shadowMapSize=M.mapSize}t.directionalShadowMap[d]=w,t.directionalShadowMatrix[d]=E.shadow.matrix,t.directional[d]=R,d++}else if(E.isSpotLight){var R=e.get(E);if(R.position.setFromMatrixPosition(E.matrixWorld),R.position.applyMatrix4(g),R.color.copy(x).multiplyScalar(b),R.distance=T,R.direction.setFromMatrixPosition(E.matrixWorld),n.setFromMatrixPosition(E.target.matrixWorld),R.direction.sub(n),R.direction.transformDirection(g),R.coneCos=Math.cos(E.angle),R.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),R.decay=E.decay,R.shadow=E.castShadow,E.castShadow){var M=E.shadow;R.shadowBias=M.bias,R.shadowRadius=M.radius,R.shadowMapSize=M.mapSize}t.spotShadowMap[f]=w,t.spotShadowMatrix[f]=E.shadow.matrix,t.spot[f]=R,f++}else if(E.isRectAreaLight){var R=e.get(E);R.color.copy(x).multiplyScalar(b),R.position.setFromMatrixPosition(E.matrixWorld),R.position.applyMatrix4(g),a.identity(),i.copy(E.matrixWorld),i.premultiply(g),a.extractRotation(i),R.halfWidth.set(.5*E.width,0,0),R.halfHeight.set(0,.5*E.height,0),R.halfWidth.applyMatrix4(a),R.halfHeight.applyMatrix4(a),t.rectArea[m]=R,m++}else if(E.isPointLight){var R=e.get(E);if(R.position.setFromMatrixPosition(E.matrixWorld),R.position.applyMatrix4(g),R.color.copy(E.color).multiplyScalar(E.intensity),R.distance=E.distance,R.decay=E.decay,R.shadow=E.castShadow,E.castShadow){var M=E.shadow;R.shadowBias=M.bias,R.shadowRadius=M.radius,R.shadowMapSize=M.mapSize,R.shadowCameraNear=M.camera.near,R.shadowCameraFar=M.camera.far}t.pointShadowMap[p]=w,t.pointShadowMatrix[p]=E.shadow.matrix,t.point[p]=R,p++}else if(E.isHemisphereLight){var R=e.get(E);R.direction.setFromMatrixPosition(E.matrixWorld),R.direction.transformDirection(g),R.direction.normalize(),R.skyColor.copy(E.color).multiplyScalar(b),R.groundColor.copy(E.groundColor).multiplyScalar(b),t.hemi[v]=R,v++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=u;var S=t.hash;S.directionalLength===d&&S.pointLength===p&&S.spotLength===f&&S.rectAreaLength===m&&S.hemiLength===v&&S.shadowsLength===o.length||(t.directional.length=d,t.spot.length=f,t.rectArea.length=m,t.point.length=p,t.hemi.length=v,S.directionalLength=d,S.pointLength=p,S.spotLength=f,S.rectAreaLength=m,S.hemiLength=v,S.shadowsLength=o.length,t.version=Ji++)},state:t}}function ea(){var e=new $i,t=[],r=[],n={lightsArray:t,shadowsArray:r,lights:e};return{init:function(){t.length=0,r.length=0},state:n,setupLights:function(n){e.setup(t,r,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){r.push(e)}}}function ta(){var e={};function t(r){var n=r.target;n.removeEventListener("dispose",t),delete e[n.id]}return{get:function(r,n){var i;return void 0===e[r.id]?(i=new ea,e[r.id]={},e[r.id][n.id]=i,r.addEventListener("dispose",t)):void 0===e[r.id][n.id]?(i=new ea,e[r.id][n.id]=i):i=e[r.id][n.id],i},dispose:function(){e={}}}}function ra(e){Cr.call(this),this.type="MeshDepthMaterial",this.depthPacking=xt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function na(e){Cr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new St,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function ia(e,t,r){for(var n=new gn,i=new Wt,a=new Rt,o=new Rt(r,r),s=new St,l=new St,u=1,f=2,m=1+(u|f),v=new Array(m),y=new Array(m),E={},x={0:d,1:h,2:p},b=[new St(1,0,0),new St(-1,0,0),new St(0,0,1),new St(0,0,-1),new St(0,1,0),new St(0,-1,0)],T=[new St(0,1,0),new St(0,1,0),new St(0,1,0),new St(0,1,0),new St(0,0,1),new St(0,0,-1)],w=[new Gt,new Gt,new Gt,new Gt,new Gt,new Gt],_=0;_!==m;++_){var R=0!=(_&u),M=0!=(_&f),S=new ra({depthPacking:bt,morphTargets:R,skinning:M});v[_]=S;var A=new na({morphTargets:R,skinning:M});y[_]=A}var P=this;function L(t,r,n,i,a,o){var s=t.geometry,l=null,c=v,h=t.customDepthMaterial;if(n&&(c=y,h=t.customDistanceMaterial),h)l=h;else{var d=!1;r.morphTargets&&(s&&s.isBufferGeometry?d=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(d=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===r.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var p=t.isSkinnedMesh&&r.skinning,m=0;d&&(m|=u),p&&(m|=f),l=c[m]}if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var g=l.uuid,b=r.uuid,T=E[g];void 0===T&&(T={},E[g]=T);var w=T[b];void 0===w&&(w=l.clone(),T[b]=w),l=w}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=null!=r.shadowSide?r.shadowSide:x[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,n&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(i),l.nearDistance=a,l.farDistance=o),l}function C(r,i,a,o){if(!1!==r.visible){var s=r.layers.test(i.layers);if(s&&(r.isMesh||r.isLine||r.isPoints)&&r.castShadow&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);var c=t.update(r),u=r.material;if(Array.isArray(u))for(var h=c.groups,d=0,p=h.length;d<p;d++){var f=h[d],m=u[f.materialIndex];if(m&&m.visible){var v=L(r,m,o,l,a.near,a.far);e.renderBufferDirect(a,null,c,v,r,f)}}else if(u.visible){var v=L(r,u,o,l,a.near,a.far);e.renderBufferDirect(a,null,c,v,r,null)}}for(var g=r.children,y=0,E=g.length;y<E;y++)C(g[y],i,a,o)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=c,this.render=function(t,r,c){if(!1!==P.enabled&&(!1!==P.autoUpdate||!1!==P.needsUpdate)&&0!==t.length){var u,h=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipMapLevel(),f=e.state;f.setBlending(g),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var m=0,v=t.length;m<v;m++){var y=t[m],E=y.shadow,x=y&&y.isPointLight;if(void 0!==E){var _=E.camera;if(a.copy(E.mapSize),a.min(o),x){var R=a.x,M=a.y;w[0].set(2*R,M,R,M),w[1].set(0,M,R,M),w[2].set(3*R,M,R,M),w[3].set(R,M,R,M),w[4].set(3*R,0,R,M),w[5].set(R,0,R,M),a.x*=4,a.y*=2}if(null===E.map){var S={minFilter:de,magFilter:de,format:He};E.map=new Vt(a.x,a.y,S),E.map.texture.name=y.name+".shadowMap",_.updateProjectionMatrix()}E.isSpotLightShadow&&E.update(y);var A=E.map,L=E.matrix;l.setFromMatrixPosition(y.matrixWorld),_.position.copy(l),x?(u=6,L.makeTranslation(-l.x,-l.y,-l.z)):(u=1,s.setFromMatrixPosition(y.target.matrixWorld),_.lookAt(s),_.updateMatrixWorld(),L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),L.multiply(_.projectionMatrix),L.multiply(_.matrixWorldInverse)),e.setRenderTarget(A),e.clear();for(var H=0;H<u;H++){if(x){s.copy(_.position),s.add(b[H]),_.up.copy(T[H]),_.lookAt(s),_.updateMatrixWorld();var I=w[H];f.viewport(I)}i.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),n.setFromMatrix(i),C(r,c,_,x)}}else console.warn("THREE.WebGLShadowMap:",y,"has no shadow.")}P.needsUpdate=!1,e.setRenderTarget(h,d,p)}}}function aa(e,t,r,n){var i=new function(){var t=!1,r=new Gt,n=null,i=new Gt(0,0,0,0);return{setMask:function(r){n===r||t||(e.colorMask(r,r,r,r),n=r)},setLocked:function(e){t=e},setClear:function(t,n,a,o,s){!0===s&&(t*=o,n*=o,a*=o),r.set(t,n,a,o),!1===i.equals(r)&&(e.clearColor(t,n,a,o),i.copy(r))},reset:function(){t=!1,n=null,i.set(-1,0,0,0)}}},a=new function(){var t=!1,r=null,n=null,i=null;return{setTest:function(e){e?ae(2929):oe(2929)},setMask:function(n){r===n||t||(e.depthMask(n),r=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case z:e.depthFunc(512);break;case U:e.depthFunc(519);break;case B:e.depthFunc(513);break;case G:e.depthFunc(515);break;case V:e.depthFunc(514);break;case j:e.depthFunc(518);break;case W:e.depthFunc(516);break;case X:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,r=null,n=null,i=null}}},c=new function(){var t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){e?ae(2960):oe(2960)},setMask:function(n){r===n||t||(e.stencilMask(n),r=n)},setFunc:function(t,r,o){n===t&&i===r&&a===o||(e.stencilFunc(t,r,o),n=t,i=r,a=o)},setOp:function(t,r,n){o===t&&s===r&&l===n||(e.stencilOp(t,r,n),o=t,s=r,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,r=null,n=null,i=null,a=null,o=null,s=null,l=null,c=null}}},u=e.getParameter(34921),h=new Uint8Array(u),f=new Uint8Array(u),m=new Uint8Array(u),v={},_=null,R=null,M=null,S=null,A=null,P=null,L=null,C=null,H=null,I=null,k=!1,O=null,N=null,F=null,D=null,Y=null,q=e.getParameter(35661),Q=!1,Z=0,K=e.getParameter(7938);-1!==K.indexOf("WebGL")?(Z=parseFloat(/^WebGL\ ([0-9])/.exec(K)[1]),Q=Z>=1):-1!==K.indexOf("OpenGL ES")&&(Z=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(K)[1]),Q=Z>=2);var J=null,$={},ee=new Gt,te=new Gt;function re(t,r,n){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<n;o++)e.texImage2D(r+o,0,6408,1,1,0,6408,5121,i);return a}var ne={};function ie(r,i){if(h[r]=1,0===f[r]&&(e.enableVertexAttribArray(r),f[r]=1),m[r]!==i){var a=n.isWebGL2?e:t.get("ANGLE_instanced_arrays");a[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),m[r]=i}}function ae(t){!0!==v[t]&&(e.enable(t),v[t]=!0)}function oe(t){!1!==v[t]&&(e.disable(t),v[t]=!1)}function se(t,n,i,a,o,s,l,c){if(t!==g){if(M||(ae(3042),M=!0),t===T)o=o||n,s=s||i,l=l||a,n===A&&o===C||(e.blendEquationSeparate(r.convert(n),r.convert(o)),A=n,C=o),i===P&&a===L&&s===H&&l===I||(e.blendFuncSeparate(r.convert(i),r.convert(a),r.convert(s),r.convert(l)),P=i,L=a,H=s,I=l),S=t,k=null;else if(t!==S||c!==k){if(A===w&&C===w||(e.blendEquation(32774),A=w,C=w),c)switch(t){case y:e.blendFuncSeparate(1,771,1,771);break;case E:e.blendFunc(1,1);break;case x:e.blendFuncSeparate(0,0,769,771);break;case b:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case y:e.blendFuncSeparate(770,771,1,771);break;case E:e.blendFunc(770,1);break;case x:e.blendFunc(0,769);break;case b:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}P=null,L=null,H=null,I=null,S=t,k=c}}else M&&(oe(3042),M=!1)}function le(t){O!==t&&(t?e.frontFace(2304):e.frontFace(2305),O=t)}function ce(t){t!==o?(ae(2884),t!==N&&(t===s?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):oe(2884),N=t}function ue(t,r,n){t?(ae(32823),D===r&&Y===n||(e.polygonOffset(r,n),D=r,Y=n)):oe(32823)}function he(t){void 0===t&&(t=33984+q-1),J!==t&&(e.activeTexture(t),J=t)}return ne[3553]=re(3553,3553,1),ne[34067]=re(34067,34069,6),i.setClear(0,0,0,1),a.setClear(1),c.setClear(0),ae(2929),a.setFunc(G),le(!1),ce(s),ae(2884),se(g),{buffers:{color:i,depth:a,stencil:c},initAttributes:function(){for(var e=0,t=h.length;e<t;e++)h[e]=0},enableAttribute:function(e){ie(e,0)},enableAttributeAndDivisor:ie,disableUnusedAttributes:function(){for(var t=0,r=f.length;t!==r;++t)f[t]!==h[t]&&(e.disableVertexAttribArray(t),f[t]=0)},enable:ae,disable:oe,getCompressedTextureFormats:function(){if(null===_&&(_=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var r=e.getParameter(34467),n=0;n<r.length;n++)_.push(r[n]);return _},useProgram:function(t){return R!==t&&(e.useProgram(t),R=t,!0)},setBlending:se,setMaterial:function(e,t){e.side===p?oe(2884):ae(2884);var r=e.side===d;t&&(r=!r),le(r),e.blending===y&&!1===e.transparent?se(g):se(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),i.setMask(e.colorWrite),ue(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:le,setCullFace:ce,setLineWidth:function(t){t!==F&&(Q&&e.lineWidth(t),F=t)},setPolygonOffset:ue,setScissorTest:function(e){e?ae(3089):oe(3089)},activeTexture:he,bindTexture:function(t,r){null===J&&he();var n=$[J];void 0===n&&(n={type:void 0,texture:void 0},$[J]=n),n.type===t&&n.texture===r||(e.bindTexture(t,r||ne[t]),n.type=t,n.texture=r)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===ee.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ee.copy(t))},viewport:function(t){!1===te.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),te.copy(t))},reset:function(){for(var t=0;t<f.length;t++)1===f[t]&&(e.disableVertexAttribArray(t),f[t]=0);v={},_=null,J=null,$={},R=null,S=null,O=null,N=null,i.reset(),a.reset(),c.reset()}}}function oa(e,t,r,n,i,a,o){var s,l={},c="undefined"!=typeof OffscreenCanvas;function u(e,t){return c?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function h(e,t,r,n){var i=1;if((e.width>n||e.height>n)&&(i=n/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?_t.floorPowerOfTwo:Math.floor,o=a(i*e.width),l=a(i*e.height);void 0===s&&(s=u(o,l));var c=r?u(o,l):s;c.width=o,c.height=l;var h=c.getContext("2d");return h.drawImage(e,0,0,o,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+l+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function d(e){return _t.isPowerOfTwo(e.width)&&_t.isPowerOfTwo(e.height)}function p(e,t){return e.generateMipmaps&&t&&e.minFilter!==de&&e.minFilter!==me}function f(t,r,i,a){e.generateMipmap(t);var o=n.get(r);o.__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function m(e,r){if(!i.isWebGL2)return e;var n=e;return 6403===e&&(5126===r&&(n=33326),5131===r&&(n=33325),5121===r&&(n=33321)),6407===e&&(5126===r&&(n=34837),5131===r&&(n=34843),5121===r&&(n=32849)),6408===e&&(5126===r&&(n=34836),5131===r&&(n=34842),5121===r&&(n=32856)),33325===n||33326===n||34842===n||34836===n?t.get("EXT_color_buffer_float"):34843!==n&&34837!==n||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),n}function v(e){return e===de||e===pe||e===fe?9728:9729}function g(t){var r=t.target;r.removeEventListener("dispose",g),function(t){var r=n.get(t);void 0!==r.__webglInit&&(e.deleteTexture(r.__webglTexture),n.remove(t))}(r),r.isVideoTexture&&delete l[r.id],o.memory.textures--}function y(t){var r=t.target;r.removeEventListener("dispose",y),function(t){var r=n.get(t),i=n.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[a]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}}(r),o.memory.textures--}var E=0;function x(e,t){var i=n.get(e);if(e.isVideoTexture&&function(e){var t=e.id,r=o.render.frame;l[t]!==r&&(l[t]=r,e.update())}(e),e.version>0&&i.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void R(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+t),r.bindTexture(3553,i.__webglTexture)}function b(t,o){var s=n.get(t);if(6===t.image.length)if(t.version>0&&s.__version!==t.version){_(s,t),r.activeTexture(33984+o),r.bindTexture(34067,s.__webglTexture),e.pixelStorei(37440,t.flipY);for(var l=t&&t.isCompressedTexture,c=t.image[0]&&t.image[0].isDataTexture,u=[],v=0;v<6;v++)u[v]=l||c?c?t.image[v].image:t.image[v]:h(t.image[v],!1,!0,i.maxCubemapSize);var g=u[0],y=d(g)||i.isWebGL2,E=a.convert(t.format),x=a.convert(t.type),b=m(E,x);w(34067,t,y);for(var v=0;v<6;v++)if(l)for(var T,R=u[v].mipmaps,M=0,S=R.length;M<S;M++)T=R[M],t.format!==He&&t.format!==Ce?r.getCompressedTextureFormats().indexOf(E)>-1?r.compressedTexImage2D(34069+v,M,b,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+v,M,b,T.width,T.height,0,E,x,T.data);else c?r.texImage2D(34069+v,0,b,u[v].width,u[v].height,0,E,x,u[v].data):r.texImage2D(34069+v,0,b,E,x,u[v]);s.__maxMipLevel=l?R.length-1:0,p(t,y)&&f(34067,t,g.width,g.height),s.__version=t.version,t.onUpdate&&t.onUpdate(t)}else r.activeTexture(33984+o),r.bindTexture(34067,s.__webglTexture)}function T(e,t){r.activeTexture(33984+t),r.bindTexture(34067,n.get(e).__webglTexture)}function w(r,o,s){var l;if(s?(e.texParameteri(r,10242,a.convert(o.wrapS)),e.texParameteri(r,10243,a.convert(o.wrapT)),32879!==r&&35866!==r||e.texParameteri(r,32882,a.convert(o.wrapR)),e.texParameteri(r,10240,a.convert(o.magFilter)),e.texParameteri(r,10241,a.convert(o.minFilter))):(e.texParameteri(r,10242,33071),e.texParameteri(r,10243,33071),32879!==r&&35866!==r||e.texParameteri(r,32882,33071),o.wrapS===ue&&o.wrapT===ue||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,10240,v(o.magFilter)),e.texParameteri(r,10241,v(o.minFilter)),o.minFilter!==de&&o.minFilter!==me&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),l=t.get("EXT_texture_filter_anisotropic")){if(o.type===_e&&null===t.get("OES_texture_float_linear"))return;if(o.type===Re&&null===(i.isWebGL2||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||n.get(o).__currentAnisotropy)&&(e.texParameterf(r,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy)}}function _(t,r){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",g),t.__webglTexture=e.createTexture(),o.memory.textures++)}function R(t,n,o){var s=3553;n.isDataTexture2DArray&&(s=35866),n.isDataTexture3D&&(s=32879),_(t,n),r.activeTexture(33984+o),r.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment);var l=function(e){return!i.isWebGL2&&(e.wrapS!==ue||e.wrapT!==ue||e.minFilter!==de&&e.minFilter!==me)}(n)&&!1===d(n.image),c=h(n.image,l,!1,i.maxTextureSize),u=d(c)||i.isWebGL2,v=a.convert(n.format),g=a.convert(n.type),y=m(v,g);w(s,n,u);var E,x=n.mipmaps;if(n.isDepthTexture){if(y=6402,n.type===_e){if(!i.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");y=36012}else i.isWebGL2&&(y=33189);n.format===Ne&&6402===y&&n.type!==be&&n.type!==we&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=be,g=a.convert(n.type)),n.format===Fe&&(y=34041,n.type!==Pe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Pe,g=a.convert(n.type))),r.texImage2D(3553,0,y,c.width,c.height,0,v,g,null)}else if(n.isDataTexture)if(x.length>0&&u){for(var b=0,T=x.length;b<T;b++)E=x[b],r.texImage2D(3553,b,y,E.width,E.height,0,v,g,E.data);n.generateMipmaps=!1,t.__maxMipLevel=x.length-1}else r.texImage2D(3553,0,y,c.width,c.height,0,v,g,c.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(var b=0,T=x.length;b<T;b++)E=x[b],n.format!==He&&n.format!==Ce?r.getCompressedTextureFormats().indexOf(v)>-1?r.compressedTexImage2D(3553,b,y,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,b,y,E.width,E.height,0,v,g,E.data);t.__maxMipLevel=x.length-1}else if(n.isDataTexture2DArray)r.texImage3D(35866,0,y,c.width,c.height,c.depth,0,v,g,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(32879,0,y,c.width,c.height,c.depth,0,v,g,c.data),t.__maxMipLevel=0;else if(x.length>0&&u){for(var b=0,T=x.length;b<T;b++)E=x[b],r.texImage2D(3553,b,y,v,g,E);n.generateMipmaps=!1,t.__maxMipLevel=x.length-1}else r.texImage2D(3553,0,y,v,g,c),t.__maxMipLevel=0;p(n,u)&&f(3553,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function M(t,i,o,s){var l=a.convert(i.texture.format),c=a.convert(i.texture.type),u=m(l,c);r.texImage2D(s,0,u,i.width,i.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,n.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function S(t,r,n){if(e.bindRenderbuffer(36161,t),r.depthBuffer&&!r.stencilBuffer){if(n){var i=P(r);e.renderbufferStorageMultisample(36161,i,33189,r.width,r.height)}else e.renderbufferStorage(36161,33189,r.width,r.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(r.depthBuffer&&r.stencilBuffer){if(n){var i=P(r);e.renderbufferStorageMultisample(36161,i,35056,r.width,r.height)}else e.renderbufferStorage(36161,34041,r.width,r.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var o=a.convert(r.texture.format),s=a.convert(r.texture.type),l=m(o,s);if(n){var i=P(r);e.renderbufferStorageMultisample(36161,i,l,r.width,r.height)}else e.renderbufferStorage(36161,l,r.width,r.height)}e.bindRenderbuffer(36161,null)}function A(t){var r=n.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),x(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Ne)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(r.depthTexture.format!==Fe)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(r.__webglFramebuffer,t)}else if(i){r.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=e.createRenderbuffer(),S(r.__webglDepthbuffer[a],t)}else e.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),S(r.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function P(e){return i.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(i.maxSamples,e.samples):0}var L=!1,C=!1;this.allocateTextureUnit=function(){var e=E;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=x,this.setTexture2DArray=function(e,t){var i=n.get(e);e.version>0&&i.__version!==e.version?R(i,e,t):(r.activeTexture(33984+t),r.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=n.get(e);e.version>0&&i.__version!==e.version?R(i,e,t):(r.activeTexture(33984+t),r.bindTexture(32879,i.__webglTexture))},this.setTextureCube=b,this.setTextureCubeDynamic=T,this.setupRenderTarget=function(t){var s=n.get(t),l=n.get(t.texture);t.addEventListener("dispose",y),l.__webglTexture=e.createTexture(),o.memory.textures++;var c=!0===t.isWebGLRenderTargetCube,u=!0===t.isWebGLMultisampleRenderTarget,h=d(t)||i.isWebGL2;if(c){s.__webglFramebuffer=[];for(var v=0;v<6;v++)s.__webglFramebuffer[v]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),u)if(i.isWebGL2){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var g=a.convert(t.texture.format),E=a.convert(t.texture.type),x=m(g,E),b=P(t);e.renderbufferStorageMultisample(36161,b,x,t.width,t.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),S(s.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){r.bindTexture(34067,l.__webglTexture),w(34067,t.texture,h);for(var v=0;v<6;v++)M(s.__webglFramebuffer[v],t,36064,34069+v);p(t.texture,h)&&f(34067,t.texture,t.width,t.height),r.bindTexture(34067,null)}else r.bindTexture(3553,l.__webglTexture),w(3553,t.texture,h),M(s.__webglFramebuffer,t,36064,3553),p(t.texture,h)&&f(3553,t.texture,t.width,t.height),r.bindTexture(3553,null);t.depthBuffer&&A(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture,a=d(e)||i.isWebGL2;if(p(t,a)){var o=e.isWebGLRenderTargetCube?34067:3553,s=n.get(t).__webglTexture;r.bindTexture(o,s),f(o,t,e.width,e.height),r.bindTexture(o,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(i.isWebGL2){var r=n.get(t);e.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,r.__webglFramebuffer);var a=t.width,o=t.height,s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024),e.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===L&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),L=!0),e=e.texture),x(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLRenderTargetCube&&(!1===C&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),C=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?b(e,t):T(e,t)}}function sa(e,t,r){return{convert:function(e){var n;if(e===ce)return 10497;if(e===ue)return 33071;if(e===he)return 33648;if(e===de)return 9728;if(e===pe)return 9984;if(e===fe)return 9986;if(e===me)return 9729;if(e===ve)return 9985;if(e===ge)return 9987;if(e===ye)return 5121;if(e===Me)return 32819;if(e===Se)return 32820;if(e===Ae)return 33635;if(e===Ee)return 5120;if(e===xe)return 5122;if(e===be)return 5123;if(e===Te)return 5124;if(e===we)return 5125;if(e===_e)return 5126;if(e===Re){if(r.isWebGL2)return 5131;if(null!==(n=t.get("OES_texture_half_float")))return n.HALF_FLOAT_OES}if(e===Le)return 6406;if(e===Ce)return 6407;if(e===He)return 6408;if(e===Ie)return 6409;if(e===ke)return 6410;if(e===Ne)return 6402;if(e===Fe)return 34041;if(e===De)return 6403;if(e===w)return 32774;if(e===_)return 32778;if(e===R)return 32779;if(e===A)return 0;if(e===P)return 1;if(e===L)return 768;if(e===C)return 769;if(e===H)return 770;if(e===I)return 771;if(e===k)return 772;if(e===O)return 773;if(e===N)return 774;if(e===F)return 775;if(e===D)return 776;if((e===ze||e===Ue||e===Be||e===Ge)&&null!==(n=t.get("WEBGL_compressed_texture_s3tc"))){if(e===ze)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ue)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Be)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Ge)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===Ve||e===je||e===We||e===Xe)&&null!==(n=t.get("WEBGL_compressed_texture_pvrtc"))){if(e===Ve)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===je)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===We)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Xe)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===Ye&&null!==(n=t.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((e===qe||e===Qe||e===Ze||e===Ke||e===Je||e===$e||e===et||e===tt||e===rt||e===nt||e===it||e===at||e===ot||e===st)&&null!==(n=t.get("WEBGL_compressed_texture_astc")))return e;if(e===M||e===S){if(r.isWebGL2){if(e===M)return 32775;if(e===S)return 32776}if(null!==(n=t.get("EXT_blend_minmax"))){if(e===M)return n.MIN_EXT;if(e===S)return n.MAX_EXT}}if(e===Pe){if(r.isWebGL2)return 34042;if(null!==(n=t.get("WEBGL_depth_texture")))return n.UNSIGNED_INT_24_8_WEBGL}return 0}}}function la(){mr.call(this),this.type="Group"}function ca(e){ln.call(this),this.cameras=e||[]}ra.prototype=Object.create(Cr.prototype),ra.prototype.constructor=ra,ra.prototype.isMeshDepthMaterial=!0,ra.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},na.prototype=Object.create(Cr.prototype),na.prototype.constructor=na,na.prototype.isMeshDistanceMaterial=!0,na.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},la.prototype=Object.assign(Object.create(mr.prototype),{constructor:la,isGroup:!0}),ca.prototype=Object.assign(Object.create(ln.prototype),{constructor:ca,isArrayCamera:!0});var ua,ha,da,pa,fa,ma,va=new St,ga=new St;function ya(e,t,r){va.setFromMatrixPosition(t.matrixWorld),ga.setFromMatrixPosition(r.matrixWorld);var n=va.distanceTo(ga),i=t.projectionMatrix.elements,a=r.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*u,p=o*h,f=n/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var v=o+f,g=s+f,y=d-m,E=p+(n-m),x=l*s/g*v,b=c*s/g*v;e.projectionMatrix.makePerspective(y,E,x,b,v,g)}function Ea(e){var t,r,n=this,i=null,a=null,o=null,s=[],l=new Wt,c=new Wt,u=1,h="local-floor";"undefined"!=typeof window&&"VRFrameData"in window&&(a=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",b,!1));var d=new Wt,p=new Mt,f=new St,m=new ln;m.viewport=new Gt,m.layers.enable(1);var v=new ln;v.viewport=new Gt,v.layers.enable(2);var g=new ca([m,v]);function y(){return null!==i&&!0===i.isPresenting}g.layers.enable(1),g.layers.enable(2);var E,x=new Rt;function b(){if(y()){var a=i.getEyeParameters("left");t=2*a.renderWidth*u,r=a.renderHeight*u,E=e.getPixelRatio(),e.getSize(x),e.setDrawingBufferSize(t,r,1),m.viewport.set(0,0,t/2,r),v.viewport.set(t/2,0,t/2,r),R.start(),n.dispatchEvent({type:"sessionstart"})}else n.enabled&&e.setDrawingBufferSize(x.width,x.height,E),R.stop(),n.dispatchEvent({type:"sessionend"})}var T=[];function w(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),r=0,n=0,i=t.length;r<i;r++){var a=t[r];if(a&&("Daydream Controller"===a.id||"Gear VR Controller"===a.id||"Oculus Go Controller"===a.id||"OpenVR Gamepad"===a.id||a.id.startsWith("Oculus Touch")||a.id.startsWith("HTC Vive Focus")||a.id.startsWith("Spatial Controller"))){if(n===e)return a;n++}}}function _(e,n){null!==n&&4===n.length&&e.set(n[0]*t,n[1]*r,n[2]*t,n[3]*r)}this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new la).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.getDevice=function(){return i},this.setDevice=function(e){void 0!==e&&(i=e),R.setContext(e)},this.setFramebufferScaleFactor=function(e){u=e},this.setReferenceSpaceType=function(e){h=e},this.setPoseTarget=function(e){void 0!==e&&(o=e)},this.getCamera=function(e){var t="local-floor"===h?1.6:0;if(!1===y())return e.position.set(0,t,0),e.rotation.set(0,0,0),e;if(i.depthNear=e.near,i.depthFar=e.far,i.getFrameData(a),"local-floor"===h){var r=i.stageParameters;r?l.fromArray(r.sittingToStandingTransform):l.makeTranslation(0,t,0)}var n=a.pose,u=null!==o?o:e;u.matrix.copy(l),u.matrix.decompose(u.position,u.quaternion,u.scale),null!==n.orientation&&(p.fromArray(n.orientation),u.quaternion.multiply(p)),null!==n.position&&(p.setFromRotationMatrix(l),f.fromArray(n.position),f.applyQuaternion(p),u.position.add(f)),u.updateMatrixWorld(),m.near=e.near,v.near=e.near,m.far=e.far,v.far=e.far,m.matrixWorldInverse.fromArray(a.leftViewMatrix),v.matrixWorldInverse.fromArray(a.rightViewMatrix),c.getInverse(l),"local-floor"===h&&(m.matrixWorldInverse.multiply(c),v.matrixWorldInverse.multiply(c));var E=u.parent;null!==E&&(d.getInverse(E.matrixWorld),m.matrixWorldInverse.multiply(d),v.matrixWorldInverse.multiply(d)),m.matrixWorld.getInverse(m.matrixWorldInverse),v.matrixWorld.getInverse(v.matrixWorldInverse),m.projectionMatrix.fromArray(a.leftProjectionMatrix),v.projectionMatrix.fromArray(a.rightProjectionMatrix),ya(g,m,v);var x=i.getLayers();if(x.length){var b=x[0];_(m.viewport,b.leftBounds),_(v.viewport,b.rightBounds)}return function(){for(var e=0;e<s.length;e++){var t=s[e],r=w(e);if(void 0!==r&&void 0!==r.pose){if(null===r.pose)return;var n=r.pose;!1===n.hasPosition&&t.position.set(.2,-.6,-.05),null!==n.position&&t.position.fromArray(n.position),null!==n.orientation&&t.quaternion.fromArray(n.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(l),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var i="Daydream Controller"===r.id?0:1;void 0===T[e]&&(T[e]=!1),T[e]!==r.buttons[i].pressed&&(T[e]=r.buttons[i].pressed,!0===T[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),g},this.getStandingMatrix=function(){return l},this.isPresenting=y;var R=new bn;this.setAnimationLoop=function(e){R.setAnimationLoop(e),y()&&R.start()},this.submitFrame=function(){y()&&i.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",b)},this.setFrameOfReferenceType=function(){console.warn("THREE.WebVRManager: setFrameOfReferenceType() has been deprecated.")}}function xa(e){var t=this,r=e.context,n=null,i=null,a="local-floor",o=null,s=[],l=[];function c(){return null!==n&&null!==i}var u=new ln;u.layers.enable(1),u.viewport=new Gt;var h=new ln;h.layers.enable(2),h.viewport=new Gt;var d=new ca([u,h]);function p(e){for(var t=0;t<s.length;t++)l[t]===e.inputSource&&s[t].dispatchEvent({type:e.type})}function f(){e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),y.stop(),t.dispatchEvent({type:"sessionend"})}function m(e){i=e,y.setContext(n),y.start(),t.dispatchEvent({type:"sessionstart"})}function v(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}d.layers.enable(1),d.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=s[e];return void 0===t&&((t=new la).matrixAutoUpdate=!1,t.visible=!1,s[e]=t),t},this.setFramebufferScaleFactor=function(e){},this.setReferenceSpaceType=function(e){a=e},this.getSession=function(){return n},this.setSession=function(e){null!==(n=e)&&(n.addEventListener("select",p),n.addEventListener("selectstart",p),n.addEventListener("selectend",p),n.addEventListener("end",f),n.updateRenderState({baseLayer:new XRWebGLLayer(n,r)}),n.requestReferenceSpace(a).then(m),l=n.inputSources,n.addEventListener("inputsourceschange",function(){l=n.inputSources,console.log(l);for(var e=0;e<s.length;e++){var t=s[e];t.userData.inputSource=l[e]}}))},this.getCamera=function(e){if(c()){var t=e.parent,r=d.cameras;v(d,t);for(var n=0;n<r.length;n++)v(r[n],t);e.matrixWorld.copy(d.matrixWorld);for(var i=e.children,n=0,a=i.length;n<a;n++)i[n].updateMatrixWorld(!0);return ya(d,u,h),d}return e},this.isPresenting=c;var g=null,y=new bn;y.setAnimationLoop(function(t,r){if(null!==(o=r.getViewerPose(i))){var a=o.views,c=n.renderState.baseLayer;e.setFramebuffer(c.framebuffer);for(var u=0;u<a.length;u++){var h=a[u],p=c.getViewport(h),f=h.transform.inverse.matrix,m=d.cameras[u];m.matrix.fromArray(f).getInverse(m.matrix),m.projectionMatrix.fromArray(h.projectionMatrix),m.viewport.set(p.x,p.y,p.width,p.height),0===u&&d.matrix.copy(m.matrix)}}for(var u=0;u<s.length;u++){var v=s[u],y=l[u];if(y){var E=r.getPose(y.targetRaySpace,i);if(null!==E){v.matrix.fromArray(E.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.visible=!0;continue}}v.visible=!1}g&&g(t)}),this.setAnimationLoop=function(e){g=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new Wt},this.getDevice=function(){console.warn("THREE.WebXRManager: getDevice() has been deprecated.")},this.setDevice=function(){console.warn("THREE.WebXRManager: setDevice() has been deprecated.")},this.setFrameOfReferenceType=function(){console.warn("THREE.WebXRManager: setFrameOfReferenceType() has been deprecated.")},this.submitFrame=function(){}}function ba(e){console.log("THREE.WebGLRenderer",a);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,l=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,p=null,f=null;this.domElement=t,this.context=null,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=K,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var m,v,g,y,E,x,b,T,w,_,R,M,S,A,P,L,C,H,I=this,k=!1,O=null,N=0,F=0,D=null,z=null,U=-1,B={geometry:null,program:null,wireframe:!1},G=null,V=null,j=new Gt,W=new Gt,X=null,Y=t.width,q=t.height,Q=1,Z=new Gt(0,0,Y,q),J=new Gt(0,0,Y,q),$=!1,ee=new gn,te=new An,re=!1,ne=!1,ie=new Wt,ae=new St;function oe(){return null===D?Q:1}try{var se={alpha:n,depth:i,stencil:o,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h,xrCompatible:!0};if(t.addEventListener("webglcontextlost",he,!1),t.addEventListener("webglcontextrestored",de,!1),null===(m=r||t.getContext("webgl",se)||t.getContext("experimental-webgl",se)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===m.getShaderPrecisionFormat&&(m.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function le(){v=new Pn(m),(g=new Sn(m,v,e)).isWebGL2||(v.get("WEBGL_depth_texture"),v.get("OES_texture_float"),v.get("OES_texture_half_float"),v.get("OES_texture_half_float_linear"),v.get("OES_standard_derivatives"),v.get("OES_element_index_uint"),v.get("ANGLE_instanced_arrays")),v.get("OES_texture_float_linear"),H=new sa(m,v,g),(y=new aa(m,v,H,g)).scissor(W.copy(J).multiplyScalar(Q).floor()),y.viewport(j.copy(Z).multiplyScalar(Q).floor()),E=new Hn(m),x=new Xi,b=new oa(m,v,y,x,g,H,E),T=new Tn(m),w=new Ln(m,T,E),_=new On(w,E),P=new kn(m),R=new Wi(I,v,g),M=new Zi,S=new ta,A=new Rn(I,y,_,l),L=new Mn(m,v,E,g),C=new Cn(m,v,E,g),E.programs=R.programs,I.context=m,I.capabilities=g,I.extensions=v,I.properties=x,I.renderLists=M,I.state=y,I.info=E}le();var ce="undefined"!=typeof navigator&&"xr"in navigator&&"supportsSession"in navigator.xr?new xa(I):new Ea(I);this.vr=ce;var ue=new ia(I,_,g.maxTextureSize);function he(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),k=!0}function de(){console.log("THREE.WebGLRenderer: Context Restored."),k=!1,le()}function pe(e){var t=e.target;t.removeEventListener("dispose",pe),function(e){fe(e),x.remove(e)}(t)}function fe(e){var t=x.get(e).program;e.program=void 0,void 0!==t&&R.releaseProgram(t)}this.shadowMap=ue,this.getContext=function(){return m},this.getContextAttributes=function(){return m.getContextAttributes()},this.forceContextLoss=function(){var e=v.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=v.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Q},this.setPixelRatio=function(e){void 0!==e&&(Q=e,this.setSize(Y,q,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Rt),e.set(Y,q)},this.setSize=function(e,r,n){ce.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Y=e,q=r,t.width=Math.floor(e*Q),t.height=Math.floor(r*Q),!1!==n&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Rt),e.set(Y*Q,q*Q).floor()},this.setDrawingBufferSize=function(e,r,n){Y=e,q=r,Q=n,t.width=Math.floor(e*n),t.height=Math.floor(r*n),this.setViewport(0,0,e,r)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Gt),e.copy(j)},this.getViewport=function(e){return e.copy(Z)},this.setViewport=function(e,t,r,n){e.isVector4?Z.set(e.x,e.y,e.z,e.w):Z.set(e,t,r,n),y.viewport(j.copy(Z).multiplyScalar(Q).floor())},this.getScissor=function(e){return e.copy(J)},this.setScissor=function(e,t,r,n){e.isVector4?J.set(e.x,e.y,e.z,e.w):J.set(e,t,r,n),y.scissor(W.copy(J).multiplyScalar(Q).floor())},this.getScissorTest=function(){return $},this.setScissorTest=function(e){y.setScissorTest($=e)},this.getClearColor=function(){return A.getClearColor()},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(e,t,r){var n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===r||r)&&(n|=1024),m.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",he,!1),t.removeEventListener("webglcontextrestored",de,!1),M.dispose(),S.dispose(),x.dispose(),_.dispose(),ce.dispose(),ve.stop()},this.renderBufferImmediate=function(e,t){y.initAttributes();var r=x.get(e);e.hasPositions&&!r.position&&(r.position=m.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=m.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=m.createBuffer()),e.hasColors&&!r.color&&(r.color=m.createBuffer());var n=t.getAttributes();e.hasPositions&&(m.bindBuffer(34962,r.position),m.bufferData(34962,e.positionArray,35048),y.enableAttribute(n.position),m.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(m.bindBuffer(34962,r.normal),m.bufferData(34962,e.normalArray,35048),y.enableAttribute(n.normal),m.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(m.bindBuffer(34962,r.uv),m.bufferData(34962,e.uvArray,35048),y.enableAttribute(n.uv),m.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(m.bindBuffer(34962,r.color),m.bufferData(34962,e.colorArray,35048),y.enableAttribute(n.color),m.vertexAttribPointer(n.color,3,5126,!1,0,0)),y.disableUnusedAttributes(),m.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,n,i,a){var o=i.isMesh&&i.matrixWorld.determinant()<0;y.setMaterial(n,o);var s=Te(e,t,n,i),l=!1;B.geometry===r.id&&B.program===s.id&&B.wireframe===(!0===n.wireframe)||(B.geometry=r.id,B.program=s.id,B.wireframe=!0===n.wireframe,l=!0),i.morphTargetInfluences&&(P.update(i,r,n,s),l=!0);var c,u=r.index,h=r.attributes.position,d=1;!0===n.wireframe&&(u=w.getWireframeAttribute(r),d=2);var p=L;null!==u&&(c=T.get(u),(p=C).setIndex(c)),l&&(function(e,t,r){if(r&&r.isInstancedBufferGeometry&&!g.isWebGL2&&null===v.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{y.initAttributes();var n=r.attributes,i=t.getAttributes(),a=e.defaultAttributeValues;for(var o in i){var s=i[o];if(s>=0){var l=n[o];if(void 0!==l){var c=l.normalized,u=l.itemSize,h=T.get(l);if(void 0===h)continue;var d=h.buffer,p=h.type,f=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var E=l.data,x=E.stride,b=l.offset;E&&E.isInstancedInterleavedBuffer?(y.enableAttributeAndDivisor(s,E.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=E.meshPerAttribute*E.count)):y.enableAttribute(s),m.bindBuffer(34962,d),m.vertexAttribPointer(s,u,p,c,x*f,b*f)}else l.isInstancedBufferAttribute?(y.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=l.meshPerAttribute*l.count)):y.enableAttribute(s),m.bindBuffer(34962,d),m.vertexAttribPointer(s,u,p,c,0,0)}else if(void 0!==a){var w=a[o];if(void 0!==w)switch(w.length){case 2:m.vertexAttrib2fv(s,w);break;case 3:m.vertexAttrib3fv(s,w);break;case 4:m.vertexAttrib4fv(s,w);break;default:m.vertexAttrib1fv(s,w)}}}}y.disableUnusedAttributes()}}(n,s,r),null!==u&&m.bindBuffer(34963,c.buffer));var f=1/0;null!==u?f=u.count:void 0!==h&&(f=h.count);var E=r.drawRange.start*d,x=r.drawRange.count*d,b=null!==a?a.start*d:0,_=null!==a?a.count*d:1/0,R=Math.max(E,b),M=Math.min(f,E+x,b+_)-1,S=Math.max(0,M-R+1);if(0!==S){if(i.isMesh)if(!0===n.wireframe)y.setLineWidth(n.wireframeLinewidth*oe()),p.setMode(1);else switch(i.drawMode){case ut:p.setMode(4);break;case ht:p.setMode(5);break;case dt:p.setMode(6)}else if(i.isLine){var A=n.linewidth;void 0===A&&(A=1),y.setLineWidth(A*oe()),i.isLineSegments?p.setMode(1):i.isLineLoop?p.setMode(2):p.setMode(3)}else i.isPoints?p.setMode(0):i.isSprite&&p.setMode(4);r&&r.isInstancedBufferGeometry?r.maxInstancedCount>0&&p.renderInstances(r,R,S):p.render(R,S)}},this.compile=function(e,t){(f=S.get(e,t)).init(),e.traverse(function(e){e.isLight&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))}),f.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)be(t.material[r],e.fog,t);else be(t.material,e.fog,t)})};var me=null,ve=new bn;function ge(e,t,r,n){if(!1!==e.visible){var i=e.layers.test(t.layers);if(i)if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ee.intersectsSprite(e)){n&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ie);var a=_.update(e),o=e.material;o.visible&&p.push(e,a,o,r,ae.z,null)}}else if(e.isImmediateRenderObject)n&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ie),p.push(e,null,e.material,r,ae.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||ee.intersectsObject(e))){n&&ae.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ie);var a=_.update(e),o=e.material;if(Array.isArray(o))for(var s=a.groups,l=0,c=s.length;l<c;l++){var u=s[l],h=o[u.materialIndex];h&&h.visible&&p.push(e,a,h,r,ae.z,u)}else o.visible&&p.push(e,a,o,r,ae.z,null)}for(var d=e.children,l=0,c=d.length;l<c;l++)ge(d[l],t,r,n)}}function Ee(e,t,r,n){for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,c=void 0===n?o.material:n,u=o.group;if(r.isArrayCamera){V=r;for(var h=r.cameras,d=0,p=h.length;d<p;d++){var m=h[d];s.layers.test(m.layers)&&(y.viewport(j.copy(m.viewport)),f.setupLights(m),xe(s,t,m,l,c,u))}}else V=null,xe(s,t,r,l,c,u)}}function xe(e,t,r,n,i,a){if(e.onBeforeRender(I,t,r,n,i,a),f=S.get(t,V||r),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){y.setMaterial(i);var o=Te(r,t.fog,i,e);B.geometry=null,B.program=null,B.wireframe=!1,function(e,t){e.render(function(e){I.renderBufferImmediate(e,t)})}(e,o)}else I.renderBufferDirect(r,t.fog,n,i,e,a);e.onAfterRender(I,t,r,n,i,a),f=S.get(t,V||r)}function be(e,t,r){var n=x.get(e),i=f.state.lights,a=f.state.shadowsArray,o=i.state.version,s=R.getParameters(e,i.state,a,t,te.numPlanes,te.numIntersection,r),l=R.getProgramCode(e,s),c=n.program,u=!0;if(void 0===c)e.addEventListener("dispose",pe);else if(c.code!==l)fe(e);else if(n.lightsStateVersion!==o)n.lightsStateVersion=o,u=!1;else{if(void 0!==s.shaderID)return;u=!1}if(u){if(s.shaderID){var h=xn[s.shaderID];n.shader={name:e.type,uniforms:en(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}}else n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(n.shader,I),l=R.getProgramCode(e,s),c=R.acquireProgram(e,n.shader,s,l),n.program=c,e.program=c}var d=c.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var p=0;p<I.maxMorphTargets;p++)d["morphTarget"+p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var p=0;p<I.maxMorphNormals;p++)d["morphNormal"+p]>=0&&e.numSupportedMorphNormals++}var m=n.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=te.numPlanes,n.numIntersection=te.numIntersection,m.clippingPlanes=te.uniform),n.fog=t,n.lightsStateVersion=o,e.lights&&(m.ambientLightColor.value=i.state.ambient,m.lightProbe.value=i.state.probe,m.directionalLights.value=i.state.directional,m.spotLights.value=i.state.spot,m.rectAreaLights.value=i.state.rectArea,m.pointLights.value=i.state.point,m.hemisphereLights.value=i.state.hemi,m.directionalShadowMap.value=i.state.directionalShadowMap,m.directionalShadowMatrix.value=i.state.directionalShadowMatrix,m.spotShadowMap.value=i.state.spotShadowMap,m.spotShadowMatrix.value=i.state.spotShadowMatrix,m.pointShadowMap.value=i.state.pointShadowMap,m.pointShadowMatrix.value=i.state.pointShadowMatrix);var v=n.program.getUniforms(),g=Hi.seqWithValue(v.seq,m);n.uniformsList=g}function Te(e,t,r,n){b.resetTextureUnits();var i=x.get(r),a=f.state.lights;if(re&&(ne||e!==G)){var o=e===G&&r.id===U;te.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,i,o)}!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==t?r.needsUpdate=!0:r.lights&&i.lightsStateVersion!==a.state.version?r.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===te.numPlanes&&i.numIntersection===te.numIntersection||(r.needsUpdate=!0)),r.needsUpdate&&(be(r,t,n),r.needsUpdate=!1);var s,l,c=!1,u=!1,h=!1,p=i.program,v=p.getUniforms(),E=i.shader.uniforms;if(y.useProgram(p.program)&&(c=!0,u=!0,h=!0),r.id!==U&&(U=r.id,u=!0),c||G!==e){if(v.setValue(m,"projectionMatrix",e.projectionMatrix),g.logarithmicDepthBuffer&&v.setValue(m,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),G!==e&&(G=e,u=!0,h=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap){var T=v.map.cameraPosition;void 0!==T&&T.setValue(m,ae.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&v.setValue(m,"viewMatrix",e.matrixWorldInverse)}if(r.skinning){v.setOptional(m,n,"bindMatrix"),v.setOptional(m,n,"bindMatrixInverse");var w=n.skeleton;if(w){var _=w.bones;if(g.floatVertexTextures){if(void 0===w.boneTexture){var R=Math.sqrt(4*_.length);R=_t.ceilPowerOfTwo(R),R=Math.max(R,4);var M=new Float32Array(R*R*4);M.set(w.boneMatrices);var S=new mn(M,R,R,He,_e);S.needsUpdate=!0,w.boneMatrices=M,w.boneTexture=S,w.boneTextureSize=R}v.setValue(m,"boneTexture",w.boneTexture,b),v.setValue(m,"boneTextureSize",w.boneTextureSize)}else v.setOptional(m,w,"boneMatrices")}}return u&&(v.setValue(m,"toneMappingExposure",I.toneMappingExposure),v.setValue(m,"toneMappingWhitePoint",I.toneMappingWhitePoint),r.lights&&(l=h,(s=E).ambientLightColor.needsUpdate=l,s.lightProbe.needsUpdate=l,s.directionalLights.needsUpdate=l,s.pointLights.needsUpdate=l,s.spotLights.needsUpdate=l,s.rectAreaLights.needsUpdate=l,s.hemisphereLights.needsUpdate=l),t&&r.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(E,t),r.isMeshBasicMaterial?we(E,r):r.isMeshLambertMaterial?(we(E,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(E,r)):r.isMeshPhongMaterial?(we(E,r),r.isMeshToonMaterial?function(e,t){Me(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(E,r):Me(E,r)):r.isMeshStandardMaterial?(we(E,r),r.isMeshPhysicalMaterial?function(e,t){Se(e,t),e.reflectivity.value=t.reflectivity,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(E,r):Se(E,r)):r.isMeshMatcapMaterial?(we(E,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===d&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===d&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,r)):r.isMeshDepthMaterial?(we(E,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,r)):r.isMeshDistanceMaterial?(we(E,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(E,r)):r.isMeshNormalMaterial?(we(E,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===d&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===d&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(E,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(E,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(E,r)):r.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*Q,e.scale.value=.5*q,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(E,r):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(E,r):r.isShadowMaterial&&(E.color.value.copy(r.color),E.opacity.value=r.opacity),void 0!==E.ltc_1&&(E.ltc_1.value=En.LTC_1),void 0!==E.ltc_2&&(E.ltc_2.value=En.LTC_2),Hi.upload(m,i.uniformsList,E,b)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Hi.upload(m,i.uniformsList,E,b),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&v.setValue(m,"center",n.center),v.setValue(m,"modelViewMatrix",n.modelViewMatrix),v.setValue(m,"normalMatrix",n.normalMatrix),v.setValue(m,"modelMatrix",n.matrixWorld),p}function we(e,t){var r;e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=x.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function Me(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===d&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===d&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function Se(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===d&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===d&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}ve.setAnimationLoop(function(e){ce.isPresenting()||me&&me(e)}),"undefined"!=typeof window&&ve.setContext(window),this.setAnimationLoop=function(e){me=e,ce.setAnimationLoop(e),ve.start()},this.render=function(e,t){var r,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),t&&t.isCamera){if(!k){B.geometry=null,B.program=null,B.wireframe=!1,U=-1,G=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ce.enabled&&(t=ce.getCamera(t)),(f=S.get(e,t)).init(),e.onBeforeRender(I,e,t,r||D),ie.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ee.setFromMatrix(ie),ne=this.localClippingEnabled,re=te.init(this.clippingPlanes,ne,t),(p=M.get(e,t)).init(),ge(e,t,0,I.sortObjects),!0===I.sortObjects&&p.sort(),re&&te.beginShadows();var i=f.state.shadowsArray;ue.render(i,e,t),f.setupLights(t),re&&te.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),A.render(p,e,t,n);var a=p.opaque,o=p.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&Ee(a,e,t,s),o.length&&Ee(o,e,t,s)}else a.length&&Ee(a,e,t),o.length&&Ee(o,e,t);e.onAfterRender(I,e,t),null!==D&&(b.updateRenderTargetMipmap(D),b.updateMultisampleRenderTarget(D)),y.buffers.depth.setTest(!0),y.buffers.depth.setMask(!0),y.buffers.color.setMask(!0),y.setPolygonOffset(!1),ce.enabled&&ce.submitFrame(),p=null,f=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){O!==e&&m.bindFramebuffer(36160,e),O=e},this.getActiveCubeFace=function(){return N},this.getActiveMipMapLevel=function(){return F},this.getRenderTarget=function(){return D},this.setRenderTarget=function(e,t,r){D=e,N=t,F=r,e&&void 0===x.get(e).__webglFramebuffer&&b.setupRenderTarget(e);var n=O,i=!1;if(e){var a=x.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(n=a[t||0],i=!0):n=e.isWebGLMultisampleRenderTarget?x.get(e).__webglMultisampledFramebuffer:a,j.copy(e.viewport),W.copy(e.scissor),X=e.scissorTest}else j.copy(Z).multiplyScalar(Q).floor(),W.copy(J).multiplyScalar(Q).floor(),X=$;if(z!==n&&(m.bindFramebuffer(36160,n),z=n),y.viewport(j),y.scissor(W),y.setScissorTest(X),i){var o=x.get(e.texture);m.framebufferTexture2D(36160,36064,34069+(t||0),o.__webglTexture,r||0)}},this.readRenderTargetPixels=function(e,t,r,n,i,a,o){if(e&&e.isWebGLRenderTarget){var s=x.get(e).__webglFramebuffer;if(e.isWebGLRenderTargetCube&&void 0!==o&&(s=s[o]),s){var l=!1;s!==z&&(m.bindFramebuffer(36160,s),l=!0);try{var c=e.texture,u=c.format,h=c.type;if(u!==He&&H.convert(u)!==m.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===ye||H.convert(h)===m.getParameter(35738)||h===_e&&(g.isWebGL2||v.get("OES_texture_float")||v.get("WEBGL_color_buffer_float"))||h===Re&&(g.isWebGL2?v.get("EXT_color_buffer_float"):v.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===m.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&r>=0&&r<=e.height-i&&m.readPixels(t,r,n,i,H.convert(u),H.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&m.bindFramebuffer(36160,z)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,r){var n=t.image.width,i=t.image.height,a=H.convert(t.format);b.setTexture2D(t,0),m.copyTexImage2D(3553,r||0,a,e.x,e.y,n,i,0)},this.copyTextureToTexture=function(e,t,r,n){var i=t.image.width,a=t.image.height,o=H.convert(r.format),s=H.convert(r.type);b.setTexture2D(r,0),t.isDataTexture?m.texSubImage2D(3553,n||0,e.x,e.y,i,a,o,s,t.image.data):m.texSubImage2D(3553,n||0,e.x,e.y,o,s,t.image)},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Ta(e,t){this.name="",this.color=new Rr(e),this.density=void 0!==t?t:25e-5}function wa(e,t,r){this.name="",this.color=new Rr(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3}function _a(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Ra(e,t,r,n){this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===n}function Ma(e){Cr.call(this),this.type="SpriteMaterial",this.color=new Rr(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function Sa(e){if(mr.call(this),this.type="Sprite",void 0===ua){ua=new qr;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new _a(t,5);ua.setIndex([0,1,2,0,2,3]),ua.addAttribute("position",new Ra(r,3,0,!1)),ua.addAttribute("uv",new Ra(r,2,3,!1))}this.geometry=ua,this.material=void 0!==e?e:new Ma,this.center=new Rt(.5,.5)}function Aa(){mr.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Pa(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Qr.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Wt,this.bindMatrixInverse=new Wt}function La(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Wt)}}function Ca(){mr.call(this),this.type="Bone"}function Ha(e){Cr.call(this),this.type="LineBasicMaterial",this.color=new Rr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Ia(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),mr.call(this),this.type="Line",this.geometry=void 0!==e?e:new qr,this.material=void 0!==t?t:new Ha({color:16777215*Math.random()})}function ka(e,t){Ia.call(this,e,t),this.type="LineSegments"}function Oa(e,t){Ia.call(this,e,t),this.type="LineLoop"}function Na(e){Cr.call(this),this.type="PointsMaterial",this.color=new Rr(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Fa(e,t){mr.call(this),this.type="Points",this.geometry=void 0!==e?e:new qr,this.material=void 0!==t?t:new Na({color:16777215*Math.random()}),this.updateMorphTargets()}function Da(e,t,r,n,i,a,o,s,l){Bt.call(this,e,t,r,n,i,a,o,s,l),this.format=void 0!==o?o:Ce,this.minFilter=void 0!==a?a:me,this.magFilter=void 0!==i?i:me,this.generateMipmaps=!1}function za(e,t,r,n,i,a,o,s,l,c,u,h){Bt.call(this,null,a,o,s,l,c,n,i,u,h),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Ua(e,t,r,n,i,a,o,s,l){Bt.call(this,e,t,r,n,i,a,o,s,l),this.needsUpdate=!0}function Ba(e,t,r,n,i,a,o,s,l,c){if((c=void 0!==c?c:Ne)!==Ne&&c!==Fe)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&c===Ne&&(r=be),void 0===r&&c===Fe&&(r=Pe),Bt.call(this,null,n,i,a,o,s,c,r,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:de,this.minFilter=void 0!==s?s:de,this.flipY=!1,this.generateMipmaps=!1}function Ga(e){qr.call(this),this.type="WireframeGeometry";var t,r,n,i,a,o,s,l,c,u,h=[],d=[0,0],p={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,n=m.length;t<n;t++){var v=m[t];for(r=0;r<3;r++)s=v[f[r]],l=v[f[(r+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),c=d[0]+","+d[1],void 0===p[c]&&(p[c]={index1:d[0],index2:d[1]})}for(c in p)o=p[c],u=e.vertices[o.index1],h.push(u.x,u.y,u.z),u=e.vertices[o.index2],h.push(u.x,u.y,u.z)}else if(e&&e.isBufferGeometry){var g,y,E,x,b,T,w,_;if(u=new St,null!==e.index){for(g=e.attributes.position,y=e.index,0===(E=e.groups).length&&(E=[{start:0,count:y.count,materialIndex:0}]),i=0,a=E.length;i<a;++i)for(x=E[i],b=x.start,T=x.count,t=b,n=b+T;t<n;t+=3)for(r=0;r<3;r++)s=y.getX(t+r),l=y.getX(t+(r+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),c=d[0]+","+d[1],void 0===p[c]&&(p[c]={index1:d[0],index2:d[1]});for(c in p)o=p[c],u.fromBufferAttribute(g,o.index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(g,o.index2),h.push(u.x,u.y,u.z)}else for(g=e.attributes.position,t=0,n=g.count/3;t<n;t++)for(r=0;r<3;r++)w=3*t+r,u.fromBufferAttribute(g,w),h.push(u.x,u.y,u.z),_=3*t+(r+1)%3,u.fromBufferAttribute(g,_),h.push(u.x,u.y,u.z)}this.addAttribute("position",new Br(h,3))}function Va(e,t,r){Kr.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new ja(e,t,r)),this.mergeVertices()}function ja(e,t,r){qr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var n,i,a=[],o=[],s=[],l=[],c=new St,u=new St,h=new St,d=new St,p=new St;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=t+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=t;i++){var v=i/t;e(v,m,u),o.push(u.x,u.y,u.z),v-1e-5>=0?(e(v-1e-5,m,h),d.subVectors(u,h)):(e(v+1e-5,m,h),d.subVectors(h,u)),m-1e-5>=0?(e(v,m-1e-5,h),p.subVectors(u,h)):(e(v,m+1e-5,h),p.subVectors(h,u)),c.crossVectors(d,p).normalize(),s.push(c.x,c.y,c.z),l.push(v,m)}}for(n=0;n<r;n++)for(i=0;i<t;i++){var g=n*f+i,y=n*f+i+1,E=(n+1)*f+i+1,x=(n+1)*f+i;a.push(g,y,x),a.push(y,E,x)}this.setIndex(a),this.addAttribute("position",new Br(o,3)),this.addAttribute("normal",new Br(s,3)),this.addAttribute("uv",new Br(l,2))}function Wa(e,t,r,n){Kr.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},this.fromBufferGeometry(new Xa(e,t,r,n)),this.mergeVertices()}function Xa(e,t,r,n){qr.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:n},r=r||1;var i=[],a=[];function o(e,t,r,n){var i,a,o=Math.pow(2,n),l=[];for(i=0;i<=o;i++){l[i]=[];var c=e.clone().lerp(r,i/o),u=t.clone().lerp(r,i/o),h=o-i;for(a=0;a<=h;a++)l[i][a]=0===a&&i===o?c:c.clone().lerp(u,a/h)}for(i=0;i<o;i++)for(a=0;a<2*(o-i)-1;a++){var d=Math.floor(a/2);a%2==0?(s(l[i][d+1]),s(l[i+1][d]),s(l[i][d])):(s(l[i][d+1]),s(l[i+1][d+1]),s(l[i+1][d]))}}function s(e){i.push(e.x,e.y,e.z)}function l(t,r){var n=3*t;r.x=e[n+0],r.y=e[n+1],r.z=e[n+2]}function c(e,t,r,n){n<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=n/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){for(var r=new St,n=new St,i=new St,a=0;a<t.length;a+=3)l(t[a+0],r),l(t[a+1],n),l(t[a+2],i),o(r,n,i,e)}(n=n||0),function(e){for(var t=new St,r=0;r<i.length;r+=3)t.x=i[r+0],t.y=i[r+1],t.z=i[r+2],t.normalize().multiplyScalar(e),i[r+0]=t.x,i[r+1]=t.y,i[r+2]=t.z}(r),function(){for(var e=new St,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var r=u(e)/2/Math.PI+.5,n=(o=e,Math.atan2(-o.y,Math.sqrt(o.x*o.x+o.z*o.z))/Math.PI+.5);a.push(r,1-n)}var o;(function(){for(var e=new St,t=new St,r=new St,n=new St,o=new Rt,s=new Rt,l=new Rt,h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),n.copy(e).add(t).add(r).divideScalar(3);var p=u(n);c(o,d+0,e,p),c(s,d+2,t,p),c(l,d+4,r,p)}})(),function(){for(var e=0;e<a.length;e+=6){var t=a[e+0],r=a[e+2],n=a[e+4],i=Math.max(t,r,n),o=Math.min(t,r,n);i>.9&&o<.1&&(t<.2&&(a[e+0]+=1),r<.2&&(a[e+2]+=1),n<.2&&(a[e+4]+=1))}}()}(),this.addAttribute("position",new Br(i,3)),this.addAttribute("normal",new Br(i.slice(),3)),this.addAttribute("uv",new Br(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Ya(e,t){Kr.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new qa(e,t)),this.mergeVertices()}function qa(e,t){Xa.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Qa(e,t){Kr.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Za(e,t)),this.mergeVertices()}function Za(e,t){Xa.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ka(e,t){Kr.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ja(e,t)),this.mergeVertices()}function Ja(e,t){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];Xa.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function $a(e,t){Kr.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new eo(e,t)),this.mergeVertices()}function eo(e,t){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];Xa.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function to(e,t,r,n,i,a){Kr.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new ro(e,t,r,n,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function ro(e,t,r,n,i){qr.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i},t=t||64,r=r||1,n=n||8,i=i||!1;var a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,l=new St,c=new St,u=new Rt,h=new St,d=[],p=[],f=[],m=[];function v(i){h=e.getPointAt(i/t,h);var o=a.normals[i],u=a.binormals[i];for(s=0;s<=n;s++){var f=s/n*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);c.x=v*o.x+m*u.x,c.y=v*o.y+m*u.y,c.z=v*o.z+m*u.z,c.normalize(),p.push(c.x,c.y,c.z),l.x=h.x+r*c.x,l.y=h.y+r*c.y,l.z=h.z+r*c.z,d.push(l.x,l.y,l.z)}}!function(){for(o=0;o<t;o++)v(o);v(!1===i?t:0),function(){for(o=0;o<=t;o++)for(s=0;s<=n;s++)u.x=o/t,u.y=s/n,f.push(u.x,u.y)}(),function(){for(s=1;s<=t;s++)for(o=1;o<=n;o++){var e=(n+1)*(s-1)+(o-1),r=(n+1)*s+(o-1),i=(n+1)*s+o,a=(n+1)*(s-1)+o;m.push(e,r,a),m.push(r,i,a)}}()}(),this.setIndex(m),this.addAttribute("position",new Br(d,3)),this.addAttribute("normal",new Br(p,3)),this.addAttribute("uv",new Br(f,2))}function no(e,t,r,n,i,a,o){Kr.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new io(e,t,r,n,i,a)),this.mergeVertices()}function io(e,t,r,n,i,a){qr.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:a},e=e||1,t=t||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,a=a||3;var o,s,l=[],c=[],u=[],h=[],d=new St,p=new St,f=new St,m=new St,v=new St,g=new St,y=new St;for(o=0;o<=r;++o){var E=o/r*i*Math.PI*2;for(S(E,i,a,e,f),S(E+.01,i,a,e,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=n;++s){var x=s/n*Math.PI*2,b=-t*Math.cos(x),T=t*Math.sin(x);d.x=f.x+(b*y.x+T*v.x),d.y=f.y+(b*y.y+T*v.y),d.z=f.z+(b*y.z+T*v.z),c.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),u.push(p.x,p.y,p.z),h.push(o/r),h.push(s/n)}}for(s=1;s<=r;s++)for(o=1;o<=n;o++){var w=(n+1)*(s-1)+(o-1),_=(n+1)*s+(o-1),R=(n+1)*s+o,M=(n+1)*(s-1)+o;l.push(w,_,M),l.push(_,R,M)}function S(e,t,r,n,i){var a=Math.cos(e),o=Math.sin(e),s=r/t*e,l=Math.cos(s);i.x=n*(2+l)*.5*a,i.y=n*(2+l)*o*.5,i.z=n*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new Br(c,3)),this.addAttribute("normal",new Br(u,3)),this.addAttribute("uv",new Br(h,2))}function ao(e,t,r,n,i){Kr.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new oo(e,t,r,n,i)),this.mergeVertices()}function oo(e,t,r,n,i){qr.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i},e=e||1,t=t||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var a,o,s=[],l=[],c=[],u=[],h=new St,d=new St,p=new St;for(a=0;a<=r;a++)for(o=0;o<=n;o++){var f=o/n*i,m=a/r*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(f),d.y=(e+t*Math.cos(m))*Math.sin(f),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),p.subVectors(d,h).normalize(),c.push(p.x,p.y,p.z),u.push(o/n),u.push(a/r)}for(a=1;a<=r;a++)for(o=1;o<=n;o++){var v=(n+1)*a+o-1,g=(n+1)*(a-1)+o-1,y=(n+1)*(a-1)+o,E=(n+1)*a+o;s.push(v,g,E),s.push(g,y,E)}this.setIndex(s),this.addAttribute("position",new Br(l,3)),this.addAttribute("normal",new Br(c,3)),this.addAttribute("uv",new Br(u,2))}Object.assign(Ea.prototype,t.prototype),Object.assign(xa.prototype,t.prototype),Object.assign(Ta.prototype,{isFogExp2:!0,clone:function(){return new Ta(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(wa.prototype,{isFog:!0,clone:function(){return new wa(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(_a.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(_a.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(Ra.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ra.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this},setXYZW:function(e,t,r,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=i,this}}),Ma.prototype=Object.create(Cr.prototype),Ma.prototype.constructor=Ma,Ma.prototype.isSpriteMaterial=!0,Ma.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},Sa.prototype=Object.assign(Object.create(mr.prototype),{constructor:Sa,isSprite:!0,raycast:function(){var e=new St,t=new St,r=new St,n=new Rt,i=new Rt,a=new Wt,o=new St,s=new St,l=new St,c=new Rt,u=new Rt,h=new Rt;function d(e,t,r,o,s,l){n.subVectors(e,r).addScalar(.5).multiply(o),void 0!==s?(i.x=l*n.x-s*n.y,i.y=s*n.x+l*n.y):i.copy(n),e.copy(t),e.x+=i.x,e.y+=i.y,e.applyMatrix4(a)}return function(n,i){t.setFromMatrixScale(this.matrixWorld),a.copy(n._camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n._camera.matrixWorldInverse,this.matrixWorld),r.setFromMatrixPosition(this.modelViewMatrix),n._camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&t.multiplyScalar(-r.z);var p,f,m=this.material.rotation;0!==m&&(f=Math.cos(m),p=Math.sin(m));var v=this.center;d(o.set(-.5,-.5,0),r,v,t,p,f),d(s.set(.5,-.5,0),r,v,t,p,f),d(l.set(.5,.5,0),r,v,t,p,f),c.set(0,0),u.set(1,0),h.set(1,1);var g=n.ray.intersectTriangle(o,s,l,!1,e);if(null!==g||(d(s.set(-.5,.5,0),r,v,t,p,f),u.set(0,1),null!==(g=n.ray.intersectTriangle(o,l,s,!1,e)))){var y=n.ray.origin.distanceTo(e);y<n.near||y>n.far||i.push({distance:y,point:e.clone(),uv:xr.getUV(e,o,s,l,c,u,h,new Rt),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return mr.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),Aa.prototype=Object.assign(Object.create(mr.prototype),{constructor:Aa,isLOD:!0,copy:function(e){mr.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,n=t.length;r<n;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){for(var t=this.levels,r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object},raycast:(ma=new St,function(e,t){ma.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(ma);this.getObjectForDistance(r).raycast(e,t)}),update:function(){var e=new St,t=new St;return function(r){var n=this.levels;if(n.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);n[0].object.visible=!0;for(var a=1,o=n.length;a<o&&i>=n[a].distance;a++)n[a-1].object.visible=!1,n[a].object.visible=!0;for(;a<o;a++)n[a].object.visible=!1}}}(),toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);t.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var a=r[n];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),Pa.prototype=Object.assign(Object.create(Qr.prototype),{constructor:Pa,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Gt,t=this.geometry.attributes.skinWeight,r=0,n=t.count;r<n;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Qr.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(La.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new Wt;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(pa=new Wt,fa=new Wt,function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:fa;pa.multiplyMatrices(o,t[i]),pa.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)}),clone:function(){return new La(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}}),Ca.prototype=Object.assign(Object.create(mr.prototype),{constructor:Ca,isBone:!0}),Ha.prototype=Object.create(Cr.prototype),Ha.prototype.constructor=Ha,Ha.prototype.isLineBasicMaterial=!0,Ha.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Ia.prototype=Object.assign(Object.create(mr.prototype),{constructor:Ia,isLine:!0,computeLineDistances:(ha=new St,da=new St,function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],n=1,i=t.count;n<i;n++)ha.fromBufferAttribute(t,n-1),da.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=ha.distanceTo(da);e.addAttribute("lineDistance",new Br(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices,r=e.lineDistances;r[0]=0;for(var n=1,i=a.length;n<i;n++)r[n]=r[n-1],r[n]+=a[n-1].distanceTo(a[n])}return this}),raycast:function(){var e=new Wt,t=new Er,r=new yr;return function(n,i){var a=n.linePrecision,o=this.geometry,s=this.matrixWorld;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=a,!1!==n.ray.intersectsSphere(r)){e.getInverse(s),t.copy(n.ray).applyMatrix4(e);var l=a/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=new St,h=new St,d=new St,p=new St,f=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var m=o.index,v=o.attributes,g=v.position.array;if(null!==m)for(var y=m.array,E=0,x=y.length-1;E<x;E+=f){var b=y[E],T=y[E+1];u.fromArray(g,3*b),h.fromArray(g,3*T);var w=t.distanceSqToSegment(u,h,p,d);if(!(w>c)){p.applyMatrix4(this.matrixWorld);var _=n.ray.origin.distanceTo(p);_<n.near||_>n.far||i.push({distance:_,point:d.clone().applyMatrix4(this.matrixWorld),index:E,face:null,faceIndex:null,object:this})}}else for(var E=0,x=g.length/3-1;E<x;E+=f){u.fromArray(g,3*E),h.fromArray(g,3*E+3);var w=t.distanceSqToSegment(u,h,p,d);if(!(w>c)){p.applyMatrix4(this.matrixWorld);var _=n.ray.origin.distanceTo(p);_<n.near||_>n.far||i.push({distance:_,point:d.clone().applyMatrix4(this.matrixWorld),index:E,face:null,faceIndex:null,object:this})}}}else if(o.isGeometry)for(var R=o.vertices,M=R.length,E=0;E<M-1;E+=f){var w=t.distanceSqToSegment(R[E],R[E+1],p,d);if(!(w>c)){p.applyMatrix4(this.matrixWorld);var _=n.ray.origin.distanceTo(p);_<n.near||_>n.far||i.push({distance:_,point:d.clone().applyMatrix4(this.matrixWorld),index:E,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ka.prototype=Object.assign(Object.create(Ia.prototype),{constructor:ka,isLineSegments:!0,computeLineDistances:function(){var e=new St,t=new St;return function(){var r=this.geometry;if(r.isBufferGeometry)if(null===r.index){for(var n=r.attributes.position,i=[],a=0,o=n.count;a<o;a+=2)e.fromBufferAttribute(n,a),t.fromBufferAttribute(n,a+1),i[a]=0===a?0:i[a-1],i[a+1]=i[a]+e.distanceTo(t);r.addAttribute("lineDistance",new Br(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(r.isGeometry)for(var s=r.vertices,i=r.lineDistances,a=0,o=s.length;a<o;a+=2)e.copy(s[a]),t.copy(s[a+1]),i[a]=0===a?0:i[a-1],i[a+1]=i[a]+e.distanceTo(t);return this}}()}),Oa.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Oa,isLineLoop:!0}),Na.prototype=Object.create(Cr.prototype),Na.prototype.constructor=Na,Na.prototype.isPointsMaterial=!0,Na.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},Fa.prototype=Object.assign(Object.create(mr.prototype),{constructor:Fa,isPoints:!0,raycast:function(){var e=new Wt,t=new Er,r=new yr;return function(n,i){var a=this,o=this.geometry,s=this.matrixWorld,l=n.params.Points.threshold;if(null===o.boundingSphere&&o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(s),r.radius+=l,!1!==n.ray.intersectsSphere(r)){e.getInverse(s),t.copy(n.ray).applyMatrix4(e);var c=l/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,h=new St,d=new St;if(o.isBufferGeometry){var p=o.index,f=o.attributes,m=f.position.array;if(null!==p)for(var v=p.array,g=0,y=v.length;g<y;g++){var E=v[g];h.fromArray(m,3*E),T(h,E)}else for(var g=0,x=m.length/3;g<x;g++)h.fromArray(m,3*g),T(h,g)}else for(var b=o.vertices,g=0,x=b.length;g<x;g++)T(b[g],g)}function T(e,r){var o=t.distanceSqToPoint(e);if(o<u){t.closestPointToPoint(e,d),d.applyMatrix4(s);var l=n.ray.origin.distanceTo(d);if(l<n.near||l>n.far)return;i.push({distance:l,distanceToRay:Math.sqrt(o),point:d.clone(),index:r,face:null,object:a})}}}}(),updateMorphTargets:function(){var e,t,r,n=this.geometry,i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)r=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Da.prototype=Object.assign(Object.create(Bt.prototype),{constructor:Da,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),za.prototype=Object.create(Bt.prototype),za.prototype.constructor=za,za.prototype.isCompressedTexture=!0,Ua.prototype=Object.create(Bt.prototype),Ua.prototype.constructor=Ua,Ua.prototype.isCanvasTexture=!0,Ba.prototype=Object.create(Bt.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isDepthTexture=!0,Ga.prototype=Object.create(qr.prototype),Ga.prototype.constructor=Ga,Va.prototype=Object.create(Kr.prototype),Va.prototype.constructor=Va,ja.prototype=Object.create(qr.prototype),ja.prototype.constructor=ja,Wa.prototype=Object.create(Kr.prototype),Wa.prototype.constructor=Wa,Xa.prototype=Object.create(qr.prototype),Xa.prototype.constructor=Xa,Ya.prototype=Object.create(Kr.prototype),Ya.prototype.constructor=Ya,qa.prototype=Object.create(Xa.prototype),qa.prototype.constructor=qa,Qa.prototype=Object.create(Kr.prototype),Qa.prototype.constructor=Qa,Za.prototype=Object.create(Xa.prototype),Za.prototype.constructor=Za,Ka.prototype=Object.create(Kr.prototype),Ka.prototype.constructor=Ka,Ja.prototype=Object.create(Xa.prototype),Ja.prototype.constructor=Ja,$a.prototype=Object.create(Kr.prototype),$a.prototype.constructor=$a,eo.prototype=Object.create(Xa.prototype),eo.prototype.constructor=eo,to.prototype=Object.create(Kr.prototype),to.prototype.constructor=to,ro.prototype=Object.create(qr.prototype),ro.prototype.constructor=ro,ro.prototype.toJSON=function(){var e=qr.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},no.prototype=Object.create(Kr.prototype),no.prototype.constructor=no,io.prototype=Object.create(qr.prototype),io.prototype.constructor=io,ao.prototype=Object.create(Kr.prototype),ao.prototype.constructor=ao,oo.prototype=Object.create(qr.prototype),oo.prototype.constructor=oo;var so={triangulate:function(e,t,r){r=r||2;var n,i,a,o,s,l,c,u=t&&t.length,h=u?t[0]*r:e.length,d=lo(e,0,h,r,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,r,n){var i,a,o,s,l,c=[];for(i=0,a=t.length;i<a;i++)o=t[i]*n,s=i<a-1?t[i+1]*n:e.length,(l=lo(e,o,s,n,!1))===l.next&&(l.steiner=!0),c.push(Eo(l));for(c.sort(vo),i=0;i<c.length;i++)go(c[i],r),r=co(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=a=e[0],i=o=e[1];for(var f=r;f<h;f+=r)s=e[f],l=e[f+1],s<n&&(n=s),l<i&&(i=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-n,o-i))?1/c:0}return uo(d,p,r,n,i,c),p}};function lo(e,t,r,n,i){var a,o;if(i===function(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,r,n)>0)for(a=t;a<r;a+=n)o=So(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=So(a,e[a],e[a+1],o);return o&&wo(o,o.next)&&(Ao(o),o=o.next),o}function co(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!wo(n,n.next)&&0!==To(n.prev,n,n.next))n=n.next;else{if(Ao(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function uo(e,t,r,n,i,a,o){if(e){!o&&a&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=yo(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,c=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,c*=2}while(o>1)}(i)}(e,n,i,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?po(e,n,i,a):ho(e))t.push(s.i/r),t.push(e.i/r),t.push(l.i/r),Ao(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?uo(e=fo(e,t,r),t,r,n,i,a,2):2===o&&mo(e,t,r,n,i,a):uo(co(e),t,r,n,i,a,1);break}}}function ho(e){var t=e.prev,r=e,n=e.next;if(To(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(xo(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&To(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function po(e,t,r,n){var i=e.prev,a=e,o=e.next;if(To(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,c=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=yo(s,l,t,r,n),d=yo(c,u,t,r,n),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&xo(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&To(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&xo(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&To(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&xo(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&To(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&xo(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&To(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function fo(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!wo(i,a)&&_o(i,n,n.next,a)&&Ro(i,a)&&Ro(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),Ao(n),Ao(n.next),n=e=a),n=n.next}while(n!==e);return n}function mo(e,t,r,n,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&bo(o,s)){var l=Mo(o,s);return o=co(o,o.next),l=co(l,l.next),uo(o,t,r,n,i,a),void uo(l,t,r,n,i,a)}s=s.next}o=o.next}while(o!==e)}function vo(e,t){return e.x-t.x}function go(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r.prev;var l,c=r,u=r.x,h=r.y,d=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&xo(a<h?i:o,a,u,h,a<h?o:i,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(i-n.x))<d||l===d&&n.x>r.x)&&Ro(n,e)&&(r=n,d=l),n=n.next;return r}(e,t)){var r=Mo(t,e);co(r,r.next)}}function yo(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Eo(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function xo(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function bo(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&_o(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&Ro(e,t)&&Ro(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function To(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function wo(e,t){return e.x===t.x&&e.y===t.y}function _o(e,t,r,n){return!!(wo(e,r)&&wo(t,n)||wo(e,n)&&wo(r,t))||To(e,t,r)>0!=To(e,t,n)>0&&To(r,n,e)>0!=To(r,n,t)>0}function Ro(e,t){return To(e.prev,e,e.next)<0?To(e,t,e.next)>=0&&To(e,e.prev,t)>=0:To(e,t,e.prev)<0||To(e,e.next,t)<0}function Mo(e,t){var r=new Po(e.i,e.x,e.y),n=new Po(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function So(e,t,r,n){var i=new Po(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ao(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Po(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Lo={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function(e){return Lo.area(e)<0},triangulateShape:function(e,t){var r=[],n=[],i=[];Co(e),Ho(r,e);var a=e.length;t.forEach(Co);for(var o=0;o<t.length;o++)n.push(a),a+=t[o].length,Ho(r,t[o]);for(var s=so.triangulate(r,n),o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function Co(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Ho(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function Io(e,t){Kr.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ko(e,t)),this.mergeVertices()}function ko(e,t){qr.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,n=[],i=[],a=0,o=e.length;a<o;a++){var s=e[a];l(s)}function l(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3,f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Oo;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var v,g,y,E,x,b,T,w,_=!1;f&&(v=f.getSpacedPoints(s),_=!0,c=!1,g=f.computeFrenetFrames(s,!1),y=new St,E=new St,x=new St),c||(p=0,u=0,h=0,d=0);var R=e.extractPoints(o),M=R.shape,S=R.holes,A=!Lo.isClockWise(M);if(A)for(M=M.reverse(),T=0,w=S.length;T<w;T++)b=S[T],Lo.isClockWise(b)&&(S[T]=b.reverse());var P=Lo.triangulateShape(M,S),L=M;for(T=0,w=S.length;T<w;T++)b=S[T],M=M.concat(b);function C(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}var H,I,k,O,N,F,D=M.length,z=P.length;function U(e,t,r){var n,i,a,o=e.x-t.x,s=e.y-t.y,l=r.x-e.x,c=r.y-e.y,u=o*o+s*s,h=o*c-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(u),p=Math.sqrt(l*l+c*c),f=t.x-s/d,m=t.y+o/d,v=r.x-c/p,g=r.y+l/p,y=((v-f)*c-(g-m)*l)/(o*c-s*l);n=f+o*y-e.x,i=m+s*y-e.y;var E=n*n+i*i;if(E<=2)return new Rt(n,i);a=Math.sqrt(E/2)}else{var x=!1;o>Number.EPSILON?l>Number.EPSILON&&(x=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(x=!0):Math.sign(s)===Math.sign(c)&&(x=!0),x?(n=-s,i=o,a=Math.sqrt(u)):(n=o,i=s,a=Math.sqrt(u/2))}return new Rt(n/a,i/a)}for(var B=[],G=0,V=L.length,j=V-1,W=G+1;G<V;G++,j++,W++)j===V&&(j=0),W===V&&(W=0),B[G]=U(L[G],L[j],L[W]);var X,Y,q=[],Q=B.concat();for(T=0,w=S.length;T<w;T++){for(b=S[T],X=[],G=0,V=b.length,j=V-1,W=G+1;G<V;G++,j++,W++)j===V&&(j=0),W===V&&(W=0),X[G]=U(b[G],b[j],b[W]);q.push(X),Q=Q.concat(X)}for(H=0;H<p;H++){for(k=H/p,O=u*Math.cos(k*Math.PI/2),I=h*Math.sin(k*Math.PI/2)+d,G=0,V=L.length;G<V;G++)K((N=C(L[G],B[G],I)).x,N.y,-O);for(T=0,w=S.length;T<w;T++)for(b=S[T],X=q[T],G=0,V=b.length;G<V;G++)K((N=C(b[G],X[G],I)).x,N.y,-O)}for(I=h+d,G=0;G<D;G++)N=c?C(M[G],Q[G],I):M[G],_?(E.copy(g.normals[0]).multiplyScalar(N.x),y.copy(g.binormals[0]).multiplyScalar(N.y),x.copy(v[0]).add(E).add(y),K(x.x,x.y,x.z)):K(N.x,N.y,0);for(Y=1;Y<=s;Y++)for(G=0;G<D;G++)N=c?C(M[G],Q[G],I):M[G],_?(E.copy(g.normals[Y]).multiplyScalar(N.x),y.copy(g.binormals[Y]).multiplyScalar(N.y),x.copy(v[Y]).add(E).add(y),K(x.x,x.y,x.z)):K(N.x,N.y,l/s*Y);for(H=p-1;H>=0;H--){for(k=H/p,O=u*Math.cos(k*Math.PI/2),I=h*Math.sin(k*Math.PI/2)+d,G=0,V=L.length;G<V;G++)K((N=C(L[G],B[G],I)).x,N.y,l+O);for(T=0,w=S.length;T<w;T++)for(b=S[T],X=q[T],G=0,V=b.length;G<V;G++)N=C(b[G],X[G],I),_?K(N.x,N.y+v[s-1].y,v[s-1].x+O):K(N.x,N.y,l+O)}function Z(e,t){var r,n;for(G=e.length;--G>=0;){r=G,(n=G-1)<0&&(n=e.length-1);var i=0,a=s+2*p;for(i=0;i<a;i++){var o=D*i,l=D*(i+1),c=t+r+o,u=t+n+o,h=t+n+l,d=t+r+l;$(c,u,h,d)}}}function K(e,t,r){a.push(e),a.push(t),a.push(r)}function J(e,t,i){ee(e),ee(t),ee(i);var a=n.length/3,o=m.generateTopUV(r,n,a-3,a-2,a-1);te(o[0]),te(o[1]),te(o[2])}function $(e,t,i,a){ee(e),ee(t),ee(a),ee(t),ee(i),ee(a);var o=n.length/3,s=m.generateSideWallUV(r,n,o-6,o-3,o-2,o-1);te(s[0]),te(s[1]),te(s[3]),te(s[1]),te(s[2]),te(s[3])}function ee(e){n.push(a[3*e+0]),n.push(a[3*e+1]),n.push(a[3*e+2])}function te(e){i.push(e.x),i.push(e.y)}!function(){var e=n.length/3;if(c){var t=0,i=D*t;for(G=0;G<z;G++)J((F=P[G])[2]+i,F[1]+i,F[0]+i);for(i=D*(t=s+2*p),G=0;G<z;G++)J((F=P[G])[0]+i,F[1]+i,F[2]+i)}else{for(G=0;G<z;G++)J((F=P[G])[2],F[1],F[0]);for(G=0;G<z;G++)J((F=P[G])[0]+D*s,F[1]+D*s,F[2]+D*s)}r.addGroup(e,n.length/3-e,0)}(),function(){var e=n.length/3,t=0;for(Z(L,t),t+=L.length,T=0,w=S.length;T<w;T++)Z(b=S[T],t),t+=b.length;r.addGroup(e,n.length/3-e,1)}()}this.addAttribute("position",new Br(n,3)),this.addAttribute("uv",new Br(i,2)),this.computeVertexNormals()}Io.prototype=Object.create(Kr.prototype),Io.prototype.constructor=Io,Io.prototype.toJSON=function(){var e=Kr.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return No(t,r,e)},ko.prototype=Object.create(qr.prototype),ko.prototype.constructor=ko,ko.prototype.toJSON=function(){var e=qr.prototype.toJSON.call(this),t=this.parameters.shapes,r=this.parameters.options;return No(t,r,e)};var Oo={generateTopUV:function(e,t,r,n,i){var a=t[3*r],o=t[3*r+1],s=t[3*n],l=t[3*n+1],c=t[3*i],u=t[3*i+1];return[new Rt(a,o),new Rt(s,l),new Rt(c,u)]},generateSideWallUV:function(e,t,r,n,i,a){var o=t[3*r],s=t[3*r+1],l=t[3*r+2],c=t[3*n],u=t[3*n+1],h=t[3*n+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*a],v=t[3*a+1],g=t[3*a+2];return Math.abs(s-u)<.01?[new Rt(o,1-l),new Rt(c,1-h),new Rt(d,1-f),new Rt(m,1-g)]:[new Rt(s,1-l),new Rt(u,1-h),new Rt(p,1-f),new Rt(v,1-g)]}};function No(e,t,r){if(r.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var a=e[n];r.shapes.push(a.uuid)}else r.shapes.push(e.uuid);return void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function Fo(e,t){Kr.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Do(e,t)),this.mergeVertices()}function Do(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Kr;var n=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ko.call(this,n,t),this.type="TextBufferGeometry"}function zo(e,t,r,n,i,a,o){Kr.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Uo(e,t,r,n,i,a,o)),this.mergeVertices()}function Uo(e,t,r,n,i,a,o){qr.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,l,c=Math.min(a+o,Math.PI),u=0,h=[],d=new St,p=new St,f=[],m=[],v=[],g=[];for(l=0;l<=r;l++){var y=[],E=l/r,x=0;for(0==l&&0==a?x=.5/t:l==r&&c==Math.PI&&(x=-.5/t),s=0;s<=t;s++){var b=s/t;d.x=-e*Math.cos(n+b*i)*Math.sin(a+E*o),d.y=e*Math.cos(a+E*o),d.z=e*Math.sin(n+b*i)*Math.sin(a+E*o),m.push(d.x,d.y,d.z),p.copy(d).normalize(),v.push(p.x,p.y,p.z),g.push(b+x,1-E),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(s=0;s<t;s++){var T=h[l][s+1],w=h[l][s],_=h[l+1][s],R=h[l+1][s+1];(0!==l||a>0)&&f.push(T,w,R),(l!==r-1||c<Math.PI)&&f.push(w,_,R)}this.setIndex(f),this.addAttribute("position",new Br(m,3)),this.addAttribute("normal",new Br(v,3)),this.addAttribute("uv",new Br(g,2))}function Bo(e,t,r,n,i,a){Kr.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new Go(e,t,r,n,i,a)),this.mergeVertices()}function Go(e,t,r,n,i,a){qr.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8,n=void 0!==n?Math.max(1,n):1;var o,s,l,c=[],u=[],h=[],d=[],p=e,f=(t-e)/n,m=new St,v=new Rt;for(s=0;s<=n;s++){for(l=0;l<=r;l++)o=i+l/r*a,m.x=p*Math.cos(o),m.y=p*Math.sin(o),u.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,d.push(v.x,v.y);p+=f}for(s=0;s<n;s++){var g=s*(r+1);for(l=0;l<r;l++){var y=o=l+g,E=o+r+1,x=o+r+2,b=o+1;c.push(y,E,b),c.push(E,x,b)}}this.setIndex(c),this.addAttribute("position",new Br(u,3)),this.addAttribute("normal",new Br(h,3)),this.addAttribute("uv",new Br(d,2))}function Vo(e,t,r,n){Kr.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},this.fromBufferGeometry(new jo(e,t,r,n)),this.mergeVertices()}function jo(e,t,r,n){qr.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:n},t=Math.floor(t)||12,r=r||0,n=n||2*Math.PI,n=_t.clamp(n,0,2*Math.PI);var i,a,o,s=[],l=[],c=[],u=1/t,h=new St,d=new Rt;for(a=0;a<=t;a++){var p=r+a*u*n,f=Math.sin(p),m=Math.cos(p);for(o=0;o<=e.length-1;o++)h.x=e[o].x*f,h.y=e[o].y,h.z=e[o].x*m,l.push(h.x,h.y,h.z),d.x=a/t,d.y=o/(e.length-1),c.push(d.x,d.y)}for(a=0;a<t;a++)for(o=0;o<e.length-1;o++){var v=i=o+a*e.length,g=i+e.length,y=i+e.length+1,E=i+1;s.push(v,g,E),s.push(g,y,E)}if(this.setIndex(s),this.addAttribute("position",new Br(l,3)),this.addAttribute("uv",new Br(c,2)),this.computeVertexNormals(),n===2*Math.PI){var x=this.attributes.normal.array,b=new St,T=new St,w=new St;for(i=t*e.length*3,a=0,o=0;a<e.length;a++,o+=3)b.x=x[o+0],b.y=x[o+1],b.z=x[o+2],T.x=x[i+o+0],T.y=x[i+o+1],T.z=x[i+o+2],w.addVectors(b,T).normalize(),x[o+0]=x[i+o+0]=w.x,x[o+1]=x[i+o+1]=w.y,x[o+2]=x[i+o+2]=w.z}}function Wo(e,t){Kr.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Xo(e,t)),this.mergeVertices()}function Xo(e,t){qr.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],n=[],i=[],a=[],o=0,s=0;if(!1===Array.isArray(e))c(e);else for(var l=0;l<e.length;l++)c(e[l]),this.addGroup(o,s,l),o+=s,s=0;function c(e){var o,l,c,u=n.length/3,h=e.extractPoints(t),d=h.shape,p=h.holes;for(!1===Lo.isClockWise(d)&&(d=d.reverse()),o=0,l=p.length;o<l;o++)c=p[o],!0===Lo.isClockWise(c)&&(p[o]=c.reverse());var f=Lo.triangulateShape(d,p);for(o=0,l=p.length;o<l;o++)c=p[o],d=d.concat(c);for(o=0,l=d.length;o<l;o++){var m=d[o];n.push(m.x,m.y,0),i.push(0,0,1),a.push(m.x,m.y)}for(o=0,l=f.length;o<l;o++){var v=f[o],g=v[0]+u,y=v[1]+u,E=v[2]+u;r.push(g,y,E),s+=3}}this.setIndex(r),this.addAttribute("position",new Br(n,3)),this.addAttribute("normal",new Br(i,3)),this.addAttribute("uv",new Br(a,2))}function Yo(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function qo(e,t){qr.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,i,a,o=[],s=Math.cos(_t.DEG2RAD*t),l=[0,0],c={},u=["a","b","c"];e.isBufferGeometry?(a=new Kr).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,d=a.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)r=m[u[v]],n=m[u[(v+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),i=l[0]+","+l[1],void 0===c[i]?c[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:c[i].face2=p;for(i in c){var g=c[i];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=h[g.index1];o.push(y.x,y.y,y.z),y=h[g.index2],o.push(y.x,y.y,y.z)}}this.addAttribute("position",new Br(o,3))}function Qo(e,t,r,n,i,a,o,s){Kr.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Zo(e,t,r,n,i,a,o,s)),this.mergeVertices()}function Zo(e,t,r,n,i,a,o,s){qr.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var c=[],u=[],h=[],d=[],p=0,f=[],m=r/2,v=0;function g(r){var i,a,f,g=new Rt,y=new St,E=0,x=!0===r?e:t,b=!0===r?1:-1;for(a=p,i=1;i<=n;i++)u.push(0,m*b,0),h.push(0,b,0),d.push(.5,.5),p++;for(f=p,i=0;i<=n;i++){var T=i/n,w=T*s+o,_=Math.cos(w),R=Math.sin(w);y.x=x*R,y.y=m*b,y.z=x*_,u.push(y.x,y.y,y.z),h.push(0,b,0),g.x=.5*_+.5,g.y=.5*R*b+.5,d.push(g.x,g.y),p++}for(i=0;i<n;i++){var M=a+i,S=f+i;!0===r?c.push(S,S+1,M):c.push(S+1,S,M),E+=3}l.addGroup(v,E,!0===r?1:2),v+=E}!function(){var a,g,y=new St,E=new St,x=0,b=(t-e)/r;for(g=0;g<=i;g++){var T=[],w=g/i,_=w*(t-e)+e;for(a=0;a<=n;a++){var R=a/n,M=R*s+o,S=Math.sin(M),A=Math.cos(M);E.x=_*S,E.y=-w*r+m,E.z=_*A,u.push(E.x,E.y,E.z),y.set(S,b,A).normalize(),h.push(y.x,y.y,y.z),d.push(R,1-w),T.push(p++)}f.push(T)}for(a=0;a<n;a++)for(g=0;g<i;g++){var P=f[g][a],L=f[g+1][a],C=f[g+1][a+1],H=f[g][a+1];c.push(P,L,H),c.push(L,C,H),x+=6}l.addGroup(v,x,0),v+=x}(),!1===a&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(c),this.addAttribute("position",new Br(u,3)),this.addAttribute("normal",new Br(h,3)),this.addAttribute("uv",new Br(d,2))}function Ko(e,t,r,n,i,a,o){Qo.call(this,0,e,t,r,n,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function Jo(e,t,r,n,i,a,o){Zo.call(this,0,e,t,r,n,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function $o(e,t,r,n){Kr.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new es(e,t,r,n)),this.mergeVertices()}function es(e,t,r,n){qr.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n},e=e||1,t=void 0!==t?Math.max(3,t):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,a,o=[],s=[],l=[],c=[],u=new St,h=new Rt;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),a=0,i=3;a<=t;a++,i+=3){var d=r+a/t*n;u.x=e*Math.cos(d),u.y=e*Math.sin(d),s.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(s[i]/e+1)/2,h.y=(s[i+1]/e+1)/2,c.push(h.x,h.y)}for(i=1;i<=t;i++)o.push(i,i+1,0);this.setIndex(o),this.addAttribute("position",new Br(s,3)),this.addAttribute("normal",new Br(l,3)),this.addAttribute("uv",new Br(c,2))}Fo.prototype=Object.create(Kr.prototype),Fo.prototype.constructor=Fo,Do.prototype=Object.create(ko.prototype),Do.prototype.constructor=Do,zo.prototype=Object.create(Kr.prototype),zo.prototype.constructor=zo,Uo.prototype=Object.create(qr.prototype),Uo.prototype.constructor=Uo,Bo.prototype=Object.create(Kr.prototype),Bo.prototype.constructor=Bo,Go.prototype=Object.create(qr.prototype),Go.prototype.constructor=Go,Vo.prototype=Object.create(Kr.prototype),Vo.prototype.constructor=Vo,jo.prototype=Object.create(qr.prototype),jo.prototype.constructor=jo,Wo.prototype=Object.create(Kr.prototype),Wo.prototype.constructor=Wo,Wo.prototype.toJSON=function(){var e=Kr.prototype.toJSON.call(this),t=this.parameters.shapes;return Yo(t,e)},Xo.prototype=Object.create(qr.prototype),Xo.prototype.constructor=Xo,Xo.prototype.toJSON=function(){var e=qr.prototype.toJSON.call(this),t=this.parameters.shapes;return Yo(t,e)},qo.prototype=Object.create(qr.prototype),qo.prototype.constructor=qo,Qo.prototype=Object.create(Kr.prototype),Qo.prototype.constructor=Qo,Zo.prototype=Object.create(qr.prototype),Zo.prototype.constructor=Zo,Ko.prototype=Object.create(Qo.prototype),Ko.prototype.constructor=Ko,Jo.prototype=Object.create(Zo.prototype),Jo.prototype.constructor=Jo,$o.prototype=Object.create(Kr.prototype),$o.prototype.constructor=$o,es.prototype=Object.create(qr.prototype),es.prototype.constructor=es;var ts=Object.freeze({WireframeGeometry:Ga,ParametricGeometry:Va,ParametricBufferGeometry:ja,TetrahedronGeometry:Ya,TetrahedronBufferGeometry:qa,OctahedronGeometry:Qa,OctahedronBufferGeometry:Za,IcosahedronGeometry:Ka,IcosahedronBufferGeometry:Ja,DodecahedronGeometry:$a,DodecahedronBufferGeometry:eo,PolyhedronGeometry:Wa,PolyhedronBufferGeometry:Xa,TubeGeometry:to,TubeBufferGeometry:ro,TorusKnotGeometry:no,TorusKnotBufferGeometry:io,TorusGeometry:ao,TorusBufferGeometry:oo,TextGeometry:Fo,TextBufferGeometry:Do,SphereGeometry:zo,SphereBufferGeometry:Uo,RingGeometry:Bo,RingBufferGeometry:Go,PlaneGeometry:wn,PlaneBufferGeometry:_n,LatheGeometry:Vo,LatheBufferGeometry:jo,ShapeGeometry:Wo,ShapeBufferGeometry:Xo,ExtrudeGeometry:Io,ExtrudeBufferGeometry:ko,EdgesGeometry:qo,ConeGeometry:Ko,ConeBufferGeometry:Jo,CylinderGeometry:Qo,CylinderBufferGeometry:Zo,CircleGeometry:$o,CircleBufferGeometry:es,BoxGeometry:Jr,BoxBufferGeometry:$r});function rs(e){Cr.call(this),this.type="ShadowMaterial",this.color=new Rr(0),this.transparent=!0,this.setValues(e)}function ns(e){on.call(this,e),this.type="RawShaderMaterial"}function is(e){Cr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Rr(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Tt,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function as(e){is.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function os(e){Cr.call(this),this.type="MeshPhongMaterial",this.color=new Rr(16777215),this.specular=new Rr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Tt,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ss(e){os.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function ls(e){Cr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Tt,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function cs(e){Cr.call(this),this.type="MeshLambertMaterial",this.color=new Rr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function us(e){Cr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Rr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Tt,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function hs(e){Ha.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}rs.prototype=Object.create(Cr.prototype),rs.prototype.constructor=rs,rs.prototype.isShadowMaterial=!0,rs.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this},ns.prototype=Object.create(on.prototype),ns.prototype.constructor=ns,ns.prototype.isRawShaderMaterial=!0,is.prototype=Object.create(Cr.prototype),is.prototype.constructor=is,is.prototype.isMeshStandardMaterial=!0,is.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},as.prototype=Object.create(is.prototype),as.prototype.constructor=as,as.prototype.isMeshPhysicalMaterial=!0,as.prototype.copy=function(e){return is.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},os.prototype=Object.create(Cr.prototype),os.prototype.constructor=os,os.prototype.isMeshPhongMaterial=!0,os.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ss.prototype=Object.create(os.prototype),ss.prototype.constructor=ss,ss.prototype.isMeshToonMaterial=!0,ss.prototype.copy=function(e){return os.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},ls.prototype=Object.create(Cr.prototype),ls.prototype.constructor=ls,ls.prototype.isMeshNormalMaterial=!0,ls.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},cs.prototype=Object.create(Cr.prototype),cs.prototype.constructor=cs,cs.prototype.isMeshLambertMaterial=!0,cs.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},us.prototype=Object.create(Cr.prototype),us.prototype.constructor=us,us.prototype.isMeshMatcapMaterial=!0,us.prototype.copy=function(e){return Cr.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},hs.prototype=Object.create(Ha.prototype),hs.prototype.constructor=hs,hs.prototype.isLineDashedMaterial=!0,hs.prototype.copy=function(e){return Ha.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var ds=Object.freeze({ShadowMaterial:rs,SpriteMaterial:Ma,RawShaderMaterial:ns,ShaderMaterial:on,PointsMaterial:Na,MeshPhysicalMaterial:as,MeshStandardMaterial:is,MeshPhongMaterial:os,MeshToonMaterial:ss,MeshNormalMaterial:ls,MeshLambertMaterial:cs,MeshDepthMaterial:ra,MeshDistanceMaterial:na,MeshBasicMaterial:Hr,MeshMatcapMaterial:us,LineDashedMaterial:hs,LineBasicMaterial:Ha,Material:Cr}),ps={arraySlice:function(e,t,r){return ps.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),n=0;n!==t;++n)r[n]=n;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(e,t,r){for(var n=e.length,i=new e.constructor(n),a=0,o=0;o!==n;++a)for(var s=r[a]*t,l=0;l!==t;++l)i[o++]=e[s+l];return i},flattenJSON:function(e,t,r,n){for(var i=1,a=e[0];void 0!==a&&void 0===a[n];)a=e[i++];if(void 0!==a){var o=a[n];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[n])&&(t.push(a.time),r.push.apply(r,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[n])&&(t.push(a.time),o.toArray(r,r.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[n])&&(t.push(a.time),r.push(o)),a=e[i++]}while(void 0!==a)}}};function fs(e,t,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function ms(e,t,r,n){fs.call(this,e,t,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function vs(e,t,r,n){fs.call(this,e,t,r,n)}function gs(e,t,r,n){fs.call(this,e,t,r,n)}function ys(e,t,r,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ps.convertArray(t,this.TimeBufferType),this.values=ps.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function Es(e,t,r){ys.call(this,e,t,r)}function xs(e,t,r,n){ys.call(this,e,t,r,n)}function bs(e,t,r,n){ys.call(this,e,t,r,n)}function Ts(e,t,r,n){fs.call(this,e,t,r,n)}function ws(e,t,r,n){ys.call(this,e,t,r,n)}function _s(e,t,r,n){ys.call(this,e,t,r,n)}function Rs(e,t,r,n){ys.call(this,e,t,r,n)}function Ms(e,t,r){this.name=e,this.tracks=r,this.duration=void 0!==t?t:-1,this.uuid=_t.generateUUID(),this.duration<0&&this.resetDuration()}function Ss(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return bs;case"vector":case"vector2":case"vector3":case"vector4":return Rs;case"color":return xs;case"quaternion":return ws;case"bool":case"boolean":return Es;case"string":return _s}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var r=[],n=[];ps.flattenJSON(e.keys,r,n,"value"),e.times=r,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(fs.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{var a;r:{n:if(!(e<n)){for(var o=r+2;;){if(void 0===n){if(e<i)break n;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,i)}if(r===o)break;if(i=n,n=t[++r],e<n)break t}a=t.length;break r}if(e>=i)break e;var s=t[1];e<s&&(r=2,i=s);for(var o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===o)break;if(n=i,i=t[--r-1],e>=i)break t}a=r,r=0}for(;r<a;){var l=r+a>>>1;e<t[l]?a=l:r=l+1}if(n=t[r],void 0===(i=t[r-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,i,e)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n,a=0;a!==n;++a)t[a]=r[i+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(fs.prototype,{beforeStart_:fs.prototype.copySampleValue_,afterEnd_:fs.prototype.copySampleValue_}),ms.prototype=Object.assign(Object.create(fs.prototype),{constructor:ms,DefaultSettings_:{endingStart:ct,endingEnd:ct},intervalChanged_:function(e,t,r){var n=this.parameterPositions,i=e-2,a=e+1,o=n[i],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:i=e,o=2*t-r;break;case 2402:i=n.length-2,o=t+n[i]-n[i+1];break;default:i=e,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*r-t;break;case 2402:a=1,s=r+n[1]-n[0];break;default:a=e-1,s=t}var l=.5*(r-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-r),this._offsetPrev=i*c,this._offsetNext=a*c},interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(r-t)/(n-t),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,E=d*m-d*f,x=0;x!==o;++x)i[x]=v*a[c+x]+g*a[l+x]+y*a[s+x]+E*a[u+x];return i}}),vs.prototype=Object.assign(Object.create(fs.prototype),{constructor:vs,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(r-t)/(n-t),u=1-c,h=0;h!==o;++h)i[h]=a[l+h]*u+a[s+h]*c;return i}}),gs.prototype=Object.assign(Object.create(fs.prototype),{constructor:gs,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(ys,{toJSON:function(e){var t,r=e.constructor;if(void 0!==r.toJSON)t=r.toJSON(e);else{t={name:e.name,times:ps.convertArray(e.times,Array),values:ps.convertArray(e.values,Array)};var n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}}),Object.assign(ys.prototype,{constructor:ys,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new gs(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new vs(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new ms(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,i=0,a=n-1;i!==n&&r[i]<e;)++i;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==i||a!==n){i>=a&&(a=Math.max(a,1),i=a-1);var o=this.getValueSize();this.times=ps.arraySlice(r,i,a),this.values=ps.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==n&&ps.isTypedArray(n))for(var o=0,l=n.length;o!==l;++o){var c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o],c=e[o+1];if(l!==c&&(1!==o||l!==l[0]))if(n)s=!0;else for(var u=o*r,h=u-r,d=u+r,p=0;p!==r;++p){var f=t[u+p];if(f!==t[h+p]||f!==t[d+p]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];for(var m=o*r,v=i*r,p=0;p!==r;++p)t[v+p]=t[m+p]}++i}}if(a>0){e[i]=e[a];for(var m=a*r,v=i*r,p=0;p!==r;++p)t[v+p]=t[m+p];++i}return i!==e.length&&(this.times=ps.arraySlice(e,0,i),this.values=ps.arraySlice(t,0,i*r)),this},clone:function(){var e=ps.arraySlice(this.times,0),t=ps.arraySlice(this.values,0),r=this.constructor,n=new r(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Es.prototype=Object.assign(Object.create(ys.prototype),{constructor:Es,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),xs.prototype=Object.assign(Object.create(ys.prototype),{constructor:xs,ValueTypeName:"color"}),bs.prototype=Object.assign(Object.create(ys.prototype),{constructor:bs,ValueTypeName:"number"}),Ts.prototype=Object.assign(Object.create(fs.prototype),{constructor:Ts,interpolate_:function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(r-t)/(n-t),c=s+o;s!==c;s+=4)Mt.slerpFlat(i,0,a,s-o,a,s,l);return i}}),ws.prototype=Object.assign(Object.create(ys.prototype),{constructor:ws,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Ts(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),_s.prototype=Object.assign(Object.create(ys.prototype),{constructor:_s,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Rs.prototype=Object.assign(Object.create(ys.prototype),{constructor:Rs,ValueTypeName:"vector"}),Object.assign(Ms,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,a=r.length;i!==a;++i)t.push(Ss(r[i]).scale(n));return new Ms(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,a=r.length;i!==a;++i)t.push(ys.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(e,t,r,n){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i),l.push(0,1,0);var c=ps.getKeyframeOrder(s);s=ps.sortedArray(s,1,c),l=ps.sortedArray(l,1,c),n||0!==s[0]||(s.push(i),l.push(l[0])),a.push(new bs(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/r))}return new Ms(e,-1,a)},findByName:function(e,t){var r=e;if(!Array.isArray(e)){var n=e;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(i);if(l&&l.length>1){var c=l[1],u=n[c];u||(n[c]=u=[]),u.push(s)}}var h=[];for(var c in n)h.push(Ms.CreateFromMorphTargetSequence(c,n[c],t,r));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(e,t,r,n,i){if(0!==r.length){var a=[],o=[];ps.flattenJSON(r,a,o,n),0!==a.length&&i.push(new e(t,a,o))}},n=[],i=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var d=0;d<c[h].morphTargets.length;d++)u[c[h].morphTargets[d]]=-1;for(var p in u){for(var f=[],m=[],d=0;d!==c[h].morphTargets.length;++d){var v=c[h];f.push(v.time),m.push(v.morphTarget===p?1:0)}n.push(new bs(".morphTargetInfluence["+p+"]",f,m))}a=u.length*(o||1)}else{var g=".bones["+t[l].name+"]";r(Rs,g+".position",c,"pos",n),r(ws,g+".quaternion",c,"rot",n),r(Rs,g+".scale",c,"scl",n)}}if(0===n.length)return null;var y=new Ms(i,a,n);return y}}),Object.assign(Ms.prototype,{resetDuration:function(){for(var e=this.tracks,t=0,r=0,n=e.length;r!==n;++r){var i=this.tracks[r];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Ms(this.name,this.duration,e)}});var As={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Ps(e,t,r){var n=this,i=!1,a=0,o=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===i&&void 0!==n.onStart&&n.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==n.onProgress&&n.onProgress(e,a,o),a===o&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var Ls=new Ps,Cs={};function Hs(e){this.manager=void 0!==e?e:Ls}function Is(e){this.manager=void 0!==e?e:Ls}function ks(e){this.manager=void 0!==e?e:Ls,this._parser=null}function Os(e){this.manager=void 0!==e?e:Ls,this._parser=null}function Ns(e){this.manager=void 0!==e?e:Ls}function Fs(e){this.manager=void 0!==e?e:Ls}function Ds(e){this.manager=void 0!==e?e:Ls}function zs(){this.type="Curve",this.arcLengthDivisions=200}function Us(e,t,r,n,i,a,o,s){zs.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function Bs(e,t,r,n,i,a){Us.call(this,e,t,r,r,n,i,a),this.type="ArcCurve"}function Gs(){var e=0,t=0,r=0,n=0;function i(i,a,o,s){e=i,t=o,r=-3*i+3*a-2*o-s,n=2*i-2*a+o+s}return{initCatmullRom:function(e,t,r,n,a){i(t,r,a*(r-e),a*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,a,o,s){var l=(t-e)/a-(r-e)/(a+o)+(r-t)/o,c=(r-t)/o-(n-t)/(o+s)+(n-r)/s;i(t,r,l*=o,c*=o)},calc:function(i){var a=i*i,o=a*i;return e+t*i+r*a+n*o}}}Object.assign(Hs.prototype,{load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=As.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;if(void 0===Cs[e]){var o=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],l=!!o[2],c=o[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);u="blob"===h?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}setTimeout(function(){t&&t(u),i.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)},0)}}else{Cs[e]=[],Cs[e].push({onLoad:t,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",function(t){var r=this.response;As.add(e,r);var n=Cs[e];if(delete Cs[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,o=n.length;a<o;a++){var s=n[a];s.onLoad&&s.onLoad(r)}i.manager.itemEnd(e)}else{for(var a=0,o=n.length;a<o;a++){var s=n[a];s.onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}},!1),m.addEventListener("progress",function(t){for(var r=Cs[e],n=0,i=r.length;n<i;n++){var a=r[n];a.onProgress&&a.onProgress(t)}},!1),m.addEventListener("error",function(t){var r=Cs[e];delete Cs[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),m.addEventListener("abort",function(t){var r=Cs[e];delete Cs[e];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}Cs[e].push({onLoad:t,onProgress:r,onError:n})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(Is.prototype,{load:function(e,t,r,n){var i=this,a=new Hs(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){for(var t=[],r=0;r<e.length;r++){var n=Ms.parse(e[r]);t.push(n)}return t},setPath:function(e){return this.path=e,this}}),Object.assign(ks.prototype,{load:function(e,t,r,n){var i=this,a=[],o=new za;o.image=a;var s=new Hs(this.manager);function l(l){s.load(e[l],function(e){var r=i._parser(e,!0);a[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(o.minFilter=me),o.format=r.format,o.needsUpdate=!0,t&&t(o))},r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var c=0,u=0,h=e.length;u<h;++u)l(u);else s.load(e,function(e){var r=i._parser(e,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){a[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)a[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),a[s].format=r.format,a[s].width=r.width,a[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=me),o.format=r.format,o.needsUpdate=!0,t&&t(o)},r,n);return o},setPath:function(e){return this.path=e,this}}),Object.assign(Os.prototype,{load:function(e,t,r,n){var i=this,a=new mn,o=new Hs(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,function(e){var r=i._parser(e);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:ue,a.wrapT=void 0!==r.wrapT?r.wrapT:ue,a.magFilter=void 0!==r.magFilter?r.magFilter:me,a.minFilter=void 0!==r.minFilter?r.minFilter:ge,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps),1===r.mipmapCount&&(a.minFilter=me),a.needsUpdate=!0,t&&t(a,r))},r,n),a},setPath:function(e){return this.path=e,this}}),Object.assign(Ns.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=As.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),As.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Fs.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=new Nn,a=new Ns(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(r){a.load(e[r],function(e){i.images[r]=e,6==++o&&(i.needsUpdate=!0,t&&t(i))},void 0,n)}for(var l=0;l<e.length;++l)s(l);return i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Ds.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=new Bt,a=new Ns(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(r){i.image=r;var n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=n?Ce:He,i.needsUpdate=!0,void 0!==t&&t(i)},r,n),i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(zs.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,n=[],i=this.getPoint(0),a=0;for(n.push(0),r=1;r<=e;r++)t=this.getPoint(r/e),a+=t.distanceTo(i),n.push(a),i=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,n=this.getLengths(),i=0,a=n.length;r=t||e*n[a-1];for(var o,s=0,l=a-1;s<=l;)if(i=Math.floor(s+(l-s)/2),(o=n[i]-r)<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(a-1);var c=n[i],u=n[i+1],h=u-c,d=(r-c)/h,p=(i+d)/(a-1);return p},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var n=this.getPoint(t),i=this.getPoint(r),a=i.clone().sub(n);return a.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,n,i,a=new St,o=[],s=[],l=[],c=new St,u=new Wt;for(r=0;r<=e;r++)n=r/e,o[r]=this.getTangentAt(n),o[r].normalize();s[0]=new St,l[0]=new St;var h=Number.MAX_VALUE,d=Math.abs(o[0].x),p=Math.abs(o[0].y),f=Math.abs(o[0].z);for(d<=h&&(h=d,a.set(1,0,0)),p<=h&&(h=p,a.set(0,1,0)),f<=h&&a.set(0,0,1),c.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],c),l[0].crossVectors(o[0],s[0]),r=1;r<=e;r++)s[r]=s[r-1].clone(),l[r]=l[r-1].clone(),c.crossVectors(o[r-1],o[r]),c.length()>Number.EPSILON&&(c.normalize(),i=Math.acos(_t.clamp(o[r-1].dot(o[r]),-1,1)),s[r].applyMatrix4(u.makeRotationAxis(c,i))),l[r].crossVectors(o[r],s[r]);if(!0===t)for(i=Math.acos(_t.clamp(s[0].dot(s[e]),-1,1)),i/=e,o[0].dot(c.crossVectors(s[0],s[e]))>0&&(i=-i),r=1;r<=e;r++)s[r].applyMatrix4(u.makeRotationAxis(o[r],i*r)),l[r].crossVectors(o[r],s[r]);return{tangents:o,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Us.prototype=Object.create(zs.prototype),Us.prototype.constructor=Us,Us.prototype.isEllipseCurve=!0,Us.prototype.getPoint=function(e,t){for(var r=t||new Rt,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=a?0:n),!0!==this.aClockwise||a||(i===n?i=-n:i-=n);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return r.set(s,l)},Us.prototype.copy=function(e){return zs.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Us.prototype.toJSON=function(){var e=zs.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Us.prototype.fromJSON=function(e){return zs.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Bs.prototype=Object.create(Us.prototype),Bs.prototype.constructor=Bs,Bs.prototype.isArcCurve=!0;var Vs=new St,js=new Gs,Ws=new Gs,Xs=new Gs;function Ys(e,t,r,n){zs.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=n||.5}function qs(e,t,r,n,i){var a=.5*(n-t),o=.5*(i-r),s=e*e,l=e*s;return(2*r-2*n+a+o)*l+(-3*r+3*n-2*a-o)*s+a*e+r}function Qs(e,t,r,n){return function(e,t){var r=1-e;return r*r*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,r)+function(e,t){return e*e*t}(e,n)}function Zs(e,t,r,n,i){return function(e,t){var r=1-e;return r*r*r*t}(e,t)+function(e,t){var r=1-e;return 3*r*r*e*t}(e,r)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,i)}function Ks(e,t,r,n){zs.call(this),this.type="CubicBezierCurve",this.v0=e||new Rt,this.v1=t||new Rt,this.v2=r||new Rt,this.v3=n||new Rt}function Js(e,t,r,n){zs.call(this),this.type="CubicBezierCurve3",this.v0=e||new St,this.v1=t||new St,this.v2=r||new St,this.v3=n||new St}function $s(e,t){zs.call(this),this.type="LineCurve",this.v1=e||new Rt,this.v2=t||new Rt}function el(e,t){zs.call(this),this.type="LineCurve3",this.v1=e||new St,this.v2=t||new St}function tl(e,t,r){zs.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Rt,this.v1=t||new Rt,this.v2=r||new Rt}function rl(e,t,r){zs.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new St,this.v1=t||new St,this.v2=r||new St}function nl(e){zs.call(this),this.type="SplineCurve",this.points=e||[]}Ys.prototype=Object.create(zs.prototype),Ys.prototype.constructor=Ys,Ys.prototype.isCatmullRomCurve3=!0,Ys.prototype.getPoint=function(e,t){var r,n,i,a,o=t||new St,s=this.points,l=s.length,c=(l-(this.closed?0:1))*e,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/l)+1)*l:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?r=s[(u-1)%l]:(Vs.subVectors(s[0],s[1]).add(s[0]),r=Vs),n=s[u%l],i=s[(u+1)%l],this.closed||u+2<l?a=s[(u+2)%l]:(Vs.subVectors(s[l-1],s[l-2]).add(s[l-1]),a=Vs),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(r.distanceToSquared(n),d),f=Math.pow(n.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(a),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),js.initNonuniformCatmullRom(r.x,n.x,i.x,a.x,p,f,m),Ws.initNonuniformCatmullRom(r.y,n.y,i.y,a.y,p,f,m),Xs.initNonuniformCatmullRom(r.z,n.z,i.z,a.z,p,f,m)}else"catmullrom"===this.curveType&&(js.initCatmullRom(r.x,n.x,i.x,a.x,this.tension),Ws.initCatmullRom(r.y,n.y,i.y,a.y,this.tension),Xs.initCatmullRom(r.z,n.z,i.z,a.z,this.tension));return o.set(js.calc(h),Ws.calc(h),Xs.calc(h)),o},Ys.prototype.copy=function(e){zs.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ys.prototype.toJSON=function(){var e=zs.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Ys.prototype.fromJSON=function(e){zs.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new St).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ks.prototype=Object.create(zs.prototype),Ks.prototype.constructor=Ks,Ks.prototype.isCubicBezierCurve=!0,Ks.prototype.getPoint=function(e,t){var r=t||new Rt,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Zs(e,n.x,i.x,a.x,o.x),Zs(e,n.y,i.y,a.y,o.y)),r},Ks.prototype.copy=function(e){return zs.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ks.prototype.toJSON=function(){var e=zs.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ks.prototype.fromJSON=function(e){return zs.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Js.prototype=Object.create(zs.prototype),Js.prototype.constructor=Js,Js.prototype.isCubicBezierCurve3=!0,Js.prototype.getPoint=function(e,t){var r=t||new St,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(Zs(e,n.x,i.x,a.x,o.x),Zs(e,n.y,i.y,a.y,o.y),Zs(e,n.z,i.z,a.z,o.z)),r},Js.prototype.copy=function(e){return zs.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Js.prototype.toJSON=function(){var e=zs.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Js.prototype.fromJSON=function(e){return zs.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},$s.prototype=Object.create(zs.prototype),$s.prototype.constructor=$s,$s.prototype.isLineCurve=!0,$s.prototype.getPoint=function(e,t){var r=t||new Rt;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},$s.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},$s.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},$s.prototype.copy=function(e){return zs.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},$s.prototype.toJSON=function(){var e=zs.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},$s.prototype.fromJSON=function(e){return zs.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},el.prototype=Object.create(zs.prototype),el.prototype.constructor=el,el.prototype.isLineCurve3=!0,el.prototype.getPoint=function(e,t){var r=t||new St;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},el.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},el.prototype.copy=function(e){return zs.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},el.prototype.toJSON=function(){var e=zs.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},el.prototype.fromJSON=function(e){return zs.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},tl.prototype=Object.create(zs.prototype),tl.prototype.constructor=tl,tl.prototype.isQuadraticBezierCurve=!0,tl.prototype.getPoint=function(e,t){var r=t||new Rt,n=this.v0,i=this.v1,a=this.v2;return r.set(Qs(e,n.x,i.x,a.x),Qs(e,n.y,i.y,a.y)),r},tl.prototype.copy=function(e){return zs.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},tl.prototype.toJSON=function(){var e=zs.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},tl.prototype.fromJSON=function(e){return zs.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},rl.prototype=Object.create(zs.prototype),rl.prototype.constructor=rl,rl.prototype.isQuadraticBezierCurve3=!0,rl.prototype.getPoint=function(e,t){var r=t||new St,n=this.v0,i=this.v1,a=this.v2;return r.set(Qs(e,n.x,i.x,a.x),Qs(e,n.y,i.y,a.y),Qs(e,n.z,i.z,a.z)),r},rl.prototype.copy=function(e){return zs.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},rl.prototype.toJSON=function(){var e=zs.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},rl.prototype.fromJSON=function(e){return zs.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},nl.prototype=Object.create(zs.prototype),nl.prototype.constructor=nl,nl.prototype.isSplineCurve=!0,nl.prototype.getPoint=function(e,t){var r=t||new Rt,n=this.points,i=(n.length-1)*e,a=Math.floor(i),o=i-a,s=n[0===a?a:a-1],l=n[a],c=n[a>n.length-2?n.length-1:a+1],u=n[a>n.length-3?n.length-1:a+2];return r.set(qs(o,s.x,l.x,c.x,u.x),qs(o,s.y,l.y,c.y,u.y)),r},nl.prototype.copy=function(e){zs.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push(n.clone())}return this},nl.prototype.toJSON=function(){var e=zs.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var n=this.points[t];e.points.push(n.toArray())}return e},nl.prototype.fromJSON=function(e){zs.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new Rt).fromArray(n))}return this};var il=Object.freeze({ArcCurve:Bs,CatmullRomCurve3:Ys,CubicBezierCurve:Ks,CubicBezierCurve3:Js,EllipseCurve:Us,LineCurve:$s,LineCurve3:el,QuadraticBezierCurve:tl,QuadraticBezierCurve3:rl,SplineCurve:nl});function al(){zs.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function ol(e){al.call(this),this.type="Path",this.currentPoint=new Rt,e&&this.setFromPoints(e)}function sl(e){ol.call(this,e),this.uuid=_t.generateUUID(),this.type="Shape",this.holes=[]}function ll(e,t){mr.call(this),this.type="Light",this.color=new Rr(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function cl(e,t,r){ll.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(mr.DefaultUp),this.updateMatrix(),this.groundColor=new Rr(t)}function ul(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Rt(512,512),this.map=null,this.matrix=new Wt}function hl(){ul.call(this,new ln(50,1,.5,500))}function dl(e,t,r,n,i,a){ll.call(this,e,t),this.type="SpotLight",this.position.copy(mr.DefaultUp),this.updateMatrix(),this.target=new mr,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new hl}function pl(e,t,r,n){ll.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new ul(new ln(90,1,.5,500))}function fl(e,t,r,n,i,a){sn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function ml(){ul.call(this,new fl(-5,5,5,-5,.5,500))}function vl(e,t){ll.call(this,e,t),this.type="DirectionalLight",this.position.copy(mr.DefaultUp),this.updateMatrix(),this.target=new mr,this.shadow=new ml}function gl(e,t){ll.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function yl(e,t,r,n){ll.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function El(e){this.manager=void 0!==e?e:Ls,this.textures={}}al.prototype=Object.assign(Object.create(zs.prototype),{constructor:al,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new $s(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=t){var i=r[n]-t,a=this.curves[n],o=a.getLength(),s=0===o?0:1-i/o;return a.getPointAt(s)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],n=0,i=this.curves;n<i.length;n++)for(var a=i[n],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),l=0;l<s.length;l++){var c=s[l];t&&t.equals(c)||(r.push(c),t=c)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){zs.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=zs.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var n=this.curves[t];e.curves.push(n.toJSON())}return e},fromJSON:function(e){zs.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new il[n.type]).fromJSON(n))}return this}}),ol.prototype=Object.assign(Object.create(al.prototype),{constructor:ol,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new $s(this.currentPoint.clone(),new Rt(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,n){var i=new tl(this.currentPoint.clone(),new Rt(e,t),new Rt(r,n));this.curves.push(i),this.currentPoint.set(r,n)},bezierCurveTo:function(e,t,r,n,i,a){var o=new Ks(this.currentPoint.clone(),new Rt(e,t),new Rt(r,n),new Rt(i,a));this.curves.push(o),this.currentPoint.set(i,a)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e),r=new nl(t);this.curves.push(r),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,n,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,r,n,i,a)},absarc:function(e,t,r,n,i,a){this.absellipse(e,t,r,r,n,i,a)},ellipse:function(e,t,r,n,i,a,o,s){var l=this.currentPoint.x,c=this.currentPoint.y;this.absellipse(e+l,t+c,r,n,i,a,o,s)},absellipse:function(e,t,r,n,i,a,o,s){var l=new Us(e,t,r,n,i,a,o,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);this.currentPoint.copy(u)},copy:function(e){return al.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=al.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return al.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),sl.prototype=Object.assign(Object.create(ol.prototype),{constructor:sl,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){ol.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push(n.clone())}return this},toJSON:function(){var e=ol.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var n=this.holes[t];e.holes.push(n.toJSON())}return e},fromJSON:function(e){ol.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new ol).fromJSON(n))}return this}}),ll.prototype=Object.assign(Object.create(mr.prototype),{constructor:ll,isLight:!0,copy:function(e){return mr.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),cl.prototype=Object.assign(Object.create(ll.prototype),{constructor:cl,isHemisphereLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(ul.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),hl.prototype=Object.assign(Object.create(ul.prototype),{constructor:hl,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*_t.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&n===t.aspect&&i===t.far||(t.fov=r,t.aspect=n,t.far=i,t.updateProjectionMatrix())}}),dl.prototype=Object.assign(Object.create(ll.prototype),{constructor:dl,isSpotLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),pl.prototype=Object.assign(Object.create(ll.prototype),{constructor:pl,isPointLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),fl.prototype=Object.assign(Object.create(sn.prototype),{constructor:fl,isOrthographicCamera:!0,copy:function(e,t){return sn.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,n,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e,a=r+e,o=n+t,s=n-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;i+=u*(this.view.offsetX/l),a=i+u*(this.view.width/l),o-=h*(this.view.offsetY/c),s=o-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=mr.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),ml.prototype=Object.assign(Object.create(ul.prototype),{constructor:ml}),vl.prototype=Object.assign(Object.create(ll.prototype),{constructor:vl,isDirectionalLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),gl.prototype=Object.assign(Object.create(ll.prototype),{constructor:gl,isAmbientLight:!0}),yl.prototype=Object.assign(Object.create(ll.prototype),{constructor:yl,isRectAreaLight:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=ll.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(El.prototype,{load:function(e,t,r,n){var i=this,a=new Hs(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var n=new ds[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearCoat&&(n.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(n.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.uniforms)for(var i in e.uniforms){var a=e.uniforms[i];switch(n.uniforms[i]={},a.type){case"t":n.uniforms[i].value=r(a.value);break;case"c":n.uniforms[i].value=(new Rr).setHex(a.value);break;case"v2":n.uniforms[i].value=(new Rt).fromArray(a.value);break;case"v3":n.uniforms[i].value=(new St).fromArray(a.value);break;case"v4":n.uniforms[i].value=(new Gt).fromArray(a.value);break;case"m3":n.uniforms[i].value=(new At).fromArray(a.value);case"m4":n.uniforms[i].value=(new Wt).fromArray(a.value);break;default:n.uniforms[i].value=a.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)n.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=r(e.map)),void 0!==e.matcap&&(n.matcap=r(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=r(e.alphaMap),n.transparent=!0),void 0!==e.bumpMap&&(n.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),n.normalScale=(new Rt).fromArray(s)}return void 0!==e.displacementMap&&(n.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=r(e.specularMap)),void 0!==e.envMap&&(n.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=r(e.gradientMap)),n},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var xl={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function bl(){qr.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Tl(e,t,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Ir.call(this,e,t,r),this.meshPerAttribute=n||1}function wl(e){this.manager=void 0!==e?e:Ls}bl.prototype=Object.assign(Object.create(qr.prototype),{constructor:bl,isInstancedBufferGeometry:!0,copy:function(e){return qr.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=qr.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),Tl.prototype=Object.assign(Object.create(Ir.prototype),{constructor:Tl,isInstancedBufferAttribute:!0,copy:function(e){return Ir.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Ir.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Object.assign(wl.prototype,{load:function(e,t,r,n){var i=this,a=new Hs(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=e.isInstancedBufferGeometry?new bl:new qr,r=e.data.index;if(void 0!==r){var n=new _l[r.type](r.array);t.setIndex(new Ir(n,1))}var i=e.data.attributes;for(var a in i){var o=i[a],n=new _l[o.type](o.array),s=o.isInstancedBufferAttribute?Tl:Ir,l=new s(n,o.itemSize,o.normalized);void 0!==o.name&&(l.name=o.name),t.addAttribute(a,l)}var c=e.data.morphAttributes;if(c)for(var a in c){for(var u=c[a],h=[],d=0,p=u.length;d<p;d++){var o=u[d],n=new _l[o.type](o.array),l=new Ir(n,o.itemSize,o.normalized);void 0!==o.name&&(l.name=o.name),h.push(l)}t.morphAttributes[a]=h}var f=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==f)for(var d=0,m=f.length;d!==m;++d){var v=f[d];t.addGroup(v.start,v.count,v.materialIndex)}var g=e.data.boundingSphere;if(void 0!==g){var y=new St;void 0!==g.center&&y.fromArray(g.center),t.boundingSphere=new yr(y,g.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var _l={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Rl(e){this.manager=void 0!==e?e:Ls,this.resourcePath=""}Object.assign(Rl.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===this.path?xl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new Hs(i.manager);o.setPath(this.path),o.load(e,function(r){var a=null;try{a=JSON.parse(r)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var r=this.parseShape(e.shapes),n=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,function(){void 0!==t&&t(s)}),a=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,n,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new sl).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new wl,i=0,a=e.length;i<a;i++){var o,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new ts[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new ts[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new ts[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new ts[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new ts[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new ts[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new ts[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new ts[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new ts[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new ts[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new ts[s.type]((new il[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new ts[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new ts[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}o=new ts[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var h=t[s.shapes[c]];l.push(h)}var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new il[d.type]).fromJSON(d)),o=new ts[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var p=new THREE.LegacyJSONLoader;o=p.parse(s,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),r[s.uuid]=o}return r},parseMaterials:function(e,t){var r={},n={};if(void 0!==e){var i=new El;i.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var u=s.materials[c];void 0===r[u.uuid]&&(r[u.uuid]=i.parse(u)),l.push(r[u.uuid])}n[s.uuid]=l}else void 0===r[s.uuid]&&(r[s.uuid]=i.parse(s)),n[s.uuid]=r[s.uuid]}}return n},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=Ms.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),t.push(i)}return t},parseImages:function(e,t){var r=this,n={};function i(e){return r.manager.itemStart(e),o.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}if(void 0!==e&&e.length>0){var a=new Ps(t),o=new Ns(a);o.setCrossOrigin(this.crossOrigin);for(var s=0,l=e.length;s<l;s++){var c=e[s],u=c.url;if(Array.isArray(u)){n[c.uuid]=[];for(var h=0,d=u.length;h<d;h++){var p=u[h],f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:r.resourcePath+p;n[c.uuid].push(i(f))}}else{var f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:r.resourcePath+c.url;n[c.uuid]=i(f)}}}return n},parseTextures:function(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var i=0,a=e.length;i<a;i++){var o,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(t[s.image])?new Nn(t[s.image]):new Bt(t[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=r(s.mapping,Cl)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=r(s.wrap[0],Hl),o.wrapT=r(s.wrap[1],Hl)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=r(s.minFilter,Il)),void 0!==s.magFilter&&(o.magFilter=r(s.magFilter,Il)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),n[s.uuid]=o}return n},parseObject:function(e,t,r){var n;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,i=e.length;n<i;n++){var a=e[n];void 0===r[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(r[a])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(e.type){case"Scene":n=new vr,void 0!==e.background&&Number.isInteger(e.background)&&(n.background=new Rr(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?n.fog=new wa(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(n.fog=new Ta(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":n=new ln(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(n.focus=e.focus),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.filmGauge&&(n.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(n.filmOffset=e.filmOffset),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"OrthographicCamera":n=new fl(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(n.zoom=e.zoom),void 0!==e.view&&(n.view=Object.assign({},e.view));break;case"AmbientLight":n=new gl(e.color,e.intensity);break;case"DirectionalLight":n=new vl(e.color,e.intensity);break;case"PointLight":n=new pl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":n=new yl(e.color,e.intensity,e.width,e.height);break;case"SpotLight":n=new dl(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":n=new cl(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=i(e.geometry),s=a(e.material);n=o.bones&&o.bones.length>0?new Pa(o,s):new Qr(o,s),void 0!==e.drawMode&&n.setDrawMode(e.drawMode);break;case"LOD":n=new Aa;break;case"Line":n=new Ia(i(e.geometry),a(e.material),e.mode);break;case"LineLoop":n=new Oa(i(e.geometry),a(e.material));break;case"LineSegments":n=new ka(i(e.geometry),a(e.material));break;case"PointCloud":case"Points":n=new Fa(i(e.geometry),a(e.material));break;case"Sprite":n=new Sa(a(e.material));break;case"Group":n=new la;break;default:n=new mr}if(n.uuid=e.uuid,void 0!==e.name&&(n.name=e.name),void 0!==e.matrix?(n.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(n.matrixAutoUpdate=e.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.rotation&&n.rotation.fromArray(e.rotation),void 0!==e.quaternion&&n.quaternion.fromArray(e.quaternion),void 0!==e.scale&&n.scale.fromArray(e.scale)),void 0!==e.castShadow&&(n.castShadow=e.castShadow),void 0!==e.receiveShadow&&(n.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(n.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(n.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&n.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(n.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.frustumCulled&&(n.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(n.renderOrder=e.renderOrder),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.layers&&(n.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,c=0;c<l.length;c++)n.add(this.parseObject(l[c],t,r));if("LOD"===e.type)for(var u=e.levels,h=0;h<u.length;h++){var d=u[h],p=n.getObjectByProperty("uuid",d.object);void 0!==p&&n.addLevel(p,d.distance)}return n}});var Ml,Sl,Al,Pl,Ll,Cl={UVMapping:300,CubeReflectionMapping:re,CubeRefractionMapping:ne,EquirectangularReflectionMapping:ie,EquirectangularRefractionMapping:ae,SphericalReflectionMapping:oe,CubeUVReflectionMapping:se,CubeUVRefractionMapping:le},Hl={RepeatWrapping:ce,ClampToEdgeWrapping:ue,MirroredRepeatWrapping:he},Il={NearestFilter:de,NearestMipMapNearestFilter:pe,NearestMipMapLinearFilter:fe,LinearFilter:me,LinearMipMapNearestFilter:ve,LinearMipMapLinearFilter:ge};function kl(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Ls,this.options=void 0}function Ol(){this.type="ShapePath",this.color=new Rr,this.subPaths=[],this.currentPath=null}function Nl(e){this.type="Font",this.data=e}function Fl(e,t,r,n,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,c,u,h,d,p,f=new Ol;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),v=0,g=m.length;v<g;){var y=m[v++];switch(y){case"m":o=m[v++]*t+r,s=m[v++]*t+n,f.moveTo(o,s);break;case"l":o=m[v++]*t+r,s=m[v++]*t+n,f.lineTo(o,s);break;case"q":l=m[v++]*t+r,c=m[v++]*t+n,u=m[v++]*t+r,h=m[v++]*t+n,f.quadraticCurveTo(u,h,l,c);break;case"b":l=m[v++]*t+r,c=m[v++]*t+n,u=m[v++]*t+r,h=m[v++]*t+n,d=m[v++]*t+r,p=m[v++]*t+n,f.bezierCurveTo(u,h,d,p,l,c)}}return{offsetX:a.ha*t,path:f}}}function Dl(e){this.manager=void 0!==e?e:Ls}function zl(){}kl.prototype={constructor:kl,setOptions:function(e){return this.options=e,this},load:function(e,t,r,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=As.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a;fetch(e).then(function(e){return e.blob()}).then(function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)}).then(function(r){As.add(e,r),t&&t(r),i.manager.itemEnd(e)}).catch(function(t){n&&n(t),i.manager.itemError(e),i.manager.itemEnd(e)}),i.manager.itemStart(e)},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(Ol.prototype,{moveTo:function(e,t){this.currentPath=new ol,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,n){this.currentPath.quadraticCurveTo(e,t,r,n)},bezierCurveTo:function(e,t,r,n,i,a){this.currentPath.bezierCurveTo(e,t,r,n,i,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=new sl;a.curves=i.curves,t.push(a)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,a=0;a<r;i=a++){var o=t[i],s=t[a],l=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(o=t[a],l=-l,s=t[i],c=-c),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var u=c*(e.x-o.x)-l*(e.y-o.y);if(0===u)return!0;if(u<0)continue;n=!n}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return n}var i=Lo.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return r(a);var o,s,l,c=[];if(1===a.length)return s=a[0],(l=new sl).curves=s.curves,c.push(l),c;var u=!i(a[0].getPoints());u=e?!u:u;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=a.length;g<y;g++)s=a[g],h=s.getPoints(),o=i(h),(o=e?!o:o)?(!u&&f[v]&&v++,f[v]={s:new sl,p:h},f[v].s.curves=s.curves,u&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!f[0])return r(a);if(f.length>1){for(var E=!1,x=[],b=0,T=f.length;b<T;b++)p[b]=[];for(var b=0,T=f.length;b<T;b++)for(var w=m[b],_=0;_<w.length;_++){for(var R=w[_],M=!0,S=0;S<f.length;S++)n(R.p,f[S].p)&&(b!==S&&x.push({froms:b,tos:S,hole:_}),M?(M=!1,p[S].push(R)):E=!0);M&&p[b].push(R)}x.length>0&&(E||(m=p))}for(var g=0,A=f.length;g<A;g++){l=f[g].s,c.push(l),d=m[g];for(var P=0,L=d.length;P<L;P++)l.holes.push(d[P].h)}return c}}),Object.assign(Nl.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var r=[],n=function(e,t,r){for(var n=Array.from?Array.from(e):String(e).split(""),i=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,o=[],s=0,l=0,c=0;c<n.length;c++){var u=n[c];if("\n"===u)s=0,l-=a;else{var h=Fl(u,i,s,l,r);s+=h.offsetX,o.push(h.path)}}return o}(e,t,this.data),i=0,a=n.length;i<a;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),Object.assign(Dl.prototype,{load:function(e,t,r,n){var i=this,a=new Hs(this.manager);a.setPath(this.path),a.load(e,function(e){var r;try{r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}var n=i.parse(r);t&&t(n)},r,n)},parse:function(e){return new Nl(e)},setPath:function(e){return this.path=e,this}}),zl.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,n=t.length;r<n;r+=2){var i=t[r],a=t[r+1];if(i.test(e))return a}return null}},Object.assign(zl.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t,r);return n},createMaterial:(Sl={NoBlending:g,NormalBlending:y,AdditiveBlending:E,SubtractiveBlending:x,MultiplyBlending:b,CustomBlending:T},Al=new Rr,Pl=new Ds,Ll=new El,function(e,t,r){var n={};function i(e,i,a,o,s){var l,c=t+e,u=zl.Handlers.get(c);null!==u?l=u.load(c):(Pl.setCrossOrigin(r),l=Pl.load(c)),void 0!==i&&(l.repeat.fromArray(i),1!==i[0]&&(l.wrapS=ce),1!==i[1]&&(l.wrapT=ce)),void 0!==a&&l.offset.fromArray(a),void 0!==o&&("repeat"===o[0]&&(l.wrapS=ce),"mirror"===o[0]&&(l.wrapS=he),"repeat"===o[1]&&(l.wrapT=ce),"mirror"===o[1]&&(l.wrapT=he)),void 0!==s&&(l.anisotropy=s);var h=_t.generateUUID();return n[h]=l,h}var a={uuid:_t.generateUUID(),type:"MeshLambertMaterial"};for(var o in e){var s=e[o];switch(o){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":a.name=s;break;case"blending":a.blending=Sl[s];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",o,"is no longer supported.");break;case"colorDiffuse":a.color=Al.fromArray(s).getHex();break;case"colorSpecular":a.specular=Al.fromArray(s).getHex();break;case"colorEmissive":a.emissive=Al.fromArray(s).getHex();break;case"specularCoef":a.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(a.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(a.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(a.type="MeshStandardMaterial");break;case"mapDiffuse":a.map=i(s,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":a.emissiveMap=i(s,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":a.lightMap=i(s,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":a.aoMap=i(s,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":a.bumpMap=i(s,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":a.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":a.normalMap=i(s,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":a.normalScale=s;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":a.specularMap=i(s,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":a.metalnessMap=i(s,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":a.roughnessMap=i(s,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":a.alphaMap=i(s,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":a.side=d;break;case"doubleSided":a.side=p;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),a.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":a[o]=s;break;case"vertexColors":!0===s&&(a.vertexColors=v),"face"===s&&(a.vertexColors=m);break;default:console.error("THREE.Loader.createMaterial: Unsupported",o,s)}}return"MeshBasicMaterial"===a.type&&delete a.emissive,"MeshPhongMaterial"!==a.type&&delete a.specular,a.opacity<1&&(a.transparent=!0),Ll.setTextures(n),Ll.parse(a)})});var Ul,Bl,Gl,Vl,jl,Wl,Xl,Yl,ql,Ql,Zl,Kl,Jl,$l,ec,tc={getContext:function(){return void 0===Ml&&(Ml=new(window.AudioContext||window.webkitAudioContext)),Ml},setContext:function(e){Ml=e}};function rc(e){this.manager=void 0!==e?e:Ls}function nc(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new St)}function ic(e,t){ll.call(this,void 0,t),this.sh=void 0!==e?e:new nc}function ac(e,t,r){ic.call(this,void 0,r);var n=(new Rr).set(e),i=(new Rr).set(t),a=new St(n.r,n.g,n.b),o=new St(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function oc(e,t){ic.call(this,void 0,t);var r=(new Rr).set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}function sc(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ln,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ln,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function lc(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function cc(){mr.call(this),this.type="AudioListener",this.context=tc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function uc(e){mr.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function hc(e){uc.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function dc(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function pc(e,t,r){this.binding=e,this.valueSize=r;var n,i=Float64Array;switch(t){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function fc(e,t,r){var n=r||mc.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function mc(e,t,r){this.path=t,this.parsedPath=r||mc.parseTrackName(t),this.node=mc.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function vc(){this.uuid=_t.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function gc(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var n=t.tracks,i=n.length,a=new Array(i),o={endingStart:ct,endingEnd:ct},s=0;s!==i;++s){var l=n[s].createInterpolant(null);a[s]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=lt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function yc(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Ec(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function xc(e,t,r){_a.call(this,e,t),this.meshPerAttribute=r||1}function bc(e,t,r,n){this.ray=new Er(e,t),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Tc(e,t){return e.distance-t.distance}function wc(e,t,r,n){if(!1!==e.visible&&(e.raycast(t,r),!0===n))for(var i=e.children,a=0,o=i.length;a<o;a++)wc(i[a],t,r,!0)}function _c(e,t,r){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==r?r:0,this}function Rc(e,t,r){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==r?r:0,this}function Mc(e,t){this.min=void 0!==e?e:new Rt(1/0,1/0),this.max=void 0!==t?t:new Rt(-1/0,-1/0)}function Sc(e,t){this.start=void 0!==e?e:new St,this.end=void 0!==t?t:new St}function Ac(e){mr.call(this),this.material=e,this.render=function(){}}function Pc(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16711680,a=void 0!==n?n:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);var l=new qr,c=new Br(2*o*3,3);l.addAttribute("position",c),ka.call(this,l,new Ha({color:i,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function Lc(e,t){mr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new qr,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1;i<32;i++,a++){var o=i/32*Math.PI*2,s=a/32*Math.PI*2;n.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.addAttribute("position",new Br(n,3));var l=new Ha({fog:!1});this.cone=new ka(r,l),this.add(this.cone),this.update()}function Cc(e){for(var t=function e(t){var r=[];t&&t.isBone&&r.push(t);for(var n=0;n<t.children.length;n++)r.push.apply(r,e(t.children[n]));return r}(e),r=new qr,n=[],i=[],a=new Rr(0,0,1),o=new Rr(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}r.addAttribute("position",new Br(n,3)),r.addAttribute("color",new Br(i,3));var c=new Ha({vertexColors:v,depthTest:!1,depthWrite:!1,transparent:!0});ka.call(this,r,c),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Hc(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var n=new Uo(t,4,2),i=new Hr({wireframe:!0,fog:!1});Qr.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Ic(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var r=new qr;r.addAttribute("position",new Br([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere();var n=new Ha({fog:!1});Ia.call(this,r,n);var i=new qr;i.addAttribute("position",new Br([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),i.computeBoundingSphere(),this.add(new Qr(i,new Hr({side:d,fog:!1}))),this.update()}function kc(e,t,r){mr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new Za(t);n.rotateY(.5*Math.PI),this.material=new Hr({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=v);var i=n.getAttribute("position"),a=new Float32Array(3*i.count);n.addAttribute("color",new Ir(a,3)),this.add(new Qr(n,this.material)),this.update()}function Oc(e,t){this.lightProbe=e,this.size=t;var r={GAMMA_OUTPUT:""},n=new on({defines:r,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),i=new Uo(1,32,16);Qr.call(this,i,n),this.onBeforeRender()}function Nc(e,t,r,n){e=e||10,t=t||10,r=new Rr(void 0!==r?r:4473924),n=new Rr(void 0!==n?n:8947848);for(var i=t/2,a=e/t,o=e/2,s=[],l=[],c=0,u=0,h=-o;c<=t;c++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var d=c===i?r:n;d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3,d.toArray(l,u),u+=3}var p=new qr;p.addAttribute("position",new Br(s,3)),p.addAttribute("color",new Br(l,3));var f=new Ha({vertexColors:v});ka.call(this,p,f)}function Fc(e,t,r,n,i,a){e=e||10,t=t||16,r=r||8,n=n||64,i=new Rr(void 0!==i?i:4473924),a=new Rr(void 0!==a?a:8947848);var o,s,l,c,u,h,d,p=[],f=[];for(c=0;c<=t;c++)l=c/t*(2*Math.PI),o=Math.sin(l)*e,s=Math.cos(l)*e,p.push(0,0,0),p.push(o,0,s),d=1&c?i:a,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(c=0;c<=r;c++)for(d=1&c?i:a,h=e-e/r*c,u=0;u<n;u++)l=u/n*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,p.push(o,0,s),f.push(d.r,d.g,d.b),l=(u+1)/n*(2*Math.PI),o=Math.sin(l)*h,s=Math.cos(l)*h,p.push(o,0,s),f.push(d.r,d.g,d.b);var m=new qr;m.addAttribute("position",new Br(p,3)),m.addAttribute("color",new Br(f,3));var g=new Ha({vertexColors:v});ka.call(this,m,g)}function Dc(e,t,r,n){this.audio=e,this.range=t||1,this.divisionsInnerAngle=r||16,this.divisionsOuterAngle=n||2;var i=new qr,a=this.divisionsInnerAngle+2*this.divisionsOuterAngle,o=new Float32Array(3*(3*a+3));i.addAttribute("position",new Ir(o,3));var s=new Ha({color:65280}),l=new Ha({color:16776960});Ia.call(this,i,[l,s]),this.update()}function zc(e,t,r,n){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==r?r:16776960,a=void 0!==n?n:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new qr,c=new Br(2*o*3,3);l.addAttribute("position",c),ka.call(this,l,new Ha({color:i,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function Uc(e,t,r){mr.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1);var n=new qr;n.addAttribute("position",new Br([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new Ha({fog:!1});this.lightPlane=new Ia(n,i),this.add(this.lightPlane),(n=new qr).addAttribute("position",new Br([0,0,0,0,0,1],3)),this.targetLine=new Ia(n,i),this.add(this.targetLine),this.update()}function Bc(e){var t=new qr,r=new Ha({color:16777215,vertexColors:m}),n=[],i=[],a={},o=new Rr(16755200),s=new Rr(16711680),l=new Rr(43775),c=new Rr(16777215),u=new Rr(3355443);function h(e,t,r){d(e,r),d(t,r)}function d(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(n.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.addAttribute("position",new Br(n,3)),t.addAttribute("color",new Br(i,3)),ka.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function Gc(e,t){this.object=e,void 0===t&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new qr;i.setIndex(new Ir(r,1)),i.addAttribute("position",new Ir(n,3)),ka.call(this,i,new Ha({color:t})),this.matrixAutoUpdate=!1,this.update()}function Vc(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new qr;n.setIndex(new Ir(r,1)),n.addAttribute("position",new Br([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),ka.call(this,n,new Ha({color:t})),this.geometry.computeBoundingSphere()}function jc(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var n=void 0!==r?r:16776960,i=new qr;i.addAttribute("position",new Br([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Ia.call(this,i,new Ha({color:n}));var a=new qr;a.addAttribute("position",new Br([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Qr(a,new Hr({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function Wc(e,t,r,n,i,a){mr.call(this),void 0===e&&(e=new St(0,0,1)),void 0===t&&(t=new St(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*r),void 0===a&&(a=.2*i),void 0===Ul&&((Ul=new qr).addAttribute("position",new Br([0,0,0,0,1,0],3)),(Bl=new Zo(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Ia(Ul,new Ha({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Qr(Bl,new Hr({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,a)}function Xc(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new qr;r.addAttribute("position",new Br(t,3)),r.addAttribute("color",new Br([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new Ha({vertexColors:v});ka.call(this,r,n)}function Yc(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ys.call(this,e),this.type="catmullrom",this.closed=!0}function qc(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ys.call(this,e),this.type="catmullrom"}function Qc(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ys.call(this,e),this.type="catmullrom"}Object.assign(rc.prototype,{load:function(e,t,r,n){var i=new Hs(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,function(e){var r=e.slice(0),n=tc.getContext();n.decodeAudioData(r,function(e){t(e)})},r,n)},setPath:function(e){return this.path=e,this}}),Object.assign(nc.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var r=e.x,n=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScale(a[1],.488603*n),t.addScale(a[2],.488603*i),t.addScale(a[3],.488603*r),t.addScale(a[4],r*n*1.092548),t.addScale(a[5],n*i*1.092548),t.addScale(a[6],.315392*(3*i*i-1)),t.addScale(a[7],r*i*1.092548),t.addScale(a[8],.546274*(r*r-n*n)),t},getIrradianceAt:function(e,t){var r=e.x,n=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScale(a[1],1.023328*n),t.addScale(a[2],1.023328*i),t.addScale(a[3],1.023328*r),t.addScale(a[4],.858086*r*n),t.addScale(a[5],.858086*n*i),t.addScale(a[6],.743125*i*i-.247708),t.addScale(a[7],.858086*r*i),t.addScale(a[8],.429043*(r*r-n*n)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e){for(var t=this.coefficients,r=0;r<9;r++)t[r].fromArray(e,3*r);return this},toArray:function(){for(var e=[],t=this.coefficients,r=0;r<9;r++)t[r].toArray(e,3*r);return e}}),Object.assign(nc,{getBasisAt:function(e,t){var r=e.x,n=e.y,i=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*i,t[3]=.488603*r,t[4]=1.092548*r*n,t[5]=1.092548*n*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*r*i,t[8]=.546274*(r*r-n*n)}}),ic.prototype=Object.assign(Object.create(ll.prototype),{constructor:ic,isLightProbe:!0,copy:function(e){return ll.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){var t=ll.prototype.toJSON.call(this,e);return t}}),ac.prototype=Object.assign(Object.create(ic.prototype),{constructor:ac,isHemisphereLightProbe:!0,copy:function(e){return ic.prototype.copy.call(this,e),this},toJSON:function(e){var t=ic.prototype.toJSON.call(this,e);return t}}),oc.prototype=Object.assign(Object.create(ic.prototype),{constructor:oc,isAmbientLightProbe:!0,copy:function(e){return ic.prototype.copy.call(this,e),this},toJSON:function(e){var t=ic.prototype.toJSON.call(this,e);return t}}),Object.assign(sc.prototype,{update:function(){var e,t,r,n,i,a,o,s,l=new Wt,c=new Wt;return function(u){var h=e!==this||t!==u.focus||r!==u.fov||n!==u.aspect*this.aspect||i!==u.near||a!==u.far||o!==u.zoom||s!==this.eyeSep;if(h){e=this,t=u.focus,r=u.fov,n=u.aspect*this.aspect,i=u.near,a=u.far,o=u.zoom;var d,p,f=u.projectionMatrix.clone(),m=(s=this.eyeSep/2)*i/t,v=i*Math.tan(_t.DEG2RAD*r*.5)/o;c.elements[12]=-s,l.elements[12]=s,d=-v*n+m,p=v*n+m,f.elements[0]=2*i/(p-d),f.elements[8]=(p+d)/(p-d),this.cameraL.projectionMatrix.copy(f),d=-v*n-m,p=v*n-m,f.elements[0]=2*i/(p-d),f.elements[8]=(p+d)/(p-d),this.cameraR.projectionMatrix.copy(f)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()}),Object.assign(lc.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),cc.prototype=Object.assign(Object.create(mr.prototype),{constructor:cc,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new St,t=new Mt,r=new St,n=new St,i=new lc;return function(a){mr.prototype.updateMatrixWorld.call(this,a);var o=this.context.listener,s=this.up;if(this.timeDelta=i.getDelta(),this.matrixWorld.decompose(e,t,r),n.set(0,0,-1).applyQuaternion(t),o.positionX){var l=this.context.currentTime+this.timeDelta;o.positionX.linearRampToValueAtTime(e.x,l),o.positionY.linearRampToValueAtTime(e.y,l),o.positionZ.linearRampToValueAtTime(e.z,l),o.forwardX.linearRampToValueAtTime(n.x,l),o.forwardY.linearRampToValueAtTime(n.y,l),o.forwardZ.linearRampToValueAtTime(n.z,l),o.upX.linearRampToValueAtTime(s.x,l),o.upY.linearRampToValueAtTime(s.y,l),o.upZ.linearRampToValueAtTime(s.z,l)}else o.setPosition(e.x,e.y,e.z),o.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z)}}()}),uc.prototype=Object.assign(Object.create(mr.prototype),{constructor:uc,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),hc.prototype=Object.assign(Object.create(uc.prototype),{constructor:hc,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(){var e=new St,t=new Mt,r=new St,n=new St;return function(i){if(mr.prototype.updateMatrixWorld.call(this,i),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(e,t,r),n.set(0,0,1).applyQuaternion(t);var a=this.panner;if(a.positionX){var o=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(e.x,o),a.positionY.linearRampToValueAtTime(e.y,o),a.positionZ.linearRampToValueAtTime(e.z,o),a.orientationX.linearRampToValueAtTime(n.x,o),a.orientationY.linearRampToValueAtTime(n.y,o),a.orientationZ.linearRampToValueAtTime(n.z,o)}else a.setPosition(e.x,e.y,e.z),a.setOrientation(n.x,n.y,n.z)}}}()}),Object.assign(dc.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(pc.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize,i=e*n+n,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==n;++o)r[i+o]=r[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,r=this.buffer,n=e*t+t,i=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,i<1){var o=3*t;this._mixBufferRegion(r,n,o,1-i,t)}for(var s=t,l=t+t;s!==l;++s)if(r[s]!==r[s+t]){a.setValue(r,n);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,n=3*r;e.getValue(t,n);for(var i=r,a=n;i!==a;++i)t[i]=t[n+i%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,n,i){if(n>=.5)for(var a=0;a!==i;++a)e[t+a]=e[r+a]},_slerp:function(e,t,r,n){Mt.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,i){for(var a=1-n,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[r+o]*n}}}),Object.assign(fc.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(mc,{Composite:fc,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new mc.Composite(e,t,r):new mc(e,t,r)},sanitizeNodeName:(ec=new RegExp("[\\[\\]\\.:\\/]","g"),function(e){return e.replace(/\s/g,"_").replace(ec,"")}),parseTrackName:(Xl="[^\\[\\]\\.:\\/]",Yl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",ql=/((?:WC+[\/:])*)/.source.replace("WC",Xl),Ql=/(WCOD+)?/.source.replace("WCOD",Yl),Zl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Xl),Kl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Xl),Jl=new RegExp("^"+ql+Ql+Zl+Kl+"$"),$l=["material","materials","bones"],function(e){var t=Jl.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==$l.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var n=function(e){for(var r=0;r<e.length;r++){var i=e[r];if(i.name===t||i.uuid===t)return i;var a=n(i.children);if(a)return a}return null},i=n(e.children);if(i)return i}return null}}),Object.assign(mc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;if(e||(e=mc.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var a=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[n];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(var o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(var o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===i){i=o;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+n+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(mc.prototype,{_getValue_unbound:mc.prototype.getValue,_setValue_unbound:mc.prototype.setValue}),Object.assign(vc.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],d=h.uuid,p=n[d];if(void 0===p){p=t++,n[d]=p,e.push(h);for(var f=0,m=s;f!==m;++f)o[f].push(new mc(h,i[f],a[f]))}else if(p<r){l=e[p];var v=--r,g=e[v];n[g.uuid]=p,e[p]=g,n[d]=v,e[v]=h;for(var f=0,m=s;f!==m;++f){var y=o[f],E=y[v],x=y[p];y[p]=E,void 0===x&&(x=new mc(h,i[f],a[f])),y[v]=x}}else e[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,c=r[l];if(void 0!==c&&c>=t){var u=t++,h=e[u];r[h.uuid]=c,e[c]=h,r[l]=u,e[u]=s;for(var d=0,p=i;d!==p;++d){var f=n[d],m=f[u],v=f[c];f[c]=m,f[u]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o],c=l.uuid,u=n[c];if(void 0!==u)if(delete n[c],u<r){var h=--r,d=e[h],p=--t,f=e[p];n[d.uuid]=u,e[u]=d,n[f.uuid]=h,e[h]=f,e.pop();for(var m=0,v=a;m!==v;++m){var g=i[m],y=g[h],E=g[p];g[u]=y,g[h]=E,g.pop()}}else{var p=--t,f=e[p];n[f.uuid]=u,e[u]=f,e.pop();for(var m=0,v=a;m!==v;++m){var g=i[m];g[u]=g[p],g.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);n=i.length,r[e]=n,a.push(e),o.push(t),i.push(u);for(var h=c,d=s.length;h!==d;++h){var p=s[h];u[h]=new mc(p,e,t)}return u},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o],l=e[o];t[l]=r,a[r]=s,a.pop(),i[r]=i[o],i.pop(),n[r]=n[o],n.pop()}}}),Object.assign(gc.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var n=this._clip.duration,i=e._clip.duration,a=i/n,o=n/i;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,i=n.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+r,l[0]=e/o,l[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var a=(e-i)*r;if(a<0||0===r)return;this._startTime=null,t=r*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,c=this._propertyBindings,u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(n,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n,e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,n=this.loop,i=this._loopCount,a=2202===n;if(0===e)return-1===i?t:a&&1==(1&i)?r-t:t;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=r)t=r;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=r||t<0){var o=Math.floor(t/r);t-=r*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?r:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=t;if(a&&1==(1&i))return r-t}return t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:ct:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:ct:2402)},_scheduleFading:function(e,t,r){var n=this._mixer,i=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=r,this}}),yc.prototype=Object.assign(Object.create(t.prototype),{constructor:yc,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,a=e._propertyBindings,o=e._interpolants,s=r.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==i;++u){var h=n[u],d=h.name,p=c[d];if(void 0!==p)a[u]=p;else{if(void 0!==(p=a[u])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=t&&t._propertyBindings[u].binding.parsedPath;++(p=new pc(mc.create(r,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),a[u]=p}o[u].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,t)}for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n,t[n]=r,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null;var u=o.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,i=n[t],a=this._bindings;void 0===i&&(i={},n[t]=i),i[r]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid,i=r.path,a=this._bindingsByRootAndName,o=a[n],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[n]},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n,t[n]=e,i._cacheIndex=r,t[r]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&((r=new vs(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n,t[n]=e,i.__cacheIndex=r,t[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Ms.findByName(r,e):e,a=null!==i?i.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var l=o.actionByRoot[n];if(void 0!==l)return l;s=o.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var c=new gc(this,i,t);return this._bindAction(c,s),this._addInactiveAction(c,a,n),c},existingAction:function(e,t){var r=t||this._root,n=r.uuid,i="string"==typeof e?Ms.findByName(r,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[n]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(var i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==r;++o){var s=t[o];s._update(n,e,i,a)}for(var l=this._bindings,c=this._nActiveBindings,o=0;o!==c;++o)l[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot,a=i[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var o=this._bindingsByRootAndName,s=o[t];if(void 0!==s)for(var l in s){var c=s[l];c.restoreOriginalState(),this._removeInactiveBinding(c)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Ec.prototype.clone=function(){return new Ec(void 0===this.value.clone?this.value:this.value.clone())},xc.prototype=Object.assign(Object.create(_a.prototype),{constructor:xc,isInstancedInterleavedBuffer:!0,copy:function(e){return _a.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(bc.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this._camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this._camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var n=r||[];return wc(e,this,n,t),n.sort(Tc),n},intersectObjects:function(e,t,r){var n=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,a=e.length;i<a;i++)wc(e[i],this,n,t);return n.sort(Tc),n}}),Object.assign(_c.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(_t.clamp(t/this.radius,-1,1))),this}}),Object.assign(Rc.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}}),Object.assign(Mc.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Rt;return function(t,r){var n=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Rt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Rt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Rt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Rt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Rt;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Sc.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new St),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new St),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new St),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(jl=new St,Wl=new St,function(e,t){jl.subVectors(e,this.start),Wl.subVectors(this.end,this.start);var r=Wl.dot(Wl),n=Wl.dot(jl),i=n/r;return t&&(i=_t.clamp(i,0,1)),i}),closestPointToPoint:function(e,t,r){var n=this.closestPointToPointParameter(e,t);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new St),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Ac.prototype=Object.create(mr.prototype),Ac.prototype.constructor=Ac,Ac.prototype.isImmediateRenderObject=!0,Pc.prototype=Object.create(ka.prototype),Pc.prototype.constructor=Pc,Pc.prototype.update=function(){var e=new St,t=new St,r=new At;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,l=o.faces,c=0,u=0,h=l.length;u<h;u++)for(var d=l[u],p=0,f=d.vertexNormals.length;p<f;p++){var m=s[d[n[p]]],v=d.vertexNormals[p];e.copy(m).applyMatrix4(i),t.copy(v).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(c,e.x,e.y,e.z),c+=1,a.setXYZ(c,t.x,t.y,t.z),c+=1}else if(o&&o.isBufferGeometry)for(var g=o.attributes.position,y=o.attributes.normal,c=0,p=0,f=g.count;p<f;p++)e.set(g.getX(p),g.getY(p),g.getZ(p)).applyMatrix4(i),t.set(y.getX(p),y.getY(p),y.getZ(p)),t.applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),a.setXYZ(c,e.x,e.y,e.z),c+=1,a.setXYZ(c,t.x,t.y,t.z),c+=1;a.needsUpdate=!0}}(),Lc.prototype=Object.create(mr.prototype),Lc.prototype.constructor=Lc,Lc.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Lc.prototype.update=function(){var e=new St;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,r=t*Math.tan(this.light.angle);this.cone.scale.set(r,r,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),Cc.prototype=Object.create(ka.prototype),Cc.prototype.constructor=Cc,Cc.prototype.updateMatrixWorld=function(){var e=new St,t=new Wt,r=new Wt;return function(n){var i=this.bones,a=this.geometry,o=a.getAttribute("position");r.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<i.length;s++){var c=i[s];c.parent&&c.parent.isBone&&(t.multiplyMatrices(r,c.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(r,c.parent.matrixWorld),e.setFromMatrixPosition(t),o.setXYZ(l+1,e.x,e.y,e.z),l+=2)}a.getAttribute("position").needsUpdate=!0,mr.prototype.updateMatrixWorld.call(this,n)}}(),Hc.prototype=Object.create(Qr.prototype),Hc.prototype.constructor=Hc,Hc.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Hc.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},Ic.prototype=Object.create(Ia.prototype),Ic.prototype.constructor=Ic,Ic.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},Ic.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},kc.prototype=Object.create(mr.prototype),kc.prototype.constructor=kc,kc.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},kc.prototype.update=function(){var e=new St,t=new Rr,r=new Rr;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");t.copy(this.light.color),r.copy(this.light.groundColor);for(var a=0,o=i.count;a<o;a++){var s=a<o/2?t:r;i.setXYZ(a,s.r,s.g,s.b)}i.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),Oc.prototype=Object.create(Qr.prototype),Oc.prototype.constructor=Oc,Oc.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Oc.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},Nc.prototype=Object.assign(Object.create(ka.prototype),{constructor:Nc,copy:function(e){return ka.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Fc.prototype=Object.create(ka.prototype),Fc.prototype.constructor=Fc,Dc.prototype=Object.create(Ia.prototype),Dc.prototype.constructor=Dc,Dc.prototype.update=function(){var e,t,r=this.audio,n=this.range,i=this.divisionsInnerAngle,a=this.divisionsOuterAngle,o=_t.degToRad(r.panner.coneInnerAngle),s=_t.degToRad(r.panner.coneOuterAngle),l=o/2,c=s/2,u=0,h=0,d=this.geometry,p=d.attributes.position;function f(r,i,a,o){var s=(i-r)/a;for(p.setXYZ(u,0,0,0),h++,e=r;e<i;e+=s)t=u+h,p.setXYZ(t,Math.sin(e)*n,0,Math.cos(e)*n),p.setXYZ(t+1,Math.sin(Math.min(e+s,i))*n,0,Math.cos(Math.min(e+s,i))*n),p.setXYZ(t+2,0,0,0),h+=3;d.addGroup(u,h,o),u+=h,h=0}d.clearGroups(),f(-c,-l,a,0),f(-l,l,i,1),f(l,c,a,0),p.needsUpdate=!0,o===s&&(this.material[0].visible=!1)},Dc.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},zc.prototype=Object.create(ka.prototype),zc.prototype.constructor=zc,zc.prototype.update=function(){var e=new St,t=new St,r=new At;return function(){this.object.updateMatrixWorld(!0),r.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,l=0,c=0,u=s.length;c<u;c++){var h=s[c],d=h.normal;e.copy(o[h.a]).add(o[h.b]).add(o[h.c]).divideScalar(3).applyMatrix4(n),t.copy(d).applyMatrix3(r).normalize().multiplyScalar(this.size).add(e),i.setXYZ(l,e.x,e.y,e.z),l+=1,i.setXYZ(l,t.x,t.y,t.z),l+=1}i.needsUpdate=!0}}(),Uc.prototype=Object.create(mr.prototype),Uc.prototype.constructor=Uc,Uc.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Uc.prototype.update=function(){var e=new St,t=new St,r=new St;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=r.length()}}(),Bc.prototype=Object.create(ka.prototype),Bc.prototype.constructor=Bc,Bc.prototype.update=function(){var e,t,r=new St,n=new sn;function i(i,a,o,s){r.set(a,o,s).unproject(n);var l=t[i];if(void 0!==l)for(var c=e.getAttribute("position"),u=0,h=l.length;u<h;u++)c.setXYZ(l[u],r.x,r.y,r.z)}return function(){e=this.geometry,t=this.pointMap,n.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),i("c",0,0,-1),i("t",0,0,1),i("n1",-1,-1,-1),i("n2",1,-1,-1),i("n3",-1,1,-1),i("n4",1,1,-1),i("f1",-1,-1,1),i("f2",1,-1,1),i("f3",-1,1,1),i("f4",1,1,1),i("u1",.7,1.1,-1),i("u2",-.7,1.1,-1),i("u3",0,2,-1),i("cf1",-1,0,1),i("cf2",1,0,1),i("cf3",0,-1,1),i("cf4",0,1,1),i("cn1",-1,0,-1),i("cn2",1,0,-1),i("cn3",0,-1,-1),i("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),Gc.prototype=Object.create(ka.prototype),Gc.prototype.constructor=Gc,Gc.prototype.update=function(){var e=new gr;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var r=e.min,n=e.max,i=this.geometry.attributes.position,a=i.array;a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=r.x,a[4]=n.y,a[5]=n.z,a[6]=r.x,a[7]=r.y,a[8]=n.z,a[9]=n.x,a[10]=r.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=r.z,a[15]=r.x,a[16]=n.y,a[17]=r.z,a[18]=r.x,a[19]=r.y,a[20]=r.z,a[21]=n.x,a[22]=r.y,a[23]=r.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Gc.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Gc.prototype.copy=function(e){return ka.prototype.copy.call(this,e),this.object=e.object,this},Gc.prototype.clone=function(){return(new this.constructor).copy(this)},Vc.prototype=Object.create(ka.prototype),Vc.prototype.constructor=Vc,Vc.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),mr.prototype.updateMatrixWorld.call(this,e))},jc.prototype=Object.create(Ia.prototype),jc.prototype.constructor=jc,jc.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?d:h,this.lookAt(this.plane.normal),mr.prototype.updateMatrixWorld.call(this,e)},Wc.prototype=Object.create(mr.prototype),Wc.prototype.constructor=Wc,Wc.prototype.setDirection=(Vl=new St,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(Vl.set(e.z,0,-e.x).normalize(),Gl=Math.acos(e.y),this.quaternion.setFromAxisAngle(Vl,Gl))}),Wc.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Wc.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Wc.prototype.copy=function(e){return mr.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Wc.prototype.clone=function(){return(new this.constructor).copy(this)},Xc.prototype=Object.create(ka.prototype),Xc.prototype.constructor=Xc,zs.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(zs.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(al.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Kr,r=0,n=e.length;r<n;r++){var i=e[r];t.vertices.push(new St(i.x,i.y,i.z||0))}return t}}),Object.assign(ol.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Yc.prototype=Object.create(Ys.prototype),qc.prototype=Object.create(Ys.prototype),Qc.prototype=Object.create(Ys.prototype),Object.assign(Qc.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Nc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Cc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(zl.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),xl.extractUrlBase(e)}}),Object.assign(Rl.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Mc.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(gr.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Sc.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(_t,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),_t.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),_t.ceilPowerOfTwo(e)}}),Object.assign(At.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Wt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new St),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,n,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,r,i,a)}}),vn.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Mt.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Er.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(xr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(xr,{barycoordFromPoint:function(e,t,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),xr.getBarycoord(e,t,r,n,i)},normal:function(e,t,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),xr.getNormal(e,t,r,n)}}),Object.assign(sl.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Io(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Wo(this,e)}}),Object.assign(Rt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(St.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Gt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Kr.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(mr.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(mr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Aa.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(La.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Pa.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(zs.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),ln.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ll.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ir.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(qr.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(qr.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(ko.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Ec.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Cr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Rr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(os.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(on.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(ba.prototype,{clearTarget:function(e,t,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")}}),Object.defineProperties(ba.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ia.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(fn.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(Vt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Ea.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),uc.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,r=new rc;return r.load(e,function(e){t.setBuffer(e)}),this},dc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},pn.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Zc={merge:function(e,t,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};zt.crossOrigin=void 0,zt.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Ds;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},zt.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Fs;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,r,void 0,n);return t&&(a.mapping=t),a},zt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},zt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Kc={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};e.ACESFilmicToneMapping=te,e.AddEquation=w,e.AddOperation=Q,e.AdditiveBlending=E,e.AlphaFormat=Le,e.AlwaysDepth=U,e.AmbientLight=gl,e.AmbientLightProbe=oc,e.AnimationClip=Ms,e.AnimationLoader=Is,e.AnimationMixer=yc,e.AnimationObjectGroup=vc,e.AnimationUtils=ps,e.ArcCurve=Bs,e.ArrayCamera=ca,e.ArrowHelper=Wc,e.Audio=uc,e.AudioAnalyser=dc,e.AudioContext=tc,e.AudioListener=cc,e.AudioLoader=rc,e.AxesHelper=Xc,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Xc(e)},e.BackSide=d,e.BasicDepthPacking=xt,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Os(e)},e.Bone=Ca,e.BooleanKeyframeTrack=Es,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Gc(e,t)},e.Box2=Mc,e.Box3=gr,e.Box3Helper=Vc,e.BoxBufferGeometry=$r,e.BoxGeometry=Jr,e.BoxHelper=Gc,e.BufferAttribute=Ir,e.BufferGeometry=qr,e.BufferGeometryLoader=wl,e.ByteType=Ee,e.Cache=As,e.Camera=sn,e.CameraHelper=Bc,e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=Ua,e.CatmullRomCurve3=Ys,e.CineonToneMapping=ee,e.CircleBufferGeometry=es,e.CircleGeometry=$o,e.ClampToEdgeWrapping=ue,e.Clock=lc,e.ClosedSplineCurve3=Yc,e.Color=Rr,e.ColorKeyframeTrack=xs,e.CompressedTexture=za,e.CompressedTextureLoader=ks,e.ConeBufferGeometry=Jo,e.ConeGeometry=Ko,e.CubeCamera=pn,e.CubeGeometry=Jr,e.CubeReflectionMapping=re,e.CubeRefractionMapping=ne,e.CubeTexture=Nn,e.CubeTextureLoader=Fs,e.CubeUVReflectionMapping=se,e.CubeUVRefractionMapping=le,e.CubicBezierCurve=Ks,e.CubicBezierCurve3=Js,e.CubicInterpolant=ms,e.CullFaceBack=s,e.CullFaceFront=l,e.CullFaceFrontBack=3,e.CullFaceNone=o,e.Curve=zs,e.CurvePath=al,e.CustomBlending=T,e.CylinderBufferGeometry=Zo,e.CylinderGeometry=Qo,e.Cylindrical=Rc,e.DataTexture=mn,e.DataTexture2DArray=Fn,e.DataTexture3D=Dn,e.DataTextureLoader=Os,e.DefaultLoadingManager=Ls,e.DepthFormat=Ne,e.DepthStencilFormat=Fe,e.DepthTexture=Ba,e.DirectionalLight=vl,e.DirectionalLightHelper=Uc,e.DirectionalLightShadow=ml,e.DiscreteInterpolant=gs,e.DodecahedronBufferGeometry=eo,e.DodecahedronGeometry=$a,e.DoubleSide=p,e.DstAlphaFactor=k,e.DstColorFactor=N,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new Ir(e,t).setDynamic(!0)},e.EdgesGeometry=qo,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ka(new qo(e.geometry),new Ha({color:void 0!==t?t:16777215}))},e.EllipseCurve=Us,e.EqualDepth=V,e.EquirectangularReflectionMapping=ie,e.EquirectangularRefractionMapping=ae,e.Euler=Xt,e.EventDispatcher=t,e.ExtrudeBufferGeometry=ko,e.ExtrudeGeometry=Io,e.Face3=Pr,e.Face4=function(e,t,r,n,i,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Pr(e,t,r,i,a,o)},e.FaceColors=m,e.FaceNormalsHelper=zc,e.FileLoader=Hs,e.FlatShading=1,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Br(e,t)},e.Float32BufferAttribute=Br,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Gr(e,t)},e.Float64BufferAttribute=Gr,e.FloatType=_e,e.Fog=wa,e.FogExp2=Ta,e.Font=Nl,e.FontLoader=Dl,e.FrontFaceDirectionCCW=1,e.FrontFaceDirectionCW=0,e.FrontSide=h,e.Frustum=gn,e.GammaEncoding=mt,e.Geometry=Kr,e.GeometryUtils=Zc,e.GreaterDepth=W,e.GreaterEqualDepth=j,e.GridHelper=Nc,e.Group=la,e.HalfFloatType=Re,e.HemisphereLight=cl,e.HemisphereLightHelper=kc,e.HemisphereLightProbe=ac,e.IcosahedronBufferGeometry=Ja,e.IcosahedronGeometry=Ka,e.ImageBitmapLoader=kl,e.ImageLoader=Ns,e.ImageUtils=zt,e.ImmediateRenderObject=Ac,e.InstancedBufferAttribute=Tl,e.InstancedBufferGeometry=bl,e.InstancedInterleavedBuffer=xc,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Fr(e,t)},e.Int16BufferAttribute=Fr,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new zr(e,t)},e.Int32BufferAttribute=zr,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new kr(e,t)},e.Int8BufferAttribute=kr,e.IntType=Te,e.InterleavedBuffer=_a,e.InterleavedBufferAttribute=Ra,e.Interpolant=fs,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeyframeTrack=ys,e.LOD=Aa,e.LatheBufferGeometry=jo,e.LatheGeometry=Vo,e.Layers=Yt,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},e.LessDepth=B,e.LessEqualDepth=G,e.Light=ll,e.LightProbe=ic,e.LightProbeHelper=Oc,e.LightShadow=ul,e.Line=Ia,e.Line3=Sc,e.LineBasicMaterial=Ha,e.LineCurve=$s,e.LineCurve3=el,e.LineDashedMaterial=hs,e.LineLoop=Oa,e.LinePieces=1,e.LineSegments=ka,e.LineStrip=0,e.LinearEncoding=pt,e.LinearFilter=me,e.LinearInterpolant=vs,e.LinearMipMapLinearFilter=ge,e.LinearMipMapNearestFilter=ve,e.LinearToneMapping=K,e.Loader=zl,e.LoaderUtils=xl,e.LoadingManager=Ps,e.LogLuvEncoding=3003,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=lt,e.LuminanceAlphaFormat=ke,e.LuminanceFormat=Ie,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.Material=Cr,e.MaterialLoader=El,e.Math=_t,e.Matrix3=At,e.Matrix4=Wt,e.MaxEquation=S,e.Mesh=Qr,e.MeshBasicMaterial=Hr,e.MeshDepthMaterial=ra,e.MeshDistanceMaterial=na,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=cs,e.MeshMatcapMaterial=us,e.MeshNormalMaterial=ls,e.MeshPhongMaterial=os,e.MeshPhysicalMaterial=as,e.MeshStandardMaterial=is,e.MeshToonMaterial=ss,e.MinEquation=M,e.MirroredRepeatWrapping=he,e.MixOperation=q,e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=b,e.MultiplyOperation=Y,e.NearestFilter=de,e.NearestMipMapLinearFilter=fe,e.NearestMipMapNearestFilter=pe,e.NeverDepth=z,e.NoBlending=g,e.NoColors=f,e.NoToneMapping=Z,e.NormalBlending=y,e.NotEqualDepth=X,e.NumberKeyframeTrack=bs,e.Object3D=mr,e.ObjectLoader=Rl,e.ObjectSpaceNormalMap=wt,e.OctahedronBufferGeometry=Za,e.OctahedronGeometry=Qa,e.OneFactor=P,e.OneMinusDstAlphaFactor=O,e.OneMinusDstColorFactor=F,e.OneMinusSrcAlphaFactor=I,e.OneMinusSrcColorFactor=C,e.OrthographicCamera=fl,e.PCFShadowMap=c,e.PCFSoftShadowMap=u,e.ParametricBufferGeometry=ja,e.ParametricGeometry=Va,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sa(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Na(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Fa(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Na(e)},e.Path=ol,e.PerspectiveCamera=ln,e.Plane=vn,e.PlaneBufferGeometry=_n,e.PlaneGeometry=wn,e.PlaneHelper=jc,e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Fa(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Na(e)},e.PointLight=pl,e.PointLightHelper=Hc,e.Points=Fa,e.PointsMaterial=Na,e.PolarGridHelper=Fc,e.PolyhedronBufferGeometry=Xa,e.PolyhedronGeometry=Wa,e.PositionalAudio=hc,e.PositionalAudioHelper=Dc,e.PropertyBinding=mc,e.PropertyMixer=pc,e.QuadraticBezierCurve=tl,e.QuadraticBezierCurve3=rl,e.Quaternion=Mt,e.QuaternionKeyframeTrack=ws,e.QuaternionLinearInterpolant=Ts,e.REVISION=a,e.RGBADepthPacking=bt,e.RGBAFormat=He,e.RGBA_ASTC_10x10_Format=at,e.RGBA_ASTC_10x5_Format=rt,e.RGBA_ASTC_10x6_Format=nt,e.RGBA_ASTC_10x8_Format=it,e.RGBA_ASTC_12x10_Format=ot,e.RGBA_ASTC_12x12_Format=st,e.RGBA_ASTC_4x4_Format=qe,e.RGBA_ASTC_5x4_Format=Qe,e.RGBA_ASTC_5x5_Format=Ze,e.RGBA_ASTC_6x5_Format=Ke,e.RGBA_ASTC_6x6_Format=Je,e.RGBA_ASTC_8x5_Format=$e,e.RGBA_ASTC_8x6_Format=et,e.RGBA_ASTC_8x8_Format=tt,e.RGBA_PVRTC_2BPPV1_Format=Xe,e.RGBA_PVRTC_4BPPV1_Format=We,e.RGBA_S3TC_DXT1_Format=Ue,e.RGBA_S3TC_DXT3_Format=Be,e.RGBA_S3TC_DXT5_Format=Ge,e.RGBDEncoding=Et,e.RGBEEncoding=vt,e.RGBEFormat=Oe,e.RGBFormat=Ce,e.RGBM16Encoding=yt,e.RGBM7Encoding=gt,e.RGB_ETC1_Format=Ye,e.RGB_PVRTC_2BPPV1_Format=je,e.RGB_PVRTC_4BPPV1_Format=Ve,e.RGB_S3TC_DXT1_Format=ze,e.RawShaderMaterial=ns,e.Ray=Er,e.Raycaster=bc,e.RectAreaLight=yl,e.RectAreaLightHelper=Ic,e.RedFormat=De,e.ReinhardToneMapping=J,e.RepeatWrapping=ce,e.ReverseSubtractEquation=R,e.RingBufferGeometry=Go,e.RingGeometry=Bo,e.Scene=vr,e.SceneUtils=Kc,e.ShaderChunk=yn,e.ShaderLib=xn,e.ShaderMaterial=on,e.ShadowMaterial=rs,e.Shape=sl,e.ShapeBufferGeometry=Xo,e.ShapeGeometry=Wo,e.ShapePath=Ol,e.ShapeUtils=Lo,e.ShortType=xe,e.Skeleton=La,e.SkeletonHelper=Cc,e.SkinnedMesh=Pa,e.SmoothShading=2,e.Sphere=yr,e.SphereBufferGeometry=Uo,e.SphereGeometry=zo,e.Spherical=_c,e.SphericalHarmonics3=nc,e.SphericalReflectionMapping=oe,e.Spline=Qc,e.SplineCurve=nl,e.SplineCurve3=qc,e.SpotLight=dl,e.SpotLightHelper=Lc,e.SpotLightShadow=hl,e.Sprite=Sa,e.SpriteMaterial=Ma,e.SrcAlphaFactor=H,e.SrcAlphaSaturateFactor=D,e.SrcColorFactor=L,e.StereoCamera=sc,e.StringKeyframeTrack=_s,e.SubtractEquation=_,e.SubtractiveBlending=x,e.TangentSpaceNormalMap=Tt,e.TetrahedronBufferGeometry=qa,e.TetrahedronGeometry=Ya,e.TextBufferGeometry=Do,e.TextGeometry=Fo,e.Texture=Bt,e.TextureLoader=Ds,e.TorusBufferGeometry=oo,e.TorusGeometry=ao,e.TorusKnotBufferGeometry=io,e.TorusKnotGeometry=no,e.Triangle=xr,e.TriangleFanDrawMode=dt,e.TriangleStripDrawMode=ht,e.TrianglesDrawMode=ut,e.TubeBufferGeometry=ro,e.TubeGeometry=to,e.UVMapping=300,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Dr(e,t)},e.Uint16BufferAttribute=Dr,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Ur(e,t)},e.Uint32BufferAttribute=Ur,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Or(e,t)},e.Uint8BufferAttribute=Or,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Nr(e,t)},e.Uint8ClampedBufferAttribute=Nr,e.Uncharted2ToneMapping=$,e.Uniform=Ec,e.UniformsLib=En,e.UniformsUtils=rn,e.UnsignedByteType=ye,e.UnsignedInt248Type=Pe,e.UnsignedIntType=we,e.UnsignedShort4444Type=Me,e.UnsignedShort5551Type=Se,e.UnsignedShort565Type=Ae,e.UnsignedShortType=be,e.Vector2=Rt,e.Vector3=St,e.Vector4=Gt,e.VectorKeyframeTrack=Rs,e.Vertex=function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new St(e,t,r)},e.VertexColors=v,e.VertexNormalsHelper=Pc,e.VideoTexture=Da,e.WebGLMultisampleRenderTarget=jt,e.WebGLRenderTarget=Vt,e.WebGLRenderTargetCube=fn,e.WebGLRenderer=ba,e.WebGLUtils=sa,e.WireframeGeometry=Ga,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ka(new Ga(e.geometry),new Ha({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=2402,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Hs(e)},e.ZeroCurvatureEnding=ct,e.ZeroFactor=A,e.ZeroSlopeEnding=2401,e.sRGBEncoding=ft,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,r){(function(r){var n,i=function(){this._tweens={},this._tweensAddedDuringUpdate={}};i.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(e=void 0!==e?e:o.now();r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var i=this._tweens[r[n]];i&&!1===i.update(e)&&(i._isPlaying=!1,t||delete this._tweens[r[n]])}r=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var a,o=new i;o.Group=i,o._nextId=0,o.nextId=function(){return o._nextId++},"undefined"==typeof self&&void 0!==r&&r.hrtime?o.now=function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?o.now=self.performance.now.bind(self.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=o.Easing.Linear.None,this._interpolationFunction=o.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||o,this._id=o.nextId()},o.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?o.now()+parseFloat(e):e:o.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==!1&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onRepeat:function(e){return this._onRepeatCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,r,n;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r,n=this._easingFunction(r),this._valuesEnd)if(void 0!==this._valuesStart[t]){var i=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,n):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?i+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=i+(a-i)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}return!0}},o.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-o.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*o.Easing.Bounce.In(2*e):.5*o.Easing.Bounce.Out(2*e-1)+.5}}},o.Interpolation={Linear:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],n):t>1?a(e[r],e[r-1],r-n):a(e[i],e[i+1>r?r:i+1],n-i)},Bezier:function(e,t){for(var r=0,n=e.length-1,i=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=n;s++)r+=i(1-t,n-s)*i(t,s)*e[s]*a(n,s);return r},CatmullRom:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),a=o.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(i=Math.floor(n=r*(1+t))),a(e[(i-1+r)%r],e[i],e[(i+1)%r],e[(i+2)%r],n-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[r]-(a(e[r],e[r],e[r-1],e[r-1],n-r)-e[r]):a(e[i?i-1:0],e[i],e[r<i+1?r:i+1],e[r<i+2?r:i+2],n-i)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=o.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(a=[1],function(e){var t=1;if(a[e])return a[e];for(var r=e;r>1;r--)t*=r;return a[e]=t,t}),CatmullRom:function(e,t,r,n,i){var a=.5*(r-e),o=.5*(n-t),s=i*i;return(2*t-2*r+a+o)*(i*s)+(-3*t+3*r-2*a-o)*s+a*i+t}}},void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}).call(this,r(92))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){(function(t){var r;e.exports=function e(t,n,i){function a(s,l){if(!n[s]){if(!t[s]){var c="function"==typeof r&&r;if(!l&&c)return r(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var r=t[s][1][e];return a(r||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,a,o,s,l,c="",u=0;u<e.length;)t=e.charCodeAt(u++),r=e.charCodeAt(u++),i=e.charCodeAt(u++),a=t>>2,o=(3&t)<<4|r>>4,s=(15&r)<<2|i>>6,l=63&i,isNaN(r)?s=l=64:isNaN(i)&&(l=64),c=c+n.charAt(a)+n.charAt(o)+n.charAt(s)+n.charAt(l);return c},r.decode=function(e){var t,r,i,a,o,s,l,c="",u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)a=n.indexOf(e.charAt(u++)),o=n.indexOf(e.charAt(u++)),s=n.indexOf(e.charAt(u++)),l=n.indexOf(e.charAt(u++)),t=a<<2|o>>4,r=(15&o)<<4|s>>2,i=(3&s)<<6|l,c+=String.fromCharCode(t),64!=s&&(c+=String.fromCharCode(r)),64!=l&&(c+=String.fromCharCode(i));return c}},{}],2:[function(e,t){"use strict";function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=r},{}],3:[function(e,t,r){"use strict";r.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},r.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t){"use strict";var r=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if(void 0===e||!e.length)return 0;var i="string"!==r.getTypeOf(e);void 0===t&&(t=0);var a=0;t^=-1;for(var o=0,s=e.length;s>o;o++)a=i?e[o]:e.charCodeAt(o),t=t>>>8^n[255&(t^a)];return-1^t}},{"./utils":21}],5:[function(e,t){"use strict";function r(){this.data=null,this.length=0,this.index=0}var n=e("./utils");r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=r},{"./utils":21}],6:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!1,r.date=null,r.compression=null,r.comment=null},{}],7:[function(e,t,r){"use strict";var n=e("./utils");r.string2binary=function(e){return n.string2binary(e)},r.string2Uint8Array=function(e){return n.transformTo("uint8array",e)},r.uint8Array2String=function(e){return n.transformTo("string",e)},r.string2Blob=function(e){var t=n.transformTo("arraybuffer",e);return n.arrayBuffer2Blob(t)},r.arrayBuffer2Blob=function(e){return n.arrayBuffer2Blob(e)},r.transformTo=function(e,t){return n.transformTo(e,t)},r.getTypeOf=function(e){return n.getTypeOf(e)},r.checkSupport=function(e){return n.checkSupport(e)},r.MAX_VALUE_16BITS=n.MAX_VALUE_16BITS,r.MAX_VALUE_32BITS=n.MAX_VALUE_32BITS,r.pretty=function(e){return n.pretty(e)},r.findCompression=function(e){return n.findCompression(e)},r.isRegExp=function(e){return n.isRegExp(e)}},{"./utils":21}],8:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako");r.uncompressInputType=n?"uint8array":"array",r.compressInputType=n?"uint8array":"array",r.magic="\b\0",r.compress=function(e){return i.deflateRaw(e)},r.uncompress=function(e){return i.inflateRaw(e)}},{pako:24}],9:[function(e,t){"use strict";function r(e,t){return this instanceof r?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new r(e,t)}var n=e("./base64");r.prototype=e("./object"),r.prototype.load=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.utils=e("./deprecatedPublicUtils"),r.base64={encode:function(e){return n.encode(e)},decode:function(e){return n.decode(e)}},r.compressions=e("./compressions"),t.exports=r},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t){"use strict";var r=e("./base64"),n=e("./zipEntries");t.exports=function(e,t){var i,a,o,s;for((t=t||{}).base64&&(e=r.decode(e)),a=new n(e,t),i=a.files,o=0;o<i.length;o++)s=i[o],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,createFolders:t.createFolders});return a.zipComment.length&&(this.comment=a.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,r){(function(e){"use strict";r.exports=function(t,r){return new e(t,r)},r.exports.test=function(t){return e.isBuffer(t)}}).call(this,void 0!==t?t:void 0)},{}],12:[function(e,t){"use strict";function r(e){this.data=e,this.length=this.data.length,this.index=0}var n=e("./uint8ArrayReader");r.prototype=new n,r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./uint8ArrayReader":18}],13:[function(e,t){"use strict";var r=e("./support"),n=e("./utils"),i=e("./crc32"),a=e("./signature"),o=e("./defaults"),s=e("./base64"),l=e("./compressions"),c=e("./compressedObject"),u=e("./nodeBuffer"),h=e("./utf8"),d=e("./stringWriter"),p=e("./uint8ArrayWriter"),f=function(e){if(e._data instanceof c&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===n.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},m=function(e){var t=f(e),i=n.getTypeOf(t);return"string"===i?!e.options.binary&&r.nodebuffer?u(t,"utf-8"):e.asBinary():t},v=function(e){var t=f(this);return null==t?"":(this.options.base64&&(t=s.decode(t)),t=e&&this.options.binary?M.utf8decode(t):n.transformTo("string",t),e||this.options.binary||(t=n.transformTo("string",M.utf8encode(t))),t)},g=function(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this._data=t,this.options=r,this._initialMetadata={dir:r.dir,date:r.date}};g.prototype={asText:function(){return v.call(this,!0)},asBinary:function(){return v.call(this,!1)},asNodeBuffer:function(){var e=m(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=m(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var y=function(e,t){var r,n="";for(r=0;t>r;r++)n+=String.fromCharCode(255&e),e>>>=8;return n},E=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},x=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=E(e,o)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},b=function(e,t,r){var i,a=n.getTypeOf(t);if((r=x(r)).createFolders&&(i=T(e))&&w.call(this,i,!0),r.dir||null==t)r.base64=!1,r.binary=!1,t=null;else if("string"===a)r.binary&&!r.base64&&!0!==r.optimizedBinaryString&&(t=n.string2binary(t));else{if(r.base64=!1,r.binary=!0,!(a||t instanceof c))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===a&&(t=n.transformTo("uint8array",t))}var o=new g(e,t,r);return this.files[e]=o,o},T=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},w=function(e,t){return"/"!=e.slice(-1)&&(e+="/"),t=void 0!==t&&t,this.files[e]||b.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},_=function(e,t){var r,a=new c;return e._data instanceof c?(a.uncompressedSize=e._data.uncompressedSize,a.crc32=e._data.crc32,0===a.uncompressedSize||e.dir?(t=l.STORE,a.compressedContent="",a.crc32=0):e._data.compressionMethod===t.magic?a.compressedContent=e._data.getCompressedContent():(r=e._data.getContent(),a.compressedContent=t.compress(n.transformTo(t.compressInputType,r)))):((!(r=m(e))||0===r.length||e.dir)&&(t=l.STORE,r=""),a.uncompressedSize=r.length,a.crc32=i(r),a.compressedContent=t.compress(n.transformTo(t.compressInputType,r))),a.compressedSize=a.compressedContent.length,a.compressionMethod=t.magic,a},R=function(e,t,r,o){var s,l,c,u,d=(r.compressedContent,n.transformTo("string",h.utf8encode(t.name))),p=t.comment||"",f=n.transformTo("string",h.utf8encode(p)),m=d.length!==t.name.length,v=f.length!==p.length,g=t.options,E="",x="",b="";c=t._initialMetadata.dir!==t.dir?t.dir:g.dir,u=t._initialMetadata.date!==t.date?t.date:g.date,s=u.getHours(),s<<=6,s|=u.getMinutes(),s<<=5,s|=u.getSeconds()/2,l=u.getFullYear()-1980,l<<=4,l|=u.getMonth()+1,l<<=5,l|=u.getDate(),m&&(x=y(1,1)+y(i(d),4)+d,E+="up"+y(x.length,2)+x),v&&(b=y(1,1)+y(this.crc32(f),4)+f,E+="uc"+y(b.length,2)+b);var T="";T+="\n\0",T+=m||v?"\0\b":"\0\0",T+=r.compressionMethod,T+=y(s,2),T+=y(l,2),T+=y(r.crc32,4),T+=y(r.compressedSize,4),T+=y(r.uncompressedSize,4),T+=y(d.length,2),T+=y(E.length,2);var w=a.LOCAL_FILE_HEADER+T+d+E,_=a.CENTRAL_FILE_HEADER+"\0"+T+y(f.length,2)+"\0\0\0\0"+(!0===c?"\0\0\0":"\0\0\0\0")+y(o,4)+d+E+f;return{fileRecord:w,dirRecord:_,compressedObject:r}},M={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,r,n,i,a=[];for(t in this.files)this.files.hasOwnProperty(t)&&(n=this.files[t],i=new g(n.name,n._data,E(n.options)),r=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(r,i)&&a.push(i));return a},file:function(e,t,r){if(1===arguments.length){if(n.isRegExp(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}return this.filter(function(t,r){return!r.dir&&t===e})[0]||null}return e=this.root+e,b.call(this,e,t,r),this},folder:function(e){if(!e)return this;if(n.isRegExp(e))return this.filter(function(t,r){return r.dir&&e.test(t)});var t=this.root+e,r=w.call(this,t),i=this.clone();return i.root=r.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter(function(t,r){return r.name.slice(0,e.length)===e}),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(e){e=E(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),n.checkSupport(e.type);var t,r,i=[],o=0,c=0,u=n.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var h in this.files)if(this.files.hasOwnProperty(h)){var f=this.files[h],m=f.options.compression||e.compression.toUpperCase(),v=l[m];if(!v)throw new Error(m+" is not a valid compression method !");var g=_.call(this,f,v),x=R.call(this,h,f,g,o);o+=x.fileRecord.length+g.compressedSize,c+=x.dirRecord.length,i.push(x)}var b="";b=a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+y(i.length,2)+y(i.length,2)+y(c,4)+y(o,4)+y(u.length,2)+u;var T=e.type.toLowerCase();for(t="uint8array"===T||"arraybuffer"===T||"blob"===T||"nodebuffer"===T?new p(o+c+b.length):new d(o+c+b.length),r=0;r<i.length;r++)t.append(i[r].fileRecord),t.append(i[r].compressedObject.compressedContent);for(r=0;r<i.length;r++)t.append(i[r].dirRecord);t.append(b);var w=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),w);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",w));case"base64":return e.base64?s.encode(w):w;default:return w}},crc32:function(e,t){return i(e,t)},utf8encode:function(e){return n.transformTo("string",h.utf8encode(e))},utf8decode:function(e){return h.utf8decode(e)}};t.exports=M},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,t){"use strict";function r(e,t){this.data=e,t||(this.data=i.string2binary(this.data)),this.length=this.data.length,this.index=0}var n=e("./dataReader"),i=e("./utils");r.prototype=new n,r.prototype.byteAt=function(e){return this.data.charCodeAt(e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5,"./utils":21}],16:[function(e,t){"use strict";var r=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=r.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=n},{"./utils":21}],17:[function(e,r,n){(function(e){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==e,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var t=new ArrayBuffer(0);try{n.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=new r;i.append(t),n.blob=0===i.getBlob("application/zip").size}catch(e){n.blob=!1}}}}).call(this,void 0!==t?t:void 0)},{}],18:[function(e,t){"use strict";function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var n=e("./dataReader");r.prototype=new n,r.prototype.byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===r&&this.data[a+2]===n&&this.data[a+3]===i)return a;return-1},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5}],19:[function(e,t){"use strict";var r=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=r.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=n},{"./utils":21}],20:[function(e,t,r){"use strict";for(var n=e("./utils"),i=e("./support"),a=e("./nodeBuffer"),o=new Array(256),s=0;256>s;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;o[254]=o[254]=1;var l=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r?t:0===r?t:r+o[e[r]]>t?r:t},c=function(e){var t,r,i,a,s=e.length,l=new Array(2*s);for(r=0,t=0;s>t;)if(128>(i=e[t++]))l[r++]=i;else if((a=o[i])>4)l[r++]=65533,t+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&s>t;)i=i<<6|63&e[t++],a--;a>1?l[r++]=65533:65536>i?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),n.applyFromCharCode(l)};r.utf8encode=function(e){return i.nodebuffer?a(e,"utf-8"):function(e){var t,r,n,a,o,s=e.length,l=0;for(a=0;s>a;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=i.uint8array?new Uint8Array(l):new Array(l),o=0,a=0;l>o;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t}(e)},r.utf8decode=function(e){if(i.nodebuffer)return n.transformTo("nodebuffer",e).toString("utf-8");e=n.transformTo(i.uint8array?"uint8array":"array",e);for(var t=[],r=0,a=e.length;a>r;){var o=l(e,Math.min(r+65536,a));t.push(i.uint8array?c(e.subarray(r,o)):c(e.slice(r,o))),r=o}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,r){"use strict";function n(e){return e}function i(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}function a(e){var t=65536,n=[],i=e.length,a=r.getTypeOf(e),o=0,s=!0;try{switch(a){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,c(0))}}catch(e){s=!1}if(!s){for(var l="",u=0;u<e.length;u++)l+=String.fromCharCode(e[u]);return l}for(;i>o&&t>1;)try{n.push("array"===a||"nodebuffer"===a?String.fromCharCode.apply(null,e.slice(o,Math.min(o+t,i))):String.fromCharCode.apply(null,e.subarray(o,Math.min(o+t,i)))),o+=t}catch(e){t=Math.floor(t/2)}return n.join("")}function o(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}var s=e("./support"),l=e("./compressions"),c=e("./nodeBuffer");r.string2binary=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(255&e.charCodeAt(r));return t},r.arrayBuffer2Blob=function(e){r.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(r){try{var t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=new t;return n.append(e),n.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},r.applyFromCharCode=a;var u={};u.string={string:n,array:function(e){return i(e,new Array(e.length))},arraybuffer:function(e){return u.string.uint8array(e).buffer},uint8array:function(e){return i(e,new Uint8Array(e.length))},nodebuffer:function(e){return i(e,c(e.length))}},u.array={string:a,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c(e)}},u.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return o(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c(new Uint8Array(e))}},u.uint8array={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return c(e)}},u.nodebuffer={string:a,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return u.nodebuffer.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:n},r.transformTo=function(e,t){if(t||(t=""),!e)return t;r.checkSupport(e);var n=r.getTypeOf(t),i=u[n][e](t);return i},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":s.nodebuffer&&c.test(e)?"nodebuffer":s.uint8array&&e instanceof Uint8Array?"uint8array":s.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){var t=s[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this browser")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)t=e.charCodeAt(r),n+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return n},r.findCompression=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null},r.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t){"use strict";function r(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var n=e("./stringReader"),i=e("./nodeBufferReader"),a=e("./uint8ArrayReader"),o=e("./utils"),s=e("./signature"),l=e("./zipEntry"),c=e("./support"),u=e("./object");r.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=u.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;n>0;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===s.CENTRAL_FILE_HEADER;)(e=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=o.getTypeOf(e);this.reader="string"!==t||c.uint8array?"nodebuffer"===t?new i(e):new a(o.transformTo("uint8array",e)):new n(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=r},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t){"use strict";function r(e,t){this.options=e,this.loadOptions=t}var n=e("./stringReader"),i=e("./utils"),a=e("./compressedObject"),o=e("./object");r.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,r){return function(){var n=e.index;e.setIndex(t);var i=e.readData(r);return e.setIndex(n),i}},prepareContent:function(e,t,r,n,a){return function(){var e=i.transformTo(n.uncompressInputType,this.getCompressedContent()),t=n.uncompress(e);if(t.length!==a)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(r),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=i.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new a,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=i.transformTo("string",this.decompressed.getContent()),o.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=new n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index;for(this.extraFields=this.extraFields||{};e.index<i+this.extraFieldsLength;)t=e.readInt(2),r=e.readInt(2),n=e.readString(r),this.extraFields[t]={id:t,length:r,value:n}},handleUTF8:function(){if(this.useUTF8())this.fileName=o.utf8decode(this.fileName),this.fileComment=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=r},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t){"use strict";var r=e("./lib/utils/common").assign,n=e("./lib/deflate"),i=e("./lib/inflate"),a=e("./lib/zlib/constants"),o={};r(o,n,i,a),t.exports=o},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,r){"use strict";function n(e,t){var r=new c(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/deflate.js"),a=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/messages"),l=e("./zlib/zstream"),c=function(e){this.options=a.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(s[r]);t.header&&i.deflateSetHeader(this.strm,t.header)};c.prototype.push=function(e,t){var r,n,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,s.input="string"==typeof e?o.string2buf(e):e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new a.Buf8(l),s.next_out=0,s.avail_out=l),1!==(r=i.deflate(s,n))&&0!==r)return this.onEnd(r),this.ended=!0,!1;(0===s.avail_out||0===s.avail_in&&4===n)&&this.onData("string"===this.options.to?o.buf2binstring(a.shrinkBuf(s.output,s.next_out)):a.shrinkBuf(s.output,s.next_out))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4!==n||(r=i.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r)},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){0===e&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=c,r.deflate=n,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,r){"use strict";function n(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg;return r.result}var i=e("./zlib/inflate.js"),a=e("./utils/common"),o=e("./utils/strings"),s=e("./zlib/constants"),l=e("./zlib/messages"),c=e("./zlib/zstream"),u=e("./zlib/gzheader"),h=function(e){this.options=a.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var r=i.inflateInit2(this.strm,t.windowBits);if(r!==s.Z_OK)throw new Error(l[r]);this.header=new u,i.inflateGetHeader(this.strm,this.header)};h.prototype.push=function(e,t){var r,n,l,c,u,h=this.strm,d=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,h.input="string"==typeof e?o.binstring2buf(e):e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new a.Buf8(d),h.next_out=0,h.avail_out=d),(r=i.inflate(h,s.Z_NO_FLUSH))!==s.Z_STREAM_END&&r!==s.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0===h.avail_out||r===s.Z_STREAM_END||0===h.avail_in&&n===s.Z_FINISH)&&("string"===this.options.to?(l=o.utf8border(h.output,h.next_out),c=h.next_out-l,u=o.buf2string(h.output,l),h.next_out=c,h.avail_out=d-c,c&&a.arraySet(h.output,h.output,l,c,0),this.onData(u)):this.onData(a.shrinkBuf(h.output,h.next_out)))}while(h.avail_in>0&&r!==s.Z_STREAM_END);return r===s.Z_STREAM_END&&(n=s.Z_FINISH),n!==s.Z_FINISH||(r=i.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===s.Z_OK)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===s.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=h,r.inflate=n,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},r.ungzip=n},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;n>a;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;r>t;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;r>t;t++)a=e[t],o.set(a,i),i+=a.length;return o}},a={arraySet:function(e,t,r,n,i){for(var a=0;n>a;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(n)},{}],28:[function(e,t,r){"use strict";function n(e,t){if(65537>t&&(e.subarray&&o||!e.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var r="",n=0;t>n;n++)r+=String.fromCharCode(e[n]);return r}var i=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new i.Buf8(256),l=0;256>l;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,r.string2buf=function(e){var t,r,n,a,o,s=e.length,l=0;for(a=0;s>a;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),l+=128>r?1:2048>r?2:65536>r?3:4;for(t=new i.Buf8(l),o=0,a=0;l>o;a++)55296==(64512&(r=e.charCodeAt(a)))&&s>a+1&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),128>r?t[o++]=r:2048>r?(t[o++]=192|r>>>6,t[o++]=128|63&r):65536>r?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},r.buf2binstring=function(e){return n(e,e.length)},r.binstring2buf=function(e){for(var t=new i.Buf8(e.length),r=0,n=t.length;n>r;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,i,a,o,l=t||e.length,c=new Array(2*l);for(i=0,r=0;l>r;)if(128>(a=e[r++]))c[i++]=a;else if((o=s[a])>4)c[i++]=65533,r+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&l>r;)a=a<<6|63&e[r++],o--;o>1?c[i++]=65533:65536>a?c[i++]=a:(a-=65536,c[i++]=55296|a>>10&1023,c[i++]=56320|1023&a)}return n(c,i)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return 0>r?t:0===r?t:r+s[e[r]]>t?r:t}},{"./common":27}],29:[function(e,t){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{i=i+t[n++]|0,a=a+i|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},{}],30:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t){"use strict";var r=function(){for(var e,t=[],r=0;256>r;r++){e=r;for(var n=0;8>n;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;o>s;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},{}],32:[function(e,t,r){"use strict";function n(e,t){return e.msg=M[t],t}function i(e){return(e<<1)-(e>4?9:0)}function a(e){for(var t=e.length;--t>=0;)e[t]=0}function o(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(T.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function s(e,t){w._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,o(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function c(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function u(e,t,r,n){var i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,T.arraySet(t,e.input,e.next_in,i,r),1===e.state.wrap?e.adler=_(e.adler,t,i,r):2===e.state.wrap&&(e.adler=R(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)}function h(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-te?e.strstart-(e.w_size-te):0,c=e.window,u=e.w_mask,h=e.prev,d=e.strstart+ee,p=c[a+o-1],f=c[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+o]===f&&c[r+o-1]===p&&c[r]===c[a]&&c[++r]===c[a+1]){a+=2,r++;do{}while(c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&c[++a]===c[++r]&&d>a);if(n=ee-(d-a),a=d-ee,n>o){if(e.match_start=t,o=n,n>=s)break;p=c[a+o-1],f=c[a+o]}}}while((t=h[t&u])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function d(e){var t,r,n,i,a,o=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=o+(o-te)){T.arraySet(e.window,e.window,o,o,0),e.match_start-=o,e.strstart-=o,e.block_start-=o,r=e.hash_size,t=r;do{n=e.head[--t],e.head[t]=n>=o?n-o:0}while(--r);t=r=o;do{n=e.prev[--t],e.prev[t]=n>=o?n-o:0}while(--r);i+=o}if(0===e.strm.avail_in)break;if(r=u(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=$)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+$-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<$)););}while(e.lookahead<te&&0!==e.strm.avail_in)}function p(e,t){for(var r,n;;){if(e.lookahead<te){if(d(e),e.lookahead<te&&t===S)return ue;if(0===e.lookahead)break}if(r=0,e.lookahead>=$&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-te&&(e.match_length=h(e,r)),e.match_length>=$)if(n=w._tr_tally(e,e.strstart-e.match_start,e.match_length-$),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=$){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=w._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(s(e,!1),0===e.strm.avail_out))return ue}return e.insert=e.strstart<$-1?e.strstart:$-1,t===L?(s(e,!0),0===e.strm.avail_out?de:pe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ue:he}function f(e,t){for(var r,n,i;;){if(e.lookahead<te){if(d(e),e.lookahead<te&&t===S)return ue;if(0===e.lookahead)break}if(r=0,e.lookahead>=$&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=$-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-te&&(e.match_length=h(e,r),e.match_length<=5&&(e.strategy===D||e.match_length===$&&e.strstart-e.match_start>4096)&&(e.match_length=$-1)),e.prev_length>=$&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-$,n=w._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-$),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+$-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=$-1,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return ue}else if(e.match_available){if((n=w._tr_tally(e,0,e.window[e.strstart-1]))&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return ue}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=w._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<$-1?e.strstart:$-1,t===L?(s(e,!0),0===e.strm.avail_out?de:pe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ue:he}function m(e,t){for(var r,n,i,a,o=e.window;;){if(e.lookahead<=ee){if(d(e),e.lookahead<=ee&&t===S)return ue;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=$&&e.strstart>0&&(i=e.strstart-1,(n=o[i])===o[++i]&&n===o[++i]&&n===o[++i])){a=e.strstart+ee;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&a>i);e.match_length=ee-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=$?(r=w._tr_tally(e,1,e.match_length-$),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=w._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(s(e,!1),0===e.strm.avail_out))return ue}return e.insert=0,t===L?(s(e,!0),0===e.strm.avail_out?de:pe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ue:he}function v(e,t){for(var r;;){if(0===e.lookahead&&(d(e),0===e.lookahead)){if(t===S)return ue;break}if(e.match_length=0,r=w._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(s(e,!1),0===e.strm.avail_out))return ue}return e.insert=0,t===L?(s(e,!0),0===e.strm.avail_out?de:pe):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?ue:he}function g(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=j,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new T.Buf16(2*K),this.dyn_dtree=new T.Buf16(2*(2*Q+1)),this.bl_tree=new T.Buf16(2*(2*Z+1)),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new T.Buf16(J+1),this.heap=new T.Buf16(2*q+1),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new T.Buf16(2*q+1),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function y(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=V,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ne:le,e.adler=2===t.wrap?0:1,t.last_flush=S,w._tr_init(t),H):n(e,k)}function E(e){var t=y(e);return t===H&&function(e){e.window_size=2*e.w_size,a(e.head),e.max_lazy_match=b[e.level].max_lazy,e.good_match=b[e.level].good_length,e.nice_match=b[e.level].nice_length,e.max_chain_length=b[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=$-1,e.match_available=0,e.ins_h=0}(e.state),t}function x(e,t,r,i,a,o){if(!e)return k;var s=1;if(t===F&&(t=6),0>i?(s=0,i=-i):i>15&&(s=2,i-=16),1>a||a>W||r!==j||8>i||i>15||0>t||t>9||0>o||o>B)return n(e,k);8===i&&(i=9);var l=new g;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+$-1)/$),l.window=new T.Buf8(2*l.w_size),l.head=new T.Buf16(l.hash_size),l.prev=new T.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new T.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,E(e)}var b,T=e("../utils/common"),w=e("./trees"),_=e("./adler32"),R=e("./crc32"),M=e("./messages"),S=0,A=1,P=3,L=4,C=5,H=0,I=1,k=-2,O=-3,N=-5,F=-1,D=1,z=2,U=3,B=4,G=0,V=2,j=8,W=9,X=15,Y=8,q=286,Q=30,Z=19,K=2*q+1,J=15,$=3,ee=258,te=ee+$+1,re=32,ne=42,ie=69,ae=73,oe=91,se=103,le=113,ce=666,ue=1,he=2,de=3,pe=4,fe=3,me=function(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i};b=[new me(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(d(e),0===e.lookahead&&t===S)return ue;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,s(e,!1),0===e.strm.avail_out))return ue;if(e.strstart-e.block_start>=e.w_size-te&&(s(e,!1),0===e.strm.avail_out))return ue}return e.insert=0,t===L?(s(e,!0),0===e.strm.avail_out?de:pe):(e.strstart>e.block_start&&(s(e,!1),e.strm.avail_out),ue)}),new me(4,4,8,4,p),new me(4,5,16,8,p),new me(4,6,32,32,p),new me(4,4,16,16,f),new me(8,16,32,32,f),new me(8,16,128,128,f),new me(8,32,128,256,f),new me(32,128,258,1024,f),new me(32,258,258,4096,f)],r.deflateInit=function(e,t){return x(e,t,j,X,Y,G)},r.deflateInit2=x,r.deflateReset=E,r.deflateResetKeep=y,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?k:(e.state.gzhead=t,H):k},r.deflate=function(e,t){var r,s,u,h;if(!e||!e.state||t>C||0>t)return e?n(e,k):k;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===ce&&t!==L)return n(e,0===e.avail_out?N:k);if(s.strm=e,r=s.last_flush,s.last_flush=t,s.status===ne)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=z||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=R(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=ie):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=z||s.level<2?4:0),l(s,fe),s.status=le);else{var d=j+(s.w_bits-8<<4)<<8,p=-1;p=s.strategy>=z||s.level<2?0:s.level<6?1:6===s.level?2:3,d|=p<<6,0!==s.strstart&&(d|=re),d+=31-d%31,s.status=le,c(s,d),0!==s.strstart&&(c(s,e.adler>>>16),c(s,65535&e.adler)),e.adler=1}if(s.status===ie)if(s.gzhead.extra){for(u=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),o(e),u=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=ae)}else s.status=ae;if(s.status===ae)if(s.gzhead.name){u=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),o(e),u=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),0===h&&(s.gzindex=0,s.status=oe)}else s.status=oe;if(s.status===oe)if(s.gzhead.comment){u=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),o(e),u=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>u&&(e.adler=R(e.adler,s.pending_buf,s.pending-u,u)),0===h&&(s.status=se)}else s.status=se;if(s.status===se&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&o(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=le)):s.status=le),0!==s.pending){if(o(e),0===e.avail_out)return s.last_flush=-1,H}else if(0===e.avail_in&&i(t)<=i(r)&&t!==L)return n(e,N);if(s.status===ce&&0!==e.avail_in)return n(e,N);if(0!==e.avail_in||0!==s.lookahead||t!==S&&s.status!==ce){var f=s.strategy===z?v(s,t):s.strategy===U?m(s,t):b[s.level].func(s,t);if((f===de||f===pe)&&(s.status=ce),f===ue||f===de)return 0===e.avail_out&&(s.last_flush=-1),H;if(f===he&&(t===A?w._tr_align(s):t!==C&&(w._tr_stored_block(s,0,0,!1),t===P&&(a(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),o(e),0===e.avail_out))return s.last_flush=-1,H}return t!==L?H:s.wrap<=0?I:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(c(s,e.adler>>>16),c(s,65535&e.adler)),o(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?H:I)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==ne&&t!==ie&&t!==ae&&t!==oe&&t!==se&&t!==le&&t!==ce?n(e,k):(e.state=null,t===le?n(e,O):H):k},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],34:[function(e,t){"use strict";t.exports=function(e,t){var r,n,i,a,o,s,l,c,u,h,d,p,f,m,v,g,y,E,x,b,T,w,_,R,M;r=e.state,n=e.next_in,R=e.input,i=n+(e.avail_in-5),a=e.next_out,M=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,c=r.wsize,u=r.whave,h=r.wnext,d=r.window,p=r.hold,f=r.bits,m=r.lencode,v=r.distcode,g=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{15>f&&(p+=R[n++]<<f,f+=8,p+=R[n++]<<f,f+=8),E=m[p&g];t:for(;;){if(p>>>=x=E>>>24,f-=x,0==(x=E>>>16&255))M[a++]=65535&E;else{if(!(16&x)){if(0==(64&x)){E=m[(65535&E)+(p&(1<<x)-1)];continue t}if(32&x){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}b=65535&E,(x&=15)&&(x>f&&(p+=R[n++]<<f,f+=8),b+=p&(1<<x)-1,p>>>=x,f-=x),15>f&&(p+=R[n++]<<f,f+=8,p+=R[n++]<<f,f+=8),E=v[p&y];r:for(;;){if(p>>>=x=E>>>24,f-=x,!(16&(x=E>>>16&255))){if(0==(64&x)){E=v[(65535&E)+(p&(1<<x)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(T=65535&E,(x&=15)>f&&(p+=R[n++]<<f,x>(f+=8)&&(p+=R[n++]<<f,f+=8)),(T+=p&(1<<x)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(p>>>=x,f-=x,T>(x=a-o)){if((x=T-x)>u&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(w=0,_=d,0===h){if(w+=c-x,b>x){b-=x;do{M[a++]=d[w++]}while(--x);w=a-T,_=M}}else if(x>h){if(w+=c+h-x,b>(x-=h)){b-=x;do{M[a++]=d[w++]}while(--x);if(w=0,b>h){b-=x=h;do{M[a++]=d[w++]}while(--x);w=a-T,_=M}}}else if(w+=h-x,b>x){b-=x;do{M[a++]=d[w++]}while(--x);w=a-T,_=M}for(;b>2;)M[a++]=_[w++],M[a++]=_[w++],M[a++]=_[w++],b-=3;b&&(M[a++]=_[w++],b>1&&(M[a++]=_[w++]))}else{w=a-T;do{M[a++]=M[w++],M[a++]=M[w++],M[a++]=M[w++],b-=3}while(b>2);b&&(M[a++]=M[w++],b>1&&(M[a++]=M[w++]))}break}}break}}while(i>n&&s>a);n-=b=f>>3,p&=(1<<(f-=b<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=i>n?i-n+5:5-(n-i),e.avail_out=s>a?s-a+257:257-(a-s),r.hold=p,r.bits=f}},{}],35:[function(e,t,r){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=C,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new d.Buf32(ce),t.distcode=t.distdyn=new d.Buf32(ue),t.sane=1,t.back=-1,w):M}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):M}function s(e,t){var r,n;return e&&e.state?(n=e.state,0>t?(r=0,t=-t):(r=1+(t>>4),48>t&&(t&=15)),t&&(8>t||t>15)?M:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(e))):M}function l(e,t){var r,n;return e?(n=new i,e.state=n,n.window=null,(r=s(e,t))!==w&&(e.state=null),r):M}function c(e){if(de){var t;for(u=new d.Buf32(512),h=new d.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(v(y,e.lens,0,288,u,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;v(E,e.lens,0,32,h,0,e.work,{bits:5}),de=!1}e.lencode=u,e.lenbits=9,e.distcode=h,e.distbits=5}var u,h,d=e("../utils/common"),p=e("./adler32"),f=e("./crc32"),m=e("./inffast"),v=e("./inftrees"),g=0,y=1,E=2,x=4,b=5,T=6,w=0,_=1,R=2,M=-2,S=-3,A=-4,P=-5,L=8,C=1,H=2,I=3,k=4,O=5,N=6,F=7,D=8,z=9,U=10,B=11,G=12,V=13,j=14,W=15,X=16,Y=17,q=18,Q=19,Z=20,K=21,J=22,$=23,ee=24,te=25,re=26,ne=27,ie=28,ae=29,oe=30,se=31,le=32,ce=852,ue=592,he=15,de=!0;r.inflateReset=o,r.inflateReset2=s,r.inflateResetKeep=a,r.inflateInit=function(e){return l(e,he)},r.inflateInit2=l,r.inflate=function(e,t){var r,i,a,o,s,l,u,h,ce,ue,he,de,pe,fe,me,ve,ge,ye,Ee,xe,be,Te,we,_e,Re=0,Me=new d.Buf8(4),Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return M;(r=e.state).mode===G&&(r.mode=V),s=e.next_out,a=e.output,u=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=r.hold,ce=r.bits,ue=l,he=u,Te=w;e:for(;;)switch(r.mode){case C:if(0===r.wrap){r.mode=V;break}for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(2&r.wrap&&35615===h){r.check=0,Me[0]=255&h,Me[1]=h>>>8&255,r.check=f(r.check,Me,2,0),h=0,ce=0,r.mode=H;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",r.mode=oe;break}if((15&h)!==L){e.msg="unknown compression method",r.mode=oe;break}if(ce-=4,be=8+(15&(h>>>=4)),0===r.wbits)r.wbits=be;else if(be>r.wbits){e.msg="invalid window size",r.mode=oe;break}r.dmax=1<<be,e.adler=r.check=1,r.mode=512&h?U:G,h=0,ce=0;break;case H:for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(r.flags=h,(255&r.flags)!==L){e.msg="unknown compression method",r.mode=oe;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=oe;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,r.check=f(r.check,Me,2,0)),h=0,ce=0,r.mode=I;case I:for(;32>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.head&&(r.head.time=h),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,Me[2]=h>>>16&255,Me[3]=h>>>24&255,r.check=f(r.check,Me,4,0)),h=0,ce=0,r.mode=k;case k:for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,r.check=f(r.check,Me,2,0)),h=0,ce=0,r.mode=O;case O:if(1024&r.flags){for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&(Me[0]=255&h,Me[1]=h>>>8&255,r.check=f(r.check,Me,2,0)),h=0,ce=0}else r.head&&(r.head.extra=null);r.mode=N;case N:if(1024&r.flags&&((de=r.length)>l&&(de=l),de&&(r.head&&(be=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),d.arraySet(r.head.extra,i,o,de,be)),512&r.flags&&(r.check=f(r.check,i,de,o)),l-=de,o+=de,r.length-=de),r.length))break e;r.length=0,r.mode=F;case F:if(2048&r.flags){if(0===l)break e;de=0;do{be=i[o+de++],r.head&&be&&r.length<65536&&(r.head.name+=String.fromCharCode(be))}while(be&&l>de);if(512&r.flags&&(r.check=f(r.check,i,de,o)),l-=de,o+=de,be)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=D;case D:if(4096&r.flags){if(0===l)break e;de=0;do{be=i[o+de++],r.head&&be&&r.length<65536&&(r.head.comment+=String.fromCharCode(be))}while(be&&l>de);if(512&r.flags&&(r.check=f(r.check,i,de,o)),l-=de,o+=de,be)break e}else r.head&&(r.head.comment=null);r.mode=z;case z:if(512&r.flags){for(;16>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(h!==(65535&r.check)){e.msg="header crc mismatch",r.mode=oe;break}h=0,ce=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=G;break;case U:for(;32>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}e.adler=r.check=n(h),h=0,ce=0,r.mode=B;case B:if(0===r.havedict)return e.next_out=s,e.avail_out=u,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ce,R;e.adler=r.check=1,r.mode=G;case G:if(t===b||t===T)break e;case V:if(r.last){h>>>=7&ce,ce-=7&ce,r.mode=ne;break}for(;3>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}switch(r.last=1&h,ce-=1,3&(h>>>=1)){case 0:r.mode=j;break;case 1:if(c(r),r.mode=Z,t===T){h>>>=2,ce-=2;break e}break;case 2:r.mode=Y;break;case 3:e.msg="invalid block type",r.mode=oe}h>>>=2,ce-=2;break;case j:for(h>>>=7&ce,ce-=7&ce;32>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",r.mode=oe;break}if(r.length=65535&h,h=0,ce=0,r.mode=W,t===T)break e;case W:r.mode=X;case X:if(de=r.length){if(de>l&&(de=l),de>u&&(de=u),0===de)break e;d.arraySet(a,i,o,de,s),l-=de,o+=de,u-=de,s+=de,r.length-=de;break}r.mode=G;break;case Y:for(;14>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(r.nlen=257+(31&h),h>>>=5,ce-=5,r.ndist=1+(31&h),h>>>=5,ce-=5,r.ncode=4+(15&h),h>>>=4,ce-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=oe;break}r.have=0,r.mode=q;case q:for(;r.have<r.ncode;){for(;3>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.lens[Se[r.have++]]=7&h,h>>>=3,ce-=3}for(;r.have<19;)r.lens[Se[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,we={bits:r.lenbits},Te=v(g,r.lens,0,19,r.lencode,0,r.work,we),r.lenbits=we.bits,Te){e.msg="invalid code lengths set",r.mode=oe;break}r.have=0,r.mode=Q;case Q:for(;r.have<r.nlen+r.ndist;){for(;Re=r.lencode[h&(1<<r.lenbits)-1],ve=Re>>>16&255,ge=65535&Re,!(ce>=(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(16>ge)h>>>=me,ce-=me,r.lens[r.have++]=ge;else{if(16===ge){for(_e=me+2;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(h>>>=me,ce-=me,0===r.have){e.msg="invalid bit length repeat",r.mode=oe;break}be=r.lens[r.have-1],de=3+(3&h),h>>>=2,ce-=2}else if(17===ge){for(_e=me+3;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}ce-=me,be=0,de=3+(7&(h>>>=me)),h>>>=3,ce-=3}else{for(_e=me+7;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}ce-=me,be=0,de=11+(127&(h>>>=me)),h>>>=7,ce-=7}if(r.have+de>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=oe;break}for(;de--;)r.lens[r.have++]=be}}if(r.mode===oe)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=oe;break}if(r.lenbits=9,we={bits:r.lenbits},Te=v(y,r.lens,0,r.nlen,r.lencode,0,r.work,we),r.lenbits=we.bits,Te){e.msg="invalid literal/lengths set",r.mode=oe;break}if(r.distbits=6,r.distcode=r.distdyn,we={bits:r.distbits},Te=v(E,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,we),r.distbits=we.bits,Te){e.msg="invalid distances set",r.mode=oe;break}if(r.mode=Z,t===T)break e;case Z:r.mode=K;case K:if(l>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ce,m(e,he),s=e.next_out,a=e.output,u=e.avail_out,o=e.next_in,i=e.input,l=e.avail_in,h=r.hold,ce=r.bits,r.mode===G&&(r.back=-1);break}for(r.back=0;Re=r.lencode[h&(1<<r.lenbits)-1],ve=Re>>>16&255,ge=65535&Re,!(ce>=(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(ve&&0==(240&ve)){for(ye=me,Ee=ve,xe=ge;Re=r.lencode[xe+((h&(1<<ye+Ee)-1)>>ye)],ve=Re>>>16&255,ge=65535&Re,!(ce>=ye+(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}h>>>=ye,ce-=ye,r.back+=ye}if(h>>>=me,ce-=me,r.back+=me,r.length=ge,0===ve){r.mode=re;break}if(32&ve){r.back=-1,r.mode=G;break}if(64&ve){e.msg="invalid literal/length code",r.mode=oe;break}r.extra=15&ve,r.mode=J;case J:if(r.extra){for(_e=r.extra;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,ce-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=$;case $:for(;Re=r.distcode[h&(1<<r.distbits)-1],ve=Re>>>16&255,ge=65535&Re,!(ce>=(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(0==(240&ve)){for(ye=me,Ee=ve,xe=ge;Re=r.distcode[xe+((h&(1<<ye+Ee)-1)>>ye)],ve=Re>>>16&255,ge=65535&Re,!(ce>=ye+(me=Re>>>24));){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}h>>>=ye,ce-=ye,r.back+=ye}if(h>>>=me,ce-=me,r.back+=me,64&ve){e.msg="invalid distance code",r.mode=oe;break}r.offset=ge,r.extra=15&ve,r.mode=ee;case ee:if(r.extra){for(_e=r.extra;_e>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,ce-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=oe;break}r.mode=te;case te:if(0===u)break e;if(de=he-u,r.offset>de){if((de=r.offset-de)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=oe;break}de>r.wnext?(de-=r.wnext,pe=r.wsize-de):pe=r.wnext-de,de>r.length&&(de=r.length),fe=r.window}else fe=a,pe=s-r.offset,de=r.length;de>u&&(de=u),u-=de,r.length-=de;do{a[s++]=fe[pe++]}while(--de);0===r.length&&(r.mode=K);break;case re:if(0===u)break e;a[s++]=r.length,u--,r.mode=K;break;case ne:if(r.wrap){for(;32>ce;){if(0===l)break e;l--,h|=i[o++]<<ce,ce+=8}if(he-=u,e.total_out+=he,r.total+=he,he&&(e.adler=r.check=r.flags?f(r.check,a,he,s-he):p(r.check,a,he,s-he)),he=u,(r.flags?h:n(h))!==r.check){e.msg="incorrect data check",r.mode=oe;break}h=0,ce=0}r.mode=ie;case ie:if(r.wrap&&r.flags){for(;32>ce;){if(0===l)break e;l--,h+=i[o++]<<ce,ce+=8}if(h!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=oe;break}h=0,ce=0}r.mode=ae;case ae:Te=_;break e;case oe:Te=S;break e;case se:return A;case le:default:return M}return e.next_out=s,e.avail_out=u,e.next_in=o,e.avail_in=l,r.hold=h,r.bits=ce,(r.wsize||he!==e.avail_out&&r.mode<oe&&(r.mode<ne||t!==x))&&function(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new d.Buf8(a.wsize)),n>=a.wsize?(d.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),d.arraySet(a.window,t,r-n,i,a.wnext),(n-=i)?(d.arraySet(a.window,t,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}(e,e.output,e.next_out,he-e.avail_out)?(r.mode=se,A):(ue-=e.avail_in,he-=e.avail_out,e.total_in+=ue,e.total_out+=he,r.total+=he,r.wrap&&he&&(e.adler=r.check=r.flags?f(r.check,a,he,e.next_out-he):p(r.check,a,he,e.next_out-he)),e.data_type=r.bits+(r.last?64:0)+(r.mode===G?128:0)+(r.mode===Z||r.mode===W?256:0),(0===ue&&0===he||t===x)&&Te===w&&(Te=P),Te)},r.inflateEnd=function(e){if(!e||!e.state)return M;var t=e.state;return t.window&&(t.window=null),e.state=null,w},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?M:(r.head=t,t.done=!1,w):M},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t){"use strict";var r=e("../utils/common"),n=15,i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,l,c,u,h,d,p){var f,m,v,g,y,E,x,b,T,w=p.bits,_=0,R=0,M=0,S=0,A=0,P=0,L=0,C=0,H=0,I=0,k=null,O=0,N=new r.Buf16(16),F=new r.Buf16(16),D=null,z=0;for(_=0;n>=_;_++)N[_]=0;for(R=0;c>R;R++)N[t[l+R]]++;for(A=w,S=n;S>=1&&0===N[S];S--);if(A>S&&(A=S),0===S)return u[h++]=20971520,u[h++]=20971520,p.bits=1,0;for(M=1;S>M&&0===N[M];M++);for(M>A&&(A=M),C=1,_=1;n>=_;_++)if(C<<=1,0>(C-=N[_]))return-1;if(C>0&&(0===e||1!==S))return-1;for(F[1]=0,_=1;n>_;_++)F[_+1]=F[_]+N[_];for(R=0;c>R;R++)0!==t[l+R]&&(d[F[t[l+R]]++]=R);if(0===e?(k=D=d,E=19):1===e?(k=i,O-=257,D=a,z-=257,E=256):(k=o,D=s,E=-1),I=0,R=0,_=M,y=h,P=A,L=0,v=-1,g=(H=1<<A)-1,1===e&&H>852||2===e&&H>592)return 1;for(;;){x=_-L,d[R]<E?(b=0,T=d[R]):d[R]>E?(b=D[z+d[R]],T=k[O+d[R]]):(b=96,T=0),f=1<<_-L,M=m=1<<P;do{u[y+(I>>L)+(m-=f)]=x<<24|b<<16|T|0}while(0!==m);for(f=1<<_-1;I&f;)f>>=1;if(0!==f?(I&=f-1,I+=f):I=0,R++,0==--N[_]){if(_===S)break;_=t[l+d[R]]}if(_>A&&(I&g)!==v){for(0===L&&(L=A),y+=M,C=1<<(P=_-L);S>P+L&&!(0>=(C-=N[P+L]));)P++,C<<=1;if(H+=1<<P,1===e&&H>852||2===e&&H>592)return 1;u[v=I&g]=A<<24|P<<16|y-h|0}}return 0!==I&&(u[y+I]=_-L<<24|64<<16|0),p.bits=A,0}},{"../utils/common":27}],37:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,r){"use strict";function n(e){for(var t=e.length;--t>=0;)e[t]=0}function i(e){return 256>e?X[e]:X[256+(e>>>7)]}function a(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function o(e,t,r){e.bi_valid>k-r?(e.bi_buf|=t<<e.bi_valid&65535,a(e,e.bi_buf),e.bi_buf=t>>k-e.bi_valid,e.bi_valid+=r-k):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function s(e,t,r){o(e,r[2*t],r[2*t+1])}function l(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function c(e,t,r){var n,i,a=new Array(I+1),o=0;for(n=1;I>=n;n++)a[n]=o=o+r[n-1]<<1;for(i=0;t>=i;i++){var s=e[2*i+1];0!==s&&(e[2*i]=l(a[s]++,s))}}function u(e){var t;for(t=0;P>t;t++)e.dyn_ltree[2*t]=0;for(t=0;L>t;t++)e.dyn_dtree[2*t]=0;for(t=0;C>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*N]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function h(e){e.bi_valid>8?a(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function d(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function p(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&d(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!d(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function f(e,t,r){var n,a,l,c,u=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],a=e.pending_buf[e.l_buf+u],u++,0===n?s(e,a,t):(l=Y[a],s(e,l+A+1,t),0!==(c=U[l])&&(a-=q[l],o(e,a,c)),l=i(--n),s(e,l,r),0!==(c=B[l])&&(n-=Q[l],o(e,n,c)))}while(u<e.last_lit);s(e,N,t)}function m(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=H,r=0;l>r;r++)0!==a[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=2>u?++u:0,a[2*i]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)p(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],p(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,p(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0;for(a=0;I>=a;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;H>r;r++)n=e.heap[r],(a=l[2*l[2*n+1]+1]+1)>f&&(a=f,m++),l[2*n+1]=a,n>c||(e.bl_count[a]++,o=0,n>=p&&(o=d[n-p]),s=l[2*n],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(u[2*n+1]+o)));if(0!==m){do{for(a=f-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(a=f;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>c||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),c(a,u,e.bl_count)}function v(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(r+1)+1]=65535,n=0;r>=n;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(c>s?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*F]++):10>=s?e.bl_tree[2*D]++:e.bl_tree[2*z]++,s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4))}function g(e,t,r){var n,i,a=-1,l=t[1],c=0,u=7,h=4;for(0===l&&(u=138,h=3),n=0;r>=n;n++)if(i=l,l=t[2*(n+1)+1],!(++c<u&&i===l)){if(h>c)do{s(e,i,e.bl_tree)}while(0!=--c);else 0!==i?(i!==a&&(s(e,i,e.bl_tree),c--),s(e,F,e.bl_tree),o(e,c-3,2)):10>=c?(s(e,D,e.bl_tree),o(e,c-3,3)):(s(e,z,e.bl_tree),o(e,c-11,7));c=0,a=i,0===l?(u=138,h=3):i===l?(u=6,h=3):(u=7,h=4)}}function y(e,t,r,n){o(e,(_<<1)+(n?1:0),3),function(e,t,r,n){h(e),n&&(a(e,r),a(e,~r)),E.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}var E=e("../utils/common"),x=4,b=0,T=1,w=2,_=0,R=1,M=2,S=29,A=256,P=A+1+S,L=30,C=19,H=2*P+1,I=15,k=16,O=7,N=256,F=16,D=17,z=18,U=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],G=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=new Array(2*(P+2));n(j);var W=new Array(2*L);n(W);var X=new Array(512);n(X);var Y=new Array(256);n(Y);var q=new Array(S);n(q);var Q=new Array(L);n(Q);var Z,K,J,$=function(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length},ee=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},te=!1;r._tr_init=function(e){te||(function(){var e,t,r,n,i,a=new Array(I+1);for(r=0,n=0;S-1>n;n++)for(q[n]=r,e=0;e<1<<U[n];e++)Y[r++]=n;for(Y[r-1]=n,i=0,n=0;16>n;n++)for(Q[n]=i,e=0;e<1<<B[n];e++)X[i++]=n;for(i>>=7;L>n;n++)for(Q[n]=i<<7,e=0;e<1<<B[n]-7;e++)X[256+i++]=n;for(t=0;I>=t;t++)a[t]=0;for(e=0;143>=e;)j[2*e+1]=8,e++,a[8]++;for(;255>=e;)j[2*e+1]=9,e++,a[9]++;for(;279>=e;)j[2*e+1]=7,e++,a[7]++;for(;287>=e;)j[2*e+1]=8,e++,a[8]++;for(c(j,P+1,a),e=0;L>e;e++)W[2*e+1]=5,W[2*e]=l(e,5);Z=new $(j,U,A+1,P,I),K=new $(W,B,0,L,I),J=new $(new Array(0),G,0,C,O)}(),te=!0),e.l_desc=new ee(e.dyn_ltree,Z),e.d_desc=new ee(e.dyn_dtree,K),e.bl_desc=new ee(e.bl_tree,J),e.bi_buf=0,e.bi_valid=0,u(e)},r._tr_stored_block=y,r._tr_flush_block=function(e,t,r,n){var i,a,s=0;e.level>0?(e.strm.data_type===w&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;31>=t;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return b;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return T;for(t=32;A>t;t++)if(0!==e.dyn_ltree[2*t])return T;return b}(e)),m(e,e.l_desc),m(e,e.d_desc),s=function(e){var t;for(v(e,e.dyn_ltree,e.l_desc.max_code),v(e,e.dyn_dtree,e.d_desc.max_code),m(e,e.bl_desc),t=C-1;t>=3&&0===e.bl_tree[2*V[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,i>=a&&(i=a)):i=a=r+5,i>=r+4&&-1!==t?y(e,t,r,n):e.strategy===x||a===i?(o(e,(R<<1)+(n?1:0),3),f(e,j,W)):(o(e,(M<<1)+(n?1:0),3),function(e,t,r,n){var i;for(o(e,t-257,5),o(e,r-1,5),o(e,n-4,4),i=0;n>i;i++)o(e,e.bl_tree[2*V[i]+1],3);g(e,e.dyn_ltree,t-1),g(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),f(e,e.dyn_ltree,e.dyn_dtree)),u(e),n&&h(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Y[r]+A+1)]++,e.dyn_dtree[2*i(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){o(e,R<<1,3),s(e,N,j),function(e){16===e.bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":27}],39:[function(e,t){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[9])(9)}).call(this,r(40).Buffer)},function(e,t,r){var n,i,a;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r,s){"object"===o(t)&&void 0!==e?s(t):(i=[t],void 0===(a="function"==typeof(n=s)?n.apply(t,i):n)||(e.exports=a))}(0,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(e,t,r){return M(R(e,r),t)}function d(e,t,r,n){var i,a=0;return t<r?(i=t,a=0):(i=r,a=1),n<i&&(a=2),Ee[e][a]}function p(e){var t,r,n=e.children,i=0;if(null!==n)for(t=0,r=n.length;t<r;++t)i+=p(n[t]);else null!==e.points&&(i=e.points.length);return i}function f(e,t,r,n,i){var a,o,s=n.children,l=!1,c=!1;if(n.contains(e,r.bias)){if(null===s){if(null===n.points)n.points=[],n.data=[];else for(a=0,o=n.points.length;!l&&a<o;++a)l=n.points[a].equals(e);l?(n.data[a-1]=t,c=!0):n.points.length<r.maxPoints||i===r.maxDepth?(n.points.push(e.clone()),n.data.push(t),++r.pointCount,c=!0):(n.split(),n.redistribute(r.bias),s=n.children)}if(null!==s)for(++i,a=0,o=s.length;!c&&a<o;++a)c=f(e,t,r,s[a],i)}return c}function m(e,t,r,n){var i,a,o,s,l,c=r.children,u=null;if(r.contains(e,t.bias))if(null!==c)for(i=0,a=c.length;null===u&&i<a;++i)u=m(e,t,c[i],r);else if(null!==r.points)for(o=r.points,s=r.data,i=0,a=o.length;i<a;++i)if(o[i].equals(e)){l=a-1,u=s[i],i<l&&(o[i]=o[l],s[i]=s[l]),o.pop(),s.pop(),--t.pointCount,null!==n&&p(n)<=t.maxPoints&&n.merge();break}return u}function v(e,t,r,n){var i,a,o,s,l,c,u,h=n.points,d=n.children,p=null,f=t;if(null!==d)for(i=0,a=(l=d.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(e,t){return e.distance-t.distance})).length;i<a;++i)(c=l[i].octant).contains(e,f)&&(null!==(u=v(e,f,r,c))&&(s=u.point.distanceToSquared(e),(!r||0<s)&&s<f&&(f=s,p=u)));else if(null!==h)for(i=0,a=h.length;i<a;++i)o=h[i],s=e.distanceToSquared(o),(!r||0<s)&&s<f&&(f=s,p={point:o.clone(),data:n.data[i]});return p}function g(e,t,r,n,i){var a,o,s,l,c,u=n.points,h=n.children;if(null!==h)for(a=0,o=h.length;a<o;++a)(c=h[a]).contains(e,t)&&g(e,t,r,c,i);else if(null!==u)for(a=0,o=u.length;a<o;++a)s=u[a],l=e.distanceToSquared(s),(!r||0<l)&&l<=t*t&&i.push({point:s.clone(),data:n.data[a]})}var y=Math.PI,E=Math.atan2,x=Math.round,b=Math.ceil,T=Math.floor,w=Math.abs,_=Math.acos,R=Math.min,M=Math.max,S=Math.sqrt,A=Math.cos,P=Math.sin,L=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=r,this.y=n,this.z=i}return n(e,[{key:"set",value:function(e,t,r){return this.x=e,this.y=t,this.z=r,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"setFromSpherical",value:function(e){this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,r){var n=P(t)*e;return this.x=n*P(r),this.y=A(t)*e,this.z=n*A(r),this}},{key:"setFromCylindrical",value:function(e){this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,r){return this.x=e*P(t),this.y=r,this.z=e*A(t),this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this}},{key:"crossVectors",value:function(e,t){var r=e.x,n=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"transformDirection",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n,this.y=i[1]*t+i[5]*r+i[9]*n,this.z=i[2]*t+i[6]*r+i[10]*n,this.normalize()}},{key:"applyMatrix3",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*n,this.y=i[1]*t+i[4]*r+i[7]*n,this.z=i[2]*t+i[5]*r+i[8]*n,this}},{key:"applyMatrix4",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this}},{key:"applyQuaternion",value:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*n-o*r,c=s*r+o*t-i*n,u=s*n+i*r-a*t,h=-i*t-a*r-o*n;return this.x=l*s+h*-i+c*-o-u*-a,this.y=c*s+h*-a+u*-i-l*-o,this.z=u*s+h*-o+l*-a-c*-i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"reflect",value:function(e){var t=e.x,r=e.y,n=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(t,r,n),this}},{key:"angleTo",value:function(e){var t=this.dot(e)/S(this.lengthSquared()*e.lengthSquared());return _(R(M(t,-1),1))}},{key:"manhattanLength",value:function(){return w(this.x)+w(this.y)+w(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return S(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(e){return w(this.x-e.x)+w(this.y-e.y)+w(this.z-e.z)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}},{key:"distanceTo",value:function(e){return S(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=R(this.x,e.x),this.y=R(this.y,e.y),this.z=R(this.z,e.z),this}},{key:"max",value:function(e){return this.x=M(this.x,e.x),this.y=M(this.y,e.y),this.z=M(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=M(e.x,R(t.x,this.x)),this.y=M(e.y,R(t.y,this.y)),this.z=M(e.z,R(t.z,this.z)),this}},{key:"floor",value:function(){return this.x=T(this.x),this.y=T(this.y),this.z=T(this.z),this}},{key:"ceil",value:function(){return this.x=b(this.x),this.y=b(this.y),this.z=b(this.z),this}},{key:"round",value:function(){return this.x=x(this.x),this.y=x(this.y),this.z=x(this.z),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}]),e}(),C=new L,H=[new L,new L,new L,new L,new L,new L,new L,new L],I=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L(1/0,1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L(-1/0,-1/0,-1/0);t(this,e),this.min=r,this.max=n}return n(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"setFromSphere",value:function(e){return this.set(e.center,e.center),this.expandByScalar(e.radius),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,r;for(this.min.set(0,0,0),this.max.set(0,0,0),t=0,r=e.length;t<r;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var r=C.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return C.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"applyMatrix4",value:function(e){var t=this.min,r=this.max;return this.isEmpty()||(H[0].set(t.x,t.y,t.z).applyMatrix4(e),H[1].set(t.x,t.y,r.z).applyMatrix4(e),H[2].set(t.x,r.y,t.z).applyMatrix4(e),H[3].set(t.x,r.y,r.z).applyMatrix4(e),H[4].set(r.x,t.y,t.z).applyMatrix4(e),H[5].set(r.x,t.y,r.z).applyMatrix4(e),H[6].set(r.x,r.y,t.z).applyMatrix4(e),H[7].set(r.x,r.y,r.z).applyMatrix4(e),this.setFromPoints(H)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,r=this.max;return e.x>=t.x&&e.y>=t.y&&e.z>=t.z&&e.x<=r.x&&e.y<=r.y&&e.z<=r.z}},{key:"containsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=r.x&&t.y<=n.y&&i.y<=r.y&&t.z<=n.z&&i.z<=r.z}},{key:"intersectsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&i.z>=t.z&&n.x<=r.x&&n.y<=r.y&&n.z<=r.z}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,C).distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,r;return 0<e.normal.x?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),k=new I,O=new L,N=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.center=r,this.radius=n}return n(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(e){var t,r,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:k.setFromPoints(e).getCenter(this.center),i=0;for(t=0,r=e.length;t<r;++t)i=M(i,n.distanceToSquared(e[t]));return this.radius=S(i),this}},{key:"setFromBox",value:function(e){return e.getCenter(this.center),this.radius=.5*e.getSize(O).length(),this}},{key:"isEmpty",value:function(){return 0>=this.radius}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L,r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return w(e.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),F=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.x=r,this.y=n}return n(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this}},{key:"applyMatrix3",value:function(e){var t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"manhattanLength",value:function(){return w(this.x)+w(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return S(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(e){return w(this.x-e.x)+w(this.y-e.y)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r}},{key:"distanceTo",value:function(e){return S(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=R(this.x,e.x),this.y=R(this.y,e.y),this}},{key:"max",value:function(e){return this.x=M(this.x,e.x),this.y=M(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=M(e.x,R(t.x,this.x)),this.y=M(e.y,R(t.y,this.y)),this}},{key:"floor",value:function(){return this.x=T(this.x),this.y=T(this.y),this}},{key:"ceil",value:function(){return this.x=b(this.x),this.y=b(this.y),this}},{key:"round",value:function(){return this.x=x(this.x),this.y=x(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var e=E(this.y,this.x);return 0>e&&(e+=2*y),e}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"rotateAround",value:function(e,t){var r=A(t),n=P(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*n+e.x,this.y=i*n+a*r+e.y,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"width",get:function(){return this.x},set:function(e){return this.x=e}},{key:"height",get:function(){return this.y},set:function(e){return this.y=e}}]),e}(),D=new F,z=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new F(1/0,1/0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new F(-1/0,-1/0);t(this,e),this.min=r,this.max=n}n(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new F;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new F;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N;return this.getCenter(e.center),e.radius=.5*this.getSize(D).length(),e}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"setFromPoints",value:function(e){var t,r;for(this.min.set(0,0),this.max.set(0,0),t=0,r=e.length;t<r;++t)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var r=D.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}},{key:"clampPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new F;return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return D.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"containsPoint",value:function(e){var t=this.min,r=this.max;return e.x>=t.x&&e.y>=t.y&&e.x<=r.x&&e.y<=r.y}},{key:"containsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return t.x<=n.x&&i.x<=r.x&&t.y<=n.y&&i.y<=r.y}},{key:"intersectsBox",value:function(e){var t=this.min,r=this.max,n=e.min,i=e.max;return i.x>=t.x&&i.y>=t.y&&n.x<=r.x&&n.y<=r.y}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}])}(),function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=r,this.theta=n,this.y=i}n(e,[{key:"set",value:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,r){return this.radius=S(e*e+r*r),this.theta=E(e,r),this.y=t,this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return n(e,[{key:"set",value:function(e,t,r,n,i,a,o,s,l){var c=this.elements;return c[0]=e,c[3]=t,c[6]=r,c[1]=n,c[4]=i,c[7]=a,c[2]=o,c[5]=s,c[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,r=this.elements;return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;9>t;++t)n[t]=e[t+r];return this}},{key:"toArray",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;9>e;++e)t[e+r]=n[e];return t}},{key:"multiplyMatrices",value:function(e,t){var r=e.elements,n=t.elements,i=this.elements,a=r[0],o=r[3],s=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],p=r[8],f=n[0],m=n[3],v=n[6],g=n[1],y=n[4],E=n[7],x=n[2],b=n[5],T=n[8];return i[0]=a*f+o*g+s*x,i[3]=a*m+o*y+s*b,i[6]=a*v+o*E+s*T,i[1]=l*f+c*g+u*x,i[4]=l*m+c*y+u*b,i[7]=l*v+c*E+u*T,i[2]=h*f+d*g+p*x,i[5]=h*m+d*y+p*b,i[8]=h*v+d*E+p*T,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-r*i*c+r*o*s+n*i*l-n*a*s}},{key:"getInverse",value:function(e){var t,r=e.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=d*l-c*h,f=c*u-d*s,m=h*s-l*u,v=i*p+a*f+o*m;return 0==v?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(t=1/v,n[0]=p*t,n[1]=(o*h-d*a)*t,n[2]=(c*a-o*l)*t,n[3]=f*t,n[4]=(d*i-o*u)*t,n[5]=(o*s-c*i)*t,n[6]=m*t,n[7]=(a*u-h*i)*t,n[8]=(l*i-a*s)*t),this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"scale",value:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}},{key:"rotate",value:function(e){var t=A(e),r=P(e),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],l=n[4],c=n[7];return n[0]=t*i+r*s,n[3]=t*a+r*l,n[6]=t*o+r*c,n[1]=-r*i+t*s,n[4]=-r*a+t*l,n[7]=-r*o+t*c,this}},{key:"translate",value:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}},{key:"equals",value:function(e){var t,r=this.elements,n=e.elements,i=!0;for(t=0;i&&9>t;++t)r[t]!==n[t]&&(i=!1);return i}}]),e}()),U="XYZ",B="YZX",G="ZXY",V="XZY",j="YXZ",W="ZYX",X=new L,Y=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=r,this.y=n,this.z=i,this.w=a}var r=Number.EPSILON;return n(e,[{key:"set",value:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setFromEuler",value:function(e){var t=e.x,r=e.y,n=e.z,i=A,a=P,o=i(t/2),s=i(r/2),l=i(n/2),c=a(t/2),u=a(r/2),h=a(n/2);switch(e.order){case U:this.x=c*s*l+o*u*h,this.y=o*u*l-c*s*h,this.z=o*s*h+c*u*l,this.w=o*s*l-c*u*h;break;case j:this.x=c*s*l+o*u*h,this.y=o*u*l-c*s*h,this.z=o*s*h-c*u*l,this.w=o*s*l+c*u*h;break;case G:this.x=c*s*l-o*u*h,this.y=o*u*l+c*s*h,this.z=o*s*h+c*u*l,this.w=o*s*l-c*u*h;break;case W:this.x=c*s*l-o*u*h,this.y=o*u*l+c*s*h,this.z=o*s*h-c*u*l,this.w=o*s*l+c*u*h;break;case B:this.x=c*s*l+o*u*h,this.y=o*u*l+c*s*h,this.z=o*s*h-c*u*l,this.w=o*s*l-c*u*h;break;case V:this.x=c*s*l-o*u*h,this.y=o*u*l-c*s*h,this.z=o*s*h+c*u*l,this.w=o*s*l+c*u*h}return this}},{key:"setFromAxisAngle",value:function(e,t){var r=t/2,n=P(r);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=A(r),this}},{key:"setFromRotationMatrix",value:function(e){var t,r=e.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],d=n+s+h;return 0<d?(t=.5/S(d+1),this.w=.25/t,this.x=(u-l)*t,this.y=(a-c)*t,this.z=(o-i)*t):n>s&&n>h?(t=2*S(1+n-s-h),this.w=(u-l)/t,this.x=.25*t,this.y=(i+o)/t,this.z=(a+c)/t):s>h?(t=2*S(1+s-n-h),this.w=(a-c)/t,this.x=(i+o)/t,this.y=.25*t,this.z=(l+u)/t):(t=2*S(1+h-n-s),this.w=(o-i)/t,this.x=(a+c)/t,this.y=(l+u)/t,this.z=.25*t),this}},{key:"setFromUnitVectors",value:function(e,t){var r=e.dot(t)+1;return 1e-6>r?(r=0,w(e.x)>w(e.z)?X.set(-e.y,e.x,0):X.set(0,-e.z,e.y)):X.crossVectors(e,t),this.x=X.x,this.y=X.y,this.z=X.z,this.w=r,this.normalize()}},{key:"angleTo",value:function(e){return 2*_(w(R(M(this.dot(e),-1),1)))}},{key:"rotateTowards",value:function(e,t){var r=this.angleTo(e);return 0!==r&&this.slerp(e,R(1,t/r)),this}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return S(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var e,t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"multiplyQuaternions",value:function(e,t){var r=e.x,n=e.y,i=e.z,a=e.w,o=t.x,s=t.y,l=t.z,c=t.w;return this.x=r*c+a*o+n*l-i*s,this.y=n*c+a*s+i*o-r*l,this.z=i*c+a*l+r*s-n*o,this.w=a*c-r*o-n*s-i*l,this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"slerp",value:function(e,t){var n,i,a,o,s,l,c,u=this.x,h=this.y,d=this.z,p=this.w;return 1===t?this.copy(e):0<t&&(0>(n=p*e.w+u*e.x+h*e.y+d*e.z)?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,n=-n):this.copy(e),1<=n?(this.w=p,this.x=u,this.y=h,this.z=d):(s=1-t,(i=1-n*n)<=r?(this.w=s*p+t*this.w,this.x=s*u+t*this.x,this.y=s*h+t*this.y,this.z=s*d+t*this.z,this.normalize()):(a=S(i),o=E(a,n),l=P(s*o)/a,c=P(t*o)/a,this.w=p*l+this.w*c,this.x=u*l+this.x*c,this.y=h*l+this.y*c,this.z=d*l+this.z*c))),this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}],[{key:"slerp",value:function(e,t,r,n){return r.copy(e).slerp(t,n)}},{key:"slerpFlat",value:function(e,t,n,i,a,o,s){var l,c,u,h,d,p,f,m,v=a[o],g=a[o+1],y=a[o+2],x=a[o+3],b=n[i],T=n[i+1],w=n[i+2],_=n[i+3];(_!==x||b!==v||T!==g||w!==y)&&(l=1-s,p=0<=(h=b*v+T*g+w*y+_*x)?1:-1,(d=1-h*h)>r&&(u=S(d),f=E(u,h*p),l=P(l*f)/u,s=P(s*f)/u),b=b*l+v*(m=s*p),T=T*l+g*m,w=w*l+y*m,_=_*l+x*m,l===1-s&&(b*=c=1/S(b*b+T*T+w*w+_*_),T*=c,w*=c,_*=c)),e[t]=b,e[t+1]=T,e[t+2]=w,e[t+3]=_}}]),e}(),q=new z,Q=new Y,Z=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=r,this.y=n,this.z=i,this.order=e.defaultOrder}n(e,[{key:"set",value:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.order=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.order=e.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}},{key:"toVector3",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L;return e.set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(e){var t=Math.asin,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,n=e.elements,i=n[0],a=n[4],o=n[8],s=n[1],l=n[5],c=n[9],u=n[2],d=n[6],p=n[10],f=.99999;switch(r){case U:this.y=t(h(o,-1,1)),w(o)<f?(this.x=E(-c,p),this.z=E(-a,i)):(this.x=E(d,l),this.z=0);break;case j:this.x=t(-h(c,-1,1)),w(c)<f?(this.y=E(o,p),this.z=E(s,l)):(this.y=E(-u,i),this.z=0);break;case G:this.x=t(h(d,-1,1)),w(d)<f?(this.y=E(-u,p),this.z=E(-a,l)):(this.y=0,this.z=E(s,i));break;case W:this.y=t(-h(u,-1,1)),w(u)<f?(this.x=E(d,p),this.z=E(s,i)):(this.x=0,this.z=E(-a,l));break;case B:this.z=t(h(s,-1,1)),w(s)<f?(this.x=E(-c,l),this.y=E(-u,i)):(this.x=0,this.y=E(o,p));break;case V:this.z=t(-h(a,-1,1)),w(a)<f?(this.x=E(d,l),this.y=E(o,i)):(this.x=E(-c,p),this.y=0)}return this.order=r,this}},{key:"setFromQuaternion",value:function(e,t){return q.makeRotationFromQuaternion(e),this.setFromRotationMatrix(q,t)}},{key:"setFromVector3",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return Q.setFromEuler(this),this.setFromQuaternion(Q,e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.order===this.order}}],[{key:"defaultOrder",get:function(){return U}}])}(),new L),K=new L,J=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L(1,0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.normal=r,this.constant=n}return n(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,r,n){return this.normal.set(e,t,r),this.constant=n,this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,r){var n=Z.subVectors(r,t).cross(K.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,Z),this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"intersectLine",value:function(e,t){var r=e.delta(Z),n=this.normal.dot(r);if(0===n)0===this.distanceToPoint(e.start)&&t.copy(e.start);else{var i=-(e.start.dot(this.normal)+this.constant)/n;0<=i&&1>=i&&t.copy(r).multiplyScalar(i).add(e.start)}return t}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&0<r||0>r&&0<t}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),$=new L,ee=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new J,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new J,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new J,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new J,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new J,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new J;t(this,e),this.planes=[r,n,i,a,o,s]}n(e,[{key:"set",value:function(e,t,r,n,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){var t,r=this.planes;for(t=0;6>t;++t)r[t].copy(e.planes[t]);return this}},{key:"setFromMatrix",value:function(e){var t=this.planes,r=e.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],d=r[9],p=r[10],f=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return t[0].setComponents(o-n,u-s,f-h,y-m).normalize(),t[1].setComponents(o+n,u+s,f+h,y+m).normalize(),t[2].setComponents(o+i,u+l,f+d,y+v).normalize(),t[3].setComponents(o-i,u-l,f-d,y-v).normalize(),t[4].setComponents(o-a,u-c,f-p,y-g).normalize(),t[5].setComponents(o+a,u+c,f+p,y+g).normalize(),this}},{key:"intersectsSphere",value:function(e){var t,r=this.planes,n=e.center,i=-e.radius,a=!0;for(t=0;6>t;++t)if(r[t].distanceToPoint(n)<i){a=!1;break}return a}},{key:"intersectsBox",value:function(e){var t,r,n=this.planes,i=e.min,a=e.max;for(t=0;6>t;++t)if(r=n[t],$.x=0<r.normal.x?a.x:i.x,$.y=0<r.normal.y?a.y:i.y,$.z=0<r.normal.z?a.z:i.z,0>r.distanceToPoint($))return!1;return!0}},{key:"containsPoint",value:function(e){var t,r=this.planes,n=!0;for(t=0;6>t;++t)if(0>r[t].distanceToPoint(e)){n=!1;break}return n}}])}(),new L),te=new L,re=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L;t(this,e),this.start=r,this.end=n}n(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L;return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L;return e.subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){ee.subVectors(e,this.start),te.subVectors(this.end,this.start);var r=te.dot(te),n=te.dot(ee);return t?R(M(n/r,0),1):n/r}},{key:"closestPointToPoint",value:function(e){var t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new L,n=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(n).add(this.start)}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}])}(),new L),ne=new L,ie=new L,ae=(function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}n(e,[{key:"set",value:function(e,t,r,n,i,a,o,s,l,c,u,h,d,p,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=n,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(e){var t=e.elements,r=this.elements;return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(t=0;16>t;++t)n[t]=e[t+r];return this}},{key:"toArray",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;for(e=0;16>e;++e)t[e+r]=n[e];return t}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return S(M(t,r,n))}},{key:"copyPosition",value:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}},{key:"setPosition",value:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}},{key:"extractBasis",value:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,r=e.elements,n=1/re.setFromMatrixColumn(e,0).length(),i=1/re.setFromMatrixColumn(e,1).length(),a=1/re.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t,r,n,i,a,o,s,l,c,u,h,d,p=this.elements,f=e.x,m=e.y,v=e.z,g=A(f),y=P(f),E=A(m),x=P(m),b=A(v),T=P(v);switch(e.order){case U:t=g*b,r=g*T,n=y*b,i=y*T,p[0]=E*b,p[4]=-E*T,p[8]=x,p[1]=r+n*x,p[5]=t-i*x,p[9]=-y*E,p[2]=i-t*x,p[6]=n+r*x,p[10]=g*E;break;case j:a=E*b,o=E*T,s=x*b,l=x*T,p[0]=a+l*y,p[4]=s*y-o,p[8]=g*x,p[1]=g*T,p[5]=g*b,p[9]=-y,p[2]=o*y-s,p[6]=l+a*y,p[10]=g*E;break;case G:a=E*b,o=E*T,s=x*b,l=x*T,p[0]=a-l*y,p[4]=-g*T,p[8]=s+o*y,p[1]=o+s*y,p[5]=g*b,p[9]=l-a*y,p[2]=-g*x,p[6]=y,p[10]=g*E;break;case W:t=g*b,r=g*T,n=y*b,i=y*T,p[0]=E*b,p[4]=n*x-r,p[8]=t*x+i,p[1]=E*T,p[5]=i*x+t,p[9]=r*x-n,p[2]=-x,p[6]=y*E,p[10]=g*E;break;case B:c=g*E,u=g*x,h=y*E,d=y*x,p[0]=E*b,p[4]=d-c*T,p[8]=h*T+u,p[1]=T,p[5]=g*b,p[9]=-y*b,p[2]=-x*b,p[6]=u*T+h,p[10]=c-d*T;break;case V:c=g*E,u=g*x,h=y*E,d=y*x,p[0]=E*b,p[4]=-T,p[8]=x*b,p[1]=c*T+d,p[5]=g*b,p[9]=u*T-h,p[2]=h*T-u,p[6]=y*b,p[10]=d*T+c}return p[3]=0,p[7]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(re.set(0,0,0),e,ne.set(1,1,1))}},{key:"lookAt",value:function(e,t,r){var n=this.elements,i=re,a=ne,o=ie;return o.subVectors(e,t),0===o.lengthSquared()&&(o.z=1),o.normalize(),i.crossVectors(r,o),0===i.lengthSquared()&&(1===w(r.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),i.crossVectors(r,o)),i.normalize(),a.crossVectors(o,i),n[0]=i.x,n[4]=a.x,n[8]=o.x,n[1]=i.y,n[5]=a.y,n[9]=o.y,n[2]=i.z,n[6]=a.z,n[10]=o.z,this}},{key:"multiplyMatrices",value:function(e,t){var r=this.elements,n=e.elements,i=t.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],v=n[14],g=n[3],y=n[7],E=n[11],x=n[15],b=i[0],T=i[4],w=i[8],_=i[12],R=i[1],M=i[5],S=i[9],A=i[13],P=i[2],L=i[6],C=i[10],H=i[14],I=i[3],k=i[7],O=i[11],N=i[15];return r[0]=a*b+o*R+s*P+l*I,r[4]=a*T+o*M+s*L+l*k,r[8]=a*w+o*S+s*C+l*O,r[12]=a*_+o*A+s*H+l*N,r[1]=c*b+u*R+h*P+d*I,r[5]=c*T+u*M+h*L+d*k,r[9]=c*w+u*S+h*C+d*O,r[13]=c*_+u*A+h*H+d*N,r[2]=p*b+f*R+m*P+v*I,r[6]=p*T+f*M+m*L+v*k,r[10]=p*w+f*S+m*C+v*O,r[14]=p*_+f*A+m*H+v*N,r[3]=g*b+y*R+E*P+x*I,r[7]=g*T+y*M+E*L+x*k,r[11]=g*w+y*S+E*C+x*O,r[15]=g*_+y*A+E*H+x*N,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14],p=t*o,f=t*s,m=t*l,v=r*a,g=r*s,y=r*l,E=n*a,x=n*o,b=n*l,T=i*a,w=i*o,_=i*s;return e[3]*(_*u-b*u-w*h+y*h+x*d-g*d)+e[7]*(f*d-m*h+T*h-E*d+b*c-_*c)+e[11]*(m*u-p*d-T*u+v*d+w*c-y*c)+e[15]*(-x*c-f*u+p*h+E*u-v*h+g*c)}},{key:"getInverse",value:function(e){var t,r=this.elements,n=e.elements,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],d=n[8],p=n[9],f=n[10],m=n[11],v=n[12],g=n[13],y=n[14],E=n[15],x=p*y*h-g*f*h+g*u*m-c*y*m-p*u*E+c*f*E,b=v*f*h-d*y*h-v*u*m+l*y*m+d*u*E-l*f*E,T=d*g*h-v*p*h+v*c*m-l*g*m-d*c*E+l*p*E,w=v*p*u-d*g*u-v*c*f+l*g*f+d*c*y-l*p*y,_=i*x+a*b+o*T+s*w;return 0==_?(console.error("Can't invert matrix, determinant is zero",e),this.identity()):(t=1/_,r[0]=x*t,r[1]=(g*f*s-p*y*s-g*o*m+a*y*m+p*o*E-a*f*E)*t,r[2]=(c*y*s-g*u*s+g*o*h-a*y*h-c*o*E+a*u*E)*t,r[3]=(p*u*s-c*f*s-p*o*h+a*f*h+c*o*m-a*u*m)*t,r[4]=b*t,r[5]=(d*y*s-v*f*s+v*o*m-i*y*m-d*o*E+i*f*E)*t,r[6]=(v*u*s-l*y*s-v*o*h+i*y*h+l*o*E-i*u*E)*t,r[7]=(l*f*s-d*u*s+d*o*h-i*f*h-l*o*m+i*u*m)*t,r[8]=T*t,r[9]=(v*p*s-d*g*s-v*a*m+i*g*m+d*a*E-i*p*E)*t,r[10]=(l*g*s-v*c*s+v*a*h-i*g*h-l*a*E+i*c*E)*t,r[11]=(d*c*s-l*p*s-d*a*h+i*p*h+l*a*m-i*c*m)*t,r[12]=w*t,r[13]=(d*g*o-v*p*o+v*a*f-i*g*f-d*a*y+i*p*y)*t,r[14]=(v*c*o-l*g*o-v*a*u+i*g*u+l*a*y-i*c*y)*t,r[15]=(l*p*o-d*c*o+d*a*u-i*p*u-l*a*f+i*c*f)*t),this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"scale",value:function(e,t,r){var n=this.elements;return n[0]*=e,n[4]*=t,n[8]*=r,n[1]*=e,n[5]*=t,n[9]*=r,n[2]*=e,n[6]*=t,n[10]*=r,n[3]*=e,n[7]*=t,n[11]*=r,this}},{key:"makeScale",value:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}},{key:"makeTranslation",value:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=A(e),r=P(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=A(e),r=P(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=A(e),r=P(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var r=A(t),n=P(t),i=1-r,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+r,l*o-n*s,l*s+n*o,0,l*o+n*s,c*o+r,c*s-n*a,0,l*s-n*o,c*s+n*a,i*s*s+r,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,r){var n=this.elements,i=t.x,a=t.y,o=t.z,s=t.w,l=i+i,c=a+a,u=o+o,h=i*l,d=i*c,p=i*u,f=a*c,m=a*u,v=o*u,g=s*l,y=s*c,E=s*u,x=r.x,b=r.y,T=r.z;return n[0]=(1-(f+v))*x,n[1]=(d+E)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-E)*b,n[5]=(1-(h+v))*b,n[6]=(m+g)*b,n[7]=0,n[8]=(p+y)*T,n[9]=(m-g)*T,n[10]=(1-(h+f))*T,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}},{key:"decompose",value:function(e,t,r){var n=this.elements,i=n[0],a=n[1],o=n[2],s=n[4],l=n[5],c=n[6],u=n[8],h=n[9],d=n[10],p=this.determinant(),f=re.set(i,a,o).length()*(0>p?-1:1),m=re.set(s,l,c).length(),v=re.set(u,h,d).length(),g=1/f,y=1/m,E=1/v;return e.x=n[12],e.y=n[13],e.z=n[14],n[0]*=g,n[1]*=g,n[2]*=g,n[4]*=y,n[5]*=y,n[6]*=y,n[8]*=E,n[9]*=E,n[10]*=E,t.setFromRotationMatrix(this),n[0]=i,n[1]=a,n[2]=o,n[4]=s,n[5]=l,n[6]=c,n[8]=u,n[9]=h,n[10]=d,r.x=f,r.y=m,r.z=v,this}},{key:"makePerspective",value:function(e,t,r,n,i,a){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(a+i)/(a-i),o[14]=-2*a*i/(a-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,r,n,i,a){var o=this.elements,s=1/(t-e),l=1/(r-n),c=1/(a-i);return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-(t+e)*s,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-(r+n)*l,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-(a+i)*c,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){var t,r=this.elements,n=e.elements,i=!0;for(t=0;i&&16>t;++t)r[t]!==n[t]&&(i=!1);return i}}])}(),[new L,new L,new L,new L]),oe=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L;t(this,e),this.origin=r,this.direction=n}return n(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L;return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,ae[0])),this}},{key:"closestPointToPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L,r=t.subVectors(e,this.origin).dot(this.direction);return 0<=r?t.copy(this.direction).multiplyScalar(r).add(this.origin):t.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(e){var t=ae[0].subVectors(e,this.origin).dot(this.direction);return 0>t?this.origin.distanceToSquared(e):ae[0].copy(this.direction).multiplyScalar(t).add(this.origin).distanceToSquared(e)}},{key:"distanceToPoint",value:function(e){return S(this.distanceSquaredToPoint(e))}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction),r=0===t?0===e.distanceToPoint(this.origin)?0:-1:-(this.origin.dot(e.normal)+e.constant)/t;return 0<=r?r:null}},{key:"distanceSquaredToSegment",value:function(e,t,r,n){var i,a,o,s,l,c=ae[0].copy(e).add(t).multiplyScalar(.5),u=ae[1].copy(t).sub(e).normalize(),h=ae[2].copy(this.origin).sub(c),d=.5*e.distanceTo(t),p=-this.direction.dot(u),f=h.dot(this.direction),m=-h.dot(u),v=h.lengthSq(),g=w(1-p*p);return 0<g?(a=p*f-m,o=d*g,0<=(i=p*m-f)?a>=-o?a<=o?l=(i*=s=1/g)*(i+p*(a*=s)+2*f)+a*(p*i+a+2*m)+v:l=-(i=M(0,-(p*(a=d)+f)))*i+a*(a+2*m)+v:l=-(i=M(0,-(p*(a=-d)+f)))*i+a*(a+2*m)+v:a<=-o?l=-(i=M(0,-(-p*d+f)))*i+(a=0<i?-d:R(M(-d,-m),d))*(a+2*m)+v:a<=o?(i=0,l=(a=R(M(-d,-m),d))*(a+2*m)+v):l=-(i=M(0,-(p*d+f)))*i+(a=0<i?d:R(M(-d,-m),d))*(a+2*m)+v):l=-(i=M(0,-(p*(a=0<p?-d:d)+f)))*i+a*(a+2*m)+v,void 0!==r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),void 0!==n&&n.copy(u).multiplyScalar(a).add(c),l}},{key:"intersectSphere",value:function(e){var t,r,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L,a=ae[0].subVectors(e.center,this.origin),o=a.dot(this.direction),s=a.dot(a)-o*o,l=e.radius*e.radius,c=null;return s<=l&&(n=o+(t=S(l-s)),(0<=(r=o-t)||0<=n)&&(c=0>r?this.at(n,i):this.at(r,i))),c}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"intersectPlane",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L,r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t}},{key:"intersectBox",value:function(e){var t,r,n,i,a,o,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L,l=this.origin,c=this.direction,u=e.min,h=e.max,d=1/c.x,p=1/c.y,f=1/c.z,m=null;return 0<=d?(t=(u.x-l.x)*d,r=(h.x-l.x)*d):(t=(h.x-l.x)*d,r=(u.x-l.x)*d),0<=p?(n=(u.y-l.y)*p,i=(h.y-l.y)*p):(n=(h.y-l.y)*p,i=(u.y-l.y)*p),t<=i&&n<=r&&((n>t||t!=t)&&(t=n),(i<r||r!=r)&&(r=i),0<=f?(a=(u.z-l.z)*f,o=(h.z-l.z)*f):(a=(h.z-l.z)*f,o=(u.z-l.z)*f),t<=o&&a<=r&&((a>t||t!=t)&&(t=a),(o<r||r!=r)&&(r=o),0<=r&&(m=this.at(0<=t?t:r,s)))),m}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,ae[0])}},{key:"intersectTriangle",value:function(e,t,r,n,i){var a,o,s,l,c,u=this.direction,h=ae[0],d=ae[1],p=ae[2],f=ae[3],m=null;return d.subVectors(t,e),p.subVectors(r,e),f.crossVectors(d,p),0===(a=u.dot(f))||n&&0<a||(0<a?o=1:(o=-1,a=-a),h.subVectors(this.origin,e),0<=(s=o*u.dot(p.crossVectors(h,p)))&&(0<=(l=o*u.dot(d.cross(h)))&&s+l<=a&&(0<=(c=-o*h.dot(f))&&(m=this.at(c/a,i))))),m}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),se=(function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.radius=r,this.phi=n,this.theta=i}n(e,[{key:"set",value:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeSafe",value:function(){return this.phi=M(1e-6,R(y-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,r){return this.radius=S(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=E(e,r),this.phi=_(R(M(t/this.radius,-1),1))),this}}])}(),function(){function e(){t(this,e),this.elements=new Float32Array([1,0,0,1,0,1])}n(e,[{key:"set",value:function(e,t,r,n,i,a){var o=this.elements;return o[0]=e,o[1]=t,o[3]=n,o[2]=r,o[4]=i,o[5]=a,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(e){var t=e.elements;return this.set(t[0],t[1],t[2],t[3],t[4],t[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(e){var t=e.elements;e.set(t[0],t[1],t[2],t[1],t[3],t[4],t[2],t[4],t[5])}},{key:"add",value:function(e){var t=this.elements,r=e.elements;return t[0]+=r[0],t[1]+=r[1],t[3]+=r[3],t[2]+=r[2],t[4]+=r[4],t[5]+=r[5],this}},{key:"norm",value:function(){var e=this.elements,t=e[1]*e[1],r=e[2]*e[2],n=e[4]*e[4];return S(e[0]*e[0]+t+r+t+e[3]*e[3]+n+r+n+e[5]*e[5])}},{key:"off",value:function(){var e=this.elements;return S(2*(e[1]*e[1]+e[2]*e[2]+e[4]*e[4]))}},{key:"applyToVector3",value:function(e){var t=e.x,r=e.y,n=e.z,i=this.elements;return e.x=i[0]*t+i[1]*r+i[2]*n,e.y=i[1]*t+i[3]*r+i[4]*n,e.z=i[2]*t+i[4]*r+i[5]*n,e}},{key:"equals",value:function(e){var t,r=this.elements,n=e.elements,i=!0;for(t=0;i&&6>t;++t)r[t]!==n[t]&&(i=!1);return i}}],[{key:"calculateIndex",value:function(e,t){return 3-(3-e)*(2-e)/2+t}}])}(),function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;t(this,e),this.x=r,this.y=n,this.z=i,this.w=a}n(e,[{key:"set",value:function(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*_(e.w);var t=S(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,r,n,i,a,o,s,l,c,u,h,d=.01,p=e.elements,f=p[0],m=p[4],v=p[8],g=p[1],E=p[5],x=p[9],b=p[2],T=p[6],R=p[10];return w(m-g)<d&&w(v-b)<d&&w(x-T)<d?w(m+g)<.1&&w(v+b)<.1&&w(x+T)<.1&&w(f+E+R-3)<.1?this.set(1,0,0,0):(t=y,s=(R+1)/2,l=(m+g)/4,c=(v+b)/4,u=(x+T)/4,(a=(f+1)/2)>(o=(E+1)/2)&&a>s?a<d?(r=0,n=.707106781,i=.707106781):(n=l/(r=S(a)),i=c/r):o>s?o<d?(r=.707106781,n=0,i=.707106781):(r=l/(n=S(o)),i=u/n):s<d?(r=.707106781,n=.707106781,i=0):(r=c/(i=S(s)),n=u/i),this.set(r,n,i,t)):(h=S((T-x)*(T-x)+(v-b)*(v-b)+(g-m)*(g-m)),.001>w(h)&&(h=1),this.x=(T-x)/h,this.y=(v-b)/h,this.z=(g-m)/h,this.w=_((f+E+R-1)/2)),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this.w=e.w*t.w,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}},{key:"divideScalar",value:function(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,r=this.y,n=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*n+a[15]*i,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"manhattanLength",value:function(){return w(this.x)+w(this.y)+w(this.z)+w(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return S(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(e){return w(this.x-e.x)+w(this.y-e.y)+w(this.z-e.z)+w(this.w-e.w)}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z,i=this.w-e.w;return t*t+r*r+n*n+i*i}},{key:"distanceTo",value:function(e){return S(this.distanceToSquared(e))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"min",value:function(e){return this.x=R(this.x,e.x),this.y=R(this.y,e.y),this.z=R(this.z,e.z),this.w=R(this.w,e.w),this}},{key:"max",value:function(e){return this.x=M(this.x,e.x),this.y=M(this.y,e.y),this.z=M(this.z,e.z),this.w=M(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=M(e.x,R(t.x,this.x)),this.y=M(e.y,R(t.y,this.y)),this.z=M(e.z,R(t.z,this.z)),this.w=M(e.w,R(t.w,this.w)),this}},{key:"floor",value:function(){return this.x=T(this.x),this.y=T(this.y),this.z=T(this.z),this.w=T(this.w),this}},{key:"ceil",value:function(){return this.x=b(this.x),this.y=b(this.y),this.z=b(this.z),this.w=b(this.w),this}},{key:"round",value:function(){return this.x=x(this.x),this.y=x(this.y),this.z=x(this.z),this.w=x(this.w),this}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}])}(),new L),le=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new L;t(this,e),this.min=r,this.max=n,this.children=null}return n(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L;return e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L;return e.subVectors(this.max,this.min)}},{key:"split",value:function(){var e,t,r=this.min,n=this.max,i=this.getCenter(se),a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=ce[e],a[e]=new this.constructor(new L(0===t[0]?r.x:i.x,0===t[1]?r.y:i.y,0===t[2]?r.z:i.z),new L(0===t[0]?i.x:n.x,0===t[1]?i.y:n.y,0===t[2]?i.z:n.z))}}]),e}(),ce=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],ue=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],he=new L,de=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.min=r,this.size=n,this.children=null}return n(e,[{key:"getCenter",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L;return e.copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new L;return e.set(this.size,this.size,this.size)}},{key:"split",value:function(){var e,t,r=this.min,n=this.getCenter(he),i=.5*this.size,a=this.children=[null,null,null,null,null,null,null,null];for(e=0;8>e;++e)t=ce[e],a[e]=new this.constructor(new L(0===t[0]?r.x:n.x,0===t[1]?r.y:n.y,0===t[2]?r.z:n.z),i)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),e}(),pe=function(){function e(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];t(this,e),this.value=r,this.done=n}return n(e,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),e}(),fe=new I,me=function(){function e(r){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;t(this,e),this.octree=r,this.region=n,this.cull=null!==n,this.result=new pe,this.trace=null,this.indices=null,this.reset()}return n(e,[{key:"reset",value:function(){var e=this.octree.root;return this.trace=[],this.indices=[],null!==e&&(fe.min=e.min,fe.max=e.max,(!this.cull||this.region.intersectsBox(fe))&&(this.trace.push(e),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var e,t,r,n=this.cull,i=this.region,a=this.indices,o=this.trace,s=null,l=o.length-1;null===s&&0<=l;)if(e=a[l]++,t=o[l].children,8>e)if(null!==t){if(r=t[e],n&&(fe.min=r.min,fe.max=r.max,!i.intersectsBox(fe)))continue;o.push(r),a.push(0),++l}else s=o.pop(),a.pop();else o.pop(),a.pop(),--l;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(e){return this.result.value=e,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),e}(),ve=[new L,new L,new L],ge=new I,ye=new oe,Ee=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],xe=0,be=function(){function e(){t(this,e)}return n(e,null,[{key:"intersectOctree",value:function(e,t,r){var n,i,a,o,s,l,c,u,h,p=ge.min.set(0,0,0),f=ge.max.subVectors(e.max,e.min),m=e.getDimensions(ve[0]),v=ve[1].copy(m).multiplyScalar(.5),g=ye.origin.copy(t.ray.origin),y=ye.direction.copy(t.ray.direction);g.sub(e.getCenter(ve[2])).add(v),xe=0,0>y.x&&(g.x=m.x-g.x,y.x=-y.x,xe|=4),0>y.y&&(g.y=m.y-g.y,y.y=-y.y,xe|=2),0>y.z&&(g.z=m.z-g.z,y.z=-y.z,xe|=1),n=1/y.x,i=1/y.y,a=1/y.z,o=(p.x-g.x)*n,s=(f.x-g.x)*n,l=(p.y-g.y)*i,c=(f.y-g.y)*i,u=(p.z-g.z)*a,h=(f.z-g.z)*a,M(M(o,l),u)<R(R(s,c),h)&&function e(t,r,n,i,a,o,s,l,c){var u,h,p,f,m=t.children;if(0<=a&&0<=o&&0<=s)if(null===m)c.push(t);else{u=function(e,t,r,n,i,a){var o=0;return e>t&&e>r?(i<e&&(o|=2),a<e&&(o|=1)):t>r?(n<t&&(o|=4),a<t&&(o|=1)):(n<r&&(o|=4),i<r&&(o|=2)),o}(r,n,i,h=.5*(r+a),p=.5*(n+o),f=.5*(i+s));do{0===u?(e(m[xe],r,n,i,h,p,f,l,c),u=d(u,h,p,f)):1===u?(e(m[1^xe],r,n,f,h,p,s,l,c),u=d(u,h,p,s)):2===u?(e(m[2^xe],r,p,i,h,o,f,l,c),u=d(u,h,o,f)):3===u?(e(m[3^xe],r,p,f,h,o,s,l,c),u=d(u,h,o,s)):4===u?(e(m[4^xe],h,n,i,a,p,f,l,c),u=d(u,a,p,f)):5===u?(e(m[5^xe],h,n,f,a,p,s,l,c),u=d(u,a,p,s)):6===u?(e(m[6^xe],h,p,i,a,o,f,l,c),u=d(u,a,o,f)):7===u&&(e(m[7^xe],h,p,f,a,o,s,l,c),u=8)}while(8>u)}}(e.root,o,l,u,s,c,h,t,r)}}]),e}(),Te=new I,we=function(){function e(r,n){t(this,e),this.root=void 0!==r&&void 0!==n?new le(r,n):null}return n(e,[{key:"getCenter",value:function(e){return this.root.getCenter(e)}},{key:"getDimensions",value:function(e){return this.root.getDimensions(e)}},{key:"getDepth",value:function(){return function e(t){var r,n,i,a=t.children,o=0;if(null!==a)for(r=0,n=a.length;r<n;++r)(i=1+e(a[r]))>o&&(o=i);return o}(this.root)}},{key:"cull",value:function(e){var t=[];return function e(t,r,n){var i,a,o=t.children;if(Te.min=t.min,Te.max=t.max,r.intersectsBox(Te))if(null!==o)for(i=0,a=o.length;i<a;++i)e(o[i],r,n);else n.push(t)}(this.root,e,t),t}},{key:"findOctantsByLevel",value:function(e){var t=[];return function e(t,r,n,i){var a,o,s=t.children;if(n===r)i.push(t);else if(null!==s)for(++n,a=0,o=s.length;a<o;++a)e(s[a],r,n,i)}(this.root,e,0,t),t}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return be.intersectOctree(this,e,t),t}},{key:"leaves",value:function(e){return new me(this,e)}},{key:Symbol.iterator,value:function(){return new me(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),e}(),_e=new L,Re=function(e){function r(e,n){var i;return t(this,r),(i=l(this,a(r).call(this,e,n))).points=null,i.data=null,i}return i(r,le),n(r,[{key:"distanceToSquared",value:function(e){return _e.copy(e).clamp(this.min,this.max).sub(e).lengthSquared()}},{key:"distanceToCenterSquared",value:function(e){var t=this.getCenter(_e),r=e.x-t.x,n=e.y-t.x,i=e.z-t.z;return r*r+n*n+i*i}},{key:"contains",value:function(e,t){var r=this.min,n=this.max;return e.x>=r.x-t&&e.y>=r.y-t&&e.z>=r.z-t&&e.x<=n.x+t&&e.y<=n.y+t&&e.z<=n.z+t}},{key:"redistribute",value:function(e){var t,r,n,i,a,o,s,l=this.children,c=this.points,u=this.data;if(null!==l&&null!==c)for(t=0,n=c.length;t<n;++t)for(o=c[t],s=u[t],r=0,i=l.length;r<i;++r)if((a=l[r]).contains(o,e)){null===a.points&&(a.points=[],a.data=[]),a.points.push(o),a.data.push(s);break}this.points=null,this.data=null}},{key:"merge",value:function(){var e,t,r,n=this.children;if(null!==n){for(this.points=[],this.data=[],e=0,t=n.length;e<t;++e)if(null!==(r=n[e]).points){var i,a;(i=this.points).push.apply(i,u(r.points)),(a=this.data).push.apply(a,u(r.data))}this.children=null}}}]),r}(),Me=function e(r,n,i){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;t(this,e),this.distance=r,this.distanceToRay=n,this.point=i,this.object=a},Se=1e-6,Ae=function(e){function r(e,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,c=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;return t(this,r),(i=l(this,a(r).call(this))).root=new Re(e,n),i.bias=M(0,o),i.maxPoints=M(1,x(s)),i.maxDepth=M(0,x(c)),i.pointCount=0,i}return i(r,we),n(r,[{key:"countPoints",value:function(e){return p(e)}},{key:"put",value:function(e,t){return f(e,t,this,this.root,0)}},{key:"remove",value:function(e){return m(e,this,this.root,null)}},{key:"fetch",value:function(e){return function e(t,r,n){var i,a,o,s=n.children,l=null;if(n.contains(t,r.bias))if(null!==s)for(i=0,a=s.length;null===l&&i<a;++i)l=e(t,r,s[i]);else if(null!==n.points)for(i=0,a=(o=n.points).length;null===l&&i<a;++i)t.distanceToSquared(o[i])<=Se&&(l=n.data[i]);return l}(e,this,this.root)}},{key:"move",value:function(e,t){return function e(t,r,n,i,a,o){var s,l,c,u=i.children,h=null;if(i.contains(t,n.bias))if(i.contains(r,n.bias)){if(null!==u)for(++o,s=0,l=u.length;null===h&&s<l;++s)h=e(t,r,n,u[s],i,o);else if(null!==i.points)for(s=0,l=(c=i.points).length;s<l;++s)if(t.distanceToSquared(c[s])<=Se){c[s].copy(r),h=i.data[s];break}}else f(r,h=m(t,n,i,a),n,a,o-1);return h}(e,t,this,this.root,null,0)}},{key:"findNearestPoint",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];return v(e,t,r,this.root)}},{key:"findPoints",value:function(e,t){var r=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=[];return g(e,t,r,this.root,n),n}},{key:"raycast",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=c(a(r.prototype),"raycast",this).call(this,e);return 0<n.length&&this.testPoints(n,e,t),t}},{key:"testPoints",value:function(e,t,r){var n,i,a,o,s,l,c,u,h,d,p,f=t.params.Points.threshold;for(s=0,c=e.length;s<c;++s)if(null!==(d=(h=e[s]).points))for(l=0,u=d.length;l<u;++l)p=d[l],(o=t.ray.distanceSqToPoint(p))<f*f&&(n=t.ray.closestPointToPoint(p,new L),(i=t.ray.origin.distanceTo(n))>=t.near&&i<=t.far&&(a=S(o),r.push(new Me(i,a,n,h.data[l]))))}}]),r}(),Pe=new I,Le=new L,Ce=new L,He=new L,Ie=function(){function e(){t(this,e)}return n(e,null,[{key:"recycleOctants",value:function(e,t){var r,n,i,a,o=e.min,s=e.getCenter(Ce),l=e.getDimensions(He).multiplyScalar(.5),c=e.children,u=t.length;for(r=0;8>r;++r)for(i=ce[r],Pe.min.addVectors(o,Le.fromArray(i).multiply(l)),Pe.max.addVectors(s,Le.fromArray(i).multiply(l)),n=0;n<u;++n)if(null!==(a=t[n])&&Pe.min.equals(a.min)&&Pe.max.equals(a.max)){c[r]=a,t[n]=null;break}}}]),e}();e.CubicOctant=de,e.edges=ue,e.Octant=le,e.Octree=we,e.OctantIterator=me,e.OctreeRaycaster=be,e.pattern=ce,e.PointOctant=Re,e.PointOctree=Ae,e.RayPointIntersection=Me,e.OctreeUtils=Ie,Object.defineProperty(e,"__esModule",{value:!0})})},function(e,t,r){e.exports=function(){"use strict";var e=Math.pow(2,-52),t=function(t){var o=t.length>>1;if(o>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;var s=2*o-5,l=this.triangles=new Uint32Array(3*s),c=this.halfedges=new Int32Array(3*s);this._hashSize=Math.ceil(Math.sqrt(o));for(var u=this.hullPrev=new Uint32Array(o),h=this.hullNext=new Uint32Array(o),d=this.hullTri=new Uint32Array(o),p=new Int32Array(this._hashSize).fill(-1),f=new Uint32Array(o),m=1/0,v=1/0,g=-1/0,y=-1/0,E=0;E<o;E++){var x=t[2*E],b=t[2*E+1];x<m&&(m=x),b<v&&(v=b),x>g&&(g=x),b>y&&(y=b),f[E]=E}for(var T,w,_,R=(m+g)/2,M=(v+y)/2,S=1/0,A=0;A<o;A++){var P=r(R,M,t[2*A],t[2*A+1]);P<S&&(T=A,S=P)}var L=t[2*T],C=t[2*T+1];S=1/0;for(var H=0;H<o;H++)if(H!==T){var I=r(L,C,t[2*H],t[2*H+1]);I<S&&I>0&&(w=H,S=I)}for(var k=t[2*w],O=t[2*w+1],N=1/0,F=0;F<o;F++)if(F!==T&&F!==w){var D=i(L,C,k,O,t[2*F],t[2*F+1]);D<N&&(_=F,N=D)}var z=t[2*_],U=t[2*_+1];if(N===1/0)throw new Error("No Delaunay triangulation exists for this input.");if(n(L,C,k,O,z,U)){var B=w,G=k,V=O;w=_,k=z,O=U,_=B,z=G,U=V}var j=function(e,t,r,n,i,a){var o=NaN,s=NaN,l=NaN,c=NaN,u=o*o+s*s,h=l*l+c*c,d=.5/(o*c-s*l);return{x:e+(c*u-s*h)*d,y:t+(o*h-l*u)*d}}(L,C);this._cx=j.x,this._cy=j.y;for(var W=new Float64Array(o),X=0;X<o;X++)W[X]=r(t[2*X],t[2*X+1],j.x,j.y);!function e(t,r,n,i){if(i-n<=20)for(var o=n+1;o<=i;o++){for(var s=t[o],l=r[s],c=o-1;c>=n&&r[t[c]]>l;)t[c+1]=t[c--];t[c+1]=s}else{var u=n+i>>1,h=n+1,d=i;a(t,u,h),r[t[n]]>r[t[i]]&&a(t,n,i),r[t[h]]>r[t[i]]&&a(t,h,i),r[t[n]]>r[t[h]]&&a(t,n,h);for(var p=t[h],f=r[p];;){do{h++}while(r[t[h]]<f);do{d--}while(r[t[d]]>f);if(d<h)break;a(t,h,d)}t[n+1]=t[d],t[d]=p,i-h+1>=d-n?(e(t,r,h,i),e(t,r,n,d-1)):(e(t,r,n,d-1),e(t,r,h,i))}}(f,W,0,o-1),this.hullStart=T;var Y=3;h[T]=u[_]=w,h[w]=u[T]=_,h[_]=u[w]=T,d[T]=0,d[w]=1,d[_]=2,p[this._hashKey(L,C)]=T,p[this._hashKey(k,O)]=w,p[this._hashKey(z,U)]=_,this.trianglesLen=0,this._addTriangle(T,w,_,-1,-1,-1);for(var q=0,Q=void 0,Z=void 0;q<f.length;q++){var K=f[q],J=t[2*K],$=t[2*K+1];if(!(q>0&&Math.abs(J-Q)<=e&&Math.abs($-Z)<=e)&&(Q=J,Z=$,K!==T&&K!==w&&K!==_)){for(var ee=0,te=0,re=this._hashKey(J,$);te<this._hashSize&&(-1===(ee=p[(re+te)%this._hashSize])||ee===h[ee]);te++);for(var ne=ee=u[ee],ie=void 0;ie=h[ne],!n(J,$,t[2*ne],t[2*ne+1],t[2*ie],t[2*ie+1]);)if((ne=ie)===ee){ne=-1;break}if(-1!==ne){var ae=this._addTriangle(ne,K,h[ne],-1,-1,d[ne]);d[K]=this._legalize(ae+2),d[ne]=ae,Y++;for(var oe=h[ne];ie=h[oe],n(J,$,t[2*oe],t[2*oe+1],t[2*ie],t[2*ie+1]);)ae=this._addTriangle(oe,K,ie,d[K],-1,d[oe]),d[K]=this._legalize(ae+2),h[oe]=oe,Y--,oe=ie;if(ne===ee)for(;n(J,$,t[2*(ie=u[ne])],t[2*ie+1],t[2*ne],t[2*ne+1]);)ae=this._addTriangle(ie,K,ne,-1,d[ne],d[ie]),this._legalize(ae+2),d[ie]=ae,h[ne]=ne,Y--,ne=ie;this.hullStart=u[K]=ne,h[ne]=u[oe]=K,h[K]=oe,p[this._hashKey(J,$)]=K,p[this._hashKey(t[2*ne],t[2*ne+1])]=ne}}}this.hull=new Uint32Array(Y);for(var se=0,le=this.hullStart;se<Y;se++)this.hull[se]=le,le=h[le];this.hullPrev=this.hullNext=this.hullTri=null,this.triangles=l.subarray(0,this.trianglesLen),this.halfedges=c.subarray(0,this.trianglesLen)};function r(e,t,r,n){var i=e-r,a=t-n;return i*i+a*a}function n(e,t,r,n,i,a){return(n-t)*(i-r)-(r-e)*(a-n)<0}function i(e,t,r,n,i,a){var o=r-e,s=n-t,l=i-e,c=a-t,u=o*o+s*s,h=l*l+c*c,d=.5/(o*c-s*l),p=(c*u-s*h)*d,f=(o*h-l*u)*d;return p*p+f*f}function a(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function o(e){return e[0]}function s(e){return e[1]}return t.from=function(e,r,n){void 0===r&&(r=o),void 0===n&&(n=s);for(var i=e.length,a=new Float64Array(2*i),l=0;l<i;l++){var c=e[l];a[2*l]=r(c),a[2*l+1]=n(c)}return new t(a)},t.prototype._hashKey=function(e,t){return Math.floor((r=e-this._cx,n=t-this._cy,i=r/(Math.abs(r)+Math.abs(n)),(n>0?3-i:1+i)/4*this._hashSize))%this._hashSize;var r,n,i},t.prototype._legalize=function(e){var t=this.triangles,r=this.coords,n=this.halfedges,i=n[e],a=e-e%3,o=i-i%3,s=a+(e+1)%3,l=a+(e+2)%3,c=o+(i+2)%3;if(-1===i)return l;var u,h,d,p,f,m,v,g,y,E,x,b,T,w,_,R,M=t[l],S=t[e],A=t[s],P=t[c];if(u=r[2*M],h=r[2*M+1],d=r[2*S],p=r[2*S+1],f=r[2*A],m=r[2*A+1],v=r[2*P],g=r[2*P+1],(y=u-v)*((b=p-g)*(R=(T=f-v)*T+(w=m-g)*w)-(_=(x=d-v)*x+b*b)*w)-(E=h-g)*(x*R-_*T)+(y*y+E*E)*(x*w-b*T)<0){t[e]=P,t[i]=M;var L=n[c];if(-1===L){var C=this.hullStart;do{if(this.hullTri[C]===c){this.hullTri[C]=e;break}C=this.hullNext[C]}while(C!==this.hullStart)}this._link(e,L),this._link(i,n[l]),this._link(l,c);var H=o+(i+1)%3;return this._legalize(e),this._legalize(H)}return l},t.prototype._link=function(e,t){this.halfedges[e]=t,-1!==t&&(this.halfedges[t]=e)},t.prototype._addTriangle=function(e,t,r,n,i,a){var o=this.trianglesLen;return this.triangles[o]=e,this.triangles[o+1]=t,this.triangles[o+2]=r,this._link(o,n),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o},t}()},function(e,t,r){(function(r){var n,i,a;i=[],void 0===(a="function"==typeof(n=function(){"use strict";function t(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){o(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r&&r.global===r?r:void 0,o=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype?function(e,r,o){var s=a.URL||a.webkitURL,l=document.createElement("a");r=r||e.name||"download",l.download=r,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?i(l):n(l.href)?t(e,r,o):i(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout(function(){s.revokeObjectURL(l.href)},4e4),setTimeout(function(){i(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,r,a){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),r);else if(n(e))t(e,r,a);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout(function(){i(o)})}}:function(e,r,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,r,n);var o="application/octet-stream"===e.type,s=/constructor/i.test(a.HTMLElement)||a.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||o&&s)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},c.readAsDataURL(e)}else{var u=a.URL||a.webkitURL,h=u.createObjectURL(e);i?i.location=h:location.href=h,i=null,setTimeout(function(){u.revokeObjectURL(h)},4e4)}});a.saveAs=o.saveAs=o,e.exports=o})?n.apply(t,i):n)||(e.exports=a)}).call(this,r(3))},function(e,t){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";var e=void 0,t=this;function r(r,n){var i,a=r.split("."),o=t;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||n===e?o=o[i]?o[i]:o[i]={}:o[i]=n}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function i(e){var t,r,i,a,o,s,l,c,u,h,d=e.length,p=0,f=Number.POSITIVE_INFINITY;for(c=0;c<d;++c)e[c]>p&&(p=e[c]),e[c]<f&&(f=e[c]);for(t=1<<p,r=new(n?Uint32Array:Array)(t),i=1,a=0,o=2;i<=p;){for(c=0;c<d;++c)if(e[c]===i){for(s=0,l=a,u=0;u<i;++u)s=s<<1|1&l,l>>=1;for(h=i<<16|c,u=s;u<t;u+=o)r[u]=h;++a}++i,a<<=1,o<<=1}return[r,p,f]}function a(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=n?new Uint8Array(e):e,this.m=!1,this.i=s,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case o:this.b=32768,this.c=new(n?Uint8Array:Array)(32768+this.h+258);break;case s:this.b=0,this.c=new(n?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var o=0,s=1,l={t:o,s:s};a.prototype.k=function(){for(;!this.m;){var t=S(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var r=this.input,a=this.a,l=this.c,c=this.b,u=r.length,h=e,p=l.length,f=e;if(this.d=this.f=0,a+1>=u)throw Error("invalid uncompressed block header: LEN");if(h=r[a++]|r[a++]<<8,a+1>=u)throw Error("invalid uncompressed block header: NLEN");if(h===~(r[a++]|r[a++]<<8))throw Error("invalid uncompressed block header: length verify");if(a+h>r.length)throw Error("input buffer is broken");switch(this.i){case o:for(;c+h>l.length;){if(h-=f=p-c,n)l.set(r.subarray(a,a+f),c),c+=f,a+=f;else for(;f--;)l[c++]=r[a++];this.b=c,l=this.e(),c=this.b}break;case s:for(;c+h>l.length;)l=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(n)l.set(r.subarray(a,a+h),c),c+=h,a+=h;else for(;h--;)l[c++]=r[a++];this.a=a,this.b=c,this.c=l;break;case 1:this.j(_,M);break;case 2:var m,v,g,y,E=S(this,5)+257,x=S(this,5)+1,b=S(this,4)+4,T=new(n?Uint8Array:Array)(d.length),w=e,R=e,P=e,L=e,C=e;for(C=0;C<b;++C)T[d[C]]=S(this,3);if(!n)for(C=b,b=T.length;C<b;++C)T[d[C]]=0;for(m=i(T),w=new(n?Uint8Array:Array)(E+x),C=0,y=E+x;C<y;)switch(R=A(this,m),R){case 16:for(L=3+S(this,2);L--;)w[C++]=P;break;case 17:for(L=3+S(this,3);L--;)w[C++]=0;P=0;break;case 18:for(L=11+S(this,7);L--;)w[C++]=0;P=0;break;default:P=w[C++]=R}v=i(n?w.subarray(0,E):w.slice(0,E)),g=i(n?w.subarray(E):w.slice(E)),this.j(v,g);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var c,u,h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=n?new Uint16Array(h):h,p=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],f=n?new Uint16Array(p):p,m=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],v=n?new Uint8Array(m):m,g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],y=n?new Uint16Array(g):g,E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=n?new Uint8Array(E):E,b=new(n?Uint8Array:Array)(288);for(c=0,u=b.length;c<u;++c)b[c]=143>=c?8:255>=c?9:279>=c?7:8;var T,w,_=i(b),R=new(n?Uint8Array:Array)(30);for(T=0,w=R.length;T<w;++T)R[T]=5;var M=i(R);function S(e,t){for(var r,n=e.f,i=e.d,a=e.input,o=e.a,s=a.length;i<t;){if(o>=s)throw Error("input buffer is broken");n|=a[o++]<<i,i+=8}return r=n&(1<<t)-1,e.f=n>>>t,e.d=i-t,e.a=o,r}function A(e,t){for(var r,n,i=e.f,a=e.d,o=e.input,s=e.a,l=o.length,c=t[0],u=t[1];a<u&&!(s>=l);)i|=o[s++]<<a,a+=8;if((n=(r=c[i&(1<<u)-1])>>>16)>a)throw Error("invalid code length: "+n);return e.f=i>>n,e.d=a-n,e.a=s,65535&r}function P(e,t){var r,n;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),r=e[this.a++],n=e[this.a++],15&r){case L:this.method=L;break;default:throw Error("unsupported compression method")}if(0!=((r<<8)+n)%31)throw Error("invalid fcheck flag:"+((r<<8)+n)%31);if(32&n)throw Error("fdict flag is not supported");this.q=new a(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}a.prototype.j=function(e,t){var r=this.c,n=this.b;this.o=e;for(var i,a,o,s,l=r.length-258;256!==(i=A(this,e));)if(256>i)n>=l&&(this.b=n,r=this.e(),n=this.b),r[n++]=i;else for(s=f[a=i-257],0<v[a]&&(s+=S(this,v[a])),i=A(this,t),o=y[i],0<x[i]&&(o+=S(this,x[i])),n>=l&&(this.b=n,r=this.e(),n=this.b);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},a.prototype.w=function(e,t){var r=this.c,n=this.b;this.o=e;for(var i,a,o,s,l=r.length;256!==(i=A(this,e));)if(256>i)n>=l&&(l=(r=this.e()).length),r[n++]=i;else for(s=f[a=i-257],0<v[a]&&(s+=S(this,v[a])),i=A(this,t),o=y[i],0<x[i]&&(o+=S(this,x[i])),n+s>l&&(l=(r=this.e()).length);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},a.prototype.e=function(){var e,t,r=new(n?Uint8Array:Array)(this.b-32768),i=this.b-32768,a=this.c;if(n)r.set(a.subarray(32768,r.length));else for(e=0,t=r.length;e<t;++e)r[e]=a[e+32768];if(this.g.push(r),this.l+=r.length,n)a.set(a.subarray(i,i+32768));else for(e=0;32768>e;++e)a[e]=a[i+e];return this.b=32768,a},a.prototype.z=function(e){var t,r,i,a=this.input.length/this.a+1|0,o=this.input,s=this.c;return e&&("number"==typeof e.p&&(a=e.p),"number"==typeof e.u&&(a+=e.u)),2>a?r=(i=(o.length-this.a)/this.o[2]/2*258|0)<s.length?s.length+i:s.length<<1:r=s.length*a,n?(t=new Uint8Array(r)).set(s):t=s,this.c=t},a.prototype.n=function(){var e,t,r,i,a,o=0,s=this.c,l=this.g,c=new(n?Uint8Array:Array)(this.l+(this.b-32768));if(0===l.length)return n?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,r=l.length;t<r;++t)for(i=0,a=(e=l[t]).length;i<a;++i)c[o++]=e[i];for(t=32768,r=this.b;t<r;++t)c[o++]=s[t];return this.g=[],this.buffer=c},a.prototype.v=function(){var e,t=this.b;return n?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},P.prototype.k=function(){var e,t,r=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;var n=e;if("string"==typeof n){var i,a,o=n.split("");for(i=0,a=o.length;i<a;i++)o[i]=(255&o[i].charCodeAt(0))>>>0;n=o}for(var s,l=1,c=0,u=n.length,h=0;0<u;){u-=s=1024<u?1024:u;do{c+=l+=n[h++]}while(--s);l%=65521,c%=65521}if(t!==(c<<16|l)>>>0)throw Error("invalid adler-32 checksum")}return e};var L=8;r("Zlib.Inflate",P),r("Zlib.Inflate.prototype.decompress",P.prototype.k);var C,H,I,k,O={ADAPTIVE:l.s,BLOCK:l.t};if(Object.keys)C=Object.keys(O);else for(H in C=[],I=0,O)C[I++]=H;for(I=0,k=C.length;I<k;++I)r("Zlib.Inflate.BufferType."+(H=C[I]),O[H])}).call(this)},function(e,t,r){var n=function(){function e(e){return i.appendChild(e.dom),e}function t(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),t(++r%i.children.length)},!1);var a=(performance||Date).now(),o=a,s=0,l=e(new n.Panel("FPS","#0ff","#002")),c=e(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=e(new n.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:i,addPanel:e,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-a,200),e>o+1e3&&(l.update(1e3*s/(e-o),100),o=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:i,setMode:t}};n.Panel=function(e,t,r){var n=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,l=48*o,c=3*o,u=2*o,h=3*o,d=15*o,p=74*o,f=30*o,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*o+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=r,v.fillRect(0,0,s,l),v.fillStyle=t,v.fillText(e,c,u),v.fillRect(h,d,p,f),v.fillStyle=r,v.globalAlpha=.9,v.fillRect(h,d,p,f),{dom:m,update:function(l,g){n=Math.min(n,l),i=Math.max(i,l),v.fillStyle=r,v.globalAlpha=1,v.fillRect(0,0,s,d),v.fillStyle=t,v.fillText(a(l)+" "+e+" ("+a(n)+"-"+a(i)+")",c,u),v.drawImage(m,h+o,d,p-o,f,h,d,p-o,f),v.fillRect(h+p-o,d,o,f),v.fillStyle=r,v.globalAlpha=.9,v.fillRect(h+p-o,d,o,a((1-l/g)*f))}}},e.exports=n},function(e,t){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";function e(e){throw e}var t=void 0,r=this;function n(e,n){var i,a=e.split("."),o=r;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||n===t?o=o[i]?o[i]:o[i]={}:o[i]=n}var i,a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;for(new(a?Uint8Array:Array)(256),i=0;256>i;++i)for(var o=(o=i)>>>1;o;o>>>=1)0;function s(e,t,r){var n,i="number"==typeof t?t:t=0,a="number"==typeof r?r:e.length;for(n=-1,i=7&a;i--;++t)n=n>>>8^c[255&(n^e[t])];for(i=a>>3;i--;t+=8)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^c[255&(n^e[t])])>>>8^c[255&(n^e[t+1])])>>>8^c[255&(n^e[t+2])])>>>8^c[255&(n^e[t+3])])>>>8^c[255&(n^e[t+4])])>>>8^c[255&(n^e[t+5])])>>>8^c[255&(n^e[t+6])])>>>8^c[255&(n^e[t+7])];return(4294967295^n)>>>0}var l=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],c=a?new Uint32Array(l):l;function u(){}function h(e){var t,r,n,i,o,s,l,c,u,h,d=e.length,p=0,f=Number.POSITIVE_INFINITY;for(c=0;c<d;++c)e[c]>p&&(p=e[c]),e[c]<f&&(f=e[c]);for(t=1<<p,r=new(a?Uint32Array:Array)(t),n=1,i=0,o=2;n<=p;){for(c=0;c<d;++c)if(e[c]===n){for(s=0,l=i,u=0;u<n;++u)s=s<<1|1&l,l>>=1;for(h=n<<16|c,u=s;u<t;u+=o)r[u]=h;++i}++n,i<<=1,o<<=1}return[r,p,f]}u.prototype.getName=function(){return this.name},u.prototype.getData=function(){return this.data},u.prototype.H=function(){return this.I},n("Zlib.GunzipMember",u),n("Zlib.GunzipMember.prototype.getName",u.prototype.getName),n("Zlib.GunzipMember.prototype.getData",u.prototype.getData),n("Zlib.GunzipMember.prototype.getMtime",u.prototype.H);var d,p=[];for(d=0;288>d;d++)switch(!0){case 143>=d:p.push([d+48,8]);break;case 255>=d:p.push([d-144+400,9]);break;case 279>=d:p.push([d-256+0,7]);break;case 287>=d:p.push([d-280+192,8]);break;default:e("invalid literal: "+d)}var f=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var r,n,i=[];for(r=3;258>=r;r++)n=t(r),i[r]=n[2]<<24|n[1]<<16|n[0];return i}();function m(t,r){switch(this.i=[],this.j=32768,this.d=this.f=this.c=this.n=0,this.input=a?new Uint8Array(t):t,this.o=!1,this.k=g,this.z=!1,!r&&(r={})||(r.index&&(this.c=r.index),r.bufferSize&&(this.j=r.bufferSize),r.bufferType&&(this.k=r.bufferType),r.resize&&(this.z=r.resize)),this.k){case v:this.a=32768,this.b=new(a?Uint8Array:Array)(32768+this.j+258);break;case g:this.a=0,this.b=new(a?Uint8Array:Array)(this.j),this.e=this.F,this.q=this.B,this.l=this.D;break;default:e(Error("invalid inflate mode"))}}a&&new Uint32Array(f);var v=0,g=1;m.prototype.g=function(){for(;!this.o;){var r=N(this,3);switch(1&r&&(this.o=!0),r>>>=1){case 0:var n=this.input,i=this.c,o=this.b,s=this.a,l=n.length,c=t,u=o.length,h=t;switch(this.d=this.f=0,i+1>=l&&e(Error("invalid uncompressed block header: LEN")),c=n[i++]|n[i++]<<8,i+1>=l&&e(Error("invalid uncompressed block header: NLEN")),c===~(n[i++]|n[i++]<<8)&&e(Error("invalid uncompressed block header: length verify")),i+c>n.length&&e(Error("input buffer is broken")),this.k){case v:for(;s+c>o.length;){if(c-=h=u-s,a)o.set(n.subarray(i,i+h),s),s+=h,i+=h;else for(;h--;)o[s++]=n[i++];this.a=s,o=this.e(),s=this.a}break;case g:for(;s+c>o.length;)o=this.e({t:2});break;default:e(Error("invalid inflate mode"))}if(a)o.set(n.subarray(i,i+c),s),s+=c,i+=c;else for(;c--;)o[s++]=n[i++];this.c=i,this.a=s,this.b=o;break;case 1:this.l(I,O);break;case 2:D(this);break;default:e(Error("unknown BTYPE: "+r))}}return this.q()};var y,E,x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],b=a?new Uint16Array(x):x,T=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],w=a?new Uint16Array(T):T,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],R=a?new Uint8Array(_):_,M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],S=a?new Uint16Array(M):M,A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=a?new Uint8Array(A):A,L=new(a?Uint8Array:Array)(288);for(y=0,E=L.length;y<E;++y)L[y]=143>=y?8:255>=y?9:279>=y?7:8;var C,H,I=h(L),k=new(a?Uint8Array:Array)(30);for(C=0,H=k.length;C<H;++C)k[C]=5;var O=h(k);function N(t,r){for(var n,i=t.f,a=t.d,o=t.input,s=t.c,l=o.length;a<r;)s>=l&&e(Error("input buffer is broken")),i|=o[s++]<<a,a+=8;return n=i&(1<<r)-1,t.f=i>>>r,t.d=a-r,t.c=s,n}function F(e,t){for(var r,n,i=e.f,a=e.d,o=e.input,s=e.c,l=o.length,c=t[0],u=t[1];a<u&&!(s>=l);)i|=o[s++]<<a,a+=8;return n=(r=c[i&(1<<u)-1])>>>16,e.f=i>>n,e.d=a-n,e.c=s,65535&r}function D(e){function t(e,t,r){var n,i,a,o=this.w;for(a=0;a<e;)switch(n=F(this,t),n){case 16:for(i=3+N(this,2);i--;)r[a++]=o;break;case 17:for(i=3+N(this,3);i--;)r[a++]=0;o=0;break;case 18:for(i=11+N(this,7);i--;)r[a++]=0;o=0;break;default:o=r[a++]=n}return this.w=o,r}var r,n,i,o,s=N(e,5)+257,l=N(e,5)+1,c=N(e,4)+4,u=new(a?Uint8Array:Array)(b.length);for(o=0;o<c;++o)u[b[o]]=N(e,3);if(!a)for(o=c,c=u.length;o<c;++o)u[b[o]]=0;r=h(u),n=new(a?Uint8Array:Array)(s),i=new(a?Uint8Array:Array)(l),e.w=0,e.l(h(t.call(e,s,r,n)),h(t.call(e,l,r,i)))}function z(e){this.input=e,this.c=0,this.m=[],this.s=!1}m.prototype.l=function(e,t){var r=this.b,n=this.a;this.r=e;for(var i,a,o,s,l=r.length-258;256!==(i=F(this,e));)if(256>i)n>=l&&(this.a=n,r=this.e(),n=this.a),r[n++]=i;else for(s=w[a=i-257],0<R[a]&&(s+=N(this,R[a])),i=F(this,t),o=S[i],0<P[i]&&(o+=N(this,P[i])),n>=l&&(this.a=n,r=this.e(),n=this.a);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},m.prototype.D=function(e,t){var r=this.b,n=this.a;this.r=e;for(var i,a,o,s,l=r.length;256!==(i=F(this,e));)if(256>i)n>=l&&(l=(r=this.e()).length),r[n++]=i;else for(s=w[a=i-257],0<R[a]&&(s+=N(this,R[a])),i=F(this,t),o=S[i],0<P[i]&&(o+=N(this,P[i])),n+s>l&&(l=(r=this.e()).length);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},m.prototype.e=function(){var e,t,r=new(a?Uint8Array:Array)(this.a-32768),n=this.a-32768,i=this.b;if(a)r.set(i.subarray(32768,r.length));else for(e=0,t=r.length;e<t;++e)r[e]=i[e+32768];if(this.i.push(r),this.n+=r.length,a)i.set(i.subarray(n,n+32768));else for(e=0;32768>e;++e)i[e]=i[n+e];return this.a=32768,i},m.prototype.F=function(e){var t,r,n,i=this.input.length/this.c+1|0,o=this.input,s=this.b;return e&&("number"==typeof e.t&&(i=e.t),"number"==typeof e.A&&(i+=e.A)),2>i?r=(n=(o.length-this.c)/this.r[2]/2*258|0)<s.length?s.length+n:s.length<<1:r=s.length*i,a?(t=new Uint8Array(r)).set(s):t=s,this.b=t},m.prototype.q=function(){var e,t,r,n,i,o=0,s=this.b,l=this.i,c=new(a?Uint8Array:Array)(this.n+(this.a-32768));if(0===l.length)return a?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(t=0,r=l.length;t<r;++t)for(n=0,i=(e=l[t]).length;n<i;++n)c[o++]=e[n];for(t=32768,r=this.a;t<r;++t)c[o++]=s[t];return this.i=[],this.buffer=c},m.prototype.B=function(){var e,t=this.a;return a?this.z?(e=new Uint8Array(t)).set(this.b.subarray(0,t)):e=this.b.subarray(0,t):(this.b.length>t&&(this.b.length=t),e=this.b),this.buffer=e},z.prototype.G=function(){return this.s||this.g(),this.m.slice()},z.prototype.g=function(){for(var r=this.input.length;this.c<r;){var n,i,o=new u,l=t,c=t,h=t,d=t,p=t,f=t,v=t,g=this.input,y=this.c;switch(o.u=g[y++],o.v=g[y++],(31!==o.u||139!==o.v)&&e(Error("invalid file signature:"+o.u+","+o.v)),o.p=g[y++],o.p){case 8:break;default:e(Error("unknown compression method: "+o.p))}if(o.h=g[y++],i=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24,o.I=new Date(1e3*i),o.O=g[y++],o.N=g[y++],0<(4&o.h)&&(o.J=g[y++]|g[y++]<<8,y+=o.J),0<(8&o.h)){for(f=[],p=0;0<(d=g[y++]);)f[p++]=String.fromCharCode(d);o.name=f.join("")}if(0<(16&o.h)){for(f=[],p=0;0<(d=g[y++]);)f[p++]=String.fromCharCode(d);o.K=f.join("")}0<(2&o.h)&&(o.C=65535&s(g,0,y),o.C!==(g[y++]|g[y++]<<8)&&e(Error("invalid header crc16"))),l=g[g.length-4]|g[g.length-3]<<8|g[g.length-2]<<16|g[g.length-1]<<24,g.length-y-4-4<512*l&&(h=l),c=new m(g,{index:y,bufferSize:h}),o.data=n=c.g(),y=c.c,o.L=v=(g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24)>>>0,s(n,t,t)!==v&&e(Error("invalid CRC-32 checksum: 0x"+s(n,t,t).toString(16)+" / 0x"+v.toString(16))),o.M=l=(g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24)>>>0,(4294967295&n.length)!==l&&e(Error("invalid input size: "+(4294967295&n.length)+" / "+l)),this.m.push(o),this.c=y}this.s=!0;var E,x,b,T=this.m,w=0,_=0;for(E=0,x=T.length;E<x;++E)_+=T[E].data.length;if(a)for(b=new Uint8Array(_),E=0;E<x;++E)b.set(T[E].data,w),w+=T[E].data.length;else{for(b=[],E=0;E<x;++E)b[E]=T[E].data;b=Array.prototype.concat.apply([],b)}return b},n("Zlib.Gunzip",z),n("Zlib.Gunzip.prototype.decompress",z.prototype.g),n("Zlib.Gunzip.prototype.getMembers",z.prototype.G)}).call(this)},function(e,t,r){(function(t){var r;e.exports=function e(t,n,i){function a(s,l){if(!n[s]){if(!t[s]){var c="function"==typeof r&&r;if(!l&&c)return r(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var r=t[s][1][e];return a(r||e)},h,h.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){t.exports={version:"1.5.0"}},{}],2:[function(e,t,r){"use strict";var n=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};n.prototype.head=function(){return this.head_},n.prototype.setHead=function(e){this.head_=e},n.prototype.tail=function(){return this.tail_},n.prototype.setTail=function(e){this.tail_=e},n.prototype.search=function(){return this.search_node_},n.prototype.setSearch=function(e){this.search_node_=e},n.prototype.findSearchNode=function(){return this.search_node_},n.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},n.prototype.locatePoint=function(e){var t=e.x,r=this.findSearchNode(t),n=r.point.x;if(t===n){if(e!==r.point)if(e===r.prev.point)r=r.prev;else{if(e!==r.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");r=r.next}}else if(t<n)for(;(r=r.prev)&&e!==r.point;);else for(;(r=r.next)&&e!==r.point;);return r&&(this.search_node_=r),r},t.exports=n,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,r){"use strict";t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};i.prototype.toString=function(){return n.toStringBase(this)},i.prototype.toJSON=function(){return{x:this.x,y:this.y}},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.set_zero=function(){return this.x=0,this.y=0,this},i.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},i.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},i.prototype.mul=function(e){return this.x*=e,this.y*=e,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},i.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},i.negate=function(e){return new i(-e.x,-e.y)},i.add=function(e,t){return new i(e.x+t.x,e.y+t.y)},i.sub=function(e,t){return new i(e.x-t.x,e.y-t.y)},i.mul=function(e,t){return new i(e*t.x,e*t.y)},i.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new i(-e*t.y,e*t.x):"number"==typeof t?new i(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},i.toString=n.toString,i.compare=n.compare,i.cmp=n.compare,i.equals=n.equals,i.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=i},{"./xy":11}],5:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var r=0;r<t.length;r++)this.message+=" "+n.toString(t[r])};(i.prototype=new Error).constructor=i,t.exports=i},{"./xy":11}],6:[function(e,r,n){(function(t){"use strict";var r=t.poly2tri;n.noConflict=function(){return t.poly2tri=r,n},n.VERSION=e("../dist/version.json").version,n.PointError=e("./pointerror"),n.Point=e("./point"),n.Triangle=e("./triangle"),n.SweepContext=e("./sweepcontext");var i=e("./sweep");n.triangulate=i.triangulate,n.sweep={Triangulate:i.triangulate}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,r){"use strict";function n(e,t){var r=e.locateNode(t),n=function(e,t,r){var n=new E(t,r.point,r.next.point);n.markNeighbor(r.triangle),e.addToMap(n);var i=new x(t);return i.next=r.next,i.prev=r,r.next.prev=i,r.next=i,l(e,n)||e.mapTriangleToNodes(n),i}(e,t,r);return t.x<=r.point.x+T&&s(e,r),function(e,t){for(var r=t.next;r.next&&!M(r.point,r.next.point,r.prev.point);)s(e,r),r=r.next;for(r=t.prev;r.prev&&!M(r.point,r.next.point,r.prev.point);)s(e,r),r=r.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,r=e.point.y-e.next.next.point.y;return g(r>=0,"unordered y"),t>=0||Math.abs(t)<r}(t)&&function(e,t){for(_(t.point,t.next.point,t.next.next.point)===w.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,r){if(!function(e,t){var r;return r=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>r}(t,r)&&(s(t,r),r.prev!==t.basin.left_node||r.next!==t.basin.right_node)){if(r.prev===t.basin.left_node){if(_(r.point,r.next.point,r.next.next.point)===w.CW)return;r=r.next}else if(r.next===t.basin.right_node){if(_(r.point,r.prev.point,r.prev.prev.point)===w.CCW)return;r=r.prev}else r=r.prev.point.y<r.next.point.y?r.prev:r.next;e(t,r)}}(e,e.basin.bottom_node))}}(e,t)}(e,n),n}function i(e,t,r){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,o(r.triangle,t.p,t.q)||(function(e,t,r){e.edge_event.right?function(e,t,r){for(;r.next.point.x<t.p.x;)_(t.q,r.next.point,t.p)===w.CCW?h(e,t,r):r=r.next}(e,t,r):function(e,t,r){for(;r.prev.point.x>t.p.x;)_(t.q,r.prev.point,t.p)===w.CW?p(e,t,r):r=r.prev}(e,t,r)}(e,t,r),a(e,t.p,t.q,r.triangle,t.q))}function a(e,t,r,n,i){if(!o(n,t,r)){var s=n.pointCCW(i),l=_(r,s,t);if(l===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[r,s,t]);var c=n.pointCW(i),u=_(r,c,t);if(u===w.COLLINEAR)throw new y("poly2tri EdgeEvent: Collinear not supported!",[r,c,t]);l===u?(n=l===w.CW?n.neighborCCW(i):n.neighborCW(i),a(e,t,r,n,i)):m(e,t,r,n,i)}}function o(e,t,r){var n=e.edgeIndex(t,r);if(-1!==n){e.markConstrainedEdgeByIndex(n);var i=e.getNeighbor(n);return i&&i.markConstrainedEdgeByPoints(t,r),!0}return!1}function s(e,t){var r=new E(t.prev.point,t.point,t.next.point);r.markNeighbor(t.prev.triangle),r.markNeighbor(t.triangle),e.addToMap(r),t.prev.next=t.next,t.next.prev=t.prev,l(e,r)||e.mapTriangleToNodes(r)}function l(e,t){for(var r=0;r<3;++r)if(!t.delaunay_edge[r]){var n=t.getNeighbor(r);if(n){var i=t.getPoint(r),a=n.oppositePoint(t,i),o=n.index(a);if(n.constrained_edge[o]||n.delaunay_edge[o]){t.constrained_edge[r]=n.constrained_edge[o];continue}var s=c(i,t.pointCCW(i),t.pointCW(i),a);if(s){t.delaunay_edge[r]=!0,n.delaunay_edge[o]=!0,u(t,i,n,a);var h=!l(e,t);return h&&e.mapTriangleToNodes(t),(h=!l(e,n))&&e.mapTriangleToNodes(n),t.delaunay_edge[r]=!1,n.delaunay_edge[o]=!1,!0}}}return!1}function c(e,t,r,n){var i=e.x-n.x,a=e.y-n.y,o=t.x-n.x,s=t.y-n.y,l=i*s,c=o*a,u=l-c;if(u<=0)return!1;var h=r.x-n.x,d=r.y-n.y,p=h*a,f=i*d,m=p-f;return!(m<=0)&&(i*i+a*a)*(o*d-h*s)+(o*o+s*s)*m+(h*h+d*d)*u>0}function u(e,t,r,n){var i,a,o,s,l,c,u,h,d,p,f,m;i=e.neighborCCW(t),a=e.neighborCW(t),o=r.neighborCCW(n),s=r.neighborCW(n),l=e.getConstrainedEdgeCCW(t),c=e.getConstrainedEdgeCW(t),u=r.getConstrainedEdgeCCW(n),h=r.getConstrainedEdgeCW(n),d=e.getDelaunayEdgeCCW(t),p=e.getDelaunayEdgeCW(t),f=r.getDelaunayEdgeCCW(n),m=r.getDelaunayEdgeCW(n),e.legalize(t,n),r.legalize(n,t),r.setDelaunayEdgeCCW(t,d),e.setDelaunayEdgeCW(t,p),e.setDelaunayEdgeCCW(n,f),r.setDelaunayEdgeCW(n,m),r.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,c),e.setConstrainedEdgeCCW(n,u),r.setConstrainedEdgeCW(n,h),e.clearNeighbors(),r.clearNeighbors(),i&&r.markNeighbor(i),a&&e.markNeighbor(a),o&&e.markNeighbor(o),s&&r.markNeighbor(s),e.markNeighbor(r)}function h(e,t,r){r.point.x<t.p.x&&(_(r.point,r.next.point,r.next.next.point)===w.CCW?d(e,t,r):(function e(t,r,n){_(n.next.point,n.next.next.point,n.next.next.next.point)===w.CCW?d(t,r,n.next):_(r.q,n.next.next.point,r.p)===w.CCW&&e(t,r,n.next)}(e,t,r),h(e,t,r)))}function d(e,t,r){s(e,r.next),r.next.point!==t.p&&_(t.q,r.next.point,t.p)===w.CCW&&_(r.point,r.next.point,r.next.next.point)===w.CCW&&d(e,t,r)}function p(e,t,r){r.point.x>t.p.x&&(_(r.point,r.prev.point,r.prev.prev.point)===w.CW?f(e,t,r):(function e(t,r,n){_(n.prev.point,n.prev.prev.point,n.prev.prev.prev.point)===w.CW?f(t,r,n.prev):_(r.q,n.prev.prev.point,r.p)===w.CW&&e(t,r,n.prev)}(e,t,r),p(e,t,r)))}function f(e,t,r){s(e,r.prev),r.prev.point!==t.p&&_(t.q,r.prev.point,t.p)===w.CW&&_(r.point,r.prev.point,r.prev.prev.point)===w.CW&&f(e,t,r)}function m(e,t,r,n,i){var o=n.neighborAcross(i);g(o,"FLIP failed due to missing triangle!");var s=o.oppositePoint(n,i);if(n.getConstrainedEdgeAcross(i)){var c=n.index(i);throw new y("poly2tri Intersecting Constraints",[i,s,n.getPoint((c+1)%3),n.getPoint((c+2)%3)])}if(R(i,n.pointCCW(i),n.pointCW(i),s))if(u(n,i,o,s),e.mapTriangleToNodes(n),e.mapTriangleToNodes(o),i===r&&s===t)r===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(n.markConstrainedEdgeByPoints(t,r),o.markConstrainedEdgeByPoints(t,r),l(e,n),l(e,o));else{var h=_(r,s,t);n=function(e,t,r,n,i,a){var o;return t===w.CCW?(o=n.edgeIndex(i,a),n.delaunay_edge[o]=!0,l(e,n),n.clearDelaunayEdges(),r):(o=r.edgeIndex(i,a),r.delaunay_edge[o]=!0,l(e,r),r.clearDelaunayEdges(),n)}(e,h,n,o,i,s),m(e,t,r,n,i)}else(function e(t,r,n,i,a,o){var s=a.neighborAcross(o);g(s,"FLIP failed due to missing triangle");var l=s.oppositePoint(a,o);R(n,i.pointCCW(n),i.pointCW(n),l)?m(t,n,l,s,l):e(t,r,n,i,s,v(r,n,s,l))})(e,t,r,n,o,v(t,r,o,s)),a(e,t,r,n,i)}function v(e,t,r,n){var i=_(t,n,e);if(i===w.CW)return r.pointCCW(n);if(i===w.CCW)return r.pointCW(n);throw new y("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,n,e])}var g=e("./assert"),y=e("./pointerror"),E=e("./triangle"),x=e("./advancingfront").Node,b=e("./utils"),T=b.EPSILON,w=b.Orientation,_=b.orient2d,R=b.inScanArea,M=b.isAngleObtuse;r.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,r=e.pointCount();for(t=1;t<r;++t)for(var a=e.getPoint(t),o=n(e,a),s=a._p2t_edge_list,l=0;s&&l<s.length;++l)i(e,s[l],o)}(e),function(e){for(var t=e.front().head().next.triangle,r=e.front().head().next.point;!t.getConstrainedEdgeCW(r);)t=t.neighborCCW(r);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,r){"use strict";var n=e("./pointerror"),i=e("./point"),a=e("./triangle"),o=e("./sweep"),s=e("./advancingfront"),l=s.Node,c=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new n("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},u=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};u.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},d=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new u,this.edge_event=new h,this.initEdges(this.points_)};d.prototype.addHole=function(e){this.initEdges(e);var t,r=e.length;for(t=0;t<r;t++)this.points_.push(e[t]);return this},d.prototype.AddHole=d.prototype.addHole,d.prototype.addHoles=function(e){var t,r=e.length;for(t=0;t<r;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},d.prototype.addPoint=function(e){return this.points_.push(e),this},d.prototype.AddPoint=d.prototype.addPoint,d.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},d.prototype.triangulate=function(){return o.triangulate(this),this},d.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},d.prototype.getTriangles=function(){return this.triangles_},d.prototype.GetTriangles=d.prototype.getTriangles,d.prototype.front=function(){return this.front_},d.prototype.pointCount=function(){return this.points_.length},d.prototype.head=function(){return this.head_},d.prototype.setHead=function(e){this.head_=e},d.prototype.tail=function(){return this.tail_},d.prototype.setTail=function(e){this.tail_=e},d.prototype.getMap=function(){return this.map_},d.prototype.initTriangulation=function(){var e,t=this.points_[0].x,r=this.points_[0].x,n=this.points_[0].y,a=this.points_[0].y,o=this.points_.length;for(e=1;e<o;e++){var s=this.points_[e];s.x>t&&(t=s.x),s.x<r&&(r=s.x),s.y>n&&(n=s.y),s.y<a&&(a=s.y)}this.pmin_=new i(r,a),this.pmax_=new i(t,n);var l=.3*(t-r),c=.3*(n-a);this.head_=new i(t+l,a-c),this.tail_=new i(r-l,a-c),this.points_.sort(i.compare)},d.prototype.initEdges=function(e){var t,r=e.length;for(t=0;t<r;++t)this.edge_list.push(new c(e[t],e[(t+1)%r]))},d.prototype.getPoint=function(e){return this.points_[e]},d.prototype.addToMap=function(e){this.map_.push(e)},d.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},d.prototype.createAdvancingFront=function(){var e,t,r,n=new a(this.points_[0],this.tail_,this.head_);this.map_.push(n),e=new l(n.getPoint(1),n),t=new l(n.getPoint(0),n),r=new l(n.getPoint(2)),this.front_=new s(e,r),e.next=t,t.next=r,t.prev=e,r.prev=t},d.prototype.removeNode=function(e){},d.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var r=this.front_.locatePoint(e.pointCW(e.getPoint(t)));r&&(r.triangle=e)}},d.prototype.removeFromMap=function(e){var t,r=this.map_,n=r.length;for(t=0;t<n;t++)if(r[t]===e){r.splice(t,1);break}},d.prototype.meshClean=function(e){for(var t,r,n=[e];t=n.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),r=0;r<3;r++)t.constrained_edge[r]||n.push(t.getNeighbor(r))},t.exports=d},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,r){"use strict";var n=e("./xy"),i=function(e,t,r){this.points_=[e,t,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},a=n.toString;i.prototype.toString=function(){return"["+a(this.points_[0])+a(this.points_[1])+a(this.points_[2])+"]"},i.prototype.getPoint=function(e){return this.points_[e]},i.prototype.GetPoint=i.prototype.getPoint,i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(e){return this.neighbors_[e]},i.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},i.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},i.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(e){return this.interior_=e,this},i.prototype.markNeighborPointers=function(e,t,r){var n=this.points_;if(e===n[2]&&t===n[1]||e===n[1]&&t===n[2])this.neighbors_[0]=r;else if(e===n[0]&&t===n[2]||e===n[2]&&t===n[0])this.neighbors_[1]=r;else{if(!(e===n[0]&&t===n[1]||e===n[1]&&t===n[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=r}},i.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},i.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},i.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},i.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},i.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},i.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},i.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(e,t){var r=e.pointCW(t);return this.pointCW(r)},i.prototype.legalize=function(e,t){var r=this.points_;if(e===r[0])r[1]=r[0],r[0]=r[2],r[2]=t;else if(e===r[1])r[2]=r[1],r[1]=r[0],r[0]=t;else{if(e!==r[2])throw new Error("poly2tri Invalid Triangle.legalize() call");r[0]=r[2],r[2]=r[1],r[1]=t}},i.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(e,t){var r=this.points_;if(e===r[0]){if(t===r[1])return 2;if(t===r[2])return 1}else if(e===r[1]){if(t===r[2])return 0;if(t===r[0])return 2}else if(e===r[2]){if(t===r[0])return 1;if(t===r[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},i.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},i.prototype.markConstrainedEdgeByPoints=function(e,t){var r=this.points_;t===r[0]&&e===r[1]||t===r[1]&&e===r[0]?this.constrained_edge[2]=!0:t===r[0]&&e===r[2]||t===r[2]&&e===r[0]?this.constrained_edge[1]=!0:(t===r[1]&&e===r[2]||t===r[2]&&e===r[1])&&(this.constrained_edge[0]=!0)},t.exports=i},{"./xy":11}],10:[function(e,t,r){"use strict";var n=1e-12;r.EPSILON=n;var i={CW:1,CCW:-1,COLLINEAR:0};r.Orientation=i,r.orient2d=function(e,t,r){var a=(e.x-r.x)*(t.y-r.y),o=(e.y-r.y)*(t.x-r.x),s=a-o;return s>-n&&s<n?i.COLLINEAR:s>0?i.CCW:i.CW},r.inScanArea=function(e,t,r,i){return!((e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)>=-n||(e.x-r.x)*(i.y-r.y)-(i.x-r.x)*(e.y-r.y)<=n)},r.isAngleObtuse=function(e,t,r){var n=t.x-e.x,i=t.y-e.y;return n*(r.x-e.x)+i*(r.y-e.y)<0}},{}],11:[function(e,t,r){"use strict";function n(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?n(e):t},toStringBase:n,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)}).call(this,r(3))},function(e,t,r){var n;!function(i){function a(e,t,r,n,i){this._listener=t,this._isOnce=r,this.context=n,this._signal=e,this._priority=i||0}function o(e,t){if("function"!=typeof e)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function s(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){s.prototype.dispatch.apply(e,arguments)}}a.prototype={active:!0,params:null,execute:function(e){var t;return this.active&&this._listener&&(e=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,e),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},s.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,r,n){var i=this._indexOfListener(e,r);if(-1!==i){if((e=this._bindings[i]).isOnce()!==t)throw Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else e=new a(this,e,t,r,n),this._addBinding(e);return this.memorize&&this._prevParams&&e.execute(this._prevParams),e},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var r,n=this._bindings.length;n--;)if((r=this._bindings[n])._listener===e&&r.context===t)return n;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,r){return o(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return o(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){o(e,"remove");var r=this._indexOfListener(e,t);return-1!==r&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,r=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=r),n){t=this._bindings.slice(),this._shouldPropagate=!0;do{n--}while(t[n]&&this._shouldPropagate&&!1!==t[n].execute(r))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var l=s;l.Signal=s,void 0===(n=function(){return l}.call(t,r,t,e))||(e.exports=n)}()},function(e,t,r){(function(r){var n;
/*!
 *  howler.js v2.0.8
 *  howlerjs.com
 *
 *  (c) 2013-2018, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
/*!
 *  howler.js v2.0.8
 *  howlerjs.com
 *
 *  (c) 2013-2018, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||a;return e._counter=1e3,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var t=this||a;if(e=parseFloat(e),t.ctx||p(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,a.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||a;t.ctx||p(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,a.ctx.currentTime);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),i=0;i<n.length;i++){var o=t._howls[r]._soundById(n[i]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},unload:function(){for(var e=this||a,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,p()),e},codecs:function(e){return(this||a)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||a;if(e.state=e.ctx&&e.ctx.state||"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||a,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var r=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),i=n&&parseInt(n[0].split("/")[1],10)<33;return e._codecs={mp3:!(i||!r&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||a,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),r=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||r)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function(){a._autoResume();var t=e.ctx.createBufferSource();t.buffer=e._scratchBuffer,t.connect(e.ctx.destination),void 0===t.start?t.noteOn(0):t.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),t.onended=function(){t.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0)}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&a.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var r=0;r<e._howls[t]._sounds.length;r++)if(!e._howls[t]._sounds[r]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&a.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then(function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var a=new i,o=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(e){var t=this;return a.ctx||p(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhrWithCredentials=e.xhrWithCredentials||!1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onresume=[],t._webAudio=a.usingWebAudio&&!t._html5,void 0!==a.ctx&&a.ctx&&a.mobileAutoEnable&&a._enableMobileAudio(),a._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&t.load(),t},load:function(){var e=null;if(a.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var t=0;t<this._src.length;t++){var r,n;if(this._format&&this._format[t])r=this._format[t];else{if("string"!=typeof(n=this._src[t])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(n))||(r=/\.([^.]+)$/.exec(n.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&a.codecs(r)){e=this._src[t];break}}if(e)return this._src=e,this._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new s(this),this._webAudio&&c(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var r=this,n=null;if("number"==typeof e)n=e,e=null;else{if("string"==typeof e&&"loaded"===r._state&&!r._sprite[e])return null;if(void 0===e){e="__default";for(var i=0,o=0;o<r._sounds.length;o++)r._sounds[o]._paused&&!r._sounds[o]._ended&&(i++,n=r._sounds[o]._id);1===i?e=null:n=null}}var s=n?r._soundById(n):r._inactiveSound();if(!s)return null;if(n&&!e&&(e=s._sprite||"__default"),"loaded"!==r._state){s._sprite=e,s._ended=!1;var l=s._id;return r._queue.push({event:"play",action:function(){r.play(l)}}),l}if(n&&!s._paused)return t||setTimeout(function(){r._emit("play",s._id)},0),s._id;r._webAudio&&a._autoResume();var c=Math.max(0,s._seek>0?s._seek:r._sprite[e][0]/1e3),u=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-c),h=1e3*u/Math.abs(s._rate);s._paused=!1,s._ended=!1,s._sprite=e,s._seek=c,s._start=r._sprite[e][0]/1e3,s._stop=(r._sprite[e][0]+r._sprite[e][1])/1e3,s._loop=!(!s._loop&&!r._sprite[e][2]);var d=s._node;if(r._webAudio){var p=function(){r._refreshBuffer(s);var e=s._muted||r._muted?0:s._volume;d.gain.setValueAtTime(e,a.ctx.currentTime),s._playStart=a.ctx.currentTime,void 0===d.bufferSource.start?s._loop?d.bufferSource.noteGrainOn(0,c,86400):d.bufferSource.noteGrainOn(0,c,u):s._loop?d.bufferSource.start(0,c,86400):d.bufferSource.start(0,c,u),h!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h)),t||setTimeout(function(){r._emit("play",s._id)},0)};"running"===a.state?p():(r.once("resume",p),r._clearTimer(s._id))}else{var f=function(){d.currentTime=c,d.muted=s._muted||r._muted||a._muted||d.muted,d.volume=s._volume*a.volume(),d.playbackRate=s._rate;try{var e=d.play();if("undefined"!=typeof Promise&&e instanceof Promise&&(r._playLock=!0,e.then(function(){r._playLock=!1,r._loadQueue()})),d.paused)return void r._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices where playback was not within a user interaction.");h!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),h)),t||r._emit("play",s._id)}catch(e){r._emit("playerror",s._id,e)}},m=window&&window.ejecta||!d.readyState&&a._navigator.isCocoonJS;if(4===d.readyState||m)f();else{var v=function(){f(),d.removeEventListener(a._canPlayEvent,v,!1)};d.addEventListener(a._canPlayEvent,v,!1),r._clearTimer(s._id)}}return s._id},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var r=t._getSoundIds(e),n=0;n<r.length;n++){t._clearTimer(r[n]);var i=t._soundById(r[n]);if(i&&!i._paused&&(i._seek=t.seek(r[n]),i._rateSeek=0,i._paused=!0,t._stopFade(r[n]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var r=this;if("loaded"!==r._state)return r._queue.push({event:"stop",action:function(){r.stop(e)}}),r;for(var n=r._getSoundIds(e),i=0;i<n.length;i++){r._clearTimer(n[i]);var a=r._soundById(n[i]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,r._stopFade(n[i]),a._node&&(r._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),r._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause())),t||r._emit("stop",a._id))}return r},mute:function(e,t){var r=this;if("loaded"!==r._state)return r._queue.push({event:"mute",action:function(){r.mute(e,t)}}),r;if(void 0===t){if("boolean"!=typeof e)return r._muted;r._muted=e}for(var n=r._getSoundIds(t),i=0;i<n.length;i++){var o=r._soundById(n[i]);o&&(o._muted=e,o._interval&&r._stopFade(o._id),r._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,a.ctx.currentTime):o._node&&(o._node.muted=!!a._muted||e),r._emit("mute",o._id))}return r},volume:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._volume;if(1===i.length||2===i.length&&void 0===i[1]){var o=n._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(r=t?n._soundById(t):n._sounds[0])?r._volume:0;if("loaded"!==n._state)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,i)}}),n;void 0===t&&(n._volume=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)(r=n._soundById(t[l]))&&(r._volume=e,i[2]||n._stopFade(t[l]),n._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(e,a.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=e*a.volume()),n._emit("volume",r._id));return n},fade:function(e,t,r,n){var i=this;if("loaded"!==i._state)return i._queue.push({event:"fade",action:function(){i.fade(e,t,r,n)}}),i;i.volume(e,n);for(var o=i._getSoundIds(n),s=0;s<o.length;s++){var l=i._soundById(o[s]);if(l){if(n||i._stopFade(o[s]),i._webAudio&&!l._muted){var c=a.ctx.currentTime,u=c+r/1e3;l._volume=e,l._node.gain.setValueAtTime(e,c),l._node.gain.linearRampToValueAtTime(t,u)}i._startFadeInterval(l,e,t,r,o[s],void 0===n)}}return i},_startFadeInterval:function(e,t,r,n,i,a){var o=this,s=t,l=r-t,c=Math.abs(l/.01),u=Math.max(4,c>0?n/c:n),h=Date.now();e._fadeTo=r,e._interval=setInterval(function(){var i=(Date.now()-h)/n;h=Date.now(),s+=l*i,s=Math.max(0,s),s=Math.min(1,s),s=Math.round(100*s)/100,o._webAudio?e._volume=s:o.volume(s,e._id,!0),a&&(o._volume=s),(r<t&&s<=r||r>t&&s>=r)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(r,e._id),o._emit("fade",e._id))},u)},_stopFade:function(e){var t=this._soundById(e);return t&&t._interval&&(this._webAudio&&t._node.gain.cancelScheduledValues(a.ctx.currentTime),clearInterval(t._interval),t._interval=null,this.volume(t._fadeTo,e),t._fadeTo=null,this._emit("fade",e)),this},loop:function(){var e,t,r,n=this,i=arguments;if(0===i.length)return n._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(r=n._soundById(parseInt(i[0],10)))&&r._loop;e=i[0],n._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var a=n._getSoundIds(t),o=0;o<a.length;o++)(r=n._soundById(a[o]))&&(r._loop=e,n._webAudio&&r._node&&r._node.bufferSource&&(r._node.bufferSource.loop=e,e&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop)));return n},rate:function(){var e,t,r,n=this,i=arguments;if(0===i.length)t=n._sounds[0]._id;else if(1===i.length){var o=n._getSoundIds(),s=o.indexOf(i[0]);s>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(r=n._soundById(t))?r._rate:n._rate;if("loaded"!==n._state)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,i)}}),n;void 0===t&&(n._rate=e),t=n._getSoundIds(t);for(var l=0;l<t.length;l++)if(r=n._soundById(t[l])){r._rateSeek=n.seek(t[l]),r._playStart=n._webAudio?a.ctx.currentTime:r._playStart,r._rate=e,n._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(e,a.ctx.currentTime):r._node&&(r._node.playbackRate=e);var c=n.seek(t[l]),u=(n._sprite[r._sprite][0]+n._sprite[r._sprite][1])/1e3-c,h=1e3*u/Math.abs(r._rate);!n._endTimers[t[l]]&&r._paused||(n._clearTimer(t[l]),n._endTimers[t[l]]=setTimeout(n._ended.bind(n,r),h)),n._emit("rate",r._id)}return n},seek:function(){var e,t,r=this,n=arguments;if(0===n.length)t=r._sounds[0]._id;else if(1===n.length){var i=r._getSoundIds(),o=i.indexOf(n[0]);o>=0?t=parseInt(n[0],10):r._sounds.length&&(t=r._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if(void 0===t)return r;if("loaded"!==r._state)return r._queue.push({event:"seek",action:function(){r.seek.apply(r,n)}}),r;var s=r._soundById(t);if(s){if(!("number"==typeof e&&e>=0)){if(r._webAudio){var l=r.playing(t)?a.ctx.currentTime-s._playStart:0,c=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(c+l*Math.abs(s._rate))}return s._node.currentTime}var u=r.playing(t);u&&r.pause(t,!0),s._seek=e,s._ended=!1,r._clearTimer(t),u&&r.play(t,!0),!r._webAudio&&s._node&&(s._node.currentTime=e),r._emit("seek",t)}return r},playing:function(e){if("number"==typeof e){var t=this._soundById(e);return!!t&&!t._paused}for(var r=0;r<this._sounds.length;r++)if(!this._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this._duration,r=this._soundById(e);return r&&(t=this._sprite[r._sprite][1]/1e3),t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,r=0;r<t.length;r++){if(t[r]._paused||e.stop(t[r]._id),!e._webAudio)/MSIE |Trident\//.test(a._navigator&&a._navigator.userAgent)||(t[r]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),t[r]._node.removeEventListener("error",t[r]._errorFn,!1),t[r]._node.removeEventListener(a._canPlayEvent,t[r]._loadFn,!1);delete t[r]._node,e._clearTimer(t[r]._id);var n=a._howls.indexOf(e);n>=0&&a._howls.splice(n,1)}var i=!0;for(r=0;r<a._howls.length;r++)if(a._howls[r]._src===e._src){i=!1;break}return l&&i&&delete l[e._src],a.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,r,n){var i=this["_on"+e];return"function"==typeof t&&i.push(n?{id:r,fn:t,once:n}:{id:r,fn:t}),this},off:function(e,t,r){var n=this["_on"+e],i=0;if("number"==typeof t&&(r=t,t=null),t||r)for(i=0;i<n.length;i++){var a=r===n[i].id;if(t===n[i].fn&&a||!t&&a){n.splice(i,1);break}}else if(e)this["_on"+e]=[];else{var o=Object.keys(this);for(i=0;i<o.length;i++)0===o[i].indexOf("_on")&&Array.isArray(this[o[i]])&&(this[o[i]]=[])}return this},once:function(e,t,r){return this.on(e,t,r,1),this},_emit:function(e,t,r){for(var n=this["_on"+e],i=n.length-1;i>=0;i--)n[i].id&&n[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,r)}.bind(this,n[i].fn),0),n[i].once&&this.off(e,n[i].fn,n[i].id));return this},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,function(){e._queue.shift(),e._loadQueue()}),t.action()}return e},_ended:function(e){var t=e._sprite;if(!this._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(this._ended.bind(this,e),100),this;var r=!(!e._loop&&!this._sprite[t][2]);if(this._emit("end",e._id),!this._webAudio&&r&&this.stop(e._id,!0).play(e._id),this._webAudio&&r){this._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=a.ctx.currentTime;var n=1e3*(e._stop-e._start)/Math.abs(e._rate);this._endTimers[e._id]=setTimeout(this._ended.bind(this,e),n)}return this._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,this._clearTimer(e._id),this._cleanBuffer(e._node),a._autoSuspend()),this._webAudio||r||this.stop(e._id),this},_clearTimer:function(e){return this._endTimers[e]&&(clearTimeout(this._endTimers[e]),delete this._endTimers[e]),this},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){this._drain();for(var e=0;e<this._sounds.length;e++)if(this._sounds[e]._ended)return this._sounds[e].reset();return new s(this)},_drain:function(){var e=this._pool,t=0,r=0;if(!(this._sounds.length<e)){for(r=0;r<this._sounds.length;r++)this._sounds[r]._ended&&t++;for(r=this._sounds.length-1;r>=0;r--){if(t<=e)return;this._sounds[r]._ended&&(this._webAudio&&this._sounds[r]._node&&this._sounds[r]._node.disconnect(0),this._sounds.splice(r,1),t--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],r=0;r<this._sounds.length;r++)t.push(this._sounds[r]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=a.ctx.createBufferSource(),e._node.bufferSource.buffer=l[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,a.ctx.currentTime),this},_cleanBuffer:function(e){if(a._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=a._scratchBuffer}catch(e){}}return e.bufferSource=null,this}};var s=function(e){this._parent=e,this.init()};s.prototype={init:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++a._counter,e._sounds.push(this),this.create(),this},create:function(){var e=this._parent,t=a._muted||this._muted||this._parent._muted?0:this._volume;return e._webAudio?(this._node=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),this._node.gain.setValueAtTime(t,a.ctx.currentTime),this._node.paused=!0,this._node.connect(a.masterGain)):(this._node=new Audio,this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(a._canPlayEvent,this._loadFn,!1),this._node.src=e._src,this._node.preload="auto",this._node.volume=t*a.volume(),this._node.load()),this},reset:function(){var e=this._parent;return this._muted=e._muted,this._loop=e._loop,this._volume=e._volume,this._rate=e._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++a._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(a._canPlayEvent,this._loadFn,!1)}};var l={},c=function(e){var t=e._src;if(l[t])return e._duration=l[t].duration,void d(e);if(/^data:[^;]+;base64,/.test(t)){for(var r=atob(t.split(",")[1]),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);h(n.buffer,e)}else{var a=new XMLHttpRequest;a.open("GET",t,!0),a.withCredentials=e._xhrWithCredentials,a.responseType="arraybuffer",a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?h(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete l[t],e.load())},u(a)}},u=function(e){try{e.send()}catch(t){e.onerror()}},h=function(e,t){a.ctx.decodeAudioData(e,function(e){e&&t._sounds.length>0&&(l[t._src]=e,d(t,e))},function(){t._emit("loaderror",null,"Decoding audio data failed.")})},d=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},p=function(){try{"undefined"!=typeof AudioContext?a.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?a.ctx=new webkitAudioContext:a.usingWebAudio=!1}catch(e){a.usingWebAudio=!1}var e=/iP(hone|od|ad)/.test(a._navigator&&a._navigator.platform),t=a._navigator&&a._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=t?parseInt(t[1],10):null;if(e&&r&&r<9){var n=/safari/.test(a._navigator&&a._navigator.userAgent.toLowerCase());(a._navigator&&a._navigator.standalone&&!n||a._navigator&&!a._navigator.standalone&&!n)&&(a.usingWebAudio=!1)}a.usingWebAudio&&(a.masterGain=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),a.masterGain.gain.setValueAtTime(a._muted?0:1,a.ctx.currentTime),a.masterGain.connect(a.ctx.destination)),a._setup()};void 0===(n=function(){return{Howler:a,Howl:o}}.apply(t,[]))||(e.exports=n),t.Howler=a,t.Howl=o,"undefined"!=typeof window?(window.HowlerGlobal=i,window.Howler=a,window.Howl=o,window.Sound=s):void 0!==r&&(r.HowlerGlobal=i,r.Howler=a,r.Howl=o,r.Sound=s)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.0.8
 *  howlerjs.com
 *
 *  (c) 2013-2018, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){if(!this.ctx||!this.ctx.listener)return this;for(var t=this._howls.length-1;t>=0;t--)this._howls[t].stereo(e);return this},HowlerGlobal.prototype.pos=function(e,t,r){return this.ctx&&this.ctx.listener?(t="number"!=typeof t?this._pos[1]:t,r="number"!=typeof r?this._pos[2]:r,"number"!=typeof e?this._pos:(this._pos=[e,t,r],this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(e,t,r,n,i,a){if(!this.ctx||!this.ctx.listener)return this;var o=this._orientation;return t="number"!=typeof t?o[1]:t,r="number"!=typeof r?o[2]:r,n="number"!=typeof n?o[3]:n,i="number"!=typeof i?o[4]:i,a="number"!=typeof a?o[5]:a,"number"!=typeof e?o:(this._orientation=[e,t,r,n,i,a],this.ctx.listener.setOrientation(e,t,r,n,i,a),this)},Howl.prototype.init=(e=Howl.prototype.init,function(t){return this._orientation=t.orientation||[1,0,0],this._stereo=t.stereo||null,this._pos=t.pos||null,this._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},this._onstereo=t.onstereo?[{fn:t.onstereo}]:[],this._onpos=t.onpos?[{fn:t.onpos}]:[],this._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,r)}}),n;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===r){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var s=n._soundById(a[o]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,i),"spatial"===i?s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),n._emit("stereo",s._id)}}return n},Howl.prototype.pos=function(e,r,n,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"pos",action:function(){a.pos(e,r,n,i)}}),a;if(r="number"!=typeof r?0:r,n="number"!=typeof n?-.5:n,void 0===i){if("number"!=typeof e)return a._pos;a._pos=[e,r,n]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,r,n],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),l._panner.setPosition(e,r,n)),a._emit("pos",l._id)}}return a},Howl.prototype.orientation=function(e,r,n,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"orientation",action:function(){a.orientation(e,r,n,i)}}),a;if(r="number"!=typeof r?a._orientation[1]:r,n="number"!=typeof n?a._orientation[2]:n,void 0===i){if("number"!=typeof e)return a._orientation;a._orientation=[e,r,n]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var l=a._soundById(o[s]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,r,n],l._node&&(l._panner||(l._pos||(l._pos=a._pos||[0,0,-.5]),t(l,"spatial")),l._panner.setOrientation(e,r,n)),a._emit("orientation",l._id)}}return a},Howl.prototype.pannerAttr=function(){var e,r,n,i=this,a=arguments;if(!i._webAudio)return i;if(0===a.length)return i._pannerAttr;if(1===a.length){if("object"!=typeof a[0])return(n=i._soundById(parseInt(a[0],10)))?n._pannerAttr:i._pannerAttr;e=a[0],void 0===r&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===a.length&&(e=a[0],r=parseInt(a[1],10));for(var o=i._getSoundIds(r),s=0;s<o.length;s++)if(n=i._soundById(o[s])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:l.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:l.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:l.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:l.panningModel};var c=n._panner;c?(c.coneInnerAngle=l.coneInnerAngle,c.coneOuterAngle=l.coneOuterAngle,c.coneOuterGain=l.coneOuterGain,c.distanceModel=l.distanceModel,c.maxDistance=l.maxDistance,c.refDistance=l.refDistance,c.rolloffFactor=l.rolloffFactor,c.panningModel=l.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this._parent;this._orientation=t._orientation,this._stereo=t._stereo,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this),this._stereo?t.stereo(this._stereo):this._pos&&t.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this._parent;return this._orientation=t._orientation,this._pos=t._pos,this._pannerAttr=t._pannerAttr,e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()}).call(this,r(3))},function(e,t){THREE.OrbitControls=function(e,t){var r,n,i,a,o;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=h.NONE},this.update=(r=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=n.clone().inverse(),a=new THREE.Vector3,o=new THREE.Quaternion,function(){var e=s.object.position;return r.copy(e).sub(s.target),r.applyQuaternion(n),f.setFromVector3(r),s.autoRotate&&d===h.NONE&&P(2*Math.PI/60/60*s.autoRotateSpeed),f.theta+=m.theta,f.phi+=m.phi,f.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=v,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),s.target.add(g),r.setFromSpherical(f),r.applyQuaternion(i),e.copy(s.target).add(r),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,g.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),v=1,!!(y||a.distanceToSquared(s.object.position)>p||8*(1-o.dot(s.object.quaternion))>p)&&(s.dispatchEvent(l),a.copy(s.object.position),o.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",X,!1),s.domElement.removeEventListener("mousedown",D,!1),s.domElement.removeEventListener("wheel",B,!1),s.domElement.removeEventListener("touchstart",V,!1),s.domElement.removeEventListener("touchend",W,!1),s.domElement.removeEventListener("touchmove",j,!1),document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",U,!1),window.removeEventListener("keydown",G,!1)};var s=this,l={type:"change"},c={type:"start"},u={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},d=h.NONE,p=1e-6,f=new THREE.Spherical,m=new THREE.Spherical,v=1,g=new THREE.Vector3,y=!1,E=new THREE.Vector2,x=new THREE.Vector2,b=new THREE.Vector2,T=new THREE.Vector2,w=new THREE.Vector2,_=new THREE.Vector2,R=new THREE.Vector2,M=new THREE.Vector2,S=new THREE.Vector2;function A(){return Math.pow(.95,s.zoomSpeed)}function P(e){m.theta-=e}function L(e){m.phi-=e}var C,H=(C=new THREE.Vector3,function(e,t){C.setFromMatrixColumn(t,0),C.multiplyScalar(-e),g.add(C)}),I=function(){var e=new THREE.Vector3;return function(t,r){!0===s.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),g.add(e)}}(),k=function(){var e=new THREE.Vector3;return function(t,r){var n=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var i=s.object.position;e.copy(i).sub(s.target);var a=e.length();a*=Math.tan(s.object.fov/2*Math.PI/180),H(2*t*a/n.clientHeight,s.object.matrix),I(2*r*a/n.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(H(t*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),I(r*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function O(e){s.object.isPerspectiveCamera?v/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function N(e){s.object.isPerspectiveCamera?v*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function F(e){T.set(e.clientX,e.clientY)}function D(e){if(!1!==s.enabled){switch(e.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;F(e),d=h.PAN}else{if(!1===s.enableRotate)return;!function(e){E.set(e.clientX,e.clientY)}(e),d=h.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;!function(e){R.set(e.clientX,e.clientY)}(e),d=h.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;F(e),d=h.PAN}d!==h.NONE&&(document.addEventListener("mousemove",z,!1),document.addEventListener("mouseup",U,!1),s.dispatchEvent(c))}}function z(e){if(!1!==s.enabled)switch(e.preventDefault(),d){case h.ROTATE:if(!1===s.enableRotate)return;!function(e){x.set(e.clientX,e.clientY),b.subVectors(x,E).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*b.x/t.clientHeight),L(2*Math.PI*b.y/t.clientHeight),E.copy(x),s.update()}(e);break;case h.DOLLY:if(!1===s.enableZoom)return;!function(e){M.set(e.clientX,e.clientY),S.subVectors(M,R),S.y>0?O(A()):S.y<0&&N(A()),R.copy(M),s.update()}(e);break;case h.PAN:if(!1===s.enablePan)return;!function(e){w.set(e.clientX,e.clientY),_.subVectors(w,T).multiplyScalar(s.panSpeed),k(_.x,_.y),T.copy(w),s.update()}(e)}}function U(e){!1!==s.enabled&&(document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",U,!1),s.dispatchEvent(u),d=h.NONE)}function B(e){!1===s.enabled||!1===s.enableZoom||d!==h.NONE&&d!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(c),function(e){e.deltaY<0?N(A()):e.deltaY>0&&O(A()),s.update()}(e),s.dispatchEvent(u))}function G(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){var t=!1;switch(e.keyCode){case s.keys.UP:k(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:k(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:k(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:k(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function V(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){E.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=h.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);R.set(0,n)}if(s.enablePan){var i=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);T.set(i,a)}}(e),d=h.TOUCH_DOLLY_PAN;break;default:d=h.NONE}d!==h.NONE&&s.dispatchEvent(c)}}function j(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(d!==h.TOUCH_ROTATE)return;!function(e){x.set(e.touches[0].pageX,e.touches[0].pageY),b.subVectors(x,E).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*b.x/t.clientHeight),L(2*Math.PI*b.y/t.clientHeight),E.copy(x),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(d!==h.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);M.set(0,n),S.set(0,Math.pow(M.y/R.y,s.zoomSpeed)),O(S.y),R.copy(M)}if(s.enablePan){var i=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(i,a),_.subVectors(w,T).multiplyScalar(s.panSpeed),k(_.x,_.y),T.copy(w)}s.update()}(e);break;default:d=h.NONE}}function W(e){!1!==s.enabled&&(s.dispatchEvent(u),d=h.NONE)}function X(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",X,!1),s.domElement.addEventListener("mousedown",D,!1),s.domElement.addEventListener("wheel",B,!1),s.domElement.addEventListener("touchstart",V,!1),s.domElement.addEventListener("touchend",W,!1),s.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",G,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}})},function(e,t){THREE.TrackballControls=function(e,t){var r=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=new THREE.Vector3,a=n.NONE,o=n.NONE,s=new THREE.Vector3,l=new THREE.Vector2,c=new THREE.Vector2,u=new THREE.Vector3,h=0,d=new THREE.Vector2,p=new THREE.Vector2,f=0,m=0,v=new THREE.Vector2,g=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},E={type:"start"},x={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var b,T,w,_,R,M,S,A,P,L,C,H=(b=new THREE.Vector2,function(e,t){return b.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),b}),I=function(){var e=new THREE.Vector2;return function(t,n){return e.set((t-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),e}}();function k(e){!1!==r.enabled&&(window.removeEventListener("keydown",k),o=a,a===n.NONE&&(e.keyCode!==r.keys[n.ROTATE]||r.noRotate?e.keyCode!==r.keys[n.ZOOM]||r.noZoom?e.keyCode!==r.keys[n.PAN]||r.noPan||(a=n.PAN):a=n.ZOOM:a=n.ROTATE))}function O(e){!1!==r.enabled&&(a=o,window.addEventListener("keydown",k,!1))}function N(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a===n.NONE&&(a=e.button),a!==n.ROTATE||r.noRotate?a!==n.ZOOM||r.noZoom?a!==n.PAN||r.noPan||(v.copy(H(e.pageX,e.pageY)),g.copy(v)):(d.copy(H(e.pageX,e.pageY)),p.copy(d)):(c.copy(I(e.pageX,e.pageY)),l.copy(c)),document.addEventListener("mousemove",F,!1),document.addEventListener("mouseup",D,!1),r.dispatchEvent(E))}function F(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a!==n.ROTATE||r.noRotate?a!==n.ZOOM||r.noZoom?a!==n.PAN||r.noPan||g.copy(H(e.pageX,e.pageY)):p.copy(H(e.pageX,e.pageY)):(l.copy(c),c.copy(I(e.pageX,e.pageY))))}function D(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),a=n.NONE,document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",D),r.dispatchEvent(x))}function z(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:d.y-=.025*e.deltaY;break;case 1:d.y-=.01*e.deltaY;break;default:d.y-=25e-5*e.deltaY}r.dispatchEvent(E),r.dispatchEvent(x)}}function U(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:a=n.TOUCH_ROTATE,c.copy(I(e.touches[0].pageX,e.touches[0].pageY)),l.copy(c);break;default:a=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;m=f=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(H(o,s)),g.copy(v)}r.dispatchEvent(E)}}function B(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:l.copy(c),c.copy(I(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;m=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;g.copy(H(i,a))}}function G(e){if(!1!==r.enabled){switch(e.touches.length){case 0:a=n.NONE;break;case 1:a=n.TOUCH_ROTATE,c.copy(I(e.touches[0].pageX,e.touches[0].pageY)),l.copy(c)}r.dispatchEvent(x)}}function V(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=(w=new THREE.Vector3,_=new THREE.Quaternion,R=new THREE.Vector3,M=new THREE.Vector3,S=new THREE.Vector3,A=new THREE.Vector3,function(){A.set(c.x-l.x,c.y-l.y,0),(T=A.length())?(s.copy(r.object.position).sub(r.target),R.copy(s).normalize(),M.copy(r.object.up).normalize(),S.crossVectors(M,R).normalize(),M.setLength(c.y-l.y),S.setLength(c.x-l.x),A.copy(M.add(S)),w.crossVectors(A,s).normalize(),T*=r.rotateSpeed,_.setFromAxisAngle(w,T),s.applyQuaternion(_),r.object.up.applyQuaternion(_),u.copy(w),h=T):!r.staticMoving&&h&&(h*=Math.sqrt(1-r.dynamicDampingFactor),s.copy(r.object.position).sub(r.target),_.setFromAxisAngle(u,h),s.applyQuaternion(_),r.object.up.applyQuaternion(_)),l.copy(c)}),this.zoomCamera=function(){var e;a===n.TOUCH_ZOOM_PAN?(e=f/m,f=m,s.multiplyScalar(e)):(1!==(e=1+(p.y-d.y)*r.zoomSpeed)&&e>0&&s.multiplyScalar(e),r.staticMoving?d.copy(p):d.y+=(p.y-d.y)*this.dynamicDampingFactor)},this.panCamera=(P=new THREE.Vector2,L=new THREE.Vector3,C=new THREE.Vector3,function(){P.copy(g).sub(v),P.lengthSq()&&(P.multiplyScalar(s.length()*r.panSpeed),C.copy(s).cross(r.object.up).setLength(P.x),C.add(L.copy(r.object.up).setLength(P.y)),r.object.position.add(C),r.target.add(C),r.staticMoving?v.copy(g):v.add(P.subVectors(g,v).multiplyScalar(r.dynamicDampingFactor)))}),this.checkDistances=function(){r.noZoom&&r.noPan||(s.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,s.setLength(r.maxDistance)),d.copy(p)),s.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,s.setLength(r.minDistance)),d.copy(p)))},this.update=function(){s.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,s),r.checkDistances(),r.object.lookAt(r.target),i.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(y),i.copy(r.object.position))},this.reset=function(){a=n.NONE,o=n.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),s.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(y),i.copy(r.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",V,!1),this.domElement.removeEventListener("mousedown",N,!1),this.domElement.removeEventListener("wheel",z,!1),this.domElement.removeEventListener("touchstart",U,!1),this.domElement.removeEventListener("touchend",G,!1),this.domElement.removeEventListener("touchmove",B,!1),document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",D,!1),window.removeEventListener("keydown",k,!1),window.removeEventListener("keyup",O,!1)},this.domElement.addEventListener("contextmenu",V,!1),this.domElement.addEventListener("mousedown",N,!1),this.domElement.addEventListener("wheel",z,!1),this.domElement.addEventListener("touchstart",U,!1),this.domElement.addEventListener("touchend",G,!1),this.domElement.addEventListener("touchmove",B,!1),window.addEventListener("keydown",k,!1),window.addEventListener("keyup",O,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls},function(e,t){THREE.FirstPersonControls=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0;var r,n=0,i=0,a=new THREE.Vector3,o=new THREE.Spherical,s=new THREE.Vector3;function l(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,r){return e.isVector3?s.copy(e):s.set(e,t,r),this.object.lookAt(s),m(this),this},this.update=(r=new THREE.Vector3,function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var a=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(a+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(a),this.moveLeft&&this.object.translateX(-a),this.moveRight&&this.object.translateX(a),this.moveUp&&this.object.translateY(a),this.moveDown&&this.object.translateY(-a);var o=e*this.lookSpeed;this.activeLook||(o=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),i-=this.mouseX*o,this.lookVertical&&(n-=this.mouseY*o*s),n=Math.max(-85,Math.min(85,n));var l=THREE.Math.degToRad(90-n),c=THREE.Math.degToRad(i);this.constrainVertical&&(l=THREE.Math.mapLinear(l,0,Math.PI,this.verticalMin,this.verticalMax));var u=this.object.position;r.setFromSphericalCoords(1,l,c).add(u),this.object.lookAt(r)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",l,!1),this.domElement.removeEventListener("mousedown",u,!1),this.domElement.removeEventListener("mousemove",c,!1),this.domElement.removeEventListener("mouseup",h,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",p,!1)};var c=f(this,this.onMouseMove),u=f(this,this.onMouseDown),h=f(this,this.onMouseUp),d=f(this,this.onKeyDown),p=f(this,this.onKeyUp);function f(e,t){return function(){t.apply(e,arguments)}}function m(e){var t=e.object.quaternion;a.set(0,0,-1).applyQuaternion(t),o.setFromVector3(a),n=90-THREE.Math.radToDeg(o.phi),i=THREE.Math.radToDeg(o.theta)}this.domElement.addEventListener("contextmenu",l,!1),this.domElement.addEventListener("mousemove",c,!1),this.domElement.addEventListener("mousedown",u,!1),this.domElement.addEventListener("mouseup",h,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",p,!1),this.handleResize(),m(this)}},function(e,t){THREE.Reflector=function(e,t){THREE.Mesh.call(this,e),this.type="Reflector";var r=this,n=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,s=t.shader||THREE.Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,c=new THREE.Plane,u=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Matrix4,f=new THREE.Vector3(0,0,-1),m=new THREE.Vector4,v=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector4,E=new THREE.Matrix4,x=new THREE.PerspectiveCamera,b={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},T=new THREE.WebGLRenderTarget(i,a,b);THREE.Math.isPowerOfTwo(i)&&THREE.Math.isPowerOfTwo(a)||(T.texture.generateMipmaps=!1);var w=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});w.uniforms.tDiffuse.value=T.texture,w.uniforms.color.value=n,w.uniforms.textureMatrix.value=E,this.material=w,this.onBeforeRender=function(e,t,n){if("recursion"in n.userData){if(n.userData.recursion===l)return;n.userData.recursion++}if(h.setFromMatrixPosition(r.matrixWorld),d.setFromMatrixPosition(n.matrixWorld),p.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(p),v.subVectors(h,d),!(v.dot(u)>0)){v.reflect(u).negate(),v.add(h),p.extractRotation(n.matrixWorld),f.set(0,0,-1),f.applyMatrix4(p),f.add(d),g.subVectors(h,f),g.reflect(u).negate(),g.add(h),x.position.copy(v),x.up.set(0,1,0),x.up.applyMatrix4(p),x.up.reflect(u),x.lookAt(g),x.far=n.far,x.updateMatrixWorld(),x.projectionMatrix.copy(n.projectionMatrix),x.userData.recursion=0,E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(x.projectionMatrix),E.multiply(x.matrixWorldInverse),E.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(x.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var i=x.projectionMatrix;y.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],y.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],y.z=-1,y.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(y)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-o,i.elements[14]=m.w,r.visible=!1;var a=e.getRenderTarget(),s=e.vr.enabled,b=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(T),e.clear(),e.render(t,x),e.vr.enabled=s,e.shadowMap.autoUpdate=b,e.setRenderTarget(a),n.isArrayCamera&&e.state.viewport(n.viewport),r.visible=!0}},this.getRenderTarget=function(){return T}},THREE.Reflector.prototype=Object.create(THREE.Mesh.prototype),THREE.Reflector.prototype.constructor=THREE.Reflector,THREE.Reflector.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(e,t){THREE.Refractor=function(e,t){THREE.Mesh.call(this,e),this.type="Refractor";var r=this,n=void 0!==(t=t||{}).color?new THREE.Color(t.color):new THREE.Color(8355711),i=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,s=t.shader||THREE.Refractor.RefractorShader,l=new THREE.PerspectiveCamera;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var c=new THREE.Plane,u=new THREE.Matrix4,h={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},d=new THREE.WebGLRenderTarget(i,a,h);THREE.Math.isPowerOfTwo(i)&&THREE.Math.isPowerOfTwo(a)||(d.texture.generateMipmaps=!1),this.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=n,this.material.uniforms.tDiffuse.value=d.texture,this.material.uniforms.textureMatrix.value=u;var p,f,m,v,g,y,E,x,b=(p=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Matrix4,v=new THREE.Vector3,g=new THREE.Vector3,function(e){return p.setFromMatrixPosition(r.matrixWorld),f.setFromMatrixPosition(e.matrixWorld),v.subVectors(p,f),m.extractRotation(r.matrixWorld),g.set(0,0,1),g.applyMatrix4(m),v.dot(g)<0}),T=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;return function(){r.matrixWorld.decompose(t,n,i),e.set(0,0,1).applyQuaternion(n).normalize(),e.negate(),c.setFromNormalAndCoplanarPoint(e,t)}}(),w=(y=new THREE.Plane,E=new THREE.Vector4,x=new THREE.Vector4,function(e){l.matrixWorld.copy(e.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(e.projectionMatrix),l.far=e.far,y.copy(c),y.applyMatrix4(l.matrixWorldInverse),E.set(y.normal.x,y.normal.y,y.normal.z,y.constant);var t=l.projectionMatrix;x.x=(Math.sign(E.x)+t.elements[8])/t.elements[0],x.y=(Math.sign(E.y)+t.elements[9])/t.elements[5],x.z=-1,x.w=(1+t.elements[10])/t.elements[14],E.multiplyScalar(2/E.dot(x)),t.elements[2]=E.x,t.elements[6]=E.y,t.elements[10]=E.z+1-o,t.elements[14]=E.w});this.onBeforeRender=function(e,t,n){!0!==n.userData.refractor&&!0!=!b(n)&&(T(),function(e){u.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),u.multiply(e.projectionMatrix),u.multiply(e.matrixWorldInverse),u.multiply(r.matrixWorld)}(n),w(n),function(e,t,n){r.visible=!1;var i=e.getRenderTarget(),a=e.vr.enabled,o=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(d),e.clear(),e.render(t,l),e.vr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(i),n.isArrayCamera&&e.state.viewport(n.viewport),r.visible=!0}(e,t,n))},this.getRenderTarget=function(){return d}},THREE.Refractor.prototype=Object.create(THREE.Mesh.prototype),THREE.Refractor.prototype.constructor=THREE.Refractor,THREE.Refractor.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")}},function(e,t){THREE.FresnelShader={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")}},function(e,t){THREE.RGBELoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.type=THREE.UnsignedByteType},THREE.RGBELoader.prototype=Object.create(THREE.DataTextureLoader.prototype),THREE.RGBELoader.prototype._parser=function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},r=function(e,t,r){t=t||1024;for(var n=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));0>(i=s.indexOf("\n"))&&a<t&&n<e.byteLength;)o+=s,a+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<i&&(!1!==r&&(e.pos+=a+i+1),o+s.slice(0,i))},n=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function r(r){e[0]=r;var n=t[0],i=n>>16&32768,a=n>>12&2047,o=n>>23&255;return o<103?i:o>142?(i|=31744,i|=(255==o?0:1)&&8388607&n):o<113?i|=((a|=2048)>>114-o)+(a>>113-o&1):(i|=o-112<<10|a>>1,i+=1&a)}return function(e,t,n,i){var a=e[t+3],o=Math.pow(2,a-128)/255;n[i+0]=r(e[t+0]*o),n[i+1]=r(e[t+1]*o),n[i+2]=r(e[t+2]*o)}}(),i=new Uint8Array(e);i.pos=0;var a,o,s,l,c,u,h=function(e){var n,i,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(n=r(e)))return t(1,"no header found");if(!(i=n.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(c.valid|=1,c.programtype=i[1],c.string+=n+"\n";!1!==(n=r(e));)if(c.string+=n+"\n","#"!==n.charAt(0)){if((i=n.match(a))&&(c.gamma=parseFloat(i[1],10)),(i=n.match(o))&&(c.exposure=parseFloat(i[1],10)),(i=n.match(s))&&(c.valid|=2,c.format=i[1]),(i=n.match(l))&&(c.valid|=4,c.height=parseInt(i[1],10),c.width=parseInt(i[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=n+"\n";return 2&c.valid?4&c.valid?c:t(3,"missing image size specifier"):t(3,"missing format specifier")}(i);if(-1!==h){var d=h.width,p=h.height,f=function(e,r,n){var i,a,o,s,l,c,u,h,d,p,f,m,v,g=r,y=n;if(g<8||g>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(g!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(i=new Uint8Array(4*r*n))||!i.length)return t(4,"unable to allocate buffer space");for(a=0,o=0,h=4*g,v=new Uint8Array(4),c=new Uint8Array(h);y>0&&o<e.byteLength;){if(o+4>e.byteLength)return t(1);if(v[0]=e[o++],v[1]=e[o++],v[2]=e[o++],v[3]=e[o++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return t(3,"bad rgbe scanline format");for(u=0;u<h&&o<e.byteLength;){if((m=(s=e[o++])>128)&&(s-=128),0===s||u+s>h)return t(3,"bad scanline data");if(m)for(l=e[o++],d=0;d<s;d++)c[u++]=l;else c.set(e.subarray(o,o+s),u),u+=s,o+=s}for(p=g,d=0;d<p;d++)f=0,i[a]=c[d+f],f+=g,i[a+1]=c[d+f],f+=g,i[a+2]=c[d+f],f+=g,i[a+3]=c[d+f],a+=4;y--}return i}(i.subarray(i.pos),d,p);if(-1!==f){switch(this.type){case THREE.UnsignedByteType:var m=f,v=THREE.RGBEFormat,g=THREE.UnsignedByteType;break;case THREE.FloatType:for(var y=f.length/4*3,E=new Float32Array(y),x=0;x<y;x++)s=E,l=3*x,c=void 0,u=void 0,c=(a=f)[(o=4*x)+3],u=Math.pow(2,c-128)/255,s[l+0]=a[o+0]*u,s[l+1]=a[o+1]*u,s[l+2]=a[o+2]*u;m=E,v=THREE.RGBFormat,g=THREE.FloatType;break;case THREE.HalfFloatType:y=f.length/4*3;var b=new Uint16Array(y);for(x=0;x<y;x++)n(f,4*x,b,3*x);m=b,v=THREE.RGBFormat,g=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:d,height:p,data:m,header:h.string,gamma:h.gamma,exposure:h.exposure,format:v,type:g}}}return null},THREE.RGBELoader.prototype.setType=function(e){return this.type=e,this},THREE.RGBELoader.prototype.load=function(e,t,r,n){return THREE.DataTextureLoader.prototype.load.call(this,e,function(e,r){switch(e.type){case THREE.UnsignedByteType:e.encoding=THREE.RGBEEncoding,e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case THREE.FloatType:case THREE.HalfFloatType:e.encoding=THREE.LinearEncoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}},function(e,t){THREE.HDRCubeTextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.hdrLoader=new THREE.RGBELoader,this.type=THREE.UnsignedByteType},THREE.HDRCubeTextureLoader.prototype.load=function(e,t,r,n){Array.isArray(e)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setType() instead."),this.setType(e),e=t,t=r,r=n,n=arguments[4]);var i=new THREE.CubeTexture;switch(i.type=this.type,i.type){case THREE.UnsignedByteType:i.encoding=THREE.RGBEEncoding,i.format=THREE.RGBAFormat,i.minFilter=THREE.NearestFilter,i.magFilter=THREE.NearestFilter,i.generateMipmaps=!1;break;case THREE.FloatType:case THREE.HalfFloatType:i.encoding=THREE.LinearEncoding,i.format=THREE.RGBFormat,i.minFilter=THREE.LinearFilter,i.magFilter=THREE.LinearFilter,i.generateMipmaps=!1}var a=this,o=0;function s(t,r,n,s){new THREE.FileLoader(a.manager).setPath(a.path).setResponseType("arraybuffer").load(e[t],function(e){o++;var n=a.hdrLoader._parser(e);if(n){if(void 0!==n.data){var s=new THREE.DataTexture(n.data,n.width,n.height);s.type=i.type,s.encoding=i.encoding,s.format=i.format,s.minFilter=i.minFilter,s.magFilter=i.magFilter,s.generateMipmaps=i.generateMipmaps,i.images[t]=s}6===o&&(i.needsUpdate=!0,r&&r(i))}},n,s)}for(var l=0;l<e.length;l++)s(l,t,r,n);return i},THREE.HDRCubeTextureLoader.prototype.setPath=function(e){return this.path=e,this},THREE.HDRCubeTextureLoader.prototype.setType=function(e){return this.type=e,this.hdrLoader.setType(e),this}},function(e,t){THREE.PMREMGenerator=function(){var e,t=((e=new THREE.ShaderMaterial({defines:{SAMPLES_PER_LEVEL:20},uniforms:{faceIndex:{value:0},roughness:{value:.5},mapSize:{value:.5},envMap:{value:null},tFlip:{value:-1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform int faceIndex;\n\t\t\t\tuniform float roughness;\n\t\t\t\tuniform samplerCube envMap;\n\t\t\t\tuniform float mapSize;\n\t\t\t\tuniform float tFlip;\n\t\t\t\t\n\t\t\t\tfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\t\t\t\t\tfloat a = ggxRoughness + 0.0001;\n\t\t\t\t\ta *= a;\n\t\t\t\t\treturn ( 2.0 / a - 2.0 );\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSamplePhong(vec2 uv, mat3 vecSpace, float specPow) {\n\t\t\t\t\tfloat phi = uv.y * 2.0 * PI;\n\t\t\t\t\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\t\t\t\t\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\t\t\t\t\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\t\t\t\t\treturn vecSpace * sampleDir;\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSampleGGX( vec2 uv, mat3 vecSpace, float Roughness )\n\t\t\t\t{\n\t\t\t\t\tfloat a = Roughness * Roughness;\n\t\t\t\t\tfloat Phi = 2.0 * PI * uv.x;\n\t\t\t\t\tfloat CosTheta = sqrt( (1.0 - uv.y) / ( 1.0 + (a*a - 1.0) * uv.y ) );\n\t\t\t\t\tfloat SinTheta = sqrt( 1.0 - CosTheta * CosTheta );\n\t\t\t\t\treturn vecSpace * vec3(SinTheta * cos( Phi ), SinTheta * sin( Phi ), CosTheta);\n\t\t\t\t}\n\t\t\t\tmat3 matrixFromVector(vec3 n) {\n\t\t\t\t\tfloat a = 1.0 / (1.0 + n.z);\n\t\t\t\t\tfloat b = -n.x * n.y * a;\n\t\t\t\t\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\t\t\t\t\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\t\t\t\t\treturn mat3(b1, b2, n);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec4 testColorMap(float Roughness) {\n\t\t\t\t\tvec4 color;\n\t\t\t\t\tif(faceIndex == 0)\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 1)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 2)\n\t\t\t\t\t\tcolor = vec4(0.0,0.0,1.0,1.0);\n\t\t\t\t\telse if(faceIndex == 3)\n\t\t\t\t\t\tcolor = vec4(1.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 4)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,1.0,1.0);\n\t\t\t\t\telse\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,1.0,1.0);\n\t\t\t\t\tcolor *= ( 1.0 - Roughness );\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec3 sampleDirection;\n\t\t\t\t\tvec2 uv = vUv*2.0 - 1.0;\n\t\t\t\t\tfloat offset = -1.0/mapSize;\n\t\t\t\t\tconst float a = -1.0;\n\t\t\t\t\tconst float b = 1.0;\n\t\t\t\t\tfloat c = -1.0 + offset;\n\t\t\t\t\tfloat d = 1.0 - offset;\n\t\t\t\t\tfloat bminusa = b - a;\n\t\t\t\t\tuv.x = (uv.x - a)/bminusa * d - (uv.x - b)/bminusa * c;\n\t\t\t\t\tuv.y = (uv.y - a)/bminusa * d - (uv.y - b)/bminusa * c;\n\t\t\t\t\tif (faceIndex==0) {\n\t\t\t\t\t\tsampleDirection = vec3(1.0, -uv.y, -uv.x);\n\t\t\t\t\t} else if (faceIndex==1) {\n\t\t\t\t\t\tsampleDirection = vec3(-1.0, -uv.y, uv.x);\n\t\t\t\t\t} else if (faceIndex==2) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, 1.0, uv.y);\n\t\t\t\t\t} else if (faceIndex==3) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -1.0, -uv.y);\n\t\t\t\t\t} else if (faceIndex==4) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -uv.y, 1.0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsampleDirection = vec3(-uv.x, -uv.y, -1.0);\n\t\t\t\t\t}\n\t\t\t\t\tvec3 correctedDirection = vec3( tFlip * sampleDirection.x, sampleDirection.yz );\n\t\t\t\t\tmat3 vecSpace = matrixFromVector( normalize( correctedDirection ) );\n\t\t\t\t\tvec3 rgbColor = vec3(0.0);\n\t\t\t\t\tconst int NumSamples = SAMPLES_PER_LEVEL;\n\t\t\t\t\tvec3 vect;\n\t\t\t\t\tfloat weight = 0.0;\n\t\t\t\t\tfor( int i = 0; i < NumSamples; i ++ ) {\n\t\t\t\t\t\tfloat sini = sin(float(i));\n\t\t\t\t\t\tfloat cosi = cos(float(i));\n\t\t\t\t\t\tfloat r = rand(vec2(sini, cosi));\n\t\t\t\t\t\tvect = ImportanceSampleGGX(vec2(float(i) / float(NumSamples), r), vecSpace, roughness);\n\t\t\t\t\t\tfloat dotProd = dot(vect, normalize(sampleDirection));\n\t\t\t\t\t\tweight += dotProd;\n\t\t\t\t\t\tvec3 color = envMapTexelToLinear(textureCube(envMap, vect)).rgb;\n\t\t\t\t\t\trgbColor.rgb += color;\n\t\t\t\t\t}\n\t\t\t\t\trgbColor /= float(NumSamples);\n\t\t\t\t\t//rgbColor = testColorMap( roughness ).rgb;\n\t\t\t\t\tgl_FragColor = linearToOutputTexel( vec4( rgbColor, 1.0 ) );\n\t\t\t\t}",blending:THREE.NoBlending})).type="PMREMGenerator",e),r=new THREE.OrthographicCamera(-1,1,1,-1,0,1e3),n=new THREE.Scene,i=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2,0),t);i.material.side=THREE.DoubleSide,n.add(i),n.add(r);var a=function(e,t,r){this.sourceTexture=e,this.resolution=void 0!==r?r:256,this.samplesPerLevel=void 0!==t?t:32;var n=this.sourceTexture.encoding===THREE.LinearEncoding||this.sourceTexture.encoding===THREE.GammaEncoding||this.sourceTexture.encoding===THREE.sRGBEncoding;this.sourceTexture.minFilter=n?THREE.LinearFilter:THREE.NearestFilter,this.sourceTexture.magFilter=n?THREE.LinearFilter:THREE.NearestFilter,this.sourceTexture.generateMipmaps=this.sourceTexture.generateMipmaps&&n,this.cubeLods=[];var i=this.resolution,a={format:this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.numLods=Math.log(i)/Math.log(2)-2;for(var o=0;o<this.numLods;o++){var s=new THREE.WebGLRenderTargetCube(i,i,a);s.texture.name="PMREMGenerator.cube"+o,this.cubeLods.push(s),i=Math.max(16,i/2)}};return a.prototype={constructor:a,update:function(e){var r=this.sourceTexture.isCubeTexture?-1:1;t.defines.SAMPLES_PER_LEVEL=this.samplesPerLevel,t.uniforms.faceIndex.value=0,t.uniforms.envMap.value=this.sourceTexture,t.envMap=this.sourceTexture,t.needsUpdate=!0;var n=e.gammaInput,i=e.gammaOutput,a=e.toneMapping,o=e.toneMappingExposure,s=e.getRenderTarget();e.toneMapping=THREE.LinearToneMapping,e.toneMappingExposure=1,e.gammaInput=!1,e.gammaOutput=!1;for(var l=0;l<this.numLods;l++){var c=l/(this.numLods-1);t.uniforms.roughness.value=.9*c,t.uniforms.tFlip.value=0==l?r:1;var u=this.cubeLods[l].width;t.uniforms.mapSize.value=u,this.renderToCubeMapTarget(e,this.cubeLods[l]),l<5&&(t.uniforms.envMap.value=this.cubeLods[l].texture)}e.setRenderTarget(s),e.toneMapping=a,e.toneMappingExposure=o,e.gammaInput=n,e.gammaOutput=i},renderToCubeMapTarget:function(e,t){for(var r=0;r<6;r++)this.renderToCubeMapTargetFace(e,t,r)},renderToCubeMapTargetFace:function(e,i,a){t.uniforms.faceIndex.value=a,e.setRenderTarget(i,a),e.clear(),e.render(n,r)},dispose:function(){for(var e=0,t=this.cubeLods.length;e<t;e++)this.cubeLods[e].dispose()}},a}()},function(e,t){var r,n,i,a,o;THREE.PMREMCubeUVPacker=(n=new THREE.OrthographicCamera,i=new THREE.Scene,(r=new THREE.ShaderMaterial({uniforms:{faceIndex:{value:0},mapSize:{value:0},envMap:{value:null},testColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"precision highp float;        varying vec2 vUv;        void main() {          vUv = uv;          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );        }",fragmentShader:"precision highp float;        varying vec2 vUv;        uniform samplerCube envMap;        uniform float mapSize;        uniform vec3 testColor;        uniform int faceIndex;                void main() {          vec3 sampleDirection;          vec2 uv = vUv;          uv = uv * 2.0 - 1.0;          uv.y *= -1.0;          if(faceIndex == 0) {            sampleDirection = normalize(vec3(1.0, uv.y, -uv.x));          } else if(faceIndex == 1) {            sampleDirection = normalize(vec3(uv.x, 1.0, uv.y));          } else if(faceIndex == 2) {            sampleDirection = normalize(vec3(uv.x, uv.y, 1.0));          } else if(faceIndex == 3) {            sampleDirection = normalize(vec3(-1.0, uv.y, uv.x));          } else if(faceIndex == 4) {            sampleDirection = normalize(vec3(uv.x, -1.0, -uv.y));          } else {            sampleDirection = normalize(vec3(-uv.x, uv.y, -1.0));          }          vec4 color = envMapTexelToLinear( textureCube( envMap, sampleDirection ) );          gl_FragColor = linearToOutputTexel( color );        }",blending:THREE.NoBlending})).type="PMREMCubeUVPacker",a=r,(o=function(e){this.cubeLods=e;var t=4*e[0].width,r=e[0].texture,n={format:r.format,magFilter:r.magFilter,minFilter:r.minFilter,type:r.type,generateMipmaps:r.generateMipmaps,anisotropy:r.anisotropy,encoding:r.encoding===THREE.RGBEEncoding?THREE.RGBM16Encoding:r.encoding};n.encoding===THREE.RGBM16Encoding&&(n.magFilter=THREE.LinearFilter,n.minFilter=THREE.LinearFilter),this.CubeUVRenderTarget=new THREE.WebGLRenderTarget(t,t,n),this.CubeUVRenderTarget.texture.name="PMREMCubeUVPacker.cubeUv",this.CubeUVRenderTarget.texture.mapping=THREE.CubeUVReflectionMapping,this.objects=[];var i=new THREE.PlaneBufferGeometry(1,1),o=[];o.push(new THREE.Vector2(0,0)),o.push(new THREE.Vector2(1,0)),o.push(new THREE.Vector2(2,0)),o.push(new THREE.Vector2(0,1)),o.push(new THREE.Vector2(1,1)),o.push(new THREE.Vector2(2,1));var s=t;t=e[0].width;var l=0,c=4;this.numLods=Math.log(e[0].width)/Math.log(2)-2;for(var u=0;u<this.numLods;u++){var h=.5*(s-s/c);t>16&&(c*=2);for(var d=t>16?6:1,p=0,f=0,m=t,v=0;v<d;v++){for(var g=0;g<6;g++){var y=a.clone();y.uniforms.envMap.value=this.cubeLods[u].texture,y.envMap=this.cubeLods[u].texture,y.uniforms.faceIndex.value=g,y.uniforms.mapSize.value=m;var E=new THREE.Mesh(i,y);E.position.x=o[g].x*m-h+p,E.position.y=o[g].y*m-h+l+f,E.material.side=THREE.BackSide,E.scale.setScalar(m),this.objects.push(E)}f+=1.75*m,p+=1.25*m,m/=2}l+=2*t,t>16&&(t/=2)}}).prototype={constructor:o,update:function(e){var t=4*this.cubeLods[0].width;n.left=.5*-t,n.right=.5*t,n.top=.5*-t,n.bottom=.5*t,n.near=0,n.far=1,n.updateProjectionMatrix();for(var r=0;r<this.objects.length;r++)i.add(this.objects[r]);var a=e.gammaInput,o=e.gammaOutput,s=e.toneMapping,l=e.toneMappingExposure,c=e.getRenderTarget();for(e.gammaInput=!1,e.gammaOutput=!1,e.toneMapping=THREE.LinearToneMapping,e.toneMappingExposure=1,e.setRenderTarget(this.CubeUVRenderTarget),e.render(i,n),e.setRenderTarget(c),e.toneMapping=s,e.toneMappingExposure=l,e.gammaInput=a,e.gammaOutput=o,r=0;r<this.objects.length;r++)i.remove(this.objects[r])},dispose:function(){for(var e=0,t=this.objects.length;e<t;e++)this.objects[e].material.dispose();this.objects[0].geometry.dispose()}},o)},function(e,t){THREE.LegacyJSONLoader=function(){function e(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.withCredentials=!1}return Object.assign(e.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setWithCredentials(this.withCredentials),o.load(e,function(r){var n=JSON.parse(r),o=n.metadata;if(void 0!==o){var s=o.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(n,a);t(l.geometry,l.materials)},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var r=new THREE.Geometry;return function(e,t){function r(e,t){return e&1<<t}var n,i,a,o,s,l,c,u,h,d,p,f,m,v,g,y,E,x,b,T,w,_,R,M,S,A,P,L=e.faces,C=e.vertices,H=e.normals,I=e.colors,k=e.scale,O=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&O++;for(n=0;n<O;n++)t.faceVertexUvs[n]=[]}for(o=0,s=C.length;o<s;)(x=new THREE.Vector3).x=C[o++]*k,x.y=C[o++]*k,x.z=C[o++]*k,t.vertices.push(x);for(o=0,s=L.length;o<s;)if(p=r(d=L[o++],0),f=r(d,1),m=r(d,3),v=r(d,4),g=r(d,5),y=r(d,6),E=r(d,7),p){if((T=new THREE.Face3).a=L[o],T.b=L[o+1],T.c=L[o+3],(w=new THREE.Face3).a=L[o+1],w.b=L[o+2],w.c=L[o+3],o+=4,f&&(h=L[o++],T.materialIndex=h,w.materialIndex=h),a=t.faces.length,m)for(n=0;n<O;n++)for(M=e.uvs[n],t.faceVertexUvs[n][a]=[],t.faceVertexUvs[n][a+1]=[],i=0;i<4;i++)A=M[2*(u=L[o++])],P=M[2*u+1],S=new THREE.Vector2(A,P),2!==i&&t.faceVertexUvs[n][a].push(S),0!==i&&t.faceVertexUvs[n][a+1].push(S);if(v&&(c=3*L[o++],T.normal.set(H[c++],H[c++],H[c]),w.normal.copy(T.normal)),g)for(n=0;n<4;n++)c=3*L[o++],R=new THREE.Vector3(H[c++],H[c++],H[c]),2!==n&&T.vertexNormals.push(R),0!==n&&w.vertexNormals.push(R);if(y&&(_=I[l=L[o++]],T.color.setHex(_),w.color.setHex(_)),E)for(n=0;n<4;n++)_=I[l=L[o++]],2!==n&&T.vertexColors.push(new THREE.Color(_)),0!==n&&w.vertexColors.push(new THREE.Color(_));t.faces.push(T),t.faces.push(w)}else{if((b=new THREE.Face3).a=L[o++],b.b=L[o++],b.c=L[o++],f&&(h=L[o++],b.materialIndex=h),a=t.faces.length,m)for(n=0;n<O;n++)for(M=e.uvs[n],t.faceVertexUvs[n][a]=[],i=0;i<3;i++)A=M[2*(u=L[o++])],P=M[2*u+1],S=new THREE.Vector2(A,P),t.faceVertexUvs[n][a].push(S);if(v&&(c=3*L[o++],b.normal.set(H[c++],H[c++],H[c])),g)for(n=0;n<3;n++)c=3*L[o++],R=new THREE.Vector3(H[c++],H[c++],H[c]),b.vertexNormals.push(R);if(y&&(l=L[o++],b.color.setHex(I[l])),E)for(n=0;n<3;n++)l=L[o++],b.vertexColors.push(new THREE.Color(I[l]));t.faces.push(b)}}(e,r),function(e,t){var r=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,i=e.skinWeights.length;n<i;n+=r){var a=e.skinWeights[n],o=r>1?e.skinWeights[n+1]:0,s=r>2?e.skinWeights[n+2]:0,l=r>3?e.skinWeights[n+3]:0;t.skinWeights.push(new THREE.Vector4(a,o,s,l))}if(e.skinIndices)for(n=0,i=e.skinIndices.length;n<i;n+=r){var c=e.skinIndices[n],u=r>1?e.skinIndices[n+1]:0,h=r>2?e.skinIndices[n+2]:0,d=r>3?e.skinIndices[n+3]:0;t.skinIndices.push(new THREE.Vector4(c,u,h,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,r),function(e,t){var r=e.scale;if(void 0!==e.morphTargets)for(var n=0,i=e.morphTargets.length;n<i;n++){t.morphTargets[n]={},t.morphTargets[n].name=e.morphTargets[n].name,t.morphTargets[n].vertices=[];for(var a=t.morphTargets[n].vertices,o=e.morphTargets[n].vertices,s=0,l=o.length;s<l;s+=3){var c=new THREE.Vector3;c.x=o[s]*r,c.y=o[s+1]*r,c.z=o[s+2]*r,a.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var u=t.faces,h=e.morphColors[0].colors;for(n=0,i=u.length;n<i;n++)u[n].color.fromArray(h,3*n)}}(e,r),function(e,t){var r=[],n=[];void 0!==e.animation&&n.push(e.animation),void 0!==e.animations&&(e.animations.length?n=n.concat(e.animations):n.push(e.animations));for(var i=0;i<n.length;i++){var a=THREE.AnimationClip.parseAnimation(n[i],t.bones);a&&r.push(a)}if(t.morphTargets){var o=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);r=r.concat(o)}r.length>0&&(t.animations=r)}(e,r),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:r}:{geometry:r,materials:THREE.Loader.prototype.initMaterials(e.materials,this.resourcePath||t,this.crossOrigin)}}}),e}()},function(e,t){THREE.OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,r=/^usemtl /;function n(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addColor:function(e,t,r){var n=this.colors,i=this.object.geometry.colors;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]),i.push(n[t+0],n[t+1]),i.push(n[r+0],n[r+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,i,a,o,s,l){var c=this.vertices.length,u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(r,c);if(this.addVertex(u,h,d),void 0!==n&&""!==n){var p=this.uvs.length;u=this.parseUVIndex(n,p),h=this.parseUVIndex(i,p),d=this.parseUVIndex(a,p),this.addUV(u,h,d)}if(void 0!==o&&""!==o){var f=this.normals.length;u=this.parseNormalIndex(o,f),h=o===s?u:this.parseNormalIndex(s,f),d=o===l?u:this.parseNormalIndex(l,f),this.addNormal(u,h,d)}this.colors.length>0&&this.addColor(u,h,d)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,n=e.length;r<n;r++)this.addVertexPoint(this.parseVertexIndex(e[r],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,a=e.length;i<a;i++)this.addVertexLine(this.parseVertexIndex(e[i],r));var o=0;for(a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],n))}};return e.startObject("",!1),e}function i(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null}return i.prototype={constructor:i,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(this.path),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(i){console.time("OBJLoader");var a=new n;-1!==i.indexOf("\r\n")&&(i=i.replace(/\r\n/g,"\n")),-1!==i.indexOf("\\\n")&&(i=i.replace(/\\\n/g,""));for(var o=i.split("\n"),s="",l="",c=[],u="function"==typeof"".trimLeft,h=0,d=o.length;h<d;h++)if(s=o[h],0!==(s=u?s.trimLeft():s.trim()).length&&"#"!==(l=s.charAt(0)))if("v"===l){var p=s.split(/\s+/);switch(p[0]){case"v":a.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),7===p.length&&a.colors.push(parseFloat(p[4]/255),parseFloat(p[5]/255),parseFloat(p[6]/255));break;case"vn":a.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":a.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===l){for(var f=s.substr(1).trim().split(/\s+/),m=[],v=0,g=f.length;v<g;v++){var y=f[v];if(y.length>0){var E=y.split("/");m.push(E)}}var x=m[0];for(v=1,g=m.length-1;v<g;v++){var b=m[v],T=m[v+1];a.addFace(x[0],b[0],T[0],x[1],b[1],T[1],x[2],b[2],T[2])}}else if("l"===l){var w=s.substring(1).trim().split(" "),_=[],R=[];if(-1===s.indexOf("/"))_=w;else for(var M=0,S=w.length;M<S;M++){var A=w[M].split("/");""!==A[0]&&_.push(A[0]),""!==A[1]&&R.push(A[1])}a.addLineGeometry(_,R)}else if("p"===l){var P=s.substr(1).trim().split(" ");a.addPointGeometry(P)}else if(null!==(c=e.exec(s))){var L=(" "+c[0].substr(1).trim()).substr(1);a.startObject(L)}else if(r.test(s))a.object.startMaterial(s.substring(7).trim(),a.materialLibraries);else if(t.test(s))a.materialLibraries.push(s.substring(7).trim());else{if("s"!==l){if("\0"===s)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+s+'"')}if((c=s.split(" ")).length>1){var C=c[1].trim().toLowerCase();a.object.smooth="0"!==C&&"off"!==C}else a.object.smooth=!0;(W=a.object.currentMaterial())&&(W.smooth=a.object.smooth)}a.finalize();var H=new THREE.Group;H.materialLibraries=[].concat(a.materialLibraries);for(h=0,d=a.objects.length;h<d;h++){var I=a.objects[h],k=I.geometry,O=I.materials,N="Line"===k.type,F="Points"===k.type,D=!1;if(0!==k.vertices.length){var z=new THREE.BufferGeometry;z.addAttribute("position",new THREE.Float32BufferAttribute(k.vertices,3)),k.normals.length>0?z.addAttribute("normal",new THREE.Float32BufferAttribute(k.normals,3)):z.computeVertexNormals(),k.colors.length>0&&(D=!0,z.addAttribute("color",new THREE.Float32BufferAttribute(k.colors,3))),k.uvs.length>0&&z.addAttribute("uv",new THREE.Float32BufferAttribute(k.uvs,2));for(var U,B=[],G=0,V=O.length;G<V;G++){var j=O[G],W=void 0;if(null!==this.materials)if(W=this.materials.create(j.name),!N||!W||W instanceof THREE.LineBasicMaterial){if(F&&W&&!(W instanceof THREE.PointsMaterial)){var X=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});THREE.Material.prototype.copy.call(X,W),X.color.copy(W.color),X.map=W.map,X.lights=!1,W=X}}else{var Y=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(Y,W),Y.color.copy(W.color),Y.lights=!1,W=Y}W||((W=N?new THREE.LineBasicMaterial:F?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=j.name),W.flatShading=!j.smooth,W.vertexColors=D?THREE.VertexColors:THREE.NoColors,B.push(W)}if(B.length>1){for(G=0,V=O.length;G<V;G++){j=O[G];z.addGroup(j.groupStart,j.groupCount,G)}U=N?new THREE.LineSegments(z,B):F?new THREE.Points(z,B):new THREE.Mesh(z,B)}else U=N?new THREE.LineSegments(z,B[0]):F?new THREE.Points(z,B[0]):new THREE.Mesh(z,B[0]);U.name=I.name,H.add(U)}}return console.timeEnd("OBJLoader"),H}},i}()},function(e,t){THREE.OBJExporter=function(){},THREE.OBJExporter.prototype={constructor:THREE.OBJExporter,parse:function(e){var t,r,n,i,a,o="",s=0,l=0,c=0,u=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Vector2,p=[];return e.traverse(function(e){e instanceof THREE.Mesh&&function(e){var n=0,f=0,m=0,v=e.geometry,g=new THREE.Matrix3;if(v instanceof THREE.Geometry&&(v=(new THREE.BufferGeometry).setFromObject(e)),v instanceof THREE.BufferGeometry){var y=v.getAttribute("position"),E=v.getAttribute("normal"),x=v.getAttribute("uv"),b=v.getIndex();if(o+="o "+e.name+"\n",e.material&&e.material.name&&(o+="usemtl "+e.material.name+"\n"),void 0!==y)for(t=0,i=y.count;t<i;t++,n++)u.x=y.getX(t),u.y=y.getY(t),u.z=y.getZ(t),u.applyMatrix4(e.matrixWorld),o+="v "+u.x+" "+u.y+" "+u.z+"\n";if(void 0!==x)for(t=0,i=x.count;t<i;t++,m++)d.x=x.getX(t),d.y=x.getY(t),o+="vt "+d.x+" "+d.y+"\n";if(void 0!==E)for(g.getNormalMatrix(e.matrixWorld),t=0,i=E.count;t<i;t++,f++)h.x=E.getX(t),h.y=E.getY(t),h.z=E.getZ(t),h.applyMatrix3(g),o+="vn "+h.x+" "+h.y+" "+h.z+"\n";if(null!==b)for(t=0,i=b.count;t<i;t+=3){for(a=0;a<3;a++)r=b.getX(t+a)+1,p[a]=s+r+(E||x?"/"+(x?l+r:"")+(E?"/"+(c+r):""):"");o+="f "+p.join(" ")+"\n"}else for(t=0,i=y.count;t<i;t+=3){for(a=0;a<3;a++)r=t+a+1,p[a]=s+r+(E||x?"/"+(x?l+r:"")+(E?"/"+(c+r):""):"");o+="f "+p.join(" ")+"\n"}}else console.warn("THREE.OBJExporter.parseMesh(): geometry type unsupported",v);s+=n,l+=m,c+=f}(e),e instanceof THREE.Line&&function(e){var a=0,l=e.geometry,c=e.type;if(l instanceof THREE.Geometry&&(l=(new THREE.BufferGeometry).setFromObject(e)),l instanceof THREE.BufferGeometry){var h=l.getAttribute("position");if(o+="o "+e.name+"\n",void 0!==h)for(t=0,i=h.count;t<i;t++,a++)u.x=h.getX(t),u.y=h.getY(t),u.z=h.getZ(t),u.applyMatrix4(e.matrixWorld),o+="v "+u.x+" "+u.y+" "+u.z+"\n";if("Line"===c){for(o+="l ",r=1,i=h.count;r<=i;r++)o+=s+r+" ";o+="\n"}if("LineSegments"===c)for(n=1+(r=1),i=h.count;r<i;n=(r+=2)+1)o+="l "+(s+r)+" "+(s+n)+"\n"}else console.warn("THREE.OBJExporter.parseLine(): geometry type unsupported",l);s+=a}(e)}),o}}},function(e,t){THREE.MTLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===this.path?THREE.LoaderUtils.extractUrlBase(e):this.path,o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.load(e,function(e){t(i.parse(e,a))},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setTexturePath:function(e){return console.warn("THREE.MTLLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var r=e.split("\n"),n={},i=/\s+/,a={},o=0;o<r.length;o++){var s=r[o];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var l=s.indexOf(" "),c=l>=0?s.substring(0,l):s;c=c.toLowerCase();var u=l>=0?s.substring(l+1):"";if(u=u.trim(),"newmtl"===c)n={name:u},a[u]=n;else if("ka"===c||"kd"===c||"ks"===c||"ke"===c){var h=u.split(i,3);n[c]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else n[c]=u}}var d=new THREE.MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(a),d}},THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var n=e[r],i={};for(var a in t[r]=i,n){var o=!0,s=n[a],l=a.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(i[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,r=this.materialsInfo[e],n={name:e,side:this.side};function i(e,r){if(!n[e]){var i,a,o=t.getTextureParams(r,n),s=t.loadTexture((i=t.baseUrl,"string"!=typeof(a=o.url)||""===a?"":/^https?:\/\//i.test(a)?a:i+a));s.repeat.copy(o.scale),s.offset.copy(o.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,n[e]=s}}for(var a in r){var o,s=r[a];if(""!==s)switch(a.toLowerCase()){case"kd":n.color=(new THREE.Color).fromArray(s);break;case"ks":n.specular=(new THREE.Color).fromArray(s);break;case"ke":n.emissive=(new THREE.Color).fromArray(s);break;case"map_kd":i("map",s);break;case"map_ks":i("specularMap",s);break;case"map_ke":i("emissiveMap",s);break;case"norm":i("normalMap",s);break;case"map_bump":case"bump":i("bumpMap",s);break;case"map_d":i("alphaMap",s),n.transparent=!0;break;case"ns":n.shininess=parseFloat(s);break;case"d":(o=parseFloat(s))<1&&(n.opacity=o,n.transparent=!0);break;case"tr":o=parseFloat(s),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(n.opacity=1-o,n.transparent=!0)}}return this.materials[e]=new THREE.MeshPhongMaterial(n),this.materials[e]},getTextureParams:function(e,t){var r,n={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},i=e.split(/\s+/);return(r=i.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),(r=i.indexOf("-s"))>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),(r=i.indexOf("-o"))>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n},loadTexture:function(e,t,r,n,i){var a,o=THREE.Loader.Handlers.get(e),s=void 0!==this.manager?this.manager:THREE.DefaultLoadingManager;return null===o&&(o=new THREE.TextureLoader(s)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin),a=o.load(e,r,n,i),void 0!==t&&(a.mapping=t),a}}},function(e,t){THREE.STLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.STLLoader.prototype={constructor:THREE.STLLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){try{t(i.parse(e))}catch(e){n&&n(e)}},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e,t,r){for(var n=0,i=e.length;n<i;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}var r,n=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){var r;if(84+50*(r=new DataView(e)).getUint32(80,!0)===r.byteLength)return!0;for(var n=[115,111,108,105,100],i=0;i<5;i++)if(t(n,r,i))return!1;return!0}(n)?function(e){for(var t,r,n,i,a,o,s,l,c=new DataView(e),u=c.getUint32(80,!0),h=!1,d=0;d<70;d++)1129270351==c.getUint32(d,!1)&&82==c.getUint8(d+4)&&61==c.getUint8(d+5)&&(h=!0,i=[],a=c.getUint8(d+6)/255,o=c.getUint8(d+7)/255,s=c.getUint8(d+8)/255,l=c.getUint8(d+9)/255);for(var p=new THREE.BufferGeometry,f=[],m=[],v=0;v<u;v++){var g=84+50*v,y=c.getFloat32(g,!0),E=c.getFloat32(g+4,!0),x=c.getFloat32(g+8,!0);if(h){var b=c.getUint16(g+48,!0);0==(32768&b)?(t=(31&b)/31,r=(b>>5&31)/31,n=(b>>10&31)/31):(t=a,r=o,n=s)}for(var T=1;T<=3;T++){var w=g+12*T;f.push(c.getFloat32(w,!0)),f.push(c.getFloat32(w+4,!0)),f.push(c.getFloat32(w+8,!0)),m.push(y,E,x),h&&i.push(t,r,n)}}return p.addAttribute("position",new THREE.BufferAttribute(new Float32Array(f),3)),p.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(m),3)),h&&(p.addAttribute("color",new THREE.BufferAttribute(new Float32Array(i),3)),p.hasColors=!0,p.alpha=l),p}(n):function(e){for(var t,r=new THREE.BufferGeometry,n=/facet([\s\S]*?)endfacet/g,i=0,a=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,o=new RegExp("vertex"+a+a+a,"g"),s=new RegExp("normal"+a+a+a,"g"),l=[],c=[],u=new THREE.Vector3;null!==(t=n.exec(e));){for(var h=0,d=0,p=t[0];null!==(t=s.exec(p));)u.x=parseFloat(t[1]),u.y=parseFloat(t[2]),u.z=parseFloat(t[3]),d++;for(;null!==(t=o.exec(p));)l.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),c.push(u.x,u.y,u.z),h++;1!==d&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+i),3!==h&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+i),i++}return r.addAttribute("position",new THREE.Float32BufferAttribute(l,3)),r.addAttribute("normal",new THREE.Float32BufferAttribute(c,3)),r}("string"!=typeof(r=e)?THREE.LoaderUtils.decodeText(new Uint8Array(r)):r)}}},function(e,t){var r,n;THREE.STLExporter=function(){},THREE.STLExporter.prototype={constructor:THREE.STLExporter,parse:(r=new THREE.Vector3,n=new THREE.Matrix3,function(e,t){void 0===t&&(t={});var i=void 0!==t.binary&&t.binary,a=[],o=0;if(e.traverse(function(e){if(e.isMesh){var t=e.geometry;t.isBufferGeometry&&(t=(new THREE.Geometry).fromBufferGeometry(t)),t.isGeometry&&(o+=t.faces.length,a.push({geometry:t,matrixWorld:e.matrixWorld}))}}),i){var s=80,l=new ArrayBuffer(2*o+3*o*4*4+80+4);(E=new DataView(l)).setUint32(s,o,!0),s+=4;for(var c=0,u=a.length;c<u;c++){var h=(x=a[c]).geometry.vertices,d=x.geometry.faces,p=x.matrixWorld;n.getNormalMatrix(p);for(var f=0,m=d.length;f<m;f++){var v=d[f];r.copy(v.normal).applyMatrix3(n).normalize(),E.setFloat32(s,r.x,!0),s+=4,E.setFloat32(s,r.y,!0),s+=4,E.setFloat32(s,r.z,!0),s+=4;for(var g=[v.a,v.b,v.c],y=0;y<3;y++)r.copy(h[g[y]]).applyMatrix4(p),E.setFloat32(s,r.x,!0),s+=4,E.setFloat32(s,r.y,!0),s+=4,E.setFloat32(s,r.z,!0),s+=4;E.setUint16(s,0,!0),s+=2}}return E}var E="";for(E+="solid exported\n",c=0,u=a.length;c<u;c++){var x;for(h=(x=a[c]).geometry.vertices,d=x.geometry.faces,p=x.matrixWorld,n.getNormalMatrix(p),f=0,m=d.length;f<m;f++){for(v=d[f],r.copy(v.normal).applyMatrix3(n).normalize(),E+="\tfacet normal "+r.x+" "+r.y+" "+r.z+"\n",E+="\t\touter loop\n",g=[v.a,v.b,v.c],y=0;y<3;y++)r.copy(h[g[y]]).applyMatrix4(p),E+="\t\t\tvertex "+r.x+" "+r.y+" "+r.z+"\n";E+="\t\tendloop\n",E+="\tendfacet\n"}}return E+="endsolid exported\n"})}},function(e,t){THREE.PLYLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",r=0,n=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==n&&(t=n[1],r=n[0].length);var i,a,o,s,l,c,h={comments:[],elements:[],headerLength:r},d=t.split("\n");for(var p=0;p<d.length;p++){var f=d[p];if(""!==(f=f.trim()))switch(a=(o=f.split(/\s+/)).shift(),f=o.join(" "),a){case"format":h.format=o[0],h.version=o[1];break;case"comment":h.comments.push(f);break;case"element":void 0!==i&&h.elements.push(i),(i={}).name=o[0],i.count=parseInt(o[1]),i.properties=[];break;case"property":i.properties.push((s=o,l=u.propertyNameMapping,c=void 0,"list"===(c={type:s[0]}).type?(c.name=s[3],c.countType=s[1],c.itemType=s[2]):c.name=s[1],c.name in l&&(c.name=l[c.name]),c));break;default:console.log("unhandled",a,o)}}return void 0!==i&&h.elements.push(i),h}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function n(e,t){for(var n=t.split(/\s+/),i={},a=0;a<e.length;a++)if("list"===e[a].type){for(var o=[],s=r(n.shift(),e[a].countType),l=0;l<s;l++)o.push(r(n.shift(),e[a].itemType));i[e[a].name]=o}else i[e[a].name]=r(n.shift(),e[a].type);return i}function i(e,t){var r,i={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},s="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(s=r[1]);for(var l=s.split("\n"),c=0,u=0,h=0;h<l.length;h++){var d=l[h];if(""!==(d=d.trim())){u>=t.elements[c].count&&(c++,u=0);var p=n(t.elements[c].properties,d);o(i,t.elements[c].name,p),u++}}return a(i)}function a(e){var t=new THREE.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).addAttribute("uv",new THREE.Float32BufferAttribute(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function o(e,t,r){if("vertex"===t)e.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&e.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r&&e.uvs.push(r.s,r.t),"red"in r&&"green"in r&&"blue"in r&&e.colors.push(r.red/255,r.green/255,r.blue/255);else if("face"===t){var n=r.vertex_indices||r.vertex_index,i=r.texcoord;3===n.length?(e.indices.push(n[0],n[1],n[2]),i&&6===i.length&&(e.faceVertexUvs.push(i[0],i[1]),e.faceVertexUvs.push(i[2],i[3]),e.faceVertexUvs.push(i[4],i[5]))):4===n.length&&(e.indices.push(n[0],n[1],n[3]),e.indices.push(n[1],n[2],n[3]))}}function s(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}}function l(e,t,r,n){for(var i,a={},o=0,l=0;l<r.length;l++)if("list"===r[l].type){var c=[],u=(i=s(e,t+o,r[l].countType,n))[0];o+=i[1];for(var h=0;h<u;h++)i=s(e,t+o,r[l].itemType,n),c.push(i[0]),o+=i[1];a[r[l].name]=c}else i=s(e,t+o,r[l].type,n),a[r[l].name]=i[0],o+=i[1];return[a,o]}var c,u=this;if(e instanceof ArrayBuffer){var h=THREE.LoaderUtils.decodeText(new Uint8Array(e)),d=t(h);c="ascii"===d.format?i(h,d):function(e,t){for(var r,n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},i="binary_little_endian"===t.format,s=new DataView(e,t.headerLength),c=0,u=0;u<t.elements.length;u++)for(var h=0;h<t.elements[u].count;h++){c+=(r=l(s,c,t.elements[u].properties,i))[1];var d=r[0];o(n,t.elements[u].name,d)}return a(n)}(e,d)}else c=i(e,t(e));return c}}},function(e,t){THREE.PLYExporter=function(){},THREE.PLYExporter.prototype={constructor:THREE.PLYExporter,parse:function(e,t,r){function n(t){e.traverse(function(e){if(!0===e.isMesh){var r=e,n=r.geometry;!0===n.isGeometry&&(n=a.get(n)),!0===n.isBufferGeometry&&void 0!==n.getAttribute("position")&&t(r,n)}})}t&&"object"==typeof t&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),r=t,t=void 0);var i=(r=Object.assign({binary:!1,excludeAttributes:[]},r)).excludeAttributes,a=new WeakMap,o=!1,s=!1,l=!1,c=0,u=0;e.traverse(function(e){if(!0===e.isMesh){var t=e,r=t.geometry;if(!0===r.isGeometry){var n=a.get(r)||(new THREE.BufferGeometry).setFromObject(t);a.set(r,n),r=n}if(!0===r.isBufferGeometry){var i=r.getAttribute("position"),h=r.getAttribute("normal"),d=r.getAttribute("uv"),p=r.getAttribute("color"),f=r.getIndex();if(void 0===i)return;c+=i.count,u+=f?f.count/3:i.count/3,void 0!==h&&(o=!0),void 0!==d&&(l=!0),void 0!==p&&(s=!0)}}});var h=-1===i.indexOf("index");if(o=o&&-1===i.indexOf("normal"),s=s&&-1===i.indexOf("color"),l=l&&-1===i.indexOf("uv"),h&&u!==Math.floor(u))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;var d=1;c>256&&(d=2),c>65536&&(d=4);var p="ply\n"+`format ${r.binary?"binary_big_endian":"ascii"} 1.0\n`+`element vertex ${c}\n`+"property float x\nproperty float y\nproperty float z\n";!0===o&&(p+="property float nx\nproperty float ny\nproperty float nz\n"),!0===l&&(p+="property float s\nproperty float t\n"),!0===s&&(p+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===h&&(p+=`element face ${u}\n`+`property list uchar uint${8*d} vertex_index\n`),p+="end_header\n";var f=new THREE.Vector3,m=new THREE.Matrix3,v=null;if(!0===r.binary){var g=(new TextEncoder).encode(p),y=c*(12+(o?12:0)+(s?3:0)+(l?8:0)),E=h?u*(3*d+1):0,x=new DataView(new ArrayBuffer(g.length+y+E));new Uint8Array(x.buffer).set(g,0);var b=g.length,T=g.length+y,w=0;n(function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),i=t.getAttribute("uv"),a=t.getAttribute("color"),c=t.getIndex();m.getNormalMatrix(e.matrixWorld);for(var u=0,p=r.count;u<p;u++)f.x=r.getX(u),f.y=r.getY(u),f.z=r.getZ(u),f.applyMatrix4(e.matrixWorld),x.setFloat32(b,f.x),b+=4,x.setFloat32(b,f.y),b+=4,x.setFloat32(b,f.z),b+=4,!0===o&&(null!=n?(f.x=n.getX(u),f.y=n.getY(u),f.z=n.getZ(u),f.applyMatrix3(m),x.setFloat32(b,f.x),b+=4,x.setFloat32(b,f.y),b+=4,x.setFloat32(b,f.z),b+=4):(x.setFloat32(b,0),b+=4,x.setFloat32(b,0),b+=4,x.setFloat32(b,0),b+=4)),!0===l&&(null!=i?(x.setFloat32(b,i.getX(u)),b+=4,x.setFloat32(b,i.getY(u)),b+=4):!1!==l&&(x.setFloat32(b,0),b+=4,x.setFloat32(b,0),b+=4)),!0===s&&(null!=a?(x.setUint8(b,Math.floor(255*a.getX(u))),b+=1,x.setUint8(b,Math.floor(255*a.getY(u))),b+=1,x.setUint8(b,Math.floor(255*a.getZ(u))),b+=1):(x.setUint8(b,255),b+=1,x.setUint8(b,255),b+=1,x.setUint8(b,255),b+=1));if(!0===h){var v=`setUint${8*d}`;if(null!==c)for(u=0,p=c.count;u<p;u+=3)x.setUint8(T,3),T+=1,x[v](T,c.getX(u+0)+w),T+=d,x[v](T,c.getX(u+1)+w),T+=d,x[v](T,c.getX(u+2)+w),T+=d;else for(u=0,p=r.count;u<p;u+=3)x.setUint8(T,3),T+=1,x[v](T,w+u),T+=d,x[v](T,w+u+1),T+=d,x[v](T,w+u+2),T+=d}w+=r.count}),v=x.buffer}else{w=0;var _="",R="";n(function(e,t){var r=t.getAttribute("position"),n=t.getAttribute("normal"),i=t.getAttribute("uv"),a=t.getAttribute("color"),c=t.getIndex();m.getNormalMatrix(e.matrixWorld);for(var d=0,p=r.count;d<p;d++){f.x=r.getX(d),f.y=r.getY(d),f.z=r.getZ(d),f.applyMatrix4(e.matrixWorld);var v=f.x+" "+f.y+" "+f.z;!0===o&&(null!=n?(f.x=n.getX(d),f.y=n.getY(d),f.z=n.getZ(d),f.applyMatrix3(m),v+=" "+f.x+" "+f.y+" "+f.z):v+=" 0 0 0"),!0===l&&(null!=i?v+=" "+i.getX(d)+" "+i.getY(d):!1!==l&&(v+=" 0 0")),!0===s&&(v+=null!=a?" "+Math.floor(255*a.getX(d))+" "+Math.floor(255*a.getY(d))+" "+Math.floor(255*a.getZ(d)):" 255 255 255"),_+=v+"\n"}if(!0===h){if(null!==c)for(d=0,p=c.count;d<p;d+=3)R+=`3 ${c.getX(d+0)+w}`,R+=` ${c.getX(d+1)+w}`,R+=` ${c.getX(d+2)+w}\n`;else for(d=0,p=r.count;d<p;d+=3)R+=`3 ${w+d} ${w+d+1} ${w+d+2}\n`;u+=c?c.count/3:r.count/3}w+=r.count}),v=`${p}${_}\n${h?`${R}\n`:""}`}return"function"==typeof t&&requestAnimationFrame(()=>t(v)),v}}},function(e,t){THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(i.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(e,a))},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function r(e,t){for(var r=[],n=e.childNodes,i=0,a=n.length;i<a;i++){var o=n[i];o.nodeName===t&&r.push(o)}return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=t[n];return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseFloat(t[n]);return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,i=t.length;n<i;n++)r[n]=parseInt(t[n]);return r}function o(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function c(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,n,i){var a=r(e,t)[0];if(void 0!==a)for(var o=r(a,n),s=0;s<o.length;s++)i(o[s])}function h(e,t){for(var r in e){e[r].build=t(e[r])}}function d(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function p(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=o(i.getAttribute("source")),s=i.getAttribute("semantic");t.inputs[s]=a}}return t}function f(e){var t={},r=e.getAttribute("target").split("/"),n=r.shift(),i=r.shift(),a=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)r=i.split("."),i=r.shift(),t.member=r.shift();else if(a){var l=i.split("(");i=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=i,t.arraySyntax=a,t.memberSyntax=s,t.sampler=o(e.getAttribute("source")),t}function m(e){var t=[],r=e.channels,n=e.samplers,i=e.sources;for(var a in r)if(r.hasOwnProperty(a)){var o=r[a],s=n[o.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT;b(g(o,i[l],i[c]),t)}return t}function v(e){return d(Ze.animations[e],m)}function g(e,t,r){var n,i,a,o,s,l,c=Ze.nodes[e.id],u=Oe(c.id),h=c.transforms[e.sid],d=c.matrix.clone().transpose(),p={};switch(h){case"matrix":for(a=0,o=t.array.length;a<o;a++)if(n=t.array[a],i=a*r.stride,void 0===p[n]&&(p[n]={}),!0===e.arraySyntax){var f=r.array[i],m=e.indices[0]+4*e.indices[1];p[n][m]=f}else for(s=0,l=r.stride;s<l;s++)p[n][s]=r.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var v=function(e,t){var r=[];for(var n in e)r.push({time:parseFloat(n),value:e[n]});r.sort(function(e,t){return e.time-t.time});for(var i=0;i<16;i++)T(r,i,t.elements[i]);return r}(p,d);return{name:u.uuid,keyframes:v}}var y=new THREE.Vector3,E=new THREE.Vector3,x=new THREE.Quaternion;function b(e,t){for(var r=e.keyframes,n=e.name,i=[],a=[],o=[],s=[],l=0,c=r.length;l<c;l++){var u=r[l],h=u.time,d=u.value;_e.fromArray(d).transpose(),_e.decompose(y,x,E),i.push(h),a.push(y.x,y.y,y.z),o.push(x.x,x.y,x.z,x.w),s.push(E.x,E.y,E.z)}return a.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",i,a)),o.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",i,o)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",i,s)),t}function T(e,t,r){var n,i,a,o=!0;for(i=0,a=e.length;i<a;i++)void 0===(n=e[i]).value[t]?n.value[t]=null:o=!1;if(!0===o)for(i=0,a=e.length;i<a;i++)(n=e[i]).value[t]=r;else!function(e,t){for(var r,n,i=0,a=e.length;i<a;i++){var o=e[i];if(null===o.value[t]){if(r=w(e,i,t),n=_(e,i,t),null===r){o.value[t]=n.value[t];continue}if(null===n){o.value[t]=r.value[t];continue}R(o,r,n,t)}}}(e,t)}function w(e,t,r){for(;t>=0;){var n=e[t];if(null!==n.value[r])return n;t--}return null}function _(e,t,r){for(;t<e.length;){var n=e[t];if(null!==n.value[r])return n;t++}return null}function R(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function M(e){for(var t=[],r=e.name,n=e.end-e.start||-1,i=e.animations,a=0,o=i.length;a<o;a++)for(var s=v(i[a]),l=0,c=s.length;l<c;l++)t.push(s[l]);return new THREE.AnimationClip(r,n,t)}function S(e){return d(Ze.clips[e],M)}function A(e){for(var t={sources:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(a.textContent);break;case"source":var o=a.getAttribute("id");t.sources[o]=ie(a);break;case"joints":t.joints=P(a);break;case"vertex_weights":t.vertexWeights=L(a)}}return t}function P(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var a=i.getAttribute("semantic"),s=o(i.getAttribute("source"));t.inputs[a]=s}}return t}function L(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),l=o(i.getAttribute("source")),c=parseInt(i.getAttribute("offset"));t.inputs[s]={id:l,offset:c};break;case"vcount":t.vcount=a(i.textContent);break;case"v":t.v=a(i.textContent)}}return t}function C(e){var t={id:e.id},r=Ze.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,r,n,i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},a=e.sources,o=e.vertexWeights,s=o.vcount,l=o.v,c=o.inputs.JOINT.offset,u=o.inputs.WEIGHT.offset,h=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=a[o.inputs.WEIGHT.id].array,f=0;for(t=0,n=s.length;t<n;t++){var m=s[t],v=[];for(r=0;r<m;r++){var g=l[f+c],y=l[f+u],E=p[y];v.push({index:g,weight:E}),f+=2}for(v.sort(w),r=0;r<4;r++){var x=v[r];void 0!==x?(i.indices.array.push(x.index),i.weights.array.push(x.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}e.bindShapeMatrix?i.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():i.bindMatrix=(new THREE.Matrix4).identity();for(t=0,n=h.array.length;t<n;t++){var b=h.array[t],T=(new THREE.Matrix4).fromArray(d.array,t*d.stride).transpose();i.joints.push({name:b,boneInverse:T})}return i;function w(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function H(e){return void 0!==e.build?e.build:e.init_from}function I(e){var t=Ze.images[e];return void 0!==t?d(t,H):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function k(e){for(var t={surfaces:{},samplers:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":O(i,t);break;case"technique":t.technique=D(i);break;case"extra":t.extra=j(i)}}return t}function O(e,t){for(var r=e.getAttribute("sid"),n=0,i=e.childNodes.length;n<i;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[r]=N(a);break;case"sampler2D":t.samplers[r]=F(a)}}}function N(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"init_from":t.init_from=i.textContent}}return t}function F(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"source":t.source=i.textContent}}return t}function D(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=z(i)}}return t}function z(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=U(i);break;case"transparent":t[i.nodeName]={opaque:i.getAttribute("opaque"),data:U(i)}}}return t}function U(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":t[a.nodeName]=i(a.textContent);break;case"float":t[a.nodeName]=parseFloat(a.textContent);break;case"texture":t[a.nodeName]={id:a.getAttribute("texture"),extra:B(a)}}}return t}function B(e){for(var t={technique:{}},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"extra":G(i,t)}}return t}function G(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":V(i,t)}}}function V(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent)}}}function j(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique":t.technique=W(i)}}return t}function W(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent)}}return t}function X(e){return e}function Y(e){var t,r,n=(t=e.url,d(Ze.effects[t],X)),i=n.profile.technique,a=n.profile.extra;switch(i.type){case"phong":case"blinn":r=new THREE.MeshPhongMaterial;break;case"lambert":r=new THREE.MeshLambertMaterial;break;default:r=new THREE.MeshBasicMaterial}function o(e){var t=n.profile.samplers[e.id],r=null;void 0!==t?r=I(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=I(e.id));if(null!==r){var i=function(e){var t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":t=je;break;default:t=Xe}return t}(r);if(void 0!==i){var a=i.load(r),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===s(o.technique)){var l=o.technique;a.wrapS=l.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.wrapT=l.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.offset.set(l.offsetU||0,l.offsetV||0),a.repeat.set(l.repeatU||1,l.repeatV||1)}else a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping;return a}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name||"";var l=i.parameters;for(var c in l){var u=l[c];switch(c){case"diffuse":u.color&&r.color.fromArray(u.color),u.texture&&(r.map=o(u.texture));break;case"specular":u.color&&r.specular&&r.specular.fromArray(u.color),u.texture&&(r.specularMap=o(u.texture));break;case"bump":u.texture&&(r.normalMap=o(u.texture));break;case"ambient":u.texture&&(r.lightMap=o(u.texture));break;case"shininess":u.float&&r.shininess&&(r.shininess=u.float);break;case"emission":u.color&&r.emissive&&r.emissive.fromArray(u.color),u.texture&&(r.emissiveMap=o(u.texture))}}var h=l.transparent,p=l.transparency;if(void 0===p&&h&&(p={float:1}),void 0===h&&p&&(h={opaque:"A_ONE",data:{color:[1,1,1,1]}}),h&&p)if(h.data.texture)r.transparent=!0;else{var f=h.data.color;switch(h.opaque){case"A_ONE":r.opacity=f[3]*p.float;break;case"RGB_ZERO":r.opacity=1-f[0]*p.float;break;case"A_ZERO":r.opacity=1-f[3]*p.float;break;case"RGB_ONE":r.opacity=f[0]*p.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',h.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==a&&void 0!==a.technique&&1===a.technique.double_sided&&(r.side=THREE.DoubleSide),r}function q(e){return d(Ze.materials[e],Y)}function Q(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return Z(r)}}return{}}function Z(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=K(n)}}return t}function K(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function J(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;n=void 0===n?r*i:n,r=void 0===r?n/i:r,n*=.5,r*=.5,t=new THREE.OrthographicCamera(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name||"",t}function $(e){var t=Ze.cameras[e];return void 0!==t?d(t,J):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=te(i)}}return t}function te(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"color":var o=i(a.textContent);t.color=(new THREE.Color).fromArray(o);break;case"falloff_angle":t.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var s=parseFloat(a.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function re(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=Ze.lights[e];return void 0!==t?d(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ie(e){for(var t={array:[],stride:3},a=0;a<e.childNodes.length;a++){var o=e.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=n(o.textContent);break;case"technique_common":var s=r(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ae(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=o(n.getAttribute("source")))}return t}function oe(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":var s=o(i.getAttribute("source")),l=i.getAttribute("semantic"),c=parseInt(i.getAttribute("offset")),u=parseInt(i.getAttribute("set")),h=u>0?l+u:l;t.inputs[h]={id:s,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=a(i.textContent);break;case"p":t.p=a(i.textContent)}}return t}function se(e){for(var t=0,r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},r=e.sources,n=e.vertices,i=e.primitives;if(0===i.length)return{};var a=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(i);for(var o in a){var s=a[o];se(s),t[o]=ce(s,r,n)}return t}function ce(e,t,r){for(var n={},i={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c=[],u=4,h=[],d=4,p=new THREE.BufferGeometry,f=[],m=0,v=0;v<e.length;v++){var g=e[v],y=g.inputs,E=0;switch(g.type){case"lines":case"linestrips":E=2*g.count;break;case"triangles":E=3*g.count;break;case"polylist":for(var x=0;x<g.count;x++){var b=g.vcount[x];switch(b){case 3:E+=3;break;case 4:E+=6;break;default:E+=3*(b-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",g.type)}for(var T in p.addGroup(m,E,v),m+=E,g.material&&f.push(g.material),y){var w=y[T];switch(T){case"VERTEX":for(var _ in r){var R=r[_];switch(_){case"POSITION":var M=i.array.length;if(ue(g,t[R],w.offset,i.array),i.stride=t[R].stride,t.skinWeights&&t.skinIndices&&(ue(g,t.skinIndices,w.offset,c),ue(g,t.skinWeights,w.offset,h)),!1===g.hasUV&&!0===e.uvsNeedsFix){E=(i.array.length-M)/i.stride;for(var S=0;S<E;S++)o.array.push(0,0)}break;case"NORMAL":ue(g,t[R],w.offset,a.array),a.stride=t[R].stride;break;case"COLOR":ue(g,t[R],w.offset,l.array),l.stride=t[R].stride;break;case"TEXCOORD":ue(g,t[R],w.offset,o.array),o.stride=t[R].stride;break;case"TEXCOORD1":ue(g,t[R],w.offset,s.array),o.stride=t[R].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',_)}}break;case"NORMAL":ue(g,t[w.id],w.offset,a.array),a.stride=t[w.id].stride;break;case"COLOR":ue(g,t[w.id],w.offset,l.array),l.stride=t[w.id].stride;break;case"TEXCOORD":ue(g,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"TEXCOORD1":ue(g,t[w.id],w.offset,s.array),s.stride=t[w.id].stride}}}return i.array.length>0&&p.addAttribute("position",new THREE.Float32BufferAttribute(i.array,i.stride)),a.array.length>0&&p.addAttribute("normal",new THREE.Float32BufferAttribute(a.array,a.stride)),l.array.length>0&&p.addAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),o.array.length>0&&p.addAttribute("uv",new THREE.Float32BufferAttribute(o.array,o.stride)),s.array.length>0&&p.addAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),c.length>0&&p.addAttribute("skinIndex",new THREE.Float32BufferAttribute(c,u)),h.length>0&&p.addAttribute("skinWeight",new THREE.Float32BufferAttribute(h,d)),n.data=p,n.type=e[0].type,n.materialKeys=f,n}function ue(e,t,r,n){var i=e.p,a=e.stride,o=e.vcount;function s(e){for(var t=i[e+r]*c,a=t+c;t<a;t++)n.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var u=0,h=0,d=o.length;h<d;h++){var p=o[h];if(4===p){var f=u+1*a,m=u+2*a,v=u+3*a;s(u+0*a),s(f),s(v),s(f),s(m),s(v)}else if(3===p){f=u+1*a,m=u+2*a;s(u+0*a),s(f),s(m)}else if(p>4)for(var g=1,y=p-2;g<=y;g++){f=u+a*g,m=u+a*(g+1);s(u+0*a),s(f),s(m)}u+=a*p}else for(h=0,d=i.length;h<d;h+=a)s(h)}function he(e){return d(Ze.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function pe(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=fe(n);break;case"link":t.links.push(ve(n))}}}function fe(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var a=i(n.textContent);t.axis.fromArray(a);break;case"limits":var o=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(o.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ge(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ge(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ye(e){var t={type:e.nodeName},r=i(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(r),t.angle=THREE.Math.degToRad(r[3])}return t}function Ee(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":xe(n,t)}}}function xe(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=i(n.textContent);break;case"mass":t.mass=i(n.textContent)[0]}}}function be(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=n.getElementsByTagName("param")[0];t.axis=i.textContent;var a=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=a.substr(0,a.length-1)}}return t}function Te(e){return void 0!==e.build?e.build:e}function we(e){for(var t=[],r=ze.querySelector('[id="'+e.id+'"]'),n=0;n<r.childNodes.length;n++){var a=r.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"matrix":var o=i(a.textContent),s=(new THREE.Matrix4).fromArray(o).transpose();t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:s});break;case"translate":case"scale":o=i(a.textContent);var l=(new THREE.Vector3).fromArray(o);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l});break;case"rotate":o=i(a.textContent),l=(new THREE.Vector3).fromArray(o);var c=THREE.Math.degToRad(o[3]);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:l,angle:c})}}return t}var _e=new THREE.Matrix4,Re=new THREE.Vector3;function Me(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),Me(n);break;case"instance_camera":t.instanceCameras.push(o(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Se(n));break;case"instance_light":t.instanceLights.push(o(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Se(n));break;case"instance_node":t.instanceNodes.push(o(n.getAttribute("url")));break;case"matrix":var a=i(n.textContent);t.matrix.multiply(_e.fromArray(a).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":a=i(n.textContent);Re.fromArray(a),t.matrix.multiply(_e.makeTranslation(Re.x,Re.y,Re.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":a=i(n.textContent);var s=THREE.Math.degToRad(a[3]);t.matrix.multiply(_e.makeRotationAxis(Re.fromArray(a),s)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":a=i(n.textContent);t.matrix.scale(Re.fromArray(a)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return ke(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Ze.nodes[t.id]=t,t}function Se(e){for(var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"bind_material":for(var i=n.getElementsByTagName("instance_material"),a=0;a<i.length;a++){var s=i[a],l=s.getAttribute("symbol"),c=s.getAttribute("target");t.materials[l]=o(c)}break;case"skeleton":t.skeletons.push(o(n.textContent))}}return t}function Ae(e,t){var r,n,i,a=[],o=[];for(r=0;r<e.length;r++){var s=e[r];if(ke(s))Pe(Oe(s),t,a);else if(i=s,void 0!==Ze.visualScenes[i])for(var l=Ze.visualScenes[s].children,c=0;c<l.length;c++){var u=l[c];if("JOINT"===u.type)Pe(Oe(u.id),t,a)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<t.length;r++)for(c=0;c<a.length;c++)if((n=a[c]).bone.name===t[r].name){o[r]=n,n.processed=!0;break}for(r=0;r<a.length;r++)!1===(n=a[r]).processed&&(o.push(n),n.processed=!0);var h=[],d=[];for(r=0;r<o.length;r++)n=o[r],h.push(n.bone),d.push(n.boneInverse);return new THREE.Skeleton(h,d)}function Pe(e,t,r){e.traverse(function(e){if(!0===e.isBone){for(var n,i=0;i<t.length;i++){var a=t[i];if(a.name===e.name){n=a.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),r.push({bone:e,boneInverse:n,processed:!1})}})}function Le(e){for(var t,r=[],n=e.matrix,i=e.nodes,a=e.type,o=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes,h=0,p=i.length;h<p;h++)r.push(Oe(i[h]));for(h=0,p=o.length;h<p;h++){var f=$(o[h]);null!==f&&r.push(f.clone())}for(h=0,p=s.length;h<p;h++)for(var m=s[h],v=(t=m.id,d(Ze.controllers[t],C)),g=Ie(he(v.id),m.materials),y=Ae(m.skeletons,v.skin.joints),E=0,x=g.length;E<x;E++){var b;(b=g[E]).isSkinnedMesh&&(b.bind(y,v.skin.bindMatrix),b.normalizeSkinWeights()),r.push(b)}for(h=0,p=l.length;h<p;h++){var T=ne(l[h]);null!==T&&r.push(T.clone())}for(h=0,p=c.length;h<p;h++)for(E=0,x=(g=Ie(he((m=c[h]).id),m.materials)).length;E<x;E++)r.push(g[E]);for(h=0,p=u.length;h<p;h++)r.push(Oe(u[h]).clone());if(0===i.length&&1===r.length)b=r[0];else{b="JOINT"===a?new THREE.Bone:new THREE.Group;for(h=0;h<r.length;h++)b.add(r[h])}return""===b.name&&(b.name="JOINT"===a?e.sid:e.name),b.matrix.copy(n),b.matrix.decompose(b.position,b.quaternion,b.scale),b}var Ce=new THREE.MeshBasicMaterial({color:16711935});function He(e,t){for(var r=[],n=0,i=e.length;n<i;n++){var a=t[e[n]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Ce)):r.push(q(a))}return r}function Ie(e,t){var r=[];for(var n in e){var i=e[n],a=He(i.materialKeys,t);0===a.length&&("lines"===n||"linestrips"===n?a.push(new THREE.LineBasicMaterial):a.push(new THREE.MeshPhongMaterial));var o=void 0!==i.data.attributes.skinIndex;if(o)for(var s=0,l=a.length;s<l;s++)a[s].skinning=!0;var c,u=1===a.length?a[0]:a;switch(n){case"lines":c=new THREE.LineSegments(i.data,u);break;case"linestrips":c=new THREE.Line(i.data,u);break;case"triangles":case"polylist":c=o?new THREE.SkinnedMesh(i.data,u):new THREE.Mesh(i.data,u)}r.push(c)}return r}function ke(e){return void 0!==Ze.nodes[e]}function Oe(e){return d(Ze.nodes[e],Le)}function Ne(e){var t=new THREE.Group;t.name=e.name;for(var r=e.children,n=0;n<r.length;n++){var i=r[n];t.add(Oe(i.id))}return t}function Fe(e){return d(Ze.visualScenes[e],Ne)}if(0===e.length)return{scene:new THREE.Scene};var De=(new DOMParser).parseFromString(e,"application/xml"),ze=r(De,"COLLADA")[0],Ue=De.getElementsByTagName("parsererror")[0];if(void 0!==Ue){var Be,Ge=r(Ue,"div")[0];return Be=Ge?Ge.textContent:function(e){for(var t="",r=[e];r.length;){var n=r.shift();n.nodeType===Node.TEXT_NODE?t+=n.textContent:(t+="\n",r.push.apply(r,n.childNodes))}return t.trim()}(Ue),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",Be),null}var Ve=ze.getAttribute("version");console.log("THREE.ColladaLoader: File version",Ve);var je,We=function(e){return{unit:l(r(e,"unit")[0]),upAxis:c(r(e,"up_axis")[0])}}(r(ze,"asset")[0]),Xe=new THREE.TextureLoader(this.manager);Xe.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(je=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var Ye=[],qe={},Qe=0,Ze={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(ze,"library_animations","animation",function(e){for(var t={sources:{},samplers:{},channels:{}},r=0,n=e.childNodes.length;r<n;r++){var i,a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"source":i=a.getAttribute("id"),t.sources[i]=ie(a);break;case"sampler":i=a.getAttribute("id"),t.samplers[i]=p(a);break;case"channel":i=a.getAttribute("target"),t.channels[i]=f(a);break;default:console.log(a)}}Ze.animations[e.getAttribute("id")]=t}),u(ze,"library_animation_clips","animation_clip",function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_animation":t.animations.push(o(i.getAttribute("url")))}}Ze.clips[e.getAttribute("id")]=t}),u(ze,"library_controllers","controller",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=o(i.getAttribute("source")),t.skin=A(i);break;case"morph":t.id=o(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ze.controllers[e.getAttribute("id")]=t}),u(ze,"library_images","image",function(e){var t={init_from:r(e,"init_from")[0].textContent};Ze.images[e.getAttribute("id")]=t}),u(ze,"library_effects","effect",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"profile_COMMON":t.profile=k(i)}}Ze.effects[e.getAttribute("id")]=t}),u(ze,"library_materials","material",function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"instance_effect":t.url=o(i.getAttribute("url"))}}Ze.materials[e.getAttribute("id")]=t}),u(ze,"library_cameras","camera",function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"optics":t.optics=Q(i)}}Ze.cameras[e.getAttribute("id")]=t}),u(ze,"library_lights","light",function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"technique_common":t=ee(i)}}Ze.lights[e.getAttribute("id")]=t}),u(ze,"library_geometries","geometry",function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(var i=0;i<n.childNodes.length;i++){var a=n.childNodes[i];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":t.sources[o]=ie(a);break;case"vertices":t.vertices=ae(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(oe(a));break;default:console.log(a)}}}Ze.geometries[e.getAttribute("id")]=t}}),u(ze,"library_nodes","node",Me),u(ze,"library_visual_scenes","visual_scene",function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var n=t[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Qe++)}}(e);for(var n=r(e,"node"),i=0;i<n.length;i++)t.children.push(Me(n[i]));Ze.visualScenes[e.getAttribute("id")]=t}),u(ze,"library_kinematics_models","kinematics_model",function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":pe(n,t)}}Ze.kinematicsModels[e.getAttribute("id")]=t}),u(ze,"library_physics_models","physics_model",function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},Ee(n,t.rigidBodies[n.getAttribute("name")])}}Ze.physicsModels[e.getAttribute("id")]=t}),u(ze,"scene","instance_kinematics_scene",function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(be(n))}}Ze.kinematicsScenes[o(e.getAttribute("url"))]=t}),h(Ze.animations,m),h(Ze.clips,M),h(Ze.controllers,C),h(Ze.images,H),h(Ze.effects,X),h(Ze.materials,Y),h(Ze.cameras,J),h(Ze.lights,re),h(Ze.geometries,le),h(Ze.visualScenes,Ne),function(){var e=Ze.clips;if(!0===s(e)){if(!1===s(Ze.animations)){var t=[];for(var r in Ze.animations)for(var n=v(r),i=0,a=n.length;i<a;i++)t.push(n[i]);Ye.push(new THREE.AnimationClip("default",-1,t))}}else for(var r in e)Ye.push(S(r))}(),function(){var e=Object.keys(Ze.kinematicsModels)[0],t=Object.keys(Ze.kinematicsScenes)[0],r=Object.keys(Ze.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,i=(n=e,d(Ze.kinematicsModels[n],de)),a=function(e){return d(Ze.kinematicsScenes[e],Te)}(t),o=Fe(r),s=a.bindJointAxis,l={},c=0,u=s.length;c<u;c++){var h=s[c],p=ze.querySelector('[sid="'+h.target+'"]');if(p){var f=p.parentElement;v(h.jointIndex,f)}}var m=new THREE.Matrix4;qe={joints:i&&i.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=l[e];if(r){var n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=r.object,a=n.axis,o=r.transforms;_e.identity();for(var s=0;s<o.length;s++){var c=o[s];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":_e.multiply(m.makeRotationAxis(a,THREE.Math.degToRad(t)));break;case"prismatic":_e.multiply(m.makeTranslation(a.x*t,a.y*t,a.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":_e.multiply(c.obj);break;case"translate":_e.multiply(m.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":_e.scale(c.obj);break;case"rotate":_e.multiply(m.makeRotationAxis(c.obj,c.angle))}}i.matrix.copy(_e),i.matrix.decompose(i.position,i.quaternion,i.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var r=t.getAttribute("name"),n=i.joints[e];o.traverse(function(i){i.name===r&&(l[e]={object:i,transforms:we(t),joint:n,position:n.zeroPosition})})}}();var Ke=function(e){return Fe(o(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(ze,"scene")[0]);return"Z_UP"===We.upAxis&&Ke.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Ke.scale.multiplyScalar(We.unit),{animations:Ye,kinematics:qe,library:Ze,scene:Ke}}}},function(e,t){THREE.ColladaExporter=function(){},THREE.ColladaExporter.prototype={constructor:THREE.ColladaExporter,parse:function(e,t,r){r=r||{},""!==(r=Object.assign({version:"1.4.1",author:null,textureDirectory:""},r)).textureDirectory&&(r.textureDirectory=`${r.textureDirectory}/`.replace(/\\/g,"/").replace(/\/+/g,"/"));var n,i,a=r.version;if("1.4.1"!==a&&"1.5.0"!==a)return console.warn(`ColladaExporter : Version ${a} not supported for export. Only 1.4.1 and 1.5.0.`),null;function o(e,t){return n=n||document.createElement("canvas"),i=i||n.getContext("2d"),n.width=e.naturalWidth,n.height=e.naturalHeight,i.drawImage(e,0,0),function(e){for(var t=atob(e),r=new Uint8Array(t.length),n=0,i=r.length;n<i;n++)r[n]=t.charCodeAt(n);return r}(n.toDataURL(`image/${t}`,1).replace(/^data:image\/(png|jpg);base64,/,""))}var s,l=["getX","getY","getZ","getW"];function c(e){if(e.isInterleavedBufferAttribute){for(var t=new e.array.constructor(e.count*e.itemSize),r=e.itemSize,n=0,i=e.count;n<i;n++)for(var a=0;a<r;a++)t[n*r+a]=e[l[a]](n);return t}return e.array}function u(e,t,r,n){var i=c(e);return`<source id="${t}">`+`<float_array id="${t}-array" count="${i.length}">`+i.join(" ")+"</float_array><technique_common>"+`<accessor source="#${t}-array" count="${Math.floor(i.length/e.itemSize)}" stride="${e.itemSize}">`+r.map(e=>`<param name="${e}" type="${n}" />`).join("")+"</accessor></technique_common></source>"}function h(e){var t=f.get(e);if(null==t){t=`image-${v.length+1}`;var n=e.name||t,i=`<image id="${t}" name="${n}">`;i+="1.5.0"===a?`<init_from><ref>${r.textureDirectory}${n}.png</ref></init_from>`:`<init_from>${r.textureDirectory}${n}.png</init_from>`,i+="</image>",v.push(i),f.set(e,t),m.push({directory:r.textureDirectory,name:n,ext:"png",data:o(e.image,"png"),original:e})}return t}var d=new WeakMap,p=new WeakMap,f=new WeakMap,m=[],v=[],g=[],y=[],E=[],x=function e(t){var r=`<node name="${t.name}">`;if(r+=function(e){return e.updateMatrix(),(s=s||new THREE.Matrix4).copy(e.matrix),s.transpose(),`<matrix>${s.toArray().join(" ")}</matrix>`}(t),t instanceof THREE.Mesh&&null!=t.geometry){var n=function(e){var t,r,n,i=d.get(e);if(!i){var a=e;a instanceof THREE.Geometry&&(a=(new THREE.BufferGeometry).fromGeometry(a));var o=`Mesh${g.length+1}`,s=a.index?a.index.count*a.index.itemSize:a.attributes.position.count,l=null!=a.groups&&0!==a.groups.length?a.groups:[{start:0,count:s,materialIndex:0}],h=`<geometry id="${o}" name="${e.name}"><mesh>`,p=`${o}-position`,f=`${o}-vertices`;h+=u(a.attributes.position,p,["X","Y","Z"],"float"),h+=`<vertices id="${f}"><input semantic="POSITION" source="#${p}" /></vertices>`;var m=`<input semantic="VERTEX" source="#${f}" offset="0" />`;if("normal"in a.attributes){var v=`${o}-normal`;h+=u(a.attributes.normal,v,["X","Y","Z"],"float"),m+=`<input semantic="NORMAL" source="#${v}" offset="0" />`}if("uv"in a.attributes){var y=`${o}-texcoord`;h+=u(a.attributes.uv,y,["S","T"],"float"),m+=`<input semantic="TEXCOORD" source="#${y}" offset="0" set="0" />`}if("color"in a.attributes){var E=`${o}-color`;h+=u(a.attributes.color,E,["X","Y","Z"],"uint8"),m+=`<input semantic="COLOR" source="#${E}" offset="0" />`}var x=null;if(a.index)x=c(a.index);else for(var b=0,T=(x=new Array(s)).length;b<T;b++)x[b]=b;for(b=0,T=l.length;b<T;b++){var w=l[b],_=(t=x,r=w.start,n=w.count,Array.isArray(t)?t.slice(r,r+n):new t.constructor(t.buffer,r*t.BYTES_PER_ELEMENT,n)),R=_.length/3;h+=`<triangles material="MESH_MATERIAL_${w.materialIndex}" count="${R}">`,h+=m,h+=`<p>${_.join(" ")}</p>`,h+="</triangles>"}h+="</mesh></geometry>",g.push(h),i={meshid:o,bufferGeometry:a},d.set(e,i)}return i}(t.geometry),i=n.meshid,a=n.bufferGeometry,o=null,l=t.material||new THREE.MeshBasicMaterial,f=Array.isArray(l)?l:[l];o=(a.groups.length>f.length?new Array(a.groups.length):new Array(f.length)).fill().map((e,t)=>(function(e){var t=p.get(e);if(null==t){t=`Mat${y.length+1}`;var r="phong";e instanceof THREE.MeshLambertMaterial?r="lambert":e instanceof THREE.MeshBasicMaterial&&(r="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial."));var n=e.emissive?e.emissive:new THREE.Color(0,0,0),i=e.color?e.color:new THREE.Color(0,0,0),a=e.specular?e.specular:new THREE.Color(1,1,1),o=e.shininess||0,s=e.reflectivity||0,l="";!0===e.transparent&&(l+="<transparent>"+(e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",e.opacity<1&&(l+=`<transparency><float>${e.opacity}</float></transparency>`));var c=`<technique sid="common"><${r}>`+"<emission>"+(e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':`<color sid="emission">${n.r} ${n.g} ${n.b} 1</color>`)+"</emission>"+("constant"!==r?"<diffuse>"+(e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':`<color sid="diffuse">${i.r} ${i.g} ${i.b} 1</color>`)+"</diffuse>":"")+("phong"===r?`<specular><color sid="specular">${a.r} ${a.g} ${a.b} 1</color></specular>`+"<shininess>"+(e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':`<float sid="shininess">${o}</float>`)+"</shininess>":"")+`<reflective><color>${i.r} ${i.g} ${i.b} 1</color></reflective>`+`<reflectivity><float>${s}</float></reflectivity>`+l+`</${r}></technique>`,u=`<effect id="${t}-effect">`+"<profile_COMMON>"+(e.map?'<newparam sid="diffuse-surface"><surface type="2D">'+`<init_from>${h(e.map)}</init_from>`+'</surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>':"")+(e.specularMap?'<newparam sid="specular-surface"><surface type="2D">'+`<init_from>${h(e.specularMap)}</init_from>`+'</surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>':"")+(e.emissiveMap?'<newparam sid="emissive-surface"><surface type="2D">'+`<init_from>${h(e.emissiveMap)}</init_from>`+'</surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>':"")+c+(e.side===THREE.DoubleSide?'<extra><technique><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>";E.push(`<material id="${t}" name="${e.name}"><instance_effect url="#${t}-effect" /></material>`),y.push(u),p.set(e,t)}return t})(f[t%f.length])),r+=`<instance_geometry url="#${i}">`+(null!=o?"<bind_material><technique_common>"+o.map((e,t)=>`<instance_material symbol="MESH_MATERIAL_${t}" target="#${e}" >`+'<bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>').join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return t.children.forEach(t=>r+=e(t)),r+="</node>"}(e),b='<?xml version="1.0" encoding="UTF-8" standalone="no" ?>'+`<COLLADA xmlns="${"1.4.1"===a?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/"}" version="${a}">`+"<asset><contributor><authoring_tool>three.js Collada Exporter</authoring_tool>"+(null!==r.author?`<author>${r.author}</author>`:"")+"</contributor>"+`<created>${(new Date).toISOString()}</created>`+`<modified>${(new Date).toISOString()}</modified>`+"<up_axis>Y_UP</up_axis></asset>";b+=`<library_images>${v.join("")}</library_images>`,b+=`<library_effects>${y.join("")}</library_effects>`,b+=`<library_materials>${E.join("")}</library_materials>`,b+=`<library_geometries>${g.join("")}</library_geometries>`,b+=`<library_visual_scenes><visual_scene id="Scene" name="scene">${x}</visual_scene></library_visual_scenes>`,b+='<scene><instance_visual_scene url="#Scene"/></scene>';var T,w,_,R,M,S,A={data:(T=b+="</COLLADA>",w=/^<\//,_=/(\?>$)|(\/>$)/,R=/<[^>]+>[^<]*<\/[^<]+>/,M=(e,t)=>t>0?e+M(e,t-1):"",S=0,T.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map(e=>{R.test(e)||_.test(e)||!w.test(e)||S--;var t=`${M("  ",S)}${e}`;return R.test(e)||_.test(e)||w.test(e)||S++,t}).join("\n")),textures:m};return"function"==typeof t&&requestAnimationFrame(()=>t(A)),A}}},function(e,t){THREE.GCodeLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.splitLayer=!1},THREE.GCodeLoader.prototype={constructor:THREE.GCodeLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){var t={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},r=[],n=void 0,i=new THREE.LineBasicMaterial({color:16711680});i.name="path";var a=new THREE.LineBasicMaterial({color:65280});function o(e){n={vertex:[],pathVertex:[],z:e.z},r.push(n)}function s(e,r){return t.relative?r:r-e}function l(e,r){return t.relative?e+r:r}a.name="extruded";for(var c,u,h=e.replace(/;.+/g,"").split("\n"),d=0;d<h.length;d++){var p=h[d].split(" "),f=p[0].toUpperCase(),m={};if(p.splice(1).forEach(function(e){if(void 0!==e[0]){var t=e[0].toLowerCase(),r=parseFloat(e.substring(1));m[t]=r}}),"G0"===f||"G1"===f){var v={x:void 0!==m.x?l(t.x,m.x):t.x,y:void 0!==m.y?l(t.y,m.y):t.y,z:void 0!==m.z?l(t.z,m.z):t.z,e:void 0!==m.e?l(t.e,m.e):t.e,f:void 0!==m.f?l(t.f,m.f):t.f};s(t.e,v.e)>0&&(v.extruding=s(t.e,v.e)>0,null!=n&&v.z==n.z||o(v)),c=t,u=v,void 0===n&&o(c),v.extruding?(n.vertex.push(c.x,c.y,c.z),n.vertex.push(u.x,u.y,u.z)):(n.pathVertex.push(c.x,c.y,c.z),n.pathVertex.push(u.x,u.y,u.z)),t=v}else if("G2"===f||"G3"===f);else if("G90"===f)t.relative=!1;else if("G91"===f)t.relative=!0;else if("G92"===f){(v=t).x=void 0!==m.x?m.x:v.x,v.y=void 0!==m.y?m.y:v.y,v.z=void 0!==m.z?m.z:v.z,v.e=void 0!==m.e?m.e:v.e,t=v}}function g(e,t){var r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.Float32BufferAttribute(e,3));var n=new THREE.LineSegments(r,t?a:i);n.name="layer"+d,y.add(n)}var y=new THREE.Group;if(y.name="gcode",this.splitLayer)for(d=0;d<r.length;d++){g((b=r[d]).vertex,!0),g(b.pathVertex,!1)}else{var E=[],x=[];for(d=0;d<r.length;d++){var b=r[d];E=E.concat(b.vertex),x=x.concat(b.pathVertex)}g(E,!0),g(x,!1)}return y.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),y}}},function(e,t){THREE.DRACOLoader=function(e){this.timeLoaded=0,this.manager=e||THREE.DefaultLoadingManager,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=THREE.TrianglesDrawMode,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}},THREE.DRACOLoader.prototype={constructor:THREE.DRACOLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(e){i.decodeDracoFile(e,t)},r,n)},setPath:function(e){return this.path=e,this},setVerbosity:function(e){return this.verbosity=e,this},setDrawMode:function(e){return this.drawMode=e,this},setSkipDequantization:function(e,t){var r=!0;return void 0!==t&&(r=t),this.getAttributeOptions(e).skipDequantization=r,this},decodeDracoFile:function(e,t,r,n){var i=this;THREE.DRACOLoader.getDecoderModule().then(function(a){i.decodeDracoFileInternal(e,a.decoder,t,r,n)})},decodeDracoFileInternal:function(e,t,r,n,i){var a=new t.DecoderBuffer;a.Init(new Int8Array(e),e.byteLength);var o=new t.Decoder,s=o.GetEncodedGeometryType(a);if(s==t.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(s!=t.POINT_CLOUD){var l="THREE.DRACOLoader: Unknown geometry type.";throw console.error(l),new Error(l)}this.verbosity>0&&console.log("Loaded a point cloud.")}r(this.convertDracoGeometryTo3JS(t,o,s,a,n,i))},addAttributeToGeometry:function(e,t,r,n,i,a,o,s){if(0===a.ptr){var l="THREE.DRACOLoader: No attribute "+n;throw console.error(l),new Error(l)}var c,u,h=a.num_components(),d=r.num_points()*h;switch(i){case Float32Array:c=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(r,a,c),s[n]=new Float32Array(d),u=THREE.Float32BufferAttribute;break;case Int8Array:c=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(r,a,c),s[n]=new Int8Array(d),u=THREE.Int8BufferAttribute;break;case Int16Array:c=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(r,a,c),s[n]=new Int16Array(d),u=THREE.Int16BufferAttribute;break;case Int32Array:c=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(r,a,c),s[n]=new Int32Array(d),u=THREE.Int32BufferAttribute;break;case Uint8Array:c=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(r,a,c),s[n]=new Uint8Array(d),u=THREE.Uint8BufferAttribute;break;case Uint16Array:c=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(r,a,c),s[n]=new Uint16Array(d),u=THREE.Uint16BufferAttribute;break;case Uint32Array:c=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(r,a,c),s[n]=new Uint32Array(d),u=THREE.Uint32BufferAttribute;break;default:l="THREE.DRACOLoader: Unexpected attribute type.";throw console.error(l),new Error(l)}for(var p=0;p<d;p++)s[n][p]=c.GetValue(p);o.addAttribute(n,new u(s[n],h)),e.destroy(c)},convertDracoGeometryTo3JS:function(e,t,r,n,i,a){var o,s;!0===this.getAttributeOptions("position").skipDequantization&&t.SkipAttributeTransform(e.POSITION);var l=performance.now();if(r===e.TRIANGULAR_MESH?(o=new e.Mesh,s=t.DecodeBufferToMesh(n,o)):(o=new e.PointCloud,s=t.DecodeBufferToPointCloud(n,o)),!s.ok()||0==o.ptr){var c="THREE.DRACOLoader: Decoding failed: ";throw c+=s.error_msg(),console.error(c),e.destroy(t),e.destroy(o),new Error(c)}var u,h=performance.now();e.destroy(n),r==e.TRIANGULAR_MESH?(u=o.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+u.toString())):u=0;var d=o.num_points(),p=o.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+d.toString()),console.log("Number of attributes loaded: "+p.toString()));var f=t.GetAttributeId(o,e.POSITION);if(-1==f){c="THREE.DRACOLoader: No position attribute found.";throw console.error(c),e.destroy(t),e.destroy(o),new Error(c)}var m=t.GetAttribute(o,f),v={},g=new THREE.BufferGeometry;if(i)for(var y in i){var E=a[y],x=i[y],b=t.GetAttributeByUniqueId(o,x);this.addAttributeToGeometry(e,t,o,y,E,b,g,v)}else for(var y in this.nativeAttributeMap){var T=t.GetAttributeId(o,e[this.nativeAttributeMap[y]]);if(-1!==T){this.verbosity>0&&console.log("Loaded "+y+" attribute.");b=t.GetAttribute(o,T);this.addAttributeToGeometry(e,t,o,y,Float32Array,b,g,v)}}if(r==e.TRIANGULAR_MESH)if(this.drawMode===THREE.TriangleStripDrawMode){var w=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(o,w),v.indices=new Uint32Array(w.size());for(var _=0;_<w.size();++_)v.indices[_]=w.GetValue(_);e.destroy(w)}else{var R=3*u;v.indices=new Uint32Array(R);var M=new e.DracoInt32Array;for(_=0;_<u;++_){t.GetFaceFromMesh(o,_,M);var S=3*_;v.indices[S]=M.GetValue(0),v.indices[S+1]=M.GetValue(1),v.indices[S+2]=M.GetValue(2)}e.destroy(M)}g.drawMode=this.drawMode,r==e.TRIANGULAR_MESH&&g.setIndex(new(v.indices.length>65535?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(v.indices,1));var A=new e.AttributeQuantizationTransform;if(A.InitFromAttribute(m)){g.attributes.position.isQuantized=!0,g.attributes.position.maxRange=A.range(),g.attributes.position.numQuantizationBits=A.quantization_bits(),g.attributes.position.minValues=new Float32Array(3);for(_=0;_<3;++_)g.attributes.position.minValues[_]=A.min_value(_)}return e.destroy(A),e.destroy(t),e.destroy(o),this.decode_time=h-l,this.import_time=performance.now()-h,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),g},isVersionSupported:function(e,t){THREE.DRACOLoader.getDecoderModule().then(function(r){t(r.decoder.isVersionSupported(e))})},getAttributeOptions:function(e){return void 0===this.attributeOptions[e]&&(this.attributeOptions[e]={}),this.attributeOptions[e]}},THREE.DRACOLoader.decoderPath="./",THREE.DRACOLoader.decoderConfig={},THREE.DRACOLoader.decoderModulePromise=null,THREE.DRACOLoader.setDecoderPath=function(e){THREE.DRACOLoader.decoderPath=e},THREE.DRACOLoader.setDecoderConfig=function(e){var t=THREE.DRACOLoader.decoderConfig.wasmBinary;THREE.DRACOLoader.decoderConfig=e||{},THREE.DRACOLoader.releaseDecoderModule(),t&&(THREE.DRACOLoader.decoderConfig.wasmBinary=t)},THREE.DRACOLoader.releaseDecoderModule=function(){THREE.DRACOLoader.decoderModulePromise=null},THREE.DRACOLoader.getDecoderModule=function(){var e=this,t=THREE.DRACOLoader.decoderPath,r=THREE.DRACOLoader.decoderConfig,n=THREE.DRACOLoader.decoderModulePromise;return n||("undefined"!=typeof DracoDecoderModule?n=Promise.resolve():"object"!=typeof WebAssembly||"js"===r.type?n=THREE.DRACOLoader._loadScript(t+"draco_decoder.js"):(r.wasmBinaryFile=t+"draco_decoder.wasm",n=THREE.DRACOLoader._loadScript(t+"draco_wasm_wrapper.js").then(function(){return THREE.DRACOLoader._loadArrayBuffer(r.wasmBinaryFile)}).then(function(e){r.wasmBinary=e})),n=n.then(function(){return new Promise(function(t){r.onModuleLoaded=function(r){e.timeLoaded=performance.now(),t({decoder:r})},DracoDecoderModule(r)})}),THREE.DRACOLoader.decoderModulePromise=n,n)},THREE.DRACOLoader._loadScript=function(e){var t=document.getElementById("decoder_script");null!==t&&t.parentNode.removeChild(t);var r=document.getElementsByTagName("head")[0],n=document.createElement("script");return n.id="decoder_script",n.type="text/javascript",n.src=e,new Promise(function(e){n.onload=e,r.appendChild(n)})},THREE.DRACOLoader._loadArrayBuffer=function(e){var t=new THREE.FileLoader;return t.setResponseType("arraybuffer"),new Promise(function(r,n){t.load(e,r,void 0,n)})}},function(e,t){THREE.DDSLoader=function(e){THREE.CompressedTextureLoader.call(this,e),this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,r,n){for(var i=r*n*4,a=new Uint8Array(e,t,i),o=new Uint8Array(i),s=0,l=0,c=0;c<n;c++)for(var u=0;u<r;u++){var h=a[l],d=a[++l],p=a[++l],f=a[++l];l++,o[s]=p,o[++s]=d,o[++s]=h,o[++s]=f,s++}return o}var a,o=n("DXT1"),s=n("DXT3"),l=n("DXT5"),c=n("ETC1"),u=new Int32Array(e,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),r;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),r;var h,d=u[21],p=!1;switch(d){case o:a=8,r.format=THREE.RGB_S3TC_DXT1_Format;break;case s:a=16,r.format=THREE.RGBA_S3TC_DXT3_Format;break;case l:a=16,r.format=THREE.RGBA_S3TC_DXT5_Format;break;case c:a=8,r.format=THREE.RGB_ETC1_Format;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(h=d,String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255))),r;p=!0,a=64,r.format=THREE.RGBAFormat}r.mipmapCount=1,131072&u[2]&&!1!==t&&(r.mipmapCount=Math.max(1,u[7]));var f=u[28];if(r.isCubemap=!!(512&f),r.isCubemap&&(!(1024&f)||!(2048&f)||!(4096&f)||!(8192&f)||!(16384&f)||!(32768&f)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),r;r.width=u[4],r.height=u[3];for(var m=u[1]+4,v=r.isCubemap?6:1,g=0;g<v;g++)for(var y=r.width,E=r.height,x=0;x<r.mipmapCount;x++){if(p)var b=(T=i(e,m,y,E)).length;else{b=Math.max(4,y)/4*Math.max(4,E)/4*a;var T=new Uint8Array(e,m,b)}var w={data:T,width:y,height:E};r.mipmaps.push(w),m+=b,y=Math.max(y>>1,1),E=Math.max(E>>1,1)}return r}},function(e,t){THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null,this.ddsLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,n){var i,a=this;i=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),a.manager.itemStart(e);var o=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new THREE.FileLoader(a.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===a.crossOrigin&&s.setWithCredentials(!0),s.load(e,function(r){try{a.parse(r,i,function(r){t(r),a.manager.itemEnd(e)},o)}catch(e){o(e)}},r,o)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},parse:function(e,t,s,l){var p,f={};if("string"==typeof e)p=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===o){try{f[r.KHR_BINARY_GLTF]=new c(e)}catch(e){return void(l&&l(e))}p=f[r.KHR_BINARY_GLTF].content}else p=THREE.LoaderUtils.decodeText(new Uint8Array(e));var m=JSON.parse(p);if(void 0===m.asset||m.asset.version[0]<2)l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(m.extensionsUsed)for(var v=0;v<m.extensionsUsed.length;++v){var g=m.extensionsUsed[v],y=m.extensionsRequired||[];switch(g){case r.KHR_LIGHTS_PUNCTUAL:f[g]=new i(m);break;case r.KHR_MATERIALS_UNLIT:f[g]=new a;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:f[g]=new d;break;case r.KHR_DRACO_MESH_COMPRESSION:f[g]=new u(m,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:f[r.MSFT_TEXTURE_DDS]=new n(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:f[r.KHR_TEXTURE_TRANSFORM]=new h;break;default:y.indexOf(g)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}new z(m,f,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(s,l)}}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.name=r.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[r.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function a(){this.name=r.KHR_MATERIALS_UNLIT}i.prototype.loadLight=function(e){var t,r=this.lightDefs[e],n=new THREE.Color(16777215);void 0!==r.color&&n.fromArray(r.color);var i=void 0!==r.range?r.range:0;switch(r.type){case"directional":(t=new THREE.DirectionalLight(n)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new THREE.PointLight(n)).distance=i;break;case"spot":(t=new THREE.SpotLight(n)).distance=i,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,t.angle=r.spot.outerConeAngle,t.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==r.intensity&&(t.intensity=r.intensity),t.name=r.name||"light_"+e,Promise.resolve(t)},a.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},a.prototype.extendParams=function(e,t,r){var n=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(n)};var o="glTF",s=12,l={JSON:1313821514,BIN:5130562};function c(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,s);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var n=new DataView(e,s),i=0;i<n.byteLength;){var a=n.getUint32(i,!0);i+=4;var c=n.getUint32(i,!0);if(i+=4,c===l.JSON){var u=new Uint8Array(e,s+i,a);this.content=THREE.LoaderUtils.decodeText(u)}else if(c===l.BIN){var h=s+i;this.body=e.slice(h,h+a)}i+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function u(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t}function h(){this.name=r.KHR_TEXTURE_TRANSFORM}function d(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,r){var n=t.extensions[this.name],i=THREE.ShaderLib.standard,a=THREE.UniformsUtils.clone(i.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=i.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete a.roughness,delete a.metalness,delete a.roughnessMap,delete a.metalnessMap,a.specular={value:(new THREE.Color).setHex(1118481)},a.glossiness={value:.5},a.specularMap={value:null},a.glossinessMap={value:null},e.vertexShader=i.vertexShader,e.fragmentShader=h,e.uniforms=a,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(n.diffuseFactor)){var p=n.diffuseFactor;e.color.fromArray(p),e.opacity=p[3]}if(void 0!==n.diffuseTexture&&d.push(r.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var f=n.specularGlossinessTexture;d.push(r.assignTexture(e,"glossinessMap",f)),d.push(r.assignTexture(e,"specularMap",f))}return Promise.all(d)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,n=0,i=r.length;n<i;n++){var a=e[r[n]];t[r[n]]=a&&a.isColor?a.clone():a}return t},refreshUniforms:function(e,t,r,n,i){if(!0===i.isGLTFSpecularGlossinessMaterial){var a,o=i.uniforms,s=i.defines;o.opacity.value=i.opacity,o.diffuse.value.copy(i.color),o.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),o.map.value=i.map,o.specularMap.value=i.specularMap,o.alphaMap.value=i.alphaMap,o.lightMap.value=i.lightMap,o.lightMapIntensity.value=i.lightMapIntensity,o.aoMap.value=i.aoMap,o.aoMapIntensity.value=i.aoMapIntensity,i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.glossinessMap?a=i.glossinessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap&&(a=i.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),o.uvTransform.value.copy(a.matrix)),i.envMap&&(o.envMap.value=i.envMap,o.envMapIntensity.value=i.envMapIntensity,o.flipEnvMap.value=i.envMap.isCubeTexture?-1:1,o.reflectivity.value=i.reflectivity,o.refractionRatio.value=i.refractionRatio,o.maxMipLevel.value=e.properties.get(i.envMap).__maxMipLevel),o.specular.value.copy(i.specular),o.glossiness.value=i.glossiness,o.glossinessMap.value=i.glossinessMap,o.emissiveMap.value=i.emissiveMap,o.bumpMap.value=i.bumpMap,o.normalMap.value=i.normalMap,o.displacementMap.value=i.displacementMap,o.displacementScale.value=i.displacementScale,o.displacementBias.value=i.displacementBias,null!==o.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}function p(e,t,r,n){THREE.Interpolant.call(this,e,t,r,n)}u.prototype.decodePrimitive=function(e,t){var r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var c in a){var u=M[c]||c.toLowerCase();o[u]=a[c]}for(c in e.attributes){u=M[c]||c.toLowerCase();if(void 0!==a[c]){var h=r.accessors[e.attributes[c]],d=T[h.componentType];l[u]=d,s[u]=!0===h.normalized}}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t){n.decodeDracoFile(e,function(e){for(var r in e.attributes){var n=e.attributes[r],i=s[r];void 0!==i&&(n.normalized=i)}t(e)},o,l)})})},h.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},p.prototype=Object.create(THREE.Interpolant.prototype),p.prototype.constructor=p,p.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n,a=0;a!==n;a++)t[a]=r[i+a];return t},p.prototype.beforeStart_=p.prototype.copySampleValue_,p.prototype.afterEnd_=p.prototype.copySampleValue_,p.prototype.interpolate_=function(e,t,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=n-t,u=(r-t)/c,h=u*u,d=h*u,p=e*l,f=p-l,m=-2*d+3*h,v=d-h,g=1-m,y=v-h+u,E=0;E!==o;E++){var x=a[f+E+o],b=a[f+E+s]*c,T=a[p+E+o],w=a[p+E]*c;i[E]=g*x+y*b+m*T+v*w}return i};var f,m=0,v=1,g=2,y=3,E=4,x=5,b=6,T={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},w={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},_={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},R={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},S={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},A={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},P="OPAQUE",L="MASK",C="BLEND",H={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function I(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function k(e,t,r){for(var n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function O(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function N(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(r=0,n=i.length;r<n;r++)e.morphTargetDictionary[i[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function F(e){for(var t="",r=Object.keys(e).sort(),n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function D(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,r=e.itemSize,n=e.array.slice(0,t*r),i=0,a=0;i<t;++i)n[a++]=e.getX(i),r>=2&&(n[a++]=e.getY(i)),r>=3&&(n[a++]=e.getZ(i)),r>=4&&(n[a++]=e.getW(i));return new THREE.BufferAttribute(n,r,e.normalized)}return e.clone()}function z(e,r,n){this.json=e||{},this.extensions=r||{},this.options=n||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function U(e,t,r){var n=t.attributes,i=[];function a(t,n){return r.getDependency("accessor",t).then(function(t){e.addAttribute(n,t)})}for(var o in n){var s=M[o]||o.toLowerCase();s in e.attributes||i.push(a(n[o],s))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});i.push(l)}return O(e,t),Promise.all(i).then(function(){return void 0!==t.targets?function(e,t,r){for(var n=!1,i=!1,a=0,o=t.length;a<o&&(void 0!==(c=t[a]).POSITION&&(n=!0),void 0!==c.NORMAL&&(i=!0),!n||!i);a++);if(!n&&!i)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var c=t[a];if(n){var u=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION):e.attributes.position;s.push(u)}i&&(u=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL):e.attributes.normal,l.push(u))}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(r){for(var a=r[0],o=r[1],s=0,l=a.length;s<l;s++)e.attributes.position!==a[s]&&(a[s]=D(a[s]));for(s=0,l=o.length;s<l;s++)e.attributes.normal!==o[s]&&(o[s]=D(o[s]));for(s=0,l=t.length;s<l;s++){var c=t[s],u="morphTarget"+s;if(n&&void 0!==c.POSITION){var h=a[s];h.name=u;for(var d=e.attributes.position,p=0,f=h.count;p<f;p++)h.setXYZ(p,h.getX(p)+d.getX(p),h.getY(p)+d.getY(p),h.getZ(p)+d.getZ(p))}if(i&&void 0!==c.NORMAL){var m=o[s];m.name=u;var v=e.attributes.normal;for(p=0,f=m.count;p<f;p++)m.setXYZ(p,m.getX(p)+v.getX(p),m.getY(p)+v.getY(p),m.getZ(p)+v.getZ(p))}}return n&&(e.morphAttributes.position=a),i&&(e.morphAttributes.normal=o),e})}(e,t.targets,r):e})}return z.prototype.parse=function(e,t){var r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){var a={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};k(i,a,n),O(a,n),e(a)}).catch(t)},z.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],n={},i={},a=0,o=t.length;a<o;a++)for(var s=t[a].joints,l=0,c=s.length;l<c;l++)e[s[l]].isBone=!0;for(var u=0,h=e.length;u<h;u++){var d=e[u];void 0!==d.mesh&&(void 0===n[d.mesh]&&(n[d.mesh]=i[d.mesh]=0),n[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=i},z.prototype.getDependency=function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this.loadMesh(t);break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this.loadBufferView(t);break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this.loadMaterial(t);break;case"texture":i=this.loadTexture(t);break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;case"light":i=this.extensions[r.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},z.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map(function(t,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t},z.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,r){n.load(I(t.uri,i.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},z.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)})},z.prototype.loadAccessor=function(e){var t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var i=[];return void 0!==n.bufferView?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(e){var i,a,o=e[0],s=R[n.type],l=T[n.componentType],c=l.BYTES_PER_ELEMENT,u=c*s,h=n.byteOffset||0,d=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,p=!0===n.normalized;if(d&&d!==u){var f="InterleavedBuffer:"+n.bufferView+":"+n.componentType,m=t.cache.get(f);m||(i=new l(o),m=new THREE.InterleavedBuffer(i,d/c),t.cache.add(f,m)),a=new THREE.InterleavedBufferAttribute(m,s,h/c,p)}else i=null===o?new l(n.count*s):new l(o,h,n.count*s),a=new THREE.BufferAttribute(i,s,p);if(void 0!==n.sparse){var v=R.SCALAR,g=T[n.sparse.indices.componentType],y=n.sparse.indices.byteOffset||0,E=n.sparse.values.byteOffset||0,x=new g(e[1],y,n.sparse.count*v),b=new l(e[2],E,n.sparse.count*s);null!==o&&a.setArray(a.array.slice());for(var w=0,_=x.length;w<_;w++){var M=x[w];if(a.setX(M,b[w*s]),s>=2&&a.setY(M,b[w*s+1]),s>=3&&a.setZ(M,b[w*s+2]),s>=4&&a.setW(M,b[w*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})},z.prototype.loadTexture=function(e){var t,n=this,i=this.json,a=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,l=i.textures[e],c=l.extensions||{},u=(t=c[r.MSFT_TEXTURE_DDS]?i.images[c[r.MSFT_TEXTURE_DDS].source]:i.images[l.source]).uri,h=!1;return void 0!==t.bufferView&&(u=n.getDependency("bufferView",t.bufferView).then(function(e){h=!0;var r=new Blob([e],{type:t.mimeType});return u=s.createObjectURL(r)})),Promise.resolve(u).then(function(e){var t=THREE.Loader.Handlers.get(e);return t||(t=c[r.MSFT_TEXTURE_DDS]?n.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(r,n){t.load(I(e,a.path),r,void 0,n)})}).then(function(e){!0===h&&s.revokeObjectURL(u),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in H&&(e.format=H[t.mimeType]);var r=(i.samplers||{})[l.sampler]||{};return e.magFilter=w[r.magFilter]||THREE.LinearFilter,e.minFilter=w[r.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=_[r.wrapS]||THREE.RepeatWrapping,e.wrapT=_[r.wrapT]||THREE.RepeatWrapping,e})},z.prototype.assignTexture=function(e,t,n){var i=this;return this.getDependency("texture",n.index).then(function(a){if(!a.isCompressedTexture)switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":a.format=THREE.RGBFormat}if(i.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;o&&(a=i.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(a,o))}e[t]=a})},z.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,i=this.extensions,a=void 0!==t.attributes.color,o=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,l=Object.keys(t.morphAttributes).length>0,c=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var u="PointsMaterial:"+n.uuid,h=this.cache.get(u);h||(h=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.lights=!1,this.cache.add(u,h)),n=h}else if(e.isLine){u="LineBasicMaterial:"+n.uuid;var d=this.cache.get(u);d||(d=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(d,n),d.color.copy(n.color),d.lights=!1,this.cache.add(u,d)),n=d}if(a||o||s||l){u="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),s&&(u+="skinning:"),a&&(u+="vertex-colors:"),o&&(u+="flat-shading:"),l&&(u+="morph-targets:"),c&&(u+="morph-normals:");var p=this.cache.get(u);p||(p=n.isGLTFSpecularGlossinessMaterial?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(n):n.clone(),s&&(p.skinning=!0),a&&(p.vertexColors=THREE.VertexColors),o&&(p.flatShading=!0),l&&(p.morphTargets=!0),c&&(p.morphNormals=!0),this.cache.add(u,p)),n=p}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),t.addAttribute("uv2",new THREE.BufferAttribute(t.attributes.uv.array,2))),n.isGLTFSpecularGlossinessMaterial&&(e.onBeforeRender=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),e.material=n},z.prototype.loadMaterial=function(e){var t,n=this.json,i=this.extensions,a=n.materials[e],o={},s=a.extensions||{},l=[];if(s[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(),l.push(c.extendParams(o,a,this))}else if(s[r.KHR_MATERIALS_UNLIT]){var u=i[r.KHR_MATERIALS_UNLIT];t=u.getMaterialType(),l.push(u.extendParams(o,a,this))}else{t=THREE.MeshStandardMaterial;var h=a.pbrMetallicRoughness||{};if(o.color=new THREE.Color(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var d=h.baseColorFactor;o.color.fromArray(d),o.opacity=d[3]}void 0!==h.baseColorTexture&&l.push(this.assignTexture(o,"map",h.baseColorTexture)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))}!0===a.doubleSided&&(o.side=THREE.DoubleSide);var p=a.alphaMode||P;return p===C?o.transparent=!0:(o.transparent=!1,p===L&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new THREE.Vector2(1,1),void 0!==a.normalTexture.scale&&o.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(o.emissive=(new THREE.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==THREE.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",a.emissiveTexture)),Promise.all(l).then(function(){var e;return e=t===THREE.ShaderMaterial?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),void 0!==a.name&&(e.name=a.name),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),O(e,a),a.extensions&&k(i,e,a),e})},z.prototype.loadGeometries=function(e){var t=this,n=this.extensions,i=this.primitiveCache;function a(e){return n[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return U(r,e,t)})}for(var o,s,l=[],c=0,u=e.length;c<u;c++){var h,d=e[c],p=(s=void 0,(s=(o=d).extensions&&o.extensions[r.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+F(s.attributes):o.indices+":"+F(o.attributes)+":"+o.mode),f=i[p];if(f)l.push(f.promise);else h=d.extensions&&d.extensions[r.KHR_DRACO_MESH_COMPRESSION]?a(d):U(new THREE.BufferGeometry,d,t),i[p]={primitive:d,promise:h},l.push(h)}return Promise.all(l)},z.prototype.loadMesh=function(e){for(var t=this,r=this.json.meshes[e],n=r.primitives,i=[],a=0,o=n.length;a<o;a++){var s=void 0===n[a].material?f=f||new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",n[a].material);i.push(s)}return Promise.all(i).then(function(i){return t.loadGeometries(n).then(function(a){for(var o=[],s=0,l=a.length;s<l;s++){var c,u=a[s],h=n[s],d=i[s];if(h.mode===E||h.mode===x||h.mode===b||void 0===h.mode)!0!==(c=!0===r.isSkinnedMesh?new THREE.SkinnedMesh(u,d):new THREE.Mesh(u,d)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),h.mode===x?c.drawMode=THREE.TriangleStripDrawMode:h.mode===b&&(c.drawMode=THREE.TriangleFanDrawMode);else if(h.mode===v)c=new THREE.LineSegments(u,d);else if(h.mode===y)c=new THREE.Line(u,d);else if(h.mode===g)c=new THREE.LineLoop(u,d);else{if(h.mode!==m)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);c=new THREE.Points(u,d)}Object.keys(c.geometry.morphAttributes).length>0&&N(c,r),c.name=r.name||"mesh_"+e,a.length>1&&(c.name+="_"+s),O(c,r),t.assignFinalMaterial(c),o.push(c)}if(1===o.length)return o[0];var p=new THREE.Group;for(s=0,l=o.length;s<l;s++)p.add(o[s]);return p})})},z.prototype.loadCamera=function(e){var t,r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new THREE.OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)),void 0!==r.name&&(t.name=r.name),O(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},z.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},z.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],r=[],n=[],i=[],a=[],o=[],s=0,l=t.channels.length;s<l;s++){var c=t.channels[s],u=t.samplers[c.sampler],h=c.target,d=void 0!==h.node?h.node:h.id,f=void 0!==t.parameters?t.parameters[u.input]:u.input,m=void 0!==t.parameters?t.parameters[u.output]:u.output;r.push(this.getDependency("node",d)),n.push(this.getDependency("accessor",f)),i.push(this.getDependency("accessor",m)),a.push(u),o.push(h)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o)]).then(function(r){for(var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],l=[],c=0,u=n.length;c<u;c++){var h=n[c],d=i[c],f=a[c],m=o[c],v=s[c];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,S[v.path]){case S.weights:g=THREE.NumberKeyframeTrack;break;case S.rotation:g=THREE.QuaternionKeyframeTrack;break;case S.position:case S.scale:default:g=THREE.VectorKeyframeTrack}var y=h.name?h.name:h.uuid,E=void 0!==m.interpolation?A[m.interpolation]:THREE.InterpolateLinear,x=[];S[v.path]===S.weights?h.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&x.push(e.name?e.name:e.uuid)}):x.push(y);var b=f.array;if(f.normalized){var T;if(b.constructor===Int8Array)T=1/127;else if(b.constructor===Uint8Array)T=1/255;else if(b.constructor==Int16Array)T=1/32767;else{if(b.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");T=1/65535}for(var w=new Float32Array(b.length),_=0,R=b.length;_<R;_++)w[_]=b[_]*T;b=w}for(_=0,R=x.length;_<R;_++){var M=new g(x[_]+"."+S[v.path],d.array,b,E);"CUBICSPLINE"===m.interpolation&&(M.createInterpolant=function(e){return new p(this.times,this.values,this.getValueSize()/3,e)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(M)}}}var P=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(P,void 0,l)})},z.prototype.loadNode=function(e){var t=this.json,n=this.extensions,i=this,a=t.meshReferences,o=t.meshUses,s=t.nodes[e];return(!0===s.isBone?Promise.resolve(new THREE.Bone):void 0!==s.mesh?i.getDependency("mesh",s.mesh).then(function(e){var t;if(a[s.mesh]>1){var r=o[s.mesh]++;(t=e.clone()).name+="_instance_"+r,t.onBeforeRender=e.onBeforeRender;for(var n=0,i=t.children.length;n<i;n++)t.children[n].name+="_instance_"+r,t.children[n].onBeforeRender=e.children[n].onBeforeRender}else t=e;return void 0!==s.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,r=s.weights.length;t<r;t++)e.morphTargetInfluences[t]=s.weights[t]}),t}):void 0!==s.camera?i.getDependency("camera",s.camera):s.extensions&&s.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==s.extensions[r.KHR_LIGHTS_PUNCTUAL].light?i.getDependency("light",s.extensions[r.KHR_LIGHTS_PUNCTUAL].light):Promise.resolve(new THREE.Object3D)).then(function(e){if(void 0!==s.name&&(e.userData.name=s.name,e.name=THREE.PropertyBinding.sanitizeNodeName(s.name)),O(e,s),s.extensions&&k(n,e,s),void 0!==s.matrix){var t=new THREE.Matrix4;t.fromArray(s.matrix),e.applyMatrix(t)}else void 0!==s.translation&&e.position.fromArray(s.translation),void 0!==s.rotation&&e.quaternion.fromArray(s.rotation),void 0!==s.scale&&e.scale.fromArray(s.scale);return e})},z.prototype.loadScene=function(){function e(t,r,n,i){var a=n.nodes[t];return i.getDependency("node",t).then(function(e){return void 0===a.skin?e:i.getDependency("skin",a.skin).then(function(e){for(var r=[],n=0,a=(t=e).joints.length;n<a;n++)r.push(i.getDependency("node",t.joints[n]));return Promise.all(r)}).then(function(r){for(var n=!0===e.isGroup?e.children:[e],i=0,a=n.length;i<a;i++){for(var o=n[i],s=[],l=[],c=0,u=r.length;c<u;c++){var h=r[c];if(h){s.push(h);var d=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&d.fromArray(t.inverseBindMatrices.array,16*c),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}o.bind(new THREE.Skeleton(s,l),o.matrixWorld)}return e});var t}).then(function(t){r.add(t);var o=[];if(a.children)for(var s=a.children,l=0,c=s.length;l<c;l++){var u=s[l];o.push(e(u,t,n,i))}return Promise.all(o)})}return function(t){var r=this.json,n=this.extensions,i=this.json.scenes[t],a=new THREE.Scene;void 0!==i.name&&(a.name=i.name),O(a,i),i.extensions&&k(n,a,i);for(var o=i.nodes||[],s=[],l=0,c=o.length;l<c;l++)s.push(e(o[l],a,r,this));return Promise.all(s).then(function(){return a})}}(),e}()},function(e,t){var r={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},n={};n[THREE.NearestFilter]=r.NEAREST,n[THREE.NearestMipMapNearestFilter]=r.NEAREST_MIPMAP_NEAREST,n[THREE.NearestMipMapLinearFilter]=r.NEAREST_MIPMAP_LINEAR,n[THREE.LinearFilter]=r.LINEAR,n[THREE.LinearMipMapNearestFilter]=r.LINEAR_MIPMAP_NEAREST,n[THREE.LinearMipMapLinearFilter]=r.LINEAR_MIPMAP_LINEAR,n[THREE.ClampToEdgeWrapping]=r.CLAMP_TO_EDGE,n[THREE.RepeatWrapping]=r.REPEAT,n[THREE.MirroredRepeatWrapping]=r.MIRRORED_REPEAT;var i={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(e,t,a){(a=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1},a)).animations.length>0&&(a.trs=!0);var o,s={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},l=0,c=[],u=[],h=new Map,d=[],p={},f={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},m=new Map,v=0;function g(e){return m.has(e)||m.set(e,v++),m.get(e)}function y(e,t){return e.length===t.length&&e.every(function(e,r){return e===t[r]})}function E(e){return 4*Math.ceil(e/4)}function x(e,t){t=t||0;var r=E(e.byteLength);if(r!==e.byteLength){var n=new Uint8Array(r);if(n.set(new Uint8Array(e)),0!==t)for(var i=e.byteLength;i<r;i++)n[i]=t;return n.buffer}return e}function b(e,t){if(0!==Object.keys(e.userData).length)try{var r=JSON.parse(JSON.stringify(e.userData));if(a.includeCustomExtensions&&r.gltfExtensions){for(var n in void 0===t.extensions&&(t.extensions={}),r.gltfExtensions)t.extensions[n]=r.gltfExtensions[n],p[n]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}function T(e,t){var r=!1,n={};0===t.offset.x&&0===t.offset.y||(n.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(n.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(n.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=n,p.KHR_texture_transform=!0)}function w(e){return s.buffers||(s.buffers=[{byteLength:0}]),c.push(e),0}function _(e,t,n,i){var o;if(e.array.constructor===Float32Array)o=r.FLOAT;else if(e.array.constructor===Uint32Array)o=r.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)o=r.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");o=r.UNSIGNED_BYTE}if(void 0===n&&(n=0),void 0===i&&(i=e.count),a.truncateDrawRange&&void 0!==t&&null===t.index){var c=n+i,u=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;n=Math.max(n,t.drawRange.start),(i=Math.min(c,u)-n)<0&&(i=0)}if(0===i)return null;var h,d=function(e,t,r){for(var n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},i=t;i<t+r;i++)for(var a=0;a<e.itemSize;a++){var o=e.array[i*e.itemSize+a];n.min[a]=Math.min(n.min[a],o),n.max[a]=Math.max(n.max[a],o)}return n}(e,n,i);void 0!==t&&(h=e===t.index?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER);var p=function(e,t,n,i,a){var o;s.bufferViews||(s.bufferViews=[]),o=t===r.UNSIGNED_BYTE?1:t===r.UNSIGNED_SHORT?2:4;for(var c=E(i*e.itemSize*o),u=new DataView(new ArrayBuffer(c)),h=0,d=n;d<n+i;d++)for(var p=0;p<e.itemSize;p++){var f=e.array[d*e.itemSize+p];t===r.FLOAT?u.setFloat32(h,f,!0):t===r.UNSIGNED_INT?u.setUint32(h,f,!0):t===r.UNSIGNED_SHORT?u.setUint16(h,f,!0):t===r.UNSIGNED_BYTE&&u.setUint8(h,f),h+=o}var m={buffer:w(u.buffer),byteOffset:l,byteLength:c};return void 0!==a&&(m.target=a),a===r.ARRAY_BUFFER&&(m.byteStride=e.itemSize*o),l+=c,s.bufferViews.push(m),{id:s.bufferViews.length-1,byteLength:0}}(e,o,n,i,h),f={bufferView:p.id,byteOffset:p.byteOffset,componentType:o,count:i,max:d.max,min:d.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return s.accessors||(s.accessors=[]),s.accessors.push(f),s.accessors.length-1}function R(e,t,r){f.images.has(e)||f.images.set(e,{});var n=f.images.get(e),i=t===THREE.RGBAFormat?"image/png":"image/jpeg",c=i+":flipY/"+r.toString();if(void 0!==n[c])return n[c];s.images||(s.images=[]);var h={mimeType:i};if(a.embedImages){var d=o=o||document.createElement("canvas");d.width=e.width,d.height=e.height,a.forcePowerOfTwoTextures&&!function(e){return THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)}(e)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e),d.width=THREE.Math.floorPowerOfTwo(d.width),d.height=THREE.Math.floorPowerOfTwo(d.height));var p=d.getContext("2d");!0===r&&(p.translate(0,d.height),p.scale(1,-1)),p.drawImage(e,0,0,d.width,d.height),!0===a.binary?u.push(new Promise(function(e){d.toBlob(function(t){(function(e){return s.bufferViews||(s.bufferViews=[]),new Promise(function(t){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=x(r.result),n={buffer:w(e),byteOffset:l,byteLength:e.byteLength};l+=e.byteLength,s.bufferViews.push(n),t(s.bufferViews.length-1)}})})(t).then(function(t){h.bufferView=t,e()})},i)})):h.uri=d.toDataURL(i)}else h.uri=e.src;s.images.push(h);var m=s.images.length-1;return n[c]=m,m}function M(e){s.samplers||(s.samplers=[]);var t={magFilter:n[e.magFilter],minFilter:n[e.minFilter],wrapS:n[e.wrapS],wrapT:n[e.wrapT]};return s.samplers.push(t),s.samplers.length-1}function S(e){if(f.textures.has(e))return f.textures.get(e);s.textures||(s.textures=[]);var t={sampler:M(e),source:R(e.image,e.format,e.flipY)};s.textures.push(t);var r=s.textures.length-1;return f.textures.set(e,r),r}function A(e){if(f.materials.has(e))return f.materials.get(e);if(s.materials||(s.materials=[]),e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},p.KHR_materials_unlit=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(y(r,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var n={index:S(e.metalnessMap)};T(n,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=n}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var i={index:S(e.map)};T(i,e.map),t.pbrMetallicRoughness.baseColorTexture=i}if(e.isMeshBasicMaterial||e.isLineBasicMaterial||e.isPointsMaterial);else{var a=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(y(a,[0,0,0])||(t.emissiveFactor=a),e.emissiveMap){var o={index:S(e.emissiveMap)};T(o,e.emissiveMap),t.emissiveTexture=o}}if(e.normalMap){var l={index:S(e.normalMap)};-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),l.scale=e.normalScale.x),T(l,e.normalMap),t.normalTexture=l}if(e.aoMap){var c={index:S(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(c.strength=e.aoMapIntensity),T(c,e.aoMap),t.occlusionTexture=c}(e.transparent||e.alphaTest>0)&&(t.alphaMode=e.opacity<1?"BLEND":"MASK",e.alphaTest>0&&.5!==e.alphaTest&&(t.alphaCutoff=e.alphaTest)),e.side===THREE.DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),b(e,t),s.materials.push(t);var u=s.materials.length-1;return f.materials.set(e,u),u}function P(e){var t=e.geometry.uuid+":"+e.material.uuid;if(f.meshes.has(t))return f.meshes.get(t);var n,i=e.geometry;if(e.isLineSegments)n=r.LINES;else if(e.isLineLoop)n=r.LINE_LOOP;else if(e.isLine)n=r.LINE_STRIP;else if(e.isPoints)n=r.POINTS;else{if(!i.isBufferGeometry){console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use THREE.BufferGeometry instead.");var o=new THREE.BufferGeometry;o.fromGeometry(i),i=o}e.drawMode===THREE.TriangleFanDrawMode?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),n=r.TRIANGLE_FAN):n=e.drawMode===THREE.TriangleStripDrawMode?e.material.wireframe?r.LINE_STRIP:r.TRIANGLE_STRIP:e.material.wireframe?r.LINES:r.TRIANGLES}var l={},c={},u=[],h=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=i.getAttribute("normal");void 0===p||function(e){if(f.attributesNormalized.has(e))return!1;for(var t=new THREE.Vector3,r=0,n=e.count;r<n;r++)if(Math.abs(t.fromArray(e.array,3*r).length()-1)>5e-4)return!1;return!0}(p)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),i.addAttribute("normal",function(e){if(f.attributesNormalized.has(e))return f.attributesNormalized.get(e);for(var t=e.clone(),r=new THREE.Vector3,n=0,i=t.count;n<i;n++)r.fromArray(t.array,3*n),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),r.toArray(t.array,3*n);return f.attributesNormalized.set(e,t),t}(p)));var m=null;for(var v in i.attributes)if("morph"!==v.substr(0,5)){var y=i.attributes[v];v=d[v]||v.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(v)||(v="_"+v),f.attributes.has(g(y)))c[v]=f.attributes.get(g(y));else{m=null;var E=y.array;"JOINTS_0"!==v||E instanceof Uint16Array||E instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),m=new THREE.BufferAttribute(new Uint16Array(E),y.itemSize,y.normalized));var x=_(m||y,i);null!==x&&(c[v]=x,f.attributes.set(g(y),x))}}if(void 0!==p&&i.addAttribute("normal",p),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var T=[],w=[],R={};if(void 0!==e.morphTargetDictionary)for(var M in e.morphTargetDictionary)R[e.morphTargetDictionary[M]]=M;for(var S=0;S<e.morphTargetInfluences.length;++S){var P={},L=!1;for(var v in i.morphAttributes)if("position"===v||"normal"===v){y=i.morphAttributes[v][S];var C=v.toUpperCase(),H=i.attributes[v];if(f.attributes.has(g(y)))P[C]=f.attributes.get(g(y));else{for(var I=y.clone(),k=0,O=y.count;k<O;k++)I.setXYZ(k,y.getX(k)-H.getX(k),y.getY(k)-H.getY(k),y.getZ(k)-H.getZ(k));P[C]=_(I,i),f.attributes.set(g(H),P[C])}}else L||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),L=!0);h.push(P),T.push(e.morphTargetInfluences[S]),void 0!==e.morphTargetDictionary&&w.push(R[S])}l.weights=T,w.length>0&&(l.extras={},l.extras.targetNames=w)}var N=a.forceIndices,F=Array.isArray(e.material);if(F&&0===i.groups.length)return null;!N&&null===i.index&&F&&(console.warn("THREE.GLTFExporter: Creating index for non-indexed multi-material mesh."),N=!0);var D=!1;if(null===i.index&&N){for(var z=[],U=(S=0,i.attributes.position.count);S<U;S++)z[S]=S;i.setIndex(z),D=!0}var B=F?e.material:[e.material],G=F?i.groups:[{materialIndex:0,start:void 0,count:void 0}];for(S=0,U=G.length;S<U;S++){var V={mode:n,attributes:c};if(b(i,V),h.length>0&&(V.targets=h),null!==i.index){t=g(i.index);void 0===G[S].start&&void 0===G[S].count||(t+=":"+G[S].start+":"+G[S].count),f.attributes.has(t)?V.indices=f.attributes.get(t):(V.indices=_(i.index,i,G[S].start,G[S].count),f.attributes.set(t,V.indices)),null===V.indices&&delete V.indices}var j=A(B[G[S].materialIndex]);null!==j&&(V.material=j),u.push(V)}D&&i.setIndex(null),l.primitives=u,s.meshes||(s.meshes=[]),s.meshes.push(l);var W=s.meshes.length-1;return f.meshes.set(t,W),W}function L(e,t){s.animations||(s.animations=[]);for(var r=(e=THREE.GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,n=[],a=[],o=0;o<r.length;++o){var l=r[o],c=THREE.PropertyBinding.parseTrackName(l.name),u=THREE.PropertyBinding.findNode(t,c.nodeName),d=i[c.propertyName];if("bones"===c.objectName&&(u=!0===u.isSkinnedMesh?u.skeleton.getBoneByName(c.objectIndex):void 0),!u||!d)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;var p,f=l.values.length/l.times.length;d===i.morphTargetInfluences&&(f/=u.morphTargetInfluences.length),!0===l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(p="CUBICSPLINE",f/=3):p=l.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",a.push({input:_(new THREE.BufferAttribute(l.times,1)),output:_(new THREE.BufferAttribute(l.values,f)),interpolation:p}),n.push({sampler:a.length-1,target:{node:h.get(u),path:d}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:a,channels:n}),s.animations.length-1}function C(e){var t=s.nodes[h.get(e)],r=e.skeleton,n=e.skeleton.bones[0];if(void 0===n)return null;for(var i=[],a=new Float32Array(16*r.bones.length),o=0;o<r.bones.length;++o)i.push(h.get(r.bones[o])),r.boneInverses[o].toArray(a,16*o);return void 0===s.skins&&(s.skins=[]),s.skins.push({inverseBindMatrices:_(new THREE.BufferAttribute(a,16)),joints:i,skeleton:h.get(n)}),t.skin=s.skins.length-1}function H(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var r=s.extensions.KHR_lights_punctual.lights;return r.push(t),r.length-1}function I(e){s.nodes||(s.nodes=[]);var t={};if(a.trs){var r=e.quaternion.toArray(),n=e.position.toArray(),i=e.scale.toArray();y(r,[0,0,0,1])||(t.rotation=r),y(n,[0,0,0])||(t.translation=n),y(i,[1,1,1])||(t.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),y(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),b(e,t),e.isMesh||e.isLine||e.isPoints){var o=P(e);null!==o&&(t.mesh=o)}else if(e.isCamera)t.camera=function(e){s.cameras||(s.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:THREE.Math.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),s.cameras.push(r),s.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)p.KHR_lights_punctual||(s.extensions=s.extensions||{},s.extensions.KHR_lights_punctual={lights:[]},p.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:H(e)};else if(e.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e),null;if(e.isSkinnedMesh&&d.push(e),e.children.length>0){for(var l=[],c=0,u=e.children.length;c<u;c++){var f=e.children[c];if(f.visible||!1===a.onlyVisible){var m=I(f);null!==m&&l.push(m)}}l.length>0&&(t.children=l)}s.nodes.push(t);var v=s.nodes.length-1;return h.set(e,v),v}function k(e){s.scenes||(s.scenes=[],s.scene=0);var t={nodes:[]};""!==e.name&&(t.name=e.name),e.userData&&Object.keys(e.userData).length>0&&(t.extras=b(e)),s.scenes.push(t);for(var r=[],n=0,i=e.children.length;n<i;n++){var o=e.children[n];if(o.visible||!1===a.onlyVisible){var l=I(o);null!==l&&r.push(l)}}r.length>0&&(t.nodes=r),b(e,t)}!function(e){e=e instanceof Array?e:[e];for(var t=[],r=0;r<e.length;r++)e[r]instanceof THREE.Scene?k(e[r]):t.push(e[r]);for(t.length>0&&function(e){var t=new THREE.Scene;t.name="AuxScene";for(var r=0;r<e.length;r++)t.children.push(e[r]);k(t)}(t),r=0;r<d.length;++r)C(d[r]);for(r=0;r<a.animations.length;++r)L(a.animations[r],e[0])}(e),Promise.all(u).then(function(){var e=new Blob(c,{type:"application/octet-stream"}),r=Object.keys(p);if(r.length>0&&(s.extensionsUsed=r),s.buffers&&s.buffers.length>0){s.buffers[0].byteLength=e.size;var n=new window.FileReader;if(!0===a.binary){n.readAsArrayBuffer(e),n.onloadend=function(){var e=x(n.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,e.byteLength,!0),r.setUint32(4,5130562,!0);var i=x(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),r=0,n=e.length;r<n;r++){var i=e.charCodeAt(r);t[r]=i>255?32:i}return t.buffer}(JSON.stringify(s)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,i.byteLength,!0),a.setUint32(4,1313821514,!0);var o=new ArrayBuffer(12),l=new DataView(o);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);var c=12+a.byteLength+i.byteLength+r.byteLength+e.byteLength;l.setUint32(8,c,!0);var u=new Blob([o,a,i,r,e],{type:"application/octet-stream"}),h=new window.FileReader;h.readAsArrayBuffer(u),h.onloadend=function(){t(h.result)}}}else n.readAsDataURL(e),n.onloadend=function(){var e=n.result;s.buffers[0].uri=e,t(s)}}else t(s)})}},THREE.GLTFExporter.Utils={insertKeyframe:function(e,t){var r,n=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+n),o=e.createInterpolant(new e.ValueBufferType(n));if(0===e.times.length){i[0]=t;for(var s=0;s<n;s++)a[s]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;i[0]=t,i.set(e.times,1),a.set(o.evaluate(t),0),a.set(e.values,n),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),a.set(e.values,0),a.set(o.evaluate(t),e.values.length),r=i.length-1}else for(s=0;s<e.times.length;s++){if(Math.abs(e.times[s]-t)<.001)return s;if(e.times[s]<t&&e.times[s+1]>t){i.set(e.times.slice(0,s+1),0),i[s+1]=t,i.set(e.times.slice(s+1),s+2),a.set(e.values.slice(0,(s+1)*n),0),a.set(o.evaluate(t),(s+1)*n),a.set(e.values.slice((s+1)*n),(s+2)*n),r=s+1;break}}return e.times=i,e.values=a,r},mergeMorphTargetTracks:function(e,t){for(var r=[],n={},i=e.tracks,a=0;a<i.length;++a){var o=i[a],s=THREE.PropertyBinding.parseTrackName(o.name),l=THREE.PropertyBinding.findNode(t,s.nodeName);if("morphTargetInfluences"===s.propertyName&&void 0!==s.propertyIndex){if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(o=o.clone()).setInterpolation(THREE.InterpolateLinear)}var c,u=l.morphTargetInfluences.length,h=l.morphTargetDictionary[s.propertyIndex];if(void 0===h)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);if(void 0!==n[l.uuid]){var d=o.createInterpolant(new o.ValueBufferType(1));c=n[l.uuid];for(m=0;m<c.times.length;m++)c.values[m*u+h]=d.evaluate(c.times[m]);for(m=0;m<o.times.length;m++){var p=this.insertKeyframe(c,o.times[m]);c.values[p*u+h]=o.values[m]}}else{for(var f=new((c=o.clone()).ValueBufferType)(u*c.times.length),m=0;m<c.times.length;m++)f[m*u+h]=c.values[m];c.name=".morphTargetInfluences",c.values=f,n[l.uuid]=c,r.push(c)}}else r.push(o)}return e.tracks=r,e}}},function(e,t,r){"use strict";r.r(t);var n=r(4);THREE.AMFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.AMFLoader.prototype={constructor:THREE.AMFLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e){for(var t="AMF Material",n=e.attributes.id.textContent,i={r:1,g:1,b:1,a:1},a=null,o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(t=s.textContent):"color"===s.nodeName&&(i=r(s))}return a=new THREE.MeshPhongMaterial({flatShading:!0,color:new THREE.Color(i.r,i.g,i.b),name:t}),1!==i.a&&(a.transparent=!0,a.opacity=i.a),{id:n,material:a}}function r(e){for(var t={r:1,g:1,b:1,a:1},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];"r"===n.nodeName?t.r=n.textContent:"g"===n.nodeName?t.g=n.textContent:"b"===n.nodeName?t.b=n.textContent:"a"===n.nodeName&&(t.a=n.textContent)}return t}function i(e){var t={name:"",triangles:[],materialid:null},r=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);r;){if("metadata"===r.nodeName)void 0!==r.attributes.type&&"name"===r.attributes.type.value&&(t.name=r.textContent);else if("triangle"===r.nodeName){var n=r.getElementsByTagName("v1")[0].textContent,i=r.getElementsByTagName("v2")[0].textContent,a=r.getElementsByTagName("v3")[0].textContent;t.triangles.push(n,i,a)}r=r.nextElementSibling}return t}function a(e){for(var t=[],r=[],n=e.firstElementChild;n;){if("vertex"===n.nodeName)for(var i=n.firstElementChild;i;){if("coordinates"===i.nodeName){var a=i.getElementsByTagName("x")[0].textContent,o=i.getElementsByTagName("y")[0].textContent,s=i.getElementsByTagName("z")[0].textContent;t.push(a,o,s)}else if("normal"===i.nodeName){var l=i.getElementsByTagName("nx")[0].textContent,c=i.getElementsByTagName("ny")[0].textContent,u=i.getElementsByTagName("nz")[0].textContent;r.push(l,c,u)}i=i.nextElementSibling}n=n.nextElementSibling}return{vertices:t,normals:r}}function o(e){for(var t=e.attributes.id.textContent,n={name:"amfobject",meshes:[]},o=null,s=e.firstElementChild;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(n.name=s.textContent);else if("color"===s.nodeName)o=r(s);else if("mesh"===s.nodeName){for(var l=s.firstElementChild,c={vertices:[],normals:[],volumes:[],color:o};l;){if("vertices"===l.nodeName){var u=a(l);c.normals=c.normals.concat(u.normals),c.vertices=c.vertices.concat(u.vertices)}else"volume"===l.nodeName&&c.volumes.push(i(l));l=l.nextElementSibling}n.meshes.push(c)}s=s.nextElementSibling}return{id:t,obj:n}}var s,l,c=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var r=null,i=null;console.log("THREE.AMFLoader: Loading Zip");try{r=new n(e)}catch(e){if(e instanceof ReferenceError)return console.log("THREE.AMFLoader: jszip missing and file is compressed."),null}for(i in r.files)if(".amf"===i.toLowerCase().substr(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+i),t=new DataView(r.file(i).asArrayBuffer())}var a=THREE.LoaderUtils.decodeText(t),o=(new DOMParser).parseFromString(a,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):o}(e),u="",h="",d=function(e){var t=1,r="millimeter";void 0!==e.documentElement.attributes.unit&&(r=e.documentElement.attributes.unit.value.toLowerCase());var n={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==n[r]&&(t=n[r]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(c),p={},f={},m=c.documentElement.childNodes;for(s=0;s<m.length;s++){var v=m[s];if("metadata"===v.nodeName)void 0!==v.attributes.type&&("name"===v.attributes.type.value?u=v.textContent:"author"===v.attributes.type.value&&(h=v.textContent));else if("material"===v.nodeName){var g=t(v);p[g.id]=g.material}else if("object"===v.nodeName){var y=o(v);f[y.id]=y.obj}}var E=new THREE.Group,x=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0});for(var b in E.name=u,E.userData.author=h,E.userData.loader="AMF",f){var T=f[b],w=T.meshes,_=new THREE.Group;for(_.name=T.name||"",s=0;s<w.length;s++){var R=x,M=w[s],S=new THREE.Float32BufferAttribute(M.vertices,3),A=null;if(M.normals.length&&(A=new THREE.Float32BufferAttribute(M.normals,3)),M.color){var P=M.color;(R=x.clone()).color=new THREE.Color(P.r,P.g,P.b),1!==P.a&&(R.transparent=!0,R.opacity=P.a)}var L=M.volumes;for(l=0;l<L.length;l++){var C=L[l],H=new THREE.BufferGeometry,I=R;H.setIndex(C.triangles),H.addAttribute("position",S.clone()),A&&H.addAttribute("normal",A.clone()),void 0!==p[C.materialId]&&(I=p[C.materialId]),H.scale(d,d,d),_.add(new THREE.Mesh(H,I.clone()))}}E.add(_)}return E}}},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(41),i=r(42),a=r(43);function o(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|f(t,r),i=(e=s(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|p(t.length);return 0===(e=s(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):d(e,t);if("Buffer"===t.type&&a(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(u(t),e=s(e,t<0?0:0|p(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|p(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function f(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return L(this,t,r);case"utf8":case"utf-8":return M(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return P(this,t,r);case"base64":return R(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var a,o=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,l/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var u=-1;for(a=r;a<s;a++)if(c(e,a)===c(t,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*o}else-1!==u&&(a-=a-u),u=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var h=!0,d=0;d<l;d++)if(c(e,a+d)!==c(t,d)){h=!1;break}if(h)return a}return-1}function E(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function x(e,t,r,n){return V(B(t,e.length-r),e,r,n)}function b(e,t,r,n){return V(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function T(e,t,r,n){return b(e,t,r,n)}function w(e,t,r,n){return V(G(t),e,r,n)}function _(e,t,r,n){return V(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function R(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function M(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,l,c=e[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&c)<<6|63&a)>127&&(u=l);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(l=(15&c)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=h}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=S));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return c(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return u(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return h(null,e)},l.allocUnsafeSlow=function(e){return h(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=f,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(n,i),u=e.slice(t,r),h=0;h<s;++h)if(c[h]!==u[h]){a=c[h],o=u[h];break}return a<o?-1:o<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return x(this,e,t,r);case"ascii":return b(this,e,t,r);case"latin1":case"binary":return T(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function P(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function L(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=U(e[a]);return i}function C(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function H(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function k(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function O(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function N(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function F(e,t,r,n,a){return a||N(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function D(e,t,r,n,a){return a||N(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||H(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||H(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||H(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||H(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||H(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||H(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||H(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||H(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||H(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return t||H(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||H(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||H(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||H(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||H(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||H(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||H(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||H(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||H(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):O(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):O(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return F(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return F(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return D(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return D(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=l.isBuffer(e)?e:B(new l(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var z=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function G(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(z,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(3))},function(e,t,r){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){for(var t,r=c(e),n=r[0],o=r[1],s=new a(function(e,t,r){return 3*(t+r)/4-r}(0,n,o)),l=0,u=o>0?n-4:n,h=0;h<u;h+=4)t=i[e.charCodeAt(h)]<<18|i[e.charCodeAt(h+1)]<<12|i[e.charCodeAt(h+2)]<<6|i[e.charCodeAt(h+3)],s[l++]=t>>16&255,s[l++]=t>>8&255,s[l++]=255&t;2===o&&(t=i[e.charCodeAt(h)]<<2|i[e.charCodeAt(h+1)]>>4,s[l++]=255&t);1===o&&(t=i[e.charCodeAt(h)]<<10|i[e.charCodeAt(h+1)]<<4|i[e.charCodeAt(h+2)]>>2,s[l++]=t>>8&255,s[l++]=255&t);return s},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],o=0,s=r-i;o<s;o+=16383)a.push(u(e,o,o+16383>s?s:o+16383));1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return a.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=o.length;s<l;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=r?i-1:0,d=r?-1:1,p=e[t+h];for(h+=d,a=p&(1<<-u)-1,p>>=-u,u+=s;u>0;a=256*a+e[t+h],h+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),a-=c}return(p?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,l,c=8*a-i-1,u=(1<<c)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:a-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+p]=255&s,p+=f,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[r+p]=255&o,p+=f,o/=256,c-=8);e[r+p-f]|=128*m}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";r.r(t);var n=r(4);THREE.ThreeMFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.availableExtensions=[]},THREE.ThreeMFLoader.prototype={constructor:THREE.ThreeMFLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){var t=this;function r(e){var t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t}function i(e){var t={};t.objectId=e.getAttribute("objectid");var r=e.getAttribute("transform");return r&&(t.transform=a(r)),t}function a(e){var t=[];e.split(" ").forEach(function(e){t.push(parseFloat(e))});var r=new THREE.Matrix4;return r.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),r}function o(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var n=e.getAttribute("pid");n&&(t.pid=n);var a=e.getAttribute("pindex");a&&(t.pindex=a);var o=e.getAttribute("thumbnail");o&&(t.thumbnail=o);var s=e.getAttribute("partnumber");s&&(t.partnumber=s);var l=e.getAttribute("name");l&&(t.name=l);var c=e.querySelector("mesh");c&&(t.mesh=function(e){for(var t={},r=[],n=e.querySelectorAll("vertices vertex"),i=0;i<n.length;i++){var a=n[i],o=a.getAttribute("x"),s=a.getAttribute("y"),l=a.getAttribute("z");r.push(parseFloat(o),parseFloat(s),parseFloat(l))}for(t.vertices=new Float32Array(r.length),i=0;i<r.length;i++)t.vertices[i]=r[i];var c=[],u=[],h=e.querySelectorAll("triangles triangle");for(i=0;i<h.length;i++){var d=h[i],p=d.getAttribute("v1"),f=d.getAttribute("v2"),m=d.getAttribute("v3"),v=d.getAttribute("p1"),g=d.getAttribute("p2"),y=d.getAttribute("p3"),E=d.getAttribute("pid");u.push(parseInt(p,10),parseInt(f,10),parseInt(m,10));var x={};v&&(x.p1=parseInt(v,10)),g&&(x.p2=parseInt(g,10)),y&&(x.p3=parseInt(y,10)),E&&(x.pid=E),0<Object.keys(x).length&&c.push(x)}for(t.triangleProperties=c,t.triangles=new Uint32Array(u.length),i=0;i<u.length;i++)t.triangles[i]=u[i];return t}(c));var u=e.querySelector("components");return u&&(t.components=function(e){for(var t=[],r=e.querySelectorAll("component"),n=0;n<r.length;n++){var a=i(r[n]);t.push(a)}return t}(u)),t}function s(e){var t={},n=e.querySelector("basematerials");n&&(t.basematerials=function(e){for(var t={id:e.getAttribute("id"),basematerials:[]},n=e.querySelectorAll("base"),i=0;i<n.length;i++){var a=r(n[i]);t.basematerials.push(a)}return t}(n)),t.object={};for(var i=e.querySelectorAll("object"),a=0;a<i.length;a++){var s=o(i[a]);t.object[s.id]=s}return t}function l(e){var t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");r&&(t.metadata=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r],i=n.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(t[i]=n.textContent)}return t}(r));var n=e.querySelector("resources");n&&(t.resources=s(n));var i=e.querySelector("build");return i&&(t.build=function(e){for(var t=[],r=e.querySelectorAll("item"),n=0;n<r.length;n++){var i=r[n],o={objectId:i.getAttribute("objectid")},s=i.getAttribute("transform");s&&(o.transform=a(s)),t.push(o)}return t}(i)),t}function c(e,t,r,n){var i=new THREE.BufferGeometry;i.setIndex(new THREE.BufferAttribute(e.triangles,1)),i.addAttribute("position",new THREE.BufferAttribute(e.vertices,3));for(var a,o=r.resources.basematerials,s=e.triangleProperties,l=0,c=0,d=-1,p=0,f=s.length;p<f;p++){var m=s[p],v=m.pid;o&&o.id===v&&(-1===d&&(d=m.p1),d===m.p1?c+=3:(i.addGroup(l,c,d),l+=c,c=3,d=m.p1))}if(i.groups.length>0&&function(e){for(var t=e.groups.sort(function(e,t){return e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start}),r=e.index,n=r.itemSize,i=r.array,a=0,o=new i.constructor(i.length),s=0;s<t.length;s++){var l=t[s],c=l.count*n,u=l.start*n,h=i.subarray(u,u+c);o.set(h,a),a+=c}i.set(o);var d=0;for(s=0;s<t.length;s++)(l=t[s]).start=d,d+=l.count;var p=t[0];for(e.groups=[p],s=1;s<t.length;s++)l=t[s],p.materialIndex===l.materialIndex?p.count+=l.count:(p=l,e.groups.push(p))}(i),i.computeBoundingSphere(),o&&o.id===n.pid){var g=n.pindex;a=u(x=o.basematerials[g],t,r,n,h)}if(i.groups.length>0){var y=i.groups;a=[];for(p=0,f=y.length;p<f;p++){var E=y[p],x=o.basematerials[E.materialIndex];a.push(u(x,t,r,n,h))}}return void 0===a&&(a=new THREE.MeshPhongMaterial({color:11184895,flatShading:!0})),new THREE.Mesh(i,a)}function u(e,t,r,n,i){return void 0!==e.build?e.build:(e.build=i(e,t,r,n),e.build)}function h(e){var t=new THREE.MeshPhongMaterial({flatShading:!0});t.name=e.name;var r=e.displaycolor,n=r.substring(0,7);return t.color.setStyle(n),t.color.convertSRGBToLinear(),9===r.length&&(t.opacity=parseInt(r.charAt(7)+r.charAt(8),16)/255),t}function d(e,t,r){for(var n=new THREE.Group,i=0;i<e.length;i++){var a=e[i],o=t[a.objectId];void 0===o&&(p(a.objectId,t,r),o=t[a.objectId]);var s=o.clone(),l=a.transform;l&&s.applyMatrix(l),n.add(s)}return n}function p(e,r,n){var i=n.resources.object[e];if(i.mesh){var a=i.mesh;!function(e,r,n){if(e){for(var i=[],a=Object.keys(e),o=0;o<a.length;o++)for(var s=a[o],l=0;l<t.availableExtensions.length;l++)(c=t.availableExtensions[l]).ns===s&&i.push(c);for(o=0;o<i.length;o++){var c;(c=i[o]).apply(n,e[c.ns],r)}}}(n.extensions,a,n.xml),r[i.id]=u(a,r,n,i,c)}else{var o=i.components;r[i.id]=u(o,r,n,i,d)}}var f=function(e){var t,r,i=null,a=null,o=[],s=[],c=[],u=[],h={},d={};try{i=new n(e)}catch(e){if(e instanceof ReferenceError)return console.error("THREE.3MFLoader: jszip missing and file is compressed."),null}for(a in i.files)a.match(/\_rels\/.rels$/)?t=a:a.match(/^3D\/.*\.model$/)?o.push(a):a.match(/^3D\/Metadata\/.*\.xml$/)?s.push(a):a.match(/^3D\/Textures\/.*/)?c.push(a):a.match(/^3D\/Other\/.*/)&&u.push(a);var p=new Uint8Array(i.file(t).asArrayBuffer());r=function(e){var t=(new DOMParser).parseFromString(e,"application/xml").querySelector("Relationship"),r=t.getAttribute("Target"),n=t.getAttribute("Id"),i=t.getAttribute("Type");return{target:r,id:n,type:i}}(THREE.LoaderUtils.decodeText(p));for(var f=0;f<o.length;f++){var m=o[f],v=new Uint8Array(i.file(m).asArrayBuffer()),g=THREE.LoaderUtils.decodeText(v),y=(new DOMParser).parseFromString(g,"application/xml");"model"!==y.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",m);var E=y.querySelector("model"),x={};for(f=0;f<E.attributes.length;f++){var b=E.attributes[f];b.name.match(/^xmlns:(.+)$/)&&(x[b.value]=RegExp.$1)}var T=l(E);T.xml=E,0<Object.keys(x).length&&(T.extensions=x),h[m]=T}for(f=0;f<c.length;f++){var w=c[f];d[w]=i.file(w).asBinary()}return{rels:r,model:h,printTicket:{},texture:d,other:{}}}(e);return function(e,t,r){var n=new THREE.Group,i=t.target.substring(1);void 0===r.model[i]&&(i="3D/3dmodel.model");for(var a=r.model[i].build,o=0;o<a.length;o++){var s=a[o],l=e[s.objectId],c=s.transform;c&&l.applyMatrix(c),n.add(l)}return n}(function(e){for(var t=e.model,r={},n=Object.keys(t),i=0;i<n.length;i++)for(var a=t[n[i]],o=Object.keys(a.resources.object),s=0;s<o.length;s++)p(o[s],r,a);return r}(f),f.rels,f)},addExtension:function(e){this.availableExtensions.push(e)}},THREE.ThreeMFLoader.MaterialsAndPropertiesExtension={ns:"http://schemas.microsoft.com/3dmanufacturing/material/2015/02",apply:function(e,t,r){for(var n=e.querySelectorAll("colorgroup"),i=0;i<n.length;i++){var a=n[i];if(a.prefix===t){for(var o=a.getAttribute("id"),s=a.querySelectorAll("color"),l=[],c=0;c<s.length;c++){var u=s[c].getAttribute("color");u.match(/#[0-9a-fA-F]{8}/)?l.push(new THREE.Color(u.substring(0,7))):l.push(new THREE.Color(u))}for(var h=[],d=0;d<r.triangleProperties.length;d++){var p=r.triangleProperties[d];if(p.pid===o){var f=l[p.p1],m=l[p.p2||p.p1],v=l[p.p3||p.p1];h.push(f.r,f.g,f.b),h.push(m.r,m.g,m.b),h.push(v.r,v.g,v.b)}}r.colors=new Float32Array(h.length);for(var g=0;g<h.length;g++)r.colors[g]=h[g]}}}}},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n);THREE.VRMLLoader=function(){if(void 0===i.a)throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.");function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function t(e){this.lexer=new i.a.Lexer(e)}function r(e){i.a.Parser.call(this,e);var t=this,r=e.Version,n=e.LCurly,a=e.RCurly,o=e.LSquare,s=e.RSquare,l=e.Identifier,c=e.RouteIdentifier,u=e.StringLiteral,h=e.NumberLiteral,d=e.TrueLiteral,p=e.FalseLiteral,f=e.NullLiteral,m=e.DEF,v=e.USE,g=e.ROUTE,y=e.TO,E=e.NodeName;t.RULE("vrml",function(){t.SUBRULE(t.version),t.AT_LEAST_ONE(function(){t.SUBRULE(t.node)}),t.MANY(function(){t.SUBRULE(t.route)})}),t.RULE("version",function(){t.CONSUME(r)}),t.RULE("node",function(){t.OPTION(function(){t.SUBRULE(t.def)}),t.CONSUME(E),t.CONSUME(n),t.MANY(function(){t.SUBRULE(t.field)}),t.CONSUME(a)}),t.RULE("field",function(){t.CONSUME(l),t.OR2([{ALT:function(){t.SUBRULE(t.singleFieldValue)}},{ALT:function(){t.SUBRULE(t.multiFieldValue)}}])}),t.RULE("def",function(){t.CONSUME(m),t.CONSUME(l)}),t.RULE("use",function(){t.CONSUME(v),t.CONSUME(l)}),t.RULE("singleFieldValue",function(){t.AT_LEAST_ONE(function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(d)}},{ALT:function(){t.CONSUME(p)}},{ALT:function(){t.CONSUME(f)}}])})}),t.RULE("multiFieldValue",function(){t.CONSUME(o),t.MANY(function(){t.OR([{ALT:function(){t.SUBRULE(t.node)}},{ALT:function(){t.SUBRULE(t.use)}},{ALT:function(){t.CONSUME(u)}},{ALT:function(){t.CONSUME(h)}},{ALT:function(){t.CONSUME(f)}}])}),t.CONSUME(s)}),t.RULE("route",function(){t.CONSUME(g),t.CONSUME(c),t.CONSUME(y),t.CONSUME2(c)}),this.performSelfAnalysis()}function n(e,t,r){this.a=e,this.b=t,this.c=r,this.normal=new THREE.Vector3}return e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.load(e,function(e){t(i.parse(e,a))},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,a){var o={};function s(e){e.DEF&&(o[e.DEF]=e);for(var t=e.fields,r=0,n=t.length;r<n;r++){var i=t[r];if("node"===i.type)for(var a=i.values,l=0,c=a.length;l<c;l++)s(a[l])}}function l(e){return e.USE?(t=e.USE,(r=l(o[t])).isObject3D||r.isMaterial?r.clone():r):void 0!==e.build?e.build:(e.build=function(e){var t,r=e.name;switch(r){case"Group":case"Transform":t=function(e){for(var t=new THREE.Group,r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"center":break;case"children":c(s,t);break;case"rotation":var l=new THREE.Vector3(s[0],s[1],s[2]),u=s[3];t.quaternion.setFromAxisAngle(l,u);break;case"scale":t.scale.set(s[0],s[1],s[2]);break;case"scaleOrientation":break;case"translation":t.position.set(s[0],s[1],s[2]);break;case"bboxCenter":case"bboxSize":break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"Background":t=function(e){for(var t,r,n,i,a=new THREE.Group,o=e.fields,s=0,l=o.length;s<l;s++){var c=o[s],u=c.name,h=c.values;switch(u){case"groundAngle":t=h;break;case"groundColor":r=h;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":n=h;break;case"skyColor":i=h;break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}if(i){var d=1e4,p=new THREE.SphereBufferGeometry(d,32,16),f=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,depthWrite:!1,depthTest:!1});i.length>3?(P(p,d,n,A(i),!0),f.vertexColors=THREE.VertexColors):f.color.setRGB(i[0],i[1],i[2]);var m=new THREE.Mesh(p,f);a.add(m)}if(r&&r.length>0){var v=new THREE.SphereBufferGeometry(d,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),g=new THREE.MeshBasicMaterial({fog:!1,side:THREE.BackSide,vertexColors:THREE.VertexColors,depthWrite:!1,depthTest:!1});P(v,d,t,A(r),!1);var y=new THREE.Mesh(v,g);a.add(y)}return a.renderOrder=-1/0,a}(e);break;case"Shape":t=function(e){for(var t,r,n=e.fields,i=new THREE.MeshBasicMaterial({color:0}),a=0,o=n.length;a<o;a++){var s=n[a],c=s.name,u=s.values;switch(c){case"appearance":null!==u[0]&&(i=l(u[0]));break;case"geometry":null!==u[0]&&(t=l(u[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}if(t&&t.attributes.position){var h=t._type;if("points"===h){var d=new THREE.PointsMaterial({color:16777215});void 0!==t.attributes.color?d.vertexColors=THREE.VertexColors:i.isMeshPhongMaterial&&d.color.copy(i.emissive),r=new THREE.Points(t,d)}else if("line"===h){var p=new THREE.LineBasicMaterial({color:16777215});void 0!==t.attributes.color?p.vertexColors=THREE.VertexColors:i.isMeshPhongMaterial&&p.color.copy(i.emissive),r=new THREE.LineSegments(t,p)}else void 0!==t._solid&&(i.side=t._solid?THREE.FrontSide:THREE.DoubleSide),void 0!==t.attributes.color&&(i.vertexColors=THREE.VertexColors),r=new THREE.Mesh(t,i)}else(r=new THREE.Object3D).visible=!1;return r}(e);break;case"Appearance":t=function(e){for(var t,r=new THREE.MeshPhongMaterial,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,c=o.values;switch(s){case"material":if(null!==c[0]){var u=l(c[0]);u.diffuseColor&&r.color.copy(u.diffuseColor),u.emissiveColor&&r.emissive.copy(u.emissiveColor),u.shininess&&(r.shininess=u.shininess),u.specularColor&&r.specular.copy(u.specularColor),u.transparency&&(r.opacity=1-u.transparency),u.transparency>0&&(r.transparent=!0)}else r=new THREE.MeshBasicMaterial({color:0});break;case"texture":var h=c[0];null!==h&&"ImageTexture"===h.name&&(r.map=l(h));break;case"textureTransform":null!==c[0]&&(t=l(c[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}r.map&&t&&(r.map.center.copy(t.center),r.map.rotation=t.rotation,r.map.repeat.copy(t.scale),r.map.offset.copy(t.translation));return r}(e);break;case"Material":t=function(e){for(var t={},r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"ambientIntensity":break;case"diffuseColor":t.diffuseColor=new THREE.Color(s[0],s[1],s[2]);break;case"emissiveColor":t.emissiveColor=new THREE.Color(s[0],s[1],s[2]);break;case"shininess":t.shininess=s[0];break;case"specularColor":t.emissiveColor=new THREE.Color(s[0],s[1],s[2]);break;case"transparency":t.transparency=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"ImageTexture":t=function(e){for(var t,r=THREE.RepeatWrapping,n=THREE.RepeatWrapping,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,c=s.values;switch(l){case"url":var u=c[0];u&&(t=L.load(u));break;case"repeatS":!1===c[0]&&(r=THREE.ClampToEdgeWrapping);break;case"repeatT":!1===c[0]&&(n=THREE.ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}t&&(t.wrapS=r,t.wrapT=n);return t}(e);break;case"TextureTransform":t=function(e){for(var t={center:new THREE.Vector2,rotation:new THREE.Vector2,scale:new THREE.Vector2,translation:new THREE.Vector2},r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"center":t.center.set(s[0],s[1]);break;case"rotation":t.rotation=s[0];break;case"scale":t.scale.set(s[0],s[1]);break;case"translation":t.translation.set(s[0],s[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"IndexedFaceSet":t=function(e){for(var t,r,i,a,o,s,c,p,f,y=!0,E=!0,x=!0,w=!0,A=e.fields,P=0,L=A.length;P<L;P++){var C=A[P],H=C.name,I=C.values;switch(H){case"color":var k=I[0];null!==k&&(t=l(k));break;case"coord":var O=I[0];null!==O&&(r=l(O));break;case"normal":var N=I[0];null!==N&&(i=l(N));break;case"texCoord":var F=I[0];null!==F&&(a=l(F));break;case"ccw":y=I[0];break;case"colorIndex":s=I;break;case"colorPerVertex":x=I[0];break;case"convex":break;case"coordIndex":c=I;break;case"creaseAngle":o=I[0];break;case"normalIndex":p=I;break;case"normalPerVertex":w=I[0];break;case"solid":E=I[0];break;case"texCoordIndex":f=I;break;default:console.warn("THREE.VRMLLoader: Unknown field:",H)}}if(void 0===c)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new THREE.BufferGeometry;var D,z,U,B,G=u(c,y);if(t)if(!0===x)if(s&&s.length>0){var V=u(s,y);z=b(G,V,t,3)}else z=_(G,new THREE.Float32BufferAttribute(t,3));else if(s&&s.length>0){var j=d(t,s),W=h(j,c);z=T(G,W)}else{var W=h(t,c);z=T(G,W)}if(i)if(!0===w)if(p&&p.length>0){var X=u(p,y);U=b(G,X,i,3)}else U=_(G,new THREE.Float32BufferAttribute(i,3));else if(p&&p.length>0){var Y=d(i,p),q=h(Y,c);U=T(G,q)}else{var q=h(i,c);U=T(G,q)}else U=function(e,t,r){for(var i=[],a={},o=0,s=e.length;o<s;o+=3){var l=e[o],c=e[o+1],u=e[o+2],h=new n(l,c,u);m.fromArray(t,3*l),v.fromArray(t,3*c),g.fromArray(t,3*u),M.subVectors(g,v),R.subVectors(m,v),M.cross(R),M.normalize(),h.normal.copy(M),void 0===a[l]&&(a[l]=[]),void 0===a[c]&&(a[c]=[]),void 0===a[u]&&(a[u]=[]),a[l].push(h.normal),a[c].push(h.normal),a[u].push(h.normal),i.push(h)}for(var d=[],o=0,s=i.length;o<s;o++){var h=i[o],p=S(a[h.a],h.normal,r),f=S(a[h.b],h.normal,r),y=S(a[h.c],h.normal,r);m.fromArray(t,3*h.a),v.fromArray(t,3*h.b),g.fromArray(t,3*h.c),d.push(p.x,p.y,p.z),d.push(f.x,f.y,f.z),d.push(y.x,y.y,y.z)}return new THREE.Float32BufferAttribute(d,3)}(G,r,o);if(a)if(f&&f.length>0){var Q=u(f,y);B=b(G,Q,a,2)}else B=_(G,new THREE.Float32BufferAttribute(a,2));var Z=new THREE.BufferGeometry;D=_(G,new THREE.Float32BufferAttribute(r,3)),Z.addAttribute("position",D),Z.addAttribute("normal",U),z&&Z.addAttribute("color",z);B&&Z.addAttribute("uv",B);return Z._solid=E,Z._type="mesh",Z}(e);break;case"IndexedLineSet":t=function(e){for(var t,r,n,i,a,o=!0,s=e.fields,c=0,u=s.length;c<u;c++){var h=s[c],m=h.name,v=h.values;switch(m){case"color":var g=v[0];null!==g&&(t=l(g));break;case"coord":var y=v[0];null!==y&&(r=l(y));break;case"colorIndex":n=v;break;case"colorPerVertex":o=v[0];break;case"coordIndex":i=v;break;default:console.warn("THREE.VRMLLoader: Unknown field:",m)}}var E=p(i);if(t)if(!0===o)if(n.length>0){var x=p(n);a=b(E,x,t,3)}else a=_(E,new THREE.Float32BufferAttribute(t,3));else if(n.length>0){var T=d(t,n),R=f(T,i);a=w(E,R)}else{var R=f(t,i);a=w(E,R)}var M=new THREE.BufferGeometry,S=_(E,new THREE.Float32BufferAttribute(r,3));M.addAttribute("position",S),a&&M.addAttribute("color",a);return M._type="line",M}(e);break;case"PointSet":t=function(e){for(var t,r,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,c=o.values;switch(s){case"color":var u=c[0];null!==u&&(t=l(u));break;case"coord":var h=c[0];null!==h&&(r=l(h));break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}var d;(d=new THREE.BufferGeometry).addAttribute("position",new THREE.Float32BufferAttribute(r,3)),t&&d.addAttribute("color",new THREE.Float32BufferAttribute(t,3));return d._type="points",d}(e);break;case"Box":t=function(e){for(var t=new THREE.Vector3(2,2,2),r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"size":t.x=s[0],t.y=s[1],t.z=s[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new THREE.BoxBufferGeometry(t.x,t.y,t.z)}(e);break;case"Cone":t=function(e){for(var t=1,r=2,n=!1,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],l=s.name,c=s.values;switch(l){case"bottom":n=!c[0];break;case"bottomRadius":t=c[0];break;case"height":r=c[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}return new THREE.ConeBufferGeometry(t,r,16,1,n)}(e);break;case"Cylinder":t=function(e){for(var t=1,r=2,n=e.fields,i=0,a=n.length;i<a;i++){var o=n[i],s=o.name,l=o.values;switch(s){case"bottom":break;case"radius":t=l[0];break;case"height":r=l[0];break;case"side":case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new THREE.CylinderBufferGeometry(t,t,r,16,1)}(e);break;case"Sphere":t=function(e){for(var t=1,r=e.fields,n=0,i=r.length;n<i;n++){var a=r[n],o=a.name,s=a.values;switch(o){case"radius":t=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return new THREE.SphereBufferGeometry(t,16,16)}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":t=function(e){return e.fields[0].values}(e);break;case"Anchor":case"Billboard":case"Collision":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"WorldInfo":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"ElevationGrid":case"Extrusion":case"Text":case"FontStyle":case"MovieTexture":case"PixelTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",r)}return t}(e),e.build);var t,r}function c(e,t){for(var r=0,n=e.length;r<n;r++){var i=l(e[r]);i instanceof THREE.Object3D&&t.add(i)}}function u(e,t){for(var r=[],n=0,i=0,a=e.length;i<a;i++){var o=e[n],s=e[i+(t?1:2)],l=e[i+(t?2:1)];r.push(o,s,l),(-1===e[i+3]||i+3>=a)&&(n=(i+=3)+1)}return r}function h(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],l=e[o+1],c=e[o+2];r.push(s,l,c),(-1===t[i+3]||i+3>=a)&&(i+=3,n++)}return r}function d(e,t){for(var r=[],n=0,i=t.length;n<i;n++){var a=3*t[n],o=e[a],s=e[a+1],l=e[a+2];r.push(o,s,l)}return r}function p(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],a=e[r+1];t.push(i,a),(-1===e[r+2]||r+2>=n)&&(r+=2)}return t}function f(e,t){for(var r=[],n=0,i=0,a=t.length;i<a;i++){var o=3*n,s=e[o],l=e[o+1],c=e[o+2];r.push(s,l,c),(-1===t[i+2]||i+2>=a)&&(i+=2,n++)}return r}var m=new THREE.Vector3,v=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector2,E=new THREE.Vector2,x=new THREE.Vector2;function b(e,t,r,n){for(var i=[],a=0,o=e.length;a<o;a+=3){var s=t[a],l=t[a+1],c=t[a+2];2===n?(y.fromArray(r,s*n),E.fromArray(r,l*n),x.fromArray(r,c*n),i.push(y.x,y.y),i.push(E.x,E.y),i.push(x.x,x.y)):(m.fromArray(r,s*n),v.fromArray(r,l*n),g.fromArray(r,c*n),i.push(m.x,m.y,m.z),i.push(v.x,v.y,v.z),i.push(g.x,g.y,g.z))}return new THREE.Float32BufferAttribute(i,n)}function T(e,t){for(var r=[],n=0,i=0,a=e.length;n<a;n+=3,i++)m.fromArray(t,3*i),r.push(m.x,m.y,m.z),r.push(m.x,m.y,m.z),r.push(m.x,m.y,m.z);return new THREE.Float32BufferAttribute(r,3)}function w(e,t){for(var r=[],n=0,i=0,a=e.length;n<a;n+=2,i++)m.fromArray(t,3*i),r.push(m.x,m.y,m.z),r.push(m.x,m.y,m.z);return new THREE.Float32BufferAttribute(r,3)}function _(e,t){for(var r=t.array,n=t.itemSize,i=new r.constructor(e.length*n),a=0,o=0,s=0,l=e.length;s<l;s++){a=e[s]*n;for(var c=0;c<n;c++)i[o++]=r[a++]}return new THREE.Float32BufferAttribute(i,n)}var R=new THREE.Vector3,M=new THREE.Vector3;function S(e,t,r){for(var n=t.clone(),i=0,a=e.length;i<a;i++)e[i].angleTo(t)<r&&n.add(e[i]);return n.normalize()}function A(e){for(var t=[],r=0,n=e.length;r<n;r+=3)t.push(new THREE.Color(e[r],e[r+1],e[r+2]));return t}function P(e,t,r,n,i){for(var a=!0===i?1:-1,o=[],s={},l={},c=0;c<r.length;c++){var u={x:a*(Math.cos(r[c])*t),y:a*(Math.sin(r[c])*t)};o.push(u)}for(var h=e.index,d=e.attributes.position,p=new THREE.BufferAttribute(new Float32Array(3*e.attributes.position.count),3),f=new THREE.Vector3,m=new THREE.Color,v=0;v<h.count;v++){var g=h.getX(v);f.fromBufferAttribute(d,g);for(var y=0;y<n.length;y++)if(0===y?(s.x=0,s.y=!0===i?t:-1*t):(s.x=o[y-1].x,s.y=o[y-1].y),void 0!==(l=o[y]))if(!0===(!0===i?f.y<=s.y&&f.y>l.y:f.y>=s.y&&f.y<l.y)){var E=n[y],x=n[y+1],b=Math.abs(f.y-s.y)/(s.y-l.y);m.copy(E).lerp(x,b),p.setXYZ(g,m.r,m.g,m.b)}else{var T=n[!0===i?n.length-1:0];p.setXYZ(g,T.r,T.g,T.b)}}e.addAttribute("color",p)}var L=new THREE.TextureLoader(this.manager);L.setPath(this.resourcePath||a).setCrossOrigin(this.crossOrigin);var C=function(e){var n=function(){for(var e=i.a.createToken,t=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),r=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:t}),n=e({name:"Version",pattern:/#VRML.*/,longer_alt:r}),a=e({name:"NodeName",pattern:new RegExp(["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"].join("|")),longer_alt:r}),o=e({name:"DEF",pattern:/DEF/,longer_alt:r}),s=e({name:"USE",pattern:/USE/,longer_alt:r}),l=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:r}),c=e({name:"TO",pattern:/TO/,longer_alt:r}),u=e({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]+|\\(:?[bfnrtv"\\\/]|u[0-9a-fA-F]{4}))*"/}),h=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),d=e({name:"TrueLiteral",pattern:/TRUE/}),p=e({name:"FalseLiteral",pattern:/FALSE/}),f=e({name:"NullLiteral",pattern:/NULL/}),m=e({name:"LSquare",pattern:/\[/}),v=e({name:"RSquare",pattern:/]/}),g=e({name:"LCurly",pattern:/{/}),y=e({name:"RCurly",pattern:/}/}),E=e({name:"Comment",pattern:/#.*/,group:i.a.Lexer.SKIPPED}),x=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:i.a.Lexer.SKIPPED}),a,o,s,l,c,d,p,f,n,r,t,u,h,m,v,g,y,E],b={},T=0,w=x.length;T<w;T++){var _=x[T];b[_.name]=_}return{tokens:x,tokenVocabulary:b}}(),a=new t(n.tokens),o=new r(n.tokenVocabulary),s=function(e){function t(){e.call(this),this.validateVisitor()}function r(e,t){var r={type:null,values:[]};if(t.node){r.type="node";for(var n=0,i=t.node.length;n<i;n++){var a=t.node[n];r.values.push(e.visit(a))}}if(t.use){r.type="use";for(var n=0,i=t.use.length;n<i;n++){var o=t.use[n];r.values.push(e.visit(o))}}if(t.StringLiteral){r.type="string";for(var n=0,i=t.StringLiteral.length;n<i;n++){var s=t.StringLiteral[n];r.values.push(s.image.replace(/'|"/g,""))}}if(t.NumberLiteral){r.type="number";for(var n=0,i=t.NumberLiteral.length;n<i;n++){var l=t.NumberLiteral[n];r.values.push(parseFloat(l.image))}}if(t.TrueLiteral){r.type="boolean";for(var n=0,i=t.TrueLiteral.length;n<i;n++){var c=t.TrueLiteral[n];"TRUE"===c.image&&r.values.push(!0)}}if(t.FalseLiteral){r.type="boolean";for(var n=0,i=t.FalseLiteral.length;n<i;n++){var u=t.FalseLiteral[n];"FALSE"===u.image&&r.values.push(!1)}}return t.NullLiteral&&(r.type="null",t.NullLiteral.forEach(function(){r.values.push(null)})),r}return t.prototype=Object.assign(Object.create(e.prototype),{constructor:t,vrml:function(e){for(var t={version:this.visit(e.version),nodes:[],routes:[]},r=0,n=e.node.length;r<n;r++){var i=e.node[r];t.nodes.push(this.visit(i))}if(e.route)for(r=0,n=e.route.length;r<n;r++){var a=e.route[r];t.routes.push(this.visit(a))}return t},version:function(e){return e.Version[0].image},node:function(e){var t={name:e.NodeName[0].image,fields:[]};if(e.field)for(var r=0,n=e.field.length;r<n;r++){var i=e.field[r];t.fields.push(this.visit(i))}return e.def&&(t.DEF=this.visit(e.def[0])),t},field:function(e){var t,r={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(t=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(t=this.visit(e.multiFieldValue[0])),r.type=t.type,r.values=t.values,r},def:function(e){return e.Identifier[0].image},use:function(e){return{USE:e.Identifier[0].image}},singleFieldValue:function(e){return r(this,e)},multiFieldValue:function(e){return r(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new t}(o.getBaseCstVisitorConstructor()),l=a.lex(e);o.input=l.tokens;var c=o.vrml();if(o.errors.length>0)throw console.error(o.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return s.visit(c)}(e);if(-1===C.version.indexOf("V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(e){for(var t=e.nodes,r=new THREE.Scene,n=0,i=t.length;n<i;n++)s(t[n]);for(n=0,i=t.length;n<i;n++){var a=l(t[n]);a instanceof THREE.Object3D&&r.add(a)}return r}(C)}},t.prototype={constructor:t,lex:function(e){var t=this.lexer.tokenize(e);if(t.errors.length>0)throw console.error(t.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return t}},r.prototype=Object.create(i.a.Parser.prototype),r.prototype.constructor=r,e}()},function(e,t,r){"use strict";r.r(t);var n=r(8);THREE.FBXLoader=function(){var e,t,r;function i(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function a(e){this.textureLoader=e}function o(){}function s(){}function l(){}function c(){}function u(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function d(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function p(e){return e/46186158e3}i.prototype={constructor:i,crossOrigin:"anonymous",load:function(e,t,r,n){var i=this,a=void 0===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.load(e,function(r){try{t(i.parse(r,a))}catch(t){setTimeout(function(){n&&n(t),i.manager.itemError(e)},0)}},r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,r){if(o="Kaydara FBX Binary  \0",(i=t).byteLength>=o.length&&o===b(i,0,o.length))e=(new c).parse(t);else{var n=b(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function n(t){var n=e[t-1];return e=e.slice(r+t),r++,n}for(var i=0;i<t.length;++i){var a=n(1);if(a===t[i])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(d(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d(n));e=(new l).parse(n)}var i,o;return new a(new THREE.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin)).parse(e)}},a.prototype={constructor:a,parse:function(){t=this.parseConnections();var e=this.parseImages(),n=this.parseTextures(e),i=this.parseMaterials(n),a=this.parseDeformers(),s=(new o).parse(a);return this.parseScene(a,s,i),r},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach(function(e){var r=e[0],n=e[1],i=e[2];t.has(r)||t.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};t.get(r).parents.push(a),t.has(n)||t.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};t.get(n).children.push(o)});return t},parseImages:function(){var t={},r={};if("Video"in e.Objects){var n=e.Objects.Video;for(var i in n){var a=n[i];if(t[c=parseInt(i)]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"==typeof a.Content&&""!==a.Content;if(o||s){var l=this.parseImage(n[i]);r[a.RelativeFilename||a.Filename]=l}}}}for(var c in t){var u=t[c];void 0!==r[u]?t[c]=r[u]:t[c]=t[c].split("\\").pop()}return t},parseImage:function(e){var t,r=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof THREE.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");if(null===THREE.Loader.Handlers.get(".tga")){var a=new THREE.TGALoader;a.setPath(this.textureLoader.path),THREE.Loader.Handlers.add(/\.tga$/i,a)}t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;var o=new Uint8Array(r);return window.URL.createObjectURL(new Blob([o],{type:t}))},parseTextures:function(t){var r=new Map;if("Texture"in e.Objects){var n=e.Objects.Texture;for(var i in n){var a=this.parseTexture(n[i],t);r.set(parseInt(i),a)}}return r},parseTexture:function(e,t){var r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;var n=e.WrapModeU,i=e.WrapModeV,a=void 0!==n?n.value:0,o=void 0!==i?i.value:0;if(r.wrapS=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r.wrapT=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;r.repeat.x=s[0],r.repeat.y=s[1]}return r},loadTexture:function(e,r){var n,i,a=this.textureLoader.path,o=t.get(e.id).children;void 0!==o&&o.length>0&&void 0!==r[o[0].ID]&&(0!==(n=r[o[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var l=THREE.Loader.Handlers.get(".tga");null===l?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",n),i=new THREE.Texture):i=l.load(n)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",n),i=new THREE.Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(a),i},parseMaterials:function(t){var r=new Map;if("Material"in e.Objects){var n=e.Objects.Material;for(var i in n){var a=this.parseMaterial(n[i],t);null!==a&&r.set(parseInt(i),a)}}return r},parseMaterial:function(e,r){var n=e.id,i=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!t.has(n))return null;var o,s=this.parseParameters(e,r,n);switch(a.toLowerCase()){case"phong":o=new THREE.MeshPhongMaterial;break;case"lambert":o=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new THREE.MeshPhongMaterial}return o.setValues(s),o.name=i,o},parseParameters:function(e,r,n){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new THREE.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(i.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new THREE.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(i.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var a=this;return t.get(n).children.forEach(function(e){var t=e.relationship;switch(t){case"Bump":i.bumpMap=a.getTexture(r,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=a.getTexture(r,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=a.getTexture(r,e.ID);break;case"DisplacementColor":i.displacementMap=a.getTexture(r,e.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(r,e.ID);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=a.getTexture(r,e.ID);break;case"ReflectionColor":i.envMap=a.getTexture(r,e.ID),i.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":i.specularMap=a.getTexture(r,e.ID);break;case"TransparentColor":i.alphaMap=a.getTexture(r,e.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}}),i},getTexture:function(r,n){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=t.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var a in i){var o=i[a],s=t.get(parseInt(a));if("Skin"===o.attrType){var l=this.parseSkeleton(s,i);l.ID=a,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,r[a]=l}else if("BlendShape"===o.attrType){var c={id:a};c.rawTargets=this.parseMorphTargets(s,i),c.id=a,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[a]=c}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(e,t){var r=[];return e.children.forEach(function(e){var n=t[e.ID];if("Cluster"===n.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}}),{rawBones:r,bones:[]}},parseMorphTargets:function(e,r){for(var n=[],i=0;i<e.children.length;i++){var a=e.children[i],o=r[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=t.get(parseInt(a.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,n.push(s)}return n},parseScene:function(n,i,a){r=new THREE.Group;var o=this.parseModels(n.skeletons,i,a),l=e.Objects.Model,c=this;o.forEach(function(e){var n=l[e.ID];c.setLookAtProperties(e,n),t.get(e.ID).parents.forEach(function(t){var r=o.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&r.add(e)}),this.bindSkeleton(n.skeletons,i,o),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=y(e.userData.transformData);e.applyMatrix(t)}});var u=(new s).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=u,r=r.children[0]),r.animations=u},parseModels:function(r,n,i){var a=new Map,o=e.Objects.Model;for(var s in o){var l=parseInt(s),c=o[s],u=t.get(l),h=this.buildSkeleton(u,r,l,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(u);break;case"Light":h=this.createLight(u);break;case"Mesh":h=this.createMesh(u,n,i);break;case"NurbsCurve":h=this.createCurve(u,n);break;case"LimbNode":case"Root":h=new THREE.Bone;break;case"Null":default:h=new THREE.Group}h.name=THREE.PropertyBinding.sanitizeNodeName(c.attrName),h.ID=l}this.getTransformData(h,c),a.set(l,h)}return a},buildSkeleton:function(e,t,r,n){var i=null;return e.parents.forEach(function(e){for(var a in t){var o=t[a];o.rawBones.forEach(function(t,a){if(t.ID===e.ID){var s=i;(i=new THREE.Bone).matrixWorld.copy(t.transformLink),i.name=THREE.PropertyBinding.sanitizeNodeName(n),i.ID=r,o.bones[a]=i,null!==s&&i.add(s)}})}}),i},createCamera:function(t){var r,n;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)}),void 0===n)r=new THREE.Object3D;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var a=1;void 0!==n.NearPlane&&(a=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,l=n.AspectHeight.value);var c=s/l,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new THREE.PerspectiveCamera(u,c,a,o),null!==h&&r.setFocalLength(h);break;case 1:r=new THREE.OrthographicCamera(-s/2,s/2,l/2,-l/2,a,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),r=new THREE.Object3D}}return r},createLight:function(t){var r,n;if(t.children.forEach(function(t){var r=e.Objects.NodeAttribute[t.ID];void 0!==r&&(n=r)}),void 0===n)r=new THREE.Object3D;else{var i;i=void 0===n.LightType?0:n.LightType.value;var a=16777215;void 0!==n.Color&&(a=(new THREE.Color).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(i){case 0:r=new THREE.PointLight(a,o,s,1);break;case 1:r=new THREE.DirectionalLight(a,o);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=THREE.Math.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=THREE.Math.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new THREE.SpotLight(a,o,s,l,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),r=new THREE.PointLight(a,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(e,t,r){var n,i=null,a=null,o=[];return e.children.forEach(function(e){t.has(e.ID)&&(i=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))}),o.length>1?a=o:o.length>0?a=o[0]:(a=new THREE.MeshPhongMaterial({color:13421772}),o.push(a)),"color"in i.attributes&&o.forEach(function(e){e.vertexColors=THREE.VertexColors}),i.FBX_Deformer?(o.forEach(function(e){e.skinning=!0}),(n=new THREE.SkinnedMesh(i,a)).normalizeSkinWeights()):n=new THREE.Mesh(i,a),n},createCurve:function(e,t){var r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(r,n)},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?E(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(n,i){"LookAtProperty"in i&&t.get(n.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){var i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){var a=i.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(a),r.add(n.target)):n.lookAt((new THREE.Vector3).fromArray(a))}}})},bindSkeleton:function(e,r,n){var i=this.parsePoseNodes();for(var a in e){var o=e[a];t.get(parseInt(o.ID)).parents.forEach(function(e){if(r.has(e.ID)){var a=e.ID;t.get(a).parents.forEach(function(e){n.has(e.ID)&&n.get(e.ID).bind(new THREE.Skeleton(o.bones),i[e.ID])})}})}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var r=e.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach(function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)}):t[i.Node]=(new THREE.Matrix4).fromArray(i.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],i=t[1],a=t[2];if(0!==n||0!==i||0!==a){var o=new THREE.Color(n,i,a);r.add(new THREE.AmbientLight(o,1))}}},setupMorphMaterials:function(){var e=this;r.traverse(function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach(function(r,n){e.setupMorphMaterial(t,r,n)}):e.setupMorphMaterial(t,t.material))})},setupMorphMaterial:function(e,t,n){var i=e.uuid,a=t.uuid,o=!1;if(r.traverse(function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach(function(t){t.uuid===a&&e.uuid!==i&&(o=!0)}):e.material.uuid===a&&e.uuid!==i&&(o=!0))}),!0===o){var s=t.clone();s.morphTargets=!0,void 0===n?e.material=s:e.material[n]=s}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(r){var n=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var a in i){var o=t.get(parseInt(a)),s=this.parseGeometry(o,i[a],r);n.set(parseInt(a),s)}}return n},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,r,n){var i=n.skeletons,a=n.morphTargets,o=t.parents.map(function(t){return e.Objects.Model[t.ID]});if(0!==o.length){var s=t.children.reduce(function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e},null),l=t.children.reduce(function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e},null),c=o[0],u={};"RotationOrder"in c&&(u.eulerOrder=E(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);var h=y(u);return this.genGeometry(r,s,l,h)}},genGeometry:function(e,t,r,n){var i=new THREE.BufferGeometry;e.attrName&&(i.name=e.attrName);var a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new THREE.Float32BufferAttribute(o.vertex,3);if(n.applyToBufferAttribute(s),i.addAttribute("position",s),o.colors.length>0&&i.addAttribute("color",new THREE.Float32BufferAttribute(o.colors,3)),t&&(i.addAttribute("skinIndex",new THREE.Uint16BufferAttribute(o.weightsIndices,4)),i.addAttribute("skinWeight",new THREE.Float32BufferAttribute(o.vertexWeights,4)),i.FBX_Deformer=t),o.normal.length>0){var l=new THREE.Float32BufferAttribute(o.normal,3);(new THREE.Matrix3).getNormalMatrix(n).applyToBufferAttribute(l),i.addAttribute("normal",l)}if(o.uvs.forEach(function(e,t){var r="uv"+(t+1).toString();0===t&&(r="uv"),i.addAttribute(r,new THREE.Float32BufferAttribute(o.uvs[t],2))}),a.material&&"AllSame"!==a.material.mappingType){var c=o.materialIndex[0],u=0;if(o.materialIndex.forEach(function(e,t){e!==c&&(i.addGroup(u,t-u,c),c=e,u=t)}),i.groups.length>0){var h=i.groups[i.groups.length-1],d=h.start+h.count;d!==o.materialIndex.length&&i.addGroup(d,o.materialIndex.length-d,c)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,e,r,n),i},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var n=0;e.LayerElementUV[n];)r.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[i]})})})),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,i=!1,a=[],o=[],s=[],l=[],c=[],u=[],h=this;return e.vertexIndices.forEach(function(d,p){var f=!1;d<0&&(d^=-1,f=!0);var v=[],g=[];if(a.push(3*d,3*d+1,3*d+2),e.color){var y=m(p,r,d,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach(function(e){g.push(e.weight),v.push(e.id)}),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var E=[0,0,0,0],x=[0,0,0,0];g.forEach(function(e,t){var r=e,n=v[t];x.forEach(function(e,t,i){if(r>e){i[t]=r,r=e;var a=E[t];E[t]=n,n=a}})}),v=E,g=x}for(;g.length<4;)g.push(0),v.push(0);for(var b=0;b<4;++b)c.push(g[b]),u.push(v[b])}if(e.normal){y=m(p,r,d,e.normal);o.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var T=m(p,r,d,e.material)[0];e.uv&&e.uv.forEach(function(e,t){var n=m(p,r,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])}),n++,f&&(h.genFace(t,e,a,T,o,s,l,c,u,n),r++,n=0,a=[],o=[],s=[],l=[],c=[],u=[])}),t},genFace:function(e,t,r,n,i,a,o,s,l,c){for(var u=2;u<c;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(u-1)]),e.colors.push(a[3*(u-1)+1]),e.colors.push(a[3*(u-1)+2]),e.colors.push(a[3*u]),e.colors.push(a[3*u+1]),e.colors.push(a[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(u-1)]),e.uvs[r].push(o[r][2*(u-1)+1]),e.uvs[r].push(o[r][2*u]),e.uvs[r].push(o[r][2*u+1])})},addMorphTargets:function(t,r,n,i){if(null!==n){t.morphAttributes.position=[];var a=this;n.rawTargets.forEach(function(n){var o=e.Objects.Geometry[n.geoID];void 0!==o&&a.genMorphGeometry(t,r,o,i,n.name)})}},genMorphGeometry:function(e,t,r,n,i){var a=new THREE.BufferGeometry;r.attrName&&(a.name=r.attrName);for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],l=void 0!==r.Vertices?r.Vertices.a:[],c=void 0!==r.Indexes?r.Indexes.a:[],u=0;u<c.length;u++){var h=3*c[u];s[h]+=l[3*u],s[h+1]+=l[3*u+1],s[h+2]+=l[3*u+2]}var d={vertexIndices:o,vertexPositions:s},p=this.genBuffers(d),f=new THREE.Float32BufferAttribute(p.vertex,3);f.name=i||r.attrName,n.applyToBufferAttribute(f),e.morphAttributes.position.push(f)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a,i=[];return"IndexToDirect"===r&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a,i=[];return"IndexToDirect"===r&&(i=e.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a,i=[];return"IndexToDirect"===r&&(i=e.ColorIndex.a),{dataSize:4,buffer:n,indices:i,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=e.Materials.a,i=[],a=0;a<n.length;++a)i.push(a);return{dataSize:1,buffer:n,indices:i,mappingType:t,referenceType:r}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var r,n,i=t-1,a=e.KnotVector.a,o=[],s=e.Points.a,l=0,c=s.length;l<c;l+=4)o.push((new THREE.Vector4).fromArray(s,l));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){r=i,n=a.length-1-r;for(l=0;l<i;++l)o.push(o[l])}var u=new THREE.NURBSCurve(i,a,o,r,n).getPoints(7*o.length),h=new Float32Array(3*u.length);u.forEach(function(e,t){e.toArray(h,3*t)});var d=new THREE.BufferGeometry;return d.addAttribute("position",new THREE.BufferAttribute(h,3)),d}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var r in t){var n=t[r],i=this.addClip(n);e.push(i)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var r=this.parseAnimationLayers(t);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,r=new Map;for(var n in t){var i=t[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var a={id:i.id,attr:i.attrName,curves:{}};r.set(a.id,a)}}return r},parseAnimationCurves:function(r){var n=e.Objects.AnimationCurve;for(var i in n){var a={id:n[i].id,times:n[i].KeyTime.a.map(p),values:n[i].KeyValueFloat.a},o=t.get(a.id);if(void 0!==o){var s=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?r.get(s).curves.x=a:l.match(/Y/)?r.get(s).curves.y=a:l.match(/Z/)?r.get(s).curves.z=a:l.match(/d|DeformPercent/)&&r.has(s)&&(r.get(s).curves.morph=a)}}},parseAnimationLayers:function(n){var i=e.Objects.AnimationLayer,a=new Map;for(var o in i){var s=[],l=t.get(parseInt(o));if(void 0!==l)l.children.forEach(function(i,a){if(n.has(i.ID)){var o=n.get(i.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[a])if(void 0!==(p=t.get(i.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID)){var l=e.Objects.Model[p.toString()],c={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse(function(e){e.ID===l.id&&(c.transform=e.matrix,e.userData.transformData&&(c.eulerOrder=e.userData.transformData.eulerOrder))}),c.transform||(c.transform=new THREE.Matrix4),"PreRotation"in l&&(c.preRotation=l.PreRotation.value),"PostRotation"in l&&(c.postRotation=l.PostRotation.value),s[a]=c}s[a]&&(s[a][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===s[a]){var u=t.get(i.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,h=t.get(u).parents[0].ID,d=t.get(h).parents[0].ID,p=t.get(d).parents[0].ID;l=e.Objects.Model[p],c={modelName:THREE.PropertyBinding.sanitizeNodeName(l.attrName),morphName:e.Objects.Deformer[u].attrName};s[a]=c}s[a][o.attr]=o}}}),a.set(parseInt(o),s)}return a},parseAnimStacks:function(r){var n=e.Objects.AnimationStack,i={};for(var a in n){var o=t.get(parseInt(a)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);i[a]={name:n[a].attrName,layer:s}}return i},addClip:function(e){var t=[],r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;if(e.transform&&e.transform.decompose(r,n,i),r=r.toArray(),n=(new THREE.Euler).setFromQuaternion(n,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var o=this.generateRotationTrack(e.modelName,e.R.curves,n,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&t.push(o)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,r,n){var i=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(i,t,r);return new THREE.VectorKeyframeTrack(e+"."+n,i,a)},generateRotationTrack:function(e,t,r,n,i,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.Math.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.Math.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.Math.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,r);void 0!==n&&((n=n.map(THREE.Math.degToRad)).push(a),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n)),void 0!==i&&((i=i.map(THREE.Math.degToRad)).push(a),i=(new THREE.Euler).fromArray(i),i=(new THREE.Quaternion).setFromEuler(i).inverse());for(var l=new THREE.Quaternion,c=new THREE.Euler,u=[],h=0;h<s.length;h+=3)c.set(s[h],s[h+1],s[h+2],a),l.setFromEuler(c),void 0!==n&&l.premultiply(n),void 0!==i&&l.multiply(i),l.toArray(u,h/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",o,u)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map(function(e){return e/100}),i=r.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,r){return r.indexOf(e)==t})},getKeyframeTrackValues:function(e,t,r){var n=r,i=[],a=-1,o=-1,s=-1;return e.forEach(function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var r=t.x.values[a];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==o){var l=t.y.values[o];i.push(l),n[1]=l}else i.push(n[1]);if(-1!==s){var c=t.z.values[s];i.push(c),n[2]=c}else i.push(n[2])}),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var r=e.values[t-1],n=e.values[t]-r,i=Math.abs(n);if(i>=180){for(var a=i/180,o=n/a,s=r+o,l=e.times[t-1],c=(e.times[t]-l)/a,u=l+c,h=[],d=[];u<e.times[t];)h.push(u),u+=c,d.push(s),s+=o;e.times=T(e.times,t,h),e.values=T(e.values,t,d)}}}},l.prototype={constructor:l,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,n){var i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!i&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:r},a=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in o?("PoseNode"===r?o.PoseNode.push(i):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=i)):"number"==typeof a.id?(o[r]={},o[r][a.id]=i):"Properties70"!==r&&(o[r]="PoseNode"===r?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}},parseNodeProperty:function(e,t,r){var n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===n){var o=i.split(",").slice(1),s=parseInt(o[0]),l=parseInt(o[1]),c=i.split(",").slice(3);n="connections",function(e,t){for(var r=0,n=e.length,i=t.length;r<i;r++,n++)e[n]=t[r]}(i=[s,l],c=c.map(function(e){return e.trim().replace(/^"/,"")})),void 0===a[n]&&(a[n]=[])}"Node"===n&&(a.id=i),n in a&&Array.isArray(a[n])?a[n].push(i):"a"!==n?a[n]=i:a.a=i,this.setCurrentProp(a,n),"a"===n&&","!==i.slice(-1)&&(a.a=x(i))}else this.parseNodeSpecialProperty(e,n,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=x(t.a))},parseNodeSpecialProperty:function(e,t,r){var n=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=n[0],a=n[1],o=n[2],s=n[3],l=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=x(l)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}},c.prototype={constructor:c,parse:function(e){var t=new u(e);t.skip(23);var r=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+r);for(var n=new h;!this.endOfContent(t);){var i=this.parseNode(t,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},n=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32(),a=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(a);if(0===n)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(e));var c=s.length>0?s[0]:"",u=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(r.singleProperty=1===i&&e.getOffset()===n;n>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,r,d)}return r.propertyList=s,"number"==typeof c&&(r.id=c),""!==u&&(r.attrName=u),""!==h&&(r.attrType=h),""!==o&&(r.name=o),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(t[r.name]=r,r.a=n):t[r.name]=n}else if("Connections"===e&&"C"===r.name){var i=[];r.propertyList.forEach(function(e,t){0!==t&&i.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===r.name){Object.keys(r).forEach(function(e){t[e]=r[e]})}else if("Properties70"===e&&"P"===r.name){var a,o=r.propertyList[0],s=r.propertyList[1],l=r.propertyList[2],c=r.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[o]={type:s,type2:l,flag:c,value:a}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=e.getUint32(),a=e.getUint32(),o=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}void 0===n.Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var s=new u(new n.Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return s.getBooleanArray(i);case"d":return s.getFloat64Array(i);case"f":return s.getFloat32Array(i);case"i":return s.getInt32Array(i);case"l":return s.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},u.prototype={constructor:u,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],r=0;r<e;r++)t[r]=this.getUint8();var n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var f=[];function m(e,t,r,n){var i;switch(n.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);var a=i*n.dataSize,o=a+n.dataSize;return function(e,t,r,n){for(var i=r,a=0;i<n;i++,a++)e[a]=t[i];return e}(f,n.buffer,a,o)}var v=new THREE.Euler,g=new THREE.Vector3;function y(e){var t,r=new THREE.Matrix4,n=new THREE.Matrix4,i=new THREE.Matrix4,a=new THREE.Matrix4,o=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,c=new THREE.Matrix4,u=new THREE.Matrix4,h=new THREE.Matrix4,d=new THREE.Matrix4,p=e.inheritType?e.inheritType:0;(e.translation&&r.setPosition(g.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(v.fromArray(t)));e.rotation&&((t=e.rotation.map(THREE.Math.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(v.fromArray(t)));e.postRotation&&((t=e.postRotation.map(THREE.Math.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(v.fromArray(t)));e.scale&&o.scale(g.fromArray(e.scale)),e.scalingOffset&&l.setPosition(g.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(g.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(g.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(g.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var f=n.multiply(i).multiply(a),m=new THREE.Matrix4;h.extractRotation(m);var y,E,x,b,T=new THREE.Matrix4;if(T.copyPosition(h),x=T.getInverse(T).multiply(h),E=m.getInverse(m).multiply(x),y=o,0===p)b=m.multiply(f).multiply(E).multiply(y);else if(1===p)b=m.multiply(E).multiply(f).multiply(y);else{var w=(new THREE.Matrix4).copy(o),_=E.multiply(w.getInverse(w));b=m.multiply(f).multiply(_).multiply(y)}var R=r.multiply(c).multiply(u).multiply(n).multiply(i).multiply(a).multiply(u.getInverse(u)).multiply(l).multiply(s).multiply(o).multiply(s.getInverse(s)),M=(new THREE.Matrix4).copyPosition(R),S=h.multiply(M);return d.copyPosition(S),R=d.multiply(b)}function E(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function x(e){return e.split(",").map(function(e){return parseFloat(e)})}function b(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,r))}function T(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return i}()},function(e,t,r){"use strict";r.r(t);var n=r(10);THREE.NRRDLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.NRRDLoader.prototype={constructor:THREE.NRRDLoader,load:function(e,t,r,n){var i=this,a=new THREE.FileLoader(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(i.parse(e))},r,n)},setPath:function(e){return this.path=e,this},parse:function(e){var t=e,r=0,i=new Int8Array(new Int16Array([1]).buffer)[0]>0,a=!0,o={};var s=function(e,n){null==n&&(n=1);var o=1,s=Uint8Array;switch(e){case"uchar":break;case"schar":s=Int8Array;break;case"ushort":s=Uint16Array,o=2;break;case"sshort":s=Int16Array,o=2;break;case"uint":s=Uint32Array,o=4;break;case"sint":s=Int32Array,o=4;break;case"float":s=Float32Array,o=4;break;case"complex":case"double":s=Float64Array,o=8}var l=new s(t.slice(r,r+=n*o));return i!=a&&(l=function(e,t){for(var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=0;n<e.byteLength;n+=t)for(var i=n+t-1,a=n;i>a;i--,a++){var o=r[a];r[a]=r[i],r[i]=o}return e}(l,o)),1==n?l[0]:l}("uchar",e.byteLength),l=s.length,c=null,u=0;for(p=1;p<l;p++)if(10==s[p-1]&&10==s[p]){c=this.parseChars(s,0,p-2),u=p+1;break}!function(e){var t,r,n,i,a,s,l,c,u;for(c=0,u=(s=e.split(/\r?\n/)).length;c<u;c++)(a=s[c]).match(/NRRD\d+/)?o.isNrrd=!0:a.match(/^#/)||(l=a.match(/(.*):(.*)/))&&(r=l[1].trim(),t=l[2].trim(),(n=THREE.NRRDLoader.prototype.fieldFunctions[r])?n.call(o,t):o[r]=t);if(!o.isNrrd)throw new Error("Not an NRRD file");if("bz2"===o.encoding||"bzip2"===o.encoding)throw new Error("Bzip is not supported");if(!o.vectors&&(o.vectors=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],o.spacings))for(i=0;i<=2;i++)isNaN(o.spacings[i])||o.vectors[i].multiplyScalar(o.spacings[i])}(c);t=s.subarray(u);if("gzip"===o.encoding||"gz"===o.encoding){var h=new n.Zlib.Gunzip(new Uint8Array(t));t=h.decompress()}else if("ascii"===o.encoding||"text"===o.encoding||"txt"===o.encoding||"hex"===o.encoding)t=function(e,t,r){var n,i="";t=t||0,r=r||e.length;var a=o.sizes.reduce(function(e,t){return e*t},1),s=10;"hex"===o.encoding&&(s=16);var l=new o.__array(a),c=0,u=parseInt;o.__array!==Float32Array&&o.__array!==Float64Array||(u=parseFloat);for(var h=t;h<r;h++)((n=e[h])<9||n>13)&&32!==n?i+=String.fromCharCode(n):(""!==i&&(l[c]=u(i,s),c++),i="");return""!==i&&(l[c]=u(i,s),c++),l}(t);else if("raw"===o.encoding){for(var d=new Uint8Array(t.length),p=0;p<t.length;p++)d[p]=t[p];t=d}t=t.buffer;var f=new THREE.Volume;f.header=o,f.data=new o.__array(t);var m=f.computeMinMax(),v=m[0],g=m[1];f.windowLow=v,f.windowHigh=g,f.dimensions=[o.sizes[0],o.sizes[1],o.sizes[2]],f.xLength=f.dimensions[0],f.yLength=f.dimensions[1],f.zLength=f.dimensions[2];var y=new THREE.Vector3(o.vectors[0][0],o.vectors[0][1],o.vectors[0][2]).length(),E=new THREE.Vector3(o.vectors[1][0],o.vectors[1][1],o.vectors[1][2]).length(),x=new THREE.Vector3(o.vectors[2][0],o.vectors[2][1],o.vectors[2][2]).length();f.spacing=[y,E,x],f.matrix=new THREE.Matrix4;var b=1,T=1;if("left-posterior-superior"==o.space?(b=-1,T=-1):"left-anterior-superior"===o.space&&(b=-1),o.vectors){var w=o.vectors;f.matrix.set(b*w[0][0],b*w[1][0],b*w[2][0],0,T*w[0][1],T*w[1][1],T*w[2][1],0,1*w[0][2],1*w[1][2],1*w[2][2],0,0,0,0,1)}else f.matrix.set(b,0,0,0,0,T,0,0,0,0,1,0,0,0,0,1);return f.inverseMatrix=new THREE.Matrix4,f.inverseMatrix.getInverse(f.matrix),f.RASDimensions=new THREE.Vector3(f.xLength,f.yLength,f.zLength).applyMatrix4(f.matrix).round().toArray().map(Math.abs),f.lowerThreshold===-1/0&&(f.lowerThreshold=v),f.upperThreshold===1/0&&(f.upperThreshold=g),f},parseChars:function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);var n="",i=0;for(i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n},fieldFunctions:{type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){var t;return this.sizes=function(){var r,n,i,a;for(a=[],r=0,n=(i=e.split(/\s+/)).length;r<n;r++)t=i[r],a.push(parseInt(t,10));return a}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){var t,r,n;return r=e.match(/\(.*?\)/g),this.vectors=function(){var e,i,a;for(a=[],e=0,i=r.length;e<i;e++)n=r[e],a.push(function(){var e,r,i,a;for(a=[],e=0,r=(i=n.slice(1,-1).split(/,/)).length;e<r;e++)t=i[e],a.push(parseFloat(t));return a}());return a}()},spacings:function(e){var t,r;return r=e.split(/\s+/),this.spacings=function(){var e,n,i=[];for(e=0,n=r.length;e<n;e++)t=r[e],i.push(parseFloat(t));return i}()}}}},function(module,exports){THREE.Volume=function(e,t,r,n,i){if(arguments.length>0){switch(this.xLength=Number(e)||1,this.yLength=Number(t)||1,this.zLength=Number(r)||1,n){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(i);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(i);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(i);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(i);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(i);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32":case"uint32_t":this.data=new Uint32Array(i);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw"Error in THREE.Volume constructor : this type is not supported in JavaScript";case"Float32":case"float32":case"float":this.data=new Float32Array(i);break;case"Float64":case"float64":case"double":this.data=new Float64Array(i);break;default:this.data=new Uint8Array(i)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw"Error in THREE.Volume constructor, lengths are not matching arrayBuffer size"}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new THREE.Matrix3,this.matrix.identity();var a=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return a},set:function(e){a=e,this.sliceList.forEach(function(e){e.geometryNeedsUpdate=!0})}});var o=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return o},set:function(e){o=e,this.sliceList.forEach(function(e){e.geometryNeedsUpdate=!0})}}),this.sliceList=[];var s=this;Object.defineProperty(this,"window",{get:function(){return s.windowHigh-s.windowLow},set:function(e){var t=(s.windowHigh+s.windowLow)/2;s.windowHigh=t+e/2,s.windowLow=t-e/2}}),Object.defineProperty(this,"level",{get:function(){return(s.windowHigh+s.windowLow)/2},set:function(e){var t=(s.windowHigh+s.windowLow)/2;s.windowHigh+=e-t,s.windowLow+=e-t}})},THREE.Volume.prototype={constructor:THREE.Volume,getData:function(e,t,r){return this.data[r*this.xLength*this.yLength+t*this.xLength+e]},access:function(e,t,r){return r*this.xLength*this.yLength+t*this.xLength+e},reverseAccess:function(e){var t=Math.floor(e/(this.yLength*this.xLength)),r=Math.floor((e-t*this.yLength*this.xLength)/this.xLength);return[e-t*this.yLength*this.xLength-r*this.xLength,r,t]},map:function(e,t){var r=this.data.length;t=t||this;for(var n=0;n<r;n++)this.data[n]=e.call(t,this.data[n],n,this.data);return this},extractPerpendicularPlane:function(axis,RASIndex){var iLength,jLength,sliceAccess,planeMatrix=(new THREE.Matrix4).identity(),volume=this,planeWidth,planeHeight,firstSpacing,secondSpacing,positionOffset,IJKIndex,maxIndex,axisInIJK=new THREE.Vector3,firstDirection=new THREE.Vector3,secondDirection=new THREE.Vector3,dimensions=new THREE.Vector3(this.xLength,this.yLength,this.zLength);switch(axis){case"x":axisInIJK.set(1,0,0),firstDirection.set(0,0,-1),secondDirection.set(0,-1,0),firstSpacing=this.spacing[2],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(RASIndex,0,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationY(Math.PI/2)),positionOffset=(volume.RASDimensions[0]-1)/2,planeMatrix.setPosition(new THREE.Vector3(RASIndex-positionOffset,0,0)),maxIndex=volume.RASDimensions[0]-1;break;case"y":axisInIJK.set(0,1,0),firstDirection.set(1,0,0),secondDirection.set(0,0,1),firstSpacing=this.spacing[0],secondSpacing=this.spacing[2],IJKIndex=new THREE.Vector3(0,RASIndex,0),planeMatrix.multiply((new THREE.Matrix4).makeRotationX(-Math.PI/2)),positionOffset=(volume.RASDimensions[1]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,RASIndex-positionOffset,0)),maxIndex=volume.RASDimensions[1]-1;break;case"z":axisInIJK.set(0,0,1),firstDirection.set(1,0,0),secondDirection.set(0,-1,0),firstSpacing=this.spacing[0],secondSpacing=this.spacing[1],IJKIndex=new THREE.Vector3(0,0,RASIndex),positionOffset=(volume.RASDimensions[2]-1)/2,planeMatrix.setPosition(new THREE.Vector3(0,0,RASIndex-positionOffset)),maxIndex=volume.RASDimensions[2]-1;break;default:throw"wrong axis"}firstDirection.applyMatrix4(volume.inverseMatrix).normalize(),firstDirection.argVar="i",secondDirection.applyMatrix4(volume.inverseMatrix).normalize(),secondDirection.argVar="j",axisInIJK.applyMatrix4(volume.inverseMatrix).normalize(),iLength=Math.floor(Math.abs(firstDirection.dot(dimensions))),jLength=Math.floor(Math.abs(secondDirection.dot(dimensions))),planeWidth=Math.abs(iLength*firstSpacing),planeHeight=Math.abs(jLength*secondSpacing),IJKIndex=Math.abs(Math.round(IJKIndex.applyMatrix4(volume.inverseMatrix).dot(axisInIJK)));var base=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)],iDirection=[firstDirection,secondDirection,axisInIJK].find(function(e){return Math.abs(e.dot(base[0]))>.9}),jDirection=[firstDirection,secondDirection,axisInIJK].find(function(e){return Math.abs(e.dot(base[1]))>.9}),kDirection=[firstDirection,secondDirection,axisInIJK].find(function(e){return Math.abs(e.dot(base[2]))>.9}),argumentsWithInversion=["volume.xLength-1-","volume.yLength-1-","volume.zLength-1-"],argArray=[iDirection,jDirection,kDirection].map(function(e,t){return(e.dot(base[t])>0?"":argumentsWithInversion[t])+(e===axisInIJK?"IJKIndex":e.argVar)}),argString=argArray.join(",");return sliceAccess=eval("(function sliceAccess (i,j) {return volume.access( "+argString+");})"),{iLength:iLength,jLength:jLength,sliceAccess:sliceAccess,matrix:planeMatrix,planeWidth:planeWidth,planeHeight:planeHeight,maxIndex:maxIndex}},extractSlice:function(e,t){var r=new THREE.VolumeSlice(this,t,e);return this.sliceList.push(r),r},repaintAllSlices:function(){return this.sliceList.forEach(function(e){e.repaint()}),this},computeMinMax:function(){var e=1/0,t=-1/0,r=this.data.length,n=0;for(n=0;n<r;n++)if(!isNaN(this.data[n])){var i=this.data[n];e=Math.min(e,i),t=Math.max(t,i)}return this.min=e,this.max=t,[e,t]}}},function(e,t){THREE.VolumeSlice=function(e,t,r){var n=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,n.geometryNeedsUpdate=!0,t}}),this.axis=r||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var i=new THREE.Texture(this.canvas);i.minFilter=THREE.LinearFilter,i.wrapS=i.wrapT=THREE.ClampToEdgeWrapping;var a=new THREE.MeshBasicMaterial({map:i,side:THREE.DoubleSide,transparent:!0});this.mesh=new THREE.Mesh(this.geometry,a),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()},THREE.VolumeSlice.prototype={constructor:THREE.VolumeSlice,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,r=this.sliceAccess,n=this.volume,i=this.canvasBuffer,a=this.ctxBuffer,o=a.getImageData(0,0,e,t),s=o.data,l=n.data,c=n.upperThreshold,u=n.lowerThreshold,h=n.windowLow,d=n.windowHigh,p=0;if("label"===n.dataType)for(var f=0;f<t;f++)for(var m=0;m<e;m++){var v=l[r(m,f)];v=v>=this.colorMap.length?v%this.colorMap.length+1:v;var g=this.colorMap[v];s[4*p]=g>>24&255,s[4*p+1]=g>>16&255,s[4*p+2]=g>>8&255,s[4*p+3]=255&g,p++}else for(f=0;f<t;f++)for(m=0;m<e;m++){var y=l[r(m,f)],E=255;E=c>=y&&u<=y?E:0,y=(y=Math.floor(255*(y-h)/(d-h)))>255?255:y<0?0:0|y,s[4*p]=y,s[4*p+1]=y,s[4*p+2]=y,s[4*p+3]=E,p++}a.putImageData(o,0,0),this.ctx.drawImage(i,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new THREE.PlaneBufferGeometry(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix(this.matrix)),this.geometryNeedsUpdate=!1}}},function(e,t){THREE.UnpackDepthRGBAShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")}},function(e,t){var r,n,i;THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},n=e.getSize(new THREE.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock},Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize(new THREE.Vector2);e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,r,n=this.renderer.getRenderTarget(),i=!1,a=this.passes.length;for(r=0;r<a;r++)if(!1!==(t=this.passes[r]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(t instanceof THREE.MaskPass?i=!0:t instanceof THREE.ClearMaskPass&&(i=!1))}this.renderer.setRenderTarget(n)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}),THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),THREE.Pass.FullScreenQuad=(r=new THREE.OrthographicCamera(-1,1,1,-1,0,1),n=new THREE.PlaneBufferGeometry(2,2),i=function(e){this._mesh=new THREE.Mesh(n,e)},Object.defineProperty(i.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(i.prototype,{render:function(e){e.render(this._mesh,r)}}),i)},function(e,t){THREE.RenderPass=function(e,t,r,n,i){THREE.Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(e,t,r){var n,i,a=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(n=e.getClearColor().getHex(),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(n,i),this.scene.overrideMaterial=null,e.autoClear=a}})},function(e,t){THREE.MaskPass=function(e,t){THREE.Pass.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.MaskPass,render:function(e,t,r){var n,i,a=e.context,o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(n=0,i=1):(n=1,i=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,n,4294967295),o.buffers.stencil.setClear(i),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,4294967295),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP)}}),THREE.ClearMaskPass=function(){THREE.Pass.call(this),this.needsSwap=!1},THREE.ClearMaskPass.prototype=Object.create(THREE.Pass.prototype),Object.assign(THREE.ClearMaskPass.prototype,{render:function(e){e.state.buffers.stencil.setTest(!1)}})},function(e,t){THREE.OutlinePass=function(e,t,r,n){this.renderScene=t,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new THREE.Color(1,1,1),this.hiddenEdgeColor=new THREE.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,THREE.Pass.call(this),this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},a=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new THREE.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=THREE.DoubleSide,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new THREE.MeshDepthMaterial,this.depthMaterial.side=THREE.DoubleSide,this.depthMaterial.depthPacking=THREE.RGBADepthPacking,this.depthMaterial.blending=THREE.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(e,t){var r=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(a,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(Math.round(a/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===THREE.CopyShader&&console.error("THREE.OutlinePass relies on THREE.CopyShader");var s=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.fsQuad=new THREE.Pass.FullScreenQuad(null),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4},THREE.OutlinePass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var r=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms.texSize.value=new THREE.Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms.texSize.value=new THREE.Vector2(r,n)},changeVisibilityOfSelectedObjects:function(e){function t(t){t.isMesh&&(e?(t.visible=t.userData.oldVisible,delete t.userData.oldVisible):(t.userData.oldVisible=t.visible,t.visible=e))}for(var r=0;r<this.selectedObjects.length;r++){this.selectedObjects[r].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function r(e){e.isMesh&&t.push(e)}for(var n=0;n<this.selectedObjects.length;n++){this.selectedObjects[n].traverse(r)}this.renderScene.traverse(function(r){if(r.isMesh||r.isLine||r.isSprite){for(var n=!1,i=0;i<t.length;i++)if(t[i].id===r.id){n=!0;break}if(!n){var a=r.visible;e&&!r.bVisible||(r.visible=e),r.bVisible=a}}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,r,n,i){if(this.selectedObjects.length>0){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,i&&e.context.disable(e.context.STENCIL_TEST),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new THREE.Vector2(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new THREE.Vector2(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.context.enable(e.context.STENCIL_TEST),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))},getPrepareMaskMaterial:function(){return new THREE.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new THREE.Vector2(.5,.5)},textureMatrix:{value:new THREE.Matrix4}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},visibleEdgeColor:{value:new THREE.Vector3(1,1,1)},hiddenEdgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\t\t\t\t}"})},getOverlayMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),THREE.OutlinePass.BlurDirectionX=new THREE.Vector2(1,0),THREE.OutlinePass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.ShaderPass=function(e,t){THREE.Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new THREE.Pass.FullScreenQuad(this.material)},THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}})},function(e,t){THREE.UnrealBloomPass=function(e,t,r,n){THREE.Pass.call(this),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=n,this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new THREE.WebGLRenderTarget(a,o,i);l.texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var c=new THREE.WebGLRenderTarget(a,o,i);c.texture.name="UnrealBloomPass.v"+s,c.texture.generateMipmaps=!1,this.renderTargetsVertical.push(c),a=Math.round(a/2),o=Math.round(o/2)}void 0===THREE.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");var u=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(u.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var h=[3,5,7,9,11];for(a=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new THREE.Vector2(a,o),a=Math.round(a/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===THREE.CopyShader&&console.error("THREE.UnrealBloomPass relies on THREE.CopyShader");var d=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(d.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.basic=new THREE.MeshBasicMaterial,this.fsQuad=new THREE.Pass.FullScreenQuad(null)},THREE.UnrealBloomPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.UnrealBloomPass,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var r=Math.round(e/2),n=Math.round(t/2);this.renderTargetBright.setSize(r,n);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,n),this.renderTargetsVertical[i].setSize(r,n),this.separableBlurMaterials[i].uniforms.texSize.value=new THREE.Vector2(r,n),r=Math.round(r/2),n=Math.round(n/2)},render:function(e,t,r,n,i){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var o=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=THREE.UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),THREE.UnrealBloomPass.BlurDirectionX=new THREE.Vector2(1,0),THREE.UnrealBloomPass.BlurDirectionY=new THREE.Vector2(0,1)},function(e,t){THREE.GlitchPass=function(e){THREE.Pass.call(this),void 0===THREE.DigitalGlitch&&console.error("THREE.GlitchPass relies on THREE.DigitalGlitch");var t=THREE.DigitalGlitch;this.uniforms=THREE.UniformsUtils.clone(t.uniforms),null==e&&(e=64),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new THREE.Pass.FullScreenQuad(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()},THREE.GlitchPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.GlitchPass,render:function(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=THREE.Math.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=THREE.Math.randFloat(-1,1),this.uniforms.seed_y.value=THREE.Math.randFloat(-1,1),this.uniforms.distortion_x.value=THREE.Math.randFloat(0,1),this.uniforms.distortion_y.value=THREE.Math.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=THREE.Math.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=THREE.Math.randFloat(0,1),this.uniforms.distortion_y.value=THREE.Math.randFloat(0,1),this.uniforms.seed_x.value=THREE.Math.randFloat(-.3,.3),this.uniforms.seed_y.value=THREE.Math.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))},generateTrigger:function(){this.randX=THREE.Math.randInt(120,240)},generateHeightmap:function(e){for(var t=new Float32Array(e*e*3),r=e*e,n=0;n<r;n++){var i=THREE.Math.randFloat(0,1);t[3*n+0]=i,t[3*n+1]=i,t[3*n+2]=i}var a=new THREE.DataTexture(t,e,e,THREE.RGBFormat,THREE.FloatType);return a.needsUpdate=!0,a}})},function(e,t){THREE.SSAOPass=function(e,t,r,n){THREE.Pass.call(this),this.width=void 0!==r?r:512,this.height=void 0!==n?n:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this.generateSampleKernel(),this.generateRandomKernelRotations();var i=new THREE.DepthTexture;i.type=THREE.UnsignedShortType,i.minFilter=THREE.NearestFilter,i.maxFilter=THREE.NearestFilter,this.beautyRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,depthTexture:i,depthBuffer:!0}),this.normalRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),this.ssaoRenderTarget=new THREE.WebGLRenderTarget(this.width,this.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===THREE.SSAOShader&&console.error("THREE.SSAOPass: The pass relies on THREE.SSAOShader."),this.ssaoMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOShader.uniforms),vertexShader:THREE.SSAOShader.vertexShader,fragmentShader:THREE.SSAOShader.fragmentShader,blending:THREE.NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.normalMaterial=new THREE.MeshNormalMaterial,this.normalMaterial.blending=THREE.NoBlending,this.blurMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAOBlurShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAOBlurShader.uniforms),vertexShader:THREE.SSAOBlurShader.vertexShader,fragmentShader:THREE.SSAOBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new THREE.ShaderMaterial({defines:Object.assign({},THREE.SSAODepthShader.defines),uniforms:THREE.UniformsUtils.clone(THREE.SSAODepthShader.uniforms),vertexShader:THREE.SSAODepthShader.vertexShader,fragmentShader:THREE.SSAODepthShader.fragmentShader,blending:THREE.NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.CopyShader.uniforms),vertexShader:THREE.CopyShader.vertexShader,fragmentShader:THREE.CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:THREE.DstColorFactor,blendDst:THREE.ZeroFactor,blendEquation:THREE.AddEquation,blendSrcAlpha:THREE.DstAlphaFactor,blendDstAlpha:THREE.ZeroFactor,blendEquationAlpha:THREE.AddEquation}),this.fsQuad=new THREE.Pass.FullScreenQuad(null),this.originalClearColor=new THREE.Color},THREE.SSAOPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.SSAOPass,dispose:function(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.quad.geometry.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose()},render:function(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case THREE.SSAOPass.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case THREE.SSAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=THREE.NoBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=THREE.CustomBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}},renderPass:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},renderOverride:function(e,t,r,n,i){this.originalClearColor.copy(e.getClearColor());var a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,n=t.clearColor||n,i=t.clearAlpha||i,null!=n&&(e.setClearColor(n),e.setClearAlpha(i||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)},setSize:function(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.blurMaterial.uniforms.resolution.value.set(e,t)},generateSampleKernel:function(){for(var e=this.kernelSize,t=this.kernel,r=0;r<e;r++){var n=new THREE.Vector3;n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=Math.random(),n.normalize();var i=r/e;i=THREE.Math.lerp(.1,1,i*i),n.multiplyScalar(i),t.push(n)}},generateRandomKernelRotations:function(){void 0===THREE.SimplexNoise&&console.error("THREE.SSAOPass: The pass relies on THREE.SimplexNoise.");for(var e=new THREE.SimplexNoise,t=new Float32Array(64),r=0;r<16;r++){var n=4*r,i=2*Math.random()-1,a=2*Math.random()-1,o=e.noise3d(i,a,0);t[n]=o,t[n+1]=o,t[n+2]=o,t[n+3]=1}this.noiseTexture=new THREE.DataTexture(t,4,4,THREE.RGBAFormat,THREE.FloatType),this.noiseTexture.wrapS=THREE.RepeatWrapping,this.noiseTexture.wrapT=THREE.RepeatWrapping,this.noiseTexture.needsUpdate=!0}}),THREE.SSAOPass.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5}},function(e,t){THREE.BokehPass=function(e,t,r){THREE.Pass.call(this);var n=r.width||window.innerWidth||1,i=r.height||window.innerHeight||1,a=r.vignetting||0;this.scene=e,this.camera=t,this.mouse=new THREE.Vector2,this.width=n,this.height=i;var o=THREE.BokehDepthShader,s=THREE.UniformsUtils.clone(o.uniforms);this.materialDepth=new THREE.ShaderMaterial({uniforms:s,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),s.mNear.value=t.near,s.mFar.value=t.far,this.scene2=new THREE.Scene,this.camera2=new THREE.OrthographicCamera(n/-2,n/2,i/2,i/-2,-1e4,1e4),this.camera2.position.z=100,this.scene2.add(this.camera2);var l={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.rtTextureDepth=new THREE.WebGLRenderTarget(n,i,l),this.rtTextureColor=new THREE.WebGLRenderTarget(n,i,l);var c=3,u=4,h=THREE.BokehShader,d=THREE.UniformsUtils.clone(h.uniforms);d.textureWidth.value=n,d.textureHeight.value=i,d.shaderFocus.value=1,d.vignetting.value=a,this.materialBokeh=new THREE.ShaderMaterial({uniforms:d,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{RINGS:c,SAMPLES:u}}),this.materialBokeh.uniforms.tColor.value=this.rtTextureColor.texture,this.materialBokeh.uniforms.tDepth.value=this.rtTextureDepth.texture;var p=new THREE.Mesh(new THREE.PlaneBufferGeometry(n,i),this.materialBokeh);p.position.z=-500,this.scene2.add(p)},THREE.BokehPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.BokehPass,render:function(e,t,r,n,i){var a=this.scene,o=this.camera,s=this.materialBokeh.uniforms,l=this.materialDepth.uniforms,c=.5,u=.5;c=.5*this.mouse.x+.5,u=.5*this.mouse.y+.5,s.focusCoords.value.set(c,u),s.znear.value=o.near,s.zfar.value=o.far,l.mNear.value=o.near,l.mFar.value=o.far,e.setRenderTarget(this.rtTextureColor),e.clear(),e.render(a,o),a.overrideMaterial=this.materialDepth,e.setRenderTarget(this.rtTextureDepth),e.clear(),e.render(a,o),a.overrideMaterial=null,this.renderToScreen?e.render(this.scene2,this.camera2):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene2,this.camera2))}})},function(e,t){THREE.BokehShader={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:1},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new THREE.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","/*","make sure that these two values are the same for your camera, otherwise distances will be wrong.","*/","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","/*","next part is experimental","not looking good with small sample and ring count","looks okay starting from samples = 4, rings = 4","*/","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if ( depthblur ) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","/*unboxstart*/","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","/*unboxend*/","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n")},THREE.BokehDepthShader={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")}},function(e,t){THREE.BleachBypassShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")}},function(e,t){THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},function(e,t){THREE.DotScreenShader={uniforms:{tDiffuse:{value:null},tSize:{value:new THREE.Vector2(256,256)},center:{value:new THREE.Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")}},function(e,t){THREE.FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")}},function(e,t){THREE.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new THREE.Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-e*e/(2*t*t))}var r,n,i,a,o=2*Math.ceil(3*e)+1;for(o>25&&(o=25),a=.5*(o-1),n=new Array(o),i=0,r=0;r<o;++r)n[r]=t(r-a,e),i+=n[r];for(r=0;r<o;++r)n[r]/=i;return n}}},function(e,t){THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new THREE.Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")}},function(e,t){THREE.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")}},function(e,t){THREE.DigitalGlitch={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);","vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")}},function(e,t){THREE.SSAOShader={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new THREE.Vector2},cameraProjectionMatrix:{value:new THREE.Matrix4},cameraInverseProjectionMatrix:{value:new THREE.Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\treturn texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","\tfloat depth = getDepth( vUv );","\tfloat viewZ = getViewZ( depth );","\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );","\tvec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","\tvec3 bitangent = cross( viewNormal, tangent );","\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","\t\tvec3 sampleVector = kernelMatrix * kernel[ i ];","\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","\t\tsamplePointNDC /= samplePointNDC.w;","\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","\t\tfloat realDepth = getLinearDepth( samplePointUv );","\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","\t\tfloat delta = sampleDepth - realDepth;","\t\tif ( delta > minDistance && delta < maxDistance ) {","\t\t\tocclusion += 1.0;","\t\t}","\t}","\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join("\n")},THREE.SSAODepthShader={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","void main() {","\tfloat depth = getLinearDepth( vUv );","\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join("\n")},THREE.SSAOBlurShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texelSize = ( 1.0 / resolution );","\tfloat result = 0.0;","\tfor ( int i = - 2; i <= 2; i ++ ) {","\t\tfor ( int j = - 2; j <= 2; j ++ ) {","\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;","\t\t}","\t}","\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join("\n")}},function(e,t){THREE.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")}},function(e,t){THREE.AnaglyphEffect=function(e,t,r){this.colorMatrixLeft=(new THREE.Matrix3).fromArray([1.0671679973602295,-.0016435992438346148,.0001777536963345483,-.028107794001698494,-.00019593400065787137,-.0002875397040043026,-.04279090091586113,15809757314855233e-21,-.00024287120322696865]),this.colorMatrixRight=(new THREE.Matrix3).fromArray([-.0355340838432312,-.06440307199954987,.018319187685847282,-.10269022732973099,.8079727292060852,-.04835830628871918,.0001224992738571018,-.009558862075209618,.567823588848114]);var n=new THREE.OrthographicCamera(-1,1,1,-1,0,1),i=new THREE.Scene,a=new THREE.StereoCamera,o={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat};void 0===t&&(t=512),void 0===r&&(r=512);var s=new THREE.WebGLRenderTarget(t,r,o),l=new THREE.WebGLRenderTarget(t,r,o),c=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:s.texture},mapRight:{value:l.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","\treturn c <= 0.04045 ? c * 0.0773993808 :","\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","\treturn c <= 0.0031308 ? c * 12.92","\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","\tvec2 uv = vUv;","\tvec4 colorL = lin( texture2D( mapLeft, uv ) );","\tvec4 colorR = lin( texture2D( mapRight, uv ) );","\tvec3 color = clamp(","\t\t\tcolorMatrixLeft * colorL.rgb +","\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );","\tgl_FragColor = vec4(","\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),","\t\t\tmax( colorL.a, colorR.a ) );","}"].join("\n")}),u=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),c);i.add(u),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();s.setSize(t*n,r*n),l.setSize(t*n,r*n)},this.render=function(t,r){var o=e.getRenderTarget();t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),a.update(r),e.setRenderTarget(s),e.clear(),e.render(t,a.cameraL),e.setRenderTarget(l),e.clear(),e.render(t,a.cameraR),e.setRenderTarget(null),e.render(i,n),e.setRenderTarget(o)},this.dispose=function(){s&&s.dispose(),l&&l.dispose(),u&&u.geometry.dispose(),c&&c.dispose()}}},function(e,t){THREE.StereoEffect=function(e){var t=new THREE.StereoCamera;t.aspect=.5;var r=new THREE.Vector2;this.setEyeSeparation=function(e){t.eyeSep=e},this.setSize=function(t,r){e.setSize(t,r)},this.render=function(n,i){n.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),t.update(i),e.getSize(r),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,r.width/2,r.height),e.setViewport(0,0,r.width/2,r.height),e.render(n,t.cameraL),e.setScissor(r.width/2,0,r.width/2,r.height),e.setViewport(r.width/2,0,r.width/2,r.height),e.render(n,t.cameraR),e.setScissorTest(!1)}}},function(e,t){THREE.ParallaxBarrierEffect=function(e){var t=new THREE.OrthographicCamera(-1,1,1,-1,0,1),r=new THREE.Scene,n=new THREE.StereoCamera,i={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},a=new THREE.WebGLRenderTarget(512,512,i),o=new THREE.WebGLRenderTarget(512,512,i),s=new THREE.ShaderMaterial({uniforms:{mapLeft:{value:a.texture},mapRight:{value:o.texture}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","\tvec2 uv = vUv;","\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","\t\tgl_FragColor = texture2D( mapLeft, uv );","\t} else {","\t\tgl_FragColor = texture2D( mapRight, uv );","\t}","}"].join("\n")}),l=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),s);r.add(l),this.setSize=function(t,r){e.setSize(t,r);var n=e.getPixelRatio();a.setSize(t*n,r*n),o.setSize(t*n,r*n)},this.render=function(i,s){i.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),n.update(s),e.setRenderTarget(a),e.clear(),e.render(i,n.cameraL),e.setRenderTarget(o),e.clear(),e.render(i,n.cameraR),e.setRenderTarget(null),e.render(r,t)}}},function(e,t){THREE.TypedArrayUtils={},
/**
 * In-place quicksort for typed arrays (e.g. for Float32Array)
 * provides fast sorting
 * useful e.g. for a custom shader and/or BufferGeometry
 *
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 *
 * Complexity: http://bigocheatsheet.com/ see Quicksort
 *
 * Example:
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * eleSize: 3 //because of (x, y, z)
 * orderElement: 0 //order according to x
 */
THREE.TypedArrayUtils.quicksortIP=function(e,t,r){for(var n,i,a=[],o=-1,s=0,l=e.length/t-1,c=0,u=0,h=0,d=function(r,n){for(r*=t,n*=t,h=0;h<t;h++)c=e[r+h],e[r+h]=e[n+h],e[n+h]=c},p=new Float32Array(t),f=new Float32Array(t);;)if(l-s<=25){for(i=s+1;i<=l;i++){for(u=0;u<t;u++)p[u]=e[i*t+u];for(n=i-1;n>=s&&e[n*t+r]>p[r];){for(u=0;u<t;u++)e[(n+1)*t+u]=e[n*t+u];n--}for(u=0;u<t;u++)e[(n+1)*t+u]=p[u]}if(-1==o)break;l=a[o--],s=a[o--]}else{for(i=l,d(s+l>>1,n=s+1),e[s*t+r]>e[l*t+r]&&d(s,l),e[n*t+r]>e[l*t+r]&&d(n,l),e[s*t+r]>e[n*t+r]&&d(s,n),u=0;u<t;u++)f[u]=e[n*t+u];for(;;){do{n++}while(e[n*t+r]<f[r]);do{i--}while(e[i*t+r]>f[r]);if(i<n)break;d(n,i)}for(u=0;u<t;u++)e[(s+1)*t+u]=e[i*t+u],e[i*t+u]=f[u];l-n+1>=i-s?(a[++o]=n,a[++o]=l,l=i-1):(a[++o]=s,a[++o]=i-1,s=n)}return e},
/**
 * k-d Tree for typed arrays (e.g. for Float32Array), in-place
 * provides fast nearest neighbour search
 * useful e.g. for a custom shader and/or BufferGeometry, saves tons of memory
 * has no insert and remove, only buildup and neares neighbour search
 *
 * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs
 *
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 *
 * Requires typed array quicksort
 *
 * Example:
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * metric: function(a, b){	return Math.pow(a[0] - b[0], 2) +  Math.pow(a[1] - b[1], 2) +  Math.pow(a[2] - b[2], 2); }  //Manhatten distance
 * eleSize: 3 //because of (x, y, z)
 *
 * Further information (including mathematical properties)
 * http://en.wikipedia.org/wiki/Binary_tree
 * http://en.wikipedia.org/wiki/K-d_tree
 *
 * If you want to further minimize memory usage, remove Node.depth and replace in search algorithm with a traversal to root node (see comments at THREE.TypedArrayUtils.Kdtree.prototype.Node)
 */
THREE.TypedArrayUtils.Kdtree=function(e,t,r){var n=this,i=0,a=function(e,t){return e.subarray(t*r,t*r+r)};this.root=function e(t,o,s,l){var c,u,h=o%r,d=t.length/r;return o>i&&(i=o),0===d?null:1===d?new n.Node(a(t,0),o,s,l):(THREE.TypedArrayUtils.quicksortIP(t,r,h),c=Math.floor(d/2),(u=new n.Node(a(t,c),o,s,c+l)).left=e(t.subarray(0,c*r),o+1,u,l),u.right=e(t.subarray((c+1)*r,t.length),o+1,u,l+c+1),u)}(e,0,null,0),this.getMaxDepth=function(){return i},this.nearest=function(e,i,a){var o,s,l;if(l=new THREE.TypedArrayUtils.Kdtree.BinaryHeap(function(e){return-e[1]}),a)for(o=0;o<i;o+=1)l.push([null,a]);for(function n(a){var o,s,c,u,h=a.depth%r,d=t(e,a.obj),p=[];function f(e,t){l.push([e,t]),l.size()>i&&l.pop()}for(u=0;u<r;u+=1)u===a.depth%r?p[u]=e[u]:p[u]=a.obj[u];s=t(p,a.obj),null!==a.right||null!==a.left?(n(o=null===a.right?a.left:null===a.left?a.right:e[h]<a.obj[h]?a.left:a.right),(l.size()<i||d<l.peek()[1])&&f(a,d),(l.size()<i||Math.abs(s)<l.peek()[1])&&null!==(c=o===a.left?a.right:a.left)&&n(c)):(l.size()<i||d<l.peek()[1])&&f(a,d)}(n.root),s=[],o=0;o<i;o+=1)l.content[o][0]&&s.push([l.content[o][0],l.content[o][1]]);return s}},THREE.TypedArrayUtils.Kdtree.prototype.Node=function(e,t,r,n){this.obj=e,this.left=null,this.right=null,this.parent=r,this.depth=t,this.pos=n},THREE.TypedArrayUtils.Kdtree.BinaryHeap=function(e){this.content=[],this.scoreFunction=e},THREE.TypedArrayUtils.Kdtree.BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,r=0;r<t;r++)if(this.content[r]==e){var n=this.content.pop();return void(r!=t-1&&(this.content[r]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.bubbleUp(r):this.sinkDown(r)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var r=Math.floor((e+1)/2)-1,n=this.content[r];if(!(this.scoreFunction(t)<this.scoreFunction(n)))break;this.content[r]=t,this.content[e]=n,e=r}},sinkDown:function(e){for(var t=this.content.length,r=this.content[e],n=this.scoreFunction(r);;){var i=2*(e+1),a=i-1,o=null;if(a<t){var s=this.content[a],l=this.scoreFunction(s);l<n&&(o=a)}if(i<t){var c=this.content[i];this.scoreFunction(c)<(null===o?n:l)&&(o=i)}if(null===o)break;this.content[e]=this.content[o],this.content[o]=r,e=o}}}},function(e,t){THREE.BufferGeometryUtils={computeTangents:function(e){var t=e.index,r=e.attributes;if(null!==t&&void 0!==r.position&&void 0!==r.normal&&void 0!==r.uv){var n=t.array,i=r.position.array,a=r.normal.array,o=r.uv.array,s=i.length/3;void 0===r.tangent&&e.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*s),4));for(var l=r.tangent.array,c=[],u=[],h=0;h<s;h++)c[h]=new THREE.Vector3,u[h]=new THREE.Vector3;var d=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector2,v=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector3,E=new THREE.Vector3,x=e.groups;0===x.length&&(x=[{start:0,count:n.length}]);h=0;for(var b=x.length;h<b;++h)for(var T=H=(C=x[h]).start,w=H+C.count;T<w;T+=3)I(n[T+0],n[T+1],n[T+2]);var _,R,M,S=new THREE.Vector3,A=new THREE.Vector3,P=new THREE.Vector3,L=new THREE.Vector3;for(h=0,b=x.length;h<b;++h){var C,H;for(T=H=(C=x[h]).start,w=H+C.count;T<w;T+=3)k(n[T+0]),k(n[T+1]),k(n[T+2])}}else console.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function I(e,t,r){d.fromArray(i,3*e),p.fromArray(i,3*t),f.fromArray(i,3*r),m.fromArray(o,2*e),v.fromArray(o,2*t),g.fromArray(o,2*r);var n=p.x-d.x,a=f.x-d.x,s=p.y-d.y,l=f.y-d.y,h=p.z-d.z,x=f.z-d.z,b=v.x-m.x,T=g.x-m.x,w=v.y-m.y,_=g.y-m.y,R=1/(b*_-T*w);y.set((_*n-w*a)*R,(_*s-w*l)*R,(_*h-w*x)*R),E.set((b*a-T*n)*R,(b*l-T*s)*R,(b*x-T*h)*R),c[e].add(y),c[t].add(y),c[r].add(y),u[e].add(E),u[t].add(E),u[r].add(E)}function k(e){P.fromArray(a,3*e),L.copy(P),R=c[e],S.copy(R),S.sub(P.multiplyScalar(P.dot(R))).normalize(),A.crossVectors(L,R),M=A.dot(u[e]),_=M<0?-1:1,l[4*e]=S.x,l[4*e+1]=S.y,l[4*e+2]=S.z,l[4*e+3]=_}},mergeBufferGeometries:function(e,t){for(var r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=new THREE.BufferGeometry,l=0,c=0;c<e.length;++c){var u=e[c];if(r!==(null!==u.index))return null;for(var h in u.attributes){if(!n.has(h))return null;void 0===a[h]&&(a[h]=[]),a[h].push(u.attributes[h])}for(var h in u.morphAttributes){if(!i.has(h))return null;void 0===o[h]&&(o[h]=[]),o[h].push(u.morphAttributes[h])}if(s.userData.mergedUserData=s.userData.mergedUserData||[],s.userData.mergedUserData.push(u.userData),t){var d;if(r)d=u.index.count;else{if(void 0===u.attributes.position)return null;d=u.attributes.position.count}s.addGroup(l,d,c),l+=d}}if(r){var p=0,f=[];for(c=0;c<e.length;++c){for(var m=e[c].index,v=0;v<m.count;++v)f.push(m.getX(v)+p);p+=e[c].attributes.position.count}s.setIndex(f)}for(var h in a){var g=this.mergeBufferAttributes(a[h]);if(!g)return null;s.addAttribute(h,g)}for(var h in o){var y=o[h][0].length;if(0===y)break;s.morphAttributes=s.morphAttributes||{},s.morphAttributes[h]=[];for(c=0;c<y;++c){var E=[];for(v=0;v<o[h].length;++v)E.push(o[h][v][c]);var x=this.mergeBufferAttributes(E);if(!x)return null;s.morphAttributes[h].push(x)}}return s},mergeBufferAttributes:function(e){for(var t,r,n,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return null;if(void 0===n&&(n=o.normalized),n!==o.normalized)return null;i+=o.array.length}var s=new t(i),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new THREE.BufferAttribute(s,r,n)},interleaveAttributes:function(e){for(var t,r=0,n=0,i=0,a=e.length;i<a;++i){var o=e[i];if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;r+=o.array.length,n+=o.itemSize}var s=new THREE.InterleavedBuffer(new t(r),n),l=0,c=[],u=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"],d=0;for(a=e.length;d<a;d++){var p=(o=e[d]).itemSize,f=o.count,m=new THREE.InterleavedBufferAttribute(s,p,l,o.normalized);c.push(m),l+=p;for(var v=0;v<f;v++)for(var g=0;g<p;g++)m[h[g]](v,o[u[g]](v))}return c},estimateBytesUsed:function(e){var t=0;for(var r in e.attributes){var n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}var i=e.getIndex();return t+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var r={},n=e.getIndex(),i=e.getAttribute("position"),a=n?n.count:i.count,o=0,s=Object.keys(e.attributes),l={},c={},u=[],h=["getX","getY","getZ","getW"],d=0,p=s.length;d<p;d++){l[E=s[d]]=[],(w=e.morphAttributes[E])&&(c[E]=new Array(w.length).fill().map(()=>[]))}var f=Math.log10(1/t),m=Math.pow(10,f);for(d=0;d<a;d++){var v=n?n.getX(d):d,g="",y=0;for(p=s.length;y<p;y++)for(var E=s[y],x=(T=e.getAttribute(E)).itemSize,b=0;b<x;b++)g+=`${~~(T[h[b]](v)*m)},`;if(g in r)u.push(r[g]);else{for(y=0,p=s.length;y<p;y++){E=s[y];var T=e.getAttribute(E),w=e.morphAttributes[E],_=(x=T.itemSize,l[E]),R=c[E];for(b=0;b<x;b++){var M=h[b];if(_.push(T[M](v)),w)for(var S=0,A=w.length;S<A;S++)R[S].push(w[S][M](v))}}r[g]=o,u.push(o),o++}}const P=e.clone();for(d=0,p=s.length;d<p;d++){E=s[d];var L=e.getAttribute(E),C=new L.array.constructor(l[E]);if(L.isInterleavedBufferAttribute?T=new THREE.BufferAttribute(C,L.itemSize,L.itemSize):(T=e.getAttribute(E).clone()).setArray(C),P.addAttribute(E,T),E in c)for(y=0;y<c[E].length;y++){var H=e.morphAttributes[E][y].clone();H.setArray(new H.array.constructor(c[E][y])),P.morphAttributes[E][y]=H}}var I=Uint8Array;u.length>=Math.pow(2,8)&&(I=Uint16Array),u.length>=Math.pow(2,16)&&(I=Uint32Array);var k=new I(u);u=null;return null===n?u=new THREE.BufferAttribute(k,1):(u=e.getIndex().clone()).setArray(k),P.setIndex(u),P}}},function(e,t){THREE.NormalMapShader={uniforms:{heightMap:{value:null},resolution:{value:new THREE.Vector2(512,512)},scale:{value:new THREE.Vector2(1,1)},height:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")}},function(e,t){THREE.TerrainShader={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{enableDiffuse1:{value:0},enableDiffuse2:{value:0},enableSpecular:{value:0},enableReflection:{value:0},tDiffuse1:{value:null},tDiffuse2:{value:null},tDetail:{value:null},tNormal:{value:null},tSpecular:{value:null},tDisplacement:{value:null},uNormalScale:{value:1},uDisplacementBias:{value:0},uDisplacementScale:{value:1},diffuse:{value:new THREE.Color(15658734)},specular:{value:new THREE.Color(1118481)},shininess:{value:30},opacity:{value:1},uRepeatBase:{value:new THREE.Vector2(1,1)},uRepeatOverlay:{value:new THREE.Vector2(1,1)},uOffset:{value:new THREE.Vector2(0,0)}}]),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );"," } else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLights[ i ].direction;","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",THREE.ShaderChunk.shadowmap_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n")}},function(e,t){THREE.VolumeRenderShader1={uniforms:{u_size:{value:new THREE.Vector3(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new THREE.Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:["varying vec4 v_nearpos;","varying vec4 v_farpos;","varying vec3 v_position;","mat4 inversemat(mat4 m) {","float","a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],","a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],","a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],","a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],","b00 = a00 * a11 - a01 * a10,","b01 = a00 * a12 - a02 * a10,","b02 = a00 * a13 - a03 * a10,","b03 = a01 * a12 - a02 * a11,","b04 = a01 * a13 - a03 * a11,","b05 = a02 * a13 - a03 * a12,","b06 = a20 * a31 - a21 * a30,","b07 = a20 * a32 - a22 * a30,","b08 = a20 * a33 - a23 * a30,","b09 = a21 * a32 - a22 * a31,","b10 = a21 * a33 - a23 * a31,","b11 = a22 * a33 - a23 * a32,","det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;","return mat4(","a11 * b11 - a12 * b10 + a13 * b09,","a02 * b10 - a01 * b11 - a03 * b09,","a31 * b05 - a32 * b04 + a33 * b03,","a22 * b04 - a21 * b05 - a23 * b03,","a12 * b08 - a10 * b11 - a13 * b07,","a00 * b11 - a02 * b08 + a03 * b07,","a32 * b02 - a30 * b05 - a33 * b01,","a20 * b05 - a22 * b02 + a23 * b01,","a10 * b10 - a11 * b08 + a13 * b06,","a01 * b08 - a00 * b10 - a03 * b06,","a30 * b04 - a31 * b02 + a33 * b00,","a21 * b02 - a20 * b04 - a23 * b00,","a11 * b07 - a10 * b09 - a12 * b06,","a00 * b09 - a01 * b07 + a02 * b06,","a31 * b01 - a30 * b03 - a32 * b00,","a20 * b03 - a21 * b01 + a22 * b00) / det;","}","void main() {","mat4 viewtransformf = viewMatrix;","mat4 viewtransformi = inversemat(viewMatrix);","vec4 position4 = vec4(position, 1.0);","vec4 pos_in_cam = viewtransformf * position4;","pos_in_cam.z = -pos_in_cam.w;","v_nearpos = viewtransformi * pos_in_cam;","pos_in_cam.z = pos_in_cam.w;","v_farpos = viewtransformi * pos_in_cam;","v_position = position;","gl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;","}"].join("\n"),fragmentShader:["precision highp float;","precision mediump sampler3D;","uniform vec3 u_size;","uniform int u_renderstyle;","uniform float u_renderthreshold;","uniform vec2 u_clim;","uniform sampler3D u_data;","uniform sampler2D u_cmdata;","varying vec3 v_position;","varying vec4 v_nearpos;","varying vec4 v_farpos;","const int MAX_STEPS = 887;\t// 887 for 512^3, 1774 for 1024^3","const int REFINEMENT_STEPS = 4;","const float relative_step_size = 1.0;","const vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);","const vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);","const vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);","const float shininess = 40.0;","void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","float sample1(vec3 texcoords);","vec4 apply_colormap(float val);","vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);","void main() {","vec3 farpos = v_farpos.xyz / v_farpos.w;","vec3 nearpos = v_nearpos.xyz / v_nearpos.w;","vec3 view_ray = normalize(nearpos.xyz - farpos.xyz);","float distance = dot(nearpos - v_position, view_ray);","distance = max(distance, min((-0.5 - v_position.x) / view_ray.x,","(u_size.x - 0.5 - v_position.x) / view_ray.x));","distance = max(distance, min((-0.5 - v_position.y) / view_ray.y,","(u_size.y - 0.5 - v_position.y) / view_ray.y));","distance = max(distance, min((-0.5 - v_position.z) / view_ray.z,","(u_size.z - 0.5 - v_position.z) / view_ray.z));","vec3 front = v_position + view_ray * distance;","int nsteps = int(-distance / relative_step_size + 0.5);","if ( nsteps < 1 ) discard;","vec3 step = ((v_position - front) / u_size) / float(nsteps);","vec3 start_loc = front / u_size;","if (u_renderstyle == 0)","cast_mip(start_loc, step, nsteps, view_ray);","else if (u_renderstyle == 1)","cast_iso(start_loc, step, nsteps, view_ray);","if (gl_FragColor.a < 0.05) discard;","}","float sample1(vec3 texcoords) {","/* Sample float value from a 3D texture. Assumes intensity data. */","return texture(u_data, texcoords.xyz).r;","}","vec4 apply_colormap(float val) {","val = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);","return texture2D(u_cmdata, vec2(val, 0.5));","}","void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","float max_val = -1e6;","int max_i = 100;","vec3 loc = start_loc;","for (int iter=0; iter<MAX_STEPS; iter++) {","if (iter >= nsteps) break;","float val = sample1(loc);","if (val > max_val) {","max_val = val;","max_i = iter;","}","loc += step;","}","vec3 iloc = start_loc + step * (float(max_i) - 0.5);","vec3 istep = step / float(REFINEMENT_STEPS);","for (int i=0; i<REFINEMENT_STEPS; i++) {","max_val = max(max_val, sample1(iloc));","iloc += istep;","}","gl_FragColor = apply_colormap(max_val);","}","void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","gl_FragColor = vec4(0.0);\t// init transparent","vec4 color3 = vec4(0.0);\t// final color","vec3 dstep = 1.5 / u_size;\t// step to sample derivative","vec3 loc = start_loc;","float low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);","for (int iter=0; iter<MAX_STEPS; iter++) {","if (iter >= nsteps)","break;","float val = sample1(loc);","if (val > low_threshold) {","vec3 iloc = loc - 0.5 * step;","vec3 istep = step / float(REFINEMENT_STEPS);","for (int i=0; i<REFINEMENT_STEPS; i++) {","val = sample1(iloc);","if (val > u_renderthreshold) {","gl_FragColor = add_lighting(val, iloc, dstep, view_ray);","return;","}","iloc += istep;","}","}","loc += step;","}","}","vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)","{","vec3 V = normalize(view_ray);","vec3 N;","float val1, val2;","val1 = sample1(loc + vec3(-step[0], 0.0, 0.0));","val2 = sample1(loc + vec3(+step[0], 0.0, 0.0));","N[0] = val1 - val2;","val = max(max(val1, val2), val);","val1 = sample1(loc + vec3(0.0, -step[1], 0.0));","val2 = sample1(loc + vec3(0.0, +step[1], 0.0));","N[1] = val1 - val2;","val = max(max(val1, val2), val);","val1 = sample1(loc + vec3(0.0, 0.0, -step[2]));","val2 = sample1(loc + vec3(0.0, 0.0, +step[2]));","N[2] = val1 - val2;","val = max(max(val1, val2), val);","float gm = length(N); // gradient magnitude","N = normalize(N);","float Nselect = float(dot(N, V) > 0.0);","N = (2.0 * Nselect - 1.0) * N;\t// ==\tNselect * N - (1.0-Nselect)*N;","vec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);","vec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);","vec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);","for (int i=0; i<1; i++)","{","vec3 L = normalize(view_ray);\t//lightDirs[i];","float lightEnabled = float( length(L) > 0.0 );","L = normalize(L + (1.0 - lightEnabled));","float lambertTerm = clamp(dot(N, L), 0.0, 1.0);","vec3 H = normalize(L+V); // Halfway vector","float specularTerm = pow(max(dot(H, N), 0.0), shininess);","float mask1 = lightEnabled;","ambient_color +=\tmask1 * ambient_color;\t// * gl_LightSource[i].ambient;","diffuse_color +=\tmask1 * lambertTerm;","specular_color += mask1 * specularTerm * specular_color;","}","vec4 final_color;","vec4 color = apply_colormap(val);","final_color = color * (ambient_color + diffuse_color) + specular_color;","final_color.a = color.a;","return final_color;","}"].join("\n")}},function(e,t){THREE.GodRaysDepthMaskShader={uniforms:{tInput:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tInput;","void main() {","\tgl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );","}"].join("\n")},THREE.GodRaysGenerateShader={uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","\tvec2 delta = vSunPositionScreenSpace - vUv;","\tfloat dist = length( delta );","\tvec2 stepv = fStepSize * delta / dist;","\tfloat iters = dist/fStepSize;","\tvec2 uv = vUv.xy;","\tfloat col = 0.0;","\tif ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tif ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","\tuv += stepv;","\tgl_FragColor = vec4( col/TAPS_PER_PASS );","\tgl_FragColor.a = 1.0;","}"].join("\n")},THREE.GodRaysCombineShader={uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69},vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","\tgl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","\tgl_FragColor.a = 1.0;","}"].join("\n")},THREE.GodRaysFakeSunShader={uniforms:{vSunPositionScreenSpace:{value:new THREE.Vector2(.5,.5)},fAspect:{value:1},sunColor:{value:new THREE.Color(16772608)},bgColor:{value:new THREE.Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","\tvec2 diff = vUv - vSunPositionScreenSpace;","\tdiff.x *= fAspect;","\tfloat prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","\tprop = 0.35 * pow( 1.0 - prop, 3.0 );","\tgl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","\tgl_FragColor.w = 1.0;","}"].join("\n")}},function(e,t){var r,n,i;THREE.Lensflare=function(){THREE.Mesh.call(this,THREE.Lensflare.Geometry,new THREE.MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);r.minFilter=THREE.NearestFilter,r.magFilter=THREE.NearestFilter,r.wrapS=THREE.ClampToEdgeWrapping,r.wrapT=THREE.ClampToEdgeWrapping,r.needsUpdate=!0;var n=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);n.minFilter=THREE.NearestFilter,n.magFilter=THREE.NearestFilter,n.wrapS=THREE.ClampToEdgeWrapping,n.wrapT=THREE.ClampToEdgeWrapping,n.needsUpdate=!0;var i=THREE.Lensflare.Geometry,a=new THREE.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),o=new THREE.RawShaderMaterial({uniforms:{map:{value:r},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),s=new THREE.Mesh(i,a),l=[],c=THREE.LensflareElement.Shader,u=new THREE.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:n},color:{value:new THREE.Color(16777215)},scale:{value:new THREE.Vector2},screenPosition:{value:new THREE.Vector3}},vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1}),h=new THREE.Mesh(i,u);this.addElement=function(e){l.push(e)};var d=new THREE.Vector2,p=new THREE.Vector2,f=new THREE.Box2,m=new THREE.Vector4;this.onBeforeRender=function(c,v,g){c.getCurrentViewport(m);var y=m.w/m.z,E=m.z/2,x=m.w/2,b=16/m.w;if(d.set(b*y,b),f.min.set(m.x,m.y),f.max.set(m.x+(m.z-16),m.y+(m.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(g.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(g.projectionMatrix),p.x=m.x+e.x*E+E-8,p.y=m.y+e.y*x+x-8,f.containsPoint(p))){c.copyFramebufferToTexture(p,r),(M=a.uniforms).scale.value=d,M.screenPosition.value=e,c.renderBufferDirect(g,null,i,a,s,null),c.copyFramebufferToTexture(p,n),(M=o.uniforms).scale.value=d,M.screenPosition.value=e,c.renderBufferDirect(g,null,i,o,s,null);for(var T=2*-e.x,w=2*-e.y,_=0,R=l.length;_<R;_++){var M,S=l[_];(M=u.uniforms).color.value.copy(S.color),M.map.value=S.texture,M.screenPosition.value.x=e.x+T*S.distance,M.screenPosition.value.y=e.y+w*S.distance;b=S.size/m.w,y=m.w/m.z;M.scale.value.set(b*y,b),u.uniformsNeedUpdate=!0,c.renderBufferDirect(g,null,i,u,h,null)}}},this.dispose=function(){a.dispose(),o.dispose(),u.dispose(),r.dispose(),n.dispose();for(var e=0,t=l.length;e<t;e++)l[e].texture.dispose()}},THREE.Lensflare.prototype=Object.create(THREE.Mesh.prototype),THREE.Lensflare.prototype.constructor=THREE.Lensflare,THREE.Lensflare.prototype.isLensflare=!0,THREE.LensflareElement=function(e,t,r,n){this.texture=e,this.size=t||1,this.distance=r||0,this.color=n||new THREE.Color(16777215)},THREE.LensflareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},THREE.Lensflare.Geometry=(r=new THREE.BufferGeometry,n=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),i=new THREE.InterleavedBuffer(n,5),r.setIndex([0,1,2,0,2,3]),r.addAttribute("position",new THREE.InterleavedBufferAttribute(i,3,0,!1)),r.addAttribute("uv",new THREE.InterleavedBufferAttribute(i,2,3,!1)),r)},function(e,t){THREE.DragControls=function(e,t,r){if(e instanceof THREE.Camera){console.warn("THREE.DragControls: Constructor now expects ( objects, camera, domElement )");var n=e;e=t,t=n}var i=new THREE.Plane,a=new THREE.Raycaster,o=new THREE.Vector2,s=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Matrix4,h=null,d=null,p=this;function f(){r.addEventListener("mousemove",v,!1),r.addEventListener("mousedown",g,!1),r.addEventListener("mouseup",y,!1),r.addEventListener("mouseleave",y,!1),r.addEventListener("touchmove",E,!1),r.addEventListener("touchstart",x,!1),r.addEventListener("touchend",b,!1)}function m(){r.removeEventListener("mousemove",v,!1),r.removeEventListener("mousedown",g,!1),r.removeEventListener("mouseup",y,!1),r.removeEventListener("mouseleave",y,!1),r.removeEventListener("touchmove",E,!1),r.removeEventListener("touchstart",x,!1),r.removeEventListener("touchend",b,!1)}function v(n){n.preventDefault();var f=r.getBoundingClientRect();if(o.x=(n.clientX-f.left)/f.width*2-1,o.y=-(n.clientY-f.top)/f.height*2+1,a.setFromCamera(o,t),h&&p.enabled)return a.ray.intersectPlane(i,l)&&h.position.copy(l.sub(s).applyMatrix4(u)),void p.dispatchEvent({type:"drag",object:h});a.setFromCamera(o,t);var m=a.intersectObjects(e);if(m.length>0){var v=m[0].object;i.setFromNormalAndCoplanarPoint(t.getWorldDirection(i.normal),c.setFromMatrixPosition(v.matrixWorld)),d!==v&&(p.dispatchEvent({type:"hoveron",object:v}),r.style.cursor="pointer",d=v)}else null!==d&&(p.dispatchEvent({type:"hoveroff",object:d}),r.style.cursor="auto",d=null)}function g(n){n.preventDefault(),a.setFromCamera(o,t);var d=[];e.forEach(e=>{e.traverse(e=>{e.isMesh&&d.push(e)})});var f=a.intersectObjects(d);f.length>0&&(h=f[0].object,a.ray.intersectPlane(i,l)&&(u.getInverse(h.parent.matrixWorld),s.copy(l).sub(c.setFromMatrixPosition(h.matrixWorld))),r.style.cursor="move",p.dispatchEvent({type:"dragstart",object:h}))}function y(e){e.preventDefault(),h&&(p.dispatchEvent({type:"dragend",object:h}),h=null),r.style.cursor=d?"pointer":"auto"}function E(e){e.preventDefault(),e=e.changedTouches[0];var n=r.getBoundingClientRect();if(o.x=(e.clientX-n.left)/n.width*2-1,o.y=-(e.clientY-n.top)/n.height*2+1,a.setFromCamera(o,t),h&&p.enabled)return a.ray.intersectPlane(i,l)&&h.position.copy(l.sub(s).applyMatrix4(u)),void p.dispatchEvent({type:"drag",object:h})}function x(n){n.preventDefault(),n=n.changedTouches[0];var d=r.getBoundingClientRect();o.x=(n.clientX-d.left)/d.width*2-1,o.y=-(n.clientY-d.top)/d.height*2+1,a.setFromCamera(o,t);var f=a.intersectObjects(e);f.length>0&&(h=f[0].object,i.setFromNormalAndCoplanarPoint(t.getWorldDirection(i.normal),c.setFromMatrixPosition(h.matrixWorld)),a.ray.intersectPlane(i,l)&&(u.getInverse(h.parent.matrixWorld),s.copy(l).sub(c.setFromMatrixPosition(h.matrixWorld))),r.style.cursor="move",p.dispatchEvent({type:"dragstart",object:h}))}function b(e){e.preventDefault(),h&&(p.dispatchEvent({type:"dragend",object:h}),h=null),r.style.cursor="auto"}f(),this.enabled=!0,this.activate=f,this.deactivate=m,this.dispose=function(){m()},this.setObjects=function(){console.error("THREE.DragControls: setObjects() has been removed.")},this.on=function(e,t){console.warn("THREE.DragControls: on() has been deprecated. Use addEventListener() instead."),p.addEventListener(e,t)},this.off=function(e,t){console.warn("THREE.DragControls: off() has been deprecated. Use removeEventListener() instead."),p.removeEventListener(e,t)},this.notify=function(e){console.error("THREE.DragControls: notify() has been deprecated. Use dispatchEvent() instead."),p.dispatchEvent({type:e})}},THREE.DragControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.DragControls.prototype.constructor=THREE.DragControls},function(e,t){THREE.TransformControls=function(e,t){THREE.Object3D.call(this),t=void 0!==t?t:document,this.visible=!1;var r=new THREE.TransformControlsGizmo;this.add(r);var n=new THREE.TransformControlsPlane;this.add(n);var i=this;z("camera",e),z("object",void 0),z("enabled",!0),z("axis",null),z("mode","translate"),z("translationSnap",null),z("rotationSnap",null),z("space","world"),z("size",1),z("dragging",!1),z("showX",!0),z("showY",!0),z("showZ",!0);var a={type:"change"},o={type:"mouseDown"},s={type:"mouseUp",mode:i.mode},l={type:"objectChange"},c=new THREE.Raycaster,u=new THREE.Vector3,h=new THREE.Vector3,d=new THREE.Quaternion,p={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},f=new THREE.Vector3,m=new THREE.Vector3,v=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector3,x=0,b=new THREE.Vector3,T=new THREE.Quaternion,w=new THREE.Vector3,_=new THREE.Vector3,R=new THREE.Quaternion,M=new THREE.Quaternion,S=new THREE.Vector3,A=new THREE.Vector3,P=new THREE.Quaternion,L=new THREE.Vector3,C=new THREE.Vector3,H=new THREE.Quaternion,I=new THREE.Quaternion,k=new THREE.Vector3,O=new THREE.Vector3,N=new THREE.Vector3,F=new THREE.Quaternion,D=new THREE.Vector3;function z(e,t){var o=t;Object.defineProperty(i,e,{get:function(){return void 0!==o?o:t},set:function(t){o!==t&&(o=t,n[e]=t,r[e]=t,i.dispatchEvent({type:e+"-changed",value:t}),i.dispatchEvent(a))}}),i[e]=t,n[e]=t,r[e]=t}function U(e){var r=e.changedTouches?e.changedTouches[0]:e,n=t.getBoundingClientRect();return{x:(r.clientX-n.left)/n.width*2-1,y:-(r.clientY-n.top)/n.height*2+1,button:e.button}}function B(e){i.enabled&&i.pointerHover(U(e))}function G(e){i.enabled&&(document.addEventListener("mousemove",V,!1),i.pointerHover(U(e)),i.pointerDown(U(e)))}function V(e){i.enabled&&i.pointerMove(U(e))}function j(e){i.enabled&&(document.removeEventListener("mousemove",V,!1),i.pointerUp(U(e)))}z("worldPosition",C),z("worldPositionStart",A),z("worldQuaternion",H),z("worldQuaternionStart",P),z("cameraPosition",b),z("cameraQuaternion",T),z("pointStart",f),z("pointEnd",m),z("rotationAxis",g),z("rotationAngle",x),z("eye",O),t.addEventListener("mousedown",G,!1),t.addEventListener("touchstart",G,!1),t.addEventListener("mousemove",B,!1),t.addEventListener("touchmove",B,!1),t.addEventListener("touchmove",V,!1),document.addEventListener("mouseup",j,!1),t.addEventListener("touchend",j,!1),t.addEventListener("touchcancel",j,!1),t.addEventListener("touchleave",j,!1),this.dispose=function(){t.removeEventListener("mousedown",G),t.removeEventListener("touchstart",G),t.removeEventListener("mousemove",B),document.removeEventListener("mousemove",V),t.removeEventListener("touchmove",B),t.removeEventListener("touchmove",V),document.removeEventListener("mouseup",j),t.removeEventListener("touchend",j),t.removeEventListener("touchcancel",j),t.removeEventListener("touchleave",j),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(_,R,S),this.object.matrixWorld.decompose(C,H,k),M.copy(R).inverse(),I.copy(H).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(b,T,w),this.camera instanceof THREE.PerspectiveCamera?O.copy(b).sub(C).normalize():this.camera instanceof THREE.OrthographicCamera&&O.copy(b).normalize(),THREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var t=c.intersectObjects(r.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){c.setFromCamera(e,this.camera);var t=c.intersectObjects([n],!0)[0]||!1;if(t){var r=this.space;if("scale"===this.mode?r="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(r="world"),"local"===r&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),N.copy(this.object.position),F.copy(this.object.quaternion),D.copy(this.object.scale),this.object.matrixWorld.decompose(A,P,L),f.copy(t.point).sub(A)}this.dragging=!0,o.mode=this.mode,this.dispatchEvent(o)}},this.pointerMove=function(e){var t=this.axis,r=this.mode,i=this.object,o=this.space;if("scale"===r?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==i&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var s=c.intersectObjects([n],!0)[0]||!1;if(!1!==s){if(m.copy(s.point).sub(A),"translate"===r)v.copy(m).sub(f),"local"===o&&"XYZ"!==t&&v.applyQuaternion(I),-1===t.indexOf("X")&&(v.x=0),-1===t.indexOf("Y")&&(v.y=0),-1===t.indexOf("Z")&&(v.z=0),"local"===o&&"XYZ"!==t?v.applyQuaternion(F).divide(S):v.applyQuaternion(M).divide(S),i.position.copy(v).add(N),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(d.copy(F).inverse()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(F)),"world"===o&&(i.parent&&i.position.add(u.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(u.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){var b=m.length()/f.length();m.dot(f)<0&&(b*=-1),h.set(b,b,b)}else u.copy(f),h.copy(m),u.applyQuaternion(I),h.applyQuaternion(I),h.divide(u),-1===t.search("X")&&(h.x=1),-1===t.search("Y")&&(h.y=1),-1===t.search("Z")&&(h.z=1);i.scale.copy(D).multiply(h)}else if("rotate"===r){v.copy(m).sub(f);var T=20/C.distanceTo(u.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(g.copy(O),x=m.angleTo(f),y.copy(f).normalize(),E.copy(m).normalize(),x*=E.cross(y).dot(O)<0?1:-1):"XYZE"===t?(g.copy(v).cross(O).normalize(),x=v.dot(u.copy(g).cross(this.eye))*T):"X"!==t&&"Y"!==t&&"Z"!==t||(g.copy(p[t]),u.copy(p[t]),"local"===o&&u.applyQuaternion(H),x=v.dot(u.cross(O).normalize())*T),this.rotationSnap&&(x=Math.round(x/this.rotationSnap)*this.rotationSnap),this.rotationAngle=x,"local"===o&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(F),i.quaternion.multiply(d.setFromAxisAngle(g,x)).normalize()):(g.applyQuaternion(M),i.quaternion.copy(d.setFromAxisAngle(g,x)),i.quaternion.multiply(F).normalize())}this.dispatchEvent(a),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return i.mode},this.setMode=function(e){i.mode=e},this.setTranslationSnap=function(e){i.translationSnap=e},this.setRotationSnap=function(e){i.rotationSnap=e},this.setSize=function(e){i.size=e},this.setSpace=function(e){i.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}},THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0}),THREE.TransformControlsGizmo=function(){"use strict";THREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),t=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),r=e.clone();r.opacity=.15;var n=e.clone();n.opacity=.33;var i=e.clone();i.color.set(16711680);var a=e.clone();a.color.set(65280);var o=e.clone();o.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var c=s.clone();c.color.set(65535);var u=s.clone();u.color.set(16711935),e.clone().color.set(16776960);var h=t.clone();h.color.set(16711680);var d=t.clone();d.color.set(65280);var p=t.clone();p.color.set(255);var f=t.clone();f.color.set(65535);var m=t.clone();m.color.set(16711935);var v=t.clone();v.color.set(16776960);var g=t.clone();g.color.set(7895160);var y=v.clone();y.opacity=.25;var E=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),x=new THREE.BoxBufferGeometry(.125,.125,.125),b=new THREE.BufferGeometry;b.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var T,w=function(e,t){for(var r=new THREE.BufferGeometry,n=[],i=0;i<=64*t;++i)n.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return r.addAttribute("position",new THREE.Float32BufferAttribute(n,3)),r},_={X:[[new THREE.Mesh(E,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(E,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(b,h)]],Y:[[new THREE.Mesh(E,a),[0,1,0],null,null,"fwd"],[new THREE.Mesh(E,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(b,d),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(E,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(E,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(b,p),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),s),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),l),[.15,.15,0]],[new THREE.Line(b,v),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(b,v),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),c),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(b,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(b,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),u),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(b,m),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(b,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},R={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),r)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},M={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new THREE.Line((T=new THREE.BufferGeometry,T.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),T),n),null,null,null,"helper"]],X:[[new THREE.Line(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},S={X:[[new THREE.Line(w(1,.5),h)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new THREE.Line(w(1,.5),d),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new THREE.Line(w(1,.5),p),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new THREE.Line(w(1.25,1),y),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new THREE.Line(w(1,1),g),null,[0,Math.PI/2,0]]]},A={AXIS:[[new THREE.Line(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),r)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),r)]]},L={X:[[new THREE.Mesh(x,i),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(b,h),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(x,a),[0,.8,0]],[new THREE.Line(b,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(x,o),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(b,p),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(x,l),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(b,v),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(b,v),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(x,c),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(b,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(b,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(x,u),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(b,m),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(b,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),s),[0,0,1.1]]]},C={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(x,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new THREE.Mesh(x,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new THREE.Mesh(x,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),r),[0,0,1.1]]]},H={X:[[new THREE.Line(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I=function(e){var t=new THREE.Object3D;for(var r in e)for(var n=e[r].length;n--;){var i=e[r][n][0].clone(),a=e[r][n][1],o=e[r][n][2],s=e[r][n][3],l=e[r][n][4];i.name=r,i.tag=l,a&&i.position.set(a[0],a[1],a[2]),o&&i.rotation.set(o[0],o[1],o[2]),s&&i.scale.set(s[0],s[1],s[2]),i.updateMatrix();var c=i.geometry.clone();c.applyMatrix(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t},k=new THREE.Vector3(0,0,0),O=new THREE.Euler,N=new THREE.Vector3(0,1,0),F=new THREE.Vector3(0,0,0),D=new THREE.Matrix4,z=new THREE.Quaternion,U=new THREE.Quaternion,B=new THREE.Quaternion,G=new THREE.Vector3(1,0,0),V=new THREE.Vector3(0,1,0),j=new THREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=I(_)),this.add(this.gizmo.rotate=I(S)),this.add(this.gizmo.scale=I(L)),this.add(this.picker.translate=I(R)),this.add(this.picker.rotate=I(P)),this.add(this.picker.scale=I(C)),this.add(this.helper.translate=I(M)),this.add(this.helper.rotate=I(A)),this.add(this.helper.scale=I(H)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:B;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var n=0;n<r.length;n++){var i=r[n];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition);var a=this.worldPosition.distanceTo(this.cameraPosition);if(i.scale.set(1,1,1).multiplyScalar(a*this.size/7),"helper"!==i.tag){if(i.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==i.name&&"XYZX"!==i.name||Math.abs(N.copy(G).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Y"!==i.name&&"XYZY"!==i.name||Math.abs(N.copy(V).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Z"!==i.name&&"XYZZ"!==i.name||Math.abs(N.copy(j).applyQuaternion(t).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XY"===i.name&&Math.abs(N.copy(j).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"YZ"===i.name&&Math.abs(N.copy(G).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XZ"===i.name&&Math.abs(N.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),-1!==i.name.search("X")&&(N.copy(G).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.x*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Y")&&(N.copy(V).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.y*=-1:"bwd"===i.tag&&(i.visible=!1)),-1!==i.name.search("Z")&&(N.copy(j).applyQuaternion(t).dot(this.eye)<0?"fwd"===i.tag?i.visible=!1:i.scale.z*=-1:"bwd"===i.tag&&(i.visible=!1))}else"rotate"===this.mode&&(U.copy(t),N.copy(this.eye).applyQuaternion(z.copy(t).inverse()),-1!==i.name.search("E")&&i.quaternion.setFromRotationMatrix(D.lookAt(this.eye,F,V)),"X"===i.name&&(z.setFromAxisAngle(G,Math.atan2(-N.y,N.z)),z.multiplyQuaternions(U,z),i.quaternion.copy(z)),"Y"===i.name&&(z.setFromAxisAngle(V,Math.atan2(N.x,N.z)),z.multiplyQuaternions(U,z),i.quaternion.copy(z)),"Z"===i.name&&(z.setFromAxisAngle(j,Math.atan2(N.y,N.x)),z.multiplyQuaternions(U,z),i.quaternion.copy(z)));i.visible=i.visible&&(-1===i.name.indexOf("X")||this.showX),i.visible=i.visible&&(-1===i.name.indexOf("Y")||this.showY),i.visible=i.visible&&(-1===i.name.indexOf("Z")||this.showZ),i.visible=i.visible&&(-1===i.name.indexOf("E")||this.showX&&this.showY&&this.showZ),i.material._opacity=i.material._opacity||i.material.opacity,i.material._color=i.material._color||i.material.color.clone(),i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled?this.axis&&(i.name===this.axis?(i.material.opacity=1,i.material.color.lerp(new THREE.Color(1,1,1),.5)):this.axis.split("").some(function(e){return i.name===e})?(i.material.opacity=1,i.material.color.lerp(new THREE.Color(1,1,1),.5)):(i.material.opacity*=.25,i.material.color.lerp(new THREE.Color(1,1,1),.5))):(i.material.opacity*=.5,i.material.color.lerp(new THREE.Color(1,1,1),.5))}else i.visible=!1,"AXIS"===i.name?(i.position.copy(this.worldPositionStart),i.visible=!!this.axis,"X"===this.axis&&(z.setFromEuler(O.set(0,0,0)),i.quaternion.copy(t).multiply(z),Math.abs(N.copy(G).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Y"===this.axis&&(z.setFromEuler(O.set(0,0,Math.PI/2)),i.quaternion.copy(t).multiply(z),Math.abs(N.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Z"===this.axis&&(z.setFromEuler(O.set(0,Math.PI/2,0)),i.quaternion.copy(t).multiply(z),Math.abs(N.copy(j).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"XYZE"===this.axis&&(z.setFromEuler(O.set(0,Math.PI/2,0)),N.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(D.lookAt(F,N,V)),i.quaternion.multiply(z),i.visible=this.dragging),"E"===this.axis&&(i.visible=!1)):"START"===i.name?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):"END"===i.name?(i.position.copy(this.worldPosition),i.visible=this.dragging):"DELTA"===i.name?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),k.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),k.applyQuaternion(this.worldQuaternionStart.clone().inverse()),i.scale.copy(k),i.visible=this.dragging):(i.quaternion.copy(t),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=-1!==this.axis.search(i.name)))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new THREE.Vector3(1,0,0),t=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Matrix4,s=new THREE.Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:s),r.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:s),a.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":a.copy(this.eye).cross(e),i.copy(e).cross(a);break;case"Y":a.copy(this.eye).cross(t),i.copy(t).cross(a);break;case"Z":a.copy(this.eye).cross(r),i.copy(r).cross(a);break;case"XY":i.copy(r);break;case"YZ":i.copy(e);break;case"XZ":a.copy(r),i.copy(t);break;case"XYZ":case"E":i.set(0,0,0)}break;case"rotate":default:i.set(0,0,0)}0===i.length()?this.quaternion.copy(this.cameraQuaternion):(o.lookAt(n.set(0,0,0),i,a),this.quaternion.setFromRotationMatrix(o)),THREE.Object3D.prototype.updateMatrixWorld.call(this)}},THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0})},function(e,t){THREE.GPUComputationRenderer=function(e,t,r){this.variables=[],this.currentTextureIndex=0;var n=new THREE.Scene,i=new THREE.Camera;i.position.z=1;var a={passThruTexture:{value:null}},o=c("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",a),s=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),o);function l(r){r.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function c(e,t){t=t||{};var r=new THREE.ShaderMaterial({uniforms:t,vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return l(r),r}n.add(s),this.addVariable=function(e,t,r){var n={name:e,initialValueTexture:r,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter};return this.variables.push(n),n},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!r.extensions.get("OES_texture_float")&&!r.capabilities.isWebGL2)return"No OES_texture_float support for float textures.";if(0===r.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var n=0;n<this.variables.length;n++){var i=this.variables[n];i.renderTargets[0]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),i.renderTargets[1]=this.createRenderTarget(e,t,i.wrapS,i.wrapT,i.minFilter,i.magFilter),this.renderTexture(i.initialValueTexture,i.renderTargets[0]),this.renderTexture(i.initialValueTexture,i.renderTargets[1]);var a=i.material,o=a.uniforms;if(null!==i.dependencies)for(var s=0;s<i.dependencies.length;s++){var l=i.dependencies[s];if(l.name!==i.name){for(var c=!1,u=0;u<this.variables.length;u++)if(l.name===this.variables[u].name){c=!0;break}if(!c)return"Variable dependency not found. Variable="+i.name+", dependency="+l.name}o[l.name]={value:null},a.fragmentShader="\nuniform sampler2D "+l.name+";\n"+a.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,r=0,n=this.variables.length;r<n;r++){var i=this.variables[r];if(null!==i.dependencies)for(var a=i.material.uniforms,o=0,s=i.dependencies.length;o<s;o++){var l=i.dependencies[o];a[l.name].value=l.renderTargets[e].texture}this.doRenderTarget(i.material,i.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=l,this.createShaderMaterial=c,this.createRenderTarget=function(r,n,i,a,o,s){return r=r||e,n=n||t,i=i||THREE.ClampToEdgeWrapping,a=a||THREE.ClampToEdgeWrapping,o=o||THREE.NearestFilter,s=s||THREE.NearestFilter,new THREE.WebGLRenderTarget(r,n,{wrapS:i,wrapT:a,minFilter:o,magFilter:s,format:THREE.RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?THREE.HalfFloatType:THREE.FloatType,stencilBuffer:!1,depthBuffer:!1})},this.createTexture=function(){var r=new Float32Array(e*t*4),n=new THREE.DataTexture(r,e,t,THREE.RGBAFormat,THREE.FloatType);return n.needsUpdate=!0,n},this.renderTexture=function(e,t){a.passThruTexture.value=e,this.doRenderTarget(o,t),a.passThruTexture.value=null},this.doRenderTarget=function(e,t){var a=r.getRenderTarget();s.material=e,r.setRenderTarget(t),r.render(n,i),s.material=o,r.setRenderTarget(a)}}},function(e,t){THREE.ImprovedNoise=function(){for(var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=0;t<256;t++)e[256+t]=e[t];function r(e){return e*e*e*(e*(6*e-15)+10)}function n(e,t,r){return t+e*(r-t)}function i(e,t,r,n){var i=15&e,a=i<8?t:r,o=i<4?r:12==i||14==i?t:n;return(0==(1&i)?a:-a)+(0==(2&i)?o:-o)}return{noise:function(t,a,o){var s=Math.floor(t),l=Math.floor(a),c=Math.floor(o),u=255&s,h=255&l,d=255&c,p=(t-=s)-1,f=(a-=l)-1,m=(o-=c)-1,v=r(t),g=r(a),y=r(o),E=e[u]+h,x=e[E]+d,b=e[E+1]+d,T=e[u+1]+h,w=e[T]+d,_=e[T+1]+d;return n(y,n(g,n(v,i(e[x],t,a,o),i(e[w],p,a,o)),n(v,i(e[b],t,f,o),i(e[_],p,f,o))),n(g,n(v,i(e[x+1],t,a,m),i(e[w+1],p,a,o-1)),n(v,i(e[b+1],t,f,m),i(e[_+1],p,f,m))))}}}},function(e,t){THREE.SimplexNoise=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]},THREE.SimplexNoise.prototype.dot=function(e,t,r){return e[0]*t+e[1]*r},THREE.SimplexNoise.prototype.dot3=function(e,t,r,n){return e[0]*t+e[1]*r+e[2]*n},THREE.SimplexNoise.prototype.dot4=function(e,t,r,n,i){return e[0]*t+e[1]*r+e[2]*n+e[3]*i},THREE.SimplexNoise.prototype.noise=function(e,t){var r,n,i=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+i),o=Math.floor(t+i),s=(3-Math.sqrt(3))/6,l=(a+o)*s,c=e-(a-l),u=t-(o-l);c>u?(r=1,n=0):(r=0,n=1);var h=c-r+s,d=u-n+s,p=c-1+2*s,f=u-1+2*s,m=255&a,v=255&o,g=this.perm[m+this.perm[v]]%12,y=this.perm[m+r+this.perm[v+n]]%12,E=this.perm[m+1+this.perm[v+1]]%12,x=.5-c*c-u*u,b=.5-h*h-d*d,T=.5-p*p-f*f;return 70*((x<0?0:(x*=x)*x*this.dot(this.grad3[g],c,u))+(b<0?0:(b*=b)*b*this.dot(this.grad3[y],h,d))+(T<0?0:(T*=T)*T*this.dot(this.grad3[E],p,f)))},THREE.SimplexNoise.prototype.noise3d=function(e,t,r){var n,i,a,o,s,l,c=(e+t+r)*(1/3),u=Math.floor(e+c),h=Math.floor(t+c),d=Math.floor(r+c),p=1/6,f=(u+h+d)*p,m=e-(u-f),v=t-(h-f),g=r-(d-f);m>=v?v>=g?(n=1,i=0,a=0,o=1,s=1,l=0):m>=g?(n=1,i=0,a=0,o=1,s=0,l=1):(n=0,i=0,a=1,o=1,s=0,l=1):v<g?(n=0,i=0,a=1,o=0,s=1,l=1):m<g?(n=0,i=1,a=0,o=0,s=1,l=1):(n=0,i=1,a=0,o=1,s=1,l=0);var y=m-n+p,E=v-i+p,x=g-a+p,b=m-o+2*p,T=v-s+2*p,w=g-l+2*p,_=m-1+.5,R=v-1+.5,M=g-1+.5,S=255&u,A=255&h,P=255&d,L=this.perm[S+this.perm[A+this.perm[P]]]%12,C=this.perm[S+n+this.perm[A+i+this.perm[P+a]]]%12,H=this.perm[S+o+this.perm[A+s+this.perm[P+l]]]%12,I=this.perm[S+1+this.perm[A+1+this.perm[P+1]]]%12,k=.6-m*m-v*v-g*g,O=.6-y*y-E*E-x*x,N=.6-b*b-T*T-w*w,F=.6-_*_-R*R-M*M;return 32*((k<0?0:(k*=k)*k*this.dot3(this.grad3[L],m,v,g))+(O<0?0:(O*=O)*O*this.dot3(this.grad3[C],y,E,x))+(N<0?0:(N*=N)*N*this.dot3(this.grad3[H],b,T,w))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[I],_,R,M)))},THREE.SimplexNoise.prototype.noise4d=function(e,t,r,n){var i,a,o,s,l,c,u,h,d,p,f,m,v=this.grad4,g=this.simplex,y=this.perm,E=(Math.sqrt(5)-1)/4,x=(5-Math.sqrt(5))/20,b=(e+t+r+n)*E,T=Math.floor(e+b),w=Math.floor(t+b),_=Math.floor(r+b),R=Math.floor(n+b),M=(T+w+_+R)*x,S=e-(T-M),A=t-(w-M),P=r-(_-M),L=n-(R-M),C=(S>A?32:0)+(S>P?16:0)+(A>P?8:0)+(S>L?4:0)+(A>L?2:0)+(P>L?1:0),H=S-(i=g[C][0]>=3?1:0)+x,I=A-(a=g[C][1]>=3?1:0)+x,k=P-(o=g[C][2]>=3?1:0)+x,O=L-(s=g[C][3]>=3?1:0)+x,N=S-(l=g[C][0]>=2?1:0)+2*x,F=A-(c=g[C][1]>=2?1:0)+2*x,D=P-(u=g[C][2]>=2?1:0)+2*x,z=L-(h=g[C][3]>=2?1:0)+2*x,U=S-(d=g[C][0]>=1?1:0)+3*x,B=A-(p=g[C][1]>=1?1:0)+3*x,G=P-(f=g[C][2]>=1?1:0)+3*x,V=L-(m=g[C][3]>=1?1:0)+3*x,j=S-1+4*x,W=A-1+4*x,X=P-1+4*x,Y=L-1+4*x,q=255&T,Q=255&w,Z=255&_,K=255&R,J=y[q+y[Q+y[Z+y[K]]]]%32,$=y[q+i+y[Q+a+y[Z+o+y[K+s]]]]%32,ee=y[q+l+y[Q+c+y[Z+u+y[K+h]]]]%32,te=y[q+d+y[Q+p+y[Z+f+y[K+m]]]]%32,re=y[q+1+y[Q+1+y[Z+1+y[K+1]]]]%32,ne=.6-S*S-A*A-P*P-L*L,ie=.6-H*H-I*I-k*k-O*O,ae=.6-N*N-F*F-D*D-z*z,oe=.6-U*U-B*B-G*G-V*V,se=.6-j*j-W*W-X*X-Y*Y;return 27*((ne<0?0:(ne*=ne)*ne*this.dot4(v[J],S,A,P,L))+(ie<0?0:(ie*=ie)*ie*this.dot4(v[$],H,I,k,O))+(ae<0?0:(ae*=ae)*ae*this.dot4(v[ee],N,F,D,z))+(oe<0?0:(oe*=oe)*oe*this.dot4(v[te],U,B,G,V))+(se<0?0:(se*=se)*se*this.dot4(v[re],j,W,X,Y)))}},function(e,t){THREE.SimplifyModifier=function(){},function(){var e=new THREE.Vector3,t=new THREE.Vector3;function r(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}function n(e,t){var r,n,i,a=t.position.distanceTo(e.position),o=0,s=[],l=e.faces.length;for(r=0;r<l;r++)(n=e.faces[r]).hasVertex(t)&&s.push(n);for(r=0;r<l;r++){var c=1;n=e.faces[r];for(var u=0;u<s.length;u++){i=s[u];var h=n.normal.dot(i.normal);c=Math.min(c,(1.001-h)/2)}o=Math.max(o,c)}return s.length<2&&(o=1),a*o+0}function i(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var r=n(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=r,e.minCost=r,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=r,r<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=r)}e.collapseCost=e.totalCost/e.costCount}function a(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){r(e.neighbors.pop().neighbors,e)}r(t,e)}function o(e,t){r(t,e),e.v1&&r(e.v1.faces,e),e.v2&&r(e.v2.faces,e),e.v3&&r(e.v3.faces,e);for(var n,i,a=[e.v1,e.v2,e.v3],o=0;o<3;o++)i=a[(o+1)%3],(n=a[o])&&i&&(n.removeIfNonNeighbor(i),i.removeIfNonNeighbor(n))}function s(e,t,r,n){if(n){var s,l=[];for(s=0;s<r.neighbors.length;s++)l.push(r.neighbors[s]);for(s=r.faces.length-1;s>=0;s--)r.faces[s].hasVertex(n)&&o(r.faces[s],t);for(s=r.faces.length-1;s>=0;s--)r.faces[s].replaceVertex(r,n);for(a(r,e),s=0;s<l.length;s++)i(l[s])}else a(r,e)}function l(e){for(var t=e[0],r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t}function c(e,t,r,n,i,a){this.a=n,this.b=i,this.c=a,this.v1=e,this.v2=t,this.v3=r,this.normal=new THREE.Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}function u(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}c.prototype.computeNormal=function(){var r=this.v1.position,n=this.v2.position,i=this.v3.position;e.subVectors(i,n),t.subVectors(r,n),e.cross(t).normalize(),this.normal.copy(e)},c.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},c.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),r(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},u.prototype.addUniqueNeighbor=function(e){!function(e,t){-1===e.indexOf(t)&&e.push(t)}(this.neighbors,e)},u.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,r=this.faces,n=t.indexOf(e);if(-1!==n){for(var i=0;i<r.length;i++)if(r[i].hasVertex(e))return;t.splice(n,1)}},THREE.SimplifyModifier.prototype.modify=function(e,t){e.isBufferGeometry&&(e=(new THREE.Geometry).fromBufferGeometry(e)),e.mergeVertices();var r,n,a,o=e.vertices,h=e.faces,d=[],p=[];for(r=0,n=o.length;r<n;r++){var f=new u(o[r],r);d.push(f)}for(r=0,n=h.length;r<n;r++){var m=(w=h[r]).a,v=w.b,g=w.c,y=new c(d[m],d[v],d[g],m,v,g);p.push(y)}for(r=0,n=d.length;r<n;r++)i(d[r]);for(var E=t;E--;){if(!(a=l(d))){console.log("THREE.SimplifyModifier: No next vertex");break}s(d,p,a,a.collapseNeighbor)}var x=new THREE.BufferGeometry,b=[],T=[];for(r=0;r<d.length;r++){f=d[r].position;b.push(f.x,f.y,f.z)}for(r=0;r<p.length;r++){var w=p[r];m=d.indexOf(w.v1),v=d.indexOf(w.v2),g=d.indexOf(w.v3);T.push(m,v,g)}return x.addAttribute("position",new THREE.Float32BufferAttribute(b,3)),x.setIndex(T),x}}()},function(e,t){THREE.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e},THREE.SubdivisionModifier.prototype.modify=function(e){(e=e.isBufferGeometry?(new THREE.Geometry).fromBufferGeometry(e):e.clone()).mergeVertices();for(var t=this.subdivisions;t-- >0;)this.smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e},function(){var e=["a","b","c"];function t(e,t,r){return r[Math.min(e,t)+"_"+Math.max(e,t)]}function r(e,t,r,n,i,a){var o,s=Math.min(e,t),l=Math.max(e,t),c=s+"_"+l;c in n?o=n[c]:(o={a:r[s],b:r[l],newEdge:null,faces:[]},n[c]=o);o.faces.push(i),a[e].edges.push(o),a[t].edges.push(o)}function n(e,t,r,n,i){e.push(new THREE.Face3(t,r,n,void 0,void 0,i))}function i(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function a(e,t,r,n){e.push([t.clone(),r.clone(),n.clone()])}THREE.SubdivisionModifier.prototype.smooth=function(o){var s,l,c,u,h,d,p,f,m,v,g,y,E,x,b=new THREE.Vector3,T=[];s=o.vertices,l=o.faces;var w,_,R,M,S,A,P,L,C,H,I,k,O,N,F=void 0!==(c=o.faceVertexUvs[0])&&c.length>0;for(p in function(e,t,n,i){var a,o,s;for(a=0,o=e.length;a<o;a++)n[a]={edges:[]};for(a=0,o=t.length;a<o;a++)r((s=t[a]).a,s.b,e,i,s,n),r(s.b,s.c,e,i,s,n),r(s.c,s.a,e,i,s,n)}(s,l,g=new Array(s.length),y={}),E=[],y){for(_=y[p],R=new THREE.Vector3,S=3/8,A=1/8,2!=(P=_.faces.length)&&(S=.5,A=0),R.addVectors(_.a,_.b).multiplyScalar(S),b.set(0,0,0),m=0;m<P;m++){for(M=_.faces[m],v=0;v<3&&((w=s[M[e[v]]])===_.a||w===_.b);v++);b.add(w)}b.multiplyScalar(A),R.add(b),_.newEdge=E.length,E.push(R)}for(x=[],p=0,f=s.length;p<f;p++){for(O=s[p],3==(d=(k=g[p].edges).length)?L=3/16:d>3&&(L=3/(8*d)),C=1-d*L,H=L,d<=2&&2==d&&(C=.75,H=1/8),N=O.clone().multiplyScalar(C),b.set(0,0,0),m=0;m<d;m++)w=(I=k[m]).a!==O?I.a:I.b,b.add(w);b.multiplyScalar(H),N.add(b),x.push(N)}u=x.concat(E);var D,z,U,B,G,V,j,W=x.length;h=[];var X=new THREE.Vector2,Y=new THREE.Vector2,q=new THREE.Vector2;for(p=0,f=l.length;p<f;p++)n(h,D=t((M=l[p]).a,M.b,y).newEdge+W,z=t(M.b,M.c,y).newEdge+W,U=t(M.c,M.a,y).newEdge+W,M.materialIndex),n(h,M.a,D,U,M.materialIndex),n(h,M.b,z,D,M.materialIndex),n(h,M.c,U,z,M.materialIndex),F&&(G=(B=c[p])[0],V=B[1],j=B[2],X.set(i(G.x,V.x),i(G.y,V.y)),Y.set(i(V.x,j.x),i(V.y,j.y)),q.set(i(G.x,j.x),i(G.y,j.y)),a(T,X,Y,q),a(T,G,X,q),a(T,V,Y,X),a(T,j,q,Y));o.vertices=u,o.faces=h,F&&(o.faceVertexUvs[0]=T)}}()},function(e,t){THREE.PhysicsRenderer=function(e,t,r){this.checkCompatibility(r),this.renderer=r,this.size=e||128,this.resolution=new THREE.Vector2(this.size,this.size),this.rt_1=new THREE.WebGLRenderTarget(this.size,this.size,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType,stencilBuffer:!1}),this.rt_2=this.rt_1.clone(),this.rt_3=this.rt_1.clone(),this.counter=0,this.texturePass=this.createTexturePassProgram(),this.simulatePass=this.createSimulatePassProgram(t),this.boundTextures=[],this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.mesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2)),this.scene.add(this.mesh)},THREE.PhysicsRenderer.prototype.checkCompatibility=function(e){var t=e.context;null!==t.getExtension("OES_texture_float")?0!==t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)||this.onError("Vertex Shader Textures don't work"):this.onError("No Float Textures")},THREE.PhysicsRenderer.prototype.onError=function(e){console.log(e)},THREE.PhysicsRenderer.prototype.createDebugScene=function(){var e=new THREE.Object3D;e.position.z=0;var t,r=new THREE.PlaneBufferGeometry(100,100);return(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_1}))).position.set(-105,0,0),e.add(t),(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_2}))).position.set(0,0,0),e.add(t),(t=new THREE.Mesh(r,new THREE.MeshBasicMaterial({map:this.rt_3}))).position.set(105,0,0),e.add(t),e},THREE.PhysicsRenderer.prototype.removeDebugScene=function(e){e.remove(this.debugScene)},THREE.PhysicsRenderer.prototype.addDebugScene=function(e){e.add(this.debugScene)},THREE.PhysicsRenderer.prototype.createTexturePassProgram=function(){return new THREE.ShaderMaterial({uniforms:{texture:{type:"t",value:null}},vertexShader:this.VSPass,fragmentShader:this.FSPass})},THREE.PhysicsRenderer.prototype.createSimulatePassProgram=function(e){var t={t_oPos:{type:"t",value:null},t_pos:{type:"t",value:null},resolution:{type:"v2",value:this.resolution}};return new THREE.ShaderMaterial({uniforms:t,vertexShader:this.VSPass,fragmentShader:e})},THREE.PhysicsRenderer.prototype.update=function(){var e=this.counter%3;0==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_1.texture,this.simulatePass.uniforms.t_pos.value=this.rt_2.texture,this.pass(this.simulatePass,this.rt_3),this.ooOutput=this.rt_1.texture,this.oOutput=this.rt_2.texture,this.output=this.rt_3.texture):1==e?(this.simulatePass.uniforms.t_oPos.value=this.rt_2.texture,this.simulatePass.uniforms.t_pos.value=this.rt_3.texture,this.pass(this.simulatePass,this.rt_1),this.ooOutput=this.rt_2.texture,this.oOutput=this.rt_3.texture,this.output=this.rt_1.texture):2==e&&(this.simulatePass.uniforms.t_oPos.value=this.rt_3.texture,this.simulatePass.uniforms.t_pos.value=this.rt_1.texture,this.pass(this.simulatePass,this.rt_2),this.ooOutput=this.rt_3.texture,this.oOutput=this.rt_1.texture,this.output=this.rt_2.texture),this.counter++,this.bindTextures()},THREE.PhysicsRenderer.prototype.render=function(e,t,r){this.renderer.setRenderTarget(r),this.renderer.render(e,t)},THREE.PhysicsRenderer.prototype.pass=function(e,t){this.mesh.material=e,this.renderer.setRenderTarget(t),this.renderer.render(this.scene,this.camera)},THREE.PhysicsRenderer.prototype.out=function(e){this.mesh.material=e.material,this.renderer.render(this.scene,this.camera)},THREE.PhysicsRenderer.prototype.setUniforms=function(e){for(var t in e)this.simulatePass.uniforms[t]=e[t];this.simulatePass.uniforms.t_pos={type:"t",value:null},this.simulatePass.uniforms.t_oPos={type:"t",value:null},this.simulatePass.uniforms.resolution={type:"v2",value:this.resolution}},THREE.PhysicsRenderer.prototype.setUniform=function(e,t){this.simulatePass.uniforms[e]=t},THREE.PhysicsRenderer.prototype.reset=function(e){this.texture=e,this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,this.rt_1),this.pass(this.texturePass,this.rt_2),this.pass(this.texturePass,this.rt_3)},THREE.PhysicsRenderer.prototype.passTexture=function(e,t){this.texturePass.uniforms.texture.value=e,this.pass(this.texturePass,t)},THREE.PhysicsRenderer.prototype.resetRand=function(e,t,r,n){e=e||100,t=t||0,r=r||0,n=n||0;for(var i=new Float32Array(this.size*this.size*4),a=0;a<i.length;a+=4)i[a+0]=t+(Math.random()-.5)*e,i[a+1]=r+(Math.random()-.5)*e,i[a+2]=n+(Math.random()-.5)*e,i[a+3]=100;var o=new THREE.DataTexture(i,this.size,this.size,THREE.RGBAFormat,THREE.FloatType);o.minFilter=THREE.NearestFilter,o.magFilter=THREE.NearestFilter,o.needsUpdate=!0,this.reset(o)},THREE.PhysicsRenderer.prototype.addBoundTexture=function(e,t){this.boundTextures.push([e,t])},THREE.PhysicsRenderer.prototype.bindTextures=function(){for(var e=0;e<this.boundTextures.length;e++){var t=this.boundTextures[e][0],r=this.boundTextures[e][1];t.value=this[r]}},THREE.PhysicsRenderer.prototype.VSPass=["varying vec2 vUv;","void main() {","  vUv = uv;","  gl_Position = vec4( position, 1.0 );","}"].join("\n"),THREE.PhysicsRenderer.prototype.FSPass=["uniform sampler2D texture;","varying vec2 vUv;","void main() {","  vec4 c = texture2D( texture , vUv );","  gl_FragColor = c;","}"].join("\n")},function(e,t){THREE.MirrorRenderer=function(e,t,r,n){function i(e,t){return void 0!==e?e:t}THREE.Object3D.call(this),this.name="mirror_"+this.id,n=n||{},this.matrixNeedsUpdate=!0;var a=i(n.textureWidth,512),o=i(n.textureHeight,512);this.clipBias=i(n.clipBias,0),this.renderer=e,this.scene=r,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,-1),this.clipPlane=new THREE.Vector4,t instanceof THREE.PerspectiveCamera?this.camera=t:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.mesh=new THREE.Object3D,this.texture=new THREE.WebGLRenderTarget(a,o),this.tempTexture=new THREE.WebGLRenderTarget(a,o),THREE.Math.isPowerOfTwo(a)&&THREE.Math.isPowerOfTwo(o)||(this.texture.texture.generateMipmaps=!1,this.tempTexture.texture.generateMipmaps=!1),this.updateTextureMatrix(),this.render()},THREE.MirrorRenderer.prototype=Object.create(THREE.Object3D.prototype),THREE.MirrorRenderer.prototype.renderWithMirror=function(e){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var t=e.camera;e.camera=this.mirrorCamera,e.render(!0),e.material.uniforms.mirrorSampler.value=e.tempTexture.texture,this.render(),this.matrixNeedsUpdate=!0,e.material.uniforms.mirrorSampler.value=e.texture.texture,e.camera=t,e.updateTextureMatrix()},THREE.MirrorRenderer.prototype.updateTextureMatrix=function(){function e(e){return e?e<0?-1:1:0}null!=this.parent&&(this.mesh=this.parent),this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal=new THREE.Vector3(0,1,0).applyEuler(this.mesh.rotation);var t=new THREE.Vector3(0,0,1).applyEuler(this.camera.rotation);if(this.normal.dot(t)<0){var r=new THREE.Vector3(0,0,1).applyEuler(this.mesh.rotation);this.normal.reflect(r)}var n=this.mesh.position.clone().sub(this.cameraWorldPosition);n.reflect(this.normal).negate(),n.add(this.mesh.position),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var i=this.mesh.position.clone().sub(this.lookAtPosition);i.reflect(this.normal).negate(),i.add(this.mesh.position),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(n),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(i),this.mirrorCamera.aspect=this.camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mesh.position),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var a=new THREE.Vector4,o=this.mirrorCamera.projectionMatrix;a.x=(e(this.clipPlane.x)+o.elements[8])/o.elements[0],a.y=(e(this.clipPlane.y)+o.elements[9])/o.elements[5],a.z=-1,a.w=(1+o.elements[10])/o.elements[14];var s=new THREE.Vector4;s=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(a)),o.elements[2]=s.x,o.elements[6]=s.y,o.elements[10]=s.z+1-this.clipBias,o.elements[14]=s.w;var l=new THREE.Vector3;l.setFromMatrixPosition(this.camera.matrixWorld),this.eye=l},THREE.MirrorRenderer.prototype.render=function(e){if(this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0,void 0!==this.scene&&this.scene instanceof THREE.Scene){var t=void 0!==e&&e?this.tempTexture:this.texture;this.renderer.setRenderTarget(t),this.renderer.clear(),this.renderer.render(this.scene,this.mirrorCamera)}}},function(e,t){THREE.ShaderLib.ocean_sim_vertex={vertexShader:["varying vec2 vUV;","void main (void) {","vUV = position.xy * 0.5 + 0.5;","gl_Position = vec4(position, 1.0);","}"].join("\n")},THREE.ShaderLib.ocean_subtransform={uniforms:{u_input:{value:null},u_transformSize:{value:512},u_subtransformSize:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","uniform sampler2D u_input;","uniform float u_transformSize;","uniform float u_subtransformSize;","varying vec2 vUV;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","void main (void) {","#ifdef HORIZONTAL","float index = vUV.x * u_transformSize - 0.5;","#else","float index = vUV.y * u_transformSize - 0.5;","#endif","float evenIndex = floor(index / u_subtransformSize) * (u_subtransformSize * 0.5) + mod(index, u_subtransformSize * 0.5);","#ifdef HORIZONTAL","vec4 even = texture2D(u_input, vec2(evenIndex + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(evenIndex + u_transformSize * 0.5 + 0.5, gl_FragCoord.y) / u_transformSize).rgba;","#else","vec4 even = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + 0.5) / u_transformSize).rgba;","vec4 odd = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + u_transformSize * 0.5 + 0.5) / u_transformSize).rgba;","#endif","float twiddleArgument = -2.0 * PI * (index / u_subtransformSize);","vec2 twiddle = vec2(cos(twiddleArgument), sin(twiddleArgument));","vec2 outputA = even.xy + multiplyComplex(twiddle, odd.xy);","vec2 outputB = even.zw + multiplyComplex(twiddle, odd.zw);","gl_FragColor = vec4(outputA, outputB);","}"].join("\n")},THREE.ShaderLib.ocean_initial_spectrum={uniforms:{u_wind:{value:new THREE.Vector2(10,10)},u_resolution:{value:512},u_size:{value:250}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","const float CM = 0.23;","uniform vec2 u_wind;","uniform float u_resolution;","uniform float u_size;","float square (float x) {","return x * x;","}","float omega (float k) {","return sqrt(G * k * (1.0 + square(k / KM)));","}","float tanh_ (float x) {","return (1.0 - exp(-2.0 * x)) / (1.0 + exp(-2.0 * x));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 K = (2.0 * PI * vec2(n, m)) / u_size;","float k = length(K);","float l_wind = length(u_wind);","float Omega = 0.84;","float kp = G * square(Omega / l_wind);","float c = omega(k) / k;","float cp = omega(kp) / kp;","float Lpm = exp(-1.25 * square(kp / k));","float gamma = 1.7;","float sigma = 0.08 * (1.0 + 4.0 * pow(Omega, -3.0));","float Gamma = exp(-square(sqrt(k / kp) - 1.0) / 2.0 * square(sigma));","float Jp = pow(gamma, Gamma);","float Fp = Lpm * Jp * exp(-Omega / sqrt(10.0) * (sqrt(k / kp) - 1.0));","float alphap = 0.006 * sqrt(Omega);","float Bl = 0.5 * alphap * cp / c * Fp;","float z0 = 0.000037 * square(l_wind) / G * pow(l_wind / cp, 0.9);","float uStar = 0.41 * l_wind / log(10.0 / z0);","float alpham = 0.01 * ((uStar < CM) ? (1.0 + log(uStar / CM)) : (1.0 + 3.0 * log(uStar / CM)));","float Fm = exp(-0.25 * square(k / KM - 1.0));","float Bh = 0.5 * alpham * CM / c * Fm * Lpm;","float a0 = log(2.0) / 4.0;","float am = 0.13 * uStar / CM;","float Delta = tanh_(a0 + 4.0 * pow(c / cp, 2.5) + am * pow(CM / c, 2.5));","float cosPhi = dot(normalize(u_wind), normalize(K));","float S = (1.0 / (2.0 * PI)) * pow(k, -4.0) * (Bl + Bh) * (1.0 + Delta * (2.0 * cosPhi * cosPhi - 1.0));","float dk = 2.0 * PI / u_size;","float h = sqrt(S / 2.0) * dk;","if (K.x == 0.0 && K.y == 0.0) {","h = 0.0;","}","gl_FragColor = vec4(h, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_phase={uniforms:{u_phases:{value:null},u_deltaTime:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform sampler2D u_phases;","uniform float u_deltaTime;","uniform float u_resolution;","uniform float u_size;","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","float deltaTime = 1.0 / 60.0;","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","float deltaPhase = omega(length(waveVector)) * u_deltaTime;","phase = mod(phase + deltaPhase, 2.0 * PI);","gl_FragColor = vec4(phase, 0.0, 0.0, 0.0);","}"].join("\n")},THREE.ShaderLib.ocean_spectrum={uniforms:{u_size:{value:null},u_resolution:{value:null},u_choppiness:{value:null},u_phases:{value:null},u_initialSpectrum:{value:null}},fragmentShader:["precision highp float;","const float PI = 3.14159265359;","const float G = 9.81;","const float KM = 370.0;","varying vec2 vUV;","uniform float u_size;","uniform float u_resolution;","uniform float u_choppiness;","uniform sampler2D u_phases;","uniform sampler2D u_initialSpectrum;","vec2 multiplyComplex (vec2 a, vec2 b) {","return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);","}","vec2 multiplyByI (vec2 z) {","return vec2(-z[1], z[0]);","}","float omega (float k) {","return sqrt(G * k * (1.0 + k * k / KM * KM));","}","void main (void) {","vec2 coordinates = gl_FragCoord.xy - 0.5;","float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;","float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;","vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;","float phase = texture2D(u_phases, vUV).r;","vec2 phaseVector = vec2(cos(phase), sin(phase));","vec2 h0 = texture2D(u_initialSpectrum, vUV).rg;","vec2 h0Star = texture2D(u_initialSpectrum, vec2(1.0 - vUV + 1.0 / u_resolution)).rg;","h0Star.y *= -1.0;","vec2 h = multiplyComplex(h0, phaseVector) + multiplyComplex(h0Star, vec2(phaseVector.x, -phaseVector.y));","vec2 hX = -multiplyByI(h * (waveVector.x / length(waveVector))) * u_choppiness;","vec2 hZ = -multiplyByI(h * (waveVector.y / length(waveVector))) * u_choppiness;","if (waveVector.x == 0.0 && waveVector.y == 0.0) {","h = vec2(0.0);","hX = vec2(0.0);","hZ = vec2(0.0);","}","gl_FragColor = vec4(hX + multiplyByI(h), hZ);","}"].join("\n")},THREE.ShaderLib.ocean_normals={uniforms:{u_displacementMap:{value:null},u_resolution:{value:null},u_size:{value:null}},fragmentShader:["precision highp float;","varying vec2 vUV;","uniform sampler2D u_displacementMap;","uniform float u_resolution;","uniform float u_size;","void main (void) {","float texel = 1.0 / u_resolution;","float texelSize = u_size / u_resolution;","vec3 center = texture2D(u_displacementMap, vUV).rgb;","vec3 right = vec3(texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(texel, 0.0)).rgb - center;","vec3 left = vec3(-texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(-texel, 0.0)).rgb - center;","vec3 top = vec3(0.0, 0.0, -texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, -texel)).rgb - center;","vec3 bottom = vec3(0.0, 0.0, texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, texel)).rgb - center;","vec3 topRight = cross(right, top);","vec3 topLeft = cross(top, left);","vec3 bottomLeft = cross(left, bottom);","vec3 bottomRight = cross(bottom, right);","gl_FragColor = vec4(normalize(topRight + topLeft + bottomLeft + bottomRight), 1.0);","}"].join("\n")},THREE.ShaderChunk.screenplane_pars_vertex=["const float infinite = 150000.0;","const float screenScale = 1.2;","const vec3 groundNormal = vec3( 0.0, 1.0, 0.0 );","varying vec3 vCamPosition;","vec3 interceptPlane( in vec3 source, in vec3 dir, in vec3 normal, float height )","{","\tfloat distance = ( - height - dot( normal, source ) ) / dot( normal, dir );","\tif( distance < 0.0 )","\t\treturn source + dir * distance;","\telse ","\t\treturn - ( vec3( source.x, height, source.z ) + vec3( dir.x, height, dir.z ) * infinite );","}","mat3 getRotation()","{","\treturn mat3( ","\t\tviewMatrix[0].xyz,","\t\tviewMatrix[1].xyz,","\t\tviewMatrix[2].xyz","\t);","}","vec3 getCameraPos( in mat3 rotation )","{","\treturn - viewMatrix[3].xyz * rotation;","}","vec2 getImagePlan()","{","\tfloat focal = projectionMatrix[0].x;","\tfloat aspect = projectionMatrix[1].y;","\treturn vec2( ( uv.x - 0.5 ) * screenScale * aspect, ( uv.y - 0.5 ) * screenScale * focal );","}","vec3 getCamRay( in mat3 rotation, in vec2 screenUV )","{","\treturn vec3( screenUV.x, screenUV.y, projectionMatrix[0].x ) * rotation;","}","vec3 computeProjectedPosition()","{","\tmat3 cameraRotation = getRotation();","\tvec3 camPosition = getCameraPos( cameraRotation );","\tvCamPosition = camPosition;","\tvec2 screenUV = getImagePlan();","\tvec3 ray = getCamRay( cameraRotation, screenUV );","\tvec3 finalPos = interceptPlane( camPosition, ray, groundNormal, -u_groundHeight );","\tfloat distance = length( finalPos );","\tif( distance > infinite )","\t\tfinalPos *= infinite / distance;","\treturn finalPos;","}"].join("\n"),THREE.ShaderChunk.screenplane_vertex=["vec4 screenPlaneWorldPosition = vec4( computeProjectedPosition(), 1.0 );"].join("\n"),THREE.ShaderChunk.screenplane_pars_fragment=["varying vec3 vCamPosition;"].join("\n"),THREE.ShaderChunk.oceanfft_pars_vertex=["uniform sampler2D u_displacementMap;","uniform float u_geometrySize;","uniform float u_size;"].join("\n"),THREE.ShaderChunk.oceanfft_vertex=["vec3 displacement = texture2D( u_displacementMap, worldPosition.xz * 0.002 ).rgb * ( u_geometrySize / u_size );","vec4 oceanfftWorldPosition = worldPosition + vec4( displacement, 0.0 );"].join("\n"),THREE.ShaderLib.ocean_main={uniforms:{u_displacementMap:{value:null},u_reflection:{value:null},u_normalMap:{value:null},u_geometrySize:{value:null},u_size:{value:null},u_mirrorMatrix:{value:null},u_oceanColor:{value:null},u_sunDirection:{value:null},u_exposure:{value:null},u_groundHeight:{value:null}},vertexShader:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vec4 worldPosition = screenPlaneWorldPosition;",THREE.ShaderChunk.oceanfft_vertex,"vWorldPosition = oceanfftWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * oceanfftWorldPosition;","gl_Position = projectionMatrix * viewMatrix * oceanfftWorldPosition;","}"].join("\n"),vertexShaderNoTexLookup:["precision highp float;","varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform mat4 u_mirrorMatrix;","uniform float u_groundHeight;",THREE.ShaderChunk.screenplane_pars_vertex,THREE.ShaderChunk.oceanfft_pars_vertex,"void main (void) {",THREE.ShaderChunk.screenplane_vertex,"vWorldPosition = screenPlaneWorldPosition.xyz;","vReflectCoordinates = u_mirrorMatrix * screenPlaneWorldPosition;","gl_Position = projectionMatrix * viewMatrix * screenPlaneWorldPosition;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec4 vReflectCoordinates;","uniform sampler2D u_reflection;","uniform sampler2D u_normalMap;","uniform vec3 u_oceanColor;","uniform vec3 u_sunDirection;","uniform float u_exposure;","vec3 hdr (vec3 color, float exposure) {","return 1.0 - exp(-color * exposure);","}",THREE.ShaderChunk.screenplane_pars_fragment,"void main (void) {","vec3 normal = texture2D( u_normalMap, vWorldPosition.xz * 0.002 ).rgb;","vec3 view = normalize( vCamPosition - vWorldPosition );","vec3 reflection = normalize( reflect( -u_sunDirection, normal ) );","float specularFactor = pow( max( 0.0, dot( view, reflection ) ), 500.0 ) * 20.0;","vec3 distortion = 200.0 * normal * vec3( 1.0, 0.0, 0.1 );","vec3 reflectionColor = texture2DProj( u_reflection, vReflectCoordinates.xyz + distortion ).xyz;","float distanceRatio = min( 1.0, log( 1.0 / length( vCamPosition - vWorldPosition ) * 3000.0 + 1.0 ) );","distanceRatio *= distanceRatio;","distanceRatio = distanceRatio * 0.7 + 0.3;","normal = ( distanceRatio * normal + vec3( 0.0, 1.0 - distanceRatio, 0.0 ) ) * 0.5;","normal /= length( normal );","float fresnel = pow( 1.0 - dot( normal, view ), 2.0 );","float skyFactor = ( fresnel + 0.2 ) * 10.0;","vec3 waterColor = ( 1.0 - fresnel ) * u_oceanColor;","vec3 color = ( skyFactor + specularFactor + waterColor ) * reflectionColor + waterColor * 0.5 ;","color = hdr( color, u_exposure );","gl_FragColor = vec4( color, 1.0 );","}"].join("\n")}},function(e,t,r){"use strict";window.ThreeBSP=function(){var e;return(e=function(e){this.matrix=new THREE.Matrix4,this.create(e)}).prototype.subtract=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.invert(),r.clipTo(n),n.clipTo(r),n.invert(),n.clipTo(r),n.invert(),r.build(n.allPolygons()),r.invert(),(r=new e(r)).matrix=this.matrix,r},e.prototype.union=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.clipTo(n),n.clipTo(r),n.invert(),n.clipTo(r),n.invert(),r.build(n.allPolygons()),(r=new e(r)).matrix=this.matrix,r},e.prototype.intersect=function(t){var r=this.tree.clone(),n=t.tree.clone();return r.invert(),n.clipTo(r),n.invert(),r.clipTo(n),n.clipTo(r),r.build(n.allPolygons()),r.invert(),(r=new e(r)).matrix=this.matrix,r},e.prototype.create=function(t){if(t instanceof THREE.Geometry)this.fromGeometry(t);else if(t instanceof THREE.BufferGeometry)this.fromBufferGeometry(t);else{if(!(t instanceof THREE.Mesh)){if(t instanceof e.Node)return this.tree=t,this;throw new Error("ThreeBSP: is unable to create a BSP for the given input")}this.fromMesh(t)}},e.prototype.fromGeometry=function(t){var r,n,i,a,o,s,l,c=[];for(r=0,n=t.faces.length;r<n;r++)i=t.faces[r],o=t.faceVertexUvs[0][r],l=new e.Polygon,a=t.vertices[i.a],s=o?new THREE.Vector2(o[0].x,o[0].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[0],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.b],s=o?new THREE.Vector2(o[1].x,o[1].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[1],s)).applyMatrix4(this.matrix),l.vertices.push(a),a=t.vertices[i.c],s=o?new THREE.Vector2(o[2].x,o[2].y):null,(a=new e.Vertex(a.x,a.y,a.z,i.vertexNormals[2],s)).applyMatrix4(this.matrix),l.vertices.push(a),l.calculateProperties(),c.push(l);this.tree=new e.Node(c)},e.prototype.fromIndexedBufferGeometry=function(t){var r,n,i,a,o,s,l,c,u,h,d,p,f,m=t.index.array,v=t.attributes.position.array,g=t.attributes.normal.array,y=t.attributes.uv.array,E=[];for(r=0,n=m.length;r<n;r+=3){for(o=new e.Polygon,s=0;s<3;s++)c=(l=3*(i=m[r+s]))+1,u=l+2,d=(h=2*i)+1,p=g?new THREE.Vector3(g[l],g[c],g[u]):null,f=y?new THREE.Vector2(y[h],y[d]):null,(a=new e.Vertex(v[l],v[c],v[u],p,f)).applyMatrix4(this.matrix),o.vertices.push(a);o.calculateProperties(),E.push(o)}this.tree=new e.Node(E)},e.prototype.fromNonIndexedBufferGeometry=function(t){var r,n,i,a,o,s,l=t.attributes.position.array,c=t.attributes.normal.array,u=t.attributes.uv.array,h=[];for(r=0,n=l.length;r<n;r+=9)a=new e.Polygon,o=c?new THREE.Vector3(c[r],c[r+1],c[r+2]):null,s=u?new THREE.Vector2(u[r],u[r+1]):null,(i=new e.Vertex(l[r],l[r+1],l[r+2],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=c?new THREE.Vector3(c[r+3],c[r+4],c[r+5]):null,s=u?new THREE.Vector2(u[r+2],u[r+3]):null,(i=new e.Vertex(l[r+3],l[r+4],l[r+5],o,s)).applyMatrix4(this.matrix),a.vertices.push(i),o=c?new THREE.Vector3(c[r+6],c[r+7],c[r+8]):null,s=u?new THREE.Vector2(u[r+4],u[r+5]):null,(i=new e.Vertex(l[r+6],l[r+7],l[r+8])).applyMatrix4(this.matrix),a.vertices.push(i),a.calculateProperties(),h.push(a);this.tree=new e.Node(h)},e.prototype.fromBufferGeometry=function(e){null===e.index?this.fromNonIndexedBufferGeometry(e):this.fromIndexedBufferGeometry(e)},e.prototype.fromMesh=function(e){var t=e.geometry;e.updateMatrix(),this.matrix=e.matrix.clone(),this.create(t)},e.prototype.toGeometry=function(){var e,t,r,n,i,a,o,s,l,c,u=(new THREE.Matrix4).getInverse(this.matrix),h=new THREE.Geometry,d=this.tree.allPolygons(),p=d.length,f={};for(e=0;e<p;e++)for(n=(r=d[e]).vertices.length,t=2;t<n;t++)c=[],s=r.vertices[0],c.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(u),void 0!==f[s.x+","+s.y+","+s.z]?i=f[s.x+","+s.y+","+s.z]:(h.vertices.push(s),i=f[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=r.vertices[t-1],c.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(u),void 0!==f[s.x+","+s.y+","+s.z]?a=f[s.x+","+s.y+","+s.z]:(h.vertices.push(s),a=f[s.x+","+s.y+","+s.z]=h.vertices.length-1),s=r.vertices[t],c.push(new THREE.Vector2(s.uv.x,s.uv.y)),(s=new THREE.Vector3(s.x,s.y,s.z)).applyMatrix4(u),void 0!==f[s.x+","+s.y+","+s.z]?o=f[s.x+","+s.y+","+s.z]:(h.vertices.push(s),o=f[s.x+","+s.y+","+s.z]=h.vertices.length-1),l=new THREE.Face3(i,a,o,new THREE.Vector3(r.normal.x,r.normal.y,r.normal.z)),h.faces.push(l),h.faceVertexUvs[0].push(c);return h},e.prototype.toBufferGeometry=function(){var e,t,r,n,i,a,o,s,l=(new THREE.Matrix4).getInverse(this.matrix),c=new THREE.BufferGeometry,u=[],h=[],d=[],p=[],f=this.tree.allPolygons(),m=f.length,v={},g=0;for(e=0;e<m;e++)for(n=(r=f[e]).vertices.length,t=2;t<n;t++)[],(s=r.vertices[0]).clone().applyMatrix4(l),p.push(s.uv.x,s.uv.y),void 0!==v[s.x+","+s.y+","+s.z]?i=v[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),i=g,d.push(r.normal.x,r.normal.y,r.normal.z),g++),(s=r.vertices[t-1]).clone().applyMatrix4(l),p.push(s.uv.x,s.uv.y),void 0!==v[s.x+","+s.y+","+s.z]?a=v[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),a=g,d.push(r.normal.x,r.normal.y,r.normal.z),g++),(s=r.vertices[t]).clone().applyMatrix4(l),p.push(s.uv.x,s.uv.y),void 0!==v[s.x+","+s.y+","+s.z]?o=v[s.x+","+s.y+","+s.z]:(h.push(s.x,s.y,s.z),o=g,d.push(r.normal.x,r.normal.y,r.normal.z),g++),u.push(i,a,o);return c.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(p),2)),c.addAttribute("position",new THREE.BufferAttribute(new Float32Array(h),3)),c.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(d),3)),c.setIndex(new THREE.BufferAttribute(new Uint32Array(u),1)),c},e.prototype.toMesh=function(e){var t=this.toGeometry(),r=new THREE.Mesh(t,e);return r.position.setFromMatrixPosition(this.matrix),r.rotation.setFromRotationMatrix(this.matrix),r},(e.Polygon=function(e,t,r){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=void 0}).prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],r=this.vertices[2];return this.normal=t.clone().subtract(e).cross(r.clone().subtract(e)).normalize(),this.w=this.normal.clone().dot(e),this},e.Polygon.prototype.clone=function(){var t,r,n=new e.Polygon;for(t=0,r=this.vertices.length;t<r;t++)n.vertices.push(this.vertices[t].clone());return n.calculateProperties(),n},e.Polygon.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this},e.Polygon.prototype.classifyVertex=function(e){var t=this.normal.dot(e)-this.w;return t<-1e-5?2:t>1e-5?1:0},e.Polygon.prototype.classifySide=function(e){var t,r,n,i=0,a=0,o=e.vertices.length;for(t=0;t<o;t++)r=e.vertices[t],1===(n=this.classifyVertex(r))?i++:2===n&&a++;return i>0&&0===a?1:0===i&&a>0?2:0===i&&0===a?0:3},e.Polygon.prototype.splitPolygon=function(t,r,n,i,a){var o=this.classifySide(t);if(0===o)(this.normal.dot(t.normal)>0?r:n).push(t);else if(1===o)i.push(t);else if(2===o)a.push(t);else{var s,l,c,u,h,d,p,f,m,v=[],g=[];for(l=0,s=t.vertices.length;l<s;l++)c=(l+1)%s,d=t.vertices[l],p=t.vertices[c],u=this.classifyVertex(d),h=this.classifyVertex(p),2!=u&&v.push(d),1!=u&&g.push(d),3==(u|h)&&(f=(this.w-this.normal.dot(d))/this.normal.dot(p.clone().subtract(d)),m=d.interpolate(p,f),v.push(m),g.push(m));v.length>=3&&i.push(new e.Polygon(v).calculateProperties()),g.length>=3&&a.push(new e.Polygon(g).calculateProperties())}},(e.Vertex=function(e,t,r,n,i){this.x=e,this.y=t,this.z=r,this.normal=n||new THREE.Vector3,this.uv=i||new THREE.Vector2}).prototype.clone=function(){return new e.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())},e.Vertex.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},e.Vertex.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.Vertex.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.Vertex.prototype.cross=function(e){var t=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-r*e.x,this},e.Vertex.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},e.Vertex.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.Vertex.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this},e.Vertex.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},e.Vertex.prototype.applyMatrix4=function(e){var t=this.x,r=this.y,n=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*n+i[12],this.y=i[1]*t+i[5]*r+i[9]*n+i[13],this.z=i[2]*t+i[6]*r+i[10]*n+i[14],this},(e.Node=function(t){var r,n,i=[],a=[];if(this.polygons=[],this.front=this.back=void 0,t instanceof Array&&0!==t.length){for(this.divider=t[0].clone(),r=0,n=t.length;r<n;r++)this.divider.splitPolygon(t[r],this.polygons,this.polygons,i,a);i.length>0&&(this.front=new e.Node(i)),a.length>0&&(this.back=new e.Node(a))}}).isConvex=function(e){var t,r;for(t=0;t<e.length;t++)for(r=0;r<e.length;r++)if(t!==r&&2!==e[t].classifySide(e[r]))return!1;return!0},e.Node.prototype.build=function(t){var r,n,i=[],a=[];for(this.divider||(this.divider=t[0].clone()),r=0,n=t.length;r<n;r++)this.divider.splitPolygon(t[r],this.polygons,this.polygons,i,a);i.length>0&&(this.front||(this.front=new e.Node),this.front.build(i)),a.length>0&&(this.back||(this.back=new e.Node),this.back.build(a))},e.Node.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.Node.prototype.clone=function(){var t=new e.Node;return t.divider=this.divider.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t},e.Node.prototype.invert=function(){var e,t,r;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),r=this.front,this.front=this.back,this.back=r,this},e.Node.prototype.clipPolygons=function(e){var t,r,n,i;if(!this.divider)return e.slice();for(n=[],i=[],t=0,r=e.length;t<r;t++)this.divider.splitPolygon(e[t],n,i,n,i);return this.front&&(n=this.front.clipPolygons(n)),i=this.back?this.back.clipPolygons(i):[],n.concat(i)},e.Node.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e}()},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!u){var e=s(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new f(e,t)),1!==c.length||u||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"Octree",function(){return L}),r.d(n,"World",function(){return I}),r.d(n,"HeroAnimator",function(){return O}),r.d(n,"HeroController",function(){return N}),r.d(n,"KeyInputControl",function(){return ne}),r.d(n,"TPSCameraControl",function(){return ce});var i=r(1);window.THREE=i,r(14),r(15),r(16),r(17),r(18),r(19),r(20),r(21),r(22),r(23),r(24),r(25),r(26),r(27),r(28),r(29),r(30),r(31),r(32),r(33),r(34),r(35),r(36),r(37),r(38),r(39),r(44),r(45),r(46),r(47),r(48),r(49),r(50),r(51),r(52),r(53),r(54),r(55),r(56),r(57),r(58),r(59),r(60),r(61),r(62),r(63),r(64),r(65),r(66),r(67),r(68),r(69),r(70),r(71),r(72),r(73),r(74),r(75),r(76),r(77),r(78),r(79),r(80),r(81),r(82),r(83),r(84),r(85),r(86),r(87),r(88),r(89),r(90),r(91);var a,o,s,l,c,u,h,d={tabIndices:{viewWorks:"1",gameWorks:"1",natureWorks:"1",sketcher:"4"},zIndices:{viewWorks:"0",natureWorks:"0",sketcher:"2",colorSelector:"3",matcaps:"4"},renderer:null,scene:null,camera:null,appWorks:null,shaders:null,sunLight:null,TEXTURE_MAPS:["map","matcap","alphaMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","specularMap","envMap","lightMap","aoMap","emissiveMap","gradientMap"],WORLD_SIZE:1e3,GRID_SPACING:5,GROUND_HEIGHT:0,WATER_HEIGHT:0,WATER_COLOR:7695,OCEAN_COLOR:27028,FOG_COLOR:14014425,SUN_COLOR:16777215},p=r(5);d.clock=new THREE.Clock,d.getDeltaTime=function(){return d.clock.getDelta()},d.getCurrentTime=function(){return d.clock.getElapsedTime()},d.humanFileSize=function(e,t,r,n,i){return(t=Math,r=t.log,1e3,i=r(e)/r(1e3)|0,e/t.pow(1e3,i)).toFixed(2)+" "+(i?"KMGTPEZY"[--i]+"B":"Bytes")},d.isDeviceMobile=function(){var e=!1;return/Mobi|Android|webOS|Tablet|iPad|iPhone|iPod|Windows Phone|BlackBerry|BB10|Opera Mini/i.test(navigator.userAgent)&&(e=!0),e},d.isDeviceLandscape=function(){return 90===window.orientation||-90===window.orientation},d.isDeviceTouch=function(){return"ontouchend"in window},d.isDeviceWindowsOS=function(){return navigator.platform.toUpperCase().indexOf("WIN32")>=0},d.isDeviceMacOS=function(){return navigator.platform.toUpperCase().indexOf("MAC")>=0},d.isDeviceiOS=function(){return/iPad|iPhone|iPod/g.test(navigator.userAgent)&&!window.MSStream},d.isWebGL1Available=function(){var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))},d.isWebGL2Available=function(){var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))},d.isWebGL1=function(){var e=d.appWorks.renderer.context;return void 0!==e&&e instanceof window.WebGLRenderingContext},d.isWebGL2=function(){var e=d.appWorks.renderer.context;return void 0!==e&&e instanceof window.WebGL2RenderingContext},d.getWebGLInfo=function(){var e=[],t="WebGL1: "+(d.isWebGL1Available()?"available":"unavailable");e.push(t);var r="WebGL2: "+(d.isWebGL2Available()?"available":"unavailable");e.push(r);var n=d.appWorks.renderer.context.getSupportedExtensions();return e=e.concat(n)},d.isWebGLExtensionAvailable=function(e){return d.appWorks.renderer.context.getSupportedExtensions().indexOf(e)>=0},Number.prototype.format=function(){return this.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},String.prototype.trunc=function(e,t){if(this.length<=e)return(" "+this).slice(1);var r=this.substr(0,e);return(t?r.substr(0,r.lastIndexOf(" ")+1):r)+"..."},Array.prototype.clone=function(){return this.map(e=>Array.isArray(e)?e.clone():e)},Array.prototype.sum=function(){return this.reduce(function(e,t){return e+Number(t)},0)},Array.prototype.average=function(){return this.sum()/(this.length||1)},Array.prototype.zero=function(e){for(var t=0;t<e;t++)this[t]=0;return this},Array.prototype.scale=function(e){return this.map((t,r)=>e*t)},Array.prototype.add=function(e){return this.map((t,r)=>t+e[r])},Array.prototype.sub=function(e){return this.map((t,r)=>t-e[r])},Array.prototype.mul=function(e){return this.map((t,r)=>t*e[r])},Array.prototype.div=function(e){return this.map((t,r)=>t/e[r])},Array.prototype.dot=function(e){return this.map((t,r)=>t*e[r]).reduce((e,t)=>e+t)},Array.prototype.norm2=function(){return Math.sqrt(this.map((e,t)=>e*e).reduce((e,t)=>e+t))},Array.prototype.transpose=function(){var e=this;return e[0].map(function(t,r){return e.map(function(e,t){return e[r]})})},Array.prototype.mmultiply=function(e){return this.map(function(t,r){return e.transpose().map(function(e,r){return t.dot(e)})})},Array.prototype.sortNumbers=function(e){return"ascending"===(e=e||"ascending")?this.sort((e,t)=>e-t):"descending"===e&&this.sort((e,t)=>t-e),this},Array.prototype.minX=function(){return this.reduce((e,t)=>t.x<e?t.x:e,this[0].x)},Array.prototype.maxX=function(){return this.reduce((e,t)=>t.x>e?t.x:e,this[0].x)},Array.prototype.minY=function(){return this.reduce((e,t)=>t.y<e?t.y:e,this[0].y)},Array.prototype.maxY=function(){return this.reduce((e,t)=>t.y>e?t.y:e,this[0].y)},Array.prototype.minZ=function(){return this.reduce((e,t)=>t.z<e?t.z:e,this[0].z)},Array.prototype.maxZ=function(){return this.reduce((e,t)=>t.z>e?t.z:e,this[0].z)},Array.prototype.min=function(){return this.reduce((e,t)=>t<e?t:e,this[0])},Array.prototype.max=function(){return this.reduce((e,t)=>t>e?t:e,this[0])},d.fillArray=function(e,t){for(var r=[],n=t;n--;)r[n]=e;return r},d.flattenArray=function(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?d.flattenArray(t):t)},[])},d.flattenVector2s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y)}return t},d.flattenVector3s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z)}return t},d.flattenVector4s=function(e,t){void 0===t&&(t=[]);for(var r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z,i.w)}return t},d.fromTypedArray=function(e){return[].slice.call(e)},d.mergeArray3=function(e,t){for(var r,n={},i=[],a={},o=(t=Math.pow(10,t||4),0),s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],a.z=e[o][2],void 0===n[r=Math.round(a.x*t)+"_"+Math.round(a.y*t)+"_"+Math.round(a.z*t)]&&(n[r]=o,i.push([e[o][0],e[o][1],e[o][2]]));return i.slice(0)},d.mergeArray2=function(e,t){for(var r,n={},i=[],a={},o=(t=Math.pow(10,t||4),0),s=e.length;o<s;o++)a.x=e[o][0],a.y=e[o][1],void 0===n[r=Math.round(a.x*t)+"_"+Math.round(a.y*t)]&&(n[r]=o,i.push([e[o][0],e[o][1]]));return i.slice(0)},d.mergeArray=function(e,t){for(var r,n={},i=[],a={},o=(t=Math.pow(10,t||4),0),s=e.length;o<s;o++)a.x=e[o],void 0===n[r=Math.round(a.x*t)]&&(n[r]=o,i.push(e[o]));return i.slice(0)},d.mergeVertices=function(e,t){for(var r,n,i={},a=(t=Math.pow(10,t||4),0),o=e.length;a<o;a++)r=e[a],void 0===i[n=Math.round(r.x*t)+"_"+Math.round(r.y*t)+"_"+Math.round(r.z*t)]&&(i[n]=a,this.push(e[a]));return e.length-this.length},d.toHexValue=function(e,t){return t?"0x"+d.toHexValue(e).toString(16):new THREE.Color(e).getHex()},d.toHexStyle=function(e){return"#"+new THREE.Color(e).getHexString()},d.clamp=function(e,t,r){return Math.max(t,Math.min(r,e))},d.mix=function(e,t,r){return e*(1-r)+t*r},d.lerp=function(e,t,r){return e*(1-r)+t*r},d.smoothstep=function(e,t,r){return r<=e?0:r>=t?1:(r=(r-e)/(t-e))*r*(3-2*r)},d.randInt=function(e,t){return e+Math.floor(Math.random()*(t-e+1))},d.randFloat=function(e,t){return e+Math.random()*(t-e)},d.randFloatSpread=function(e,t){return e+t*(Math.random()-.5)},d.linearRand=function(e,t){return d.randFloat(e,t)},d.gaussRand=function(e,t){var r,n,i;do{r=(n=d.randFloat(-1,1))*n+(i=d.randFloat(-1,1))*i}while(r>1);return i*t*t*Math.sqrt(-2*Math.log(r)/r)+e},d.diskRand=(a=new THREE.Vector2,function(e){var t;do{a.x=d.randFloat(-e,e),a.y=d.randFloat(-e,e),t=a.length()}while(t>e);return a}),d.ballRand=function(){var e=new THREE.Vector3;return function(t){var r;do{e.x=d.randFloat(-t,t),e.y=d.randFloat(-t,t),e.z=d.randFloat(-t,t),r=e.length()}while(r>t);return e}}(),d.circularRand=function(){var e=new THREE.Vector2;return function(t){var r=d.randFloat(0,6.283185307179586);return e.x=t*Math.cos(r),e.y=t*Math.sin(r),e}}(),d.sphericalRand=function(){var e=new THREE.Vector3;return function(t){var r=d.randFloat(-1,1),n=d.randFloat(0,6.283185307179586),i=Math.sqrt(1-r*r),a=i*Math.cos(n),o=i*Math.sin(n);return e.x=a*t,e.y=o*t,e.z=r*t,e}}(),d.createMathRandom=function(e){return(e=>()=>((e=Math.imul(741103597,e))>>>0)/2**32)(function(e){for(var t=0,r=1779033703^e.length;t<e.length;t++)r=(r=Math.imul(r^e.charCodeAt(t),3432918353))<<13|r>>>19;return function(){return r=Math.imul(r^r>>>16,2246822507),r=Math.imul(r^r>>>13,3266489909),(r^=r>>>16)>>>0}}(e.toString())())},d.createRandFloat=function(e){var t=void 0!==e?d.createMathRandom(e):Math.random;return function(e,r){return e+t()*(r-e)}},d.createFbmNoise=function(e){var t=void 0!==(e=e||{}).octaves?e.octaves:4,r=void 0!==e.persistence?e.persistence:.5;switch(void 0!==e.noiseType?e.noiseType:"simplex3d"){case"perlin3d":var n=(new THREE.ImprovedNoise).noise;break;default:var i=new THREE.SimplexNoise;n=i.noise3d.bind(i)}for(var a=new Array(t),o=new Array(t),s=0,l=0;l<t;l++)a[l]=Math.pow(r,l),o[l]=Math.pow(2,l),s+=a[l];return s=1/s,function(e,r,i){for(var o=0,l=0;l<t;l++){var c=1<<l;o+=a[l]*n(e*c,r*c,i*c)}return o*s}},d.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},d.createImageDropZone=function(e,t){return null==e&&((e=document.createElement("img")).style.width="50px",e.style.height="50px",e.style.border="1px solid white"),e.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},!1),e.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation();var r=new FileReader;r.addEventListener("load",function(e){var r=new Image;r.onload=function(){t(r)},r.src=e.currentTarget.result},!1),r.readAsDataURL(e.dataTransfer.files[0])},!1),e},d.setDraggable=function(e){var t=0,r=0,n=0,i=0,a=e.children[0];function o(e){(e=e||window.event).preventDefault(),n=e.clientX,i=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(a){(a=a||window.event).preventDefault(),t=n-a.clientX,r=i-a.clientY,n=a.clientX,i=a.clientY,e.style.top=e.offsetTop-r+"px",e.style.left=e.offsetLeft-t+"px"}function l(){document.onmouseup=null,document.onmousemove=null}a?a.onmousedown=o:e.onmousedown=o},d.createProgressbar=function(){if(!(e=document.getElementById("progress-box"))){var e;(e=document.createElement("div")).id="progress-box",e.innerHTML='\n        <div>\n            <div>...loading...</div>\n            <div class="progress">\n                <div id="progressbar"></div>\n            </div>\n        </div>\n    ',document.body.appendChild(e);var t=document.createElement("style");t.id="progress-style",t.innerHTML="\n        #progress-box {\n            position: absolute;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n            font-size: xx-large;\n            font-family: sans-serif;\n        }\n        #progress-box>div>div {\n            padding: 2px;\n        }\n        .progress {\n            width: 50vw;\n            border: 1px solid black;\n        }\n        #progressbar {\n            width: 0;\n            transition: width ease-out .5s;\n            height: 1em;\n            background-color: #888;\n            background-image: linear-gradient(\n                -45deg, \n                rgba(255, 255, 255, .5) 25%, \n                transparent 25%, \n                transparent 50%, \n                rgba(255, 255, 255, .5) 50%, \n                rgba(255, 255, 255, .5) 75%, \n                transparent 75%, \n                transparent\n            );\n            background-size: 50px 50px;\n            animation: progressanim 2s linear infinite;\n        }\n    ",document.head.appendChild(t)}},d.getProgressbar=function(){return document.getElementById("progressbar")},d.updateProgressbar=function(e,t,r){void 0===r&&(r=d.getProgressbar()),r.style.width=`${e/t*100|0}%`},d.hideProgressbar=function(){document.getElementById("progress-box").style.display="none"},d.showProgressbar=function(){document.getElementById("progress-box").style.display="block"},d.errorProgressbar=function(e){console.warn(e)},d.removeProgressbar=function(){var e=document.getElementById("progress-box");void 0!==e&&document.body.removeChild(e);var t=document.getElementById("progress-style");void 0!==t&&document.head.removeChild(t)},d.getMouseScreenCoords=(o=new THREE.Vector2,function(e){return e.changedTouches?(o.x=e.changedTouches[0].clientX,o.y=e.changedTouches[0].clientY):(o.x=e.clientX,o.y=e.clientY),o}),d.toggleLightHelpers=function(e){d.appWorks.sceneHelpers.children.forEach(function(t){(t instanceof THREE.PointLightHelper||t instanceof THREE.SpotLightHelper||t instanceof THREE.DirectionalLightHelper||t instanceof THREE.HemisphereLightHelper)&&(t.visible=void 0!==e?e:!t.visible)})},THREE.Object3D.prototype.getObjectsByProperty=function(e,t,r,n){void 0===n&&(n=[]);var i=this[e];void 0!==i&&i[t]===r&&n.push(this);for(var a=0,o=this.children.length;a<o;a++){this.children[a].getObjectsByProperty(e,t,r,n)}return n},THREE.Object3D.prototype.getObjectsByType=function(e,t){void 0===t&&(t=[]),this.type===e&&t.push(this);for(var r=0,n=this.children.length;r<n;r++){this.children[r].getObjectsByType(e,t)}return t},d.getObjectName=function(e,t){t=void 0!==t?t:"";if(Array.isArray(e)){for(var r=[],n=0;n<e.length;n++)r.push(""===e[n].name?t:e[n].name);return r.join(", ").trunc(20)}return(""===e.name?t:e.name).trunc(20)},d.getObjectSize=(s=new THREE.Vector3,function(e){return d.computeBoundingBox(e).getSize(s),Math.max(s.x,s.y,s.z)}),d.resizeObject=function(e,t){if(t){var r=d.getObjectSize(e);e.scale.setScalar(t/r)}},d.transformObject=function(e,t,r,n){t&&e.position.set(t.x,t.y,t.z),r&&e.rotation.set(r.x,r.y,r.z),n&&e.scale.set(n.x,n.y,n.z),e.updateMatrix()},d.copyTransform=function(e,t){var r=t.position,n=t.rotation,i=t.scale;d.transformObject(e,r,n,i)},d.cloneObject=function(e){return void 0!==e.userData.type?new d[e.userData.type](e):e.clone()},d.underWaterBackground=function(){void 0!==d.appWorks.underWaterPass&&(d.appWorks.underWaterPass.enabled=!0),d.appWorks.createSceneBackground("underWater"),d.scene.fog||d.appWorks.createSceneFog({type:"exp2",color:594516,density:.004}),d.renderer.toneMappingExposure=.7},d.filmGrainBackground=function(){var e=d.appWorks.width,t=d.appWorks.height,r={aspect:d.camera.aspect,aspectCorrection:!0,grainScale:1.5/Math.min(e,t),color1:16777215,color2:3487029,noiseAlpha:.75};(new THREE.TextureLoader).load("images/wallpaper/spot-gradient.jpg",function(e){d.imageProcessing(e,"FilmGrainShader",r,function(e){d.scene.background=e})})},d.redColors=(l=[16752762,16416882,15308410,15761536,13458524,14423100,11674146,16711680,9109504,8388608,16737095,16729344,14381203],function(e){return l[e%l.length]}),d.greenColors=(c=[8190976,8388352,3329330,65280,2263842,32768,25600,11403055,10145074,65407,64154,9498256,10025880,9419919,3978097,2142890,3050327,526336,5597999,7048739],function(e){return c[e%c.length]}),d.blueColors=(u=[15792383,15132410,11591910,11393254,8900346,8900331,49151,11584734,2003199,6591981,4620980,6266528,8087790,6970061,4734347,4286945,255,205,139,128,1644912,9055202,4915330],function(e){return u[e%u.length]}),d.randomColors=function(e){var t,r,n,i=void 0!==(e=e||{}).numInstances?Math.floor(e.numInstances):1,a=void 0!==e.colorMode?e.colorMode:"none",o=new THREE.Color,s=[];if("0"===a)for(var l=0;l<i;l++)t=Math.random(),r=1,n=.5,o.setHSL(t,r,n),s.push(o.r,o.g,o.b);else if("1"===a)for(l=0;l<i;l++)t=Math.random(),r=.75,n=.25*Math.random()+.5,o.setHSL(t,r,n),s.push(o.r,o.g,o.b);else if("2"===a)for(l=0;l<i;l++)t=.25*Math.random()+.5,r=.25,n=.25*Math.random()+.5,o.setHSL(t,r,n),s.push(o.r,o.g,o.b);else if("reds"===a)for(l=0;l<i;l++)o.setHex(d.redColors(l)),s.push(o.r,o.g,o.b);else if("greens"===a)for(l=0;l<i;l++)o.setHex(d.greenColors(l)),s.push(o.r,o.g,o.b);else if("blues"===a)for(l=0;l<i;l++)o.setHex(d.blueColors(l)),s.push(o.r,o.g,o.b);return s},d.cameraAutoView=function(e){if((e=e||{}).isWorking)return"stop"!==h;if("circle"===(h=e.viewMode||"circle")){var t=e.radius||20,r=new THREE.CircleBufferGeometry(t,32),n=new THREE.Mesh(r);n.name="cameraPath",n.visible=!1,d.add(n),n.add(d.camera),n.update=function(){this.rotation.y+=.003}}else if("stop"===h){var i=d.camera.parent;i&&"cameraPath"===i.name&&(i.remove(d.camera),d.camera.parent=null)}},d.fitCameraToObject=function(e){if(e){var t=new THREE.Vector3,r=new THREE.Vector3,n=d.computeBoundingBox(e);n.getCenter(t),n.getSize(r);var i=e.position.clone();i.sub(t),t.set(0,0,0);var a=d.camera,o=a.fov*THREE.Math.DEG2RAD,s=Math.max(r.x,r.y,r.z),l=Math.abs(s/2/Math.tan(o/2));l*=1.25;var c=d.appWorks.controls;c instanceof THREE.OrbitControls?(c.reset(),c.maxDistance=100*l,c.saveState()):c instanceof THREE.TrackballControls&&(c.reset(),c.maxDistance=100*l);var u=a.position.clone();u.normalize().multiplyScalar(l),a.lookAt(t);var h=l/100,p=100*l;if(d.appWorks.history){var f=[];f.push(new d.SetPositionCommand(e,i)),f.push(new d.SetPositionCommand(a,u)),f.push(new d.SetValueCommand(a,"near",h)),f.push(new d.SetValueCommand(a,"far",p)),d.appWorks.multiCmds(f)}else e.position.copy(i),a.position.copy(u),a.near=h,a.far=p;a.updateProjectionMatrix()}},d.welcomeObject=function(e){if(e.traverse(function(e){e.isMesh&&(e.frustumCulled=!1,e.castShadow=!0,e.receiveShadow=!0)}),"natureWorks"===d.appWorks.appName)d.fitCameraToObject(e);else if("viewWorks"===d.appWorks.appName&&(d.resizeObject(e,1),d.fitCameraToObject(e),d.appWorks.selectObject=e,void 0===d.appWorks.showroom)){var t=d.createShowroom(e);d.appWorks.showroom=t,d.scene.add(t)}},d.nextShowroom=function(e,t){if("background"===t){(n=e.getObjectByName("raymarch"))&&e.remove(n),i=((i=e.activeBackground)+1)%e.backgrounds.length,e.activeBackground=i;var r=e.backgrounds[i];r.isMesh?(d.scene.background=null,e.add(r)):d.scene.background=r}if("floor"===t){var n,i;(n=e.getObjectByName("floor"))&&e.remove(n),i=((i=e.activeFloor)+1)%e.floors.length,e.activeFloor=i;var a=e.floors[i];e.add(a)}},d.createShowroom=function(e){var t=new THREE.Object3D;t.name="showroom",t.activeBackground=-1,t.backgrounds=[];var r=["arctic","burlesque","denim","mercury","neo","origin","rouge","slate"];r.forEach(e=>{var r=(new THREE.TextureLoader).load("images/wallpaper/"+e+".jpg");t.backgrounds.push(d.createBackground(r))}),(r=["blueSky","cloud","galaxy","lake","bridge","park"]).forEach(e=>{t.backgrounds.push(d.createBackground(e))}),(r=["cloudsFS","cellsFS","fogFS","sunsetFS"]).forEach(e=>{var r=d.createBackground(e);r.name="raymarch",t.backgrounds.push(r)}),t.backgrounds.push(d.createBackground(12632256)),t.activeFloor=-1,t.floors=[];var n=new THREE.TextureLoader,i=d.computeBoundingBox(e),a=i.min.y,o=i.getSize(new THREE.Vector3),s=4*(o=Math.max(o.x,o.y,o.z));function l(e,t){t=t||8;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}(p=d.createAcrylicCircle(s)).rotation.x=-Math.PI/2,p.position.y=a,p.name="floor",t.floors.push(p);var c=[];c.push({map:n.load("images/rock/crackRockDiffuse.jpg",l),normalMap:n.load("images/rock/crackRockNormal.jpg",l),aoMap:n.load("images/rock/crackRockAO.jpg",l)}),c.push({color:11184810,roughness:1,metalness:0,map:n.load("images/pbr/wallA.png",l),normalMap:n.load("images/pbr/wallN.png",l),aoMap:n.load("images/pbr/wallAO.png",l),roughnessMap:n.load("images/pbr/wallR.png",l)}),c.push({roughness:1,metalness:0,map:n.load("images/pbr/bathroomtileA.png",l),normalMap:n.load("images/pbr/bathroomtileN.png",l),aoMap:n.load("images/pbr/bathroomtileAO.png",l),roughnessMap:n.load("images/pbr/bathroomtileR.png",l)}),c.push({roughness:1,metalness:0,map:n.load("images/pbr/charcoalA.png",l),normalMap:n.load("images/pbr/charcoalN.png",l),roughnessMap:n.load("images/pbr/charcoalR.png",l)}),c.push({color:11184810,roughness:1,metalness:0,map:n.load("images/pbr/grassA.png",l),normalMap:n.load("images/pbr/grassN.png",l),aoMap:n.load("images/pbr/grassAO.png",l),roughnessMap:n.load("images/pbr/grassR.png",l)}),c.push({color:8947848,roughness:.5,metalness:.5,map:n.load("images/pbr/rustIronA.png",e=>l(e,2)),normalMap:n.load("images/pbr/rustIronN.png",e=>l(e,2)),aoMap:n.load("images/pbr/rustIronAO.png",e=>l(e,2)),roughnessMap:n.load("images/pbr/rustIronR.png",e=>l(e,2)),metalnessMap:n.load("images/pbr/rustIronM.png",e=>l(e,2))});for(var u=new THREE.CircleBufferGeometry(s,64),h=0;h<c.length;h++){var p,f=new THREE.MeshStandardMaterial(c[h]);(p=new THREE.Mesh(u,f)).receiveShadow=!0,p.rotation.x=-Math.PI/2,p.position.y=a,p.name="floor",t.floors.push(p)}d.nextShowroom(t,"background"),d.nextShowroom(t,"floor"),d.scene.add(d.createHemisphereLight());var m=d.createDirectionalLight({shadowCameraSize:.5*s,shadowMapSize:new THREE.Vector2(2048,2048)});return m.position.set(0,.75*s,.5*s),d.scene.add(m),t},d.manhatten2D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},d.manhatten3D=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2)},d.createKdTree=function(e,t,r){if(!isTypedArray(e)){var n=e[0];isArray(n)?e=d.flattenArray(e):n instanceof THREE.Vector2?e=d.flattenVector2s(e):n instanceof THREE.Vector3?e=d.flattenVector3s(e):n instanceof THREE.Vector4&&(e=d.flattenVector4s(e)),e=new Float32Array(e)}r=r||2===t?d.manhatten2D:d.manhatten3D;return new THREE.TypedArrayUtils.Kdtree(e,r,t)},d.getKdTreeNearest=function(e,t,r,n){for(var i=e.nearest(t,r,n),a=[],o=0,s=i.length;o<s;o++){var l=i[o],c={};c.position=l[0].obj,c.index=l[0].pos,c.distance=l[1],a.push(c)}return a},d.OctreeHelper=function(e,t){if(!e instanceof p.PointOctree)return null;var r=(t=t||{}).leaves||!1,n=t.color||16777215,i=[],a=[];if(r){a=d.getLeafOctants(e,!0)}else{var o=t.topLevel||0,s=t.bottomLevel||e.getDepth();a=d.getOctantsByLevels(e,o,s)}a.forEach(function(e){var t=new THREE.Box3(e.min,e.max),r=new THREE.Box3Helper(t);r.updateMatrixWorld(!0),r.geometry.applyMatrix(r.matrixWorld),i.push(r.geometry)});var l=THREE.BufferGeometryUtils.mergeBufferGeometries(i),c=new THREE.LineBasicMaterial({color:n});THREE.LineSegments.call(this,l,c),this.name="octreeHelper",i.forEach(function(e){e.dispose()})},d.OctreeHelper.prototype=Object.create(THREE.LineSegments.prototype),d.OctreeHelper.prototype.constructor=d.OctreeHelper,d.getOctantsByLevels=function(e,t,r){for(var n=[];t<=r;){var i=e.findOctantsByLevel(t)[Symbol.iterator]();if(i)for(var a=i.next();!a.done;)n.push(a.value),a=i.next();t++}return n},d.getLeafOctants=function(e,t){var r=[],n=e.leaves(),i=n.next();if(t=t||!0)for(;!i.done;)i.value.points&&r.push(i.value),i=n.next();else for(;!i.done;)r.push(i.value),i=n.next();return r},CanvasRenderingContext2D.prototype.clear=function(e){e&&(this.beginPath(),this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),e&&this.restore()},CanvasRenderingContext2D.prototype.circle=function(e,t,r){return this.beginPath(),this.moveTo(e+r,t),this.arc(e,t,r,0,2*Math.PI),this},CanvasRenderingContext2D.prototype.fillCircle=function(e,t,r,n){return n&&(this.fillStyle=n),this.circle(e,t,r).fill(),this},CanvasRenderingContext2D.prototype.strokeCircle=function(e,t,r,n){return n&&(this.strokeStyle=n),this.circle(e,t,r).stroke(),this},CanvasRenderingContext2D.prototype.roundRect=function(e,t,r,n,i){var a={tl:0,tr:0,bl:0,br:0};if("object"==typeof i)for(var o in i)a[o]=i[o];if("number"==typeof i)for(var o in a)a[o]=i;return this.beginPath(),this.moveTo(e+a.tl,t),this.lineTo(e+r-a.tr,t),this.quadraticCurveTo(e+r,t,e+r,t+a.tr),this.lineTo(e+r,t+n-a.br),this.quadraticCurveTo(e+r,t+n,e+r-a.br,t+n),this.lineTo(e+a.bl,t+n),this.quadraticCurveTo(e,t+n,e,t+n-a.bl),this.lineTo(e,t+a.tl),this.quadraticCurveTo(e,t,e+a.tl,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillRoundRect=function(e,t,r,n,i,a){return a&&(this.fillStyle=a),this.roundRect(e,t,r,n,i).fill(),this},CanvasRenderingContext2D.prototype.strokeRoundRect=function(e,t,r,n,i,a){return a&&(this.strokeStyle=a),this.roundRect(e,t,r,n,i).stroke(),this},CanvasRenderingContext2D.prototype.polygon=function(e,t){t>0&&(e=function(e,t){function r(e,t,r,n,i,a){var o=Math.sqrt(Math.pow(r-e,2)+Math.pow(n-t,2)),s=a?i/o:(o-i)/o;return[e+s*(r-e),t+s*(n-t)]}var n,i,a,o,s,l,c,u,h=e.length,d=new Array(h);for(i=0;i<h;i++)(n=i-1)<0&&(n=h-1),(a=i+1)==h&&(a=0),o=e[n],s=e[i],l=e[a],c=r(o[0],o[1],s[0],s[1],t,!1),u=r(s[0],s[1],l[0],l[1],t,!0),d[i]=[c[0],c[1],s[0],s[1],u[0],u[1]];return d}(e,t)),this.beginPath();for(var r=0,n=e.length;r<n;r++){var i=e[r];0==r?this.moveTo(i[0],i[1]):this.lineTo(i[0],i[1]),t>0&&this.quadraticCurveTo(i[2],i[3],i[4],i[5])}return this.closePath(),this},CanvasRenderingContext2D.prototype.fillPolygon=function(e,t,r){return r&&(this.fillStyle=r),this.polygon(e,t).fill(),this},CanvasRenderingContext2D.prototype.strokePolygon=function(e,t,r){return r&&(this.strokeStyle=r),this.polygon(e,t).stroke(),this},CanvasRenderingContext2D.prototype.speechBubble=function(e,t,r,n,i,a,o,s){e=e||0,r=r||1,n=n||1,i=i||.2*n,a=a||e+r/2,s=s||i;var l,c,u,h=e+r,d=(t=t||0)+n;return(o=o||t+n+i)<t||o>t+n?(l=Math.min(Math.max(e+i,a-s/2),h-i-s),c=Math.min(Math.max(e+i+s,a+s/2),h-i)):(l=Math.min(Math.max(t+i,o-s/2),d-i-s),c=Math.min(Math.max(t+i+s,o+s/2),d-i)),o<t&&(u=2),o>t&&(u=3),a<e&&o>=t&&o<=d&&(u=0),a>e&&o>=t&&o<=d&&(u=1),a>=e&&a<=h&&o>=t&&o<=d&&(u=-1),this.beginPath(),this.moveTo(e+i,t),2==u?(this.lineTo(l,t),this.lineTo(a,o),this.lineTo(c,t),this.lineTo(h-i,t)):this.lineTo(h-i,t),this.quadraticCurveTo(h,t,h,t+i),1==u?(this.lineTo(h,l),this.lineTo(a,o),this.lineTo(h,c),this.lineTo(h,d-i)):this.lineTo(h,d-i),this.quadraticCurveTo(h,d,h-i,d),3==u?(this.lineTo(c,d),this.lineTo(a,o),this.lineTo(l,d),this.lineTo(e+i,d)):this.lineTo(e+i,d),this.quadraticCurveTo(e,d,e,d-i),0==u?(this.lineTo(e,c),this.lineTo(a,o),this.lineTo(e,l),this.lineTo(e,t+i)):this.lineTo(e,t+i),this.quadraticCurveTo(e,t,e+i,t),this.closePath(),this},CanvasRenderingContext2D.prototype.fillSpeechBubble=function(e,t,r,n,i,a,o,s,l){return l&&(this.fillStyle=l),this.speechBubble(e,t,r,n,i,a,o,s).fill(),this},CanvasRenderingContext2D.prototype.strokeSpeechBubble=function(e,t,r,n,i,a,o,s,l){return l&&(this.strokeStyle=l),this.speechBubble(e,t,r,n,i,a,o,s).stroke(),this},d.createFaceVertexUVs=function(e){!e instanceof THREE.Geometry||(e.faceVertexUvs[0]=[],e.faces.forEach(function(t){var r=["x","y","z"].sort(function(e,r){return Math.abs(t.normal[e])>Math.abs(t.normal[r])}),n=e.vertices[t.a],i=e.vertices[t.b],a=e.vertices[t.c];e.faceVertexUvs[0].push([new THREE.Vector2(n[r[0]],n[r[1]]),new THREE.Vector2(i[r[0]],i[r[1]]),new THREE.Vector2(a[r[0]],a[r[1]])])}),e.uvsNeedUpdate=!0)},d.loadObject3D=function(e){const t=["position","rotation","quaternion","scale"];var r=Array.isArray(e)?e:[e];return r.forEach(e=>{void 0===e.object?e.object={type:"Mesh"}:void 0===e.object.type&&(e.object.type="Mesh")}),function(r){const o=[];return r.forEach(e=>{o.push(function(e){var t=e.object;if(e.url){const t=[n(e.url)];return Promise.all(t).then(t=>(t[0].name=e.url,t[0]))}if("Sprite"===t.type){const t=[a(e.material)];return Promise.all(t).then(e=>new THREE.Sprite(e[0]))}if("Points"===t.type||"Mesh"===t.type||"SkinnedMesh"===t.type||"Line"===t.type||"LineLoop"===t.type||"LineSegments"===t.type){const r=[i(e.geometry),a(e.material)];return Promise.all(r).then(e=>new THREE[t.type](e[0],e[1]))}return Promise.resolve(void 0)}(e))}),Promise.all(o).then(n=>(n.forEach((e,n)=>{var i=r[n].object;Object.keys(i).map(r=>{"type"===r||(-1!==t.indexOf(r)?e[r].fromArray(i[r]):e[r]="userData"===r?JSON.parse(JSON.stringify(i[r])):"customDepthMaterial"===r||"customDistanceMaterial"===r?i[r].clone():i[r])})}),Array.isArray(e)?Promise.resolve(n):Promise.resolve(n[0])))}(r);function n(e){return e?new Promise(t=>{(new THREE.ObjectLoader).load(e,t)}):Promise.resolve(void 0)}function i(e){if(e){if(e instanceof THREE.BufferGeometry||e instanceof THREE.Geometry)return Promise.resolve(e);if(e.parameters)return new Promise(t=>{t(new THREE[e.type](...e.parameters))});if(e.attributes){var t=new THREE.BufferGeometry;return Object.keys(e.attributes).map(r=>{t.addAttribute(r,new THREE.Float32BufferAttribute(e.attributes[r],3))}),e.index&&t.setIndex(e.index),Promise.resolve(t)}return Promise.resolve(void 0)}return Promise.resolve(void 0)}function a(e){if(e){var t;const r={},n=Object.keys(e).map(n=>{if("type"===n)t=e[n];else{if(-1!==d.TEXTURE_MAPS.indexOf(n))return function(e){if(!e)return Promise.resolve(null);return e.isTexture?Promise.resolve(e):"string"==typeof e?new Promise(t=>{(new THREE.TextureLoader).load(e,t)}):Promise.resolve(void 0)}(e[n]).then(e=>{r[n]=e});r[n]=e[n]}});return Promise.all(n).then(()=>new THREE[t](r))}return Promise.resolve(void 0)}};var f=function(){var e=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),t=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],r=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],n=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],i=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],a=[[0,2,3,7],[0,6,2,7],[0,4,6,7],[0,6,1,2],[0,1,6,4],[5,6,1,4]],o=new Int32Array(24),s=new Int32Array(256);!function(){for(var e=0,t=0;t<8;++t)for(var r=1;r<=4;r<<=1){var n=t^r;t<=n&&(o[e++]=t,o[e++]=n)}for(t=0;t<256;++t){var i=0;for(r=0;r<24;r+=2){i|=!!(t&1<<o[r])!==!!(t&1<<o[r+1])?1<<(r>>1):0}s[t]=i}}();var l=new Array(4096);return function(){for(var e=0;e<l.length;++e)l[e]=0}(),{marchingCubes:function(i,a,o){o||(o=[[0,0,0],i]);for(var s=[0,0,0],l=[0,0,0],c=0;c<3;++c)s[c]=(o[1][c]-o[0][c])/i[c],l[c]=o[0][c];var u=[],h=[],d=0,p=new Array(8),f=new Array(12),m=[0,0,0];for(m[2]=0;m[2]<i[2]-1;++m[2],d+=i[0])for(m[1]=0;m[1]<i[1]-1;++m[1],++d)for(m[0]=0;m[0]<i[0]-1;++m[0],++d){var v=0;for(c=0;c<8;++c){var g=r[c],y=a(s[0]*(m[0]+g[0])+l[0],s[1]*(m[1]+g[1])+l[1],s[2]*(m[2]+g[2])+l[2]);p[c]=y,v|=y>0?1<<c:0}var E=e[v];if(0!==E){for(c=0;c<12;++c)if(0!=(E&1<<c)){f[c]=u.length;var x=[0,0,0],b=n[c],T=r[b[0]],w=r[b[1]],_=p[b[0]],R=_-p[b[1]],M=0;Math.abs(R)>1e-6&&(M=_/R);for(var S=0;S<3;++S)x[S]=s[S]*(m[S]+T[S]+M*(w[S]-T[S]))+l[S];u.push(x)}var A=t[v];for(c=0;c<A.length;c+=3)h.push([f[A[c]],f[A[c+1]],f[A[c+2]]])}}return{vertices:u,faces:h}},marchingTetrahedra:function(e,t,r){r||(r=[[0,0,0],e]);for(var n=[0,0,0],o=[0,0,0],s=0;s<3;++s)n[s]=(r[1][s]-r[0][s])/e[s],o[s]=r[0][s];var l=[],c=[],u=0,h=new Float32Array(8),d=[0,0,0];function p(e,t){var r=h[e],a=h[t],s=i[e],c=i[t],u=[d[0],d[1],d[2]],p=r-a;Math.abs(p)>1e-6&&(p=r/p);for(var f=0;f<3;++f)u[f]=n[f]*(u[f]+s[f]+p*(c[f]-s[f]))+o[f];return l.push(u),l.length-1}for(d[2]=0;d[2]<e[2]-1;++d[2],u+=e[0])for(d[1]=0;d[1]<e[1]-1;++d[1],++u)for(d[0]=0;d[0]<e[0]-1;++d[0],++u){for(s=0;s<8;++s){var f=i[s];h[s]=t(n[0]*(d[0]+f[0])+o[0],n[1]*(d[1]+f[1])+o[1],n[2]*(d[2]+f[2])+o[2])}for(s=0;s<a.length;++s){var m=a[s],v=0;switch(h[m[0]]<0&&(v|=1),h[m[1]]<0&&(v|=2),h[m[2]]<0&&(v|=4),h[m[3]]<0&&(v|=8),v){case 0:case 15:break;case 14:c.push([p(m[0],m[1]),p(m[0],m[3]),p(m[0],m[2])]);break;case 1:c.push([p(m[0],m[1]),p(m[0],m[2]),p(m[0],m[3])]);break;case 13:c.push([p(m[1],m[0]),p(m[1],m[2]),p(m[1],m[3])]);break;case 2:c.push([p(m[1],m[0]),p(m[1],m[3]),p(m[1],m[2])]);break;case 12:c.push([p(m[1],m[2]),p(m[1],m[3]),p(m[0],m[3]),p(m[0],m[2])]);break;case 3:c.push([p(m[1],m[2]),p(m[0],m[2]),p(m[0],m[3]),p(m[1],m[3])]);break;case 4:c.push([p(m[2],m[0]),p(m[2],m[1]),p(m[2],m[3])]);break;case 11:c.push([p(m[2],m[0]),p(m[2],m[3]),p(m[2],m[1])]);break;case 5:c.push([p(m[0],m[1]),p(m[1],m[2]),p(m[2],m[3]),p(m[0],m[3])]);break;case 10:c.push([p(m[0],m[1]),p(m[0],m[3]),p(m[2],m[3]),p(m[1],m[2])]);break;case 6:c.push([p(m[2],m[3]),p(m[0],m[2]),p(m[0],m[1]),p(m[1],m[3])]);break;case 9:c.push([p(m[2],m[3]),p(m[1],m[3]),p(m[0],m[1]),p(m[0],m[2])]);break;case 7:c.push([p(m[3],m[0]),p(m[3],m[1]),p(m[3],m[2])]);break;case 8:c.push([p(m[3],m[0]),p(m[3],m[2]),p(m[3],m[1])])}}}return{vertices:l,faces:c}},surfaceNets:function(e,t,r){r||(r=[[0,0,0],e]);for(var n=[0,0,0],i=[0,0,0],a=0;a<3;++a)n[a]=(r[1][a]-r[0][a])/e[a],i[a]=r[0][a];var c=[],u=[],h=[0,0,0],d=[1,e[0]+1,(e[0]+1)*(e[1]+1)],p=[0,0,0,0,0,0,0,0],f=1;if(2*d[2]>l.length){var m=l.length;for(l.length=2*d[2];m<l.length;)l[m++]=0}for(h[2]=0;h[2]<e[2]-1;++h[2],e[0],f^=1,d[2]=-d[2]){var v=1+(e[0]+1)*(1+f*(e[1]+1));for(h[1]=0;h[1]<e[1]-1;++h[1],0,v+=2)for(h[0]=0;h[0]<e[0]-1;++h[0],0,++v){for(var g=0,y=0,E=0;E<2;++E)for(var x=0;x<2;++x)for(a=0;a<2;++a,++y){var b=t(n[0]*(h[0]+a)+i[0],n[1]*(h[1]+x)+i[1],n[2]*(h[2]+E)+i[2]);p[y]=b,g|=b<0?1<<y:0}if(0!==g&&255!==g){var T=s[g],w=[0,0,0],_=0;for(a=0;a<12;++a)if(T&1<<a){++_;var R=o[a<<1],M=o[1+(a<<1)],S=p[R],A=S-p[M];if(Math.abs(A)>1e-6){A=S/A;for(x=0,E=1;x<3;++x,E<<=1){var P=R&E,L=M&E;w[x]+=P!==L?P?1-A:A:P?1:0}}}var C=1/_;for(a=0;a<3;++a)w[a]=n[a]*(h[a]+C*w[a])+i[a];l[v]=c.length,c.push(w);for(a=0;a<3;++a)if(T&1<<a){var H=(a+1)%3,I=(a+2)%3;if(0!==h[H]&&0!==h[I]){var k=d[H],O=d[I];1&g?(u.push([l[v],l[v-k],l[v-O]]),u.push([l[v-O],l[v-k],l[v-k-O]])):(u.push([l[v],l[v-O],l[v-k]]),u.push([l[v-k],l[v-O],l[v-k-O]]))}}}}}return{vertices:c,faces:u}}}},m=r(6),v=r.n(m),g=r(11);d.IsosurfaceGeometry=function(e,t,r,n){var i=new THREE.Vector3,a=t.clone();a.getSize(i),i.multiplyScalar(.1),a.min.sub(i),a.max.add(i);t=[a.min.toArray(),a.max.toArray()];var o={min:4};o.max=e||32,a.getSize(i);var s=Math.max(i.x,i.y,i.z)/o.max;o.x=Math.max(~~(i.x/s),o.min),o.y=Math.max(~~(i.y/s),o.min),o.z=Math.max(~~(i.z/s),o.min);n=n||"surfaceNets";THREE.Geometry.call(this);var l,c,u,h=new f;switch(n){case"surfaceNets":l=h.surfaceNets([o.x,o.y,o.z],r,t);break;case"marchingCubes":l=h.marchingCubes([o.x,o.y,o.z],r,t);break;case"marchingTetrahedra":l=h.marchingTetrahedra([o.x,o.y,o.z],r,t)}for(var p=0;p<l.vertices.length;++p)c=l.vertices[p],this.vertices.push(new THREE.Vector3(c[0],c[1],c[2]));for(p=0;p<l.faces.length;++p)3===(u=l.faces[p]).length?this.faces.push(new THREE.Face3(u[0],u[1],u[2])):4===u.length&&(this.faces.push(new THREE.Face3(u[0],u[1],u[2])),this.faces.push(new THREE.Face3(u[0],u[2],u[3])));this.mergeVertices();for(var m,v,g,y,E=.001,x=new THREE.Vector3(E,0,0),b=new THREE.Vector3(0,E,0),T=new THREE.Vector3(0,0,E),w=[],_=(p=0,this.vertices.length);p<_;p++)m=R((c=this.vertices[p]).clone().add(x))-R(c.clone().sub(x)),v=R(c.clone().add(b))-R(c.clone().sub(b)),g=R(c.clone().add(T))-R(c.clone().sub(T)),y=new THREE.Vector3(m,v,g).normalize(),w.push(y);for(p=0,_=this.faces.length;p<_;p++)(u=this.faces[p]).vertexNormals=[w[u.a],w[u.b],w[u.c]];function R(e){return r(e.x,e.y,e.z)}d.createFaceVertexUVs(this),this.computeBoundingSphere()},d.IsosurfaceGeometry.prototype=Object.create(THREE.Geometry.prototype),d.IsosurfaceGeometry.prototype.constructor=d.IsosurfaceGeometry,d.DelaunayBufferGeometry=function(e,t){t=(t||"xz").toLowerCase();THREE.BufferGeometry.call(this);var r=null;"xz"===t?r=v.a.from(e.map(e=>[e.x,e.z])):"xy"===t?r=v.a.from(e.map(e=>[e.x,e.y])):"yz"===t&&(r=v.a.from(e.map(e=>[e.y,e.z])));var n=new Uint16Array(r.triangles);this.setIndex(new THREE.BufferAttribute(n,1)),this.setFromPoints(e),this.computeVertexNormals()},d.DelaunayBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),d.DelaunayBufferGeometry.prototype.constructor=d.DelaunayBufferGeometry,d.ConstrainedDelaunayBufferGeometry=function(e,t,r){t=t||[],r=r||[];THREE.BufferGeometry.call(this);var n=0;e.forEach(function(e){e.id=n++});var i=new g.SweepContext(e);t.length>0&&(t.forEach(function(e){e.forEach(function(e){e.id=n++})}),i.addHoles(t)),r.length>0&&(r.forEach(function(e){e.id=n++}),i.addPoints(r)),i.triangulate();var a=i.getTriangles(),o=[];a.forEach(function(e){e.getPoints().forEach(function(e){o.push(e.id)})}),this.setIndex(new THREE.Uint16BufferAttribute(o,1));var s=e.concat(t,r);s=d.flattenArray(s),this.setFromPoints(s),this.computeVertexNormals()},d.ConstrainedDelaunayBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),d.ConstrainedDelaunayBufferGeometry.prototype.constructor=d.ConstrainedDelaunayBufferGeometry,d.simplifyGeometry=function(e,t){t=t||.5;if(e.isGeometry||e.isBufferGeometry){e=d.toGeometry(e);var r=Math.floor(e.vertices.length*t);return(e=(new THREE.SimplifyModifier).modify(e,r)).computeVertexNormals(),e}},d.subdivideGeometry=function(e,t){t=t||1;if(e.isGeometry||e.isBufferGeometry)return e=new THREE.SubdivisionModifier(t).modify(e)},d.RingGeometry=function(e,t,r,n,i,a){THREE.Geometry.call(this),this.type="JamieRingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var o,s,l=[],c=e,u=(t-e)/(n=void 0!==n?Math.max(1,n):1);for(o=0;o<n+1;o++){for(s=0;s<r+1;s++){var h=new THREE.Vector3,d=i+s/r*a;h.x=c*Math.cos(d),h.z=c*Math.sin(d),this.vertices.push(h),l.push(new THREE.Vector2(s/r,o/n))}c+=u}var p=new THREE.Vector3(1,0,0);for(o=0;o<n;o++){var f=o*(r+1);for(s=0;s<r;s++){var m=d=s+f,v=d+r+1,g=d+r+2;this.faces.push(new THREE.Face3(m,v,g,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[v].clone(),l[g].clone()]),m=d,v=d+r+2,g=d+1,this.faces.push(new THREE.Face3(m,v,g,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[v].clone(),l[g].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},d.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),d.RingGeometry.prototype.constructor=d.RingGeometry,d.computeChildVertexFaceAmount=function(e){var t=0,r=0,n=0;return e.traverse(function(e){if(t++,e.isMesh){var i=1;e instanceof d.InstancedMesh&&(i=e.numInstances);var a=e.geometry;a.isGeometry?(r+=a.vertices.length,n+=a.faces.length):a.isBufferGeometry&&(r+=a.attributes.position.count*i,null!==a.index?n+=a.index.count/3*i:n+=a.attributes.position.count/3*i)}}),{objects:t,vertices:r,faces:n}},d.computeMassProperties=function(e){var t=0,r=0;return e.traverse(function(e){if(e.isMesh){var i=function(e){var t=0,r=0,i=e.geometry;if(i.isGeometry){var a=i.vertices;i.faces.forEach(function(e){g=new THREE.Triangle(a[e.a],a[e.b],a[e.c]),t+=g.getArea(),r+=n(a[e.a],a[e.b],a[e.c])})}else if(i.isBufferGeometry)if(i.index)for(var o,s,l,c=i.attributes.position.array,u=i.index.array,h=0,p=i.index.count;h<p;h+=3)o=u[h+0],s=u[h+1],l=u[h+2],f=new THREE.Vector3(c[3*o],c[3*o+1],c[3*o+2]),m=new THREE.Vector3(c[3*s],c[3*s+1],c[3*s+2]),v=new THREE.Vector3(c[3*l],c[3*l+1],c[3*l+2]),g=new THREE.Triangle(f,m,v),t+=g.getArea(),r+=n(f,m,v);else for(var f,m,v,g,c=i.attributes.position.array,y=3*i.attributes.position.count,h=0;h<y;h+=9)f=(new THREE.Vector3).set(c[h+0],c[h+1],c[h+2]),m=(new THREE.Vector3).set(c[h+3],c[h+4],c[h+5]),v=(new THREE.Vector3).set(c[h+6],c[h+7],c[h+8]),g=new THREE.Triangle(f,m,v),t+=g.getArea(),r+=n(f,m,v);if(e instanceof d.InstancedMesh){var E=e.numInstances;return{area:t*E,volume:r*E}}return{area:t,volume:r}}(e);t+=i.area,r+=i.volume}}),{area:t,volume:r};function n(e,t,r){return(-(r.x*t.y*e.z)+t.x*r.y*e.z+r.x*e.y*t.z-e.x*r.y*t.z-t.x*e.y*r.z+e.x*t.y*r.z)/6}},d.computeBoundingBox=function(e){return(new THREE.Box3).setFromObject(e)},d.computeBoundingSphere=function(){var e,t,r,n=new THREE.Vector3;function i(i){var a=i.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,r=o.length;t<r;t++)n.copy(o[t]),n.applyMatrix4(i.matrixWorld),e.push(n.clone())}else if(a.isBufferGeometry){var s;if(void 0!==(s=a.attributes.instancePosition?a.attributes.instancePosition:a.attributes.position))for(t=0,r=s.count;t<r;t++)n.fromBufferAttribute(s,t),n.applyMatrix4(i.matrixWorld),e.push(n.clone())}}return function(t){return e=[],t.updateMatrixWorld(!0),t.traverse(i),e.length>0?(new THREE.Sphere).setFromPoints(e):void 0}}(),d.isEmptyGeometry=function(e){return!(e.isGeometry&&e.vertices.length>0)&&!(e.isBufferGeometry&&e.attributes.position.count>0)},d.translateGeometry=function(e,t){if(t.isVector3){var r=(new THREE.Matrix4).makeTranslation(t.x,t.y,t.z);e.applyMatrix(r)}},d.rotateGeometry=function(e,t,r){if(0!==r){var n=new THREE.Matrix4;switch(t.toLowerCase()){case"x":n.makeRotationX(r);break;case"y":n.makeRotationY(r);break;case"z":n.makeRotationZ(r);break;default:return}e.applyMatrix(n)}},d.toNonIndexedBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry?t=(new THREE.BufferGeometry).fromGeometry(e):e instanceof THREE.BufferGeometry&&null!==e.index&&(t=e.toNonIndexed()),t},d.toBufferGeometry=function(e){var t=e;return e instanceof THREE.Geometry&&(t=(new THREE.BufferGeometry).fromGeometry(e)),t},d.toGeometry=function(e){return e instanceof THREE.BufferGeometry&&(e=(new THREE.Geometry).fromBufferGeometry(e)).mergeVertices(),e},d.rectangularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",r=void 0!==e.width?e.width:1,n=void 0!==e.height?e.height:1,i=void 0!==e.numWidth?Math.floor(e.numWidth):1,a=void 0!==e.numHeight?Math.floor(e.numHeight):1,o=[];function s(e,t,r,n,i,a,s){var l,c,u,h,d=a<=1?1:n/(a-1),p=s<=1?1:i/(s-1),f=a<=1?0:n/2,m=s<=1?0:i/2,v=new THREE.Vector3;for(c=0;c<s;c++)for(h=c*p-m,l=0;l<a;l++)u=l*d-f,v[e]=u,v[t]=h,v[r]=0,o.push(v.x,v.y,v.z)}return"x"===t?s("y","z",t,r,n,i,a):"y"===t?s("z","x",t,r,n,i,a):"z"===t&&s("x","y",t,r,n,i,a),o},d.circularPositions=function(e){var t=void 0!==(e=e||{}).axis?e.axis:"y",r=void 0!==e.radiusStart?e.radiusStart:1,n=void 0!==e.radiusLength?e.radiusLength:r+1,i=void 0!==e.numRadius?Math.floor(e.numRadius):1,a=void 0!==e.angleStart?e.angleStart:0,o=void 0!==e.angleLength?e.angleLength:2*Math.PI,s=void 0!==e.numAngle?Math.floor(e.numAngle):4,l=[];function c(e,t,c){var u,h,d,p,f=i<=1?1:n/(i-1),m=s<=1?1:o/(s-1);o===2*Math.PI&&(m=o/s);var v=new THREE.Vector3;for(u=0;u<i;u++)for(d=u*f+r,h=0;h<s;h++)p=h*m+a,v[e]=d*Math.cos(p),v[t]=d*Math.sin(p),v[c]=0,l.push(v.x,v.y,v.z)}return"x"===t?c("y","z",t):"y"===t?c("z","x",t):"z"===t&&c("x","y",t),l},d.structuredPositions=function(e){return(e=e||{}).positions?e.positions:"rectangular"===e.pattern?d.rectangularPositions(e):"circular"===e.pattern?d.circularPositions(e):[]},d.scatteredPositions=function(e){if((e=e||{}).positions)return{positions:e.positions,rotations:e.rotations,scales:e.scales};for(var t,r,n,i=void 0!==e.seed?d.createRandFloat(e.seed):d.randFloat,a=.5*d.WORLD_SIZE,o=e.pmin||[-a,-a,-a],s=e.pmax||[a,a,a],l=e.rmin||[0,0,0],c=e.rmax||[0,0,0],u=e.smin||[1,1,1],h=e.smax||[1,1,1],p=void 0!==e.numInstances?Math.floor(e.numInstances):1,f=[],m=[],v=[],g=0;g<p;g++)t=i(o[0],s[0]),r=i(o[1],s[1]),n=i(o[2],s[2]),f.push(t,r,n),t=i(l[0],c[0]),r=i(l[1],c[1]),n=i(l[2],c[2]),m.push(t,r,n),t=i(u[0],h[0]),r=i(u[1],h[1]),n=i(u[2],h[2]),v.push(t,r,n);return{positions:f,rotations:m,scales:v}},d.ShaderChunk={},d.ShaderChunk.mod289="float mod289(float x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }",d.ShaderChunk.permute="float permute(float x) { return mod289(((x*34.0)+1.0)*x); }\nvec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }\nvec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }",d.ShaderChunk.snoise2="float snoise(vec2 v) { const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);vec2 i  = floor(v + dot(v, C.yy) );vec2 x0 = v -   i + dot(i, C.xx);vec2 i1;i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);vec4 x12 = x0.xyxy + C.xxzz;x12.xy -= i1;i = mod289(i);vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0) );vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);m = m*m; m = m*m ;vec3 x = 2.0 * fract(p * C.www) - 1.0;vec3 h = abs(x) - 0.5;vec3 ox = floor(x + 0.5);vec3 a0 = x - ox;m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );vec3 g;g.x  = a0.x  * x0.x  + h.x  * x0.y;g.yz = a0.yz * x12.xz + h.yz * x12.yw;return 130.0 * dot(m, g); }",d.ShaderChunk.taylorInvSqrt="float taylorInvSqrt(float r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }",d.ShaderChunk.snoise3="float snoise(vec3 v) { const vec2 C = vec2(1.0/6.0, 1.0/3.0);const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);vec3 i = floor(v + dot(v, C.yyy));vec3 x0 = v - i + dot(i, C.xxx);vec3 g = step(x0.yzx, x0.xyz);vec3 l = 1.0 - g;vec3 i1 = min(g.xyz, l.zxy);vec3 i2 = max(g.xyz, l.zxy);vec3 x1 = x0 - i1 + C.xxx;vec3 x2 = x0 - i2 + C.yyy;vec3 x3 = x0 - D.yyy;i = mod289(i);vec4 p = permute( permute( permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));float n_ = 0.142857142857;vec3 ns = n_ * D.wyz - D.xzx;vec4 j = p - 49.0 * floor(p * ns.z * ns.z);vec4 x_ = floor(j * ns.z);vec4 y_ = floor(j - 7.0 * x_);vec4 x = x_ *ns.x + ns.yyyy;vec4 y = y_ *ns.x + ns.yyyy;vec4 h = 1.0 - abs(x) - abs(y);vec4 b0 = vec4( x.xy, y.xy );vec4 b1 = vec4( x.zw, y.zw );vec4 s0 = floor(b0)*2.0 + 1.0;vec4 s1 = floor(b1)*2.0 + 1.0;vec4 sh = -step(h, vec4(0.0));vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;vec3 p0 = vec3(a0.xy,h.x);vec3 p1 = vec3(a0.zw,h.y);vec3 p2 = vec3(a1.xy,h.z);vec3 p3 = vec3(a1.zw,h.w);vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));p0 *= norm.x;p1 *= norm.y;p2 *= norm.z;p3 *= norm.w;vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);m = m * m;return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3))); }",d.ShaderChunk.grad4="vec4 grad4(float j, vec4 ip) { const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);vec4 p,s;p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;p.w = 1.5 - dot(abs(p.xyz), ones.xyz);s = vec4(lessThan(p, vec4(0.0)));p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;return p; }",d.ShaderChunk.snoise4="float snoise(vec4 v) { const vec4 C = vec4(0.138196601125011, 0.276393202250021, 0.414589803375032, -0.447213595499958);vec4 i  = floor(v + dot(v, vec4(0.309016994374947451)));vec4 x0 = v -   i + dot(i, C.xxxx);vec4 i0;vec3 isX = step( x0.yzw, x0.xxx );vec3 isYZ = step( x0.zww, x0.yyz );i0.x = isX.x + isX.y + isX.z;i0.yzw = 1.0 - isX;i0.y += isYZ.x + isYZ.y;i0.zw += 1.0 - isYZ.xy;i0.z += isYZ.z;i0.w += 1.0 - isYZ.z;vec4 i3 = clamp( i0, 0.0, 1.0 );vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );vec4 x1 = x0 - i1 + C.xxxx;vec4 x2 = x0 - i2 + C.yyyy;vec4 x3 = x0 - i3 + C.zzzz;vec4 x4 = x0 + C.wwww;i = mod289(i);float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);vec4 j1 = permute( permute( permute( permute (i.w + vec4(i1.w, i2.w, i3.w, 1.0 )) + i.z + vec4(i1.z, i2.z, i3.z, 1.0 )) + i.y + vec4(i1.y, i2.y, i3.y, 1.0 )) + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;vec4 p0 = grad4(j0,   ip);vec4 p1 = grad4(j1.x, ip);vec4 p2 = grad4(j1.y, ip);vec4 p3 = grad4(j1.z, ip);vec4 p4 = grad4(j1.w, ip);vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));p0 *= norm.x;p1 *= norm.y;p2 *= norm.z;p3 *= norm.w;p4 *= taylorInvSqrt(dot(p4,p4));vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);m0 = m0 * m0;m1 = m1 * m1;return 49.0 * (dot(m0*m0, vec3(dot(p0, x0), dot(p1, x1), dot(p2, x2))) + dot(m1*m1, vec2(dot(p3, x3), dot(p4, x4)))); }",d.ShaderChunk.fade2="vec2 fade(vec2 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}",d.ShaderChunk.cnoise2="float cnoise(vec2 P){vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);Pi = mod289(Pi);vec4 ix = Pi.xzxz;vec4 iy = Pi.yyww;vec4 fx = Pf.xzxz;vec4 fy = Pf.yyww;vec4 i = permute(permute(ix) + iy);vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0;vec4 gy = abs(gx) - 0.5;vec4 tx = floor(gx + 0.5);gx = gx - tx;vec2 g00 = vec2(gx.x,gy.x);vec2 g10 = vec2(gx.y,gy.y);vec2 g01 = vec2(gx.z,gy.z);vec2 g11 = vec2(gx.w,gy.w);vec4 norm = 1.79284291400159 - 0.85373472095314 * vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));g00 *= norm.x;g01 *= norm.y;g10 *= norm.z;g11 *= norm.w;float n00 = dot(g00, vec2(fx.x, fy.x));float n10 = dot(g10, vec2(fx.y, fy.y));float n01 = dot(g01, vec2(fx.z, fy.z));float n11 = dot(g11, vec2(fx.w, fy.w));vec2 fade_xy = fade(Pf.xy);vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);float n_xy = mix(n_x.x, n_x.y, fade_xy.y);return 2.3 * n_xy; }",d.ShaderChunk.fade3="vec3 fade(vec3 t) { return t*t*t*(t*(t*6.0-15.0)+10.0); }",d.ShaderChunk.cnoise3="float cnoise(vec3 P) { vec3 Pi0 = floor(P);vec3 Pi1 = Pi0 + vec3(1.0);Pi0 = mod289(Pi0);Pi1 = mod289(Pi1);vec3 Pf0 = fract(P);vec3 Pf1 = Pf0 - vec3(1.0);vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);vec4 iy = vec4(Pi0.yy, Pi1.yy);vec4 iz0 = Pi0.zzzz;vec4 iz1 = Pi1.zzzz;vec4 ixy = permute(permute(ix) + iy);vec4 ixy0 = permute(ixy + iz0);vec4 ixy1 = permute(ixy + iz1);vec4 gx0 = ixy0 * (1.0 / 7.0);vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;gx0 = fract(gx0);vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);vec4 sz0 = step(gz0, vec4(0.0));gx0 -= sz0 * (step(0.0, gx0) - 0.5);gy0 -= sz0 * (step(0.0, gy0) - 0.5);vec4 gx1 = ixy1 * (1.0 / 7.0);vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;gx1 = fract(gx1);vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);vec4 sz1 = step(gz1, vec4(0.0));gx1 -= sz1 * (step(0.0, gx1) - 0.5);gy1 -= sz1 * (step(0.0, gy1) - 0.5);vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));g000 *= norm0.x;g010 *= norm0.y;g100 *= norm0.z;g110 *= norm0.w;vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));g001 *= norm1.x;g011 *= norm1.y;g101 *= norm1.z;g111 *= norm1.w;float n000 = dot(g000, Pf0);float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));float n111 = dot(g111, Pf1);vec3 fade_xyz = fade(Pf0);vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);return 2.2 * n_xyz;}",d.ShaderChunk.pnoise3="float pnoise(vec3 P, vec3 rep) { vec3 Pi0 = mod(floor(P), rep);vec3 Pi1 = mod(Pi0 + vec3(1.0), rep);Pi0 = mod289(Pi0);Pi1 = mod289(Pi1);vec3 Pf0 = fract(P);vec3 Pf1 = Pf0 - vec3(1.0);vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);vec4 iy = vec4(Pi0.yy, Pi1.yy);vec4 iz0 = Pi0.zzzz;vec4 iz1 = Pi1.zzzz;vec4 ixy = permute(permute(ix) + iy);vec4 ixy0 = permute(ixy + iz0);vec4 ixy1 = permute(ixy + iz1);vec4 gx0 = ixy0 * (1.0 / 7.0);vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;gx0 = fract(gx0);vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);vec4 sz0 = step(gz0, vec4(0.0));gx0 -= sz0 * (step(0.0, gx0) - 0.5);gy0 -= sz0 * (step(0.0, gy0) - 0.5);vec4 gx1 = ixy1 * (1.0 / 7.0);vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;gx1 = fract(gx1);vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);vec4 sz1 = step(gz1, vec4(0.0));gx1 -= sz1 * (step(0.0, gx1) - 0.5);gy1 -= sz1 * (step(0.0, gy1) - 0.5);vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));g000 *= norm0.x;g010 *= norm0.y;g100 *= norm0.z;g110 *= norm0.w;vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));g001 *= norm1.x;g011 *= norm1.y;g101 *= norm1.z;g111 *= norm1.w;float n000 = dot(g000, Pf0);float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));float n111 = dot(g111, Pf1);vec3 fade_xyz = fade(Pf0);vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);return 2.2 * n_xyz;}",d.ShaderChunk.random="float random(vec2 p) { return fract(sin(mod(dot(p.xy, vec2(12.9898, 78.233)), 3.14))*43758.5453123); }",d.ShaderChunk.hash="float hash(float x) { return fract(sin(x) * 1e4); }\nfloat hash(vec2 p) { return fract(1e4 * sin(17.0 * p.x + p.y * 0.1) * (0.1 + abs(sin(p.y * 13.0 + p.x)))); }",d.ShaderChunk.noise2="float noise(vec2 p) { vec2 i = floor(p);vec2 f = fract(p);float a = hash(i);float b = hash(i + vec2(1.0, 0.0));float c = hash(i + vec2(0.0, 1.0));float d = hash(i + vec2(1.0, 1.0));vec2 u = f*f*(3.0 - 2.0*f);return mix(a, b, u.x) + (c - a)*u.y*(1.0 - u.x) + (d - b)*u.x*u.y; }",d.ShaderChunk.noise3="float noise(vec3 x) { const vec3 step = vec3(110, 241, 171);vec3 i = floor(x);vec3 f = fract(x);float n = dot(i, step);vec3 u = f * f * (3.0 - 2.0 * f);return mix(mix(mix( hash(n + dot(step, vec3(0, 0, 0))), hash(n + dot(step, vec3(1, 0, 0))), u.x),mix( hash(n + dot(step, vec3(0, 1, 0))), hash(n + dot(step, vec3(1, 1, 0))), u.x), u.y),mix(mix( hash(n + dot(step, vec3(0, 0, 1))), hash(n + dot(step, vec3(1, 0, 1))), u.x),mix( hash(n + dot(step, vec3(0, 1, 1))), hash(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);}",d.ShaderChunk.fbm2="float fbm(vec2 p) { const int NUM_OCTAVES = 5;float v = 0.0;float a = 0.5;vec2 shift = vec2(100.0);mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.5));for (int i = 0; i < NUM_OCTAVES; ++i) {v += a * noise(p);p = rot * p * 2.0 + shift;a *= 0.5;}return v; }",d.ShaderChunk.fbm3="float fbm(vec3 x) { const int NUM_OCTAVES = 5;float v = 0.0;float a = 0.5;vec3 shift = vec3(100.0);for (int i = 0; i < NUM_OCTAVES; ++i) {v += a * noise(x);x = x * 2.0 + shift;a *= 0.5;}return v; }",d.ShaderChunk.fbm2IQ="float fbmIQ(vec2 p){ const mat2 m2 = mat2(0.8,-0.6,0.6,0.8);float f = 0.0;f += 0.5000*noise( p ); p = m2*p*2.02;f += 0.2500*noise( p ); p = m2*p*2.03;f += 0.1250*noise( p ); p = m2*p*2.01;f += 0.0625*noise( p );return f/0.9375; }",d.ToonShader={uniforms:{uDirLightPos:{value:new THREE.Vector3},uDirLightColor:{value:new THREE.Color(16777215)},uMaterialColor:{value:new THREE.Color(16777215)},uKd:{value:.97},uBorder:{value:.4}},vertexShader:["varying vec3 vNormal;","varying vec3 vViewPosition;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","}"].join("\n"),fragmentShader:["uniform vec3 uMaterialColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform float uKd;","uniform float uBorder;","varying vec3 vNormal;","varying vec3 vViewPosition;","void main() {","vec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );","vec3 lVector = normalize( lDirection.xyz );","vec3 normal = normalize( vNormal );","float diffuse = dot( normal, lVector );","if ( diffuse > 0.6 ) { diffuse = 1.0; }","else if ( diffuse > -0.2 ) { diffuse = 0.7; }","else { diffuse = 0.3; }","gl_FragColor = vec4( uKd * uMaterialColor * uDirLightColor * diffuse, 1.0 );","}"].join("\n")},d.SkyShader={uniforms:{turbidity:{value:10},rayleigh:{value:2},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},luminance:{value:1},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},d.SkyDomeShader={uniforms:{topColor:{value:new THREE.Color(30719)},bottomColor:{value:new THREE.Color(16777215)},offset:{value:33},exponent:{value:.6}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4(position, 1.0);","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","varying vec3 vWorldPosition;","void main() {","float h = normalize(vWorldPosition + offset).y;","gl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h, 0.0), exponent), 0.0)), 1.0);","}"].join("\n")},d.CloudDomeShader={uniforms:{noiseTex:{value:null},time:{value:1},sharp:{value:.9},cover:{value:.5},clouds:{value:1},depth:{value:0}},vertexShader:["uniform sampler2D noiseTex;","uniform float time;","varying vec2 vUv;","void main()","{","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform float depth;","uniform float sharp;","uniform float cover;","uniform float clouds;","uniform sampler2D noiseTex;","varying vec2 vUv;","vec3 noise3(vec2 p) {","\treturn texture2D(noiseTex, p).xyz;","}","vec3 fNoise(vec2 uv) {","\tvec3 f = vec3(0.0);","\tfloat scale = 1.;","\tfor (int i=0; i<5; i++) {","\t\tscale *= 2.0;","\t\tf += noise3(uv * scale) / scale;","\t}","\treturn f;","}","void main(void)","{","\tvec2 uv = vUv;","\tvec3 ff1 = fNoise(uv * 0.01 + time * 0.00015 * vec2(-1.0, 1.0));","\tvec3 ff2 = fNoise(uv * 0.1 + time * 0.0005 * vec2(1.0, 1.0));","\tfloat t = ff1.x * 0.9 + ff1.y * 0.15;","\tt = t * 0.99 + ff2.x * 0.01;","\tfloat o = clamp ( length(uv * 2.0 - vec2(1., 1.)), 0.0, 1.0 );","\to =  1.0 - o * o * o * o;","\to -= (1.0 - t) * 0.95;","\tt = max(t - (1.0 - cover), 0.0);","\tt = 1.0 - pow(1.0 - sharp, t);","\tt = min(t * 1.9, 1.0);","\tif (depth > 0.0) {","\t\tif (o < 0.4 && t < 0.8) discard;","\t\tgl_FragColor = vec4(gl_FragCoord.z, 1.0, 1.0, 1.0);","\t}","\telse {","\t\tgl_FragColor = vec4(t, t, t, o);","\t}","}"].join("\n")},d.RainDropShader={uniforms:{time:{value:0}},vertexShader:["precision highp float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float time;","attribute vec3 position;","attribute vec3 offset;","void main(void) {","vec3 translate = vec3(position.x, position.y - time, position.z);","gl_Position = projectionMatrix * modelViewMatrix * vec4(translate + offset, 1.0);","}"].join("\n"),fragmentShader:["precision highp float;","uniform float time;","void main(void) {","gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","}"].join("\n")},d.RainRippleShader={uniforms:{time:{value:0}},vertexShader:["precision highp float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","attribute vec3 position;","attribute vec3 offset;","varying vec3 vPosition;","varying vec3 vOffset;","void main(void) {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position.x + offset.x, 0.0, position.z + offset.z, 1.0);","vPosition = position;","vOffset = offset;","}"].join("\n"),fragmentShader:["precision highp float;","uniform float time;","varying vec3 vPosition;","varying vec3 vOffset;","void main(void) {","float a = abs(0.04 * time * vOffset.y - length(vPosition));","float b = 0.004 / a;","float c = step(0.9, b);","gl_FragColor = vec4(1.0, 1.0, 1.0, c);","}"].join("\n")},d.SmokeShader={uniforms:{time:{value:0},size:{value:3},smokeTex:{value:null},lifetime:{value:10},projection:{value:0}},vertexShader:["attribute float shift;","uniform float time;","uniform float size;","uniform float lifetime;","uniform float projection;","varying float progress;","float cubicOut( float t ) {","float f = t - 1.0;","return f * f * f + 1.0;","}","void main () {","progress = fract( time * 2.0 / lifetime + shift );","float eased = cubicOut( progress );","vec3 pos = vec3( position.x * eased, position.y * eased, position.z * eased  );","gl_Position = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );","gl_PointSize = ( projection * size ) / gl_Position.w;","}"].join("\n"),fragmentShader:["uniform sampler2D smokeTex;","varying float progress;","void main() {","vec3 color = vec3( 1.0 );","gl_FragColor = texture2D( smokeTex, gl_PointCoord ) * vec4( color, 0.3 * ( 1.0 - progress ) );","}"].join("\n")},d.VolumeFireShader={uniforms:{fireNoise:{value:null},fireProfile:{value:null},time:{value:1}},vertexShader:["attribute vec3 tex;","varying vec3 texOut;","void main ( void ) {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );","texOut = tex;","}"].join("\n"),fragmentShader:["uniform sampler2D fireNoise;","uniform sampler2D fireProfile;","uniform float time;","varying vec3 texOut;","const float modulus = 61.0;  // Value used in pregenerated noise texture.","const float magnatude = 1.3;","const int octives = 4;","const float lacunarity = 2.0;","const float gain = 0.5;","vec2 mBBS( vec2 val, float modulus ) {","val = mod( val, modulus ); // For numerical consistancy.","return mod(val * val, modulus);","}","float mnoise ( vec3 pos ) {","float intArg = floor( pos.z );","float fracArg = fract( pos.z );","vec2 hash = mBBS( intArg * 3.0 + vec2( 0.0, 3.0 ), modulus );","vec4 g = vec4 (","texture2D( fireNoise, vec2( pos.x, pos.y + hash.x ) / modulus ).xy,","texture2D( fireNoise, vec2( pos.x, pos.y + hash.y ) / modulus ).xy) * 2.0 - 1.0;","return mix(","g.x + g.y * fracArg,","g.z + g.w * ( fracArg - 1.0 ),","smoothstep( 0.0, 1.0, fracArg )",");","}","float turbulence( vec3 pos ) {","float sum  = 0.0;","float freq = 1.0;","float amp  = 1.0;","for ( int i = 0; i < 4; i++ ) {","sum += abs( mnoise( pos * freq ) ) * amp;","freq *= lacunarity;","amp *= gain;","}","return sum;","}","vec4 sampleFire( vec3 loc, vec4 scale ) {","loc.xz = loc.xz * 2.0 - 1.0;","vec2 st = vec2( sqrt( dot( loc.xz, loc.xz ) ), loc.y );","loc.y -= time * scale.w; // Scrolling noise upwards over time.","loc *= scale.xyz; // Scaling noise space.","float offset = sqrt( st.y ) * magnatude * turbulence( loc );","st.y += offset;","if ( st.y > 1.0 ) {","return vec4( 0.0, 0.0, 0.0, 1.0 );","}","vec4 result = texture2D( fireProfile, st );","if ( st.y < 0.1 ) {","result *= st.y / 0.1;","}","return result;","}","void main( void ) {","vec3 color = sampleFire( texOut, vec4( 1.0, 2.0, 1.0, 0.5 ) ).xyz;","gl_FragColor = vec4( color * 1.5, 1.0 );","}"].join("\n")},d.FireParticlesShader={uniforms:{color:{value:null},strength:{value:0},texture:{value:null},time:{value:0},heightOfNearPlane:{value:0}},vertexShader:["attribute float randam;","attribute float sprite;","uniform float time;","uniform float strength;","uniform float heightOfNearPlane;","varying float vSprite;","varying float vOpacity;","float PI = 3.14;","float quadraticIn( float t ) {","float tt = t * t;","return tt * tt;","}","void main() {","float progress = fract( time + ( 2.0 * randam - 1.0 ) );","float progressNeg = 1.0 - progress;","float ease = quadraticIn( progress );","float influence = sin( PI * ease );","vec3 newPosition = position * vec3( 1.0, ease, 1.0 );","gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","gl_PointSize = ( heightOfNearPlane * strength ) / gl_Position.w;","vOpacity = min( influence * 4.0, 1.0 ) * progressNeg;","vSprite = sprite;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D texture;","varying float vSprite;","varying float vOpacity;","float ONE_SPRITE_ROW_LENGTH = 0.25;","void main() {","vec2 texCoord = vec2(","gl_PointCoord.x * ONE_SPRITE_ROW_LENGTH + vSprite,","gl_PointCoord.y",");","gl_FragColor = vec4( texture2D( texture, vec2( texCoord ) ).xyz * color * vOpacity, 1.0 );","}"].join("\n")},d.GPUParticlesShader={uniforms:{uTime:{value:0},uScale:{value:1},tNoise:{value:null},tSprite:{value:null}},vertexShader:["uniform float uTime;","uniform float uScale;","uniform sampler2D tNoise;","attribute vec3 positionStart;","attribute float startTime;","attribute vec3 velocity;","attribute float turbulence;","attribute vec3 color;","attribute float size;","attribute float lifeTime;","varying vec4 vColor;","varying float lifeLeft;","void main() {","\tvColor = vec4( color, 1.0 );","\tvec3 newPosition;","\tvec3 v;","\tfloat timeElapsed = uTime - startTime;","\tlifeLeft = 1.0 - ( timeElapsed / lifeTime );","\tgl_PointSize = ( uScale * size ) * lifeLeft;","\tfloat velLength = length( velocity );","\tv.x = ( velocity.x - 0.5 ) * 3.0 * velLength;","\tv.y = ( velocity.y - 0.5 ) * 3.0 * velLength;","\tv.z = ( velocity.z - 0.5 ) * 3.0 * velLength;","\tnewPosition = positionStart + ( v * 10.0 ) * timeElapsed;","\tvec3 noise = texture2D( tNoise, vec2( newPosition.x * 0.015 + ( uTime * 0.05 ), newPosition.y * 0.02 + ( uTime * 0.015 ) ) ).rgb;","\tvec3 noiseVel = ( noise.rgb - 0.5 ) * 60.0 * velLength;","\tnewPosition = mix( newPosition, newPosition + vec3( noiseVel * turbulence ), ( timeElapsed / lifeTime ) );","\tif( v.y > 0.0 && v.y < 0.05 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( v.x < - 1.45 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( timeElapsed > 0.0 ) {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","\t} else {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\t\tlifeLeft = 0.0;","\t\tgl_PointSize = 0.0;","\t}","}"].join("\n"),fragmentShader:["float scaleLinear( float value, vec2 valueDomain ) {","\treturn ( value - valueDomain.x ) / ( valueDomain.y - valueDomain.x );","}","float scaleLinear( float value, vec2 valueDomain, vec2 valueRange ) {","\treturn mix( valueRange.x, valueRange.y, scaleLinear( value, valueDomain ) );","}","varying vec4 vColor;","varying float lifeLeft;","uniform sampler2D tSprite;","void main() {","\tfloat alpha = 0.0;","\tif( lifeLeft > 0.995 ) {","\t\talpha = scaleLinear( lifeLeft, vec2( 1.0, 0.995 ), vec2( 0.0, 1.0 ) );","\t} else {","\t\talpha = lifeLeft * 0.75;","\t}","\tvec4 tex = texture2D( tSprite, gl_PointCoord );","\tgl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );","}"].join("\n")},d.WaterShader={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:.7},time:{value:.017},distortionScale:{value:20},noiseScale:{value:1},textureMatrix:{value:new THREE.Matrix4},sunDirection:{value:new THREE.Vector3(.70707,.70707,0)},sunColor:{value:new THREE.Color(16777215)},waterColor:{value:new THREE.Color(7695)},eye:{value:new THREE.Vector3}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",THREE.ShaderChunk.fog_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.fog_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float distortionScale;","uniform float noiseScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * noiseScale );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},d.NoiseShader={uniforms:{scale:{value:10}},vertexShader:["varying vec3 vPosition;","varying vec2 vUv;","void main() {","vPosition = normalize(position);","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);","}"].join("\n"),fragmentShader:["varying vec3 vPosition;","varying vec2 vUv;","uniform float scale;",d.ShaderChunk.mod289,d.ShaderChunk.permute,d.ShaderChunk.taylorInvSqrt,d.ShaderChunk.snoise3,"void main() {","float n = snoise(vPosition * scale);","n = n*0.5 + 0.5;","gl_FragColor = vec4(n, n, n, 1.0);","}"].join("\n")},d.heightMapShader={uniforms:{landscape:{value:5},time:{value:0},scale:{value:new THREE.Vector2(1.5,1.5)},offset:{value:new THREE.Vector2(0,0)}},vertexShader:["varying vec2 vUv;","uniform vec2 scale;","uniform vec2 offset;","void main( void ) {","vUv = uv * scale + offset;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int landscape;","uniform float time;","varying vec2 vUv;",d.ShaderChunk.hash,d.ShaderChunk.noise2,d.ShaderChunk.mod289,d.ShaderChunk.permute,d.ShaderChunk.snoise2,d.ShaderChunk.fbm2IQ,"#define BADLAND_TERRAIN\t\t0\t// used for bandland terrains","#define MOUNTAIN_TERRAIN\t\t1\t// used for mountainous terrains","#define DOME_TERRAIN\t\t\t2\t// used for dome-shaped terrains","#define RIDGE_TERRAIN\t\t\t3\t// used for sharp-shaped terrains","#define DESIGN_TERRAIN\t\t\t4\t// used for user-defined terrains","#define GIANT_TERRAIN\t\t\t5\t// used for giant terrains","#define TRIANGLE_TERRAIN\t\t6\t// used for triangle terrains","float badlandTerrain(vec2 p){","const int octaves = 5;","float flatten = 1.0;","mat2 m2 = mat2(0.8,-0.6,0.6,0.8);","float a = 0.0;","float b = 0.5;","float d = 0.0;","for(int i=0; i<octaves; i++)","{","float n = snoise(p);","d += n;","a += b*n/(1.0+d*d);","b *= 0.5;","p = m2*(p*2.0);","}","return pow(a, flatten);","}","float mountainTerrain(vec2 p){","const int octaves = 5;","float flatten = 2.0;","float v = 0.0;","float a = 0.5;","vec2 shift = vec2(100.0);","for(int i=0; i<octaves; i++)","{","v += a * snoise(p);","p = p * 2.0 + shift;","a *= 0.5;","}","return pow(v*0.5 + 0.5, flatten);","}","float domeTerrain(vec2 p){","const int octaves = 2;","float flatten = 1.5;","float v = 0.0;","float a = 0.5;","vec2 shift = vec2(100.0);","for(int i=0; i<octaves; i++)","{","v += a * abs( snoise(p) );","p = p * 2.0 + shift;","a *= 0.5;","}","return pow(v, flatten);","}","float ridgeTerrain(vec2 p){","const int octaves = 5;","float flatten = 2.0;","float v = 0.0;","float a = 0.5;","vec2 shift = vec2(100.0);","for(int i=0; i<octaves; i++)","{","float n = 1.0 - abs( snoise(p) );","v += a * (n*n);","p = p * 2.0 + shift;","a *= 0.5;","}","return pow(v, flatten);","}","float designTerrain(vec2 p){","float ridgeTerrain = ridgeTerrain(p*9.0);","float flatTerrain = mountainTerrain(p*2.0);","float ctrlTerrain = domeTerrain(p);","ctrlTerrain += 0.25 * ctrlTerrain;","float e = ctrlTerrain / 100.0;","const float b = 0.5;","const float off = 0.05;","return mix( flatTerrain, ridgeTerrain, smoothstep(b-off, b+off, e) );","}","float giantTerrain(vec2 p){","mat2 m2 = mat2(1.3623, 1.7531, -1.7131, 1.4623);","const int octaves = 5;","float flatten = 2.0;","vec2 pos = p*5.0;","float w = fbmIQ(pos*0.25)*0.75+0.25;","w = 2.0 * w * w;","float f = 0.0;","for(int i = 0; i < octaves; i++){","f += w * fbmIQ(pos);","w = -w * 0.5;","pos = m2 * pos;","}","float ff = fbmIQ(pos*0.002);","f += pow(abs(ff), 10.0);","return pow(f, flatten);","}","float tri(float x){ return abs(fract(x)-0.5); }","float triXY(vec2 p){ return tri(p.x+tri((p.y-0.25)*1.5)) + tri(p.y-tri((p.x+0.5)*1.5)); }","float triSmooth(float x){ return 0.25+0.25*cos((x)*6.2831853); }","float triSmoothXY(vec2 p){ return triSmooth(p.x+triSmooth((p.y-0.25)*1.5)) + triSmooth(p.y-triSmooth((p.x+0.5)*1.5)); }","float smoothCurve(float x) {","x = max((x - 0.3)/0.7, 0.0);","return x*x*(3.0 - 2.0*x);","}","float triangleTerrain(vec2 p){","p *= 2.0;","float h = triSmoothXY( p/2.0 )*0.66 + triSmoothXY( p/1.0 )*0.34;","h = smoothCurve( h )*0.75 + triXY( p/1.0 )*0.15 + triXY( p*4.0 )*0.1;","return h * 0.75;","}","float terrain( int type, vec2 p ){","float h = 0.0;","p *= 3.0;","if( type == BADLAND_TERRAIN ) h = badlandTerrain(p);","else if( type == MOUNTAIN_TERRAIN ) h = mountainTerrain(p);","else if( type == DOME_TERRAIN ) h = domeTerrain(p);","else if( type == RIDGE_TERRAIN ) h = ridgeTerrain(p);","else if( type == DESIGN_TERRAIN ) h = designTerrain(p);","else if( type == GIANT_TERRAIN ) h = giantTerrain(p);","else if( type == TRIANGLE_TERRAIN ) h = triangleTerrain(p);","return h;","}","void main(){","vec2 p = vUv;","float h = terrain( landscape, p );","gl_FragColor = vec4( h, h, h, 1.0 );","}"].join("\n")},d.CurlNoiseParticleShader={uniforms:{time:{value:0},tPosition:{value:null},color1:{value:null},color2:{value:null},opacity:{value:.75},sizeBase:{value:0},sizeExtra:{value:9.9},hardness:{value:.16},emitPos:{value:new THREE.Vector3(0,0,0)},emitVec:{value:new THREE.Vector3(0,1,0)}},vertexShader:["varying float vColor;","varying float vAlpha;","uniform sampler2D tPosition;","uniform float opacity;","uniform float sizeBase;","uniform float sizeExtra;","uniform vec3 emitPos;","uniform vec3 emitVec;",d.ShaderChunk.random,"void main() {","float emitLength = length(emitVec);","vec3 emitDir = emitVec / emitLength;","vec3 pos = texture2D( tPosition, uv ).xyz;","float t = dot(emitDir, pos - emitPos);","if( t < 0.0 ) { pos = pos - t*emitDir; t = 0.0; }","vec3 tpos = emitPos + t*emitDir;","vec3 rvec = pos - tpos;","float r = (1.0 - cos(smoothstep(0.0, 0.2*emitLength, t) * 3.141592654)) * 0.5;","pos = pos + (r-1.0) * rvec;","vColor = random(uv + vec2(23.0, 31.22));","gl_Position = projectionMatrix * viewMatrix  * vec4( pos, 1.0 );","vAlpha = smoothstep(0.8*emitLength + 0.2*emitLength*random(uv + 1.0), 0.7*emitLength, t);","vAlpha *= clamp(1000.0 / gl_Position.z, 0.0, 1.0) * opacity;","gl_PointSize = (sizeBase + random(uv) * sizeExtra) * (500.0 / gl_Position.z);","}"].join("\n"),fragmentShader:["varying float vColor;","varying float vAlpha;","uniform vec3 color1;","uniform vec3 color2;","uniform float hardness;","uniform float time;","void main() {","float d = length(gl_PointCoord.xy - .5) * 2.0;","if( d > 1.0 ) discard;","float c = 1.0 - smoothstep(hardness, 1.0, d);","gl_FragColor = vec4(mix(color1, color2, vColor) * c, 1.0) * vAlpha;","}"].join("\n")},d.CurlNoiseCopyShader={uniforms:{resolution:{value:null},texture:{value:null}},vertexShader:["void main() {","gl_Position = vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 resolution;","uniform sampler2D texture;","void main() {","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 color = texture2D( texture, uv ).xyz;","gl_FragColor = vec4( color, 1.0 );","}"].join("\n")},d.CurlNoiseVelocityShader={uniforms:{time:{value:0},tPosition:{value:null},resolution:{value:null},speed:{value:1},emitPos:{value:new THREE.Vector3(0,0,0)},emitVec:{value:new THREE.Vector3(1,0,0)}},vertexShader:["void main() {","gl_Position = vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 resolution;","uniform sampler2D tPosition;","uniform float speed;","uniform vec3 emitPos;","uniform vec3 emitVec;",d.ShaderChunk.mod289,d.ShaderChunk.permute,d.ShaderChunk.taylorInvSqrt,d.ShaderChunk.snoise3,d.ShaderChunk.random,"vec3 snoiseVec3( vec3 x ){","float s  = snoise(vec3( x ));","float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));","float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));","vec3 c = vec3( s , s1 , s2 );","return c;","}","vec3 curlNoise( vec3 p ){","const float e = .1;","vec3 dx = vec3( e   , 0.0 , 0.0 );","vec3 dy = vec3( 0.0 , e   , 0.0 );","vec3 dz = vec3( 0.0 , 0.0 , e   );","vec3 p_x0 = snoiseVec3( p - dx );","vec3 p_x1 = snoiseVec3( p + dx );","vec3 p_y0 = snoiseVec3( p - dy );","vec3 p_y1 = snoiseVec3( p + dy );","vec3 p_z0 = snoiseVec3( p - dz );","vec3 p_z1 = snoiseVec3( p + dz );","float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;","float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;","float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;","const float divisor = 1.0 / ( 2.0 * e );","return normalize( vec3( x , y , z ) * divisor );","}","void main() {","float emitLength = length(emitVec);","vec3 emitDir = emitVec / emitLength;","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 position = texture2D( tPosition, uv ).xyz;","vec3 velocity = curlNoise(position * 0.02) * 0.1;","float t = dot(emitDir, position - emitPos);","float v = pow(smoothstep(0.0, emitLength, t), 2.0);","v = 0.05 + v * (0.2 + random(uv) * 0.2);","v = clamp(v, 0.01, 5.0);","velocity += emitDir * v;","velocity *= speed;","gl_FragColor = vec4( velocity, 1.0 );","}"].join("\n")},d.CurlNoiseVelocity4dShader={uniforms:{time:{value:0},tPosition:{value:null},resolution:{value:null},speed:{value:1},emitPos:{value:new THREE.Vector3(0,0,0)},emitVec:{value:new THREE.Vector3(1,0,0)}},vertexShader:["void main() {","gl_Position = vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 resolution;","uniform sampler2D tPosition;","uniform float time;","uniform float speed;","uniform vec3 emitPos;","uniform vec3 emitVec;",d.ShaderChunk.mod289,d.ShaderChunk.permute,d.ShaderChunk.taylorInvSqrt,d.ShaderChunk.grad4,d.ShaderChunk.snoise4,d.ShaderChunk.random,"vec4 snoiseVec4( vec4 x ){","float s  = snoise(vec4( x ));","float s1 = snoise(vec4( x.y - 19.1 , x.z + 33.4 , x.w + 47.2 , x.x + 12.2 ));","float s2 = snoise(vec4( x.z + 74.2 , x.w - 124.5 , x.x + 99.4 , x.y - 123.2 ));","float s3 = snoise(vec4( x.w + 21.2 , x.x - 52.5 , x.y + 60.4 , x.z + 42.2 ));","vec4 c = vec4( s , s1 , s2 , s3 );","return c;","}","vec4 curlNoise( vec4 p ){","const float e = .1;","vec4 dx = vec4( e   , 0.0 , 0.0 , 0.0 );","vec4 dy = vec4( 0.0 , e   , 0.0 , 0.0 );","vec4 dz = vec4( 0.0 , 0.0 , e   , 0.0 );","vec4 dw = vec4( 0.0 , 0.0 , 0.0 , e  );","vec4 p_x0 = snoiseVec4( p - dx );","vec4 p_x1 = snoiseVec4( p + dx );","vec4 p_y0 = snoiseVec4( p - dy );","vec4 p_y1 = snoiseVec4( p + dy );","vec4 p_z0 = snoiseVec4( p - dz );","vec4 p_z1 = snoiseVec4( p + dz );","vec4 p_w0 = snoiseVec4( p - dw );","vec4 p_w1 = snoiseVec4( p + dw );","float x = p_y1.z - p_y0.z - p_z1.w + p_z0.w + p_w0.y - p_w1.y;","float y = p_z1.w - p_z0.w - p_w1.x + p_w0.x + p_x0.z - p_x1.z;","float z = p_w1.x - p_w0.x - p_x1.y + p_x0.y + p_y0.w - p_y1.w;","float w = p_x1.y - p_x0.y - p_y1.z + p_y0.z + p_z0.x - p_y1.x;","const float divisor = 1.0 / ( 2.0 * e );","return normalize( vec4( x , y , z, w ) * divisor );","}","void main() {","float emitLength = length(emitVec);","vec3 emitDir = emitVec / emitLength;","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 position = texture2D( tPosition, uv ).xyz;","vec3 velocity = curlNoise(vec4(position * 0.02, time * 0.001 * speed)).xyz * 0.1;","float t = dot(emitDir, position - emitPos);","float l = pow(smoothstep(0.0, emitLength, t), 2.0);","l = 0.05 + l * (0.2 + random(uv) * 0.2);","l = clamp(l, 0.01, 5.0);","velocity += emitDir * l;","velocity *= speed;","gl_FragColor = vec4( velocity, 1.0 );","}"].join("\n")},d.CurlNoisePositionShader={uniforms:{delta:{value:0},tPosition:{value:null},tVelocity:{value:null},resolution:{value:null},spread:{value:.1},emitPos:{value:new THREE.Vector3(0,0,0)},emitVec:{value:new THREE.Vector3(1,0,0)}},vertexShader:["void main() {","gl_Position = vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 resolution;","uniform sampler2D tVelocity;","uniform sampler2D tPosition;","uniform float delta;","uniform vec3 emitPos;","uniform vec3 emitVec;","uniform float spread;",d.ShaderChunk.random,"void main() {","float emitLength = length(emitVec);","vec3 emitDir = emitVec / emitLength;","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 position = texture2D( tPosition, uv ).xyz;","vec3 velocity = texture2D( tVelocity, uv ).xyz;","position += velocity * delta * 1.0;","float t = dot(emitDir, position - emitPos);","if(t > emitLength) {","position = emitPos;","position.x += emitLength*spread*(random(uv + vec2(21.3, 63.21))-0.5);","position.y += emitLength*spread*(random(uv + vec2(32.3, 734.21))-0.5);","position.z += emitLength*spread*(random(uv + vec2(127.3, 31.21))-0.5);","}","gl_FragColor = vec4( position, 1.0 );","}"].join("\n")},d.ShaderChunk.fishAnimation=["#define twoPI 6.28318530718","vec3 fishAnimation( vec3 position )","{","float wave_factor = 0.0001;","float twist_factor = 0.0001;","float bend_factor = 0.1;","float speed_factor = 1.0 + 3.0 * smoothstep( 20.0, 0.1, fishLength );","float curTime = time * speed_factor + fishSpeed;","vec3 new_pos = position;","vec3 tmp_pos = position;","float head_z = fishLength/2.0;","float tail_z = -fishLength/2.0;","float z = position.z;","z = (z - head_z) / (tail_z - head_z);","z = smoothstep( 0.0, 1.0, z );","float wave_ang = cos( (curTime - z) * twoPI ) * wave_factor * z;","new_pos.x += wave_ang;","float twist_ang = cos( (curTime - z) * twoPI ) * twist_factor;","float twist_cos = cos( twist_ang );","float twist_sin = sin( twist_ang );","tmp_pos.x = new_pos.x * twist_cos - new_pos.y * twist_sin;","tmp_pos.y = new_pos.x * twist_sin + new_pos.y * twist_cos;","new_pos = tmp_pos;","float bend_ang = cos( (curTime - z) * twoPI ) * bend_factor * z;","float bend_cos = cos( bend_ang );","float bend_sin = sin( bend_ang );","tmp_pos.x = new_pos.x * bend_cos - new_pos.z * bend_sin;","tmp_pos.z = new_pos.x * bend_sin + new_pos.z * bend_cos;","new_pos = tmp_pos;","return new_pos;","}"].join("\n"),d.BoidsPositionShader={uniforms:{time:{value:0},delta:{value:0},bounds:{value:new THREE.Vector3(1e3,1e3,1e3)},central:{value:new THREE.Vector3(0,0,0)}},fragmentShader:["uniform float time;","uniform float delta;","uniform vec3 bounds;","uniform vec3 central;","void main() {","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec4 tmpPos = texture2D( tPosition, uv );","vec3 position = tmpPos.xyz;","vec3 velocity = texture2D( tVelocity, uv ).xyz;","float phase = tmpPos.w;","phase = mod( ( phase + delta +","length( velocity ) * delta * 6.0 ), 62.83 );","vec3 fragPos = position + velocity * delta * 15.0;","vec3 minBound = central - bounds * 0.5;","vec3 maxBound = central + bounds * 0.5;","fragPos = clamp( fragPos, minBound, maxBound );","gl_FragColor = vec4( fragPos, phase );","}"].join("\n")},d.BoidsVelocityShader={uniforms:{time:{value:0},delta:{value:0},seperationDistance:{value:20},alignmentDistance:{value:20},cohesionDistance:{value:20},bounds:{value:new THREE.Vector3(1e3,1e3,1e3)},central:{value:new THREE.Vector3(0,0,0)},speedLimit:{value:9},predator:{value:new THREE.Vector3}},fragmentShader:["uniform float time;","uniform float delta;","uniform float seperationDistance;","uniform float alignmentDistance;","uniform float cohesionDistance;","uniform vec3 bounds;","uniform vec3 central;","uniform float speedLimit;","uniform vec3 predator;","const float width = resolution.x;","const float height = resolution.y;","const float PI = 3.141592653589793;","const float PI_2 = PI * 2.0;","float zoneRadius = 40.0;","float zoneRadiusSquared = 1600.0;","float separationThresh = 0.45;","float alignmentThresh = 0.65;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","zoneRadius = seperationDistance + alignmentDistance + cohesionDistance;","separationThresh = seperationDistance / zoneRadius;","alignmentThresh = ( seperationDistance + alignmentDistance ) / zoneRadius;","zoneRadiusSquared = zoneRadius * zoneRadius;","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec3 birdPosition, birdVelocity;","vec3 selfPosition = texture2D( tPosition, uv ).xyz;","vec3 selfVelocity = texture2D( tVelocity, uv ).xyz;","float dist;","vec3 dir;","float distSquared;","float seperationSquared = seperationDistance * seperationDistance;","float cohesionSquared = cohesionDistance * cohesionDistance;","float f;","float percent;","vec3 velocity = selfVelocity;","float limit = speedLimit;","dir = predator * bounds - selfPosition;","dist = length( dir );","distSquared = dist * dist;","float preyRadius = 50.0;","float preyRadiusSq = preyRadius * preyRadius;","if (dist < preyRadius) {","f = ( distSquared / preyRadiusSq - 1.0 ) * delta * 10.0;","velocity += normalize( dir ) * f;","limit = min( limit*3.0, limit+5.0 );","}","dir = selfPosition - central;","dist = length( dir );","velocity -= normalize( dir ) * delta * 5.0;","for( float y = 0.0; y < height; y++ )","{","for( float x = 0.0; x < width; x++)","{","vec2 ref = vec2( x + 0.5, y + 0.5 ) / resolution.xy;","birdPosition = texture2D( tPosition, ref ).xyz;","dir = birdPosition - selfPosition;","dist = length(dir);","if (dist < 0.0001) continue;","distSquared = dist * dist;","if (distSquared > zoneRadiusSquared ) continue;","percent = distSquared / zoneRadiusSquared;","if ( percent < separationThresh ) { // low","f = (separationThresh / percent - 1.0) * delta;","velocity -= normalize(dir) * f;","} else if ( percent < alignmentThresh ) { // high","float threshDelta = alignmentThresh - separationThresh;","float adjustedPercent = ( percent - separationThresh ) / threshDelta;","birdVelocity = texture2D( tVelocity, ref ).xyz;","f = ( 0.5 - cos( adjustedPercent * PI_2 ) * 0.5 + 0.5 ) * delta;","velocity += normalize(birdVelocity) * f;","} else {","float threshDelta = 1.0 - alignmentThresh;","float adjustedPercent = ( percent - alignmentThresh ) / threshDelta;","f = ( 0.5 - ( cos( adjustedPercent * PI_2 ) * -0.5 + 0.5 ) ) * delta;","velocity += normalize(dir) * f;","}","}","}","if ( length( velocity ) > limit ) {","velocity = normalize( velocity ) * limit;","}","gl_FragColor = vec4( velocity, 1.0 );","}"].join("\n")},d.BoidsDrawShader={uniforms:{time:{value:0},boidType:{value:0},boidLength:{value:0},color:{value:new THREE.Color(16777215)},tDiffuse:{value:new THREE.Texture},tSpecular:{value:new THREE.Texture},tPosition:{value:new THREE.Texture},tVelocity:{value:new THREE.Texture}},vertexShader:["#define twoPI 6.28318530718","attribute vec2 boidSite;","attribute vec3 boidColor;","attribute float boidVertex;","uniform int boidType;","uniform float boidLength;","uniform sampler2D tPosition;","uniform sampler2D tVelocity;","uniform float time;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vColor;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,d.ShaderChunk.random,"vec3 fishAnimation( vec3 pos )","{","float r = random( boidSite );","float h = r - 0.5;","float wave_factor = 0.4;","float twist_factor = 0.3 * h;","float bend_factor = 0.2 * h;","float speed_factor = length( texture2D( tVelocity, boidSite ).xyz );","speed_factor = log(speed_factor + 1.0) * 3.0;","speed_factor = clamp( speed_factor, 1.0, 3.0 );","float curTime = time * speed_factor;","vec3 new_pos = pos;","vec3 tmp_pos = pos;","float head_z = boidLength/2.0;","float tail_z = -boidLength/2.0;","float z = pos.z;","z = (z - head_z) / (tail_z - head_z);","z = smoothstep( 0.0, 1.0, z );","float wave_ang = sin( (curTime - z) * twoPI ) * wave_factor * z;","new_pos.x += wave_ang;","float twist_ang = sin( (curTime - z) * twoPI ) * twist_factor;","float twist_cos = cos( twist_ang );","float twist_sin = sin( twist_ang );","tmp_pos.x = new_pos.x * twist_cos - new_pos.y * twist_sin;","tmp_pos.y = new_pos.x * twist_sin + new_pos.y * twist_cos;","new_pos = tmp_pos;","float bend_ang = sin( (curTime) * twoPI ) * bend_factor * z;","float bend_cos = cos( bend_ang );","float bend_sin = sin( bend_ang );","tmp_pos.x = new_pos.x * bend_cos - new_pos.z * bend_sin;","tmp_pos.z = new_pos.x * bend_sin + new_pos.z * bend_cos;","new_pos = tmp_pos;","return new_pos;","}","void main() {","vec4 tmpPos = texture2D( tPosition, boidSite );","vec3 pos = tmpPos.xyz;","vec3 velocity = normalize(texture2D( tVelocity, boidSite ).xyz);","vec3 newPosition = position;","if( boidType == 0 ) {","if ( boidVertex == 4.0 || boidVertex == 7.0 ) {","newPosition.y = sin( tmpPos.w ) * 5.0;","}","}","else {","newPosition = fishAnimation( position );","}","newPosition = mat3( modelMatrix ) * newPosition;","velocity.z *= -1.0;","float xz = length( velocity.xz );","float xyz = 1.0;","float x = sqrt( 1.0 - velocity.y * velocity.y );","float cosry = velocity.x / xz;","float sinry = velocity.z / xz;","float cosrz = x / xyz;","float sinrz = velocity.y / xyz;","mat3 maty =  mat3(","cosry, 0.0, -sinry,","0.0  , 1.0, 0.0   ,","sinry, 0.0, cosry ",");","mat3 matz =  mat3(","cosrz , sinrz, 0.0,","-sinrz, cosrz, 0.0,","0.0   , 0.0  , 1.0 ",");","newPosition = maty * matz * newPosition;","newPosition += pos;","vec4 worldPosition = vec4( newPosition, 1.0 );","vec4 mvPosition = viewMatrix  * worldPosition;","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vUv = uv;","vNormal = normalize( normalMatrix * normal );","vColor = vec4( boidColor, 1.0 );",THREE.ShaderChunk.shadowmap_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragmentShader:["uniform int boidType;","uniform vec3 color;","uniform sampler2D tDiffuse;","uniform sampler2D tSpecular;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vColor;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 fragColor = vec3( 0.0 );","vec3 totalLd = vec3( 0.0 );","vec3 totalLs = vec3( 0.0 );","vec3 N = normalize( vNormal );","vec3 V = normalize( vViewPosition );","float shininess = 32.0;","vec3 specularTex = texture2D( tSpecular, vUv ).rgb;","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 L = pointLights[ i ].position + vViewPosition.xyz;","float atten = calcLightAttenuation( length( L ), pointLights[ i ].distance, pointLights[ i ].decay );","L = normalize( L );","vec3 H = normalize( L + V );","float NoH = max( dot( N, H ), 0.0 );","float diffWt = max( dot( N, L ), 0.0 );","float specWt = specularTex.r * max( pow( NoH, shininess ), 0.0 );","totalLd += atten * pointLights[ i ].color * diffWt;","totalLs += atten * pointLights[ i ].color * specWt * diffWt;","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 Lc = directionalLights[ i ].color;","vec3 L = directionalLights[ i ].direction;","vec3 H = normalize( L + V );","float NoH = max( dot( N, H ), 0.0 );","float NoL = max( dot( N, L ), 0.0 );","totalLd += Lc * NoL;","totalLs += Lc * NoL * specularTex * max( pow( NoH, shininess ), 0.0 );","}","#endif","#if NUM_HEMI_LIGHTS > 0","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 L = hemisphereLights[ i ].direction;","vec3 gndLc = hemisphereLights[ i ].groundColor;","vec3 skyLc = hemisphereLights[ i ].skyColor;","float NoL = dot( N, L );","float diffWt = 0.5 * NoL + 0.5;","totalLd += mix( gndLc, skyLc, diffWt );","float specWt = 0.0;","vec3 skyH = normalize( L + V );","float skyNoH = 0.5 * dot( N, skyH ) + 0.5;","specWt += specularTex.r * max( pow( skyNoH, shininess ), 0.0 );","vec3 gndH = normalize( -L + V );","float gndNoH = 0.5 * dot( N, gndH ) + 0.5;","specWt += specularTex.r * max( pow( gndNoH, shininess ), 0.0 );","totalLs += mix( gndLc, skyLc, diffWt ) * specWt * diffWt;","}","#endif","vec4 albedo = vec4( 1.0 );","if( boidType == 0 ) {","albedo = vec4( mix( color, vColor.rgb, 0.8 ), 1.0 );","fragColor = albedo.rgb;","}","if( boidType == 1 ) {","albedo.rgb = color * texture2D( tDiffuse, vUv ).rgb;","fragColor = albedo.rgb * ( totalLd + ambientLightColor + totalLs );","}","gl_FragColor = vec4( fragColor, albedo.a );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},d.UnderWaterShader={uniforms:{tDiffuse:{value:null},time:{value:0},distort_speed:{value:5e-4},distortion:{value:.04},centerX:{value:.5},centerY:{value:.5}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float time;","uniform float distort_speed;","uniform float distortion;","uniform float centerX;","uniform float centerY;","varying vec2 vUv;","void main() {","vec2 p = vUv;","vec2 center_coord;","float distance_to_center;","float projected_distance_to_center;","float distort_degree;","center_coord.x = p.x - centerX;","center_coord.y = p.y - centerY;","distance_to_center = sqrt(center_coord.x * center_coord.x + center_coord.y * center_coord.y);","distort_degree = abs( mod(distort_speed* time, distortion) - (distortion / 2.0)) + 1.0;","projected_distance_to_center = pow(1.0, distort_degree - 1.0) * pow(distance_to_center/1.0, distort_degree);","p.x = projected_distance_to_center * center_coord.x/ distance_to_center + centerX;","p.y = projected_distance_to_center * center_coord.y/ distance_to_center + centerY;","vec4 color = texture2D(tDiffuse, p);","gl_FragColor = color;","}"].join("\n")},d.ParticleEngineShader={uniforms:{texture:{value:null}},vertexShader:["attribute vec3  customColor;","attribute float customOpacity;","attribute float customSize;","attribute float customAngle;","attribute float customVisible;","varying vec4  vColor;","varying float vAngle;","void main()","{","if ( customVisible > 0.5 )","vColor = vec4( customColor, customOpacity );","else","vColor = vec4(0.0, 0.0, 0.0, 0.0);","vAngle = customAngle;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = customSize * ( 300.0 / length( mvPosition.xyz ) );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","varying vec4 vColor;","varying float vAngle;","void main()","{","gl_FragColor = vColor;","float c = cos(vAngle);","float s = sin(vAngle);","vec2 rotatedUV = vec2(c * (gl_PointCoord.x - 0.5) + s * (gl_PointCoord.y - 0.5) + 0.5,","c * (gl_PointCoord.y - 0.5) - s * (gl_PointCoord.x - 0.5) + 0.5);","vec4 rotatedTexture = texture2D( texture,  rotatedUV );","gl_FragColor = gl_FragColor * rotatedTexture;","}"].join("\n")},d.TerrainLODShader={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{diffuse:{value:new THREE.Color(16777215)},specular:{value:new THREE.Color(16777215)},shininess:{value:30},opacity:{value:1},enableDiffuse1:{value:!0},enableDiffuse2:{value:!0},enableSpecular:{value:!1},tDiffuse1:{value:null},tDiffuse2:{value:null},tSpecular:{value:null},uvRepeatOverlay:{value:new THREE.Vector2(1,1)},uvOffset:{value:new THREE.Vector2(0,0)},worldWidth:{value:1024},tileResolution:{value:64},edgeMorph:{value:0},globalOffset:{value:null},tileOffset:{value:null},heightMap:{value:null},tileScale:{value:64},maxHeight:{value:100},winterSnow:{value:!1},summerGreen:{value:!1}}]),vertexShader:["uniform float worldWidth;","uniform float tileResolution;","uniform vec3 globalOffset;","uniform vec2 tileOffset;","uniform sampler2D heightMap;","uniform float tileScale;","uniform float maxHeight;","varying float vMorphFactor;","varying vec3 vPosition;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,"float getHeight(vec3 p) {","float lod = 0.0;","vec2 st = p.xy / worldWidth;","float h = 1024.0 * texture2DLodEXT(heightMap, st, lod).r;","h += 64.0 * texture2DLodEXT(heightMap, 16.0 * st, lod).r;","h += 4.0 * texture2DLodEXT(heightMap, 256.0 * st, lod).r;","return h / 1092.0 * maxHeight;","}","#define EGDE_MORPH_TOP    1","#define EGDE_MORPH_LEFT   2","#define EGDE_MORPH_BOTTOM 4","#define EGDE_MORPH_RIGHT  8","#define MORPH_REGION      0.3","uniform int edgeMorph;","bool edgePresent(int edge) {","int e = edgeMorph / edge;","return 2 * ( e / 2 ) != e;","}","float calculateMorph(vec3 p) {","float morphFactor = 0.0;","if( edgePresent(EGDE_MORPH_TOP) && p.y >= 1.0 - MORPH_REGION ) {","float m = 1.0 - clamp((1.0 - p.y) / MORPH_REGION, 0.0, 1.0);","morphFactor = max(m, morphFactor);","}","if( edgePresent(EGDE_MORPH_LEFT) && p.x <= MORPH_REGION ) {","float m = 1.0 - clamp(p.x / MORPH_REGION, 0.0, 1.0);","morphFactor = max(m, morphFactor);","}","if( edgePresent(EGDE_MORPH_BOTTOM) && p.y <= MORPH_REGION ) {","float m = 1.0 - clamp(p.y / MORPH_REGION, 0.0, 1.0);","morphFactor = max(m, morphFactor);","}","if( edgePresent(EGDE_MORPH_RIGHT) && p.x >= 1.0 - MORPH_REGION ) {","float m = 1.0 - clamp((1.0 - p.x) / MORPH_REGION, 0.0, 1.0);","morphFactor = max(m, morphFactor);","}","return morphFactor;","}","void main() {","vMorphFactor = calculateMorph(position);","vPosition = tileScale * position + vec3(tileOffset, 0.0) + globalOffset;","float grid = tileScale / tileResolution;","vPosition = floor(vPosition / grid) * grid;","if( vMorphFactor > 0.0 ) {","grid = 2.0 * grid;","vec3 position2 = floor(vPosition / grid) * grid;","vPosition = mix(vPosition, position2, vMorphFactor);","}","vPosition = vPosition + normal * getHeight(vPosition);","vec4 mvPosition =  modelViewMatrix * vec4( vPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vUv = uv;","vPosition.xyz = vPosition.yzx;","vViewPosition.xyz = -mvPosition.yzx;","#if defined (USE_SHADOWMAP)","vec4 worldPosition = modelMatrix * vec4( vPosition, 1.0 );","#endif",THREE.ShaderChunk.shadowmap_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tSpecular;","uniform vec2 uvRepeatOverlay;","uniform vec2 uvOffset;","uniform float worldWidth;","uniform sampler2D heightMap;","uniform float maxHeight;","uniform bool winterSnow;","uniform bool summerGreen;","varying float vMorphFactor;","varying vec3 vPosition;","varying vec2 vUv;","varying vec3 vViewPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"float getHeight(vec3 p) {","vec2 st = p.zx / worldWidth;","float h = 1024.0 * texture2D(heightMap, st).r;","h += 64.0 * texture2D(heightMap, 16.0 * st).r;","h += 4.0 * texture2D(heightMap, 256.0 * st).r;","return h / 1092.0 * maxHeight;","}","vec3 getNormal() {","float height = getHeight( vPosition );","vec3 p = vec3( vPosition.x, height, vPosition.z );","vec3 dPositiondx = dFdx(p);","vec3 dPositiondy = dFdy(p);","return normalize(cross(dPositiondx, dPositiondy));","}","float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 && cutoffDistance > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), 2.0 );","}","return 1.0;","}","void main() {","vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uvRepeatOverlay * vUv + uvOffset;","vec3 viewPosition = normalize( vViewPosition );","vec3 normal = getNormal();","vec3 outgoingLight = vec3( 0.0 );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - getHeight( vPosition ) / worldWidth );","} else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","if( winterSnow )","{","vec3 snowColor = vec3( 0.93, 0.97, 1.0 );","float snowStick = dot( vec3( 0.0, 1.0, 0.0 ), normal );","snowStick = pow( snowStick, 3.0 );","snowStick = step( 0.2, snowStick );","diffuseColor.xyz = mix( diffuseColor.xyz, snowColor, snowStick );","}","if( summerGreen )","{","vec3 water = vec3( 0.0, 0.12, 0.06 );","vec3 grass = vec3( 0.07, 0.43, 0.08 );","vec3 rock = vec3( 0.31, 0.11, 0.09 );","float grassStick = dot( vec3( 0.0, 1.0, 0.0 ), normal );","float stickExponent = 1.2 + 1.8 * float( winterSnow );","grassStick = pow( grassStick, stickExponent );","float minVal = 0.2 + 0.1 * float( winterSnow );","grassStick = step( minVal, grassStick );","vec3 waterGrass = mix( water, grass, smoothstep( 7.0, 14.0, vPosition.y ) );","vec3 rockWaterGrass = mix( rock, waterGrass, 0.5 );","diffuseColor.xyz = mix( diffuseColor.xyz, rockWaterGrass, grassStick );","}","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLights[ i ].direction;","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","float mistAmount = clamp( 1.0 - vPosition.y / 15.0, 0.0, 1.0 );","mistAmount = pow( mistAmount, 5.4 );","vec3 mistColor = vec3( 0.835, 0.843, 0.850 );","outgoingLight = mix( outgoingLight, mistColor, mistAmount );","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},d.GrayScaleShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float gray = dot( texel.rgb, vec3(0.299, 0.587, 0.114) );","gl_FragColor = vec4( gray, gray, gray, texel.a );","}"].join("\n")},d.LuminanceShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float luma = dot( texel.rgb, vec3(0.2125, 0.7154, 0.0721) );","gl_FragColor = vec4( luma, luma, luma, texel.a );","}"].join("\n")},d.InvertImageShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = vec3(1.0) - texel.rgb;","gl_FragColor.a = texel.a;","}"].join("\n")},d.BrightnessShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 black = vec3(0.0);","gl_FragColor.rgb = mix( black, texel.rgb, 2.0 );","gl_FragColor.a = texel.a;","}"].join("\n")},d.SaturationShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float luma = dot( texel.rgb, vec3(0.2125, 0.7154, 0.0721) );","gl_FragColor.rgb = mix( vec3(luma), texel.rgb, 0.5 );","gl_FragColor.a = texel.a;","}"].join("\n")},d.ContrastShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mix( vec3(0.5), texel.rgb, 2.0 );","gl_FragColor.a = texel.a;","}"].join("\n")},d.DitheringShader={uniforms:{tDiffuse:{value:null},tNoise:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNoise;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float grayscale = length( texel.rgb * vec3(0.2126, 0.7152, 0.0722) );","vec3 ditherPixel = texture2D( tNoise, vec2( mod( gl_FragCoord.xy / vec2(8.0), 1.0) ) ).xyz;","float ditherGrayscale = ( ditherPixel.x + ditherPixel.y + ditherPixel.z ) / 3.0;","ditherGrayscale -= 0.5;","float ditheredResult = grayscale + ditherGrayscale;","float bit = (ditheredResult >= 0.5) ? 1.0 : 0.0;","gl_FragColor.rgb = vec3( bit );","gl_FragColor.a = texel.a;","}"].join("\n")},d.GaussianBlurShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/512,1/512)},strength:{value:3.5},horizontalPass:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","uniform float strength;","uniform int horizontalPass;","varying vec2 vUv;","void main() {","const float pi = 3.14159265;","const float numBlurPixelsPerSide = 16.0;","vec2 texOffset = resolution;","vec2 blurMultiplyVec = 0 < horizontalPass ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","vec3 incrementalGaussian;","incrementalGaussian.x = 1.0 / (sqrt(2.0 * pi) * strength);","incrementalGaussian.y = exp(-0.5 / (strength * strength));","incrementalGaussian.z = incrementalGaussian.y * incrementalGaussian.y;","vec4 avgValue = vec4(0.0, 0.0, 0.0, 0.0);","float coefficientSum = 0.0;","avgValue += texture2D( tDiffuse, vUv ) * incrementalGaussian.x;","coefficientSum += incrementalGaussian.x;","incrementalGaussian.xy *= incrementalGaussian.yz;","for (float i = 1.0; i <= numBlurPixelsPerSide; i++) {","avgValue += texture2D( tDiffuse, vUv - i * texOffset * blurMultiplyVec ) * incrementalGaussian.x;","avgValue += texture2D( tDiffuse, vUv + i * texOffset * blurMultiplyVec ) * incrementalGaussian.x;","coefficientSum += 2.0 * incrementalGaussian.x;","incrementalGaussian.xy *= incrementalGaussian.yz;","}","gl_FragColor = avgValue / coefficientSum;","}"].join("\n")},d.EdgeDetectionShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/512,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + resolution * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n")},d.EdgeDetection2Shader={defines:{EDGE_FUNC:"edge"},uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/512,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","const mat3 sobelKernelX = mat3(1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0);","const mat3 sobelKernelY = mat3(-1.0, -2.0, -1.0, 0.0, 0.0, 0.0, 1.0, 2.0, 1.0);","float convolve(mat3 kernel, mat3 image) {","float result = 0.0;","for (int i = 0; i < 3; i++) {","for (int j = 0; j < 3; j++) {","result += kernel[i][j]*image[i][j];","}","}","return result;","}","float convolveComponent(mat3 kernelX, mat3 kernelY, mat3 image) {","vec2 result;","result.x = convolve(kernelX, image);","result.y = convolve(kernelY, image);","return clamp(length(result), 0.0, 255.0);","}","vec4 colorEdge(float stepx, float stepy, vec2 center, mat3 kernelX, mat3 kernelY) {","vec4 colors[9];","colors[0] = texture2D(tDiffuse,center + vec2(-stepx,stepy));","colors[1] = texture2D(tDiffuse,center + vec2(0,stepy));","colors[2] = texture2D(tDiffuse,center + vec2(stepx,stepy));","colors[3] = texture2D(tDiffuse,center + vec2(-stepx,0));","colors[4] = texture2D(tDiffuse,center);","colors[5] = texture2D(tDiffuse,center + vec2(stepx,0));","colors[6] = texture2D(tDiffuse,center + vec2(-stepx,-stepy));","colors[7] = texture2D(tDiffuse,center + vec2(0,-stepy));","colors[8] = texture2D(tDiffuse,center + vec2(stepx,-stepy));","mat3 imageR, imageG, imageB, imageA;","for (int i = 0; i < 3; i++) {","for (int j = 0; j < 3; j++) {","imageR[i][j] = colors[i*3+j].r;","imageG[i][j] = colors[i*3+j].g;","imageB[i][j] = colors[i*3+j].b;","imageA[i][j] = colors[i*3+j].a;","}","}","vec4 color;","color.r = convolveComponent(kernelX, kernelY, imageR);","color.g = convolveComponent(kernelX, kernelY, imageG);","color.b = convolveComponent(kernelX, kernelY, imageB);","color.a = convolveComponent(kernelX, kernelY, imageA);","return color;","}","vec4 edge(float stepx, float stepy, vec2 center, mat3 kernelX, mat3 kernelY){","mat3 image = mat3(length(texture2D(tDiffuse,center + vec2(-stepx,stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(0,stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(stepx,stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(-stepx,0)).rgb),","length(texture2D(tDiffuse,center).rgb),","length(texture2D(tDiffuse,center + vec2(stepx,0)).rgb),","length(texture2D(tDiffuse,center + vec2(-stepx,-stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(0,-stepy)).rgb),","length(texture2D(tDiffuse,center + vec2(stepx,-stepy)).rgb));","vec2 result;","result.x = convolve(kernelX, image);","result.y = convolve(kernelY, image);","float color = clamp(length(result), 0.0, 255.0);","return vec4(color);","}","vec4 trueColorEdge(float stepx, float stepy, vec2 center, mat3 kernelX, mat3 kernelY) {","vec4 edgeVal = edge(stepx, stepy, center, kernelX, kernelY);","return edgeVal * texture2D(tDiffuse,center);","}","void main(void)","{","vec4 texel = texture2D( tDiffuse, vUv );","vec4 result = EDGE_FUNC( resolution.x, resolution.y, vUv, sobelKernelX, sobelKernelY );","gl_FragColor = vec4( result.rgb, texel.a );","}"].join("\n")},d.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float offset;","uniform float darkness;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},d.FilmGrainShader={uniforms:{tDiffuse:{value:null},aspectCorrection:{value:!1},aspect:{value:1},grainScale:{value:.005},grainTime:{value:0},noiseAlpha:{value:.25},offset:{value:new THREE.Vector2(0,0)},scale:{value:new THREE.Vector2(1,1)},smoothEdge:{value:new THREE.Vector2(0,1)},color1:{value:new THREE.Color(16777215)},color2:{value:new THREE.Color(2635844)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:[d.ShaderChunk.mod289,d.ShaderChunk.permute,d.ShaderChunk.taylorInvSqrt,d.ShaderChunk.snoise3,d.ShaderChunk.fade3,d.ShaderChunk.pnoise3,"float grain(vec2 texCoord, vec2 resolution, float frame, float multiplier) {","vec2 mult = texCoord * resolution;","float offset = snoise(vec3(mult / multiplier, frame));","float n1 = pnoise(vec3(mult, offset), vec3(1.0/texCoord * resolution, 1.0));","return n1 / 2.0 + 0.5;","}","float grain(vec2 texCoord, vec2 resolution, float frame) {","return grain(texCoord, resolution, frame, 2.5);","}","float grain(vec2 texCoord, vec2 resolution) {","return grain(texCoord, resolution, 0.0);","}","vec3 blendSoftLight(vec3 base, vec3 blend) {","return mix(","sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend),","2.0 * base * blend + base * base * (1.0 - 2.0 * blend),","step(base, vec3(0.5))",");","}","uniform sampler2D tDiffuse;","uniform vec3 color1;","uniform vec3 color2;","uniform float aspect;","uniform vec2 offset;","uniform vec2 scale;","uniform float noiseAlpha;","uniform bool aspectCorrection;","uniform float grainScale;","uniform float grainTime;","uniform vec2 smoothEdge;","varying vec2 vUv;","void main() {","vec2 q = vec2(vUv - 0.5);","if( aspectCorrection ) {","q.x *= aspect;","}","q /= scale;","q -= offset;","float dst = length(q);","dst = smoothstep(smoothEdge.x, smoothEdge.y, dst);","vec3 color12 = mix(color1, color2, dst);","vec3 color3 = texture2D(tDiffuse, vUv).rgb;","vec3 color = mix(color12, color3, 0.75);","if( noiseAlpha > 0.0 && grainScale > 0.0 ) {","float gSize = 1.0 / grainScale;","float g = grain(vUv, vec2(gSize * aspect, gSize), grainTime);","vec3 noiseColor = blendSoftLight(color, vec3(g));","gl_FragColor.rgb = mix(color, noiseColor, noiseAlpha);","} else {","gl_FragColor.rgb = color;","}","gl_FragColor.a = 1.0;","}"].join("\n")},d.BackgroundShader={uniforms:{devicePixelRatio:{value:window.devicePixelRatio},time:{value:0},resolution:{value:null},textureMaps:{value:[]}},vertexShader:"void main(){ gl_Position = vec4(position, 1.0); }",cloudsFS:"        // include.glsl\n        #define gl_FragCoord (gl_FragCoord / devicePixelRatio)\n        uniform float devicePixelRatio;\n        uniform float time;\n        uniform vec2 resolution;\n        uniform sampler2D textureMaps[4];\n        //\n        #define iChannel0 textureMaps[0]\n        # define T texture2D(iChannel0, fract((s*p.zw + ceil(s*p.x)) / 200.0)).y / (s += s) * 4.0\n        const vec3 skyColor = vec3(0.360, 0.650, 0.792); // 0x5ca6ca\n        const vec3 cloudColor = vec3(0.2, 0.301, 0.501); // 0x334d80\n        const vec3 lightColor = vec3(1.0); // 0xffffff\n        const float speed = 1.0;\n        void mainImage( out vec4 fragColor, in vec2 fragCoord ) {\n            vec4 p, d = vec4(0.8, 0, fragCoord / resolution.y - 0.65);\n            vec3 out1 = skyColor - d.w; // sky gradient\n            float s, f, t = 200.0 + sin(dot(fragCoord, fragCoord));\n            const float MAX_ITER = 100.0;\n            for (float i = 1.0; i <= MAX_ITER; i += 1.0) {\n            t -= 2.0; if (t < 0.0) { break; } // march step\n            p = 0.05 * t * d;\n            p.xz += time * 0.50000 * speed; // movement through space\n            p.x += sin(time * 0.25 * speed) * 0.25;\n            s = 2.0;\n            f = p.w + 1.0-T-T-T-T;\n            if (f < 0.0) {\n                vec3 cloudShading = mix(lightColor, cloudColor, -f);\n                out1 = mix(out1, cloudShading, -f * 0.4);\n            }\n            }\n            fragColor = vec4(out1, 1.0);\n        }\n        void main() {\n            gl_FragDepth = 1.0;\n            mainImage( gl_FragColor, gl_FragCoord.xy );\n        }\n    ",cellsFS:"        // include.glsl\n        #define gl_FragCoord (gl_FragCoord / devicePixelRatio)\n        uniform float devicePixelRatio;\n        uniform float time;\n        uniform vec2 resolution;\n        uniform sampler2D textureMaps[4];\n        //\n        const vec3 color1 = vec3(0, 0.549, 0.549);\n        const vec3 color2 = vec3(0.949, 0.905, 0.207);\n        const float size = 1.5;\n        float length2(vec2 p) { return dot(p, p); }\n        float noise(vec2 p){\n            return fract(sin(fract(sin(p.x) * (43.13311)) + p.y) * 31.0011);\n        }\n        float worley(vec2 p) {\n            float d = 1e30;\n            for (int xo = -1; xo <= 1; ++xo) {\n                for (int yo = -1; yo <= 1; ++yo) {\n                    vec2 tp = floor(p) + vec2(xo, yo);\n                    d = min(d, length2(p - tp - vec2(noise(tp))));\n                }\n            }\n            vec2 uv = gl_FragCoord.xy / resolution.xy;\n            float timeOffset =  0.15 * sin(time * 2.0 + 10.0*(uv.x - uv.y));\n            return 3.0*exp(-4.0*abs(2.0*d - 1.0 + timeOffset));\n        }\n        float fworley(vec2 p) {\n            return sqrt(sqrt(sqrt(\n            1.1 * // light\n            worley(p*5. + .3 + time*.0525) *\n            sqrt(worley(p * 50. / size + 0.3 + time * -0.15)) *\n            sqrt(sqrt(worley(p * -10. + 9.3))))));\n        }\n        void main() {\n            vec2 uv = gl_FragCoord.xy / resolution.xy;\n            float t = fworley(uv * resolution.xy / 1500.0);\n            t *= exp(-length2(abs(0.7*uv - 1.0)));\n            float tExp = pow(t, 0.5 - t);\n            vec3 c1 = color1 * (1.0 - t);\n            vec3 c2 = color2 * tExp;\n            gl_FragColor = vec4(pow(t, 1.0 - t) * (c1 + c2), 1.0);\n            gl_FragDepth = 1.0;\n        }\n    ",fogFS:"        // include.glsl\n        #define gl_FragCoord (gl_FragCoord / devicePixelRatio)\n        uniform float devicePixelRatio;\n        uniform float time;\n        uniform vec2 resolution;\n        uniform sampler2D textureMaps[4];\n        //\n        const vec3 baseColor = vec3(1.0, 0.921, 0.921);\n        const vec3 lowlightColor = vec3(0.176, 0.0, 1.0);\n        const vec3 midtoneColor = vec3(1.0, 0.121, 0.0);\n        const vec3 highlightColor = vec3(1.0, 0.764, 0.0);\n        const float blurFactor = 0.21;//0.6;\n        const float zoom = 1.0;\n        float random (in vec2 uv) {\n            return fract(sin(dot(uv.xy,vec2(12.9898,78.233)))*43758.5453123);\n        }\n        float noise (in vec2 uv) {\n            vec2 i = floor(uv);\n            vec2 f = fract(uv);\n            // Four corners in 2D of a tile\n            float a = random(i);\n            float b = random(i + vec2(1.0, 0.0));\n            float c = random(i + vec2(0.0, 1.0));\n            float d = random(i + vec2(1.0, 1.0));\n            vec2 u = f * f * (3.0 - 2.0 * f);\n            return mix(a, b, u.x) +\n                    (c - a)* u.y * (1.0 - u.x) +\n                    (d - b) * u.x * u.y;\n        }\n        #define NUM_OCTAVES 6\n        float fbm( in vec2 uv ) {\n            float v = 0.0;\n            float a = blurFactor;\n            vec2 shift = vec2(100.0);\n            // Rotate to reduce axial bias\n            mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));\n            for (int i = 0; i < NUM_OCTAVES; ++i) {\n                v += a * noise(uv);\n                uv = rot * uv * 2.0 + shift;\n                a *= (1. - blurFactor);\n            }\n            return v;\n        }\n        void main() {\n            vec2 st = gl_FragCoord.xy / resolution.xy*3.;\n            st.x *= 0.7 * resolution.x / resolution.y ; // Still keep it more landscape than square\n            st *= zoom;\n            // st += st * abs(sin(time*0.1)*3.0);\n            vec3 color = vec3(0.0);\n            vec2 q = vec2(0.);\n            q.x = fbm( st + 0.00*time);\n            q.y = fbm( st + vec2(1.0));\n            vec2 dir = vec2(0.15,0.126);\n            vec2 r = vec2(0.);\n            r.x = fbm( st + 1.0*q + vec2(1.7,9.2)+ dir.x*time );\n            r.y = fbm( st + 1.0*q + vec2(8.3,2.8)+ dir.y*time);\n            float f = fbm(st+r);\n            color = mix(baseColor, lowlightColor, clamp((f*f)*4.0,0.0,1.0));\n            color = mix(color, midtoneColor, clamp(length(q),0.0,1.0));\n            color = mix(color, highlightColor, clamp(length(r.x),0.0,1.0));\n            vec3 finalColor = mix(baseColor, color, f*f*f+.6*f*f+.5*f);\n            gl_FragColor = vec4(finalColor,1.0);\n            gl_FragDepth = 1.0;\n        }\n    ",sunsetFS:"        // include.glsl\n        #define gl_FragCoord (gl_FragCoord / devicePixelRatio)\n        uniform float devicePixelRatio;\n        uniform float time;\n        uniform vec2 resolution;\n        uniform sampler2D textureMaps[4];\n        //\n        float rand(float x) { return fract(sin(x) * 71523.5413291); }\n        float rand(vec2 x) { return rand(dot(x, vec2(13.4251, 15.5128))); }\n        float noise(vec2 x)\n        {\n            vec2 i = floor(x);\n            vec2 f = x - i;\n            f *= f*(3.-2.*f);\n            return mix(mix(rand(i), rand(i+vec2(1,0)), f.x), mix(rand(i+vec2(0,1)), rand(i+vec2(1,1)), f.x), f.y);\n        }\n        float fbm(vec2 x)\n        {\n            float r = 0.0, s = 1.0, w = 1.0;\n            for (int i=0; i<5; i++) {\n                s *= 2.0;\n                w *= 0.5;\n                r += w * noise(s * x);\n            }\n            return r;\n        }\n        float cloud(vec2 uv, float scalex, float scaley, float density, float sharpness, float speed)\n        {\n            return pow(saturate(fbm(vec2(scalex,scaley)*(uv+vec2(speed,0)*time))-(1.0-density)), 1.0-sharpness);\n        }\n        vec3 render(vec2 uv)\n        {\n            // sky\n            vec3 color = mix(vec3(1.0,0.831,0.650), vec3(0.8,0.921,1.0), uv.y);\n            // sun\n            vec2 spos = uv - vec2(0.1, 0.4);\n            float sun = exp(-20.*dot(spos,spos));\n            vec3 scol = vec3(1.0,0.607,0.4) * sun * 0.7;\n            color += scol;\n            // clouds\n            vec3 cl1 = mix(vec3(0.592,0.541,0.6), vec3(0.650,0.749,0.878),uv.y);\n            float d1 = mix(0.9,0.1,pow(uv.y, 0.7));\n            color = mix(color, cl1, cloud(uv,2.,8.,d1,0.4,0.04));\n            color = mix(color, vec3(0.9), 8.*cloud(uv,14.,18.,0.9,0.75,0.02) * cloud(uv,2.,5.,0.6,0.15,0.01)*uv.y);\n            color = mix(color, vec3(0.8), 5.*cloud(uv,12.,15.,0.9,0.75,0.03) * cloud(uv,2.,8.,0.5,0.0,0.02)*uv.y);\n            // post\n            color *= vec3(1.0,0.93,0.81)*1.04;\n            color = mix(0.75*vec3(1.0,0.803,0.631), color, smoothstep(-0.1,0.3,uv.y));\n            color = pow(color,vec3(1.3));\n            return color;\n        }\n        void main() {\n            vec2 uv = gl_FragCoord.xy / resolution.xy;\n            uv.x -= 0.5;\n            uv.x *= resolution.x / resolution.y;\n            gl_FragColor = vec4(render(uv), 1.0);\n            gl_FragDepth = 1.0;\n        }\n    "};var y=r(7);d.imageElementToData=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height)},d.imageDataToElement=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width,t.height=e.height,r.putImageData(e,0,0);var n=new Image;return n.src=t.toDataURL(),n.width=e.width,n.height=e.height,n},d.imageElementToDataURL=function(e){return THREE.ImageUtils.getDataURL(e)},d.imageFileToDataURL=function(e,t){(new THREE.TextureLoader).load(e,function(e){var r=d.imageElementToDataURL(e.image);t&&t(r)})},d.imageFileToData=function(e,t){(new THREE.TextureLoader).load(e,function(e){var r=d.imageElementToData(e.image);t&&t(r)})},d.imageDataToFile=function(e,t,r){r=void 0!==r&&r;var n=document.createElement("canvas"),i=n.getContext("2d");n.width=e.width,n.height=e.height,!1===r?i.putImageData(e,0,0):(i.putImageData(e,0,0),i.scale(1,-1),i.translate(0,-e.height),i.drawImage(n,0,0),i.setTransform(1,0,0,1,0,0)),n.toBlob(function(e){Object(y.saveAs)(e,t)})},d.loadImageBase64=function(e,t){var r=new Image;r.src=e,r.onload=function(){t&&t(r)}},d.getPixelColor=function(e,t,r){var n=4*(t+e.width*r),i=e.data;return{r:i[n],g:i[n+1],b:i[n+2],a:i[n+3]}},d.setPixelColor=function(e,t,r,n){var i=4*(r+t.width*n),a=t.data;a[i]=e[0],a[i+1]=e[1],a[i+2]=e[2],a[i+3]=e[3]},d.invertImage=function(e){for(var t=e.data,r=0;r<t.length;r+=4)t[r]=255-t[r],t[r+1]=255-t[r+1],t[r+2]=255-t[r+2]},d.grayScaleImage=function(e){for(var t=e.data,r=0;r<t.length;r+=4){var n=(t[r]+t[r+1]+t[r+2])/3;t[r]=n,t[r+1]=n,t[r+2]=n}},d.imageProcessing=function(e,t,r,n){r=r||{};new Promise(function(e){"DitheringShader"===t?(new THREE.TextureLoader).load("images/noise8.png",function(t){e(t)}):e(1)}).then(function(i){var a=e,o=a.image.width,s=a.image.height,l=d[t],c=new THREE.ShaderPass(l,"not_used");switch(c.uniforms.tDiffuse.value=a,t){case"DitheringShader":c.uniforms.tNoise.value=i;break;case"GaussianBlurShader":c.uniforms.resolution.value.set(1/o,1/s),c.uniforms.strength.value=r.strength||3.5,c.uniforms.horizontalPass.value=0;break;case"EdgeDetectionShader":c.uniforms.resolution.value.set(1/o,1/s);break;case"EdgeDetection2Shader":c.uniforms.resolution.value.set(1/o,1/s),c.material.defines.EDGE_FUNC=r.edgeFunc||"edge";break;case"VignetteShader":c.uniforms.offset.value=r.offset||1,c.uniforms.darkness.value=r.darkness||1;break;case"FilmGrainShader":c.uniforms.aspectCorrection.value=r.aspectCorrection||!1,c.uniforms.aspect.value=r.aspect||1,c.uniforms.grainScale.value=r.grainScale||.005,c.uniforms.grainTime.value=r.grainTime||0,c.uniforms.noiseAlpha.value=r.noiseAlpha||.25,c.uniforms.offset.value.copy(r.offset||new THREE.Vector2(0,0)),c.uniforms.scale.value.copy(r.scale||new THREE.Vector2(1,1)),c.uniforms.smoothEdge.value.copy(r.smoothEdge||new THREE.Vector2(0,1)),c.uniforms.color1.value.copy(new THREE.Color(r.color1||16777215)),c.uniforms.color2.value.copy(new THREE.Color(r.color2||2635844))}var u=new THREE.EffectComposer(d.renderer);if(u.addPass(c),"GaussianBlurShader"===t){var h=d[t],p=new THREE.ShaderPass(h,"tDiffuse");p.uniforms.resolution.value.copy(c.uniforms.resolution.value),p.uniforms.strength.value=c.uniforms.strength.value,p.uniforms.horizontalPass.value=1,u.addPass(p)}if(u.setSize(o,s),u.render(),n){var f=new Image(o,s);f.onload=function(){var e=new THREE.Texture(f);e.needsUpdate=!0,n&&n(e)};var m=d.renderer.domElement.toDataURL();f.src=m}})},d.imageFileProcessing=function(e,t,r){(new THREE.TextureLoader).load(e,function(e){var n=e.image.width,i=e.image.height;d.imageProcessing(e,t,r,function(e){var t=void 0===r.showImage||r.showImage,a=void 0===r.saveImage||r.saveImage;if(t&&d.add(d.createPrimitive({geometry:{type:"PlaneBufferGeometry",parameters:[10,10]},material:{type:"MeshBasicMaterial",map:e}})),a){var o=d.renderer.context,s=new Uint8Array(n*i*4);o.readPixels(0,0,n,i,o.RGBA,o.UNSIGNED_BYTE,s);var l=new ImageData(new Uint8ClampedArray(s),n,i),c=document.createElement("canvas"),u=c.getContext("2d");c.width=l.width,c.height=l.height,u.putImageData(l,0,0),u.scale(1,-1),u.translate(0,-l.height),u.drawImage(c,0,0),u.setTransform(1,0,0,1,0,0),c.toBlob(function(e){Object(y.saveAs)(e,"image.png")})}})})},d.screenCapture=function(e,t){e=void 0!==e?e:"capture.png",t=void 0===t||t;var r=d.appWorks.renderer;if(r.preserveDrawingBuffer=!0,d.appWorks.composer?d.appWorks.composer.render():d.appWorks.renderScene(),!0===t)r.domElement.toBlob(function(t){Object(y.saveAs)(t,e)});else{var n=e.split(".").pop().toLowerCase();"jpg"===n&&(n="jpeg"),function(e,t){var r=document.createElement("a");document.body.appendChild(r),r.download=t,r.href=e,r.target="_blank",r.click(),document.body.removeChild(r)}(r.domElement.toDataURL("image/"+n),e)}r.preserveDrawingBuffer=!1};var E=r(2);THREE.ShaderChunk.begin_vertex=["#ifndef INSTANCE_TRANSFORM","vec3 transformed = vec3( position );","#else","#ifndef INSTANCE_MATRIX","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","vec3 transformed = ( _instanceMatrix * vec4( position , 1. )).xyz;","#endif"].join("\n"),THREE.ShaderChunk.color_fragment=["#ifdef USE_COLOR","diffuseColor.rgb *= vColor;","#endif","#if defined(INSTANCE_COLOR)","diffuseColor.rgb *= vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_pars_fragment=["#ifdef USE_COLOR","varying vec3 vColor;","#endif","#if defined( INSTANCE_COLOR )","varying vec3 vInstanceColor;","#endif"].join("\n"),THREE.ShaderChunk.color_vertex=["#ifdef USE_COLOR","vColor.xyz = color.xyz;","#endif","#if defined( INSTANCE_COLOR ) && defined( INSTANCE_TRANSFORM )","vInstanceColor = instanceColor;","#endif"].join("\n"),THREE.ShaderChunk.defaultnormal_vertex=["#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","#ifndef INSTANCE_TRANSFORM","vec3 transformedNormal = normalMatrix * objectNormal;","#else","#ifndef INSTANCE_MATRIX ","mat4 _instanceMatrix = getInstanceMatrix();","#define INSTANCE_MATRIX","#endif","#ifndef INSTANCE_UNIFORM","vec3 transformedNormal =  transposeMat3( inversemat( mat3( modelViewMatrix * _instanceMatrix ) ) ) * objectNormal ;","#else","vec3 transformedNormal = ( modelViewMatrix * _instanceMatrix * vec4( objectNormal , 0.0 ) ).xyz;","#endif","#endif"].join("\n"),THREE.ShaderChunk.uv_pars_vertex=["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )","varying vec2 vUv;","uniform mat3 uvTransform;","#endif","#ifdef INSTANCE_TRANSFORM","mat3 inversemat(mat3 m) {","float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];","float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];","float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];","float b01 = a22 * a11 - a12 * a21;","float b11 = -a22 * a10 + a12 * a20;","float b21 = a21 * a10 - a11 * a20;","float det = a00 * b01 + a01 * b11 + a02 * b21;","return mat3(b01, (-a22 * a01 + a02 * a21), ( a12 * a01 - a02 * a11),","b11, ( a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),","b21, (-a21 * a00 + a01 * a20), ( a11 * a00 - a01 * a10)) / det;","}","attribute vec3 instancePosition;","attribute vec4 instanceQuaternion;","attribute vec3 instanceScale;","#if defined( INSTANCE_COLOR )","attribute vec3 instanceColor;","varying vec3 vInstanceColor;","#endif","mat4 getInstanceMatrix(){","vec4 q = instanceQuaternion;","vec3 s = instanceScale;","vec3 v = instancePosition;","vec3 q2 = q.xyz + q.xyz;","vec3 a = q.xxx * q2.xyz;","vec3 b = q.yyz * q2.yzz;","vec3 c = q.www * q2.xyz;","vec3 r0 = vec3( 1.0 - (b.x + b.z) , a.y + c.z , a.z - c.y ) * s.xxx;","vec3 r1 = vec3( a.y - c.z , 1.0 - (a.x + b.z) , b.y + c.x ) * s.yyy;","vec3 r2 = vec3( a.z + c.y , b.y - c.x , 1.0 - (a.x + b.x) ) * s.zzz;","return mat4(","r0 , 0.0,","r1 , 0.0,","r2 , 0.0,","v  , 1.0",");","}","#endif"].join("\n"),d.DEPTH_MATERIAL=new THREE.MeshDepthMaterial,d.DEPTH_MATERIAL.depthPacking=THREE.RGBADepthPacking,d.DEPTH_MATERIAL.clipping=!0,d.DEPTH_MATERIAL.defines={INSTANCE_TRANSFORM:""},d.DISTANCE_MATERIAL=new THREE.ShaderMaterial({defines:{USE_SHADOWMAP:"",INSTANCE_TRANSFORM:""},uniforms:THREE.UniformsUtils.clone(THREE.ShaderLib.distanceRGBA.uniforms),vertexShader:THREE.ShaderLib.distanceRGBA.vertexShader,fragmentShader:THREE.ShaderLib.distanceRGBA.fragmentShader,clipping:!0}),d.InstancedMesh=function(e,t,r,n,i,a){void 0!==arguments[0]&&arguments[0].isObject3D?this.fromObject(arguments[0]):this.create(e,t,r,n,i,a),this.isInstancedMesh=!0,this.userData.type="InstancedMesh"},d.InstancedMesh.prototype=Object.create(THREE.Mesh.prototype),d.InstancedMesh.prototype.constructor=d.InstancedMesh,d.InstancedMesh.prototype.create=function(e,t,r,n,i,a){THREE.Mesh.call(this,(new THREE.InstancedBufferGeometry).copy(e)),this.numInstances=void 0!==r?r:1,this.dynamic=void 0!==n&&n,this.colors=void 0!==i&&i,this.uniformScale=void 0===a||a,this._setAttributes(),this.material=t.clone(),this.customDepthMaterial=d.DEPTH_MATERIAL,this.customDistanceMaterial=d.DISTANCE_MATERIAL,this.frustumCulled=!1,this.name="instancedMesh";var o=this.userData;o.numInstances=this.numInstances,o.dynamic=this.dynamic,o.colors=this.colors,o.uniformScale=this.uniformScale},Object.defineProperties(d.InstancedMesh.prototype,{material:{set:function(e){(e=e.clone()).defines?(e.defines.INSTANCE_TRANSFORM="",this.uniformScale?e.defines.INSTANCE_UNIFORM="":delete e.defines.INSTANCE_UNIFORM,this.colors?e.defines.INSTANCE_COLOR="":delete e.defines.INSTANCE_COLOR):(e.defines={INSTANCE_TRANSFORM:""},this.uniformScale&&(e.defines.INSTANCE_UNIFORM=""),this.colors&&(e.defines.INSTANCE_COLOR="")),this._material=e},get:function(){return this._material}},numInstances:{set:function(e){this._numInstances=e,this._setAttributes()},get:function(){return this._numInstances}},geometry:{set:function(e){e.attributes.instancePosition?(this._geometry=new THREE.InstancedBufferGeometry,this._setAttributes()):this._geometry=e},get:function(){return this._geometry}}}),d.InstancedMesh.prototype.setPositionAt=function(e,t){this.geometry.attributes.instancePosition.setXYZ(e,t.x,t.y,t.z)},d.InstancedMesh.prototype.setQuaternionAt=function(e,t){this.geometry.attributes.instanceQuaternion.setXYZW(e,t.x,t.y,t.z,t.w)},d.InstancedMesh.prototype.setScaleAt=function(e,t){this.geometry.attributes.instanceScale.setXYZ(e,t.x,t.y,t.z)},d.InstancedMesh.prototype.setColorAt=function(e,t){this.colors?this.geometry.attributes.instanceColor.setXYZ(e,Math.floor(255*t.r),Math.floor(255*t.g),Math.floor(255*t.b)):console.warn("JAMIE.InstancedMesh: color not enabled")},d.InstancedMesh.prototype.getPositionAt=function(e,t){var r=this.geometry.attributes.instancePosition.array;return e*=3,t?t.set(r[e++],r[e++],r[e]):new THREE.Vector3(r[e++],r[e++],r[e])},d.InstancedMesh.prototype.getQuaternionAt=function(e,t){var r=this.geometry.attributes.instanceQuaternion.array;return e<<=2,t?t.set(r[e++],r[e++],r[e++],r[e]):new THREE.Quaternion(r[e++],r[e++],r[e++],r[e])},d.InstancedMesh.prototype.getScaleAt=function(e,t){var r=this.geometry.attributes.instanceScale.array;return e*=3,t?t.set(r[e++],r[e++],r[e]):new THREE.Vector3(r[e++],r[e++],r[e])},d.InstancedMesh.prototype.getColorAt=function(e,t){if(!this.colors)return console.warn("JAMIE.InstancedMesh: color not enabled"),!1;var r=this.geometry.attributes.instanceColor.array;return e*=3,t?t.setRGB(r[e++]*(1/255),r[e++]*(1/255),r[e]*(1/255)):new THREE.Vector3(r[e++],r[e++],r[e]).multiplyScalar(1/255)},d.InstancedMesh.prototype.needsUpdate=function(e){switch(e){case"position":this.geometry.attributes.instancePosition.needsUpdate=!0;break;case"quaternion":this.geometry.attributes.instanceQuaternion.needsUpdate=!0;break;case"scale":this.geometry.attributes.instanceScale.needsUpdate=!0;break;case"colors":this.geometry.attributes.instanceColor.needsUpdate=!0;break;default:this.geometry.attributes.instancePosition.needsUpdate=!0,this.geometry.attributes.instanceQuaternion.needsUpdate=!0,this.geometry.attributes.instanceScale.needsUpdate=!0,this.colors&&(this.geometry.attributes.instanceColor.needsUpdate=!0)}},d.InstancedMesh.prototype._setAttributes=function(){this.geometry.addAttribute("instancePosition",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0)),this.geometry.addAttribute("instanceQuaternion",new THREE.InstancedBufferAttribute(new Float32Array(4*this.numInstances),4,!0)),this.geometry.addAttribute("instanceScale",new THREE.InstancedBufferAttribute(new Float32Array(3*this.numInstances),3,!0)),this.geometry.attributes.instancePosition.dynamic=this.dynamic,this.geometry.attributes.instanceQuaternion.dynamic=this.dynamic,this.geometry.attributes.instanceScale.dynamic=this.dynamic,this.colors&&(this.geometry.addAttribute("instanceColor",new THREE.InstancedBufferAttribute(new Uint8Array(3*this.numInstances),3,!0)),this.geometry.attributes.instanceColor.normalized=!0,this.geometry.attributes.instanceColor.dynamic=this.dynamic)},d.InstancedMesh.prototype.fromObject=function(e){var t=e.geometry.clone();delete t.attributes.instanceColor,delete t.attributes.instancePosition,delete t.attributes.instanceQuaternion,delete t.attributes.instanceScale;var r=e.userData;this.create(t,e.material,r.numInstances,r.dynamic,r.colors,r.uniformScale);var n=this.geometry.attributes,i=e.geometry.attributes;n.instancePosition.copy(i.instancePosition),n.instanceQuaternion.copy(i.instanceQuaternion),n.instanceScale.copy(i.instanceScale),i.instanceColor&&n.instanceColor.copy(i.instanceColor)},d.InstancedMesh.prototype.toJSON=function(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)},d.InstancedMesh.prototype.clone=function(){var e=new d.InstancedMesh(this);return d.copyTransform(e,this),e},d.InstancedMesh.prototype.decompose=function(e){for(var t=[],r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3,a=new THREE.Color,o=this.material,s=this.geometry.attributes,l=s.instancePosition,c=s.instanceQuaternion,u=s.instanceScale,h=s.instanceColor,d=l.count,p=0;p<d;p++){r.fromArray(l.array,3*p),n.fromArray(c.array,4*p),i.fromArray(u.array,3*p);var f=new THREE.BufferGeometry;Object.keys(s).forEach(e=>{var t=s[e];t instanceof THREE.BufferAttribute&&f.addAttribute(e,t.clone())});var m=o;h&&(a.fromArray(h.array,3*p),a.multiplyScalar(1/255),(m=o.clone()).color.copy(a));var v=new THREE.Mesh(f,m);v.position.copy(r),v.quaternion.copy(n),v.scale.copy(i),t.push(v)}e&&e(t)},d.CSGBoolean=function(e,t,r){t=t||"union";var n=new ThreeBSP(e),i=new ThreeBSP(r);"union"===t||"+"===t?n=n.union(i):"intersect"===t||"*"===t?n=n.intersect(i):"subtract"!==t&&"-"!==t||(n=n.subtract(i));var a=null;return e instanceof THREE.Mesh?a=n.toMesh(null):e instanceof THREE.BufferGeometry?a=n.toNonIndexedBufferGeometry():e instanceof THREE.Geometry&&(a=n.toGeometry()),a},d.union=function(e,t){return d.CSGBoolean(e,"+",t)},d.intersect=function(e,t){return d.CSGBoolean(e,"*",t)},d.subtract=function(e,t){return d.CSGBoolean(e,"-",t)},d.createWireframe=function(e,t,r){var n;t=void 0!==t?t:0,r=void 0!==r&&r;(i=e.material).polygonOffset=!0,i.polygonOffsetFactor=1,i.polygonOffsetUnits=1,i.needsUpdate=!0,n=r?new THREE.EdgesGeometry(e.geometry):new THREE.WireframeGeometry(e.geometry);var i=new THREE.LineBasicMaterial({color:t,linewidth:2});return new THREE.LineSegments(n,i)},d.createVertexPoints=function(e,t,r,n){var i=d.getObjectSize(e);t=t||i/100,r=r||16777215,n=n||!0;return new THREE.Points(e.geometry,new THREE.PointsMaterial({map:(new THREE.TextureLoader).load("images/sprites/ball.png"),size:t,color:r,depthTest:n,transparent:!0}))},d.TextSprite=function(e,t){t=t||{};var r={};r.string=e||"",r.height=t.textHeight||.5,r.widthScale=t.textWidthScale||1,r.color=t.textColor||"#ffffff",r.align=t.textAlign||"center",r.baseline=t.textBaseline||"middle",this.text=r;var n={};n.style=t.fontStyle||"normal",n.variant=t.fontVariant||"normal",n.weight=t.fontWeight||"normal",n.size=t.fontSize||"64px",n.family=t.fontFamily||"Karla, sans-serif",this.font=n;var i=document.createElement("canvas");i.height=parseInt(n.size),i.width=i.height*r.string.length;var a=i.getContext("2d");a.font=n.style+" "+n.variant+" "+n.weight+" "+n.size+" "+n.family,a.textAlign=r.align,a.textBaseline=r.baseline,a.fillStyle=d.toHexStyle(r.color),a.fillText(r.string,i.width/2,i.height/2),this.ctx=a;var o=new THREE.CanvasTexture(this.ctx.canvas),s=new THREE.SpriteMaterial({color:16777215,map:o});THREE.Sprite.call(this,s),this.type="TextSprite";var l=r.height*r.string.length*r.widthScale;this.scale.set(l,r.height,1)},d.TextSprite.prototype=Object.assign(Object.create(THREE.Sprite.prototype),{constructor:d.TextSprite,isTextSprite:!0,copy:function(e){return THREE.Sprite.prototype.copy.call(this,e),this.text=JSON.parse(JSON.stringify(e.text)),this.font=JSON.parse(JSON.stringify(e.font)),this.ctx.drawImage(e.ctx.canvas,0,0),this},clone:function(){return new this.constructor(this.text.string).copy(this)},updateText:function(e){var t=this.ctx.canvas,r=this.ctx,n=this.text,i=this.font;n.string=e||"",t.height=parseInt(i.size),t.width=t.height*n.string.length,r.font=i.style+" "+i.variant+" "+i.weight+" "+i.size+" "+i.family,r.textAlign=n.align,r.textBaseline=n.baseline,r.fillStyle=d.toHexStyle(n.color),r.fillText(n.string,t.width/2,t.height/2);var a=n.height*n.string.length*n.widthScale;this.scale.set(a,n.height,1),this.material.map.needsUpdate=!0}}),d.createTextSprite=function(e,t){return new d.TextSprite(e,t)},d.addTextMesh=function(e,t){e=e||"text",(t=t||{}).position=t.position||{x:0,y:0,z:0},t.color=t.color||16777215,t.height=t.height||1,t.thickRatio=t.thickRatio||.25,t.alignment=t.alignment||1,t.rotSpeed=t.rotSpeed||0,t.fontFile=t.fontFile||"fonts/gentilis_regular.typeface.json",(new THREE.FontLoader).load(t.fontFile,function(r){var n=new THREE.MeshPhongMaterial({color:t.color,specular:t.color}),i=new THREE.TextBufferGeometry(e,{font:r,size:100,height:100*t.thickRatio,curveSegments:12,bevelEnabled:!0,bevelThickness:2,bevelSize:5,bevelSegments:3});i.computeBoundingBox();var a=(i.boundingBox.max.x-i.boundingBox.min.x)*t.alignment/2,o=(new THREE.Matrix4).makeTranslation(-a,0,0);i.applyMatrix(o);var s=new THREE.Mesh(i,n);s.scale.setScalar(t.height/100),s.position.set(t.position.x,t.position.y,t.position.z),s.castShadow=!0,s.receiveShadow=!0,s.name=e,0!==t.rotSpeed&&(s.update=function(e,r){this.rotation.y+=t.rotSpeed*e}),d.add(s)})},d.createPrimitive=function(e){var t=new THREE[e.geometry.type](...e.geometry.parameters),r=e.material.type;delete e.material.type;var n=new THREE[r](e.material);e.material.type=n.type;var i=new THREE.Mesh(t,n),a=t.type.replace("Buffer","").replace("Geometry",""),o=n.type.replace("Mesh","").replace("Material","");return i.name=a+o,i.frustumCulled=!1,i.castShadow=!0,i.receiveShadow=!0,i},d.createStructuredMesh=function(e,t){t=t||{};var r=d.toNonIndexedBufferGeometry(e.geometry),n=e.material,i=d.structuredPositions(t),a=i.length/3;if(0!==a){t.numInstances=a;var o=d.randomColors(t);0===o.length&&(o=void 0);var s=new d.InstancedMesh(r,n,a,!1,!!o,!0);s.name="structuredMesh",s.frustumCulled=!1,d.copyTransform(s,e);for(var l=new THREE.Vector3,c=new THREE.Quaternion(0,0,0,1),u=new THREE.Vector3(1,1,1),h=new THREE.Color,p=0,f=0;p<a;p++,f+=3)l.fromArray(i,f),s.setPositionAt(p,l),s.setQuaternionAt(p,c),s.setScaleAt(p,u),void 0!==o&&(h.fromArray(o,f),s.setColorAt(p,h));return s}},d.createScatteredMesh=function(e,t){t=t||{};var r=d.toNonIndexedBufferGeometry(e.geometry),n=e.material,i=d.scatteredPositions(t),a=i.positions,o=i.rotations,s=i.scales,l=a.length/3;if(0!==l){var c=d.randomColors(t);0===c.length&&(c=void 0);var u=new d.InstancedMesh(r,n,l,!1,!!c,!0);u.name="scatteredMesh",u.frustumCulled=!1,d.copyTransform(u,e);for(var h=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Euler,m=new THREE.Quaternion(0,0,0,1),v=new THREE.Vector3(1,1,1),g=new THREE.Color,y=0,E=0;y<l;y++,E+=3)h.fromArray(a,E),void 0!==o&&(p.fromArray(o,E),f.setFromVector3(p),m.setFromEuler(f)),void 0!==s&&v.fromArray(s,E),u.setPositionAt(y,h),u.setQuaternionAt(y,m),u.setScaleAt(y,v),void 0!==c&&(g.fromArray(c,E),u.setColorAt(y,g));return u}},d.createInstancedMeshes=function(e,t){t=t||{};!1===Array.isArray(e)&&(e=[e]);for(var r,n=[],i=0,a=e.length;i<a;i++)r=void 0!==t.pattern?d.createStructuredMesh(e[i],t):d.createScatteredMesh(e[i],t),n.push(r);return 1===n.length?n[0]:n},d.createInstancedObject=function(e,t){if(void 0===t.seed&&(t.seed=e.id),e.isMesh)return d.createInstancedMeshes(e,t);var r=new THREE.Object3D;r.name=e.name;for(var n=e.children,i=0,a=n.length;i<a;i++){var o=d.createInstancedObject(n[i],t);r.add(o)}return d.copyTransform(r,e),r},d.tweenObject=function(e,t,r){var n=void 0!==(r=r||{}).duration?r.duration:1e3,i=new E.Tween(e).to(t,n);return void 0!==r.easing&&i.easing(r.easing),void 0!==r.interpolation&&i.interpolation(r.interpolation),void 0!==r.repeat&&i.repeat(r.repeat),void 0!==r.repeatDelay&&i.repeatDelay(r.repeatDelay),!0===r.yoyo&&i.yoyo(r.yoyo),void 0!==r.update&&i.onUpdate(e=>{r.update(e)}),void 0!==r.complete&&i.onComplete(e=>{r.complete(e)}),void 0!==r.start?i.start(r.start+(r.delay||0)):void 0!==r.delay&&i.delay(r.delay),i},d.tweenObjects=function(e,t,r){var n=new E.Group,i=r.delay,a=r.delay||0;return e.forEach((e,i)=>{void 0!==r.objectDelay&&(r.delay=a+i*r.objectDelay),n.add(d.tweenObject(e,t[i],r))}),r.delay=i,n},d.GridLOD=function(e){THREE.Object3D.apply(this),this.previousLodResolution=0,this.create(e,!1),this.name="gridLOD",this.frustumCulled=!1},d.GridLOD.prototype=Object.create(THREE.Object3D.prototype),d.GridLOD.prototype.constructor=Object.create(d.GridLOD),d.GridLOD.prototype.controlLODParameters=function(e,t){function r(e,t){return void 0!==e?e:t}void 0===e&&(e={}),(t=r(t,!1))?(this.lodResolution=r(e.resolution,this.lodResolution),this.lodLevels=r(e.levels,this.lodLevels),this.lodScale=r(e.scale,this.lodScale),this.lodMorphingLevels=r(e.morphingLevels,this.lodMorphingLevels),this.lodMaterial=r(e.material,this.lodMaterial)):(this.lodResolution=r(e.resolution,64),this.lodLevels=r(e.levels,8),this.lodScale=r(e.scale,1),this.lodMorphingLevels=r(e.morphingLevels,2),this.lodMaterial=r(e.material,void 0)),this.lodLevels=Math.max(1,Math.round(this.lodLevels)),this.lodScale=Math.max(1,this.lodScale),this.lodResolution=Math.max(1,this.lodResolution),this.lodResolution=Math.pow(2,Math.round(Math.log2(this.lodResolution))),this.lodMorphingLevels=Math.max(0,Math.min(2,Math.round(this.lodMorphingLevels))),this.previousLodResolution=this.lodResolution},d.GridLOD.prototype.createLODMaterial=function(){var e=d.GridLODShader,t=THREE.UniformsUtils.clone(e.uniforms);return t.u_resolution={value:this.lodResolution},t.u_level={value:this.lodLevels},t.u_scale={value:this.lodScale},t.u_morphingLevels={value:this.lodMorphingLevels},t.u_usePlaneParameters={value:0},t.u_planeUp={value:new THREE.Vector3(0,1,0)},t.u_planeAt={value:new THREE.Vector3(0,0,1)},t.u_planePoint={value:new THREE.Vector3(0,0,0)},t.u_planeDistance={value:0},new THREE.ShaderMaterial({uniforms:t,vertexShader:e.buildVertexShader("lod"),fragmentShader:e.fragmentShader,side:THREE.DoubleSide,wireframe:!1})},d.GridLOD.prototype.create=function(e,t){var r=this.previousLodResolution;if(this.controlLODParameters(e,t),!1===t&&(this.lodMaterial=this.createLODMaterial()),r!==this.lodResolution){for(this.gridGeometry=this.createLODGeometry(this.lodResolution),this.gridOutsideGeometry=this.createLODGeometry(this.lodResolution,!0);this.children.length>0;)this.remove(this.children[0]);this.lodMaterial.uniforms.u_resolution.value=this.lodResolution;for(var n=this.lodScale,i=0;i<this.lodLevels;i++){var a=0===i?this.gridGeometry:this.gridOutsideGeometry;this.add(this.createLODMesh(a,this.lodMaterial,n,i)),n*=2}}},d.GridLOD.prototype.createLODMesh=function(e,t,r,n){var i=t.clone();return i.uniforms.u_scale.value=r,i.uniforms.u_level.value=n,new THREE.Mesh(e,i)},d.GridLOD.prototype.createLODGeometry=function(e,t){function r(e,t){return void 0!==e?e:t}e=r(e,64),t=r(t,!1);var n=new THREE.BufferGeometry,i=Math.round(.5*e),a=(e+2)*(e+2)*2,o=new Float32Array(3*((e+3)*(e+3))),s=new(o.length/3>65535?Uint32Array:Uint16Array)(3*a);n.setIndex(new THREE.BufferAttribute(s,1)),n.addAttribute("position",new THREE.BufferAttribute(o,3));for(var l=0,c=-i-1;c<=i+1;c++)for(var u=-i-1;u<=i+1;u++)o[l]=c/e,o[l+1]=0,o[l+2]=u/e,l+=3;l=0;var h=e+3,d=e/4,p=3*d;for(c=0;c<=e+1;c++){var f=c,m=c+1,v=c>d&&c<=p;for(u=0;u<=e+1;u++){var g=u+1;if(!(t&&v&&(u>d&&u<=p))){var y=h*f+g,E=h*m+g,x=h*m+u,b=h*f+u;s[l]=y,s[l+1]=E,s[l+2]=b,s[l+3]=b,s[l+4]=E,s[l+5]=x,l+=6}}}return n},d.GridLOD.prototype.setLODScale=function(e){this.lodScale=e,this.controlLODParameters({},!0);var t=this.lodScale;this.children.forEach(e=>{e.material.uniforms.u_scale.value=t,t*=2})},d.GridLOD.prototype.setMorphingLevels=function(e){this.lodMorphingLevels=e,this.controlLODParameters({},!0),e=this.lodMorphingLevels,this.children.forEach(t=>{t.material.uniforms.u_morphingLevels.value=e})},d.GridLOD.prototype.setMaterialValue=function(e,t){this.lodMaterial[e]=t,this.children.forEach(r=>{r.material[e]=t})},d.GridLOD.prototype.setUniformValue=function(e,t){this.lodMaterial.uniforms[e].value=t,this.children.forEach(r=>{r.material.uniforms[e].value=t})},d.GridLOD.prototype.getUniformValue=function(e){return this.lodMaterial.uniforms[e].value},d.GridLOD.prototype.createParentCamera=function(){return this.parent instanceof THREE.PerspectiveCamera?this.parent:(this.parent=d.camera.clone(),this.parent.add(this),this.parent)},d.GridLOD.prototype.update=function(e,t){!0===this.getUniformValue("u_animate")&&this.setUniformValue("u_time",t)},d.createGridLOD=function(e,t,r,n){return new d.GridLOD({resolution:e,levels:t,scale:r,morphingLevels:n})},d.TerrainLOD=function(e,t,r,n,i){void 0!==arguments[0]&&arguments[0].isObject3D?this.fromObject(arguments[0]):this.create(e,t,r,n,i),this.userData.type="TerrainLOD"},d.TerrainLOD.prototype=Object.create(THREE.Object3D.prototype),d.TerrainLOD.prototype.constructor=d.TerrainLOD,d.TerrainLOD.prototype.create=function(e,t,r,n,i){THREE.Object3D.call(this),this.name="terrainLOD",this.frustumCulled=!1;var a=0,o=1,s=2,l=4,c=8,u=new THREE.TextureLoader;this.diffuse1=u.load("images/terrain/rockyTerrainGrass.jpg"),this.diffuse2=u.load("images/terrain/rockyTerrainDirt.jpg"),this.diffuse1.wrapS=this.diffuse1.wrapT=THREE.RepeatWrapping,this.diffuse2.wrapS=this.diffuse2.wrapT=THREE.RepeatWrapping;var h=this.userData;h.landscape=void 0!==e?e:"GIANT",h.worldWidth=void 0!==t?t:1024,h.levels=void 0!==r?r:4,h.resolution=void 0!==n?n:64,h.maxHeight=void 0!==i?i:.1*d.WORLD_SIZE,h.globalOffset=new THREE.Vector3(0,0,0),this.heightMap=this.getHeightMap(h.worldWidth,h.landscape),this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,h.resolution,h.resolution),this.tileGeometry.translate(.5,.5,0);var p=h.worldWidth/Math.pow(2,h.levels);this.createTile(-p,-p,p,a),this.createTile(-p,0,p,a),this.createTile(0,0,p,a),this.createTile(0,-p,p,a);for(var f=p;f<h.worldWidth;f*=2)this.createTile(-2*f,-2*f,f,l|s),this.createTile(-2*f,-f,f,s),this.createTile(-2*f,0,f,s),this.createTile(-2*f,f,f,o|s),this.createTile(-f,-2*f,f,l),this.createTile(-f,f,f,o),this.createTile(0,-2*f,f,l),this.createTile(0,f,f,o),this.createTile(f,-2*f,f,l|c),this.createTile(f,-f,f,c),this.createTile(f,0,f,c),this.createTile(f,f,f,o|c)},d.TerrainLOD.prototype.createTile=function(e,t,r,n){var i=this.createTileMaterial(new THREE.Vector2(e,t),r,n),a=new THREE.Mesh(this.tileGeometry,i);a.rotation.x=-Math.PI/2,a.frustumCulled=!1,a.castShadow=!1,a.receiveShadow=!0,this.add(a)},d.TerrainLOD.prototype.createTileMaterial=function(e,t,r){var n=this.userData,i=d.TerrainLODShader,a=THREE.UniformsUtils.clone(i.uniforms);a.tDiffuse1.value=this.diffuse1,a.tDiffuse2.value=this.diffuse2,a.worldWidth.value=parseFloat(n.worldWidth),a.tileResolution.value=parseFloat(n.resolution),a.edgeMorph.value=r,a.globalOffset.value=n.globalOffset,a.tileOffset.value=e,a.heightMap.value=this.heightMap,a.tileScale.value=parseFloat(t),a.maxHeight.value=n.maxHeight,a.winterSnow.value=!1,a.summerGreen.value=!1;var o={};d.isWebGL2()?o.texture2DLodEXT="textureLod":o.texture2DLodEXT="texture2DLod";var s=new THREE.ShaderMaterial({defines:o,uniforms:a,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,lights:!0,fog:void 0!==d.scene.fog});return s.extensions={derivatives:!0,shaderTextureLOD:!0},s},d.TerrainLOD.prototype.getHeightMap=function(e,t){var r,n,i,a,o,s,l=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Matrix3;r.elements=[.8,-.6,0,.6,.8,0,0,0,0];var n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0,s=0;s<5;s++){var l=Math.abs(t(n.x,n.y));i+=a*l/(1+(o+=l)*o*o),a*=.5,n.multiplyScalar(2).applyMatrix3(r)}return Math.pow(i,1)}}(),c=(r=new THREE.SimplexNoise,n=r.noise.bind(r),i=new THREE.Vector3(100,100,0),a=new THREE.Vector3,function(e){a.copy(e);for(var t=0,r=.5,o=0;o<5;o++)t+=r*Math.abs(n(a.x,a.y)),a.multiplyScalar(2).add(i),r*=.5;return Math.pow(.5*t+.5,2)}),u=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Vector3(100,100,0),n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0;o<2;o++)i+=a*Math.abs(t(n.x,n.y)),n.multiplyScalar(2).add(r),a*=.5;return Math.pow(i,1.5)}}(),h=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Vector3(100,100,0),n=new THREE.Vector3;return function(e){n.copy(e);for(var i=0,a=.5,o=0;o<5;o++){var s=1-Math.abs(t(n.x,n.y));i+=a*(s*s),n.multiplyScalar(2).add(r),a*=.5}return Math.pow(i,2)}}(),p=function(){var e=new THREE.Vector3;return function(t){var r=h(e.copy(t).multiplyScalar(9)),n=c(e.copy(t).multiplyScalar(2)),i=u(e.copy(t)),a=(i+=.25*i)/100;return d.mix(n,r,d.smoothstep(.45,.55,a))}}(),f=function(){var e=new THREE.SimplexNoise,t=e.noise.bind(e),r=new THREE.Matrix3,n=new THREE.Matrix3;r.elements=[.8,-.6,0,.6,.8,0,0,0,0],n.elements=[1.3623,1.7531,0,-1.7131,1.4623,0,0,0,0];var i=new THREE.Vector3,a=new THREE.Vector3;function o(e){i.copy(e);var n=0;return n+=.5*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.02).applyMatrix3(r),n+=.25*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.03).applyMatrix3(r),n+=.125*Math.abs(t(i.x,i.y)),i.multiplyScalar(2.01).applyMatrix3(r),(n+=.0625*Math.abs(t(i.x,i.y)))/.9375}return function(e){i.copy(e).multiplyScalar(5),a.copy(i).multiplyScalar(.25);var t=.75*o(a)+.25;t*=2*t;for(var r=0,s=0;s<5;s++)r+=t*o(i),t=.5*-t,i.applyMatrix3(n);a.copy(i).multiplyScalar(.002);var l=o(a);return r+=Math.pow(Math.abs(l),10),Math.pow(r,2)}}(),m=function(){function e(e){return Math.abs(function(e){return e-parseInt(e)}(e)-.5)}function t(t){return e(t.x+e(1.5*(t.y-.25)))+e(t.y-e(1.5*(t.x+.5)))}function r(e){return.25+.25*Math.cos(6.2831853*e)}function n(e){return r(e.x+r(1.5*(e.y-.25)))+r(e.y-r(1.5*(e.x+.5)))}var i=new THREE.Vector3,a=new THREE.Vector3;return function(e){i.copy(e).multiplyScalar(2);var r=.66*n(a.copy(i).divideScalar(2))+.34*n(a.copy(i));return.75*(r=.75*function(e){return(e=Math.max((e-.3)/.7,0))*e*(3-2*e)}(r)+.15*t(a.copy(i))+.1*t(a.copy(i).multiplyScalar(4)))}}(),v=(o=d.createFbmNoise({octaves:4,persistence:.5,noiseType:"simplex3d"}),function(e){return Math.abs(o(e.x,e.y,1))}),g=function(){var e=new THREE.ImprovedNoise,t=new THREE.Vector3;return function(r){t.copy(r);for(var n=0,i=.5,a=0;a<4;a++)n+=i*Math.abs(e.noise(t.x,t.y,0))*2.5,t.multiplyScalar(2),i*=.5;return Math.pow(n,2)}}();e=void 0!==e?e:1024;switch(t=void 0!==t?t:"GIANT"){case"BADLAND":s=l;break;case"MOUNTAIN":s=c;break;case"DOME":s=u;break;case"RIDGE":s=h;break;case"DESIGN":s=p;break;case"GIANT":s=f;break;case"TRIANGLE":s=m;break;case"GREAT":s=v;break;case"HUGE":s=g;break;default:s=f}var y=0,E=256,x=new THREE.Vector3,b=new Uint8Array(e*e);"GIANT"===t&&(E=512);for(var T=0;T<e;T++)for(var w=0;w<e;w++)x.x=w/E,x.y=T/E,b[y++]=256*s(x);var _=new THREE.DataTexture(b,e,e,THREE.RedFormat);return _.wrapS=THREE.MirroredRepeatWrapping,_.wrapT=THREE.MirroredRepeatWrapping,_.magFilter=THREE.LinearFilter,_.minFilter=THREE.LinearMipMapLinearFilter,_.generateMipmaps=!0,_.needsUpdate=!0,_},d.TerrainLOD.prototype.fromObject=function(e){var t=e.userData;this.create(t.landscape,t.worldWidth,t.levels,t.resolution,t.maxHeight)},d.TerrainLOD.prototype.toJSON=function(e){var t=this.clone();return THREE.Object3D.prototype.toJSON.call(t,e)},d.TerrainLOD.prototype.clone=function(){var e=new d.TerrainLOD(this);return d.copyTransform(e,this),e},d.TerrainLOD.prototype.updateVisible=function(e){d.appWorks.setValue(this,"visible",e)},d.TerrainLOD.prototype.updateResolution=function(e){this.userData.resolution=e,this.tileGeometry=new THREE.PlaneBufferGeometry(1,1,e,e);var t=new THREE.Matrix4;t.makeTranslation(.5,.5,0),this.tileGeometry.applyMatrix(t),this.children.forEach(t=>{t.material.uniforms.tileResolution=parseFloat(e)})},d.TerrainLOD.prototype.updateMaxHeight=function(e){this.userData.maxHeight=e,this.children.forEach(t=>{t.material.uniforms.maxHeight=e})},d.createTerrainLOD=function(e,t,r,n,i){return new d.TerrainLOD(e,t,r,n,i)},d.createHeightMapTerrain=function(e,t){var r=void 0!==t.highZoneFile?t.highZoneFile:"images/terrain/rockyTerrainGrass.jpg",n=void 0!==t.lowZoneFile?t.lowZoneFile:"images/terrain/rockyTerrainDirt.jpg",i=void 0!==t.worldWidth?t.worldWidth:1024,a=void 0!==t.resolution?t.resolution:1024,o=void 0!==t.tileOffset?t.tileOffset:new THREE.Vector2(0,0),s=void 0!==t.tileScale?t.tileScale:i,l=void 0!==t.maxHeight?t.maxHeight:.05*d.WORLD_SIZE,c=new THREE.PlaneBufferGeometry(1,1,a,a);c.translate(.5,.5,0);var u=function(t,i,a,o,s){var l=new THREE.TextureLoader,c=l.load(e);c.magFilter=THREE.LinearFilter,c.minFilter=THREE.LinearMipMapLinearFilter,c.generateMipmaps=!0,c.needsUpdate=!0;var u=l.load(r),h=l.load(n),p=d.TerrainLODShader,f=THREE.UniformsUtils.clone(p.uniforms);f.tDiffuse1.value=u,f.tDiffuse2.value=h,f.worldWidth.value=parseFloat(t),f.tileResolution.value=parseFloat(i),f.edgeMorph.value=0,f.globalOffset.value=new THREE.Vector3(0,0,0),f.tileOffset.value=a,f.heightMap.value=c,f.tileScale.value=parseFloat(o),f.maxHeight.value=s,f.winterSnow.value=!1,f.summerGreen.value=!0;var m={};d.isWebGL2()?m.texture2DLodEXT="textureLod":m.texture2DLodEXT="texture2DLod";var v=new THREE.ShaderMaterial({defines:m,uniforms:f,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,lights:!0,fog:void 0!==d.scene.fog});return v.extensions={derivatives:!0,shaderTextureLOD:!0},v}(i,a,o,s,l),h=new THREE.Mesh(c,u);return h.rotation.x=-Math.PI/2,h.position.x-=i/2,h.position.z+=i/2,h.frustumCulled=!1,h.castShadow=!1,h.receiveShadow=!0,h.name="heightMapTerrain",h};var x,b,T,w=r(12),_=r(9),R=r(13);function M(e,t,r,n){var i=void 0,a=void 0,o=void 0,s=void 0,l=(new THREE.Vector3).addVectors(n.max,n.min).multiplyScalar(.5),c=(new THREE.Vector3).subVectors(n.max,l),u=(new THREE.Vector3).subVectors(e,l),h=(new THREE.Vector3).subVectors(t,l),d=(new THREE.Vector3).subVectors(r,l),p=(new THREE.Vector3).subVectors(h,u),f=(new THREE.Vector3).subVectors(d,h),m=(new THREE.Vector3).subVectors(u,d),v=new THREE.Vector3(0,-p.z,p.y),g=new THREE.Vector3(0,-f.z,f.y),y=new THREE.Vector3(0,-m.z,m.y),E=new THREE.Vector3(p.z,0,-p.x),x=new THREE.Vector3(f.z,0,-f.x),b=new THREE.Vector3(m.z,0,-m.x),T=new THREE.Vector3(-p.y,p.x,0),w=new THREE.Vector3(-f.y,f.x,0),_=new THREE.Vector3(-m.y,m.x,0);if(i=u.dot(v),a=h.dot(v),o=d.dot(v),s=c.y*Math.abs(p.z)+c.z*Math.abs(p.y),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=u.dot(g),a=h.dot(g),o=d.dot(g),s=c.y*Math.abs(f.z)+c.z*Math.abs(f.y),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=u.dot(y),a=h.dot(y),o=d.dot(y),s=c.y*Math.abs(m.z)+c.z*Math.abs(m.y),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=u.dot(E),a=h.dot(E),o=d.dot(E),s=c.x*Math.abs(p.z)+c.z*Math.abs(p.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=u.dot(x),a=h.dot(x),o=d.dot(x),s=c.x*Math.abs(f.z)+c.z*Math.abs(f.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=u.dot(b),a=h.dot(b),o=d.dot(b),s=c.x*Math.abs(m.z)+c.z*Math.abs(m.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=u.dot(T),a=h.dot(T),o=d.dot(T),s=c.x*Math.abs(p.y)+c.y*Math.abs(p.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=u.dot(w),a=h.dot(w),o=d.dot(w),s=c.x*Math.abs(f.y)+c.y*Math.abs(f.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(i=u.dot(_),a=h.dot(_),o=d.dot(_),s=c.x*Math.abs(m.y)+c.y*Math.abs(m.x),Math.max(-Math.max(i,a,o),Math.min(i,a,o))>s)return!1;if(Math.max(u.x,h.x,d.x)<-c.x||Math.min(u.x,h.x,d.x)>c.x)return!1;if(Math.max(u.y,h.y,d.y)<-c.y||Math.min(u.y,h.y,d.y)>c.y)return!1;if(Math.max(u.z,h.z,d.z)<-c.z||Math.min(u.z,h.z,d.z)>c.z)return!1;var R=new THREE.Plane;return R.normal=(new THREE.Vector3).copy(f).cross(p).normalize(),R.constant=R.normal.dot(e),function(e,t){var r=(new THREE.Vector3).addVectors(e.max,e.min).multiplyScalar(.5),n=(new THREE.Vector3).subVectors(e.max,r),i=n.x*Math.abs(t.normal.x)+n.y*Math.abs(t.normal.y)+n.z*Math.abs(t.normal.z),a=t.normal.dot(r)-t.constant;return Math.abs(a)<=i}(n,R)}function S(e,t){var r=0;return e.center.x<t.min.x&&(r+=(t.min.x-e.center.x)*(t.min.x-e.center.x)),e.center.x>t.max.x&&(r+=(e.center.x-t.max.x)*(e.center.x-t.max.x)),e.center.y<t.min.y&&(r+=(t.min.y-e.center.y)*(t.min.y-e.center.y)),e.center.y>t.max.y&&(r+=(e.center.y-t.max.y)*(e.center.y-t.max.y)),e.center.z<t.min.z&&(r+=(t.min.z-e.center.z)*(t.min.z-e.center.z)),e.center.z>t.max.z&&(r+=(e.center.z-t.max.z)*(e.center.z-t.max.z)),r<=e.radius*e.radius}function A(e,t,r,n,i){var a=(new THREE.Vector3).subVectors(t,e.center),o=(new THREE.Vector3).subVectors(r,e.center),s=(new THREE.Vector3).subVectors(n,e.center),l=e.radius*e.radius,c=(new THREE.Vector3).crossVectors(o.clone().sub(a),s.clone().sub(a)),u=a.dot(c),h=c.dot(c);if(u*u>l*h)return!1;var d=a.dot(a),p=a.dot(o),f=a.dot(s),m=o.dot(o),v=o.dot(s),g=s.dot(s);if(d>l&p>d&f>d||m>l&p>m&v>m||g>l&f>g&v>g)return!1;var y=(new THREE.Vector3).subVectors(o,a),E=(new THREE.Vector3).subVectors(s,o),x=(new THREE.Vector3).subVectors(a,s),b=p-d,T=v-m,w=f-g,_=y.dot(y),R=E.dot(E),M=x.dot(x),S=(new THREE.Vector3).subVectors(a.multiplyScalar(_),y.multiplyScalar(b)),A=(new THREE.Vector3).subVectors(o.multiplyScalar(R),E.multiplyScalar(T)),P=(new THREE.Vector3).subVectors(s.multiplyScalar(M),x.multiplyScalar(w)),L=(new THREE.Vector3).subVectors(s.multiplyScalar(_),S),C=(new THREE.Vector3).subVectors(a.multiplyScalar(R),A),H=(new THREE.Vector3).subVectors(o.multiplyScalar(M),P);if(S.dot(S)>l*_*_&&S.dot(L)>=0||A.dot(A)>l*R*R&&A.dot(C)>=0||P.dot(P)>l*M*M&&P.dot(H)>=0)return!1;var I=Math.sqrt(u*u/h)-e.radius-1,k=new THREE.Vector3(-i.x,-i.y,-i.z);return{distance:I,contactPoint:e.center.clone().add(k.multiplyScalar(I))}}function P(e,t,r,n,i){var a=n.clone().sub(r),o=i.clone().sub(r),s=e.clone().sub(t),l=a.clone().cross(o),c=s.dot(l);if(c<=0)return!1;var u=e.clone().sub(r),h=u.dot(l);if(h<0)return 0;if(h>c)return 0;var d=s.clone().cross(u),p=o.dot(d);if(p<0||p>c)return 0;var f=-1*a.clone().dot(d);if(f<0||p+f>c)return 0;var m=1/c;h*=m;var v=1-(p*=m)-(f*=m),g=r.clone().multiplyScalar(v),y=n.clone().multiplyScalar(p),E=i.clone().multiplyScalar(f);return{contactPoint:g.clone().add(y).add(E)}}function L(e,t,r){this.min=e,this.max=t,this.maxDepth=r,this.nodes=[];for(var n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=0;o<this.maxDepth;o++){this.nodes.push([]);var s=Math.pow(2,o),l=Math.pow(4,o);n.subVectors(this.max,this.min).divideScalar(s);for(var c=0,u=Math.pow(8,o);c<u;c++){var h=c%s,d=~~(c/l),p=~~(c/s)%s,f=this.min.x+h*n.x,m=this.min.y+d*n.y,v=this.min.z+p*n.z;i.set(f,m,v),a.copy(i).add(n);var g=L.getMortonNumber(h,d,p);this.nodes[o][g]=new C(this,o,g,i,a)}}}function C(e,t,r,n,i){this.tree=e,this.depth=t,this.mortonNumber=r,this.min=new THREE.Vector3(n.x,n.y,n.z),this.max=new THREE.Vector3(i.x,i.y,i.z),this.trianglePool=[]}d.ViewWorks=function(e){var t=this;e=e||{};if(this.appName=e.appName||"viewWorks",this.dom=document.createElement("div"),this.dom.id=this.appName,this.dom.className="appWorks",this.dom.tabIndex=d.tabIndices[this.dom.id],this.dom.style.position="absolute",this.dom.style.left="0px",this.dom.style.width="100%",this.dom.style.height="100%",this.width=e.width||window.innerWidth,this.height=e.height||window.innerHeight,this.widthRatio=this.width/window.innerWidth,this.heightRatio=this.height/window.innerHeight,d.isWebGL2Available()){var r=document.createElement("canvas"),n=r.getContext("webgl2");this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:r,context:n,alpha:!0})}else this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0});this.renderer.autoClear=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.2,this.renderer.toneMapping=THREE.LinearToneMapping,this.renderer.toneMappingExposure=1,this.dom.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.scene.name="scene",this.scene.appName=this.appName;var i=(new THREE.TextureLoader).load("images/wallpaper/arctic.jpg");this.scene.background=d.createBackground(i);var a=e.cameraFov||50,o=e.cameraNear||.01,s=e.cameraFar||1e4,l=e.cameraPosition||[0,0,50];function c(){requestAnimationFrame(c),function(){var e=d.getDeltaTime(),r=d.getCurrentTime();t.animation.update(e),t.scene.traverse(function(t){t.update&&t.update(e,r)});var n=t.controls;!n.enabled||!0!==n.autoRotate&&!0!==n.enableDamping||n.update()}(),t.renderer.render(t.scene,t.camera)}function u(e){switch(e.stopPropagation(),e.keyCode){case 8:e.preventDefault();case 27:t.controls.enabled=!0;break;case 49:d.nextShowroom(t.showroom,"background");break;case 50:d.nextShowroom(t.showroom,"floor");break;case 79:if(t.animation&&t.selectObject){var r=t.selectObject.activeAction;r.paused=!r.paused}break;case 80:t.animation&&t.selectObject&&t.playNextAction(t.selectObject)}}this.camera=new THREE.PerspectiveCamera(a,this.width/this.height,o,s),this.camera.position.set(l[0],l[1],l[2]),this.camera.lookAt(this.scene.position),this.camera.name="camera",this.controls=d.createCameraControls(e.controlsType,this.camera,this.renderer.domElement),this.animation=new d.Animation(this.scene),this.playAction=function(e,t,r){this.animation.playAction(e,t,r)},this.playNextAction=function(e){this.animation.playNextAction(e)},this.stopAction=function(e,t){this.animation.stopAction(e,t)},this.selectObject=null,this.fileExplorer=new d.FileExplorer(this),window.addEventListener("resize",function(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0);t.width=t.widthRatio*e,t.height=t.heightRatio*r,t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.renderer.setSize(t.width,t.height)},!1),this.dom.addEventListener("click",function(e){t.dom.focus()},!1),this.dom.addEventListener("keydown",u,!1),this.renderScene=function(){c()},this.onKeyDown=function(e){u(e)},d.renderer=this.renderer,d.scene=this.scene,d.camera=this.camera,d.appWorks=this,function(){var e=document.createElement("div");e.id="infobutton",e.innerHTML='            <img src="images/info.png" border="0" />\n        ',e.style.cssText="            text-align: left;\n            margin: 0 0 0 0;\n            z-index: 13;\n            position: absolute;\n            display: block;\n            padding: 8px;\n        ",e.addEventListener("click",function(e){var t=document.getElementById("infoPanel").style;t.display="block"==t.display?"none":"block"}),document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.createElement("div");t.id="infoPanel",t.innerHTML='            <b>ViewWorks - 3D model viewer</b>\n            <p>\n            To upload your model,<br>\n            <b>drag and drop your file or folder onto this ViewWorks.</b><br><br>\n            Supported file formats<br>\n            JSON, OBJ(+MTL), STL, PLY, DAE(COLLADA), GLTF, GLB, AMF, 3MF, WRL(VRML), FBX<br>\n            </p>\n            (C) <a href="https://www.nova-graphix.com/" target="_blank" style="color: #ffa500; text-decoration: none;">NovaGraphix, Co.</a>, 2018.\n        ',t.style.cssText="            text-align: left;\n            font-size: 80%;\n            margin: 0.5em 0em 0em 0.4em;\n            z-index: 12;\n            position: absolute;\n            display: none;\n            color: #fff;\n            background: #121212;\n            opacity: 0.8;\n            border-radius: 20px;\n            padding: 32px;\n        ",document.getElementById("novaGraphix").parentNode.appendChild(t)}()},d.GameWorks=function(e){var t=this;e=e||{};if(this.appName=e.appName||"gameWorks",this.dom=document.createElement("div"),this.dom.id=this.appName,this.dom.className="appWorks",this.dom.tabIndex=d.tabIndices[this.dom.id],this.dom.style.position="absolute",this.dom.style.left="0px",this.dom.style.width="100%",this.dom.style.height="100%",this.width=e.width||window.innerWidth,this.height=e.height||window.innerHeight,this.widthRatio=this.width/window.innerWidth,this.heightRatio=this.height/window.innerHeight,d.isWebGL2Available()){var r=document.createElement("canvas"),n=r.getContext("webgl2");this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:r,context:n,alpha:!0})}else this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0});this.renderer.autoClear=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.2,this.renderer.toneMapping=THREE.LinearToneMapping,this.renderer.toneMappingExposure=1,this.dom.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.scene.name="scene",this.scene.appName=this.appName,this.scene.background=new THREE.Color(12632256);var i,a,o=e.cameraFov||50,s=e.cameraNear||.01,l=e.cameraFar||1e4,c=e.cameraPosition||[0,0,50];function u(){requestAnimationFrame(u),function(){var e=d.getDeltaTime(),r=d.getCurrentTime();t.stats&&t.stats.update();t.animation.update(e),t.scene.traverse(function(t){t.update&&t.update(e,r)}),t.sceneHUD.traverse(function(t){t.update&&t.update(e,r)});var n=t.controls;n.enabled&&(n instanceof THREE.OrbitControls?!0!==n.autoRotate&&!0!==n.enableDamping||n.update():n.update(e))}(),h()}function h(){if(t.effect)t.effect.render(t.scene,t.camera);else{if(void 0!==t.underWaterPass&&t.underWaterPass.enabled)for(var e=0;e<4;e++)t.underWaterPass.values[e].uniforms.time.value+=Math.random();t.composer.render()}}function p(e){var r=t.dom.getBoundingClientRect(),n=d.getMouseScreenCoords(e);return n.x=(n.x-r.left)/r.width*2-1,n.y=-(n.y-r.top)/r.height*2+1,n}function f(e,r){return t.raycaster.setFromCamera(e,t.camera),t.raycaster.intersectObjects(r,!0)}function m(){var e=t.getIntersectObject(t.xinfo);e&&("picker"===e.name?t.select(e.userData.object):event.ctrlKey?t.select(e,"multiple"):event.altKey?t.select(e,"ancestor"):t.select(e),h())}function v(e){t.mouseUpPosition.copy(p(e)),m(),document.removeEventListener("mouseup",v,!1)}function g(e){e.preventDefault(),i&&(clearTimeout(i),a=!1),t.mouseUpPosition.copy(p(e)),m(),document.removeEventListener("touchend",g,!1)}function y(e){t.mouseUpPosition.copy(t.mouseDownPosition),onContextMenu(e)}this.camera=new THREE.PerspectiveCamera(o,this.width/this.height,s,l),this.camera.position.set(c[0],c[1],c[2]),this.camera.lookAt(this.scene.position),this.camera.name="camera",this.controls=d.createCameraControls(e.controlsType,this.camera,this.renderer.domElement),this.animation=new d.Animation(this.scene),this.playAction=function(e,t,r){this.animation.playAction(e,t,r)},this.playNextAction=function(e){this.animation.playNextAction(e)},this.stopAction=function(e,t){this.animation.stopAction(e,t)},d.isDeviceMobile()||(this.stats=new _,this.stats.dom.style.cssText="position:absolute; bottom:0px; right:0px",this.dom.appendChild(this.stats.dom)),this.raycaster=new THREE.Raycaster,this.selectObject=null,this.selectObjects=[],this.selectables=[],this.mouseMovePosition=new THREE.Vector2,this.mouseDownPosition=new THREE.Vector2,this.mouseUpPosition=new THREE.Vector2,this.mouseDoubleClickPosition=new THREE.Vector2,this.playAudio=function(e){this.sound&&this.sound.unload(),this.sound=d.playAudio(e,this.camera)},this.playAudio(e.audioFiles),this.sceneHUD=new THREE.Scene,this.cameraHUD=new THREE.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,10),this.cameraHUD.position.z=10,function(e){var e=e||{};t.composer=new THREE.EffectComposer(t.renderer),t.composer.setSize(t.width,t.height),t.renderPass=new THREE.RenderPass(t.scene,t.camera),t.renderPass.clear=!0,t.renderPass.clearDepth=!1,t.composer.addPass(t.renderPass),t.renderPass3=new THREE.RenderPass(t.sceneHUD,t.cameraHUD),t.renderPass3.clear=!1,t.renderPass3.clearDepth=!1,t.composer.addPass(t.renderPass3),t.bleachShader=new THREE.ShaderPass(THREE.BleachBypassShader),t.composer.addPass(t.bleachShader),t.bloomPass=new THREE.UnrealBloomPass(new THREE.Vector2(t.width,t.height),2.5,.45,.88),t.composer.addPass(t.bloomPass),t.dotScreenShader=new THREE.ShaderPass(THREE.DotScreenShader),t.dotScreenShader.uniforms.scale.value=4,t.composer.addPass(t.dotScreenShader),t.glitchPass=new THREE.GlitchPass(0),t.composer.addPass(t.glitchPass),t.sepiaShader=new THREE.ShaderPass(THREE.SepiaShader),t.composer.addPass(t.sepiaShader),t.outlinePass=new THREE.OutlinePass(new THREE.Vector2(t.width,t.height),t.scene,t.camera),t.composer.addPass(t.outlinePass),(new THREE.TextureLoader).load("images/tri_pattern.jpg",function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t.outlinePass.patternTexture=e}),e.FXAAEnabled=!0,t.FXAAShader=new THREE.ShaderPass(THREE.FXAAShader),t.FXAAShader.uniforms.resolution.value.set(1/t.width,1/t.height),t.composer.addPass(t.FXAAShader),t.ssaoPass=new THREE.SSAOPass(t.scene,t.camera,t.width,t.height),t.composer.addPass(t.ssaoPass),t.godRaysPass=new d.GodRaysPass(t.scene,t.camera,t.width,t.height),t.composer.addPass(t.godRaysPass),t.bokehPass=new THREE.BokehPass(t.scene,t.camera,{width:t.width,height:t.height,vignetting:1}),t.composer.addPass(t.bokehPass),t.vignetteShader=new THREE.ShaderPass(THREE.VignetteShader),t.composer.addPass(t.vignetteShader),t.copyShader=new THREE.ShaderPass(THREE.CopyShader),t.copyShader.renderToScreen=!0,t.composer.addPass(t.copyShader),t.bleachShader.enabled=e.bleachEnabled||!1,t.bloomPass.enabled=e.bloomEnabled||!1,t.dotScreenShader.enabled=e.dotScreenEnabled||!1,t.glitchPass.enabled=e.glitchEnabled||!1,t.sepiaShader.enabled=e.sepiaEnabled||!1,t.outlinePass.enabled=e.outlineEnabled||!1,t.FXAAShader.enabled=e.FXAAEnabled||!1,t.ssaoPass.enabled=e.ssaoEnabled||!1,t.godRaysPass.enabled=e.godRaysEnabled||!1,t.bokehPass.enabled=e.bokehEnabled||!1,t.vignetteShader.enabled=e.vignetteEnabled||!1}(e),this.cameraEffect=function(e){void 0!==this.effect&&this.effect instanceof THREE.AnaglyphEffect&&this.effect.dispose(),this.effect=d.createCameraEffect(e,this.renderer),this.effect&&this.effect.setSize(this.width,this.height)},this.cameraEffect(e.effectType),window.addEventListener("orientationchange",function(){[t.widthRatio,t.heightRatio]=[t.heightRatio,t.widthRatio]},!1),window.addEventListener("resize",function(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0);t.width=t.widthRatio*e,t.height=t.heightRatio*r,t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),function(){if(t.sceneHUD&&t.cameraHUD){var e=t.width/2,r=t.height/2,n=t.cameraHUD;n.left=-e,n.right=e,n.top=r,n.bottom=-r,n.updateProjectionMatrix();var i=t.sceneHUD;if(i.children.length>0){var a=i.children[0].material,o=a.map.image.width;a.map.image.height,i.traverse(function(t){switch(t.name){case"sprite1":t.position.set(-e,-r,1);break;case"sprite2":t.position.set(-e+o,-r,1);break;case"sprite3":t.position.set(2*o-e,-r,1)}})}}}(),t.FXAAShader.enabled&&t.FXAAShader.uniforms.resolution.value.set(1/t.width,1/t.height);t.renderer.setSize(t.width,t.height),t.composer.setSize(t.width,t.height),t.effect&&t.effect.setSize(t.width,t.height);t.scene.getObjectsByType("FireParticles").forEach(function(e){e.setNearPlaneHeight()})},!1),this.dom.addEventListener("click",function(e){t.dom.focus()},!1),this.dom.addEventListener("dblclick",function(e){t.mouseDoubleClickPosition.copy(p(e));var r=t.getIntersectObject("mouseDoubleClick");r&&t.focus(r)},!1),this.dom.addEventListener("mousemove",function(e){t.mouseMovePosition.copy(p(e)),t.bokehPass&&t.bokehPass.enabled&&t.bokehPass.mouse.copy(t.mouseMovePosition)},!1),this.dom.addEventListener("mousedown",function(e){t.mouseDownPosition.copy(p(e)),document.addEventListener("mouseup",v,!1)},!1),this.dom.addEventListener("touchmove",function(e){e.preventDefault(),i&&clearTimeout(i);t.mouseMovePosition.copy(p(e)),t.bokehPass&&t.bokehPass.enabled&&t.bokehPass.mouse.copy(t.mouseMovePosition)},!0),this.dom.addEventListener("touchstart",function(e){t.guiContextMenu&&t.guiContextMenu.setDisplay("none");if(e.preventDefault(),a)return;i=setTimeout(y,500,e),a=!0,t.mouseDownPosition.copy(p(e)),document.addEventListener("touchend",g,!1)},!1),this.dom.addEventListener("keydown",function(e){switch(e.keyCode){case 66:d.demoApplication();break;case 191:d.gamePlay()}},!1),this.dom.addEventListener("keyup",function(e){},!1),this.renderScene=function(){u()},this.getIntersectObject=function(e){if("string"==typeof e){var t;if("mouseDown"===e)t=this.mouseDownPosition;else if("mouseUp"===e)t=this.mouseUpPosition;else{if("mouseDoubleClick"!==e)return null;t=this.mouseDoubleClickPosition}return(r=f(t,this.selectables)).length>0?r[0].object:null}var r;return this.mouseDownPosition.equals(this.mouseUpPosition)&&(r=f(this.mouseUpPosition,this.selectables)).length>0?(void 0!==e&&(e.object=r[0].object,e.distance=r[0].distance,e.point=r[0].point,e.uv=r[0].uv),r[0].object):null},d.renderer=this.renderer,d.scene=this.scene,d.camera=this.camera,d.appWorks=this},d.DesignWorks=function(e){var t=this;e=e||{};this.appName=e.appName||"designWorks",this.dom=document.createElement("div"),this.dom.id=this.appName,this.dom.className="appWorks",this.dom.tabIndex=d.tabIndices[this.dom.id],this.dom.style.position="absolute",this.dom.style.left="0px",this.dom.style.width="100%",this.dom.style.height="100%",this.width=e.width||window.innerWidth,this.height=e.height||window.innerHeight,this.widthRatio=this.width/window.innerWidth,this.heightRatio=this.height/window.innerHeight;var r,n=w.Signal;if(this.signals={startPlayer:new n,stopPlayer:new n,appWorksCleared:new n,autoSaveStarted:new n,autoSaveFinished:new n,themeChanged:new n,transformModeChanged:new n,snapChanged:new n,spaceChanged:new n,sceneBackgroundChanged:new n,sceneFogChanged:new n,sceneGraphChanged:new n,cameraChanged:new n,geometryChanged:new n,objectSelected:new n,objectFocused:new n,objectsSelected:new n,objectAdded:new n,objectChanged:new n,objectRemoved:new n,helperAdded:new n,helperChanged:new n,helperRemoved:new n,materialChanged:new n,windowResize:new n,axesHelperChanged:new n,gridHelperChanged:new n,refreshSidebarObject3D:new n,historyChanged:new n},(r=t.signals).startPlayer.add(function(){t.history.historyDisabled=!0}),r.stopPlayer.add(function(){t.history.historyDisabled=!1}),r.themeChanged.add(function(){}),r.sceneBackgroundChanged.add(function(e){t.config.setSettings("background",e)}),r.sceneFogChanged.add(function(e){t.createSceneFog(e),R()}),r.axesHelperChanged.add(function(e){d.dispose(t.axesHelper),t.axesHelper=x(e),t.sceneHelpers.add(t.axesHelper),R()}),r.gridHelperChanged.add(function(e,r,n){d.dispose(t.gridHelper),t.gridHelper=b(e,r,n),t.sceneHelpers.add(t.gridHelper),R()}),r.geometryChanged.add(function(e){R()}),r.materialChanged.add(function(e){R()}),r.objectAdded.add(function(e){var r=t.selectables;e.traverse(function(e){r.push(e)})}),r.objectRemoved.add(function(e){e===t.transformControls.object&&t.transformControls.detach();var r=t.selectables;e.traverse(function(e){r.splice(r.indexOf(e),1)})}),r.objectChanged.add(function(e){e instanceof THREE.PerspectiveCamera&&e.updateProjectionMatrix(),!e.helper||e.helper instanceof THREE.SkeletonHelper||(e.helper.update(),r.helperChanged.dispatch(e.helper)),R()}),r.objectsSelected.add(function(e){if(Array.isArray(e)){if(1===e.length){var r=e[0];if(null===r.parent)return;var n=t.transformControls.enabled;t.transformControls.detach(),t.transformControls.attach(r),t.transformControls.visible=n,t.transformControls.enabled=n}if(t.outlinePass.enabled){var i=t.outlinePass;i.selectedObjects=[],e.forEach(function(e){e.traverse(function(e){0===e.children.length&&i.selectedObjects.push(e)})})}}}),r.objectFocused.add(function(e){e?t.controls.target.copy(e.position):t.controls.target.set(0,0,0),t.controls.update()}),r.helperAdded.add(function(e){var r=e.getObjectByName("picker");t.selectables.push(r)}),r.helperChanged.add(function(e){var t=e.light;t&&(e.visible=t.visible)}),r.helperRemoved.add(function(e){var r=t.selectables,n=e.getObjectByName("picker");r.splice(r.indexOf(n),1)}),r.cameraChanged.add(function(e){e&&(t.config.setSettings("cameraFov",e.fov),t.config.setSettings("cameraNear",e.near),t.config.setSettings("cameraFar",e.far)),R()}),r.historyChanged.add(function(){var e=t.history;e.undos.length,e.redos.length}),r.appWorksCleared.add(function(){t.select(null),t.focus(),R()}),r.autoSaveStarted.add(function(){}),r.autoSaveFinished.add(function(){}),r.transformModeChanged.add(function(e){t.transformControls.setMode(e)}),r.snapChanged.add(function(e){t.transformControls.setTranslationSnap(e)}),r.spaceChanged.add(function(e){t.transformControls.setSpace(e)}),r.windowResize.add(function(){M(),R()}),this.config=new d.Config(this.appName),this.config.initDatabase(function(){var e;function r(){!1!==t.config.getSettings("autosave")&&(clearTimeout(e),e=setTimeout(function(){t.signals.autoSaveStarted.dispatch(),e=setTimeout(function(){t.config.setDatabase(t.toJSON()),t.signals.autoSaveFinished.dispatch()},100)},1e3))}t.config.getDatabase(function(e){void 0!==e&&t.fromJSON(e)});var n=t.signals;n.geometryChanged.add(r),n.materialChanged.add(r),n.objectAdded.add(r),n.objectChanged.add(r),n.objectRemoved.add(r),n.sceneBackgroundChanged.add(r),n.sceneFogChanged.add(r),n.sceneGraphChanged.add(r),n.historyChanged.add(r)}),this.history=new d.History(this),d.isWebGL2Available()){var i=document.createElement("canvas"),a=i.getContext("webgl2");this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:i,context:a,alpha:!0})}else this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0});this.renderer.autoClear=!0,this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.gammaFactor=2.2,this.renderer.toneMapping=THREE.LinearToneMapping,this.renderer.toneMappingExposure=1,this.dom.appendChild(this.renderer.domElement),this.scene=new THREE.Scene,this.scene.name="scene",this.scene.appName=this.appName,this.createSceneFog=function(e){this.scene.fog=d.createFog(e)},this.createSceneFog(e.fog),this.createSceneBackground=function(e){e=void 0!==e?e:this.config.getSettings("background");this.scene.background&&this.scene.background.dispose&&this.scene.background.dispose(),this.scene.background=d.createBackground(e)},this.createSceneBackground(e.background);var o,s,l,c,u,h,p,f,m,v=e.cameraFov||this.config.getSettings("cameraFov"),g=e.cameraNear||this.config.getSettings("cameraNear"),y=e.cameraFar||this.config.getSettings("cameraFar"),E=e.cameraPosition||this.config.getSettings("cameraPosition");function x(e){e=e||t.config.getSettings("axesHelperLength");var r=new THREE.Vector3(0,0,0),n=new THREE.Vector3(1,0,0),i=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),o=new THREE.ArrowHelper(n,r,e,16711680);o.name="xaxis";var s=new THREE.ArrowHelper(i,r,e,65280);s.name="yaxis";var l=new THREE.ArrowHelper(a,r,e,255);l.name="zaxis";var c=new THREE.Object3D;return c.add(o),c.add(s),c.add(l),c.name="axesHelper",c}function b(e,r,n){e=e||t.config.getSettings("gridHelperSize"),r=r||t.config.getSettings("gridHelperSpacing"),n=n||t.config.getSettings("gridHelperColor");e=~~(e/r),e*=r;var i=new THREE.GridHelper(e,e/r,16729156,n);i.position.y=0,i.name="gridHelper";for(var a=.05*r,o=e/2,s=[],l=-o;l<=o;l+=r)s.push(l.toFixed(2));return s.forEach(function(e){var t=d.createTextSprite(e,{textHeight:a,fontWeight:"bold"}),r=t.clone();t.position.set(parseFloat(e),a/2,0),r.position.set(0,a/2,parseFloat(e)),i.add(t),i.add(r)}),i}function T(){requestAnimationFrame(T),function(){var e=d.getDeltaTime(),r=d.getCurrentTime();t.stats&&t.stats.update();t.animation.update(e),t.scene.traverse(function(t){t.update&&t.update(e,r)}),t.sceneHUD.traverse(function(t){t.update&&t.update(e,r)});var n=t.controls;n.enabled&&(n instanceof THREE.OrbitControls?!0!==n.autoRotate&&!0!==n.enableDamping||n.update():n.update(e))}(),R()}function R(){if(t.effect)t.effect.render(t.scene,t.camera);else{if(void 0!==t.underWaterPass&&t.underWaterPass.enabled)for(var e=0;e<4;e++)t.underWaterPass.values[e].uniforms.time.value+=Math.random();t.composer.render()}}function M(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0);t.width=t.widthRatio*e,t.height=t.heightRatio*r,t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),function(){if(!t.sceneHUD||!t.cameraHUD)return;var e=t.width/2,r=t.height/2,n=t.cameraHUD;n.left=-e,n.right=e,n.top=r,n.bottom=-r,n.updateProjectionMatrix();var i=t.sceneHUD;if(i.children.length>0){var a=i.children[0].material,o=a.map.image.width;a.map.image.height;i.traverse(function(t){switch(t.name){case"sprite1":t.position.set(-e,-r,1);break;case"sprite2":t.position.set(-e+o,-r,1);break;case"sprite3":t.position.set(2*o-e,-r,1)}})}}(),t.FXAAShader.enabled&&t.FXAAShader.uniforms.resolution.value.set(1/t.width,1/t.height),t.renderer.setSize(t.width,t.height),t.composer.setSize(t.width,t.height),t.effect&&t.effect.setSize(t.width,t.height),t.controls.enabled&&(t.controls instanceof THREE.OrbitControls||t.controls.handleResize()),t.scene.getObjectsByType("FireParticles").forEach(function(e){e.setNearPlaneHeight()})}function S(e){var r=t.dom.getBoundingClientRect(),n=d.getMouseScreenCoords(e);return n.x=(n.x-r.left)/r.width*2-1,n.y=-(n.y-r.top)/r.height*2+1,n}function A(e,r){return t.raycaster.setFromCamera(e,t.camera),t.raycaster.intersectObjects(r,!0)}function P(){var e=t.getIntersectObject(t.xinfo);e&&("picker"===e.name?t.select(e.userData.object):event.ctrlKey?t.select(e,"multiple"):event.altKey?t.select(e,"ancestor"):t.select(e),R())}function L(e){t.mouseUpPosition.copy(S(e)),P(),document.removeEventListener("mouseup",L,!1)}function C(e){e.preventDefault(),f&&(clearTimeout(f),m=!1),t.mouseUpPosition.copy(S(e)),P(),document.removeEventListener("touchend",C,!1)}function H(e){t.mouseUpPosition.copy(t.mouseDownPosition),I(e)}function I(e){t.guiContextMenu&&(t.getIntersectObject()&&t.guiContextMenu.toggle(e))}function k(e){e.preventDefault(),e.stopPropagation();var r=d.isDeviceMacOS()?e.metaKey:e.ctrlKey;if(r&&90===e.keyCode)t.undo();else if(r&&89===e.keyCode)t.redo();else switch(e.keyCode){case 8:e.preventDefault();case 46:var n=t.selectObject;n&&n.parent&&t.remove(n);break;case 18:break;case 27:t.controls.enabled=!0;break;case 49:d.filmGrainBackground();break;case 50:break;case 66:d.demoApplication();break;case 67:t.controls instanceof THREE.OrbitControls?t.controls=d.createCameraControls("FirstPersonControls"):t.controls instanceof THREE.FirstPersonControls&&(t.controls=d.createCameraControls("OrbitControls"));break;case 70:d.demoLoadFiles();break;case 72:d.add(d.createHemisphereLight());break;case 73:d.cameraAutoView({isWorking:!0})?d.cameraAutoView({viewMode:"stop"}):d.cameraAutoView({viewMode:"circle"});break;case 76:d.toggleLightHelpers();break;case 77:void 0!==t.sound&&(t.sound.playing()?t.sound.pause():t.sound.play());break;case 78:d.add(d.createSky()),d.add(d.createSunLight());break;case 79:if(t.animation&&t.selectObject){var i=t.selectObject.activeAction;i.paused=!i.paused}break;case 80:t.animation&&t.selectObject&&t.playNextAction(t.selectObject);break;case 86:var a=t.scene.getObjectByName("demoVideoTexture");void 0!==a&&(a.visible=!a.visible);break;case 112:t.appGUI&&t.appGUI.toggle(t.guiSceneGraph.dom);break;case 113:t.appGUI&&t.appGUI.toggle();break;case 114:t.dragControls.enabled=!t.dragControls.enabled;break;case 115:t.transformControls.visible=!t.transformControls.visible,t.transformControls.enabled=!t.transformControls.enabled;break;case 116:t.guiSidebar&&t.guiSidebar.select(t.guiStrings.getKey("menubar/edit/scene"),"inclusive");break;case 117:d.screenCapture();break;case 118:break;case 119:t.selectObject&&t.focus(t.selectObject);break;case 120:t.config.clearSettings(),console.log('>> clear the "window.localStorage"...');break;case 121:t.config.clearDatabase(),console.log('>> clear the "window.indexedDB"...');break;case 191:d.gamePlay();break;case 81:t.transformControls.setSpace("local"===t.transformControls.space?"world":"local");break;case 17:t.transformControls.setTranslationSnap(t.config.getSettings("translationSnap")),t.transformControls.setRotationSnap(THREE.Math.degToRad(t.config.getSettings("rotationSnap")));break;case 87:t.transformControls.setMode("translate");break;case 69:t.transformControls.setMode("rotate");break;case 82:t.transformControls.setMode("scale");break;case 187:case 107:t.transformControls.setSize(t.transformControls.size+.1);break;case 189:case 109:t.transformControls.setSize(Math.max(t.transformControls.size-.1,.1));break;case 88:t.transformControls.showX=!t.transformControls.showX;break;case 89:t.transformControls.showY=!t.transformControls.showY;break;case 90:t.transformControls.showZ=!t.transformControls.showZ;break;case 32:t.transformControls.visible=!t.transformControls.visible,t.transformControls.enabled=!t.transformControls.enabled}}this.defaultCamera=new THREE.PerspectiveCamera(v,this.width/this.height,g,y),this.defaultCamera.position.set(E[0],E[1],E[2]),this.defaultCamera.lookAt(this.scene.position),this.defaultCamera.name="camera",this.camera=this.defaultCamera.clone(),this.controls=d.createCameraControls(e.controlsType,this.camera,this.renderer.domElement),this.animation=new d.Animation(this.scene),this.playAction=function(e,t,r){this.animation.playAction(e,t,r)},this.playNextAction=function(e){this.animation.playNextAction(e)},this.stopAction=function(e,t){this.animation.stopAction(e,t)},d.isDeviceMobile()||(this.stats=new _,this.stats.dom.style.cssText="position:absolute; bottom:0px; right:0px",this.dom.appendChild(this.stats.dom)),this.raycaster=new THREE.Raycaster,this.selectObject=null,this.selectObjects=[],this.selectables=[],this.mouseMovePosition=new THREE.Vector2,this.mouseDownPosition=new THREE.Vector2,this.mouseUpPosition=new THREE.Vector2,this.mouseDoubleClickPosition=new THREE.Vector2,this.playAudio=function(e){this.sound&&this.sound.unload(),this.sound=d.playAudio(e)},this.playAudio(e.audioFiles),this.sceneHelpers=new THREE.Scene,this.axesHelper=x(),this.axesHelper.visible=e.axesVisible||!1,this.sceneHelpers.add(this.axesHelper),this.gridHelper=b(),this.gridHelper.visible=e.gridVisible||!1,this.sceneHelpers.add(this.gridHelper),this.sceneHUD=new THREE.Scene,this.cameraHUD=new THREE.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,10),this.cameraHUD.position.z=10,function(e){var e=e||{};t.composer=new THREE.EffectComposer(t.renderer),t.composer.setSize(t.width,t.height),t.renderPass=new THREE.RenderPass(t.scene,t.camera),t.renderPass.clear=!0,t.renderPass.clearDepth=!1,t.composer.addPass(t.renderPass),t.sceneHelpers.children.length>0&&(t.renderPass2=new THREE.RenderPass(t.sceneHelpers,t.camera),t.renderPass2.clear=!1,t.renderPass2.clearDepth=!1,t.composer.addPass(t.renderPass2));t.renderPass3=new THREE.RenderPass(t.sceneHUD,t.cameraHUD),t.renderPass3.clear=!1,t.renderPass3.clearDepth=!1,t.composer.addPass(t.renderPass3),t.bleachShader=new THREE.ShaderPass(THREE.BleachBypassShader),t.composer.addPass(t.bleachShader),t.bloomPass=new THREE.UnrealBloomPass(new THREE.Vector2(t.width,t.height),2.5,.45,.88),t.composer.addPass(t.bloomPass),t.dotScreenShader=new THREE.ShaderPass(THREE.DotScreenShader),t.dotScreenShader.uniforms.scale.value=4,t.composer.addPass(t.dotScreenShader),t.glitchPass=new THREE.GlitchPass(0),t.composer.addPass(t.glitchPass),t.sepiaShader=new THREE.ShaderPass(THREE.SepiaShader),t.composer.addPass(t.sepiaShader),t.outlinePass=new THREE.OutlinePass(new THREE.Vector2(t.width,t.height),t.scene,t.camera),t.composer.addPass(t.outlinePass),(new THREE.TextureLoader).load("images/tri_pattern.jpg",function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,t.outlinePass.patternTexture=e}),e.FXAAEnabled=!0,t.FXAAShader=new THREE.ShaderPass(THREE.FXAAShader),t.FXAAShader.uniforms.resolution.value.set(1/t.width,1/t.height),t.composer.addPass(t.FXAAShader),t.ssaoPass=new THREE.SSAOPass(t.scene,t.camera,t.width,t.height),t.composer.addPass(t.ssaoPass),t.godRaysPass=new d.GodRaysPass(t.scene,t.camera,t.width,t.height),t.composer.addPass(t.godRaysPass),t.bokehPass=new THREE.BokehPass(t.scene,t.camera,{width:t.width,height:t.height,vignetting:1}),t.composer.addPass(t.bokehPass),t.vignetteShader=new THREE.ShaderPass(THREE.VignetteShader),t.composer.addPass(t.vignetteShader),t.copyShader=new THREE.ShaderPass(THREE.CopyShader),t.copyShader.renderToScreen=!0,t.composer.addPass(t.copyShader),t.bleachShader.enabled=e.bleachEnabled||!1,t.bloomPass.enabled=e.bloomEnabled||!1,t.dotScreenShader.enabled=e.dotScreenEnabled||!1,t.glitchPass.enabled=e.glitchEnabled||!1,t.sepiaShader.enabled=e.sepiaEnabled||!1,t.outlinePass.enabled=e.outlineEnabled||!1,t.FXAAShader.enabled=e.FXAAEnabled||!1,t.ssaoPass.enabled=e.ssaoEnabled||!1,t.godRaysPass.enabled=e.godRaysEnabled||!1,t.bokehPass.enabled=e.bokehEnabled||!1,t.vignetteShader.enabled=e.vignetteEnabled||!1}(e),this.cameraEffect=function(e){void 0!==this.effect&&this.effect instanceof THREE.AnaglyphEffect&&this.effect.dispose(),this.effect=d.createCameraEffect(e,this.renderer),this.effect&&this.effect.setSize(this.width,this.height)},this.cameraEffect(e.effectType),this.fileExplorer=new d.FileExplorer(this),this.dragControls=(o=this.scene.children,s=this.camera,l=this.renderer,c=null,(u=new THREE.DragControls(o,s,l.domElement)).enabled=!1,u.addEventListener("dragstart",function(e){if(this.enabled){var r=e.object;c=r.position.clone(),t.controls.enabled=!1,t.select(r)}}),u.addEventListener("dragend",function(e){if(this.enabled){var r=e.object;void 0!==r&&(c.equals(r.position)||t.setPosition(r,r.position,c)),t.controls.enabled=!0}}),u),this.transformControls=function(e,r){var n=null,i=null,a=null,o=new THREE.TransformControls(e,r.domElement);return o.visible=!0,o.enabled=!0,o.addEventListener("change",function(){var e=o.object;e&&e.helper&&!e.helper instanceof THREE.SkeletonHelper&&e.helper.update()}),o.addEventListener("mouseDown",function(){var e=o.object;n=e.position.clone(),i=e.rotation.clone(),a=e.scale.clone(),t.controls.enabled=!1}),o.addEventListener("mouseUp",function(){var e=o.object;if(void 0!==e)switch(o.getMode()){case"translate":n.equals(e.position)||t.setPosition(e,e.position,n);break;case"rotate":i.equals(e.rotation)||t.setRotation(e,e.rotation,i);break;case"scale":a.equals(e.scale)||t.setScale(e,e.scale,a)}t.controls.enabled=!0}),o}(this.camera,this.renderer),this.transformControls.setSize(.5),this.sceneHelpers.add(this.transformControls),window.addEventListener("orientationchange",function(){[t.widthRatio,t.heightRatio]=[t.heightRatio,t.widthRatio]},!1),window.addEventListener("resize",M,!1),this.dom.addEventListener("click",function(e){t.dom.focus()},!1),this.dom.addEventListener("dblclick",function(e){t.mouseDoubleClickPosition.copy(S(e));var r=t.getIntersectObject("mouseDoubleClick");r&&t.focus(r)},!1),this.dom.addEventListener("mousemove",function(e){t.mouseMovePosition.copy(S(e)),t.bokehPass&&t.bokehPass.enabled&&t.bokehPass.mouse.copy(t.mouseMovePosition)},!1),this.dom.addEventListener("mousedown",function(e){t.mouseDownPosition.copy(S(e)),document.addEventListener("mouseup",L,!1)},!1),this.dom.addEventListener("touchmove",function(e){e.preventDefault(),f&&clearTimeout(f);t.mouseMovePosition.copy(S(e)),t.bokehPass&&t.bokehPass.enabled&&t.bokehPass.mouse.copy(t.mouseMovePosition)},!0),this.dom.addEventListener("touchstart",function(e){t.guiContextMenu&&t.guiContextMenu.setDisplay("none");if(e.preventDefault(),m)return;f=setTimeout(H,500,e),m=!0,t.mouseDownPosition.copy(S(e)),document.addEventListener("touchend",C,!1)},!1),this.dom.addEventListener("keydown",k,!1),this.dom.addEventListener("keyup",function(e){switch(e.preventDefault(),e.stopPropagation(),e.keyCode){case 17:t.transformControls.setTranslationSnap(null),t.transformControls.setRotationSnap(null),t.controls.enabled=!0}},!1),this.dom.addEventListener("contextmenu",I,!1),this.renderScene=function(){T()},this.onKeyDown=function(e){k(e)},this.getBoundingBox=function(){return d.computeBoundingBox(this.scene)},this.getMousePosition=function(e){return S(e)},this.getIntersectObject=function(e){if("string"==typeof e){var t;if("mouseDown"===e)t=this.mouseDownPosition;else if("mouseUp"===e)t=this.mouseUpPosition;else{if("mouseDoubleClick"!==e)return null;t=this.mouseDoubleClickPosition}return(r=A(t,this.selectables)).length>0?r[0].object:null}var r;return this.mouseDownPosition.equals(this.mouseUpPosition)&&(r=A(this.mouseUpPosition,this.selectables)).length>0?(void 0!==e&&(e.object=r[0].object,e.distance=r[0].distance,e.point=r[0].point,e.uv=r[0].uv),r[0].object):null},this.select=function(e,r){if(e){var n=e;if("ancestor"===r)e.traverseAncestors(function(e){e.parent===t.scene&&(n=e)}),this.selectObjects=[n];else if("multiple"===r){var i=this.selectObjects.indexOf(n);-1===i?this.selectObjects.push(n):this.selectObjects.splice(i,1)}else this.selectObjects=[n];this.selectObject=n,this.signals.objectSelected.dispatch(n),this.signals.objectsSelected.dispatch(this.selectObjects)}else this.selectObject=null,this.selectObjects=[],this.signals.objectSelected.dispatch(null),this.signals.objectsSelected.dispatch(this.selectObjects)},this.selectById=function(e,t){e!==this.camera.id?this.select(this.scene.getObjectById(e,!0),t):this.select(this.camera,t)},this.selectByUuid=function(e,t){this.scene.traverse(function(r){r.uuid===e&&this.select(r,t)})},this.deselect=function(){this.selectObject=null},this.focus=function(e){this.signals.objectFocused.dispatch(e)},this.focusById=function(e){this.focus(this.scene.getObjectById(e,!0))},this.objectByUuid=function(e){return this.scene.getObjectByProperty("uuid",e)},this.addObject=function(e){e.traverse(function(e){t.addHelper(e)}),this.scene.add(e),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch()},this.removeObject=function(e){null!==e.parent&&(e.traverse(function(e){t.removeHelper(e)}),e.parent.remove(e),this.signals.objectRemoved.dispatch(e),this.signals.sceneGraphChanged.dispatch())},this.addHelper=(h=new THREE.SphereBufferGeometry(2,4,2),p=new THREE.MeshBasicMaterial({color:16711680,visible:!1}),function(e){if(!d.isDeviceMobile()){var t;if(e instanceof THREE.Camera)(t=new THREE.CameraHelper(e)).name="cameraHelper";else if(e instanceof THREE.PointLight)(t=new THREE.PointLightHelper(e,1)).name="pointLightHelper";else if(e instanceof THREE.DirectionalLight)(t=new THREE.DirectionalLightHelper(e,1)).name="directionalLightHelper","SunLight"===e.userData.type&&(t.visible=!1);else if(e instanceof THREE.SpotLight)(t=new THREE.SpotLightHelper(e)).name="spotLightHelper";else if(e instanceof THREE.HemisphereLight)(t=new THREE.HemisphereLightHelper(e,1)).name="hemisphereLightHelper";else{if(!(e instanceof THREE.SkinnedMesh))return;(t=new THREE.SkeletonHelper(e)).name="skeletonHelper"}var r=new THREE.Mesh(h,p);r.name="picker",r.userData.object=e,t.add(r),e.helper=t,this.sceneHelpers.add(t),this.signals.helperAdded.dispatch(t)}}),this.removeHelper=function(e){var t=e.helper;void 0!==t&&(t.parent.remove(t),this.signals.helperRemoved.dispatch(t))},this.getObjectMaterial=function(e,t){var r=void 0;return e&&(r=e.material,Array.isArray(r)&&(r=r[t])),r},this.setObjectMaterial=function(e,t,r){Array.isArray(e.material)?e.material[t]=r:e.material=r},this.clear=function(){this.history.clear(),this.config.clearDatabase(),this.camera.copy(this.defaultCamera);for(var e=this.scene.children;e.length>0;)this.removeObject(e[0]);this.deselect(),this.signals.appWorksCleared.dispatch(),this.signals.windowResize.dispatch()},this.fromJSON=function(e){var t=new THREE.ObjectLoader;if(void 0!==e.scene){var r=t.parse(e.camera);this.camera.copy(r),this.camera.aspect=this.defaultCamera.aspect,this.camera.updateProjectionMatrix(),this.history.fromJSON(e.history),this.setScene(t.parse(e.scene))}else this.setScene(t.parse(e))},this.toJSON=function(){return{metadata:{},camera:this.camera.toJSON(),scene:this.scene.toJSON(),history:this.history.toJSON()}},this.execute=function(e,t){this.history.execute(e,t)},this.undo=function(){this.history.undo()},this.redo=function(){this.history.redo()},this.add=function(e){this.execute(new d.AddObjectCommand(e))},this.remove=function(e){this.execute(new d.RemoveObjectCommand(e))},this.replace=function(e,t){var r=[];r.push(new d.RemoveObjectCommand(e)),r.push(new d.AddObjectCommand(t)),this.multiCmds(r)},this.move=function(e,t,r){e.parent?this.execute(new d.MoveObjectCommand(e,t,r)):Alert("The object cannot be moved to the new parent")},this.moveTo=function(e,t,r){this.add(e),this.move(e,t,r)},this.setPosition=function(e,t,r){this.execute(new d.SetPositionCommand(e,t,r))},this.setRotation=function(e,t,r){this.execute(new d.SetRotationCommand(e,t,r))},this.setScale=function(e,t,r){this.execute(new d.SetScaleCommand(e,t,r))},this.setGeometry=function(e,t){this.execute(new d.SetGeometryCommand(e,t))},this.setGeometryValue=function(e,t,r){this.execute(new d.SetGeometryValueCommand(e,t,r))},this.setMaterial=function(e,t,r){this.execute(new d.SetMaterialCommand(e,t,r))},this.setMaterialValue=function(e,t,r,n){this.execute(new d.SetMaterialValueCommand(e,t,r,n))},this.setMaterialColor=function(e,t,r,n){this.execute(new d.SetMaterialColorCommand(e,t,r,n))},this.setMaterialMap=function(e,t,r,n){this.execute(new d.SetMaterialMapCommand(e,t,r,n))},this.setUuid=function(e,t){this.execute(new d.SetUuidCommand(e,t))},this.setValue=function(e,t,r){this.execute(new d.SetValueCommand(e,t,r))},this.setColor=function(e,t,r){this.execute(new d.SetColorCommand(e,t,r))},this.setScene=function(e){this.execute(new d.SetSceneCommand(e))},this.multiCmds=function(e){this.execute(new d.MultiCmdsCommand(e))},d.renderer=this.renderer,d.scene=this.scene,d.camera=this.camera,d.appWorks=this},d.createBackground=function(e){if(e.isTexture)return e;if("number"==typeof e)return new THREE.Color(e);if("string"==typeof e)return"FS"===e.substr(-2,2)?function(e){var t=new THREE.Vector2;d.renderer.getSize(t);var r=d.BackgroundShader;(o=THREE.UniformsUtils.clone(r.uniforms)).resolution.value=t;var n=r.vertexShader,i=r[e],a=new THREE.ShaderMaterial({uniforms:o,vertexShader:n,fragmentShader:i});if("cloudsFS"===e){var o=a.uniforms,s=new THREE.TextureLoader,l=s.load("images/raymarch/rgbaNoise256.png",function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping});o.textureMaps.value.push(l)}a.extensions={derivatives:!0,fragDepth:!0,drawBuffers:!0,shaderTextureLOD:!0};var c=new THREE.PlaneBufferGeometry(2,2);return(e=new THREE.Mesh(c,a)).name="backgroundMesh",e.frustumCulled=!1,e.update=function(e,r){d.renderer.getSize(t);var n=this.material.uniforms;n.time.value=r,n.resolution.value=t},e}(e):function(e){var t=".jpg",r="images/background/"+e+"/";switch(e){case"cloud":case"galaxy":case"redSky":case"smallLake":t=".png";break;default:t=".jpg"}var n=["posx"+t,"negx"+t,"posy"+t,"negy"+t,"posz"+t,"negz"+t];return(new THREE.CubeTextureLoader).setPath(r).load(n)}(e)},d.createBackgroundPMREM=function(e,t){t=void 0!==t?t:d.renderer;var r=new THREE.PMREMGenerator(e);r.update(t);var n=new THREE.PMREMCubeUVPacker(r.cubeLods);return n.update(t),n.CubeUVRenderTarget?n.CubeUVRenderTarget.texture:null},d.createFog=function(e){var t=void 0!==(e=e||{}).color?e.color:d.FOG_COLOR;if("linear"===e.type){var r=void 0!==e.near?e.near:this.camera.near,n=void 0!==e.far?e.far:this.camera.far;return new THREE.Fog(t,r,n)}if("exp2"===e.type){var i=void 0!==e.density?e.density:.001;return new THREE.FogExp2(t,i)}return null},d.createCameraControls=function(e,t,r){var n;e=void 0!==e?e:"OrbitControls",t=void 0!==t?t:d.camera,r=void 0!==r?r:d.renderer.domElement;return"TrackballControls"===e?((n=new THREE.TrackballControls(t,r)).target=this.scene.position,n.rotateSpeed=2,n.zoomSpeed=1,n.panSpeed=.4,n.staticMoving=!1,n.dynamicDampingFactor=.2,n.enabled=!0):"FirstPersonControls"===e?((n=new THREE.FirstPersonControls(t,r)).movementSpeed=100,n.lookSpeed=.05,n.lookVertical=!0,n.activeLook=!0,n.constrainVertical=!0,n.verticalMin=1.1,n.verticalMax=2.2,n.enabled=!0):((n=new THREE.OrbitControls(t,r)).enablePan=!0,n.enableZoom=!0,n.enableDamping=!0,n.screenSpacePanning=!0,n.dampingFactor=.1,n.panSpeed=.1,n.rotateSpeed=.07,n.enabled=!0),n},d.playAudio=function(e,t){if(!(Array.isArray(e)&&e.length>0))return null;var r=new R.Howl({src:[e[0]],autoplay:!0,loop:!0,volume:.5,onend:function(){e.shift(),e.length>0&&d.playAudio(e)}});return r.play(),r},d.createCameraEffect=function(e,t){e=void 0!==e?e:"NoEffect",t=void 0!==t?t:d.renderer;return"AnaglyphEffect"===e?new THREE.AnaglyphEffect(t):"StereoEffect"===e?new THREE.StereoEffect(t):"ParallaxBarrierEffect"===e?new THREE.ParallaxBarrierEffect(t):null},d.Animation=function(e){e=void 0!==e?e:d.scene;this.mixer=new THREE.AnimationMixer(e),this.update=function(e){this.mixer.update(e)},this.addAnimation=function(e,t){t.length>0&&(e.animations=t)},this.createActions=function(e){var t={},r=e.animations;if(void 0!==r){for(var n of r)t[n.name]=this.mixer.clipAction(n,e),e.activeAction||(e.activeAction=t[n.name]);return t}},this.playAction=function(e,t,r){var n=(r=r||{}).duration||1,i=r.loopMode||THREE.LoopRepeat,a=r.repetitions||1/0,o=r.combine||"crossFade";e=void 0!==e?e:d.appWorks.selectObject,t=void 0!==t?t:e.animations[0];if("crossFade"==o){var s=e.activeAction,l=this.mixer.clipAction(t,e);return l?(l.enabled=!0,l.setLoop(i,a),s?(s.enabled=!0,s.crossFadeTo(l,n).play()):l.play(),e.activeAction=l,l):void 0}if("overlap"===o){var c=this.mixer.clipAction(t,e);return c.play(),e.activeAction=c,c}},this.playNextAction=function(e){var t=(e=void 0!==e?e:d.appWorks.selectObject).animations;if(void 0!==t){var r=-1;if(e.activeAction){var n=e.activeAction.getClip();r=t.indexOf(n)}var i=t[r=~~((r+1)%t.length)];e.activeAction=this.playAction(e,i),console.log('>> playAction: "'+i.name+'"')}},this.stopAction=function(e,t){if(e&&t)(r=this.mixer.clipAction(t,e)).enabled=!0,r.stop();else if(e&&!t){var r;(r=e.activeAction)&&(r.enabled=!0,r.stop())}},this.stopAllActions=function(){this.mixer.stopAllAction()}},d.createAmbientLight=function(e){var t=(e=e||{}).color||16777215,r=e.intensity||.2,n=new THREE.AmbientLight(t,r);return n.name="ambientLight",n},d.createPointLight=function(e){var t=(e=e||{}).color||16777215,r=e.intensity||1,n=e.distance||0,i=e.decay||2,a=new THREE.PointLight(t,r,n,i);return a.position.set(0,10,0),a.castShadow=!0,a.name="pointLight",a},d.createSpotLight=function(e){var t=(e=e||{}).color||16777215,r=e.intensity||1,n=e.distance||0,i=e.angle||.1*Math.PI,a=e.penumbra||.05,o=e.decay||2,s=e.target,l=new THREE.SpotLight(t,r,n,i,a,o);return l.position.set(0,10,0),l.castShadow=!0,l.name="spotLight",s&&s.isObject3D&&(l.target=s,d.scene.getObjectById(s.id)||d.add(s)),l},d.createDirectionalLight=function(e){var t=(e=e||{}).color||16777215,r=e.intensity||1,n=e.target,i=e.shadowCameraSize||.2*d.camera.far,a=e.shadowMapSize||new THREE.Vector2(1024,1024),o=new THREE.DirectionalLight(t,r);return o.position.set(0,10,0),o.castShadow=!0,o.shadow.camera.top=i,o.shadow.camera.bottom=-i,o.shadow.camera.left=-i,o.shadow.camera.right=i,o.shadow.camera.near=.01,o.shadow.camera.far=2.5*i,o.shadow.mapSize.copy(a),o.shadow.bias=1e-4,o.name="directionalLight",n&&n.isObject3D&&(o.target=n,d.scene.getObjectById(n.id)||d.add(n)),o},d.createHemisphereLight=function(e){var t=(e=e||{}).skyColor||(new THREE.Color).setHSL(.6,1,.6),r=e.groundColor||(new THREE.Color).setHSL(.095,1,.75),n=e.intensity||1,i=new THREE.HemisphereLight(t,r,n);return i.position.set(0,10,0),i.name="hemisphereLight",i},d.createThreePointLights=function(){var e,t=new THREE.Object3D;return t.name="threePointLights",(e=d.createAmbientLight({color:1052688})).name="ambient_light",t.add(e),(e=d.createDirectionalLight({color:16777215,intensity:.225})).position.set(26,10,30),e.name="back_light",t.add(e),(e=d.createDirectionalLight({color:16777215,intensity:.375})).position.set(-20,-10,0),e.name="key_light",t.add(e),(e=d.createDirectionalLight({color:16777215,intensity:.75})).position.set(30,30,20),e.name="fill_light",t.add(e),t},d.createSunsetLights=function(){var e,t=new THREE.Object3D;return t.name="sunsetLights",(e=d.createAmbientLight({color:526344})).name="ambient_light",t.add(e),(e=d.createDirectionalLight({color:1644912,intensity:1})).name="midnightblue_light",e.position.set(50,10,0),t.add(e),(e=d.createDirectionalLight({color:9109504,intensity:1.5})).name="darkred_light",t.add(e),t},d.createThreeSpotLights=function(e,t){t=t||{},e=void 0!==e?e:100;var r=new THREE.Object3D;r.name="threeSpotLights";var n=2*Math.PI,i=Math.PI/3,a=Math.PI/6,o=Math.cos(a),s=Math.sin(a),l=.6*e,c=d.createSpotLight();c.position.set(0,l,e),r.add(c),t.target&&(c.target=t.target),!0===t.rotate&&(c.update=function(t,r){var i=.1*r%n;c.position.x=e*Math.sin(i),c.position.z=e*Math.cos(i)});var u=d.createSpotLight();u.position.set(-e*o,l,-e*s),r.add(u),t.target&&(u.target=t.target),!0===t.rotate&&(u.update=function(t,r){var a=.1*r%n;u.position.x=e*-Math.sin(a+i),u.position.z=e*-Math.cos(a+i)});var h=d.createSpotLight();return h.position.set(e*o,l,-e*s),r.add(h),t.target&&(h.target=t.target),!0===t.rotate&&(h.update=function(t,r){var i=.1*r%n;h.position.x=e*Math.cos(i+a),h.position.z=e*-Math.sin(i+a)}),r},d.createPointLightFlare=(x=new THREE.TextureLoader,b=x.load("images/lensflare/lensflare0.png"),T=x.load("images/lensflare/lensflare3.png"),function(e){var t=(e=e||{}).flareSize||700,r=d.createPointLight(e);r.name="pointLightFlare";var n=new THREE.Lensflare;return n.name="lensflare",n.addElement(new THREE.LensflareElement(b,t,0,r.color)),n.addElement(new THREE.LensflareElement(T,.086*t,.6)),n.addElement(new THREE.LensflareElement(T,.1*t,.7)),n.addElement(new THREE.LensflareElement(T,.17*t,.9)),n.addElement(new THREE.LensflareElement(T,.1*t,1)),r.add(n),r}),d.loadJSON=function(e){function t(t,r){var n,i=new THREE.LegacyJSONLoader(e.manager).parse(t,r),a=i.geometry;if(a instanceof THREE.Geometry&&(a.morphTargets.length>0||a.skinIndices.length>0)){a=d.toNonIndexedBufferGeometry(i.geometry);var o=i.geometry.animations;o&&(a.animations=o)}var s=i.materials;if(function(e,t){var r=THREE.NoColors;if(e instanceof THREE.Geometry){var n=!1,i=!1;e.faces[0].vertexColors.length>0&&(n=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),r=n?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(r=THREE.VertexColors);t.forEach(function(e){e.vertexColors=r})}(a,s),a instanceof THREE.BufferGeometry&&a.attributes.skinIndex){n=new THREE.SkinnedMesh(a,s);for(var l=[],c=t.bones,u=0,h=c.length;u<h;u++){var p=(new THREE.Vector3).fromArray(c[u].pos),f=(new THREE.Quaternion).fromArray(c[u].rotq),m=new THREE.Bone;m.position.copy(p),m.quaternion.copy(f),m.name=c[u].name,l.push(m)}var v=new THREE.Skeleton(l);n.bind(v)}else n=new THREE.Mesh(a,s);return a.animations&&(s.forEach(function(e){e.morphTargets=!0}),a.animations.length>0&&(n.animations=a.animations)),n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,n}function r(r,n){var i;switch(void 0===r.metadata&&(r.metadata={type:"Geometry"}),void 0===r.metadata.type&&(r.metadata.type="Geometry"),void 0!==r.metadata.formatVersion&&(r.metadata.version=r.metadata.formatVersion),r.metadata.type.toLowerCase()){case"buffergeometry":i=function(t){var r=new THREE.BufferGeometryLoader(e.manager).parse(t);return mesh=new THREE.Mesh(r),mesh.castShadow=!0,mesh.receiveShadow=!0,mesh.name=e.url,mesh}(r);break;case"geometry":i=t(r,n);break;case"object":i=function(t,r){var n=new THREE.ObjectLoader(e.manager);n.setPath(r),n.setResourcePath(r);var i=n.parse(t);return i instanceof THREE.Scene?(d.appWorks.setScene(i),i.name=e.url):(i.castShadow=!0,i.receiveShadow=!0,i.name=e.url),i}(r,n)}e.callback&&e.callback(i)}var n=e.basePath||"models/";new THREE.FileLoader(e.manager).load(e.url,function(e){r(JSON.parse(e),n)})},d.loadOBJ=function(e){var t=e.obj||null,r=e.mtl||null,n=e.basePath||"";function i(t,r,n){var i=new THREE.OBJLoader(e.manager);i.setPath(t),n&&i.setMaterials(n),i.load(r,function(n){n.traverse(function(e){e instanceof THREE.Mesh&&(e.castShadow=!0,e.receiveShadow=!0)}),n.name=t+r,e.callback&&e.callback(n)},function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}},function(e){console.log("OBJLoader: error happened")})}if(r){var a=new THREE.MTLLoader(e.manager);a.setPath(n),a.load(r,function(e){e.preload(),i(n,t,e)})}else i(n,t)},d.loadSTL=function(e){new THREE.STLLoader(e.manager).load(e.url,function(t){!function(t){var r;r=t.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var n=new THREE.Mesh(t,r);n.castShadow=!0,n.receiveShadow=!0,n.name=e.url,e.callback&&e.callback(n)}(t)})},d.loadPLY=function(e){new THREE.PLYLoader(e.manager).load(e.url,function(t){!function(t){t.computeVertexNormals();var r=new THREE.Mesh(t,new THREE.MeshStandardMaterial);r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)})},d.loadDAE=function(e){new THREE.ColladaLoader(e.manager).load(e.url,function(t){!function(t){var r=t.scene;t.animations.length>0&&(r.animations=t.animations),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)})},d.loadGLB=function(e){THREE.DRACOLoader.setDecoderPath("js/draco/gltf/");var t=new THREE.GLTFLoader(e.manager);t.setDRACOLoader(new THREE.DRACOLoader(e.manager)),t.load(e.url,function(t){!function(t){var r=t.scene||t.scenes[0],n=t.animations||[],i=d.scene.background;i&&i.isCubeTexture&&r.traverse(function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)}),n.length>0&&(r.animations=n),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)},void 0,function(e){console.error(e)})},d.loadGLTF=function(e){new THREE.GLTFLoader(e.manager).load(e.url,function(t){!function(t){var r=t.scene||t.scenes[0],n=t.animations||[],i=d.scene.background;i&&i.isCubeTexture&&r.traverse(function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)}),n.length>0&&(r.animations=n),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)},void 0,function(e){console.error(e)})},d.loadAMF=function(e){new THREE.AMFLoader(e.manager).load(e.url,function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)})},d.load3MF=function(e){var t=new THREE.ThreeMFLoader(e.manager);t.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),t.load(e.url,function(t){!function(t){t.castShadow=!0,t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)})},d.loadWRL=function(e){new THREE.VRMLLoader(e.manager).load(e.url,function(t){!function(t){t.traverse(function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))}),t.receiveShadow=!0,t.name=e.url,e.callback&&e.callback(t)}(t)})},d.loadFBX=function(e){var t=new THREE.FBXLoader(e.manager),r=e.basePath||"";t.setPath(r),t.setResourcePath(r),t.load(e.url,function(t){!function(t){var r=t;r.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.name=e.url,e.callback&&e.callback(r)}(t)})},d.FileExplorer=function(e){e=e||d.appWorks;var t=this;function r(e,t){return"number"==typeof t?parseFloat(t.toFixed(6)):t}this.basePath="models/",this.openFile=function(){this.fileInput.click()},this.saveAsFile=function(e){this.fileOutput.fileExtension=e,this.fileOutput.click()},this.fileOutput=document.createElement("div"),this.fileOutput.addEventListener("click",function(){var e=t.fileOutput.fileExtension;t.saveFile("model."+e)}),this.saveFile=function(r){var n,i=r.split(".").pop().toLowerCase();switch("natureWorks"===e.appName?((n=new THREE.Object3D).name=e.appName,e.scene.children.forEach(function(e){n.add(d.cloneObject(e))})):n=e.scene,i){case"json":!function(e,r){t.saveObject(e,r)}(n,r);break;case"obj":!function(e,t){var t=t||"model.obj";a((new THREE.OBJExporter).parse(e),t)}(n,r);break;case"dae":!function(e,t){var t=t||"scene.dae";(new THREE.ColladaExporter).parse(e,function(e){a(e.data,t)})}(n,r);break;case"glb":!function(e,t){var t=t||"scene.glb";(new THREE.GLTFExporter).parse(e,function(e){o(e,t)},{binary:!0,forceIndices:!0,forcePowerOfTwoTextures:!0})}(n,r);break;case"gltf":!function(e,t){var t=t||"scene.gltf";(new THREE.GLTFExporter).parse(e,function(e){a(JSON.stringify(e,null,2),t)})}(n,r);break;case"stl":!function(e,t,r){var t=t||"model.stl",n=new THREE.STLExporter;!0===r?a(n.parse(e),t):o(n.parse(e,{binary:!0}),t)}(n,r);break;case"ply":!function(e,t){var t=t||"model.ply";a((new THREE.PLYExporter).parse(e),t)}(n,r);break;default:alert('The file type "'+i+'" is not supported.')}},this.saveGeometry=function(e,t){t=t||"geometry.json";var n=e.toJSON();try{n=(n=JSON.stringify(n,r,"\t")).replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){n=JSON.stringify(n)}a(n,t)},this.saveObject=function(e,t){t=t||"object.json";var n=e.toJSON();try{n=(n=JSON.stringify(n,r,"\t")).replace(/[\n\t]+([\d\.e\-\[\]]+)/g,"$1")}catch(e){n=JSON.stringify(n)}a(n,t)};var n=document.createElement("a");function i(e,t){n.href=URL.createObjectURL(e),n.download=t||"data.json",n.dispatchEvent(new MouseEvent("click"))}function a(e,t){i(new Blob([e],{type:"text/plain"}),t)}function o(e,t){i(new Blob([e],{type:"application/octet-stream"}),t)}var s=document.createElement("input");s.type="file",s.multiple=!0,s.style.display="none",this.fileInput=s,s.addEventListener("change",function(e){const r=[].slice.call(s.files),n=new Map;r.forEach(e=>n.set(e.name,e)),t.loadFiles(n)});var l=e.dom;l.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),l.classList.add("dragover")}),l.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation(),l.classList.remove("dragover")}),l.addEventListener("drop",function(e){let r;if(e.stopPropagation(),e.preventDefault(),e.dataTransfer.items)r=[].slice.call(e.dataTransfer.items).map(e=>e.webkitGetAsEntry());else if(1===(e.dataTransfer.files||[]).length){const r=e.dataTransfer.files[0];return"application/zip"===r.type?void alert("zip file: not supported"):void t.loadFiles(new Map([[r.name,r]]))}r||alert("Required drag & drop is not supported in this browser."),1===r.length&&r[0].name.match(/\.zip$/)?alert("zip file: not supported"):function e(r,n){const i=n.pop();if(!i)return void t.loadFiles(r);if(i.isFile)i.file(t=>{r.set(i.fullPath,t),e(r,n)},()=>console.error("Could not load file: %s",i.fullPath));else if(i.isDirectory){const t=i.createReader(),a=i=>{i.length?(n=n.concat(i),t.readEntries(a)):e(r,n)};t.readEntries(a)}else console.warn("Unknown asset type: "+i.fullPath),e(r,n)}(new Map,r)},!1),this.loadFiles=function(e){for(var r of e.values())console.log("Loading:",r.name,"("+d.humanFileSize(r.size)+")");var n;let i,a;Array.from(e).forEach(([e,t])=>{(t.name.match(/\.(js|json|obj|stl|ply|dae|gltf|glb|amf|3mf|wrl|fbx)$/)||t.name.match(/\.(JS|JSON|OBJ|STL|PLY|DAE|GLTF|GLB|AMF|3MF|WRL|FBX)$/))&&(i=t,a=e.replace(t.name,""),n=t.name.split(".").pop().toLowerCase())}),i||console.warn("No asset found.");const o="string"==typeof i?i:URL.createObjectURL(i),s=THREE.LoaderUtils.extractUrlBase(o);return new Promise((r,l)=>{const c=[],u=new THREE.LoadingManager;switch(u.onStart=()=>{d.createProgressbar()},u.onProgress=(e,t,r)=>{d.updateProgressbar(t,r)},u.onLoad=()=>{d.hideProgressbar()},u.onError=e=>{d.errorProgressbar("There was an error loading "+e)},u.setURLModifier((t,r)=>{const n=a+t.replace(s,"").replace(/^(\.?\/)/,"");if(e.has(n)){const t=e.get(n),r=URL.createObjectURL(t);return c.push(r),r}return(r||"")+t}),n){case"js":case"json":!function(e,n){function a(e,t,r){var n,i=new THREE.LegacyJSONLoader(t),a=i.parse(e,r),o=a.geometry;if(o instanceof THREE.Geometry&&(o.morphTargets.length>0||o.skinIndices.length>0)){o=d.toNonIndexedBufferGeometry(a.geometry);var s=a.geometry.animations;s&&(o.animations=s)}var l=a.materials;if(function(e,t){var r=THREE.NoColors;if(e instanceof THREE.Geometry){var n=!1,i=!1;e.faces[0].vertexColors.length>0&&(n=!0),e.faces[0].color.equals(new THREE.Color)||(i=!0),r=n?THREE.VertexColors:i?THREE.FaceColors:THREE.NoColors}else e.attributes.color&&(r=THREE.VertexColors);t.forEach(function(e){e.vertexColors=r})}(o,l),o instanceof THREE.BufferGeometry&&o.attributes.skinIndex){n=new THREE.SkinnedMesh(o,l);for(var c=[],u=e.bones,h=0,f=u.length;h<f;h++){var m=(new THREE.Vector3).fromArray(u[h].pos),v=(new THREE.Quaternion).fromArray(u[h].rotq),g=new THREE.Bone;g.position.copy(m),g.quaternion.copy(v),g.name=u[h].name,c.push(g)}var y=new THREE.Skeleton(c);n.bind(y)}else n=new THREE.Mesh(o,l);return o.animations&&(l.forEach(function(e){e.morphTargets=!0}),o.animations.length>0&&(n.animations=o.animations)),p(n),n}function o(e,t,r){switch(void 0===e.metadata&&(e.metadata={type:"Geometry"}),void 0===e.metadata.type&&(e.metadata.type="Geometry"),void 0!==e.metadata.formatVersion&&(e.metadata.version=e.metadata.formatVersion),e.metadata.type.toLowerCase()){case"buffergeometry":(function(e,t){var r=new THREE.BufferGeometryLoader(t).parse(e);return mesh=new THREE.Mesh(r),p(mesh),mesh})(e,t);break;case"geometry":a(e,t,r);break;case"object":(function(e,t,r){var n=new THREE.ObjectLoader(t);n.setPath(r),n.setResourcePath(r);var a=n.parse(e);a instanceof THREE.Scene?(d.appWorks.setScene(a),a.name=i.name):"natureWorks"===d.appWorks.appName&&a.children.length>0?a.children.forEach(function(e){d.add(d.cloneObject(e))}):p(a);return a})(e,t,r)}}new THREE.FileLoader(n).load(e,e=>{var i=JSON.parse(e);o(i,n,t.basePath),r(e)},h,l)}(o,u);break;case"obj":!function(t,n){var i;for(var a of e.values())if(a.name.match(/\.(mtl|MTL)$/)){i=a;break}function o(e){var i=new THREE.OBJLoader(n);e&&i.setMaterials(e),i.load(t,e=>{p(e),r(e)},h,l)}!function(e){if(void 0!==e){const i=URL.createObjectURL(e);var t=new THREE.MTLLoader(n);t.load(i,e=>{e.preload(),o(e),r(e)},h,l)}else o()}(i)}(o,u);break;case"stl":!function(e,t){new THREE.STLLoader(t).load(e,e=>{var t;t=e.hasColors?new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors}):new THREE.MeshStandardMaterial;var n=new THREE.Mesh(e,t);p(n),r(e)},h,l)}(o,u);break;case"ply":!function(e,t){new THREE.PLYLoader(t).load(e,e=>{e.computeVertexNormals();var t=new THREE.Mesh(e,new THREE.MeshStandardMaterial);p(t),r(e)},h,l)}(o,u);break;case"dae":!function(e,t){new THREE.ColladaLoader(t).load(e,e=>{var t=e.scene;e.animations.length>0&&(t.animations=e.animations),p(t),r(e)},h,l)}(o,u);break;case"gltf":case"glb":!function(e,t){THREE.DRACOLoader.setDecoderPath("js/draco/gltf/");const n=new THREE.GLTFLoader(t);n.setCrossOrigin("anonymous"),n.setDRACOLoader(new THREE.DRACOLoader),n.load(e,e=>{var t=e.scene||e.scenes[0],n=e.animations||[],i=d.scene.background;i&&i.isCubeTexture&&t.traverse(function(e){var t=e.material;t&&(t.isMeshStandardMaterial||t.isShaderMaterial&&void 0!==t.envMap)&&(t.envMap=i,t.needsUpdate=!0)}),n.length>0&&(t.animations=n),p(t),c.forEach(URL.revokeObjectURL),r(e)},h,l)}(o,u);break;case"amf":!function(e,t){new THREE.AMFLoader(t).load(e,e=>{p(e),r(e)},h,l)}(o,u);break;case"3mf":!function(e,t){var n=new THREE.ThreeMFLoader(t);n.addExtension(THREE.ThreeMFLoader.MaterialsAndPropertiesExtension),n.load(e,e=>{p(e),r(e)},h,l)}(o,u);break;case"wrl":!function(e,t){new THREE.VRMLLoader(t).load(e,e=>{e.traverse(function(e){e instanceof THREE.Mesh&&(e.material.map?(e.material.color.setHex(16777215),e.material.vertexColors=THREE.NoColors):e.geometry.attributes.color&&(e.material.vertexColors=THREE.VertexColors,e.material.color.setHex(16777215)))}),p(e),r(e)},h,l)}(o,u);break;case"fbx":!function(e,t){new THREE.FBXLoader(t).load(e,e=>{e.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),p(e),r(e)},h,l)}(o,u);break;default:alert("Unsupported file format ("+n+").")}function h(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% loaded")}}function p(e){e.name=i.name,d.add(e),d.welcomeObject(e)}})}},d.HGTLoader=function(){this.loadTile=function(e,t,r){var n=this,i=new THREE.TextureLoader;i.crossOrigin=!0;i.load("https://maps.googleapis.com/maps/api/staticmap?center="+e+","+t+"&zoom="+r+"&size=512x512&scale=2&maptype=satellite&key=AIzaSyA1qxvvl1sFBFLj5rx4cXHJ_1soxQ_GMpw",function(i){var a=new THREE.PlaneBufferGeometry(20,20,128,128),o=new THREE.MeshPhongMaterial({map:i,shading:THREE.SmoothShading});n.heightMapping(a,e,t,r);var s=new THREE.Mesh(a,o);s.rotation.x=-Math.PI/2,s.frustumCulled=!1,s.castShadow=!1,s.receiveShadow=!0,s.name="SRTM.hgt",d.add(s)})},this.heightMapping=function(e,t,r,n){var i=e.attributes.position,a=Math.sqrt(i.count),o=i.array,s=20/(Math.abs(40075160*Math.cos(t*(Math.PI/180)))/Math.pow(2,n-1)),l=360/Math.pow(2,n-1),c=Math.abs(360*Math.cos(t*(Math.PI/180))/Math.pow(2,n-1)),u=t-c/2,h=t+c/2;console.log(u);var d=r-l/2,p=r+l/2;console.log(l),console.log(c);var f=Math.abs(Math.floor(1201*l)),m=Math.abs(Math.floor(1201*c));console.log(f,m);var v=a/f,g=a/m;console.log(g,v);var y,E,x=1200-Math.abs(1200*(h-Math.floor(h))),b=Math.abs(1200*(d-Math.floor(d))),T=1200-Math.abs(1200*(u-Math.floor(u))),w=Math.abs(1200*(p-Math.floor(p)));console.log(x,b);for(var _=Math.floor(h);_>=Math.floor(u);_--)for(var R=Math.floor(d);R<=Math.floor(p);R++){y=_>0?"N"+Math.abs(Math.floor(_)):"S"+Math.abs(Math.floor(_)),E=R>0?R<100?"E0"+Math.abs(Math.floor(R)):"E"+Math.abs(Math.floor(R)):R>=-99?"W0"+Math.abs(Math.floor(R)):"W"+Math.abs(Math.floor(R));var M=0,S=0,A=1200,P=1200;_==Math.floor(u)&&(A=T),_==Math.floor(h)&&(M=x),R==Math.floor(d)&&(S=b),R==Math.floor(p)&&(P=w);var L=Math.floor(h)-_,C=R-Math.floor(d),H=0;L>0&&(H=1201-x+1201*(L-1));var I=0;C>0&&(I=1201-b+1201*(C-1));var k=new XMLHttpRequest;k.start_row=M,k.start_column=S,k.end_row=A,k.end_column=P,k.passed_rows=H,k.passed_columns=I;var O=Math.round(H/m*a),N=Math.round((H+A-M)/m*a);N=Math.min(N,500);var F=Math.round(I/f*a),D=Math.round((I+P-S)/f*a);D=Math.min(D,500),k.filename="models/hgt/"+y+E+".hgt",k.start_i=O,k.end_i=N,k.start_j=F,k.end_j=D,k.open("GET","models/hgt/"+y+E+".hgt",!0),k.responseType="arraybuffer",k.onload=function(t){var r=this.response;if(2884802==r.byteLength){new Int16Array(r);var n=new DataView(r),l=0,c=0;console.log(this.filename),console.log(this.start_row,this.start_column),console.log("Vertex rows:",this.start_i,this.end_i),console.log("Vertex columns:",this.start_j,this.end_j),console.log("Passed rows/columns:",this.passed_rows,this.passed_columns);for(var u=this.start_i;u<=this.end_i;u++){l=u/g;for(var h=this.start_j;h<=this.end_j;h++){c=h/v;var d=0,p=0;l>=this.passed_rows&&(d=(x+l)%1201),c>=this.passed_columns&&(p=(b+c)%1201),p=Math.min(1200,p),d=Math.min(1200,d);var f,m,y,E,T=p-Math.round(p),w=d-Math.round(d);d=Math.round(d),p=Math.round(p),u==this.start_i&&console.log("Start vertex row "+this.start_i+" at file row "+d),h==this.start_j&&console.log("Start vertex column "+this.start_j+" at file column "+p),u==this.end_i&&console.log("End vertex row "+this.end_i+" at file row "+d),h==this.end_j&&console.log("End vertex column "+this.end_j+" at file column "+p),f=Math.floor(1201*d+p),m=p<1200?Math.floor(1201*d+p+1):Math.floor(1201*d+p),y=d<1200?Math.floor(1201*(d+1)+p):Math.floor(1201*d+p),E=d<1200&&p<1200?Math.floor(1201*(d+1)+p+1):Math.floor(1201*d+p);var _=n.getInt16(2*f,!1),R=n.getInt16(2*m,!1),M=(1-T)*(1-w)*_+(1-T)*w*n.getInt16(2*y,!1)+T*(1-w)*R+T*w*n.getInt16(2*E,!1);o[3*(u*a+h)+2]=M*s}}i.needsUpdate=!0,e.computeVertexNormals()}},k.send(null)}}},d.createBirdBasic=function(e,t){e=e||10,t=t||4;var r=new THREE.BufferGeometry,n=.4*e,i=.6*e,a=.5*i,o=new Float32Array([0,-0,-n,0,.08*e,-n,0,0,i,0,0,-a,-t,0,0,0,0,a,0,0,a,t,0,0,0,0,-a]);r.addAttribute("position",new THREE.BufferAttribute(o,3));var s=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide}),l=new THREE.Mesh(r,s);return l.castShadow=!0,l.receiveShadow=!0,l.name="birdBasic",l},d.createEyeball=function(e){e=e||5;var t=new THREE.Mesh(new THREE.SphereBufferGeometry(e,32,16),new THREE.ShaderMaterial({uniforms:{eyeTex:{value:(new THREE.TextureLoader).load("images/eye.jpg")}},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normal;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D eyeTex;","varying vec3 vNormal;","void main() {","vec2 uv = normalize( vNormal ).xy * 0.5 + 0.5;","vec3 color = texture2D( eyeTex, uv ).rgb;","if ( vNormal.z < - 0.85 ) color = vec3( 0.777, 0.74, 0.74 ); // back of eye","gl_FragColor = vec4( color, 1.0 );","}"].join("\n")}));return t.castShadow=!0,t.receiveShadow=!0,t.name="eyeball",t},d.createLowPolyTree=function(e,t,r){function n(e,t,r,n,i){for(var a,o,s=new THREE.Vector3,l=e[0].clone(),c=0;c<t;c++)s=e[c+(a=r*t+1)].clone(),l.y=s.y,o=s.sub(l),i?c%2==0?(o.normalize().multiplyScalar(n/6),e[c+a].add(o)):(o.normalize().multiplyScalar(n),e[c+a].add(o),e[c+a].y=e[c+a+t].y+.05):c%2!=0?(o.normalize().multiplyScalar(n/6),e[c+a].add(o)):(o.normalize().multiplyScalar(n),e[c+a].add(o),e[c+a].y=e[c+a+t].y+.05)}function i(e,t,r){for(var n,i,a=new THREE.Vector3,o=e[0].clone(),s=0;s<t;s++)a=e[s+(n=r*t+1)].clone(),o.y=a.y,(i=a.sub(o)).normalize().multiplyScalar(.06),e[s+n].sub(i)}e=e||10,t=t||.4;var a=r=r||16,o=d.randFloat(.05,.2),s=new THREE.ConeGeometry(.5,1,a,6),l=new THREE.MeshStandardMaterial({color:3407667,flatShading:!0});n(s.vertices,a,0,o),i(s.vertices,a,1),n(s.vertices,a,2,1.1*o,!0),i(s.vertices,a,3),n(s.vertices,a,4,1.2*o),i(s.vertices,a,5);var c=new THREE.Mesh(s,l);c.castShadow=!0,c.receiveShadow=!1,c.position.y=.5+t,c.rotation.y=d.randFloat(0,Math.PI);var u=t+.01,h=new THREE.CylinderGeometry(.1,.1,u),p=new THREE.MeshStandardMaterial({color:8939059,flatShading:!0}),f=new THREE.Mesh(h,p);f.position.y=u/2;var m=new THREE.Object3D;return m.add(f),m.add(c),m.scale.setScalar(e/(1+t)),m.castShadow=!0,m.receiveShadow=!1,m.name="lowPolyTree",m},d.createProcCity=function(){(a=new THREE.BoxGeometry(1,1,1)).applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));for(var e=new THREE.Mesh(a),t=new THREE.Color(16777215),r=new THREE.Color(3158096),n=new THREE.Geometry,i=0;i<2e4;i++){e.position.x=~~d.randFloat(-1e3,1e3),e.position.z=~~d.randFloat(-1e3,1e3),e.rotation.y=Math.random()*Math.PI*2,e.scale.x=d.randFloat(2,10),e.scale.y=d.randFloat(1.5,5*e.scale.x),e.scale.z=e.scale.x;for(var a,o=1-Math.random(),s=new THREE.Color(o+.1*Math.random(),o,o+.1*Math.random()),l=s.clone().multiply(t),c=s.clone().multiply(r),u=(new THREE.Color(16711680),0),h=(a=e.geometry).faces.length;u<h;u++)0===u||1===u||8===u||9===u?a.faces[u].vertexColors=[l,l,l]:2===u||3===u||10===u||11===u?a.faces[u].vertexColors=[c,c,c]:4===u||5===u?a.faces[u].vertexColors=[s,s,s]:6!==u&&7!==u||(a.faces[u].vertexColors=[s,s,s]);n.mergeMesh(e)}var p=new THREE.Texture(function(){var e=document.createElement("canvas");e.width=32,e.height=64,(i=e.getContext("2d")).fillStyle="#ffffff",i.fillRect(0,0,32,64);for(var t=2;t<64;t+=2)for(var r=0;r<32;r+=2){var n=Math.floor(64*Math.random());i.fillStyle="rgb("+[n,n,n].join(",")+")",i.fillRect(r,t,2,1)}var i,a=document.createElement("canvas");return a.width=512,a.height=1024,(i=a.getContext("2d")).imageSmoothingEnabled=!1,i.webkitImageSmoothingEnabled=!1,i.mozImageSmoothingEnabled=!1,i.drawImage(e,0,0,a.width,a.height),a}());p.anisotropy=d.renderer.capabilities.getMaxAnisotropy(),p.needsUpdate=!0;var f=new THREE.MeshLambertMaterial({map:p,vertexColors:THREE.VertexColors});return new THREE.Mesh(n,f)},d.createAcrylicPlane=function(e,t){var r=d.scene.background;r instanceof THREE.Texture||(r=null);e=void 0!==e?e:100,t=void 0!==t?t:100;var n=new THREE.Object3D;n.name="planeAcryl";var i=new THREE.PlaneBufferGeometry(e,t),a=new THREE.Mesh(i,new THREE.MeshStandardMaterial({color:12632256,map:r,transparent:!0,opacity:.7}));a.position.z=0,a.receiveShadow=!0,n.add(a);var o=new THREE.Reflector(i,{clipBias:.003,textureWidth:~~(d.appWorks.width*window.devicePixelRatio),textureHeight:~~(d.appWorks.height*window.devicePixelRatio),color:7829367,recursion:1});return o.position.z=-Math.min(.001*e,2),n.add(o),n},d.createAcrylicCircle=function(e){var t=d.scene.background;t instanceof THREE.Texture||(t=null);e=void 0!==e?e:50;var r=new THREE.Object3D;r.name="circleAcryl";var n=new THREE.CircleBufferGeometry(e,64),i=new THREE.Mesh(n,new THREE.MeshStandardMaterial({color:12632256,map:t,transparent:!0,opacity:.7}));i.position.z=0,i.receiveShadow=!0,r.add(i);var a=new THREE.Reflector(n,{clipBias:.003,textureWidth:~~(d.appWorks.width*window.devicePixelRatio),textureHeight:~~(d.appWorks.height*window.devicePixelRatio),color:7829367,recursion:1});return a.position.z=-Math.min(.001*e,2),r.add(a),r},d.createMirrorPlane=function(e,t){e=void 0!==e?e:100,t=void 0!==t?t:100;var r=new THREE.PlaneBufferGeometry(e,t);return new THREE.Reflector(r,{clipBias:.003,textureWidth:~~(d.appWorks.width*window.devicePixelRatio),textureHeight:~~(d.appWorks.height*window.devicePixelRatio),color:7829367,recursion:1})},d.createMirrorCircle=function(e){e=void 0!==e?e:50;var t=new THREE.CircleBufferGeometry(e,64);return new THREE.Reflector(t,{clipBias:.003,textureWidth:~~(d.appWorks.width*window.devicePixelRatio),textureHeight:~~(d.appWorks.height*window.devicePixelRatio),color:7829367,recursion:1})},d.createArenaRow=function(e){for(var t=(e=e||{}).radius||.5,r=e.nCluster||30,n=e.conesPerSection||5,i=e.heightMin||.1,a=e.heightMax||.15,o=e.radiusMin||.04,s=e.radiusMax||.04,l=2*Math.PI,c=new THREE.Object3D,u=new THREE.MeshPhongMaterial({color:"teal"}),h=0;h<r;h++)for(var d=h/r*l,p=0;p<n;p++){var f=THREE.Math.randFloatSpread(2/r)*l,m=THREE.Math.randFloat(i,a),v=THREE.Math.randFloat(o,s),g=new THREE.CylinderGeometry(0,v,m),y=new THREE.Mesh(g,u);y.position.y=m/2,y.position.x=t*Math.cos(d+f),y.position.z=t*Math.sin(d+f),c.add(y)}return c},Object.assign(L.prototype,{isOctree:!0,importMesh:function(e){var t=this;function r(e){e.geometry=JAMIE.toGeometry(e.geometry),e.geometry.mergeVertices(),e.updateMatrix();var r=e.id,n=e.geometry.clone();n.applyMatrix(e.matrix),n.computeVertexNormals(),n.computeFaceNormals();for(var i=n.faces,a=n.vertices,o=0,s=i.length;o<s;o++){var l=new H(a[i[o].a],a[i[o].b],a[i[o].c],i[o].normal,r);t.addFace(l)}}e.isInstancedMesh?e.decompose(e=>{e.forEach(e=>{r(e)})}):r(e)},addFace:function(e){for(var t=[],r=this.nodes[0].slice(0),n=0,i=this.maxDepth;n<i;n++){for(var a=0,o=r.length;a<o;a++){var s=r[a];M(e.a,e.b,e.c,s)&&(s.trianglePool.push(e),n+1!==this.maxDepth&&(t=t.concat(s.getChildNodes())))}if(0===t.length)break;r=t.slice(0),t.length=0}},removeMesh:function(e){this.nodes.forEach(function(t){t.forEach(function(t){var r=[];t.trianglePool.forEach(function(t){t.meshId!==e&&r.push(t)}),t.trianglePool=r})})},getIntersectedNodes:function(e,t){var r=[],n=[];if(!S(e,this))return[];for(var i=this.nodes[0].slice(0),a=0,o=t;a<o;a++){for(var s=0,l=i.length;s<l;s++){var c=i[s];if(S(e,c))a+1===t?0!==c.trianglePool.length&&n.push(c):r=r.concat(c.getChildNodes())}i=r.slice(0),r.length=0}return n}}),L.separate3Bit=function(e){return e=2396745&((e=798915&((e=61455&(e|e<<8))|e<<4))|e<<2)},L.getMortonNumber=function(e,t,r){return L.separate3Bit(e)|L.separate3Bit(t)<<1|L.separate3Bit(r)<<2},L.uniqTrianglesfromNodes=function(e){var t=[],r=!1;if(0===e.length)return[];if(1===e.length)return e[0].trianglePool.slice(0);for(var n=0,i=e.length;n<i;n++)for(var a=0,o=e[n].trianglePool.length;a<o;a++){for(var s=0,l=t.length;s<l;s++)e[n].trianglePool[a]===t[s]&&(r=!0);r||t.push(e[n].trianglePool[a]),r=!1}return t},Object.assign(C.prototype,{isOctreeNode:!0,getParentNode:function(){if(0===this.depth)return null;this.tree.nodes[this.depth][this.mortonNumber>>3]},getChildNodes:function(){if(this.tree.maxDepth===this.depth)return null;var e=this.mortonNumber<<3;return[this.tree.nodes[this.depth+1][e],this.tree.nodes[this.depth+1][e+1],this.tree.nodes[this.depth+1][e+2],this.tree.nodes[this.depth+1][e+3],this.tree.nodes[this.depth+1][e+4],this.tree.nodes[this.depth+1][e+5],this.tree.nodes[this.depth+1][e+6],this.tree.nodes[this.depth+1][e+7]]}});var H=function(e,t,r,n,i){this.a=e.clone(),this.b=t.clone(),this.c=r.clone(),this.normal=n.clone(),this.meshId=i};function I(){this.colliderPool=[],this.playerPool=[]}Object.assign(I.prototype,{isWorld:!0,add:function(e){e.isOctree?this.colliderPool.push(e):e.isHeroController&&(this.playerPool.push(e),e.world=this)},step:function(e){for(var t=0,r=this.playerPool.length;t<r;t++){for(var n,i=this.playerPool[t],a=0,o=this.colliderPool.length;a<o;a++){var s=this.colliderPool[a],l=new THREE.Sphere(i.center,i.radius+i.groundPadding),c=s.getIntersectedNodes(l,s.maxDepth);if((n=L.uniqTrianglesfromNodes(c)).length>0)break}i.collisionCandidate=n,i.update(e)}}});var k=10;Math.PI;function O(e,t){var r,n,i=this;this.player=e,this.controller=t,this.explosionPoints=(r=Array(150).fill(0),(n=JAMIE.createPoints(r,{map:(new THREE.TextureLoader).load("images/sprites/ball.png"),color:16711680,size:.2})).name="game.explosionPoints",n.visible=!1,n.explosionPower=1.06,n.wasExplosion=!1,n.isExplosion=!1,JAMIE.add(n),n.explode=function(e){var t=i.controller.radius;this.position.x=e.x,this.position.y=e.y+t,this.position.z=e.z;for(var r=new THREE.Vector3,n=this.geometry.attributes.position,a=0,o=n.count;a<o;a++)r.fromBufferAttribute(n,a),r.x=JAMIE.randFloat(-.4,.4),r.y=JAMIE.randFloat(-.4,.4),r.z=JAMIE.randFloat(-.4,.4),n.setXYZ(a,r.x,r.y,r.z);this.explosionPower=1.2,this.visible=!0},n.update=function(e,t){this.visible&&(this.scale.setScalar(this.explosionPower),this.explosionPower>.5?this.explosionPower-=.008:this.visible=!1)},n)}function N(e,t){this.object=e,this.center=this.object.position.clone(),this.radius=t,this.groundPadding=.5,this.maxSlopeGradient=Math.cos(50*THREE.Math.DEG2RAD),this.isGrounded=!1,this.isOnSlope=!1,this.isIdling=!1,this.isRunning=!1,this.isJumping=!1,this.direction=0,this.movementSpeed=k,this.velocity=new THREE.Vector3(0,-10,0),this.currentJumpPower=0,this.jumpStartTime=0,this.groundHeight=0,this.groundNormal=new THREE.Vector3,this.collisionCandidate,this.contactInfo=[]}Object.assign(O.prototype,{isHeroAnimator:!0,play:function(e){if(JAMIE.appWorks&&JAMIE.appWorks.playAction(this.player,e,{duration:.3}),"Explode"===e){var t=this;this.controller.contactInfo.forEach(function(e){var r=JAMIE.scene.getObjectById(e.face.meshId);if(r){var n=t.explosionPoints;"game.terrain"===r.name?!1===n.isExplosion?(n.wasExplosion=!1,n.isExplosion=!1):(n.wasExplosion=!0,n.isExplosion=!1):!1===n.isExplosion?(n.wasExplosion=!1,n.isExplosion=!0,n&&n.explode(e.contactPoint)):(n.wasExplosion=!0,n.isExplosion=!0)}else console.warn(">> warning: collision detection but cannot find the intersected faces...")})}},update:function(e,t){this.explosionPoints.update()}}),N.prototype=Object.assign(Object.create(i.EventDispatcher.prototype),{constructor:N,isHeroController:!0,printAnimState:function(e){console.log("--- "+e+" ---"),console.log("Ground: "+wasGrounded+" ==> "+this.isGrounded),console.log("Slope : "+wasOnSlope+" ==> "+this.isOnSlope),console.log("Idle  : "+wasIdling+" ==> "+this.isIdling),console.log("Run   : "+wasRunning+" ==> "+this.isRunning),console.log("Jump  : "+wasJumping+" ==> "+this.isJumping)},events:function(){var e,t,r,n,i=!0;return function(){if(i)return i=!1,e=this.isGrounded,t=this.isOnSlope,this.isIdling,r=this.isRunning,void(n=this.isJumping);r||this.isRunning||!this.isGrounded||this.isIdling?!r&&this.isRunning&&!this.isJumping&&this.isGrounded||!e&&this.isGrounded&&this.isRunning||t&&!this.isOnSlope&&this.isRunning&&this.isGrounded?(this.isIdling=!1,this.movementSpeed>k?this.dispatchEvent({type:"startRunning"}):this.dispatchEvent({type:"startWalking"})):!n&&this.isJumping?(this.isIdling=!1,this.dispatchEvent({type:"startJumping"})):!t&&this.isOnSlope?this.dispatchEvent({type:"startSliding"}):!e||this.isGrounded||this.isJumping||this.dispatchEvent({type:"startFalling"}):(this.isIdling=!0,this.dispatchEvent({type:"startIdling"})),!e&&this.isGrounded,e=this.isGrounded,t=this.isOnSlope,this.isIdling,r=this.isRunning,n=this.isJumping}}(),update:function(e){this.isGrounded=!1,this.isOnSlope=!1,this.groundHeight=-1/0,this.groundNormal.set(0,1,0),this.updateGrounding(),this.updateJumping(),this.updatePosition(e),this.collisionDetection(),this.solvePosition(),this.updateVelocity(),this.events()},updateVelocity:function(){var e=-Math.cos(this.direction),t=-Math.sin(this.direction),r=!1;if(this.velocity.set(t*this.movementSpeed*this.isRunning,-20,e*this.movementSpeed*this.isRunning),0!==this.contactInfo.length||this.isJumping){if(!this.isGrounded||this.isOnSlope||this.isJumping)if(this.isOnSlope){var n=20/(1-this.groundNormal.y)*.2;this.velocity.x=this.groundNormal.x*n,this.velocity.y=-20,this.velocity.z=this.groundNormal.z*n}else this.isGrounded||this.isOnSlope||!this.isJumping||(this.velocity.y=20*this.currentJumpPower);else this.velocity.y=0;for(var i=new THREE.Vector2(t,e),a=Math.atan2(-i.y,-i.x),o=0,s=this.contactInfo.length;o<s;o++){var l=this.contactInfo[o].face.normal;if(!(this.maxSlopeGradient<l.y||this.isOnSlope)){!r&&l.y<0&&(r=!0);var c=new THREE.Vector2(l.x,l.z).normalize(),u=Math.atan2(c.y,c.x);Math.abs(a-u)>=.5*Math.PI&&Math.abs(a-u)<=1.5*Math.PI||(c.set(i.dot(c)*c.x,i.dot(c)*c.y),i.sub(c),this.velocity.x=i.x*this.movementSpeed*this.isRunning,this.velocity.z=i.y*this.movementSpeed*this.isRunning)}}r&&(this.velocity.y=Math.min(0,this.velocity.y),this.isJumping=!1)}},updateGrounding:function(){for(var e=void 0,t=void 0,r=this.collisionCandidate,n=new THREE.Vector3(this.center.x,this.center.y+this.radius,this.center.z),i=new THREE.Vector3(this.center.x,this.center.y-1e10,this.center.z),a=0,o=r.length;a<o;a++)(t=P(n,i,r[a].a,r[a].b,r[a].c))&&!e?(e=t).face=r[a]:t&&t.contactPoint.y>e.contactPoint.y&&((e=t).face=r[a]);if(e){this.groundHeight=e.contactPoint.y,this.groundNormal.copy(e.face.normal);var s=n.y,l=this.center.y-this.radius-this.groundPadding;if(this.isJumping&&0<this.currentJumpPower)return this.isOnSlope=!1,void(this.isGrounded=!1);this.isGrounded=l<=this.groundHeight&&this.groundHeight<=s,this.isOnSlope=this.groundNormal.y<=this.maxSlopeGradient,this.isGrounded&&(this.isJumping=!1)}},updatePosition:function(e){var t=this.groundHeight+this.radius,r=this.center.x+this.velocity.x*e,n=this.center.y+this.velocity.y*e,i=this.center.z+this.velocity.z*e;this.center.set(r,this.isGrounded?t:n,i)},collisionDetection:function(){var e=this.collisionCandidate;this.contactInfo.length=0;for(var t=0,r=e.length;t<r;t++){var n=A(this,e[t].a,e[t].b,e[t].c,e[t].normal);n&&(n.face=e[t],this.contactInfo.push(n))}},solvePosition:function(){var e,t,r=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3;if(0!==this.contactInfo.length){for(var s=0,l=this.contactInfo.length;s<l;s++)if(e=this.contactInfo[s].face,t=this.contactInfo[s].face.normal,!(this.maxSlopeGradient<t.y)){var c=this.maxSlopeGradient<=e.normal.y&&e.normal.y<1;if(this.isJumping&&0>=this.currentJumpPower&&c&&(this.isJumping=!1,this.isGrounded=!0),this.isGrounded||this.isOnSlope){r.copy(t).multiplyScalar(-this.radius).add(this.center),i.set(t.x,0,t.z).normalize();var u=(e.a.dot(t)-(t.x*r.x+t.y*r.y+t.z*r.z))/(t.x*i.x+t.y*i.y+t.z*i.z);n.copy(i).multiplyScalar(u).add(r),a.subVectors(n,r),Math.abs(o.x)>Math.abs(a.x)&&(o.x+=a.x),Math.abs(o.z)>Math.abs(a.z)&&(o.z+=a.z)}else;}this.center.add(o),this.object.position.copy(this.center)}else this.object.position.copy(this.center)},setDirection:function(){},jump:function(){this.isJumping||!this.isGrounded||this.isOnSlope||(this.jumpStartTime=Date.now(),this.currentJumpPower=1,this.isJumping=!0)},run:function(){!this.isJumping&&this.isGrounded&&(this.movementSpeed===k?this.movementSpeed=k+10:this.movementSpeed=k)},updateJumping:function(){if(this.isJumping){var e=(Date.now()-this.jumpStartTime)/1e3;this.currentJumpPower=Math.cos(Math.min(e,1)*Math.PI)}}});var F=87,D=38,z=83,U=40,B=65,G=37,V=68,j=39,W=32,X=18,Y=21,q=Math.PI/180,Q=0*q,Z=45*q,K=90*q,J=135*q,$=180*q,ee=225*q,te=270*q,re=315*q;function ne(e){this.dom=e||document.body,this.isDisabled=!1,this.isUp=!1,this.isDown=!1,this.isLeft=!1,this.isRight=!1,this.isMoveKeyHolded=!1,this.frontAngle=0,this._keydownListener=function(e){if(this.isDisabled)return;switch(e.keyCode){case F:case D:this.isUp=!0;break;case z:case U:this.isDown=!0;break;case B:case G:this.isLeft=!0;break;case V:case j:this.isRight=!0;break;case W:this.jump();break;case X:case Y:e.preventDefault(),this.run();break;default:return}var t=this.frontAngle;this.updateAngle(),t!==this.frontAngle&&this.dispatchEvent({type:"movekeychange"});(this.isUp||this.isDown||this.isLeft||this.isRight)&&!this.isMoveKeyHolded&&(this.isMoveKeyHolded=!0,this.dispatchEvent({type:"movekeyon"}))}.bind(this),this._keyupListener=function(e){if(this.isDisabled)return;switch(e.keyCode){case F:case D:this.isUp=!1;break;case z:case U:this.isDown=!1;break;case B:case G:this.isLeft=!1;break;case V:case j:this.isRight=!1;break;case W:break;default:return}var t=this.frontAngle;this.updateAngle(),t!==this.frontAngle&&this.dispatchEvent({type:"movekeychange"});this.isUp||this.isDown||this.isLeft||this.isRight||e.keyCode!==F&&e.keyCode!==D&&e.keyCode!==z&&e.keyCode!==U&&e.keyCode!==B&&e.keyCode!==G&&e.keyCode!==V&&e.keyCode!==j||(this.isMoveKeyHolded=!1,this.dispatchEvent({type:"movekeyoff"}))}.bind(this),this._blurListener=function(){this.isUp=!1,this.isDown=!1,this.isLeft=!1,this.isRight=!1,this.isMoveKeyHolded&&(this.isMoveKeyHolded=!1,this.dispatchEvent({type:"movekeyoff"}))}.bind(this),this.dom.addEventListener("keydown",this._keydownListener,!1),this.dom.addEventListener("keyup",this._keyupListener,!1),this.dom.addEventListener("blur",this._blurListener,!1)}ne.prototype=Object.assign(Object.create(i.EventDispatcher.prototype),{constructor:ne,isKeyInputControl:!0,jump:function(){this.dispatchEvent({type:"jumpkeypress"})},run:function(){this.dispatchEvent({type:"runkeypress"})},updateAngle:function(){var e=this.isUp,t=this.isDown,r=this.isLeft,n=this.isRight;!e||r||t||n?e&&r&&!t&&!n?this.frontAngle=Z:e||!r||t||n?!e&&r&&t&&!n?this.frontAngle=J:e||r||!t||n?!e&&!r&&t&&n?this.frontAngle=ee:e||r||t||!n?e&&!r&&!t&&n&&(this.frontAngle=re):this.frontAngle=te:this.frontAngle=$:this.frontAngle=K:this.frontAngle=Q}});var ie=2*Math.PI,ae=Math.PI/2,oe=new THREE.Matrix4,se=new THREE.Matrix4,le=new THREE.Matrix4;function ce(e,t,r){r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.camera=e,this.trackObject=t,this.dom=r.dom||document.body,this.offset=r.offset||new THREE.Vector3(0,0,0),this.radius=r.radius||10,this.minRadius=r.minRadius||1,this.maxRadius=r.maxRadius||80,this.rigidObjects=r.rigidObjects||[],this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.mouseAccelerationX=void 0!==r.mouseAccelerationX?r.mouseAccelerationX:100,this.mouseAccelerationY=void 0!==r.mouseAccelerationY?r.mouseAccelerationY:30,this._pointerStart={x:0,y:0},this._pointerLast={x:0,y:0},this.setNearPlainCornersWithPadding(),this.update(),this._mousedownListener=function(e){e.button===THREE.MOUSE.LEFT&&(this.dispatchEvent({type:"mousedown"}),this._pointerStart.x=e.clientX,this._pointerStart.y=e.clientY,this._pointerLast.x=this.lon,this._pointerLast.y=this.lat,this.dom.removeEventListener("mousemove",this._mousedragListener,!1),this.dom.addEventListener("mousemove",this._mousedragListener,!1))}.bind(this),this._mouseupListener=function(){event.button===THREE.MOUSE.LEFT&&(this.dispatchEvent({type:"mouseup"}),this.dom.removeEventListener("mousemove",this._mousedragListener,!1))}.bind(this),this._mousedragListener=function(e){if(e.button===THREE.MOUSE.LEFT){var t=this.dom.offsetWidth,r=this.dom.offsetHeight,n=(this._pointerStart.x-e.clientX)/t*2,i=(this._pointerStart.y-e.clientY)/r*2;this.setLatLon(this._pointerLast.y+i*this.mouseAccelerationY,this._pointerLast.x+n*this.mouseAccelerationX)}}.bind(this),this._scrollListener=function(e){e.preventDefault(),e.wheelDeltaY?this.radius-=.05*e.wheelDeltaY/5:e.wheelDelta?this.radius-=.05*e.wheelDelta/5:e.detail&&(this.radius+=e.detail/5);this.radius=Math.max(this.radius,this.minRadius),this.radius=Math.min(this.radius,this.maxRadius)}.bind(this),this.dom.addEventListener("mousedown",this._mousedownListener,!1),this.dom.addEventListener("mouseup",this._mouseupListener,!1),this.dom.addEventListener("wheel",this._scrollListener,!0),this.dom.addEventListener("DOMMouseScroll",this._scrollListener,!0)}ce.prototype=Object.assign(Object.create(i.EventDispatcher.prototype),{constructor:ce,isTPSCameraControl:!0,handleResize:function(){},update:function(){this._center=new THREE.Vector3(this.trackObject.matrixWorld.elements[12]+this.offset.x,this.trackObject.matrixWorld.elements[13]+this.offset.y,this.trackObject.matrixWorld.elements[14]+this.offset.z);var e=new THREE.Vector3(Math.cos(this.phi)*Math.cos(this.theta+ae),Math.sin(this.phi),Math.cos(this.phi)*Math.sin(this.theta+ae)),t=this.collisionTest(e.clone().normalize());e.multiplyScalar(t),e.add(this._center),this.camera.position.copy(e),90===this.lat?this.camera.up.set(Math.cos(this.theta+Math.PI),0,Math.sin(this.theta+Math.PI)):-90===this.lat?this.camera.up.set(Math.cos(this.theta),0,Math.sin(this.theta)):this.camera.up.set(0,1,0),this.camera.lookAt(this._center),this.dispatchEvent({type:"updated"})},getFrontAngle:function(){return ie+this.theta},setNearPlainCornersWithPadding:function(){var e=this.camera.near,t=.5*this.camera.fov,r=Math.tan(t*THREE.Math.DEG2RAD)*e,n=r*this.camera.aspect;this.nearPlainCornersWithPadding=[new THREE.Vector3(-n-e,-r-e,0),new THREE.Vector3(n+e,-r-e,0),new THREE.Vector3(n+e,r+e,0),new THREE.Vector3(-n-e,r+e,0)]},setLatLon:function(e,t){this.lat=e>90?90:e<-90?-90:e,this.lon=t<0?360+t%360:t%360,this.phi=this.lat*THREE.Math.DEG2RAD,this.theta=-this.lon*THREE.Math.DEG2RAD},collisionTest:function(e){var t=this.radius;se.makeRotationX(this.phi),le.makeRotationY(this.theta),oe.multiplyMatrices(se,le);for(var r=0;r<4;r++){var n=this.nearPlainCornersWithPadding[r].clone();n.applyMatrix4(oe);var i=new THREE.Vector3(this._center.x+n.x,this._center.y+n.y,this._center.z+n.z),a=new THREE.Raycaster(i,e,this.camera.near,this.radius).intersectObjects(this.rigidObjects);0!==a.length&&a[0].distance<t&&(t=a[0].distance)}return t}});var ue={Element:function(e){this.dom=e}};ue.Element.prototype={add:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t instanceof ue.Element?this.dom.appendChild(t.dom):console.error("UI.Element:",t,"is not an instance of UI.Element.")}return this},remove:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t instanceof ue.Element?this.dom.removeChild(t.dom):console.error("UI.Element:",t,"is not an instance of UI.Element.")}return this},clear:function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild)},setId:function(e){return this.dom.id=e,this},setClass:function(e){return this.dom.className=e,this},setStyle:function(e,t){for(var r=0;r<t.length;r++)this.dom.style[e]=t[r];return this},setDisabled:function(e){return this.dom.disabled=e,this},setTextContent:function(e){return this.dom.textContent=e,this}};["position","left","top","right","bottom","width","height","maxHeight","display","overflow","border","borderLeft","borderTop","borderRight","borderBottom","borderRadius","borderColor","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","background","backgroundColor","opacity","fontSize","fontWeight","verticalAlign","textAlign","textDecoration","textTransform","textShadow","cursor","zIndex","transform","transition","lineHeight","visibility","textIndent","wordBreak","boxShadow"].forEach(function(e){var t="set"+e.substr(0,1).toUpperCase()+e.substr(1,e.length);ue.Element.prototype[t]=function(){return this.setStyle(e,arguments),this}});["KeyDown","KeyUp","MouseDown","MouseUp","MouseEnter","MouseLeave","MouseOver","MouseOut","Click","DblClick","Change","Input"].forEach(function(e){var t="on"+e;ue.Element.prototype[t]=function(t){return this.dom.addEventListener(e.toLowerCase(),t.bind(this),!1),this}}),ue.Span=function(){return ue.Element.call(this),this.dom=document.createElement("span"),this},ue.Span.prototype=Object.create(ue.Element.prototype),ue.Span.prototype.constructor=ue.Span,ue.Div=function(){return ue.Element.call(this),this.dom=document.createElement("div"),this},ue.Div.prototype=Object.create(ue.Element.prototype),ue.Div.prototype.constructor=ue.Div,ue.Row=function(){ue.Element.call(this);var e=document.createElement("div");return e.className="Row",this.dom=e,this},ue.Row.prototype=Object.create(ue.Element.prototype),ue.Row.prototype.constructor=ue.Row,ue.Column=function(){ue.Element.call(this);var e=document.createElement("div");return e.className="Column",this.dom=e,this},ue.Column.prototype=Object.create(ue.Element.prototype),ue.Column.prototype.constructor=ue.Column,ue.Panel=function(){ue.Element.call(this);var e=document.createElement("div");return e.className="Panel",this.dom=e,this},ue.Panel.prototype=Object.create(ue.Element.prototype),ue.Panel.prototype.constructor=ue.Panel,ue.Text=function(e){ue.Element.call(this);var t=document.createElement("span");return t.className="Text",t.style.cursor="default",t.style.display="inline-block",t.style.verticalAlign="middle",this.dom=t,this.setValue(e),this},ue.Text.prototype=Object.create(ue.Element.prototype),ue.Text.prototype.constructor=ue.Text,ue.Text.prototype.getValue=function(){return this.dom.textContent},ue.Text.prototype.setValue=function(e){return void 0!==e&&(this.dom.textContent=e),this},ue.Input=function(e){ue.Element.call(this);var t=document.createElement("input");return t.className="Input",t.style.padding="2px",t.style.border="1px solid transparent",t.addEventListener("keydown",function(e){e.stopPropagation()},!1),this.dom=t,this.setValue(e),this},ue.Input.prototype=Object.create(ue.Element.prototype),ue.Input.prototype.constructor=ue.Input,ue.Input.prototype.getValue=function(){return this.dom.value},ue.Input.prototype.setValue=function(e){return this.dom.value=e,this},ue.TextArea=function(){ue.Element.call(this);var e=document.createElement("textarea");return e.className="TextArea",e.style.padding="2px",e.spellcheck=!1,e.addEventListener("keydown",function(t){if(t.stopPropagation(),9===t.keyCode){t.preventDefault();var r=e.selectionStart;e.value=e.value.substring(0,r)+"\t"+e.value.substring(r),e.selectionStart=r+1,e.selectionEnd=e.selectionStart}},!1),this.dom=e,this},ue.TextArea.prototype=Object.create(ue.Element.prototype),ue.TextArea.prototype.constructor=ue.TextArea,ue.TextArea.prototype.getValue=function(){return this.dom.value},ue.TextArea.prototype.setValue=function(e){return this.dom.value=e,this},ue.Select=function(){ue.Element.call(this);var e=document.createElement("select");return e.className="Select",e.style.padding="2px",this.dom=e,this},ue.Select.prototype=Object.create(ue.Element.prototype),ue.Select.prototype.constructor=ue.Select,ue.Select.prototype.setMultiple=function(e){return this.dom.multiple=e,this},ue.Select.prototype.setOptions=function(e){for(var t=this.dom.value;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);for(var r in e){var n=document.createElement("option");n.value=r,n.innerHTML=e[r],this.dom.appendChild(n)}return this.dom.value=t,this},ue.Select.prototype.getValue=function(){return this.dom.value},ue.Select.prototype.setValue=function(e){return e=String(e),this.dom.value!==e&&(this.dom.value=e),this},ue.Checkbox=function(e){ue.Element.call(this);var t=document.createElement("input");return t.className="Checkbox",t.type="checkbox",this.dom=t,this.setValue(e),this},ue.Checkbox.prototype=Object.create(ue.Element.prototype),ue.Checkbox.prototype.constructor=ue.Checkbox,ue.Checkbox.prototype.getValue=function(){return this.dom.checked},ue.Checkbox.prototype.setValue=function(e){return void 0!==e&&(this.dom.checked=e),this},ue.Color=function(){ue.Element.call(this);var e=document.createElement("input");e.className="Color",e.style.width="64px",e.style.height="17px",e.style.border="0px",e.style.padding="2px",e.style.backgroundColor="transparent";try{e.type="color",e.value="#ffffff"}catch(e){}return this.dom=e,this},ue.Color.prototype=Object.create(ue.Element.prototype),ue.Color.prototype.constructor=ue.Color,ue.Color.prototype.getValue=function(){return this.dom.value},ue.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)},ue.Color.prototype.setValue=function(e){return this.dom.value=e,this},ue.Color.prototype.setHexValue=function(e){return this.dom.value="#"+("000000"+e.toString(16)).slice(-6),this},ue.Number=function(e){ue.Element.call(this);var t=this,r=document.createElement("input");r.className="Number",r.value="0.00",r.addEventListener("keydown",function(e){e.stopPropagation(),13===e.keyCode&&r.blur()},!1),this.value=0,this.min=-1/0,this.max=1/0,this.precision=2,this.step=1,this.unit="",this.dom=r,this.setValue(e);var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!0);var i=0,a=0,o=[0,0],s=[0,0];function l(e){var l=t.value;o=[e.clientX,e.clientY],i+=o[0]-s[0]-(o[1]-s[1]);var c=a+i/(e.shiftKey?5:50)*t.step;l!==(c=Math.min(t.max,Math.max(t.min,c)))&&(t.setValue(c),r.dispatchEvent(n)),s=[e.clientX,e.clientY]}function c(e){document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",c,!1),Math.abs(i)<2&&(r.focus(),r.select())}function u(e){var l=t.value;o=[e.touches[0].pageX,e.touches[0].pageY],i+=o[0]-s[0]-(o[1]-s[1]);var c=a+i/(e.shiftKey?5:50)*t.step;l!==(c=Math.min(t.max,Math.max(t.min,c)))&&(t.setValue(c),r.dispatchEvent(n)),s=[e.touches[0].pageX,e.touches[0].pageY]}function h(e){0===e.touches.length&&(document.removeEventListener("touchmove",u,!1),document.removeEventListener("touchend",h,!1))}function d(e){r.style.backgroundColor="transparent",r.style.cursor="col-resize"}return d(),r.addEventListener("mousedown",function(e){e.preventDefault(),i=0,a=t.value,s=[e.clientX,e.clientY],document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",c,!1)},!1),r.addEventListener("touchstart",function(e){1===e.touches.length&&(i=0,a=t.value,s=[e.touches[0].pageX,e.touches[0].pageY],document.addEventListener("touchmove",u,!1),document.addEventListener("touchend",h,!1))},!1),r.addEventListener("change",function(e){t.setValue(r.value)},!1),r.addEventListener("focus",function(e){r.style.backgroundColor="",r.style.cursor=""},!1),r.addEventListener("blur",d,!1),this},ue.Number.prototype=Object.create(ue.Element.prototype),ue.Number.prototype.constructor=ue.Number,ue.Number.prototype.getValue=function(){return this.value},ue.Number.prototype.setValue=function(e){return void 0!==e&&((e=parseFloat(e))<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,this.dom.value=e.toFixed(this.precision),""!==this.unit&&(this.dom.value+=" "+this.unit)),this},ue.Number.prototype.setPrecision=function(e){return this.precision=e,this},ue.Number.prototype.setStep=function(e){return this.step=e,this},ue.Number.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},ue.Number.prototype.setUnit=function(e){return this.unit=e,this},ue.Integer=function(e){ue.Element.call(this);var t=this,r=document.createElement("input");r.className="Number",r.value="0",r.addEventListener("keydown",function(e){e.stopPropagation()},!1),this.value=0,this.min=-1/0,this.max=1/0,this.step=1,this.dom=r,this.setValue(e);var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!0);var i=0,a=0,o=[0,0],s=[0,0];function l(e){var l=t.value;o=[e.clientX,e.clientY],i+=o[0]-s[0]-(o[1]-s[1]);var c=a+i/(e.shiftKey?5:50)*t.step;l!==(c=0|Math.min(t.max,Math.max(t.min,c)))&&(t.setValue(c),r.dispatchEvent(n)),s=[e.clientX,e.clientY]}function c(e){document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",c,!1),Math.abs(i)<2&&(r.focus(),r.select())}function u(e){r.style.backgroundColor="transparent",r.style.cursor="col-resize"}return u(),r.addEventListener("mousedown",function(e){e.preventDefault(),i=0,a=t.value,s=[e.clientX,e.clientY],document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",c,!1)},!1),r.addEventListener("change",function(e){t.setValue(r.value)},!1),r.addEventListener("focus",function(e){r.style.backgroundColor="",r.style.cursor=""},!1),r.addEventListener("blur",u,!1),this},ue.Integer.prototype=Object.create(ue.Element.prototype),ue.Integer.prototype.constructor=ue.Integer,ue.Integer.prototype.getValue=function(){return this.value},ue.Integer.prototype.setValue=function(e){return void 0!==e&&(e=parseInt(e),this.value=e,this.dom.value=e),this},ue.Integer.prototype.setStep=function(e){return this.step=parseInt(e),this},ue.Integer.prototype.setRange=function(e,t){return this.min=e,this.max=t,this},ue.Break=function(){ue.Element.call(this);var e=document.createElement("br");return e.className="Break",this.dom=e,this},ue.Break.prototype=Object.create(ue.Element.prototype),ue.Break.prototype.constructor=ue.Break,ue.HorizontalRule=function(){ue.Element.call(this);var e=document.createElement("hr");return e.className="HorizontalRule",this.dom=e,this},ue.HorizontalRule.prototype=Object.create(ue.Element.prototype),ue.HorizontalRule.prototype.constructor=ue.HorizontalRule,ue.Button=function(e){ue.Element.call(this);var t=document.createElement("button");return t.className="Button",this.dom=t,this.dom.textContent=e,this},ue.Button.prototype=Object.create(ue.Element.prototype),ue.Button.prototype.constructor=ue.Button,ue.Button.prototype.setLabel=function(e){return this.dom.textContent=e,this},ue.Image=function(e){ue.Element.call(this);var t=document.createElement("img");return t.className="Image",t.src=e,this.dom=t,this},ue.Image.prototype=Object.create(ue.Element.prototype),ue.Image.prototype.constructor=ue.Image,ue.Tooltip=function(e){ue.Element.call(this);var t=document.createElement("span");return t.setAttribute("data-tooltip",e),t.setAttribute("data-tooltip-position","top"),this.dom=t,this},ue.Tooltip.prototype=Object.create(ue.Element.prototype),ue.Tooltip.prototype.constructor=ue.Tooltip,ue.Modal=function(){var e=this,t=document.createElement("div");return t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.display="none",t.style.alignItems="center",t.style.justifyContent="center",t.addEventListener("click",function(t){e.hide()}),this.dom=t,this.container=new ue.Panel,this.container.dom.style.width="200px",this.container.dom.style.padding="20px",this.container.dom.style.backgroundColor="#ffffff",this.container.dom.style.boxShadow="0px 5px 10px rgba(0,0,0,0.5)",this.add(this.container),this},ue.Modal.prototype=Object.create(ue.Element.prototype),ue.Modal.prototype.constructor=ue.Modal,ue.Modal.prototype.show=function(e){return this.container.clear(),this.container.add(e),this.dom.style.display="flex",this},ue.Modal.prototype.hide=function(){return this.dom.style.display="none",this},ue.Texture=function(e){ue.Element.call(this);var t=this,r=document.createElement("span"),n=document.createElement("form"),i=document.createElement("input");i.type="file",i.addEventListener("change",function(e){o(e.target.files[0])}),n.appendChild(i);var a=document.createElement("canvas");function o(r){if(r.type.match("image.*")){var i=new FileReader;"image/targa"===r.type?(i.addEventListener("load",function(n){var i=(new THREE.TGALoader).parse(n.target.result),a=new THREE.CanvasTexture(i,e);a.sourceFile=r.name,t.setValue(a),t.onChangeCallback&&t.onChangeCallback()},!1),i.readAsArrayBuffer(r)):(i.addEventListener("load",function(n){var i=document.createElement("img");i.addEventListener("load",function(n){var i=new THREE.Texture(this,e);i.sourceFile=r.name,i.format="image/jpeg"===r.type?THREE.RGBFormat:THREE.RGBAFormat,i.needsUpdate=!0,t.setValue(i),t.onChangeCallback&&t.onChangeCallback()},!1),i.src=n.target.result},!1),i.readAsDataURL(r))}n.reset()}return a.width=50,a.height=50,a.style.cursor="pointer",a.style.marginRight="5px",a.style.border="1px solid #888",a.addEventListener("click",function(e){i.click()},!1),a.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),a.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),o(e.dataTransfer.files[0])},!1),r.appendChild(a),this.dom=r,this.texture=null,this.onChangeCallback=null,this},ue.Texture.prototype=Object.create(ue.Element.prototype),ue.Texture.prototype.constructor=ue.Texture,ue.Texture.prototype.getValue=function(){return this.texture},ue.Texture.prototype.setValue=function(e){var t=this.dom.children[0],r=t.getContext("2d");if(null!==e){var n=e.isCubeTexture?e.image[0]:e.image;if(void 0!==n&&n.width>0){var i=t.width/n.width;r.drawImage(n,0,0,n.width*i,n.height*i)}else r.clearRect(0,0,t.width,t.height)}else null!==r&&r.clearRect(0,0,t.width,t.height);this.texture=e},ue.Texture.prototype.onChange=function(e){return this.onChangeCallback=e,this},ue.Tree=function(e){ue.Element.call(this);var t=this;this.appWorks=e;var r=document.createElement("div");return r.className="Tree",r.tabIndex=0,r.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 40:e.preventDefault(),e.stopPropagation()}},!1),r.addEventListener("keyup",function(e){switch(e.keyCode){case 38:t.selectIndex(t.selectedIndex-1);break;case 40:t.selectIndex(t.selectedIndex+1)}},!1),this.dom=r,this.items=[],this.selectedIndex=-1,this},ue.Tree.prototype=Object.create(ue.Element.prototype),ue.Tree.prototype.constructor=ue.Tree,ue.Tree.prototype.selectIndex=function(e){e>=0&&e<this.items.length&&(this.selectedIndex=e,this.appWorks.selectById(parseInt(this.items[e].id)))},ue.Tree.prototype.clean=function(e,t){for(var r=this.items,n=0,i=r.length;n<i;n++)r[n].classList.toggle(e,t)},ue.Tree.prototype.toggle=function(e,t,r){e.forEach(function(e){var n=document.getElementById(e);n&&n.classList.toggle(t,r)})},ue.Tree.prototype.setInnerHTML=function(e){for(var t=this.appWorks;this.dom.children.length>0;)this.dom.removeChild(this.dom.firstChild);this.dom.innerHTML=e;for(var r,n,i,a=this.dom.getElementsByClassName("box"),o=0;o<a.length;o++){(T=a[o]).addEventListener("click",function(e){this.parentElement.querySelector(".nested").classList.toggle("active"),this.classList.toggle("check-box")})}function s(e){e.stopPropagation();var r=void 0;e.ctrlKey?r="multiple":e.altKey&&(r="ancestor"),t.selectById(parseInt(this.id),r)}function l(e){e.stopPropagation(),e.preventDefault(),t.selectById(parseInt(this.id)),t.guiContextMenu.toggle(e)}function c(e){e.preventDefault(),r&&clearTimeout(r),t.mouseMovePosition.copy(t.getMousePosition(e))}function u(e){e.preventDefault(),n||(t.selectById(parseInt(this.id)),r=setTimeout(d,500,e),n=!0,t.mouseDownPosition.copy(t.getMousePosition(e)),document.addEventListener("touchend",h,!1))}function h(e){r&&(clearTimeout(r),n=!1),t.mouseUpPosition.copy(t.getMousePosition(e)),document.removeEventListener("touchend",h,!1)}function d(e){e.stopPropagation(),e.preventDefault(),t.guiContextMenu.toggle(e)}function p(e){i=this,e.stopPropagation()}function f(e){e.dataTransfer.setData("text","foo"),e.stopPropagation()}function m(e){if(this!==i){var t=e.offsetY/this.clientHeight;this.className=t<.25?"dragTop":t>.75?"dragBottom":"drag",e.preventDefault()}}function v(){this!==i&&(this.className="")}function g(e){if(this!==i){this.className="";var r=t.scene,n=r.getObjectById(parseInt(i.id));if(void 0!==n){var a=e.offsetY/this.clientHeight;if(a<.25)y(n,(o=r.getObjectById(parseInt(this.id))).parent,o);else if(a>.75){var o;y(n,(o=r.getObjectById(parseInt(this.nextSibling.id))).parent,o)}else{y(n,r.getObjectById(parseInt(this.id)))}e.stopPropagation()}}}function y(e,r,n){if(null!==r){null===n&&(n=void 0);var i=!1;e.traverse(function(e){e===r&&(i=!0)}),i||t.move(e,r,n)}}var E=this.dom.getElementsByTagName("li");this.items=E;var x=this.appWorks.scene.id.toString(),b=this.appWorks.camera.id.toString();for(o=0;o<E.length;o++){var T;(T=E[o]).className="",T.addEventListener("click",s,!1),T.addEventListener("contextmenu",l,!1),T.addEventListener("touchmove",c,!0),T.addEventListener("touchstart",u,!1),T.id===x||T.id===b?T.draggable=!1:(T.draggable=!0,T.addEventListener("drag",p,!1),T.addEventListener("dragstart",f,!1),T.addEventListener("dragover",m,!1),T.addEventListener("dragleave",v,!1),T.addEventListener("drop",g,!1))}var w=t.selectObjects.map(function(e){return e.id.toString()});this.clean("selected",!1),this.toggle(w,"selected",!0);w=[];return t.scene.traverse(function(e){!1===e.visible&&w.push(e.id.toString())}),this.clean("translucent",!1),this.toggle(w,"translucent",!0),this},ue.Boolean=function(e,t){ue.Span.call(this),this.setMarginRight("10px"),this.checkbox=new ue.Checkbox(e),this.text=new ue.Text(t).setMarginLeft("3px"),this.add(this.checkbox),this.add(this.text)},ue.Boolean.prototype=Object.create(ue.Span.prototype),ue.Boolean.prototype.constructor=ue.Boolean,ue.Boolean.prototype.getValue=function(){return this.checkbox.getValue()},ue.Boolean.prototype.setValue=function(e){return this.checkbox.setValue(e)},window.MW=n,d.demoFallingLeaves=function(e,t){e=void 0!==e?e:"images/leaf.png",t=void 0!==t?t:1e4;for(var r=new d.InstancedMesh(new THREE.PlaneBufferGeometry(.1,.1),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load(e),side:THREE.DoubleSide,transparent:!0,opacity:.99,depthWrite:!1}),t,!0,!0,!0),n=2*Math.PI,i=new THREE.Vector3,a=new THREE.Euler,o=new THREE.Quaternion,s=new THREE.Vector3,l=new THREE.Color,c=0;c<t;c++){i.set(50*(Math.random()-.5),50*(Math.random()-.5)+25,50*(Math.random()-.5)),a.set(0,Math.random()*n,0),o.setFromEuler(a);var u=1+Math.random();s.set(u,u,u),l.setHSL(1,Math.random(),.5),r.setPositionAt(c,i),r.setQuaternionAt(c,o),r.setScaleAt(c,s),r.setColorAt(c,l)}r.castShadow=!0,r.receiveShadow=!0,r.frustumCulled=!1,d.add(r),r.update=function(e,t){for(var r=.1*e,n=new THREE.Vector3,i=new THREE.Euler,a=new THREE.Quaternion,o=new THREE.Vector3,s=0;s<this.numInstances;s++)this.getPositionAt(s,n),n.y<.01?n.x<-25?(n.x=50*(Math.random()-.5),n.y=50*(Math.random()-.5)+25,n.z=50*(Math.random()-.5)):(n.x-=5*r,n.z+=5*r*(Math.random()-.5),this.getQuaternionAt(s,a),i.setFromQuaternion(a),i.x=-Math.PI/2,i.y=0,a.setFromEuler(i),this.setQuaternionAt(s,a)):n.y-=5*r,this.setPositionAt(s,n),this.getQuaternionAt(s,a),this.getScaleAt(s,o),i.setFromQuaternion(a),i.x+=o.x*r,i.z+=o.z*r,a.setFromEuler(i),this.setQuaternionAt(s,a);this.needsUpdate("position"),this.needsUpdate("quaternion"),this.rotation.y=.1*Math.sin(.5*t)}},d.demoNatureWorks2018=function(){var e=d.scene,t=d.camera;d.appWorks.playAudio(["audio/NatureWorks.mp3"]),d.appWorks.bloomPass.enabled=!0,e.getObjectsByType("AmbientLight").forEach(function(e){e.visible=!1}),e.getObjectsByType("PointLight").forEach(function(e){e.visible=!1}),e.getObjectsByType("SpotLight").forEach(function(e){e.visible=!1}),e.getObjectsByType("DirectionalLight").forEach(function(e){e.visible=!1}),e.getObjectsByType("HemisphereLight").forEach(function(e){e.visible=!1}),d.demoTerrains();var r=d.sunLight;r.updateMotion("constant"),d.addTextMesh("www.natureworks.solutions",{position:{x:-3.5,y:1.1,z:0},color:2236962,height:.25,alignment:0,fontFile:"fonts/optimer_regular.typeface.json"});var n=new THREE.Mesh(new THREE.PlaneBufferGeometry(.85,.85),new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("images/leaf.png"),side:THREE.DoubleSide,transparent:!0,opacity:.99,depthWrite:!1}));n.position.x-=4,n.position.y+=.5,d.add(n);d.addTextMesh("N",{position:{x:-3,y:0,z:0},color:16716032,rotSpeed:0}),d.addTextMesh("ature",{position:{x:-1,y:0,z:0},color:8947848}),d.addTextMesh("W",{position:{x:4.2-3,y:0,z:0},color:4607,rotSpeed:.6}),d.addTextMesh("orks",{position:{x:5.9-3,y:0,z:0},color:8947848}),d.demoFallingLeaves("images/leaf.png",5e3);for(var i=[],a=0;a<6;a++){var o=Math.PI*a/4,s=7*Math.cos(o),l=5*Math.sin(2*o);l=Math.max(l,1);var c=9*Math.sin(o);i.push(new THREE.Vector3(s,l,c))}var u=new THREE.CatmullRomCurve3(i,!0),h=new THREE.Line((new THREE.BufferGeometry).setFromPoints(u.getPoints(20)),new THREE.LineBasicMaterial({color:16777215}));h.visible=!1,d.add(h),h.update=function(e,r){var n=r%40/40;t.position.copy(u.getPoint(n))};var p=new THREE.Object3D;p.stage=1,d.add(p),p.update=function(e,t){10<t&&1===this.stage?(d.demoFallingLeaves("images/leaf.png",5e3),this.stage++):20<t&&2===this.stage?(d.demoFallingLeaves("images/leaves/leaf1.png",1e4),this.stage++):40<t&&3===this.stage&&(d.demoFallingLeaves("images/leaves/leaf3.png",1e4),this.stage++,r.updateMotion("static"),r.updatePosition(.49))}},d.demoBasicPrimitives=function(){var e=(new THREE.TextureLoader).load("images/uv_grid_opengl.jpg"),t=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshBasicMaterial",map:e}}),r=d.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[5,5,10,32]},material:{type:"MeshBasicMaterial",map:e}}),n=d.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshBasicMaterial",map:e}}),i=d.createPrimitive({geometry:{type:"TorusBufferGeometry",parameters:[5,1.5,128,32]},material:{type:"MeshBasicMaterial",map:e}}),a=d.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,1.5,128,32]},material:{type:"MeshBasicMaterial",map:e}});t.position.y=0,r.position.y=10,n.position.y=20,i.position.y=30,a.position.y=40,d.add(t),d.add(r),d.add(n),d.add(i),d.add(a)},d.demoText=function(){d.addTextMesh("[NatureWorks]",{color:4521745,height:2.5,position:{x:0,y:18,z:-5}}),d.addTextMesh("Jamie.js",{position:new THREE.Vector3(0,5,0),color:13311,height:2,thickRatio:.2}),d.addTextMesh("www.nova-graphix.com",{position:{x:1.5,y:-5,z:0},color:16716168,height:1.5,thickRatio:.5})},d.demoSprite=function(){var e=new THREE.Sprite(new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load("images/jamieElly1024.png"),color:16777215,fog:!0}));e.position.z=8,e.scale.set(5,5,5),e.name="demoSprite",d.add(e)},d.demoBox=function(){var e=new THREE.TextureLoader,t=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial",color:15990754,map:e.load("images/ground/stonewall.png"),normalMap:e.load("images/ground/stonewall_n.png"),specularMap:e.load("images/ground/stonewall_s.png")}});t.position.x=-15,t.name="demoBox",t.update=function(e,t){this.rotation.x+=.1*e,this.rotation.y+=.2*e,this.rotation.z+=.5*e},d.add(t)},d.demoSpheres=function(){var e,t;(t=d.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshPhongMaterial",color:16711680,specular:2236962,shininess:150,transparent:!0,opacity:.5}})).name="demoSphere_transparent",d.add(t),(e=d.scene.background.clone()).mapping=THREE.CubeRefractionMapping,e.needsUpdate=!0,(t=d.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshPhongMaterial",color:16777215,specular:2236962,shininess:150,envMap:e}})).position.z=10,t.name="demoSphere_refraction",d.add(t),(e=d.scene.background).mapping=THREE.CubeReflectionMapping,e.needsUpdate=!0,(t=d.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[5,32,16]},material:{type:"MeshPhongMaterial",color:16777215,specular:2236962,shininess:150,envMap:e}})).position.z=20,t.name="demoSphere_reflection",d.add(t)},d.demoPBRSpheres=function(){for(var e=new THREE.SphereBufferGeometry(.8,32,16),t=new THREE.Vector3(0,0,-22),r=0;r<=1;r+=.2){for(var n=0;n<=1;n+=.2)for(var i=0;i<=1;i+=.2){var a=(new THREE.Color).setHSL(r,.5,.5*i+.1),o=new THREE.MeshStandardMaterial({color:a,metalness:n,roughness:1-r,bumpScale:1});0;var s=new THREE.Mesh(e,o);s.position.x=10*r-5+t.x,s.position.y=10*n-5+t.y,s.position.z=10*i-5+t.z,s.castShadow=!0,s.name="demoPBRSpheres",d.add(s)}0}},d.demoTorusKnot=function(){var e=(new THREE.TextureLoader).load("images/roughness_map.jpg",function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.anisotropy=4,e.repeat.set(9,2)}),t=d.createPrimitive({geometry:{type:"TorusKnotGeometry",parameters:[18,8,128,32]},material:{type:"MeshStandardMaterial",color:16777215,metalness:1,roughness:0,bumpScale:-.05,transparent:!0,opacity:.9,map:e,roughnessMap:e,bumpMap:e,envMap:d.scene.background}});t.scale.set(.2,.2,.2),t.position.z=-10,t.castShadow=!0,t.receiveShadow=!0,t.name="demoTorusKnot",d.add(t)},d.demoTeapot=function(){d.loadOBJ({obj:"teapot.obj",basePath:"models/obj/",callback:function(e){var t=e.children[0];void 0!==t.material&&t.material.dispose();var r=d.ToonShader,n=THREE.UniformsUtils.clone(r.uniforms);n.uMaterialColor.value=(new THREE.Color).setHSL(.34,.68,.7),n.uDirLightPos.value=new THREE.Vector3(100,100,-100),n.uDirLightColor.value=new THREE.Color(16777215),t.material=new THREE.ShaderMaterial({uniforms:n,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),d.resizeObject(t,20),d.add(e),t.position.x+=15,t.castShadow=!0,t.receiveShadow=!0,t.name="demoTeapot"}})},d.demoNoise=function(){var e=d.NoiseShader,t=THREE.UniformsUtils.clone(e.uniforms);t.scale.value=20;var r=new THREE.Mesh(new THREE.SphereBufferGeometry(5,32,16),new THREE.ShaderMaterial({uniforms:t,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}));r.position.set(17.5,0,-10),r.castShadow=!0,r.receiveShadow=!0,r.name="demoNoise",d.add(r)},d.demoDecal=function(){var e=new THREE.BoxBufferGeometry(10,10,10),t=new THREE.TextureLoader,r=t.load("images/decal/decal-diffuse.png"),n=t.load("images/decal/decal-normal.jpg"),i=d.scene.background;i.mapping=THREE.CubeReflectionMapping,i.needsUpdate=!0;var a=new THREE.MeshPhongMaterial({map:r,normalMap:n,envMap:i,alphaTest:.5}),o=new THREE.Mesh(e,a);o.position.set(-15,0,15),o.castShadow=!0,o.receiveShadow=!0,o.name="demoDecal",d.add(o)},d.demoPrimitives=function(){d.demoBasicPrimitives(),d.demoSprite(),d.demoBox(),d.demoPBRSpheres(),d.demoTorusKnot(),d.demoTeapot(),d.demoNoise(),d.demoDecal()},d.demoReflectionSpheres=function(){for(var e=d.camera.near,t=d.camera.far,r=0;r<50;r++){var n=new THREE.Mesh;n.cubeCamera=new THREE.CubeCamera(e,t,256);var i=200*(Math.random()-.5),a=200*(Math.random()-.5),o=200*(Math.random()-.5),s=10*(Math.random()+.5),l=new THREE.SphereBufferGeometry(s,32,16),c=new THREE.MeshBasicMaterial({envMap:n.cubeCamera.renderTarget.texture});n.geometry=l,n.material=c,n.position.set(i,a,o),n.castShadow=!0,n.receiveShadow=!0,n.name="demoReflectionSpheres",n.cubeCamera.position.copy(n.position),n.update=function(e,t){this.visible=!1,this.cubeCamera.update(d.renderer,d.scene),this.visible=!0},d.add(n)}},d.demoRefractionSpheres=function(){for(var e=d.camera.near,t=d.camera.far,r=0;r<20;r++){var n=new THREE.Mesh;n.cubeCamera=new THREE.CubeCamera(e,t,256);var i=150*(Math.random()-.5),a=150*(Math.random()-.5),o=150*(Math.random()-.5),s=10*(Math.random()+.5),l=new THREE.SphereBufferGeometry(s,32,16),c=new THREE.MeshBasicMaterial({envMap:n.cubeCamera.renderTarget.texture,refractionRatio:.99});c.envMap.mapping=THREE.CubeRefractionMapping,n.geometry=l,n.material=c,n.position.set(i,a,o),n.castShadow=!0,n.receiveShadow=!0,n.name="demoRefractionSpheres",n.cubeCamera.position.copy(n.position),n.update=function(e,t){this.visible=!1,this.cubeCamera.update(d.renderer,d.scene),this.visible=!0},d.add(n)}},d.demoReflectRefractSpheres=function(){d.demoReflectionSpheres(),d.demoRefractionSpheres()},d.demoPointSpriteColors=function(){for(var e=[],t=new THREE.Geometry,r=(new THREE.TextureLoader).load("images/sprites/ball.png"),n=0;n<5e4;n++){var i=new THREE.Vector3;i.x=1e4*(Math.random()-.5),i.y=1e4*(Math.random()-.5),i.z=1e4*(Math.random()-.5),t.vertices.push(i),e[n]=new THREE.Color(16777215),e[n].setHSL((i.x+500)/1e3,1,.5)}t.colors=e;var a=new THREE.PointsMaterial({size:85,map:r,vertexColors:THREE.VertexColors,alphaTest:.5,transparent:!0});a.color.setHSL(1,1,.6);var o=new THREE.Points(t,a);o.name="demoPointSpriteColors",o.update=function(e,t){var r=360*(1+.2*t)%360/360;this.material.color.setHSL(r,1,.6),this.rotation.x+=.1*e,this.rotation.y+=.2*e,this.rotation.z+=.3*e},d.add(o)},d.demoInstancedBox=function(){var e=new THREE.TextureLoader,t=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[2,2,2]},material:{type:"MeshPhongMaterial",color:15990754,specular:1118481,shininess:30,map:e.load("images/ground/stonewall.png"),normalMap:e.load("images/ground/stonewall_n.png"),specularMap:e.load("images/ground/stonewall_s.png")}}),r=d.createInstancedMeshes(t,{pmin:[-100,-100,-100],pmax:[100,100,100],rmin:[0,0,0],rmax:[2*Math.PI,2*Math.PI,2*Math.PI],numInstances:1e4,colorMode:"1"});r.name="demoInstancedBox",r.frustumCulled=!1,r.castShadow=!0,r.receiveShadow=!0,r.update=function(){var e=new THREE.Euler,t=new THREE.Quaternion,r=new THREE.Vector3;return function(n,i){for(var a=2*n,o=0;o<this.numInstances;o++)this.getQuaternionAt(o,t),this.getScaleAt(o,r),e.setFromQuaternion(t),e.x+=r.x*a,e.z+=r.z*a,t.setFromEuler(e),this.setQuaternionAt(o,t);this.needsUpdate("quaternion")}}(),d.add(r)},d.demoInstancedBox2=function(){var e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[1,1,1]},material:{type:"MeshPhongMaterial",map:(new THREE.TextureLoader).load("images/crate.gif")}}),t=d.createInstancedMeshes(e,{pmin:[-50,-50,-50],pmax:[50,50,50],smin:[.5,.5,.5],smax:[2,2,2],numInstances:1e4,colorMode:"0"});t.name="demoInstancedBox2",t.frustumCulled=!1,t.castShadow=!0,t.receiveShadow=!0;for(var r=t.geometry,n=new THREE.Vector4,i=[],a=[],o=0;o<t.numInstances;o++)n.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),n.normalize(),i.push(n.x,n.y,n.z,n.w),n.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),n.normalize(),a.push(n.x,n.y,n.z,n.w);r.addAttribute("orientStart",new THREE.InstancedBufferAttribute(new Float32Array(i),4)),r.addAttribute("orientEnd",new THREE.InstancedBufferAttribute(new Float32Array(a),4)),t.material.onBeforeCompile=function(e){e.uniforms.time={value:0},e.vertexShader=e.vertexShader.replace("#include <clipping_planes_pars_vertex>\n","#include <clipping_planes_pars_vertex>\nuniform float time;\nattribute vec4 orientStart;\nattribute vec4 orientEnd;\nvec3 animatePosition( vec3 position )\n{\nfloat sineTime = sin(time * 0.5);\nvec3 animated = instanceScale * position;\nanimated = instancePosition * max( abs( sineTime * 2.0 + 1.0 ), 0.5 ) + animated;\nvec4 orient = normalize( mix( orientStart, orientEnd, sineTime ) );\nvec3 vcV = cross( orient.xyz, animated );\nanimated = vcV * ( 2.0 * orient.w ) + ( cross( orient.xyz, vcV ) * 2.0 + animated );\nreturn animated;\n}\n"),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","vec3 position = animatePosition( position );\n#include <begin_vertex>"),this.shader=e},t.update=function(e,t){t*=.1,this.rotation.y=t,this.material.shader.uniforms.time.value=2*t},d.add(t)},d.demoInstancedFish=function(){d.loadOBJ({obj:"fish.obj",mtl:"fish.mtl",basePath:"models/obj/fish/",callback:function(e){d.add(e),d.underWaterBackground();if(void 0!==e){var t=e.children[0];d.translateGeometry(t.geometry,{x:2.585,y:0,z:0}),t.material.transparent=!0,t.material.fog=!0;var r=new d.InstancedMesh(t.geometry,t.material,5e3,!0,!1,!0);r.material.onBeforeCompile=function(e){e.uniforms.time={value:0},e.uniforms.fishSpeed={value:.5+.5*Math.random()},e.uniforms.fishLength={value:18},e.vertexShader="uniform float time;\nuniform float fishSpeed;\nuniform float fishLength;\n"+d.ShaderChunk.fishAnimation+"\n"+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","vec3 position = fishAnimation( position );\n#include <begin_vertex>"),e.fragmentShader=e.fragmentShader.replace("gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","gl_FragColor.rgb = mix( gl_FragColor.rgb*(1.0-fogFactor), fogColor, fogFactor );"),r.material.shader=e};for(var n,i=new THREE.Vector3,a=new THREE.Euler,o=new THREE.Quaternion,s=new THREE.Vector3,l=2*Math.PI,c=[],u=0;u<5e3;u++)i.set(500*(Math.random()-.5),500*(Math.random()-.5)-250,500*(Math.random()-.5)),a.set(0,Math.random()*l,0),o.setFromEuler(a),c.push(a.y),n=2+1.5*Math.random(),s.set(n,n,n),r.setPositionAt(u,i),r.setQuaternionAt(u,o),r.setScaleAt(u,s);r.castShadow=!0,r.receiveShadow=!0,r.frustumCulled=!1,r.name="demoInstancedFish",d.add(r),r.update=function(e,t){this.material.shader&&(this.material.shader.uniforms.time.value=t);for(var r=10*e,n=new THREE.Vector3,i=0;i<this.numInstances;i++){this.getPositionAt(i,n);var a=c[i];n.x<-250?n.x=250:n.x>250?n.x=-250:n.x+=r*Math.sin(a),n.z<-250?n.z=250:n.z>250?n.z=-250:n.z+=r*Math.cos(a),this.setPositionAt(i,n)}this.needsUpdate("position")}}}})},d.demoViewportCamera=function(){var e=new THREE.Object3D;e.name="multiViews";var t=d.camera.position.length();e.views=[],e.views.push({left:.5,bottom:.5,width:.5,height:.5,eye:[t,t,t],up:[0,1,0],camera:null},{left:0,bottom:.5,width:.5,height:.5,eye:[0,t,0],up:[0,1,-1],camera:null},{left:0,bottom:0,width:.5,height:.5,eye:[0,0,t],up:[0,1,0],camera:null},{left:.5,bottom:0,width:.5,height:.5,eye:[t,0,0],up:[0,1,0],camera:null},{left:0,bottom:0,width:.01,height:.01,eye:[t,t,t],up:[0,1,0],camera:null});for(var r=0,n=e.views.length;r<n;r++){var i=e.views[r];i.camera=new THREE.PerspectiveCamera(d.camera.fov,window.innerWidth/window.innerHeight,d.camera.near,d.camera.far),i.camera.position.fromArray(i.eye),i.camera.up.fromArray(i.up)}e.update=function(t,r){var n=window.innerWidth,i=window.innerHeight,a=d.renderer,o=d.appWorks.mouseMovePosition;a.setClearColor(0),a.setScissorTest(!0);for(var s=0,l=e.views.length;s<l;s++){var c=e.views[s],u=Math.floor(n*c.left),h=Math.floor(i*c.bottom),p=Math.floor(n*c.width),f=Math.floor(i*c.height);a.setViewport(u,h,p,f),a.setScissor(u,h,p,f),c.camera.lookAt(d.scene.position),c.camera.aspect=p/f,c.camera.updateProjectionMatrix(),a.render(d.scene,c.camera)}var m=o.x>0?o.y>0?0:3:o.y>0?1:2,v=d.appWorks.controls;v.object=e.views[m].camera,v.update()},d.add(e)},d.demoViewportScene=function(){var e=new THREE.Object3D;e.name="viewportElements",e.scenes=[];var t=[new THREE.BoxBufferGeometry(1,1,1),new THREE.SphereBufferGeometry(.5,12,8),new THREE.DodecahedronBufferGeometry(.5),new THREE.CylinderBufferGeometry(.5,.5,1,12)],r=new ue.Div;r.setPosition("absolute"),r.setTop("0px"),r.setWidth("100%"),r.setMargin("1em 0 0 0"),r.setZIndex("0"),document.getElementById("novaGraphix").parentNode.appendChild(r.dom);var n=(new ue.Panel).setColor("#000080").setTextAlign("center").setFontSize("20px");n.dom.style.fontFamily="Arial, Helvetica, sans-serif",n.dom.style.fontVariant="small-caps",r.add(n);var i=new ue.Row;i.setTextShadow("1px 1px 2px #888"),i.add(new ue.Text("2019 NovaGraphix, Co. All rights reserved.")),n.add(i);var a=new ue.Row,o=document.createElement("a");o.setAttribute("href","https://www.nova-graphix.com/"),o.innerHTML="https://www.nova-graphix.com/",a.dom.appendChild(o),n.add(a);for(var s='        <div class="scene" style="width: 200px; height: 200px;"></div>\n        <div class="description" style="color: #111; font-family: \'Karla\', sans-serif; font-size: 1.2em; width: 200px; margin-top: 0.5em;">\n            Scene $\n        </div>\n    ',l=0;l<40;l++){var c=new THREE.Scene,u=(new ue.Div).setClass("scene-item");u.dom.style.cssText="display: inline-block; margin: 0.5em; padding: 0.5em; box-shadow: 2px 2px 4px rgba(0,0,0,0.6);",u.dom.innerHTML=s.replace("$",l),r.add(u),c.userData.element=u.dom.querySelector(".scene");var h=new THREE.PerspectiveCamera(50,1,.1,50);h.position.z=2,c.userData.camera=h;var p=new THREE.OrbitControls(c.userData.camera,c.userData.element);p.minDistance=1,p.maxDistance=7.5,p.enablePan=!0,p.enableZoom=!0,p.enableDamping=!0,p.screenSpacePanning=!0,p.dampingFactor=.1,p.panSpeed=.1,p.rotateSpeed=.07,p.enabled=!0,c.userData.controls=p;var f=t[t.length*Math.random()|0],m=new THREE.MeshStandardMaterial({color:(new THREE.Color).setHSL(Math.random(),1,.5),roughness:.5,metalness:0,flatShading:!0}),v=new THREE.Mesh(f,m);v.update=function(e,t){this.rotation.y=t},c.add(v);var g=d.createShowroom(v,{background:"cloudsFS"});c.add(g),e.scenes.push(c)}e.update=function(t,r){var n=d.renderer;n.domElement.style.transform=`translateY(${window.scrollY}px)`,n.setClearColor(14540253),n.setScissorTest(!0),e.scenes.forEach(function(e,i){e.traverse(e=>{e.update&&e.update(t,r)});var a=e.userData.element.getBoundingClientRect();if(!(a.bottom<0||a.top>n.domElement.clientHeight||a.right<0||a.left>n.domElement.clientWidth)){var o=a.width,s=a.height,l=a.left,c=n.domElement.clientHeight-a.bottom;n.setViewport(l,c,o,s),n.setScissor(l,c,o,s);var u=e.userData.camera;n.render(e,u)}})},d.add(e)},d.demoVideoTexture=function(){var e=document.createElement("video");e.width=window.innerWidth,e.height=window.innerHeight,e.loop=!0,e.muted=!0,e.src="video/EllyUSOpen2017.mp4",e.play();var t,r=new THREE.PlaneBufferGeometry(178,100);(t=new THREE.VideoTexture(e)).minFilter=THREE.LinearFilter,t.format=THREE.RGBFormat;var n,i=new THREE.MeshBasicMaterial({map:t,side:THREE.DoubleSide});(n=new THREE.Mesh(r,i)).name="demoVideoTexture",d.add(n)},d.demoTerrains=function(){var e=d.createSunLight(.49);e.userData.motion="variable",d.add(e),d.add(d.createSky());var t=d.createTerrain(100,256,5);d.add(t);var r=d.createWater(0,.9,20,1);d.add(r),d.add(d.createCloudDome(1024)),d.camera.position.set(0,5,100),d.camera.lookAt(d.scene.position)},d.demoMinecraft=function(){var e=d.scene;d.camera,d.appWorks.controls;if(0===d.scene.getObjectsByType("AmbientLight").length){var t=d.createAmbientLight({color:13421772});d.add(t)}0===d.scene.getObjectsByType("DirectionalLight").length&&((t=d.createDirectionalLight({color:16777215,intensity:2})).position.set(1,1,.5),d.add(t));e.fog&&(e.fog.density=4e-4);var r=new THREE.TextureLoader,n=new THREE.MeshLambertMaterial({map:r.load("images/minecraft/grass.png")}),i=new THREE.MeshLambertMaterial({map:r.load("images/minecraft/grass_dirt.png")}),a=new THREE.MeshLambertMaterial({map:r.load("images/minecraft/dirt.png")}),o=new THREE.PlaneBufferGeometry(1,1).rotateY(Math.PI/2).translate(.5,0,0),s=new THREE.PlaneBufferGeometry(1,1).rotateY(-Math.PI/2).translate(-.5,0,0),l=new THREE.PlaneBufferGeometry(1,1).rotateX(-Math.PI/2).translate(0,.5,0),c=new THREE.PlaneBufferGeometry(1,1).rotateX(Math.PI/2).translate(0,-.5,0),u=new THREE.PlaneBufferGeometry(1,1).translate(0,0,.5),h=new THREE.PlaneBufferGeometry(1,1).rotateY(Math.PI).translate(0,0,-.5),p=new THREE.Object3D;p.add(new THREE.Mesh(o,i)),p.add(new THREE.Mesh(s,i)),p.add(new THREE.Mesh(u,i)),p.add(new THREE.Mesh(h,i)),p.add(new THREE.Mesh(l,n)),p.add(new THREE.Mesh(c,a));var f=1024,m=1024;d.isDeviceMobile()&&(f=m=256);var v=function(e,t){for(var r=function(e,t){var r,n,i=2,a=100*Math.random(),o=e*t,s=new THREE.ImprovedNoise,l=[];l.zero(o);for(var c=0;c<4;c++){for(var u=0;u<o;u++)r=u%e,n=u/e|0,l[u]+=s.noise(r/i,n/i,a)*i;i*=4}return l}(e=Math.floor(e),t=Math.floor(t)),n=e/2,i=t/2,a=[],o=0;o<t;o++)for(var s=0;s<e;s++){var l=.2*r[s+o*e]|0;a.push(s-n,l,o-i)}return a}(f,m),g=d.createInstancedObject(p,{positions:v});g.name="demoMinecraft",d.add(g),void 0===e.getObjectsByProperty("userData","type","Water")[0]&&d.add(d.createWater())},d.demoSponzaAnimals=function(){var e=new THREE.LoadingManager;e.onStart=()=>{d.createProgressbar()},e.onProgress=(e,t,r)=>{d.updateProgressbar(t,r)},e.onLoad=()=>{d.hideProgressbar()},e.onError=e=>{d.errorProgressbar("There was an error loading "+e)},d.loadOBJ({obj:"sponza.obj",mtl:"sponza.mtl",basePath:"models/obj/sponza/",manager:e,callback:function(e){d.add(e)}});var t=new THREE.Vector3(0,.5*-Math.PI,0),r=new THREE.Vector3;d.loadJSON({url:"models/json/cow.js",manager:e,callback:function(e){d.resizeObject(e,100),d.transformObject(e,r.set(-240,0,0)),d.add(e),d.appWorks.playAction(e)}}),d.loadJSON({url:"models/json/elk.js",manager:e,callback:function(e){d.resizeObject(e,100),d.transformObject(e,r.set(-180,0,0)),d.add(e),d.appWorks.playAction(e)}}),d.loadJSON({url:"models/json/flamingo.js",manager:e,callback:function(e){d.resizeObject(e,100),d.transformObject(e,r.set(-120,40,0)),d.add(e),d.appWorks.playAction(e)}}),d.loadJSON({url:"models/json/fox.js",manager:e,callback:function(e){d.resizeObject(e,100),d.transformObject(e,r.set(-60,0,0)),d.add(e),d.appWorks.playAction(e)}}),d.loadJSON({url:"models/json/horse.js",manager:e,callback:function(e){d.resizeObject(e,100),d.transformObject(e,r.set(0,0,0)),d.add(e),d.appWorks.playAction(e)}}),d.loadJSON({url:"models/json/monster.js",basePath:"models/json/",manager:e,callback:function(e){d.resizeObject(e,100),d.transformObject(e,r.set(60,0,-30),t),d.add(e),d.appWorks.playAction(e)}}),d.loadJSON({url:"models/json/parrot.js",manager:e,callback:function(e){d.resizeObject(e,100),d.transformObject(e,r.set(120,40,0)),d.add(e),d.appWorks.playAction(e)}}),d.loadJSON({url:"models/json/sittingBox.js",manager:e,callback:function(e){d.resizeObject(e,100),d.transformObject(e,r.set(180,0,0)),d.add(e),d.appWorks.playAction(e)}}),d.loadJSON({url:"models/json/stork.js",manager:e,callback:function(e){d.resizeObject(e,100),d.transformObject(e,r.set(240,40,0)),d.add(e),d.appWorks.playAction(e)}})},d.demoForest=function(){function e(e,t){t=t||8;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}if(d.isDeviceMobile()){var t=200,r=200,n=new THREE.TextureLoader;(l=new THREE.Mesh(new THREE.PlaneBufferGeometry(t,r),new THREE.MeshStandardMaterial({color:16777215,roughness:1,metalness:0,map:n.load("images/terrain/dirtGrassTerrainD6.jpg",e),normalMap:n.load("images/terrain/dirtGrassTerrainN.jpg",e),aoMap:n.load("images/terrain/dirtGrassTerrainAO.jpg",e)}))).name="ground",l.rotation.x=-Math.PI/2,d.add(l);var i=2,a=d.createGrassTufts(1e3,t,i,r,150320,"images/grass/grass01.png");d.add(a);a=d.createGrassTufts(1e3,t,i,r,228688,"images/grass/grass02.png");d.add(a);var o=d.createFlowerTufts(100,t,i,r,null,"images/grass/flowers01.png");d.add(o);o=d.createFlowerTufts(100,t,i,r,null,"images/grass/flowers02.png");d.add(o);var s=d.createProcTrees(t,r,200);d.add(s),d.add(d.createCloudDome()),d.add(d.createSkyDome()),d.scene.add(d.createHemisphereLight()),d.camera.position.set(10,10,70),d.camera.lookAt(d.scene.position)}else{var l;t=500,r=500,n=new THREE.TextureLoader;(l=new THREE.Mesh(new THREE.PlaneBufferGeometry(t,r),new THREE.MeshStandardMaterial({color:16777215,roughness:1,metalness:0,map:n.load("images/terrain/dirtGrassTerrainD6.jpg",e),normalMap:n.load("images/terrain/dirtGrassTerrainN.jpg",e),aoMap:n.load("images/terrain/dirtGrassTerrainAO.jpg",e)}))).name="ground",l.rotation.x=-Math.PI/2,d.add(l);i=2,a=d.createGrassTufts(1e4,t,i,r,150320,"images/grass/grass01.png");d.add(a);a=d.createGrassTufts(1e4,t,i,r,228688,"images/grass/grass02.png");d.add(a);o=d.createFlowerTufts(1e3,t,i,r,null,"images/grass/flowers01.png");d.add(o);o=d.createFlowerTufts(1e3,t,i,r,null,"images/grass/flowers02.png");d.add(o);s=d.createProcTrees(t,r,2e3);d.add(s),d.add(d.createCloudDome()),d.add(d.createSkyDome()),d.scene.add(d.createHemisphereLight()),d.camera.position.set(10,10,70),d.camera.lookAt(d.scene.position)}},d.demoLoadFiles=function(){d.loadGLTF({url:"models/gltf/cartoon_small_city/scene.gltf",callback:function(e){d.fitCameraToObject(e),d.add(e)}})},d.demoEarthSystem=function(){var e=d.scene,t={earth:{radius:.18,orbitRadius:4.5,orbitPeriod:365,rotPeriod:1,inclination:0},moon:{radius:.04,orbitRadius:.75,orbitPeriod:30,rotPeriod:30,inclination:0}};e.earthData=t;var r=new THREE.TextureLoader,n=new THREE.Object3D;if(n.name="demoEarthPivot",d.add(n),n.scale.setScalar(100),void 0===(i=e.getObjectsByType("HemisphereLight")[0])){var i=d.createHemisphereLight({skyColor:(new THREE.Color).setHSL(.6,1,.6),groundColor:(new THREE.Color).setHSL(.095,1,.75),intensity:1});d.add(i)}var a=new THREE.SphereBufferGeometry(t.earth.radius,32,32),o=new THREE.MeshPhongMaterial({map:r.load("images/planets/earth_texture.jpg"),bumpScale:.5,bumpMap:r.load("images/planets/earthbump1k.jpg"),specular:new THREE.Color("grey"),specularMap:r.load("images/planets/earthspec1k.jpg")}),s=new THREE.Mesh(a,o);s.name="demoEarth",n.add(s),n.position.copy(s.position);a=new THREE.SphereBufferGeometry(1.02*t.earth.radius,32,32),o=new THREE.MeshPhongMaterial({map:r.load("images/planets/earthcloudmap.jpg"),alphaMap:r.load("images/planets/earthcloudmaptrans.jpg"),opacity:.8,transparent:!0,depthWrite:!1});var l=new THREE.Mesh(a,o);l.name="demoEarthCloud",s.add(l);var c=new THREE.Object3D;c.position.copy(s.position),c.rotation.x=t.moon.inclination*THREE.Math.DEG2RAD,n.add(c);a=new THREE.SphereBufferGeometry(t.moon.radius,32,32),o=new THREE.MeshPhongMaterial({map:r.load("images/planets/moonmap1k.jpg"),bumpMap:r.load("images/planets/moonbump1k.jpg"),bumpScale:.02});var u=new THREE.Mesh(a,o);u.position.x=t.moon.orbitRadius,u.name="demoMoon",c.add(u);var h=new THREE.EllipseCurve(0,0,t.moon.orbitRadius,t.moon.orbitRadius).getPoints(70),p=(a=(new THREE.BufferGeometry).setFromPoints(h),o=new THREE.LineBasicMaterial({color:2236962}),new THREE.Line(a,o));p.rotation.x=-Math.PI/2,p.rotation.x+=t.moon.inclination*THREE.Math.DEG2RAD,s.add(p),n.update=function(t,r){var n=.2*r*(2*Math.PI),i=e.earthData,a=i.earth.orbitPeriod,o=n/i.earth.rotPeriod;this.children[0].rotation.y=o,this.children[0].children[0].rotation.y=-o/2;a=n/i.moon.orbitPeriod,o=n/i.moon.rotPeriod;this.children[1].rotation.y=a,this.children[1].children[0].rotation.y=o}},d.demoSolarSystem=function(){var e=d.scene,t={sun:{radius:1,orbitRadius:0,orbitPeriod:0,rotPeriod:0,inclination:0},mercury:{radius:.1,orbitRadius:2.25,orbitPeriod:88,rotPeriod:59,inclination:7},venus:{radius:.18,orbitRadius:3,orbitPeriod:225,rotPeriod:-243,inclination:3.9},earth:{radius:.18,orbitRadius:4.5,orbitPeriod:365,rotPeriod:1,inclination:0},moon:{radius:.04,orbitRadius:.75,orbitPeriod:30,rotPeriod:30,inclination:0},mars:{radius:.3,orbitRadius:5.25,orbitPeriod:697,rotPeriod:1.017,inclination:1.85},jupiter:{radius:.6,orbitRadius:7.5,orbitPeriod:4234,rotPeriod:.417,inclination:1.3},saturn:{radius:.5,orbitRadius:10.5,orbitPeriod:10753,rotPeriod:.433,inclination:2.49},uranus:{radius:.3,orbitRadius:12.75,orbitPeriod:30660,rotPeriod:.708,inclination:.77},neptune:{radius:.3,orbitRadius:13.5,orbitPeriod:60225,rotPeriod:.833,inclination:1.77},pluto:{radius:.05,orbitRadius:15,orbitPeriod:90520,rotPeriod:6.4,inclination:17.2}};e.solarData=t;for(var r=["mercury","venus","earth","mars","jupiter","saturn","uranus","neptune","pluto"],n=0;n<r.length;n++)t[r[n]].rotPeriod*=40;var i=new THREE.TextureLoader,a=new THREE.SphereBufferGeometry(t.sun.radius,32,32),o=i.load("images/planets/sunmap2k.jpg"),s=new THREE.MeshBasicMaterial({map:o,specularMap:o,depthTest:!1}),l=new THREE.Mesh(a,s);l.position.x=t.sun.orbitRadius,l.name="demoSun",d.add(l),l.scale.setScalar(20);var c=d.createPointLightFlare({color:16777215,intensity:1.5,distance:1e3,flareSize:700});c.position.copy(l.position),d.add(c),(w=new THREE.Object3D).position.copy(l.position),w.rotation.x=t.mercury.inclination*THREE.Math.DEG2RAD,l.add(w);a=new THREE.SphereBufferGeometry(t.mercury.radius,32,32),s=new THREE.MeshPhongMaterial({map:i.load("images/planets/mercurymap.jpg"),bumpMap:i.load("images/planets/mercurybump.jpg"),bumpScale:.05});var u=new THREE.Mesh(a,s);u.position.x=t.mercury.orbitRadius,u.name="demoMercury",w.add(u),(w=new THREE.Object3D).position.copy(l.position),w.rotation.x=t.venus.inclination*THREE.Math.DEG2RAD,l.add(w);a=new THREE.SphereBufferGeometry(t.venus.radius,32,32),s=new THREE.MeshPhongMaterial({map:i.load("images/planets/venusmap.jpg"),bumpMap:i.load("images/planets/venusbump.jpg"),bumpScale:.05});var h=new THREE.Mesh(a,s);h.position.x=t.venus.orbitRadius,h.name="demoVenus",w.add(h),(w=new THREE.Object3D).position.copy(l.position),w.rotation.x=t.earth.inclination*THREE.Math.DEG2RAD,l.add(w);a=new THREE.SphereBufferGeometry(t.earth.radius,32,32),s=new THREE.MeshPhongMaterial({map:i.load("images/planets/earth_texture.jpg"),bumpScale:.5,bumpMap:i.load("images/planets/earthbump1k.jpg"),specular:new THREE.Color("grey"),specularMap:i.load("images/planets/earthspec1k.jpg")});var p=new THREE.Mesh(a,s);p.position.x=t.earth.orbitRadius,p.name="demoEarth",w.add(p);a=new THREE.SphereBufferGeometry(1.01*t.earth.radius,32,32),s=new THREE.MeshPhongMaterial({map:i.load("images/planets/earthcloudmap.jpg"),alphaMap:i.load("images/planets/earthcloudmaptrans.jpg"),side:THREE.DoubleSide,opacity:.8,transparent:!0,depthWrite:!1});var f=new THREE.Mesh(a,s);f.position.x=0,f.name="demoEarthCloud",p.add(f);var m=new THREE.Object3D;m.position.copy(p.position),m.rotation.x=t.moon.inclination*THREE.Math.DEG2RAD,w.add(m);a=new THREE.SphereBufferGeometry(t.moon.radius,32,32),s=new THREE.MeshPhongMaterial({map:i.load("images/planets/moonmap1k.jpg"),bumpMap:i.load("images/planets/moonbump1k.jpg"),bumpScale:.02});var v=new THREE.Mesh(a,s);v.position.x=t.moon.orbitRadius,v.name="demoMoon",m.add(v),(w=new THREE.Object3D).position.copy(l.position),w.rotation.x=t.mars.inclination*THREE.Math.DEG2RAD,l.add(w);a=new THREE.SphereBufferGeometry(t.mars.radius,32,32),s=new THREE.MeshPhongMaterial({map:i.load("images/planets/marsmap1k.jpg"),bumpMap:i.load("images/planets/marsbump1k.jpg"),bumpScale:.5});var g=new THREE.Mesh(a,s);g.position.x=t.mars.orbitRadius,g.name="demoMars",w.add(g),(w=new THREE.Object3D).position.copy(l.position),w.rotation.x=t.jupiter.inclination*THREE.Math.DEG2RAD,l.add(w);a=new THREE.SphereBufferGeometry(t.jupiter.radius,32,32),o=i.load("images/planets/jupitermap.jpg"),s=new THREE.MeshPhongMaterial({map:o,bumpMap:o,bumpScale:.2});var y=new THREE.Mesh(a,s);y.position.x=t.jupiter.orbitRadius,y.name="demoJupiter",w.add(y),(w=new THREE.Object3D).position.copy(l.position),w.rotation.x=t.saturn.inclination*THREE.Math.DEG2RAD,l.add(w);a=new THREE.SphereBufferGeometry(t.saturn.radius,32,32),o=i.load("images/planets/saturnmap.jpg"),s=new THREE.MeshPhongMaterial({map:o,bumpMap:o,bumpScale:.5});var E=new THREE.Mesh(a,s);E.position.x=t.saturn.orbitRadius,E.name="demoSaturn",w.add(E);a=new d.RingGeometry(1.2*t.saturn.radius,2*t.saturn.radius,64,5),s=new THREE.MeshBasicMaterial({map:i.load("images/planets/saturnringmap.jpg"),side:THREE.DoubleSide,transparent:!0,opacity:.8});var x=new THREE.Mesh(a,s);x.position.x=0,x.name="demoSaturnRing",E.add(x),(w=new THREE.Object3D).position.copy(l.position),w.rotation.x=t.uranus.inclination*THREE.Math.DEG2RAD,l.add(w);a=new THREE.SphereBufferGeometry(t.uranus.radius,32,32),o=i.load("images/planets/uranusmap.jpg"),s=new THREE.MeshPhongMaterial({map:o,bumpMap:o,bumpScale:.5});var b=new THREE.Mesh(a,s);b.position.x=t.uranus.orbitRadius,b.name="demoUranus",w.add(b);a=new d.RingGeometry(1.1*t.uranus.radius,1.5*t.uranus.radius,64,5),s=new THREE.MeshBasicMaterial({map:i.load("images/planets/uranusringmap.jpg"),side:THREE.DoubleSide,transparent:!0,opacity:.6});var T=new THREE.Mesh(a,s);T.position.x=0,T.name="demoUranusRing",b.add(T),(w=new THREE.Object3D).position.copy(l.position),w.rotation.x=t.neptune.inclination*THREE.Math.DEG2RAD,l.add(w);a=new THREE.SphereBufferGeometry(t.neptune.radius,32,32),o=i.load("images/planets/neptunemap.jpg"),s=new THREE.MeshPhongMaterial({map:o,bumpMap:o,bumpScale:.5});var w,_=new THREE.Mesh(a,s);_.position.x=t.neptune.orbitRadius,_.name="demoNeptune",w.add(_),(w=new THREE.Object3D).position.copy(l.position),w.rotation.x=t.pluto.inclination*THREE.Math.DEG2RAD,l.add(w);a=new THREE.SphereBufferGeometry(t.pluto.radius,32,32),s=new THREE.MeshPhongMaterial({map:i.load("images/planets/plutomap1k.jpg"),bumpMap:i.load("images/planets/plutobump1k.jpg"),bumpScale:.05});var R=new THREE.Mesh(a,s);R.position.x=t.pluto.orbitRadius,R.name="demoPluto",w.add(R);for(n=0;n<r.length;n++){var M=new THREE.EllipseCurve(0,0,t[r[n]].orbitRadius,t[r[n]].orbitRadius).getPoints(50+20*n);a=(new THREE.BufferGeometry).setFromPoints(M),s=new THREE.LineBasicMaterial({color:1118481});(S=new THREE.Line(a,s)).rotation.x=-Math.PI/2,S.rotation.x+=t[r[n]].inclination*THREE.Math.DEG2RAD,l.add(S)}var S;M=new THREE.EllipseCurve(0,0,t.moon.orbitRadius,t.moon.orbitRadius).getPoints(50),a=(new THREE.BufferGeometry).setFromPoints(M),s=new THREE.LineBasicMaterial({color:2236962});(S=new THREE.Line(a,s)).rotation.x=-Math.PI/2,S.rotation.x+=t.moon.inclination*THREE.Math.DEG2RAD,p.add(S),l.update=function(t,r){for(var n=20*r*(2*Math.PI),i=e.solarData,a=["mercury","venus","earth","mars","jupiter","saturn","uranus","neptune","pluto"],o=0;o<a.length;o++)if(2===o){var s=n/i.earth.orbitPeriod,l=n/i.earth.rotPeriod;this.children[o].rotation.y=s,this.children[o].children[0].rotation.y=l,this.children[o].children[0].children[0].rotation.y=-l/2;s=n/i.moon.orbitPeriod,l=n/i.moon.rotPeriod;this.children[o].children[1].rotation.y=s,this.children[o].children[1].children[0].rotation.y=l}else if(5===o||6===o){s=n/i[a[o]].orbitPeriod,l=n/i[a[o]].rotPeriod;this.children[o].rotation.y=s,this.children[o].children[0].rotation.y=l,this.children[o].children[0].children[0].rotation.y=l}else{s=n/i[a[o]].orbitPeriod,l=n/i[a[o]].rotPeriod;this.children[o].rotation.y=s,this.children[o].children[0].rotation.y=l}}},d.demoUnderWater=function(){d.scene.add(d.createHemisphereLight()),d.underWaterBackground();var e=Math.PI/2,t={sharks:{height:20,heightRange:2,radius:48,radiusRange:4,count:5,speed:.05,object:null,createFish:d.createFishShark},hammerSharks:{height:20,heightRange:2,radius:36,radiusRange:4,count:6,speed:.07,object:null,createFish:d.createFishHammerShark},tunas:{height:15,heightRange:4,radius:30,radiusRange:8,count:50,speed:.1,object:null,createFish:d.createFishTuna},snappers:{height:15,heightRange:5,radius:42,radiusRange:6,count:100,speed:.2,object:null,createFish:d.createFishSnapper},mackerels:{height:30,heightRange:10,radius:48,radiusRange:8,count:200,speed:.2,object:null,createFish:d.createFishMackerel}},r=new THREE.Object3D;for(var n in d.add(r),t){var i=t[n];i.object=new THREE.Object3D,i.object.name="fishes";for(var a=0;a<i.count;a++){var o=i.createFish(),s=d.circularRand(i.radius),l=Math.atan(s.y/s.x);o.rotation.y+=s.x>0?l+e:l-e;var c=i.heightRange*(Math.random()-.5),u=i.radiusRange*(Math.random()-.5);o.position.x=s.y+u*Math.sin(l),o.position.y=i.height+c,o.position.z=s.x+u*Math.cos(l),i.object.add(o)}r.add(i.object)}r.update=function(e,t){r.traverse(function(r){"fishes"===r.name&&(r.children.forEach(function(e){e.position.y+=.05*Math.sin(a+t)}),r.rotation.y+=i.speed*e)})};for(a=0;a<20;a++){o=d.createBrokenArchColumn(),s=d.circularRand(60),l=Math.atan(s.y/s.x);o.rotation.y+=l,o.position.set(s.y,0,s.x),r.add(o)}for(a=0;a<10;a++){o=d.createRuinColumn(),s=d.circularRand(60*(.5*Math.random()+.5)),l=Math.atan(s.y/s.x);o.rotation.y+=l,o.position.set(s.y,0,s.x),r.add(o)}for(var h=0;h<2;h++)for(a=0;a<30;a++){var p=15*(.5+.5*Math.random());o=d.createSeaweed(h,3,p),s=d.diskRand(60);o.position.set(s.y,p/2,s.x),r.add(o)}s=new THREE.Vector3;var f=new THREE.Euler,m=new THREE.Quaternion,v=new THREE.Vector3,g=new THREE.Color,y=2*Math.PI,E=d.createCoral(),x=new d.InstancedMesh(E.geometry,E.material,100,!1,!0,!1);for(a=0;a<100;a++)s.set(96*(Math.random()-.5),0,96*(Math.random()-.5)),f.set(0,Math.random()*y,0),m.setFromEuler(f),v.setScalar(.4+Math.random()),g.setHSL(Math.random(),1,.5),x.setPositionAt(a,s),x.setQuaternionAt(a,m),x.setScaleAt(a,v),x.setColorAt(a,g);x.castShadow=!0,x.receiveShadow=!0,x.frustumCulled=!1,x.name="instCoral",r.add(x);for(h=0;h<2;h++){E=d.createCoralReef(h),x=new d.InstancedMesh(E.geometry,E.material,100,!1,!0,!1);for(a=0;a<100;a++)s.set(96*(Math.random()-.5),0,96*(Math.random()-.5)),f.set(0,Math.random()*y,0),m.setFromEuler(f),v.setScalar(1.5+Math.random()),g.setHSL(Math.random(),Math.random(),Math.random()),x.setPositionAt(a,s),x.setQuaternionAt(a,m),x.setScaleAt(a,v),x.setColorAt(a,g);x.castShadow=!0,x.receiveShadow=!0,x.frustumCulled=!1,x.name="instCoralReef"+h,r.add(x)}(o=d.createRock(0)).position.set(-10,0,-10),r.add(o),(o=d.createRock(1)).position.set(30,0,30),r.add(o),(o=d.createRock(2)).position.set(-20,0,20),r.add(o);o=d.createAquaFloor(64.5);r.add(o);(o=d.createAquaGlobeBase(64.5,25)).position.y-=12.5,r.add(o),(o=d.createAquaGlobeOuter(66.9)).position.y+=16.5,r.add(o);u=.36;var b,T=100;c=60;(b=d.createSpriteBubbles(u,T,3,c,3,"verticalMotion")).position.set(12,0,-18),r.add(b),(b=d.createSpriteBubbles(u,T,3,c,3,"verticalMotion")).position.set(-18,0,-18),r.add(b),(b=d.createSpriteBubbles(u,T,3,c,3,"verticalMotion")).position.set(-12,0,12),r.add(b),(b=d.createSpriteBubbles(u,T,3,c,3,"verticalMotion")).position.set(6,0,18),r.add(b)},d.demoFishSchools=function(){d.scene.add(d.createHemisphereLight()),d.underWaterBackground();var e=appWorks.camera.far,t=d.createBoids({resolution:64,boidName:"fishShark",bounds:new THREE.Vector3(e/4,e/8,e/4),speedLimit:2});t.position.y=0,d.add(t)},d.demoRaymarch=function(){d.raymarchFish()},d.demoKdTree=function(){var e=d.appWorks;e.controls=d.createCameraControls("FirstPersonControls");var t=Math.pow(500,2);t=Math.sqrt(3*t);var r=(new THREE.TextureLoader).load("images/crate.gif");r.minFilter=THREE.LinearMipMapLinearFilter,r.magFilter=THREE.LinearFilter;var n=new THREE.ShaderMaterial({uniforms:{tex:{type:"t",value:r},size:{type:"f",value:4}},vertexShader:["uniform float size;","attribute float alpha;","varying float vAlpha;","void main() {","vAlpha = alpha;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = size * ( 300.0 / -mvPosition.z );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D tex;","varying float vAlpha;","void main() {","gl_FragColor = texture2D( tex, gl_PointCoord );","gl_FragColor.b = mix( gl_FragColor.b, 1.0, vAlpha );","}"].join("\n"),transparent:!0}),i=new Float32Array(15e5),a=new Float32Array(5e5),o=new THREE.BufferGeometry;o.addAttribute("position",new THREE.BufferAttribute(i,3)),o.addAttribute("alpha",new THREE.BufferAttribute(a,1));for(var s=0;s<5e5;s++)i[3*s+0]=500*(Math.random()-.5),i[3*s+1]=500*(Math.random()-.5),i[3*s+2]=500*(Math.random()-.5),a[s]=0;var l=new THREE.Points(o,n);d.add(l);var c=performance.now();l.kdtree=d.createKdTree(i,3);var u=performance.now()-c;console.log(">> time (creating kdtree) = "+u.toFixed(2)+" (ms)"),l.update=function(r,n){for(var i=0;i<5e5;i++)a[i]=0;var s=e.camera.position,l=d.getKdTreeNearest(this.kdtree,[s.x,s.y,s.z],100),c=new THREE.Frustum,u=new THREE.Matrix4;u.multiplyMatrices(e.camera.projectionMatrix,e.camera.matrixWorldInverse),c.setFromMatrix(u);for(var h=0,p=l.length;h<p;h++){var f=l[h],m=(new THREE.Vector3).fromArray(f.position);if(c.containsPoint(m)){var v=f.index,g=f.distance;a[v]=1-g/t}}o.attributes.alpha.needsUpdate=!0}},d.demoOctree=function(){var e=new THREE.Points(new THREE.TorusKnotBufferGeometry(10,4,64,64),new THREE.PointsMaterial({color:16711680,size:2,sizeAttenuation:!1}));d.add(e);var t=new THREE.Box3;t.setFromObject(e);for(var r=new p.PointOctree(t.min,t.max,0,15,8),n=e.geometry.attributes.position.array,i=new THREE.Vector3,a=0,o=n.length;a<o;a+=3)r.put(i.fromArray(n,a),e);console.log(">> octree point count: ",r.pointCount),console.log(">> octree depth: ",r.getDepth());var s=new THREE.Vector3;d.getLeafOctants(r).forEach(function(e){s.copy(e.getCenter()),console.log(s)});var l=new d.OctreeHelper(r,{topLevel:0,bottomLevel:4,occupied:!0});d.add(l)},d.demoIsosurface=function(){var e=new THREE.MeshPhongMaterial({color:11184810,side:THREE.DoubleSide}),t=(new THREE.ImprovedNoise,function(e,t,r){var n=e*e+t*t+r*r;return Math.pow(e,4)+Math.pow(t,4)+Math.pow(r,4)+n*n*0+-1.5*n+1}),r=new THREE.Box3({x:-2,y:-2,z:-2},{x:2,y:2,z:2}),n=performance.now(),i=new d.IsosurfaceGeometry(50,r,t),a=performance.now()-n;console.log(">> time (creating isosurface) = "+a.toFixed(2)+" (ms)");var o=new THREE.Mesh(i,e);d.add(o);var s=d.createWireframe(o,0,!0);o.add(s);var l=d.createVertexPoints(o,.05);o.add(l)},d.demoEditImage=function(){d.imageFileToData("images/jamieElly1024.png",function(e){d.invertImage(e);var t=new THREE.Texture(e);t.needsUpdate=!0;var r=new THREE.PlaneBufferGeometry(10,10),n=new THREE.MeshPhongMaterial({map:t}),i=new THREE.Mesh(r,n);d.scene.add(i)})},d.demoEditImage2=function(){d.imageFileToData("images/sprites/snowflake5.png",function(e){for(var t=e.data,r=0;r<t.length;r+=4){0===t[r]+t[r+1]+t[r+2]&&(t[r+3]=0)}d.imageDataToFile(e,"snowflake5.png")})},d.demoFrankeTestRBF=function(){function e(e,t,r,n){var i=0;if(1===e)a=Math.pow(9*t-2,2),o=Math.pow(9*r-2,2),s=Math.pow(9*n-2,2),i=.75*Math.exp(-(a+o+s)/4),a=Math.pow(9*t+1,2),o=Math.pow(9*r+1,1),s=Math.pow(9*n+1,1),i+=.75*Math.exp(-(a/49+o/10+s/10)),a=Math.pow(9*t-7,2),o=Math.pow(9*r-3,2),s=Math.pow(9*n-5,2),i+=.5*Math.exp(-(a+o+s)/4),a=Math.pow(9*t-4,2),o=Math.pow(9*r-7,2),s=Math.pow(9*n-5,2),i-=.2*Math.exp(-(a+o+s));else if(2===e)i=(Math.tanh(9*n-9*t-9*r)+1)/9;else if(3===e)i=(1.25+Math.cos(5.4*r))*Math.cos(6*n)/(6+6*Math.pow(3*t-1,2));else if(4===e){a=Math.pow(t-.5,2),o=Math.pow(r-.5,2),s=Math.pow(n-.5,2),i=Math.exp(-81/16*(a+o+s))/3}else if(6===e){var a,o,s;a=Math.pow(t-.5,2),o=Math.pow(r-.5,2),s=Math.pow(n-.5,2),i=Math.sqrt(64-81*(a+o+s))/9-.5}return i}for(var t=[1,2,3,4,6],r=["grid","random"],n=["interpolate","approximate"],i=[7,10,15],a=[343,1e3,3375],o=["linear","cubic","thinPlate","gaussian","multiquadric","wendland31"],s=0;s<r.length;s++)for(var l=0;l<n.length;l++)for(var c=0;c<a.length;c++)for(var u=0;u<o.length;u++){var h,p={funcID:t[4],distributeType:r[s],constructType:n[l],ndataGrid:i[c],ndataRandom:a[c],rbf:o[u],linearTerm:!0,approxPct:.2,rbf0:"linear",rbf1:"linear",rbf2:"linear"};console.log("==========================================="),console.log(">> funcID          = "+p.funcID),console.log(">> distribute type = "+p.distributeType),console.log(">> construct type  = "+p.constructType),console.log(">> data size       = "+p.ndataRandom),console.log(">> RBF             = "+p.rbf),"grid"===p.distributeType&&(h=~~(Math.pow(p.ndataGrid,3)*p.approxPct)),"random"===p.distributeType&&(h=~~(p.ndataRandom*p.approxPct));var f=[],m=[];if("grid"===p.distributeType)for(var v=1/((S=p.ndataGrid)-1),g=0,y=0;g<S;g++,y+=v)for(var E=0,x=0;E<S;E++,x+=v)for(var b=0,T=0;b<S;b++,T+=v)f.push([T,x,y]),m.push(e(p.funcID,T,x,y));if("random"===p.distributeType){for(b=0;b<p.ndataRandom;b++){T=Math.random(),x=Math.random(),y=Math.random();f[b]=[T,x,y]}b=0;for(var w=(f=d.mergeArray3(f)).length;b<w;b++){T=f[b][0],x=f[b][1],y=f[b][2];m[b]=e(p.funcID,T,x,y)}}var _,R=performance.now();switch(p.constructType){case"interpolate":_=d.interpolateRBF(f,m,{rbf:p.rbf});break;case"approximate":_=d.approximateRBF(h,f,m,{rbf:p.rbf});break;case"multilevel":_=d.multiLevelRBF(f,m,{rbf0:p.rbf0,rbf1:p.rbf1,rbf2:p.rbf2})}var M=performance.now()-R;console.log(">> time (creating RBF)   = "+M.toFixed(2)+" (ms)");var S,A=0,P=0,L=0,C=1/0,H=-1/0;for(v=1/((S=21)-1),g=0,y=0;g<S;g++,y+=v)for(E=0,x=0;E<S;E++,x+=v)for(b=0,T=0;b<S;b++,T+=v){R=performance.now();var I=_([T,x,y]);L+=M=performance.now()-R;var k=e(p.funcID,T,x,y);A+=Math.pow(k-I[0],2),C=Math.min(C,k),H=Math.max(H,k),P++}A=Math.sqrt(A/P),A/=H-C,console.log(">> time (evaluating RBF) = "+(L/P).toFixed(4)+" (ms)"),console.log(">> RMS error (21 x 21 x 21) = "+A.toFixed(7))}},d.demoImageRBF=function(){(new THREE.TextureLoader).load("images/dummy/lena_24.bmp",function(e){var t=d.imageElementToData(e.image),r=e.image.width,n=e.image.height,i=r*n;console.log(">> image = "+i);var a,o=!0,s="linear",l="random",c="interpolate",u=32,h=2e3,p=.2,f="linear",m="linear",v="linear";console.log(">> RBF = "+s+", linearTerm = "+o),console.log(">> data distribution = "+l),console.log(">> construction type = "+c),"multilevel"===c&&console.log(">> multilevel[0,1,2] = "+f+", "+m+", "+v),"grid"===l&&(a=~~(Math.pow(u,2)*p)),"random"===l&&(a=~~(h*p));var g=[],y=[];if("grid"===l)for(var E=u,x=1/(E-1),b=0,T=0;b<E;b++,T+=x)for(var w=0,_=0;w<E;w++,_+=x){g.push([_,T]);var R=d.getPixelColor(t,_,T);y.push([R.r,R.g,R.b])}if("random"===l){for(w=0;w<h;w++){_=d.randInt(0,r-1),T=d.randInt(0,n-1);g[w]=[_,T]}w=0;for(var M=(g=d.mergeArray2(g)).length;w<M;w++){_=g[w][0],T=g[w][1],R=d.getPixelColor(t,_,T);y[w]=[R.r,R.g,R.b]}}"interpolate"===c&&(console.log(">> xdata   = "+g.length),console.log(">> xdata/image = "+(g.length/i*100).toFixed(2)+" (%)")),"approximate"===c&&(console.log(">> centers = "+a),console.log(">> xdata   = "+g.length),console.log(">> centers/xdata = "+(a/g.length*100).toFixed(2)+" (%)"),console.log(">> centers/image = "+(a/i*100).toFixed(2)+" (%)"));var S,A=performance.now();switch(c){case"interpolate":S=d.interpolateRBF(g,y,{rbf:s,linearTerm:o});break;case"approximate":S=d.approximateRBF(a,g,y,{rbf:s,linearTerm:o});break;case"multilevel":S=d.multiLevelRBF(g,y,{rbf0:f,rbf1:m,rbf2:v,linearTerm:o})}var P=performance.now()-A;console.log(">> time (creating RBF) = "+P.toFixed(2)+" (ms)");var L=[0,0,0],C=0;for(w=0;w<g.length;w++){_=g[w][0],T=g[w][1];A=performance.now();R=S([_,T]);C+=P=performance.now()-A,L[0]+=Math.pow(y[w][0]-R[0],2),L[1]+=Math.pow(y[w][1]-R[1],2),L[2]+=Math.pow(y[w][2]-R[2],2)}for(w=0;w<3;w++)L[w]=Math.sqrt(L[w]/g.length),L[w]=L[w]/255*100;var H=(L[0]+L[1]+L[2])/3;console.log(">> RMS error (sample xdata) = "+H.toFixed(2)+" (%)");for(L=[0,0,0],C=0,T=0;T<n;T++)for(_=0;_<r;_++){A=performance.now();R=S([_,T]);C+=P=performance.now()-A;var I=d.getPixelColor(t,_,T);L[0]+=Math.pow(I.r-R[0],2),L[1]+=Math.pow(I.g-R[1],2),L[2]+=Math.pow(I.b-R[2],2),R[0]=~~R[0],R[1]=~~R[1],R[2]=~~R[2],R[3]=255,d.setPixelColor(R,t,_,T)}for(w=0;w<3;w++)L[w]=Math.sqrt(L[w]/(r*n)),L[w]=L[w]/255*100;H=(L[0]+L[1]+L[2])/3;console.log(">> RMS error (whole image) = "+H.toFixed(2)+" (%)"),console.log(">> time (creating image) = "+C.toFixed(2)+" (ms)"),(e=new THREE.Texture(t)).needsUpdate=!0;var k=new THREE.Mesh(new THREE.PlaneBufferGeometry(10,10),new THREE.MeshBasicMaterial({map:e}));d.add(k)})},d.demoSurfaceRBF=function(){d.loadSTL({url:"models/dummy/bunny.stl",callback:function(e){d.add(e),e.material=new THREE.MeshNormalMaterial({flatShading:!0,side:THREE.DoubleSide});var t={rbf:"linear",maxPoints:256,resolution:32},r=d.toNonIndexedBufferGeometry(e.geometry),n=r.attributes.position.array,i=r.attributes.normal.array,a=performance.now(),o=new d.SurfaceRBF(n,i,t),s=performance.now()-a;console.log(">> time (creating surfaceRBF) = "+s.toFixed(2)+" (ms)");var l=new THREE.Box3;l.setFromObject(e);a=performance.now();var c=new d.IsosurfaceGeometry(t.resolution,l,function(e,t,r){return o([e,t,r])[0]});s=performance.now()-a;console.log(">> time (creating isosurface) = "+s.toFixed(2)+" (ms)");var u=new THREE.Mesh(c,e.material);if(d.add(u),"models/dummy/bunny.stl"===e.name||"models/dummy/shoelast.stl"===e.name||"models/dummy/foot.stl"===e.name){var h=new THREE.Vector3(-Math.PI/2,0,0),p=new THREE.Vector3(20,0,0);d.resizeObject(e,20),d.transformObject(e,p,h),d.resizeObject(u,20),d.transformObject(u,null,h)}}})},d.demoTexturedSurfaceRBF=function(){function e(e){if(d.add(e),e instanceof THREE.Scene){var t=new THREE.TextureLoader;(f=e.children[0]).material=new THREE.MeshPhongMaterial({specular:1118481,map:t.load("models/LeePerrySmith/Map-COL.jpg"),specularMap:t.load("models/LeePerrySmith/Map-SPEC.jpg"),normalMap:t.load("models/LeePerrySmith/Infinite-Level_02_Tangent_SmoothUV.jpg"),shininess:25}),e=f}else if(e instanceof THREE.Group){e=f=e.children[0]}var r={rbf:"wendland31",maxPoints:16,resolution:64},n=d.toNonIndexedBufferGeometry(e.geometry),i=n.attributes.position.array,a=n.attributes.normal.array,o=n.attributes.uv.array,s=performance.now(),l=new d.TexturedSurfaceRBF(i,a,o,r),c=performance.now()-s;console.log(">> time (creating texturedSurfaceRBF) = "+c.toFixed(2)+" (ms)");var u=new THREE.Box3;u.setFromObject(e);s=performance.now();var h=new d.IsosurfaceGeometry(r.resolution,u,function(e,t,r){return l([e,t,r])[0]});c=performance.now()-s;function p(e){var t=l([e.x,e.y,e.z]);return[t[1],t[2]]}console.log(">> time (creating isosurface) = "+c.toFixed(2)+" (ms)"),h.faceVertexUvs[0]=[],h.faces.forEach(function(e){var t=p(h.vertices[e.a]),r=p(h.vertices[e.b]),n=p(h.vertices[e.c]);h.faceVertexUvs[0].push([new THREE.Vector2(t[0],t[1]),new THREE.Vector2(r[0],r[1]),new THREE.Vector2(n[0],n[1])])}),h.uvsNeedUpdate=!0;var f=new THREE.Mesh(h,e.material);d.add(f)}d.loadOBJ({obj:"troll.obj",mtl:"troll.mtl",basePath:"models/obj/troll/",callback:e(object)}),d.loadGLTF({url:"models/LeePerrySmith/LeePerrySmith.glb",callback:e(object)}),d.loadOBJ({obj:"cyborg.obj",mtl:"cyborg.mtl",basePath:"models/obj/cyborg/",callback:e(object)})},d.demoQuadricSurfaces=function(){d.loadSTL({url:"models/dummy/woman.stl",callback:function(e){d.add(e),e.material=new THREE.MeshNormalMaterial({flatShading:!0,side:THREE.DoubleSide});var t={maxPoints:16,resolution:64},r=d.toNonIndexedBufferGeometry(e.geometry),n=r.attributes.position.array,i=r.attributes.normal.array,a=performance.now(),o=new d.QuadricSurfaces(n,i,t),s=performance.now()-a;console.log(">> time (creating quadricSurfaces) = "+s.toFixed(2)+" (ms)");var l=new THREE.Box3;l.setFromObject(e);a=performance.now();var c=new d.IsosurfaceGeometry(t.resolution,l,function(e,t,r){return o([e,t,r])[0]});s=performance.now()-a;console.log(">> time (creating isosurface) = "+s.toFixed(2)+" (ms)");var u=new THREE.Mesh(c,e.material);d.add(u)}})},d.demoUnconstrainedDelaunay=function(){for(var e=100,t=100,r=100,n=[],i=new THREE.ImprovedNoise,a=0;a<1e3;a++){var o=d.randFloat(-e,e),s=d.randFloat(-t,t),l=d.randFloat(-r,r);s=10*i.noise(o,s,l),n.push(new THREE.Vector3(o,s,l))}var c=new d.DelaunayBufferGeometry(n,"xz"),u=(new THREE.Geometry).fromBufferGeometry(c);for(a=0;a<u.faces.length;a++)u.faces[a].color.setHex(16777215*Math.random());var h=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,side:THREE.DoubleSide}),p=new THREE.Mesh(u,h);d.add(p)},d.demoConstrainedDelaunay=function(){var e=[280.35714,648.79075,286.78571,662.8979,263.28607,661.17871,262.31092,671.41548,250.53571,677.00504,250.53571,683.43361,256.42857,685.21933,297.14286,669.50504,289.28571,649.50504,285,631.6479,285,608.79075,292.85714,585.21932,306.42857,563.79075,323.57143,548.79075,339.28571,545.21932,357.85714,547.36218,375,550.21932,391.42857,568.07647,404.28571,588.79075,413.57143,612.36218,417.14286,628.07647,438.57143,619.1479,438.03572,618.96932,437.5,609.50504,426.96429,609.86218,424.64286,615.57647,419.82143,615.04075,420.35714,605.04075,428.39286,598.43361,437.85714,599.68361,443.57143,613.79075,450.71429,610.21933,431.42857,575.21932,405.71429,550.21932,372.85714,534.50504,349.28571,531.6479,346.42857,521.6479,346.42857,511.6479,350.71429,496.6479,367.85714,476.6479,377.14286,460.93361,385.71429,445.21932,388.57143,404.50504,360,352.36218,337.14286,325.93361,330.71429,334.50504,347.14286,354.50504,337.85714,370.21932,333.57143,359.50504,319.28571,353.07647,312.85714,366.6479,350.71429,387.36218,368.57143,408.07647,375.71429,431.6479,372.14286,454.50504,366.42857,462.36218,352.85714,462.36218,336.42857,456.6479,332.85714,438.79075,338.57143,423.79075,338.57143,411.6479,327.85714,405.93361,320.71429,407.36218,315.71429,423.07647,314.28571,440.21932,325,447.71932,324.82143,460.93361,317.85714,470.57647,304.28571,483.79075,287.14286,491.29075,263.03571,498.61218,251.60714,503.07647,251.25,533.61218,260.71429,533.61218,272.85714,528.43361,286.07143,518.61218,297.32143,508.25504,297.85714,507.36218,298.39286,506.46932,307.14286,496.6479,312.67857,491.6479,317.32143,503.07647,322.5,514.1479,325.53571,521.11218,327.14286,525.75504,326.96429,535.04075,311.78571,540.04075,291.07143,552.71932,274.82143,568.43361,259.10714,592.8979,254.28571,604.50504,251.07143,621.11218,250.53571,649.1479,268.1955,654.36208],t=[];t[0]=[325,437,320,423,329,413,332,423],t[1]=[320.72342,480,338.90617,465.96863,347.99754,480.61584,329.8148,510.41534,339.91632,480.11077,334.86556,478.09046];for(var r=[],n=0;n<e.length;n+=2){var i=new THREE.Vector3(e[n],e[n+1],0);r.push(i)}for(var a=[],o=0;o<t.length;o++){a[o]=[];for(n=0;n<t[o].length;n+=2){i=new THREE.Vector3(t[o][n],t[o][n+1],0);a[o].push(i)}}var s=new d.ConstrainedDelaunayBufferGeometry(r,a),l=(new THREE.Geometry).fromBufferGeometry(s);for(n=0;n<l.faces.length;n++)l.faces[n].color.setHex(16777215*Math.random());l.center();var c=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,side:THREE.DoubleSide}),u=new THREE.Mesh(l,c);d.add(u)},d.demoCSGBoolean=function(){var e=(new Date).getTime(),t=new THREE.MeshPhongMaterial({map:(new THREE.TextureLoader).load("images/rock/roughRockD.png")}),r=new THREE.Mesh(new THREE.BoxBufferGeometry(3,3,3)),n=new THREE.Mesh(new THREE.SphereBufferGeometry(1.8,64,32)),i=d.union(r,n);i.material=t;var a=d.intersect(r,n);a.material=t;var o=d.subtract(r,n);o.material=t,i.position.x=-5,o.position.x=5,d.add(i),d.add(a),d.add(o);var s=(new Date).getTime();console.log("CSG time: "+(s-e)+" ms")},d.demoSimplifyMesh=function(){(new THREE.GLTFLoader).load("models/LeePerrySmith/LeePerrySmith.glb",function(e){var t=e.scene.children[0];t.position.x=-3,t.rotation.y=Math.PI/2,d.add(t);var r=t.clone();r.geometry=d.simplifyGeometry(r.geometry,.875),r.position.x=3,r.rotation.y=-Math.PI/2,d.add(r);var n=d.createWireframe(t);t.add(n);n=d.createWireframe(r);r.add(n)})},d.demoSubdivideMesh=function(){(new THREE.GLTFLoader).load("models/LeePerrySmith/LeePerrySmith.glb",function(e){var t=e.scene.children[0];t.position.x=-3,t.rotation.y=Math.PI/2,d.add(t);var r=t.clone();r.geometry=d.subdivideGeometry(r.geometry,1),r.position.x=3,r.rotation.y=-Math.PI/2,d.add(r);var n=d.createWireframe(t);t.add(n);n=d.createWireframe(r);r.add(n)})},d.demoCanvasDrawing=function(){var e;(e=d.createTextSprite("",{textHeight:1,textColor:16711680,textWidthScale:1})).position.set(0,7,0),d.add(e),(e=d.createTextSprite("abcdefghijklmnopqrstuvwxyz!@#$%^&*()")).position.set(0,8,0),d.add(e);var t=document.createElement("canvas"),r=t.getContext("2d");t.height=256,t.width=256;var n=[[0,0],[100,50],[200,0],[250,200],[50,150]];r.fillPolygon(n,30,"yellow");for(var i=0;i<n.length;i++)n[i][0]+=10;r.strokePolygon(n,30,"red"),r.fillRoundRect(128,128,64,64,10,"#D2691E"),r.strokeRoundRect(144,144,64,64,10,"#00008B"),r.fillRect(5,5,20,20),r.strokeRect(128,5,20,20),r.fillCircle(64,192,30,"red"),r.strokeCircle(128,192,30,"#4B0082"),d.add(d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshBasicMaterial",map:new THREE.CanvasTexture(t)}}))},d.demoAnimations=function(){d.loadGLB({url:"models/gltf/RobotExpressive/RobotExpressive.glb",callback:function(e){d.add(d.createSpotLight({target:e})),d.add(e)}})},d.demoParticles=function(){var e=d.Particles.examples.fountain;e.positionBase=new THREE.Vector3(0,1,0),e.positionSpread=new THREE.Vector3(1,0,1),e.velocityBase=new THREE.Vector3(0,16,0),e.velocitySpread=new THREE.Vector3(10,2,10),e.accelerationBase=new THREE.Vector3(0,-10,0),e.sizeTween.values[0]=.01,e.sizeTween.values[1]=1,e.emitterDeathAge=5;var t=d.createParticles(e);d.add(t)},d.demoImageSpritesHUD=function(){(new THREE.TextureLoader).load("images/sprites/metalBall.png",function(e){var t,r=new THREE.SpriteMaterial({map:e,transparent:!0,depthTest:!1}),n=r.map.image.width,i=r.map.image.height,a=d.appWorks.width/2,o=d.appWorks.height/2,s=d.appWorks.sceneHUD;(t=new THREE.Sprite(r)).center.set(0,0),t.scale.set(n,i,1),t.position.set(-a,-o,1),t.name="sprite1",s.add(t),(t=new THREE.Sprite(r)).center.set(0,0),t.scale.set(n,i,1),t.position.set(-a+n,-o,1),t.name="sprite2",s.add(t),(t=new THREE.Sprite(r)).center.set(0,0),t.scale.set(n,i,1),t.position.set(2*n-a,-o,1),t.name="sprite3",s.add(t)})},d.demoCanvasPlaneHUD=function(){var e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial"}});d.scene.add(e),e.update=function(e,t){this.rotation.x+=.01,this.rotation.y-=.02,this.rotation.z+=.03};var t=d.appWorks.width,r=d.appWorks.height,n=document.createElement("canvas"),i=n.getContext("2d");n.width=t,n.height=r,i.font="Normal 40px Arial",i.textAlign="center",i.fillStyle="rgba(255,255,255,1.0)",i.fillText("Initializing...",t/2,r/2);var a=new THREE.CanvasTexture(i.canvas),o=new THREE.MeshBasicMaterial({map:a,transparent:!0,depthTest:!1}),s=new THREE.PlaneBufferGeometry(t,r),l=new THREE.Mesh(s,o);l.name="planeHUD",d.appWorks.sceneHUD.add(l);var c=d.computeMassProperties(e),u="surface area: "+c.area.toFixed(2),h="volume size: "+c.volume.toFixed(2),p=2*Math.PI;l.update=function(t,n){var o="rot [x:"+(e.rotation.x%p).toFixed(1)+", y:"+(e.rotation.y%p).toFixed(1)+", z:"+(e.rotation.z%p).toFixed(1)+"]";i.clear(),i.font="Normal 20px Arial",i.textAlign="left",i.fillStyle="rgba(255,255,255,1.0)",i.fillText(o,10,r-20),i.fillText(h,10,r-40),i.fillText(u,10,r-60),a.needsUpdate=!0}},d.demoNatureTextures=function(){var e,t=new THREE.TextureLoader;(e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",map:t.load("images/rock/crackRockDiffuse.jpg"),normalMap:t.load("images/rock/crackRockNormal.jpg"),aoMap:t.load("images/rock/crackRockAO.jpg")}})).name="demoCrackRocks",d.add(e),(e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",roughness:.2,metalness:.8,map:t.load("images/metal/metalPanelsDiffuse8.jpg"),normalMap:t.load("images/metal/metalPanelsNormal.jpg"),aoMap:t.load("images/metal/metalPanelsAO.jpg")}})).name="demoMetalPanels",d.add(e),(e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",roughness:1,metalness:0,map:t.load("images/terrain/wasteLandDiffuse6.jpg"),normalMap:t.load("images/terrain/wasteLandNormal.jpg"),aoMap:t.load("images/terrain/wasteLandAO.jpg")}})).name="demoWasteLand",d.add(e),(e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshStandardMaterial",roughness:1,metalness:0,map:t.load("images/terrain/dirtGrassTerrainD6.jpg"),normalMap:t.load("images/terrain/dirtGrassTerrainN.jpg"),aoMap:t.load("images/terrain/dirtGrassTerrainAO.jpg")}})).name="demoDirtGrassTerrain",d.add(e),(e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial",map:t.load("images/fish/caviarDiffuse4.jpg"),normalMap:t.load("images/fish/caviarNormal.jpg"),aoMap:t.load("images/fish/caviarAO.jpg")}})).name="demoCaviar",d.add(e)},d.demoImageProcessing=function(){d.imageFileProcessing("images/jamieElly1024.png","EdgeDetection2Shader",{edgeFunc:"trueColorEdge",showImage:!0,saveImage:!0})},d.demoSketcher=function(){var e=d.appWorks.width,t=d.appWorks.height,r=new d.Sketcher({width:e,height:t});d.appWorks.dom.appendChild(r.dom)},d.demoMatcaps=function(){var e=d.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,1.6,128,32]},material:{type:"MeshPhongMaterial"}});d.add(e),d.scene.add(d.createHemisphereLight());var t=d.getObjectSize(e),r=function(e){var t=(e=e||100)/2,r=new THREE.Object3D;r.name="pbrWalls";var n=new THREE.PlaneBufferGeometry(.9*e,.9*e),i=new THREE.Reflector(n,{clipBias:.003,textureWidth:~~(d.appWorks.width*window.devicePixelRatio),textureHeight:~~(d.appWorks.height*window.devicePixelRatio),color:8952217,recursion:1});i.position.y=t,i.position.z=.99*-t,r.add(i);var n=new THREE.PlaneBufferGeometry(1.001*e,1.001*e);function a(e,t){var t=t||4;e.repeat.set(t,t),e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping}var o=new THREE.TextureLoader,s=new THREE.MeshStandardMaterial({color:11184810,roughness:1,metalness:0,map:o.load("images/pbr/wallA.png",a),normalMap:o.load("images/pbr/wallN.png",a),aoMap:o.load("images/pbr/wallAO.png",a),roughnessMap:o.load("images/pbr/wallR.png",a)}),l=new THREE.Mesh(n,s);l.position.y=e,l.rotateX(Math.PI/2),r.add(l);var c=new THREE.Mesh(n,s);c.rotateX(-Math.PI/2),r.add(c);var u=new THREE.Mesh(n,s);u.position.z=t,u.position.y=t,u.rotateY(Math.PI),r.add(u);var h=new THREE.Mesh(n,s);h.position.z=-t,h.position.y=t,r.add(h);var p=new THREE.Mesh(n,s);p.position.x=t,p.position.y=t,p.rotateY(-Math.PI/2),r.add(p);var f=new THREE.Mesh(n,s);return f.position.x=-t,f.position.y=t,f.rotateY(Math.PI/2),r.add(f),r}(4*t);r.position.y=-4*t/2,d.add(r),d.appWorks.select(e),d.appWorks.guiMatcaps.setDisplay(""),d.appWorks.guiNormalMaps.setDisplay("")},d.demoLighting=function(){var e=d.createPrimitive({geometry:{type:"TorusKnotBufferGeometry",parameters:[5,10/6,128,32]},material:{type:"MeshPhongMaterial"}});d.scene.add(e),d.fitCameraToObject(e);var t=d.createSunsetLights();d.scene.add(t)},d.demoArenaRows=function(){var e;(e=d.createArenaRow({radius:.5,numSections:30,conesPerSection:5,heightMin:.1,heightMax:.15,radiusMin:.05,radiusMax:.05})).scale.setScalar(20),d.scene.add(e),(e=d.createArenaRow({radius:.45,numSections:20,conesPerSection:2,heightMin:.05,heightMax:.075,radiusMin:.025,radiusMax:.05})).scale.setScalar(20),d.scene.add(e)},d.demoInstancedMeshes=function(){var e,t=(new THREE.TextureLoader).load("images/matcaps3/00023.jpg"),r=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[4,4,4]},material:{type:"MeshMatcapMaterial",matcap:t}}),n=d.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[2.5,32,16]},material:{type:"MeshMatcapMaterial",matcap:t}}),i=d.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[1.5,1.5,5,32]},material:{type:"MeshMatcapMaterial",matcap:t}}),a={pattern:"circular",axis:"y",radiusStart:50,radiusLength:450,numRadius:100,angleStart:0,angleLength:2*Math.PI,numAngle:100,colorMode:"0"},o={pmin:[0,-500,-500],pmax:[0,500,500],rmin:[0,0,0],rmax:[2*Math.PI,2*Math.PI,2*Math.PI],numInstances:1e4,colorMode:"2"},s=d.createInstancedMeshes(r,{pattern:"rectangular",axis:"z",width:1e3,height:1e3,numWidth:100,numHeight:100,colorMode:"1"}),l=d.createInstancedMeshes(n,a),c=d.createInstancedMeshes(i,o);s.update=function(e,t){this.rotation.y=.1*t},l.update=(e=10,function(t,r){(this.position.y>200||this.position.y<-200)&&(e*=-1),this.position.y+=t*e,this.rotation.y=.1*r}),c.update=function(e,t){this.rotation.y=.1*t},d.add(s),d.add(l),d.add(c)},d.demoInstancedObject=function(){var e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[4,4,4]},material:{type:"MeshPhongMaterial"}}),t=d.createPrimitive({geometry:{type:"SphereBufferGeometry",parameters:[2.5,32,16]},material:{type:"MeshPhongMaterial"}}),r=d.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[1.5,1.5,5,32]},material:{type:"MeshPhongMaterial"}}),n=new THREE.Object3D;n.add(e,t,r),n.position.y=10;var i=d.createInstancedObject(n,{pmin:[-500,0,-500],pmax:[500,0,500],rmin:[0,0,0],rmax:[2*Math.PI,2*Math.PI,2*Math.PI],numInstances:1e4,colorMode:"1"});d.add(i)},d.demoImgBase64ToFile=function(e){d.loadImageBase64(e,function(e){var t=d.imageElementToData(e);d.imageDataToFile(t,"image.png")})},d.demoWebBrowserInfo=function(){console.log("# Navigator Info"),console.log(window.navigator),console.log("# Device Info");var e=[];e.push("isMobile: "+d.isDeviceMobile()),e.push("isLandscape: "+d.isDeviceLandscape()),e.push("isTouch: "+d.isDeviceTouch()),e.push("isWindowsOS: "+d.isDeviceWindowsOS()),e.push("isMacOS: "+d.isDeviceMacOS()),e.push("width class: "+(window.innerWidth<600?"extra small":window.innerWidth<768?"small":window.innerWidth<992?"medium":window.innerWidth<1200?"large":"extra large")),console.log(e.join("\n")),console.log("# WebGL Info"),console.log(d.getWebGLInfo().join("\n"))},d.demoLoadObject3D=function(){for(var e=[],t=0;t<1024;t++){var r=d.randFloat(-10,10),n=d.randFloat(-10,10),i=d.randFloat(-10,10);e.push(r,n,i)}var a=[];for(t=0;t<1024;t++){var o=d.randFloat(0,1),s=d.randFloat(0,1),l=d.randFloat(0,1);a.push(o,s,l)}d.loadObject3D({object:{type:"Points",name:"points"},geometry:{type:"BufferGeometry",attributes:{position:e,color:a}},material:{type:"PointsMaterial",map:"images/sprites/metalBall.png",color:16777215,size:1,transparent:!0,depthTest:!1,vertexColors:THREE.VertexColors}}).then(e=>{d.add(e)})},d.demoTweenBox=function(){d.add(d.createHemisphereLight());var e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[10,10,10]},material:{type:"MeshPhongMaterial",map:(new THREE.TextureLoader).load("images/crate.gif")}});d.add(e);for(var t=d.getCurrentTime(),r=e,n=0;n<3;n++){let e=0===n?r:r.clone();0!==n&&d.add(e),e.tweens=d.tweenObjects([e.position,e.rotation,e.scale,e.material.color],[{y:20},{y:Math.PI/2},{x:2,y:2,z:2},{r:n/2,g:n/2,b:0}],{duration:3e3,easing:E.Easing.Elastic.InOut,repeat:1/0,yoyo:!0,start:1e3*t,delay:200*n}),e.update=function(t,r){e.tweens.update(1e3*r)}}},d.demoTweenBuildings=function(){d.loadOBJ({obj:"buildings.obj",basePath:"models/obj/",callback:function(e){d.appWorks.scene.background=d.createBackground("redSky"),d.appWorks.scene.fog=d.createFog({type:"exp2",color:d.FOG_COLOR,density:.0093});const t=d.createAmbientLight({color:10488330,intensity:.05});d.scene.add(t);const r=d.createSpotLight({color:16711680,intensity:.2});r.position.set(100,150,100),d.scene.add(r);const n=d.createPointLight({color:16777215,intensity:.4});n.position.set(16,100,-68),d.scene.add(n);var i=new THREE.Object3D,a=[],o=e.children.map(e=>(e.scale.setScalar(.01),e.position.set(0,0,0),e.frustumCulled=!1,e.receiveShadow=!1,e.castShadow=!1,e));for(var s=new THREE.MeshPhysicalMaterial({color:16777215,metalness:.58,roughness:.18}),l=0;l<40;l++)for(var c=0;c<40;c++){const e=o[d.randInt(0,o.length-1)].clone();e.material=s,e.scale.y=Math.random()*(.008+.01),e.position.x=3*l,e.position.z=3*c,i.add(e),a.push(e)}d.add(i),i.position.set(-60,0,-60);var u=d.getCurrentTime();a.sort((e,t)=>e.position.lengthSq()-t.position.lengthSq());var h=a.length;a.forEach((e,t)=>{e.position.y=.5,e.tween=d.tweenObject(e.position,{y:-.5},{duration:2500,easing:E.Easing.Sinusoidal.InOut,repeat:1/0,yoyo:!0,start:1e3*u,delay:t/(h-1)*2500*2}),e.update=function(t,r){e.tween.update(1e3*r)}})}})},d.demoTweenInstancedMesh=function(){var e=d.createPrimitive({geometry:{type:"CylinderBufferGeometry",parameters:[4.5,4.5,10,32]},material:{type:"MeshMatcapMaterial",matcap:(new THREE.TextureLoader).load("images/matcapMetal.jpg")}}),t=d.createInstancedMeshes(e,{pattern:"rectangular",axis:"y",width:1e3,height:1e3,numWidth:100,numHeight:100});d.add(t);for(var r,n,i=d.getCurrentTime(),a=t.numInstances,o=new THREE.Vector3,s=2*Math.PI,l=[],c=[],u=0;u<a;u++)t.getPositionAt(u,o),l.push({x:o.x,y:o.y,z:o.z,w:u}),r=~~(u/100),n=u%100,c.push({y:o.y+20*Math.sin(r/99*s)*Math.cos(n/99*s)});t.tweens=d.tweenObjects(l,c,{duration:1e3,repeat:1/0,yoyo:!0,start:1e3*i,objectDelay:.5,update:function(e){o.set(e.x,e.y,e.z),t.setPositionAt(e.w,o)}}),t.update=function(e,r){t.tweens.update(1e3*r),t.needsUpdate("position")}},d.demoTerrainLOD=function(){d.add(d.createHemisphereLight());var e=d.createWater();e.position.y=5.3,d.add(e);var t=d.camera;t.position.set(-143,59.6,-132.3),t.rotation.set(-155.8*THREE.DEG2RAD,-44.6*THREE.DEG2RAD,-162.5*THREE.DEG2RAD),t.updateProjectionMatrix();var r=d.createTerrainLOD("GIANT",1024,4,64,100);d.add(r)},d.demoHeightMapTerrain=function(){d.add(d.createDirectionalLight());var e=d.createWater();e.position.y=3.5,d.add(e);var t=d.camera;t.position.set(-467.7,48.5,511.6),t.rotation.set(-5.42*THREE.DEG2RAD,-42.31*THREE.DEG2RAD,-3.65*THREE.DEG2RAD),t.updateProjectionMatrix();var r=d.createHeightMapTerrain("images/terrain/heightmapCA.png",{worldWidth:1024,resolution:1024});d.add(r)},d.demoLoadHeightMaps=function(){(new d.HGTLoader).loadTile(28.661402,-17.872627,12)},d.demoLoadNRRD=function(){function e(){d.renderer.render(d.scene,d.camera)}var t=512,r=window.innerWidth/window.innerHeight,n=new THREE.OrthographicCamera(-t*r/2,t*r/2,256,-256,1,1e3);n.position.set(0,0,128),n.up.set(0,0,1),d.appWorks.camera=n,d.camera=n;var i=new THREE.OrbitControls(n,d.renderer.domElement);i.addEventListener("change",e),i.target.set(64,64,128),i.minZoom=.5,i.maxZoom=4,i.update(),d.appWorks.controls=i,(new THREE.NRRDLoader).load("models/nrrd/stent.nrrd",function(t){var r=new THREE.DataTexture3D(t.data,t.xLength,t.yLength,t.zLength);r.format=THREE.RedFormat,r.type=THREE.FloatType,r.minFilter=r.magFilter=THREE.LinearFilter,r.unpackAlignment=1,r.needsUpdate=!0;var n=new THREE.TextureLoader,i={viridis:n.load("images/medical/cm_viridis.png",e),gray:n.load("images/medical/cm_gray.png",e)},a=0,o=1,s="iso",l=.15,c="viridis",u=THREE.VolumeRenderShader1,h=THREE.UniformsUtils.clone(u.uniforms);h.u_data.value=r,h.u_size.value.set(t.xLength,t.yLength,t.zLength),h.u_clim.value.set(a,o),h.u_renderstyle.value="mip"==s?0:1,h.u_renderthreshold.value=l,h.u_cmdata.value=i[c];var p=new THREE.ShaderMaterial({uniforms:h,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,side:THREE.BackSide}),f=new THREE.BoxBufferGeometry(t.xLength,t.yLength,t.zLength);f.translate(t.xLength/2-.5,t.yLength/2-.5,t.zLength/2-.5);var m=new THREE.Mesh(f,p);d.add(m)})},d.demoSelectFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="select_files" name="files[]" multiple />\n        <output id="select_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e),document.getElementById("select_files").addEventListener("change",function(e){for(var t,r=e.target.files,n=[],i=0;t=r[i];i++)t.name.match(/\.(jpg|png)$/)&&n.push("<li><strong>",d.escapeHTML(t.name),"</strong> (",t.type||"n/a",") - ",d.humanFileSize(t.size),", last modified: ",t.lastModifiedDate?t.lastModifiedDate.toLocaleDateString():"n/a","</li>");document.getElementById("select_result").innerHTML="<ul>"+n.join("")+"</ul>"},!1)},d.demoDropFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <div id="drop_zone" style="\n            margin: 10px 5px 0 0;\n            border: 2px dashed #bbb;\n            -moz-border-radius: 5px;\n            -webkit-border-radius: 5px;\n            border-radius: 5px;\n            padding: 25px;\n            text-align: center;\n            font: 20pt bold \'Vollkorn\';\n            color: #bbb;\n        ">Drop files here</div>\n        <output id="drop_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.getElementById("drop_zone");t.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),t.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault();for(var t,r=e.dataTransfer.files,n=[],i=0;t=r[i];i++)n.push("<li><strong>",d.escapeHTML(t.name),"</strong> (",t.type||"n/a",") - ",d.humanFileSize(t.size),", last modified: ",t.lastModifiedDate?t.lastModifiedDate.toLocaleDateString():"n/a","</li>");document.getElementById("drop_result").innerHTML="<ul>"+n.join("")+"</ul>"},!1)},d.demoReadFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="read_files" name="files[]" multiple /><br>\n        <output id="read_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e),document.getElementById("read_files").addEventListener("change",function(e){for(var t,r=e.target.files,n=0;t=r[n];n++)if(t.type.match("image.*")){var i=new FileReader;i.onload=function(e){return function(t){var r=document.createElement("span");r.innerHTML=['<img class="thumb" style="height: 75px; border: 1px solid #000; margin: 10px 5px 0 0;" src="',t.target.result,'" title="',d.escapeHTML(e.name),'"/>'].join(""),document.getElementById("read_result").insertBefore(r,null)}}(t),i.readAsDataURL(t)}},!1)},d.demoProgressFiles=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="progress_files" name="file" />\n        <button onclick="JAMIE.abortRead();">Cancel reading</button>\n        <div id="progress_bar"><div class="percent">0%</div></div>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.getElementById("progress_bar");t.style.cssText="        margin: 10px 0;\n        padding: 3px;\n        border: 1px solid #000;\n        font-size: 14px;\n        clear: both;\n        opacity: 0;\n        -moz-transition: opacity 1s linear;\n        -o-transition: opacity 1s linear;\n        -webkit-transition: opacity 1s linear;\n    ";var r,n=document.querySelector(".percent");n.style.cssText="        background-color: #99ccff;\n        height: auto;\n        width: 0;\n    ",d.abortRead=function(){r.abort()},document.getElementById("progress_files").addEventListener("change",function(e){n.style.width="0%",n.textContent="0%",(r=new FileReader).onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:alert("File not found!");break;case e.target.error.NOT_READABLE_ERR:alert("File is not readable");break;case e.target.error.ABORT_ERR:break;default:alert("An error occurred reading this file.")}},r.onprogress=function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);t<100&&(n.style.width=t+"%",n.textContent=t+"%")}},r.onabort=function(e){alert("File read canceled")},r.onloadstart=function(e){t.style.opacity="1.0"},r.onload=function(e){n.style.width="100%",n.textContent="100%",setTimeout(function(){t.style.opacity="0.0"},2e3)},r.readAsBinaryString(e.target.files[0])},!1)},d.demo3DFileTo2DImage=function(){var e=document.createElement("div");e.style.position="absolute",e.innerHTML='        <input type="file" id="select_files" name="files[]" multiple />\n        <output id="select_result"></output>\n    ',document.getElementById("novaGraphix").parentNode.appendChild(e),document.getElementById("select_files").addEventListener("change",function(e){for(var t=e.target.files,r=[],n=0;i=t[n];n++)i.name.match(/\.(glb|GLB)$/)&&r.push("<li><strong>",d.escapeHTML(i.name),"</strong> (",i.type||"n/a",") - ",d.humanFileSize(i.size),", last modified: ",i.lastModifiedDate?i.lastModifiedDate.toLocaleDateString():"n/a","</li>");var i;for(document.getElementById("select_result").innerHTML="<ul>"+r.join("")+"</ul>",n=0;i=t[n];n++){var a=d.escapeHTML(i.name);d.loadGLB({url:"dummy/"+a,callback:function(e){d.add(e),a=(a=(a=e.name).split("/")[1]).split(".")[0],a+=".jpg",d.welcomeObject(e),d.screenCapture(a,!1),d.remove(e)}})}},!1)},d.demoEditImageFile=function(){d.imageFileToData("images/transp256.png",e=>{for(var t=e.width,r=e.height,n=e.data,i=t*r,a=0;a<i;a++)n[4*a+3]=128;d.imageDataToFile(e,"outputFile.png")})},d.demoCaptureToAnimatedGIF=function(){function e(e){var t=d.camera,r=t.position.x,n=t.position.z,i=Math.sqrt(r*r+n*n);t.position.x=i*Math.sin(e*THREE.DEG2RAD),t.position.z=i*Math.cos(e*THREE.DEG2RAD)}e(30),d.screenCapture(!1),e(0),d.screenCapture(!1),e(-30),d.screenCapture(!1)},d.demoDecomposeInstMesh=function(){d.appWorks.scene.background=d.createBackground("redSky"),d.scene.add(d.createHemisphereLight());var e=d.createPrimitive({geometry:{type:"BoxBufferGeometry",parameters:[4,4,4]},material:{type:"MeshPhongMaterial"}});d.createInstancedMeshes(e,{pattern:"rectangular",axis:"z",width:100,height:100,numWidth:10,numHeight:10,colorMode:"1"}).decompose(e=>{e.forEach(e=>{d.add(e)})})},d.demoSpeechBubble=function(){var e=d.createTextSprite("Welcome to Jamie World",{textColor:4210752,textHeight:.5,fontWeight:"bold"});e.position.z=.001,e.name="speechText";var t=new THREE.Vector3;d.computeBoundingBox(e).getSize(t);var r=256*t.x,n=256*t.y,i=.2*n,a=r/2,o=n+i,s=4*i,l=document.createElement("canvas"),c=l.getContext("2d");l.width=a>r?a:r,l.height=o>n?o:n,c.lineWidth="2",c.fillSpeechBubble(0,0,r,n,i,a,o,s,"#fff");var u=new THREE.SpriteMaterial({color:16777215,map:new THREE.CanvasTexture(c.canvas),transparent:!0,opacity:.5,depthTest:!1}),h=new THREE.Sprite(u);h.scale.set(.7*t.x,1.5*t.y,1),h.name="speechBubble";var p=new THREE.Object3D;p.name="speech",p.add(e,h),d.add(p)},d.demoProgressbar=function(){const e=new THREE.LoadingManager;e.onStart=()=>{d.createProgressbar()},e.onProgress=(e,t,r)=>{d.updateProgressbar(t,r)},e.onLoad=()=>{d.hideProgressbar()},e.onError=e=>{d.errorProgressbar("There was an error loading "+e)};THREE.DRACOLoader.setDecoderPath("js/draco/gltf/");const t=new THREE.GLTFLoader(e);t.setCrossOrigin("anonymous"),t.setDRACOLoader(new THREE.DRACOLoader),["models/gltf/BarramundiFish.glb","models/gltf/ferrari.glb","models/gltf/Flamingo.glb","models/gltf/Horse.glb","models/gltf/Parrot.glb","models/gltf/PrimaryIonDrive.glb","models/gltf/Soldier.glb","models/gltf/Stork.glb"].forEach(e=>{t.load(e,e=>{var t=e.scene||e.scenes[0],r=e.animations;r&&(t.animations=r),d.add(t)})})},d.demoShowAppInfo=function(){var e=document.createElement("div");e.id="infobutton",e.innerHTML='        <img src="images/info.png" border="0" />\n    ',e.style.cssText="        text-align: left;\n        margin: 0 0 0 0;\n        z-index: 13;\n        position: absolute;\n        display: block;\n        padding: 8px;\n    ",e.addEventListener("click",function(e){var t=document.getElementById("infoPanel").style;t.display="block"==t.display?"none":"block"}),document.getElementById("novaGraphix").parentNode.appendChild(e);var t=document.createElement("div");t.id="infoPanel",t.innerHTML='        <b>ViewWorks - 3D model viewer</b>\n        <p>\n        To upload your model,<br>\n        <b>drag and drop your file or folder onto this ViewWorks.</b><br><br>\n        Supported file formats<br>\n        JSON, OBJ(+MTL), STL, PLY, DAE(COLLADA), GLTF, GLB, AMF, 3MF, WRL(VRML), FBX<br>\n        </p>\n        (C) <a href="https://www.nova-graphix.com/" target="_blank" style="color: #ffa500; text-decoration: none;">NovaGraphix, Co.</a>, 2018.\n    ',t.style.cssText="        text-align: left;\n        font-size: 80%;\n        margin: 0.5em 0em 0em 0.4em;\n        z-index: 12;\n        position: absolute;\n        display: none;\n        color: #fff;\n        background: #121212;\n        opacity: 0.8;\n        border-radius: 20px;\n        padding: 32px;\n    ",document.getElementById("novaGraphix").parentNode.appendChild(t)},d.demoApplication=function(){d.demoShowAppInfo()},d.createViewWorks=function(e){return d.viewWorks=new d.ViewWorks(e),d.viewWorks.renderScene(),d.viewWorks},d.createGameWorks=function(e){return d.gameWorks=new d.GameWorks(e),d.gameWorks.renderScene(),d.gameWorks},d.createNatureWorks=function(e){return(e=e||{}).appName=e.appName||"natureWorks",d.natureWorks=new d.DesignWorks(e),d.natureWorks.renderScene(),d.natureWorks},d.add=function(e){d.appWorks.history?d.appWorks.add(e):d.scene.add(e)},d.remove=function(e){d.appWorks.history?d.appWorks.remove(e):e.parent&&e.parent.remove(e)},d.dispose=function(e){e&&(e.parent&&e.parent.remove(e),e.traverse(function(e){if(e.isMesh){e.geometry.dispose();var t=e.material;(Array.isArray(t)?t:[t]).forEach(function(e){e.dispose()})}}))},window.URL=window.URL||window.webkitURL,window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,window.JAMIE=d}]);